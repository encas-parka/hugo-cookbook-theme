{{- /*
  single.metadata.json
  Fichier JSON minimaliste contenant uniquement les métadonnées essentielles
  Permet une vérification rapide du contenu sans télécharger le fichier complet

  Taille estimée : ~500-800 octets vs plusieurs MB pour le fichier complet
  Optimisation : ~99% de réduction de taille pour les vérifications de contenu
*/ -}}


{{- $eventData := partialCached "functions/event-data-processor.html" . .File.UniqueID -}}
{{- $ingredient_totals := $eventData.ingredient_totals -}}
{{- $totalAssiettesByIngredient := $eventData.totalAssiettesByIngredient -}}
{{- $totalRecipesByIngredient := $eventData.totalRecipesByIngredient -}}

{{- /* Utiliser le même hash optimisé avec partialCached pour garantir la cohérence */ -}}
{{- $contentHash := partialCached "functions/hash-event-calculator.html" $eventData .File.UniqueID -}}

{{- /* Récupérer les données essentielles */ -}}
{{- $eventData := partialCached "functions/event-data-processor.html" . .File.UniqueID -}}
{{- $allDates := $eventData.allDates -}}

{{- /* Creation d'uuid max 36 pour appwrite (même logique que le fichier principal) */ -}}
{{- $baseName := .File.ContentBaseName | default .File.UniqueID -}}
{{- $prefix := substr $baseName 0 4 -}}
{{- $uuidPart := substr $baseName (sub (len $baseName) 10) 10 -}}
{{- $mainGroupId := printf "%s_%s" $prefix $uuidPart -}}

{
  "mainGroup_id": {{ $mainGroupId | jsonify }},
  "hugoContentHash": {{ $contentHash | jsonify }},
  "name": {{ .Title | jsonify }},
  "allDates": {{ $allDates | jsonify }},
  "lastModified": {{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
  "ingredientsCount": {{ len $eventData.ingredient_totals }},
  "totalAssiettes": {{ $eventData.total_assiettes | default 0 }},
  "totalRecipes": {{ $eventData.total_recipes | default 0 }}
}
