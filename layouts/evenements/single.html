{{ define "main" }}


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"> 


<!--::: Liste qui contiendra tous les ingrédients avec leurs données associés (quantité, recette, date, assietes...). Sert aux tableaux des quantités.  -->
{{- $IngredientList := slice -}}

<!-- Liste qui contiendra qui contient les listes de recettes pour chaque date -->
{{- $recettesList := slice -}}

{{- $IngredientsNamesList := slice -}}

{{- $IngredientsTypesList := slice -}}
{{- $recettesAll :=  dict -}}
{{$recetteKey:= 1}}
{{ $nbDate := 0 }}

{{/*  TODO Optimiser avec un json ou partial ?  */}}
{{/*  Reccuperation des ingredients frais  */}}
{{ $pFrais := slice }}
{{- range $.Site.Data.ingredients -}}
  {{- range .ingredients -}}
    {{- if .pFrais -}}
      {{- $pFrais =  $pFrais | append .title -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- range $.Param "repas" -}}
  <!-- Creation des variables qui ne seront plus visible au prochain scope. Nous sommes dans les params de l'Evenement -->
  {{- $dateService:=.date_service -}}
  {{- $nbDate = add $nbDate 1 -}}
  {{- $horaire:=.horaire -}}
  
  {{/*  Modifier l'heure de la date ISO en fonction du parametre $horaire (non défini par l'utilisateur) afin de permettre le tri par date des recettes.  */}}
    {{ if eq $horaire "matin" }}
      {{- $dateService = $dateService | replaceRE "T\\d{2}:\\d{2}:\\d{2}" "T08:00:00" }}
    {{- else if eq $horaire "midi" -}}
      {{- $dateService = $dateService | replaceRE "T\\d{2}:\\d{2}:\\d{2}" "T12:00:00" -}}
    {{- else if eq $horaire "soir" -}}
      {{- $dateService = $dateService | replaceRE "T\\d{2}:\\d{2}:\\d{2}" "T20:00:00" -}}
    {{- end -}}
    
    {{- $assiettes:= (int .assiettes)  -}}


  <!--  -->
  {{- range .recettes_du_repas -}}
  <!--::: Creation des variables qui ne seront plus visible au prochain scope. Nous sommes dans les params de 1er niveau des recettes -->
    {{- $recette:=.recette -}}
    {{- $typePlat:=.type_plat -}}
    {{/*  Si un nombre de couverts alternatif a été déclaré pour ce plat en particulier, on substitue...  */}}
    {{ if .altAssiettes }}
      {{- $assiettes = .altAssiettes  -}}
    {{ end }}

    {{- $recetteName := "" -}}
    {{- $url:= print .recette | urlize -}}
    {{- with site.GetPage $url -}}
      {{- $recetteName = .Params.title -}}
    {{- end -}}
    {{/*  Envoie de la liste des recettes dans recettesList  */}}
    {{- $recettesList = $recettesList | append (dict
        "recetteKey" $recetteKey
        "recette" .recette
        "dateService" $dateService
        "horaire" $horaire
        "typePlat" $typePlat
        "assiettes" $assiettes
        "chef" .chef
        "commentaire" .commentaire
        "partof" .partof
        "recetteName" $recetteName
    ) -}}
    {{/*  incrémentation des "id" unique des recettes  */}}
    {{$recetteKey = (add (float $recetteKey) 1)}}

    <!-- Reccupération des données sur les pages de chaque recettes -->
    {{- $url:= print .recette | urlize -}}
    {{- with site.GetPage $url -}}


    {{- $assiettesRecettes:= .Params.plate -}}
    <!-- pour tous les parametres ingredients... -->
      {{- range $key, $value := .Params.ingredients -}}
        <!-- ...on liste/boucle sur tous les sous parametres -->
        {{- range $index, $element := . -}}
        
        {{/*  On calcule les proportion de quantité : (quantité recette initiale x nombre d'assiettes pour le repas) / nombre de couvert de la recette initiale  */}}
        {{$quantiteCompute:= float "0" }}
        
        {{ if .quantite }}
          {{ $quantiteCompute = ((div (mul (float .quantite) (float $assiettes )) (float $assiettesRecettes ))) }}
        {{ end }}
        
        {{/*  USELESS → categorie frais existe maintenant  */}}
        {{/*  {{ $iType := ""}}
        {{ if and  (or (eq $key "lof") (eq $key "sucres") (eq $key "autres")) (in $pFrais .title) }}
        {{ $iType = "Frais"  }}
        {{ else }}
        {{ $iType = $key | strings.FirstUpper  }}
        {{ end }}  */}}
        {{ $iType :=  $key | strings.FirstUpper}}

          {{- $IngredientList =
          $IngredientList | append (dict
            "ingredient" .title
            "quantite" $quantiteCompute
            "unit" .unit
            "ingType" $iType
            "recette" $recetteName
            "dateService" $dateService
            "horaire" $horaire
            "typePlat" $typePlat
            "assiettesRecettes" $assiettesRecettes
            "assiettes" $assiettes
          ) -}}

          {{/* USELESS What ? rm for test  */}}
          {{/*  {{ if and  (eq $key "lof") (in $pFrais .title) }}
            {{ $iType = "Frais"  }}
            {{- $IngredientsTypesList = $IngredientsTypesList | append (dict  "iType" $iType)  -}}
          {{ else }}
           {{- $IngredientsTypesList = $IngredientsTypesList | append (dict  "iType" ($key | strings.FirstUpper ))  -}}
          {{ end }}  */}}
          {{- $IngredientsTypesList = $IngredientsTypesList | append (dict  "iType" $iType ) -}}

        {{- end -}}
      {{- end -}}
      
      {{- end -}} {{/* {{ with site.GetPage $url }} */}}
      {{- end -}} {{/* recettes_du_repas */}}
      {{$recetteKey = (add (int $recetteKey) 1)}}
{{- end -}} {{/* range $.param repas */}}



{{/*  Dédoublage des listes  */}}
{{- $IngredientsNamesList = $IngredientsNamesList |uniq -}}
{{- $IngredientsTypesList = $IngredientsTypesList | uniq -}}


{{/* ::: Regroupement des ingredients allergenes  */}}

{{/*  USELESS  */}}
{{/*  Reccupération des données allergenesIng sur chaque ingrédients. Permet de faire évoluer la liste plutot que de la figer  */}}
{{/*  {{- $allergenesTypeList := slice -}}
{{ range $.Site.Data.ingredients }}
  {{- range .ingredients -}}
    {{- if .alergenesIng -}}
      {{- $allergenesTypeList = $allergenesTypeList | append .alergenesIng -}}
    {{- end -}}
  {{- end -}}
  {{ end }}
{{- $allergenesTypeList = $allergenesTypeList | uniq -}}  */}}

{{/*  {{ $sAllergenes := newScratch }}
{{- range $.Site.Data.ingredients -}}
  {{- range .ingredients -}}
    {{- if .alergenesIng -}}
      {{- $ingTitle := .title -}}
      {{ range .alergenesIng -}}
           {{$sAllergenes.Add . (slice $ingTitle)}}
      {{ end }}    
    {{- end -}}
  {{- end -}}
{{- end -}}  */}}

{{ $sAllergenes := (partialCached "functions/allergenesIng.html" .)  }}

{{ $allergenesLgList := slice "Poisson" "Oeuf" "Soja" "Sésame" "Moutarde" "Fruit à coque" "Céleri" "Crustacé" "Arachide" "Mollusque"}}


{{/*  {{ $allergenesDict := dict }}  */}}
{{ $allergenesList := slice }}
{{ range $allergenesLgList }} {{/* replace $allergenesTypeList */}}
  {{/*  {{ $allergenesDict = merge $allergenesDict (dict . ($sAllergenes.Get .)) }}  */}}
  {{ $allergenesList = append  ($sAllergenes.Get .) $allergenesList }}
{{ end }}


{{/*  lien vers le CMS de la page  */}}
{{/*  FIXIT : lien vers url slug uuid  */}}
{{ $linkCMSPage := (path.Join "/admin/#/collections/evenement/entries/" (.Title | urlize)) }}
{{/*  FIXIT : Recheck pour généraliser theme  */}}
{{$enkaDevCms := ""}}
{{ if eq .Site.BaseURL "enka-cookbook.pages.dev"}}
{{$enkaDevCms = "https://enka-cookbook.netlify.app/"}}
{{ end }}
  <span class="text-end no-print p-2"><a target="_blank" rel="noopener noreferrer" href="{{- $enkaDevCms -}}{{- $linkCMSPage -}}/index">Modifier</a></span>

<div id="app">

{{/* ::: navbar page */}}
  <div id="navbarEvent">
     <nav class="navbar fixed-top topnav2 no-print navbar-dark bg-dark shadow p-0  rounded-bottom-4" x-data="scrollToReveal()" x-ref="navbar" x-on:scroll.window="scroll()"  x-bind:class="{ 'scrolled': !isScrolled }">
        <div class="container-fluid">
            <li class="nav-item p-lg-2 py-1 px-2">
              <div class="btn-group" role="group"> 
               
                <a href="#Recettes" class="btn btn-primary btn-sm shadow-sm  py-0 py-md-1"
                ><span class="me-2 d-md-none">{{ partial "inline-svg" (dict "src" "fonticons/preparation.svg" "display" "inline-middle" "rem" 2) }}</span> <span class="d-none d-md-inline">Recettes</span></a>
              
                <button type="button" class="btn btn-primary btn-sm dropdown-toggle  py-0 d-none d-md-inline" data-bs-toggle="dropdown" aria-expanded="false">{{ partial "inline-svg" (dict "src" "fonticons/search.svg" "display" "inline-middle" "fs" 5) }}</button>
              
               <ul class="dropdown-menu columns-3 p-3">
                {{ $dateService := "none"}}
                {{ $horaire := "none" }}
                <div class="row row-cols-md-2 p-lg-2 py-1 px-2">
                  {{- range sort $recettesList ".dateService" -}}
                    <div class="p-2">
                      <div class="card p-1">
                        <a href="#recetteID{{ .recetteKey }}">
                          <slot name="{{ .recetteKey }}"></slot>{{.dateService | time.Format "Mon 2" | urlize}} - {{ .recetteName }}<span class="small"> ({{.horaire}})</span>
                        </a>
                      </div>
                    </div>
                  
                  {{/*  Actualiser la date apres le range  */}}
                  {{ $dateService = (.dateService | time.Format "Monday 2 January ")}}
                {{end}}
              </div>
            </ul>
          </div>
          </li> 
            <div class="nav-item p-lg-2 py-1 px-2">              
              <div class="btn-group" role="group"> 
               
              <a href="#TotalIngredients" class="btn btn-primary btn-sm shadow-sm  py-0 py-md-1"
              ><span class="me-2 d-md-none">{{ partial "inline-svg" (dict "src" "fonticons/ingredients.svg" "display" "inline-middle" "rem" 2) }}</span>
              <span class="d-none d-md-inline">Ingrédients</span></a>
            
              <button type="button" class="btn btn-primary btn-sm dropdown-toggle  py-0 d-none d-md-inline" data-bs-toggle="dropdown" aria-expanded="false">{{ partial "inline-svg" (dict "src" "fonticons/search.svg" "display" "inline-middle" "fs" 5) }}</button>
            
             <ul class="dropdown-menu columns-3 p-3">
               <div class="row row-cols-md-2 p-lg-2 py-1 px-2">
                {{ range sort $IngredientsTypesList "iType" "desc"}}
                {{ $iTypeName := (partial "functions/ingredients-types-rename" (dict "ingType" .iType) .) }}
                  <div class="p-2">
                    <div class="card p-1">
                      <a href="#IngListID{{.iType}}">
                        <slot name="{{$iTypeName}}">{{$iTypeName}}</slot>
                      </a>
                    </div>
                  </div>
                
              {{end}}
            </div>
          </ul>
        </div>
        </div>

             <div class="nav-item p-lg-2 py-1 px-2">
              <a href="#affiches" class="btn btn-primary btn-sm shadow-sm py-md-1 py-0"
                ><span class="me-2 d-md-none">{{ partial "inline-svg" (dict "src" "fonticons/poster.svg" "display" "inline-middle" "rem" 2) }}</span>
                <span class="d-none d-md-inline">Affiches</span></a>
            </div>
            <div class="navbar-nav ms-auto">
            <li class="nav-item p-lg-2 py-1 px-2">
              <button class="btn btn-primary btn-sm shadow-sm py-md-1 py-0" data-bs-toggle="modal"  data-bs-target="#modalImpression"
              aria-controls="modalImpression"
              @click="printGlobal"
                ><span class="me-2 d-md-none">{{ partial "inline-svg" (dict "src" "/fonticons/printer.svg" "display" "inline-middle" "rem" 2)}}</span>
                <span class="d-none d-md-inline">Impression / PDF</span>
              </button>
            </li>
          </div>
          </ul>
        </div>
    </nav>
  </div>

{{/*  ::: Impression - MODAL  */}}
<div class="modal modal-xl fade d-print-none" tabindex="-1" id="modalImpression" aria-labelledby="modalImpressionLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable ">
    <div class=" modal-content">
      <div class="modal-header">
        <h5 class="modal-title mt-0" id="modalImpressionLabel">Imprimer / exporter en PDF</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <div class="row">
          <div class="col-md-6">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" v-model="toPrint.recettesSection" name="cbPrintRecettes"
                id="cb-printRecettes">
              <label class="form-check-label" for="cb-printRecettes">Imprimer les Recettes</label>
            </div>
            <hr>

            <div class="form-check">
              <input class="form-check-input" type="checkbox" v-model="toPrint.ingredients" :value="true" name="cb-ing"
                id="cb-printIngredient">
              <label class="form-check-label" for="cb-printIngredient">Imprimer les listes des ingrédients</label>
            </div>


            <div v-show="toPrint.ingredients" class="ms-4">
              <div class="form-check form-switch my-2">
                <input class="form-check-input" type="checkbox" v-model="showAllColIngredients" id="checkRecipeDetail">
                <label for="checkRecipeDetail">Afficher les recettes pour chaque ingrédient</label>
              </div>
              <div class="input-group">
                <span class="input-group-text" id="addColSelect">+ colonnes : </span>
                <select v-model="printAddCol" class="form-select" aria-describedby="addColSelect"
                  aria-label="Ajouter des colonnes">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select>
              </div>
              <div class="text-muted fs-7 text-end">Ajouter des colonnes aux tableaux afin de pouvoir rajouter des informations manuscrites</div>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" v-model="toPrint.affichesSection" :value="false" name="cb-affiche"
                id="cb-printAffiches">
              <label class="form-check-label" for="cb-printAffiches">Imprimer les Affiches (imprimez à part, sinon bug)</label>
            </div>
          </div>
          <div class="col-md-6">
            <div class="callout small">
              <p>
                Pour exporter en PDF, dans les options d'impression, selectionnez : destination > "enregistrer au format
                Pdf" comme imprimante. Pensez aussi à personnaliser les marges d'impression ou l'échelle afin de
                redimensionner le contenu selon ce qui vous convient.
              </p>
              <p>

              </p>

            </div>
          </div>
        </div>

        <hr>
        <div class="text-end">
          <a class="btn btn-primary" @click="print" role="button" data-bs-dismiss="modal">Imprimer !</a>
        </div>
      </div>
    </div>
  </div>
</div>

{{/*  ::: Warning : missing recipes  */}}
{{- range $.Param "repas" -}}
{{- range .recettes_du_repas -}}
{{- $recette:=.recette -}}
{{/*  FIXME after update recette scheme  */}}
{{- $url:= print .recette | urlize -}}
  {{- with site.GetPage $url -}}
  {{else}}
        <div class="card border-danger border-3 my-3 p-2">
          <div class="card-body text-danger">
            <h5 class="card-title mt-1">Une des recettes de l'évenement n'existe plus !</h5>
            <p class="card-text">La recette <span class="fw-bolder">" {{ $url -}}"</span> présente dans les menus de l'événement n'existe plus sur le site. Par conséquent, la page ne s'affichera pas correctement.   </p>
            <p>La recette à peut être été supprimée, ou bien son titre à été modifié. Dans tous les cas, pour résoudre le problème, il faut modifier la page de l'événement pour remplacer la recette disparue (ou re-donner son titre antérieur à la recette)...</p>
          </div>
        </div>
{{- end -}}
{{- end -}}
{{- end -}}

<a href="#" class="scroll-to-top" title="Scroll to top"></a>


{{/* ::: _LES RECETTES   */}}
<div id="recettesSection" :class="{'no-print' : !toPrint.recettesSection}">
  <h3 id="Recettes" class="no-print">Les {{len $recettesList}} recettes prévues pour l'événement "{{.Page.Title}}"</h3>
  {{/*  TODO : pour l'instant inutile... A re-reflechir  */}}
  {{/*  <div class="col-3 ms-auto">
    <div class=" d-print-none p-2 ms-auto form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="switchDetailDisplay" v-model="displayDetailsRecettes">
      <label for="switchDetailDisplay" class="form-check-label">Afficher les détails</label>
    </div>
  </div>  */}}

  {{/* ::: _sommaire */}}
    <div class="no-print">
      {{/* Variable permettant de vérifier si les recettes sont de la meme date et du meme horaire ou pas; pour gérer leur affichage / l'organisation des recettes */}}
      {{ $dateService := "none"}}
      {{ $horaire := "none" }}
      <div class="card p-4 m-2">
        <span class="fs-4">Sommaire</span>
      
        {{- range sort $recettesList ".dateService" -}}

        <div>
          
          {{ if and (ne (.dateService | time.Format "Monday 2 January ") $dateService) }}
            <a href="#{{ .dateService | time.Format "Monday 2 January" |urlize}}" class="fw-bolder">
              <slot name='{{.dateService | time.Format "Monday 2 January" | urlize}}'>{{.dateService | time.Format "Monday 2 January"}}</slot>
            </a>
          {{ end }}

          <div class="ms-5">
            <a href="#recetteID{{ .recetteKey }}">
              <slot name="{{ .recetteKey }}"></slot>{{.recetteName }} →<span class="small"> ({{.horaire}} - {{.typePlat}} - {{.assiettes}} couverts)</span></a>
            </a>
          </div>
        </div>

        {{/*  Actualiser la date apres le range  */}}
        {{ $dateService = (.dateService | time.Format "Monday 2 January ")}}

        {{end}} {{/*  range recettesList */}}
      </div>
    </div>


{{/*  ::: __Les intertitres jours  */}}
{{ range sort $recettesList ".dateService" }}
  <div class="no-print">
    {{ if and ( ne (.dateService | time.Format "Monday 2 January ") $dateService )}}
      <div class="h3 text-center card py-4 mx-6 bg-primary bg-opacity-10 fw-bolder"  id="{{.dateService | time.Format "Monday 2 January" |urlize}}">{{ .dateService | time.Format "Monday 2 January"}}</div>
    {{ end }}
    
    {{ if ne .horaire $horaire }}
      <div class="h4 text-center card py-3 mx-6 bg-light">{{ .horaire}} </div>
    {{ end }}
    
    {{ $dateService = (.dateService | time.Format "Monday 2 January ")}}
    {{ if eq (.dateService | time.Format "Monday 2 January ") $dateService }}
      {{ $horaire = .horaire }}
    {{ else }}
      {{ $horaire = "" }}
    {{ end }}
  </div>

{{/* ::: __LES RECETTES cards */}}
{{/* variable avant GetPage */}}
{{- $assiettes:= (int .assiettes) -}}
{{- $recette := .recette -}}
{{- $recetteName := .recetteName -}}
{{- $recetteKey := .recetteKey -}}
{{- $dateService := .dateService -}}
{{- $horaire := .horaire -}}
{{- $partof := .partof -}}
{{- $typePlat := .typePlat -}}
{{- $assiettes := .assiettes -}}
{{- $chef := .chef -}}
{{- $commentaire := .commentaire -}}




{{/* ::: ____A l'interieur de chaque url de post recettes inclue dans l'evenement */}}
{{/*  FIXME after update recette scheme  */}}
{{- $url:= print .recette | urlize -}}
{{- with site.GetPage $url -}} 
<div 
  class="card break-after avoid-break-inside my-5 p-2 bg-light bg-opacity-25 print-nocard"
  id="recetteID{{$recetteKey}}"
  :class="{ 'no-print': !toPrint.recetteID{{$recetteKey}} }"
  >
  <div class="card-body py-1">
    <a class="btn btn-sm btn-outline-primary float-end no-print mx-1" 
    @click="printThis('recetteID{{$recetteKey}}', 'recettesSection')" 
    > {{ partial "inline-svg" (dict "src" "/fonticons/printer"  "fs" 3) }} </a>
    <a class="btn btn-sm btn-outline-primary float-end no-print mx-1" 
    href="{{.RelPermalink}}"
    > {{ partial "inline-svg" (dict "src" "/fonticons/box-arrow-in-right"  "fs" 3) }} </a>
    <div id="titreRecette" class="py-1h2 my-2">
      <div class="my-2 h2">{{ partial "components/icon-recette" . }} {{ $recetteName }}
        {{ if $partof }}
        <span class="ms-3 fs-5">(pour : {{ $partof }})</span>
        {{ end }}
      </div>
    </div>

    <div id="topRecette" class="row">
      <div class="col">
        <div class="fw-semibold fs-5 "> {{ $dateService | time.Format "Monday 2 January "}} - {{ $horaire }} - {{
          $typePlat }}</div>
        <div class="">
          <div class="print-fs-4 print-bold">Nombre de couverts: {{ $assiettes }}</div>

          {{ with .Params.quantite_desc }}
          <div class="my-2 no-print">    
              {{.}}
          </div>
          {{ end }}
          {{ if $chef }}
          <div>Référent•es: {{ $chef }} - </div>
          {{ end }}
        </div>
        <div>
            {{ if .Params.spécialité }}
            <div class="small">Spécialité : {{ .Params.spécialité }}</div>
            {{ end }}
        </div>
        
      </div>
 
      <div class="col text-end">
        <div class="mb-2">{{ partial "content/badge-recette.html" . }}</div>
        <div>
          {{ if .Params.materiel }}
          {{ range .Params.materiel }}
          <div class="badge bg-grey float-end me-1">{{ . }}</div>
          {{ end }}
          {{ end }}
        </div>
      </div>
     
 
     {{/*  ::: ___Alertes  */}}
      {{/*  initialisation des variables check */}}
      {{- $assiettesInit := .Params.plate -}}

      {{- $isCheck := false -}} {{- $checkfor := "" -}} {{- $checkYes := false -}}
      {{- $compareQuantite := slice -}}

      {{- $alertQuantite := false -}}
      {{ with .Param "checkfor" }}{{- $checkfor = (int .) -}} {{- end -}}
      {{ if eq .Params.check "Oui" }}{{- $isCheck = true -}}{{ end }}
      {{ if (or $isCheck $checkfor) }}
      {{ $checkYes = true }}
      {{ end }}

      {{/*  TODO Ajouter proportion fixe : checkAlwaysOk  */}}
      {{ if eq $checkYes false }}
      {{ if $checkfor }}
        {{ if and 
          (or (gt (div $assiettes 2) $checkfor ) (lt (mul $assiettes 2) $checkfor) )
          (or (gt (div $assiettes 2) $assiettesInit ) (lt (mul $assiettes 2) $assiettesInit) )
          -}}
        {{- $alertQuantite = true -}} {{- $compareQuantite = slice $checkfor $assiettesInit -}}
        {{end}}
      {{ else }}
        {{ if or (gt (div $assiettes 2) $assiettesInit ) (lt (mul $assiettes 2) $assiettesInit) }}
        {{- $alertQuantite = true -}} {{- $compareQuantite = $assiettesInit -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

      {{/* reccupération des ingredients warning de la recette  */}}

  {{ $ingredientsL := slice }}
  
  {{- range $key, $value := .Params.ingredients -}}
  {{- with . -}}
  {{- range $index, $element := . -}}
  {{ $ingredientsL = $ingredientsL | append .title}}
  {{- end }}
  {{- end -}}
  {{- end -}}

      
    {{- $alertGluten := intersect $ingredientsL ($sAllergenes.Get "Gluten") -}}
        
    {{- $alertPorc := intersect $ingredientsL ($sAllergenes.Get "Porc") -}}
    
    {{- $alertLait := intersect $ingredientsL ($sAllergenes.Get "Produit laitier") -}}
    
    {{- $alertAutresAllergenes := slice -}}
    {{ range $allergenesLgList }}
      {{- $toAdd := intersect $ingredientsL ($sAllergenes.Get . ) -}}
      {{- $alertAutresAllergenes = $alertAutresAllergenes | append  $toAdd -}}
    {{ end }}
    
    {{/*  DONE ? → liste des type d'allergenes  */}}
    {{/*  {{- $alertTypesIng := slice -}}
    {{ range $allergenesTypeList }}
      {{- $toAdd := intersect $ingredientsL ($sAllergenes.Get . ) -}}

      {{- $alertTypesIng = $alertTypesIng | append $toAdd -}}
      
    {{ end }}  */}}
    
    
      {{- $assiettesInit := .Params.plate -}}
      {{/*  alert noprint  */}}
        <div class="row justify-content-start mt-2 ">

       {{/*  <hr class="my-1 no-print">  */}}
        {{ if $alertQuantite }}
        <div class="col-12 col-md-6 col-lg-6 col-xl-6 print-col-2 my-3">
          <div class="card border-danger shadow small px-4 card-body print-nocard">
            {{ if not $checkYes }}
            <div> <span class="me-1">{{ partial "inline-svg" (dict "src" "fonticons/exclamation-circle" "display" "inline" "fs" 4) }}</span>
              Le nombre de couverts prévu est significativement différent de celui qui a été déclaré comme testé
              ({{$compareQuantite}}): les proportions
              sont peut-être à adapter pour certains ingrédients. </div>
            {{ end }}
          </div>
        </div>
        {{ end }}

      
        {{- with (or ( $alertAutresAllergenes ) ( $alertGluten) ( $alertLait) ( $alertPorc)) -}}
        <div class="col-12 col-md-6 col-lg-6 col-xl-6 print-col-2 my-3">
          <div class="card border-danger shadow small px-4 card-body print-nocard">
            {{- with $alertAutresAllergenes -}}
            <div><span class="me-1"> {{ partial "inline-svg" (dict "src" "fonticons/exclamation-triangle" "display" "inline" "fs" 4) }}</span>
              Allergènes divers:
              <span class="fw-bold">{{ delimit $alertAutresAllergenes ", "}}</span>
            </div>
            {{- end -}}
            {{- with $alertGluten -}}
            <div>{{ partial "inline-svg" (dict "src" "fonticons/gluten" "display" "inline" "fs" 3) }}
              Gluten :
              <span class="fw-bold">{{ delimit $alertGluten ", "}}</span>
            </div>
            {{- end -}}
            {{- with $alertLait -}}
            <div>{{ partial "inline-svg" (dict "src" "fonticons/milk-box" "display" "inline" "fs" 3) }}
              Produits laitier :
              <span class="fw-bold">{{ delimit $alertLait ", "}}</span>
            </div>
            {{- end -}}
            {{- with $alertPorc -}}
            <div>{{ partial "inline-svg" (dict "src" "fonticons/no-vegan" "display" "inline" "fs" 3) }} Porc:
              <span class="fw-bold">{{ delimit $alertPorc ", "}}</span>
            </div>
            {{- end -}}
          </div>
        </div>
        {{- end -}} 
      </div>
       
      
    </div> 
    {{ end }} {{/* with site.GetPage $url */}}
    
    
    
    {{/* :::  ___LES INGREDIENTS  */}}
    <div id="IngredientsEtPreparation-recette" class="row justify-content-evenly border-top border-1 pt-2" v-show="displayDetailsRecettes">
      <div id="Ingredients-recette" class="col-md-4 print-col-30-100">
      <h4><span class="me-2">{{ partial "inline-svg" (dict "src" "fonticons/ingredients" "display" "inline-middle" "rem" 3) }}</span> Ingredients </h4>
        
      {{/*  variable avant GetPage  */}}
        {{- $assiettes:= (int .assiettes)  -}}
        {{- $url:= print .recette | urlize -}}
        {{/*    */}}
     
      {{- with site.GetPage $url -}}
        
        {{/*  Reccupération de la variable .Params.plate avec le range suivant, pour pouvoir l'utiliser dans le calcul des quantités correspondant au nombre d'assiete du repas  */}}
        {{- $assiettesRecettes:= (int .Params.plate) -}}
        
        {{- range $key, $value := .Params.ingredients -}}
        {{ with . }}
        <div class="card my-2 p-2 " outlined>
          <div class="row">
            <div class="col">
              <div class="mb-2"> {{ partial "components/icon-type"  (dict "icon" $key) }} <span class="fw-bold">{{ partial "functions/ingredients-types-rename-short" (dict "ingType" ($key  | strings.FirstUpper )) .}} </span> 
              {{/*  {{ if eq $key "epices"}} 
                <div class="small text-muted text-center m-0 p-0">(gouttez, ajustez !)</div>
              {{ end }}   */}}
              </div>

              {{ range $index, $element := . -}}
                <div class="small ps-2">
                  {{/*  <span class="fw-bold">• {{ partial "components/ingredients" (dict "title" .title "alergene" $allergenesList)
                  }}</span>  */}}

                  {{/* Pour obtenir les quantité correspondant au nombres d'assiettes indiquées  */}}
                  {{ partial "functions/ing4events.html" (dict "ingredient" .title  "quantite" .quantite "assiettes" $assiettes "assiettesRecettes" $assiettesRecettes "unit" .unit "alergene" $allergenesList) }}
                  {{ with .commentaire }}
                  <span class="small fs-6 fw-light ms-2 lh-1">({{.}})</span>
                  {{ end }}
                </div>
              {{ end }}

            </div>
          </div>
        </div>
        {{ end }}
        {{ end }} {{/* range $key, $value := .Params.ingredients */}}
        <div class="text-muted small">
          {{ partial "inline-svg" (dict
          "src" "fonticons/exclamation-triangle"
          "display" "inline"
          "title" "Allergène"
          "fs" 5
           ) }} → Allergènes
        </div>
    </div>
          
      {{/* ::: ___PREPARATION  */}}
    <div class="col-md-8 print-col-70-100">
      <h4><span class="me-2">{{ partial "inline-svg" (dict "src" "fonticons/preparation" "display" "inline-middle" "rem" 3) }}</span> Préparation</h4>
      {{ if $commentaire }}
      <div class="card mb-3">
        <div class="card-body print-nocard">
           <span class="text-muted">{{ partial "inline-svg" (dict "src" "fonticons/exclamation-circle" "display" "inline-middle" "fs" 4 ) }} info </span> 
           <br>
           <span class="small">{{$commentaire}}</span> 
        </div>
      </div>
      {{ end }}
        <div class=" card card-body print-nocard">
        {{ if .Params.preparation24h }}
         <div class="card border border-danger mb-4 p-3 " >
           <p class="fs-5 fw-bold text-center print-fs-medium" >A prévoir à l'avance !</p>
           <div>{{ .Params.preparation24h | markdownify }}</div>
        </div>
        {{ end }}
          {{ .Params.preparation | markdownify }}
        </div>
          
      {{ range .Params.astuces }}
          <div class="col-md-5 card card-body m-2 small ">
            Astuce: {{ .astuce }}
          </div>
      {{ end }}
      </div>


      {{else}}
      <div>
        Cette recette n'exite plus dans la base de donnée !
      </div>
    {{ end }} {{/* with site.GetPage $url */}}
    </div>
  


  </div>
</div>
{{/*  Incrementation en fin de range  pour un unique ID par recettes  */}}
{{$recetteKey = (add (float $recetteKey) 1)}}



{{ end }} {{/* recettes du repas ? */}}

</div>


<div class="py-5 no-print" id="TotalIngredients"><hr></div>
<div class="container-fluid " :class="{'no-print':!toPrint.ingredients}">
  <h3 class="no-print">Listes des {{ len $IngredientList }} Ingrédients présents dans les menus</h3>
  <div class="row justify-content-evenly">

    {{/*  ::: _Sidebar Total ingredients  */}}
    <nav class="flex-column col-md-4 col-lg-3 d-md-block bg-light  mt-7 d-print-none " >
      <div class="sticky-top overflow-y-auto" style="top: 70px; height: 612px">
    
        <div class="my-5 small">
         <div class="mb-3">
            <label class="mb-2">Selectionner la période  que vous souhaitez prendre en compte</label>
            <div class="mb-3">
              <input id="datepickerStart" class="flatpickr flatpickr-input form-control"
                type="text" readonly="readonly" placeholder="Date de début" v-model="startDateSelected"
                >
            </div>
            <div class="mb-3">
              <input id="datepickerEnd" class="flatpickr flatpickr-input form-control" type="text"
                readonly="readonly" placeholder="Date de fin" v-model="endDateSelected">
              </div>
              <div class="mb-3 text-end">
                <button class="btn btn-primary btn-sm shadow-sm text-white" @click="datesReset" type="button" id="btn-allDate">Toutes les dates</button>
              </div>
            </div>
            <hr>
            <div class="mb-3">
              Afficher les quantités des produits frais par périodes 
            </div>
            <div class="mb-1 form-check form-switch">
              <input type="checkbox" class="form-check-input" v-model="legumesByRanges" name="cb-legumesByRanges" id="cb-legumesByRanges">
              <label for="cb-legumesByRanges">... fruits et legumes frais </label>
            </div>
            <div class="mb-1 form-check form-switch">
              <input type="checkbox" class="form-check-input" v-model="fraisByRanges" name="cb-fraisByRanges" id="cb-fraisByRanges">
              <label for="cb-fraisByRanges">... autres produit frais</label>
            </div>
            <div class="mb-1 form-check form-switch">
              <input type="checkbox" class="form-check-input" v-model="animauxByRanges" name="cb-animauxByRanges" id="cb-animauxByRanges">
              <label for="cb-animauxByRanges">... viandes et poissons </label>
            </div>
            <div class="input-group mb-3" >
              <input type="number" v-model="daysPerRange" class="form-control" min="1" max="9" 
              :disabled="!animauxByRanges && !fraisByRanges && !legumesByRanges ">
              <span class="input-group-text" id="basic-addon2">jours</span>
            </div>
            
            <hr>
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" v-model="showAllColIngredients" id="checkRecipeDetail">
              <label for="checkRecipeDetail">Afficher les recettes pour chaque ingrédient</label>
            </div>
          </div>
        </div>
  
      </nav>
  
  {{/* ::: Total INGREDIENTS   */}}
  <div class="col  print-col-12 ms-md-3">

      <span class="btn-group no-print my-2 me-2" role="group" aria-label="Exporter / Copier">
        <button class="btn btn-outline-secondary" disabled>Copier les tableaux dans le presse-papier : </button>
        <button type="button" class="btn btn-outline-primary" onclick="copyOrExport('text')">Texte simple</button>
        {{/*  <button type="button" class="btn btn-outline-primary" onclick="copyOrExport('html')">html</button>  */}}
        {{/*  TODO : modal explicatif  */}}
      </span>

      <span class="btn-group no-print my-2" role="group" aria-label="Exporter CSV">
        <button class="btn btn-outline-secondary" disabled>Télécharger : </button>
        <button type="button" class="btn btn-outline-primary" onclick="copyOrExport('csv')">csv (tableur)</button>
        <button type="button" class="btn btn-outline-primary" onclick="copyOrExport('md')">Tableau Markdown</button>
      </span>

      <div class="sticky-md-top top55 border rounded border-transparent bg-dark container-fluid p-2 no-print" style="--bs-bg-opacity: .3;">
        <input type="text" v-model="search" class="form-control" placeholder="Rechercher un ingrédient">
      </div>
    {{/* :::_FraisByDayRange  */}}
    {{ $fraisByRanges := slice | append  (dict "idR" "LegumesRanges" "titleR" "Fruits Legumes Frais" "iType" "Legumes" "thisRange" "legumesByRanges") (dict "idR" "AnimauxRanges" "titleR" "Viandes/Poissons Frais" "iType" "Animaux" "thisRange" "animauxByRanges") (dict "idR" "FraisRanges" "titleR" "Autres produits Frais" "iType" "Frais" "thisRange" "fraisByRanges") }}

    {{ range $fraisByRanges }}
    {{ $indexTable := 1 }}
    <div id="{{.idR}}" class="">
      <template v-for="(range, index) in rangesDates">

    {{/*  ::: ___table Frais  */}}
      
    <div 
        v-if="{{.thisRange}} && totalRangeWithDetail('{{ .iType }}', range[0], range[range.length - 1]).size > 0" 
        class="card my-2 mb-lg-6 avoid-break-inside border-danger border-1 mb-3  print-nocard"
        :class="{'no-print':!toPrint.{{.idR}} }"
        :id="range[0]"
        >
        <div class="card-body">
          <div class="">
            <span class="fs-5 toCopy"> {{.titleR}} du [[ range[0] ]] au [[range[range.length - 1] ]] </span>
            <div class="my-2 float-end">
              <a
                class="btn btn-outline-secondary btn-sm text-muted "
                role="button"
                @click="printThis('{{.idR}}', 'ingredients')"
                >{{ partial "inline-svg" (dict "src" "fonticons/printer"  "fs" 3) }}</a>
            </div>
          </div>

          <table id="tableFrais" class="table table-responsive toCopy"  :class="{'table-striped': !showAllColIngredients, 'table-bordered' : showAllColIngredients}">

            <thead>
              <tr>
                <th>Ingredients {{.iType}} </th>
                <th class="text-center">Recettes</th>
                <th class="text-end">Total</th>
                <th class="printonly" v-show="printAddCol === '1' || printAddCol ===  '2' "></th>
                <th class="printonly" v-show="printAddCol === '2' "></th>
              </tr>
            </thead>

            <tbody>
              <template v-for="item in totalRangeWithDetail('{{ .iType }}', range[0], range[range.length - 1])">

                <tr v-if="showAllColIngredients && !item.qTotal"
                :class="{'table-secondary fw-bold': item.qTotal}"
                >
                <td :class="{'small text-muted': !item.qTotal}">[[item.ingredient]]</td>
                <td v-if="item.recette" class="small">
                  <span class="fw-bold">[[item.recette]]</span> le [[new Date (item.dateService).toISOString().substr(0, 10)]] /
                  [[item.horaire]] <br> pour [[item.assiettes]] couverts
                  <span class="float-end">
                    <span class="fw-bold " v-if="item.quantiteOrig && item.unitOrig">[[round2Decimals(item.quantiteOrig)]] [[item.unitOrig]] ~= </span>
                    <span class="fw-bold" v-if="item.quantite && item.unit">[[round2Decimals(item.quantite)]] [[item.unit]]</span>
                  </span>
                </td>
                
                </tr>

                <tr v-if="item.qTotal" :class="{'table-secondary': showAllColIngredients}">
                  <td class="toCopyTd">[[item.ingredient]]</td>
                  <td class="small" >[[item.totalAssiettes]] couverts</td>
                  <td class="text-end toCopyTd">
                  <span >[[item.qTotal]] [[item.unitTotal]]</span>
                  </td>
                <td v-show="printAddCol === '1' || printAddCol ===  '2' " class="printonly print-td-15" ></td>
                <td v-show=" printAddCol ===  '2' || printAddCol ===  '3' " class="printonly print-td-15" ></td>
              </tr>

            </template>

            </tbody>
          </table>
          </div>
          </div>
          
        </template>
      </div>
    {{ end }}


    {{/*  Renommage des iType  */}}
    <div id="tableIng">
      {{ range sort $IngredientsTypesList "iType" "desc"}}
      {{ $iTypeName := (partial "functions/ingredients-types-rename" (dict "ingType" .iType) .) }}
      {{ $IngTypeList := (printf "Ing%sList" .iType) }}
      {{/*  ::: _ Card des tableau ingredients petit et grand  */}}
      <div
        v-if="totalQuantitesDP.{{$IngTypeList}} && Object.keys(totalQuantitesDP.{{$IngTypeList}}).length > 0"
        class="card my-2 mb-lg-6 avoid-break-inside  mb-3 print-nocard"
        :class="{'no-print':!toPrint.{{.iType}} }"
        id="IngListID{{.iType}}"
        >
        <div class="card-body">
          <div class="">
            {{ $svg := (printf "fonticons/%s.svg" .iType | lower)}}
            <span class="float-start me-2">{{ partial "inline-svg" (dict "src" $svg "display" "inline-middle"  "fs" 1) .  }}</span>
            <span class="fs-4 toCopy"> {{$iTypeName}} </span>
            <div class="my-2 float-end no-print">
              <a
                class="btn btn-outline-secondary btn-sm text-muted "
                role="button"
                @click="printThis('{{.iType}}', 'ingredients')"
                >{{ partial "inline-svg" (dict "src" "fonticons/printer"  "fs" 3) }}</a>
            </div>
          </div>
          <div v-if="startDate !== startDateSelected || endDate !== endDateSelected" class="fs-6 text-center toCopyDate">
              Du [[new Date (startDateSelected).toLocaleDateString("fr-FR", {weekday: 'long', month: 'long', day:
              'numeric'})]] au [[new Date (endDateSelected).toLocaleDateString("fr-FR", {weekday: 'long', month: 'long',
              day: 'numeric'})]]
          </div>
          {{/* ::: __Table ingrédients   */}}
          <table class="table table-responsive toCopy"
                :class="{'table-striped': !showAllColIngredients, 'table-bordered' : showAllColIngredients}"
                id="table-{{.iType}}"
                >
            <thead>
              <tr>
                <th>Ingredients</th>
                <th>Recettes</th>
                <th class="text-end">Total</th>
                <th class="printonly" v-show="printAddCol === '1' || printAddCol ===  '2' "></th>
                <th class="printonly" v-show="printAddCol === '2' "></th>
              </tr>
            </thead>
            <tbody>
              <template v-for="(item, ingredient) in totalQuantitesDP.{{$IngTypeList}}">
      
                <tr v-if="showAllColIngredients && !item.qTotalX"
                
                  >
                  <td :class="{'small text-muted': !item.qTotalX}"
                  >[[item.ingredient]]</td>
                  <td v-if="item.recette " class="small">
                    <span class="fw-bold">[[item.recette]]</span> le [[new Date (item.dateService).toISOString().substr(0, 10)]] /
                    [[item.horaire]] <br> pour [[item.assiettes]] couverts
                    <span class="float-end">
                      <span class="fw-bold " v-if="item.quantiteOrig && item.unitOrig">[[round2Decimals(item.quantiteOrig)]] [[item.unitOrig]] ~= </span>
                      <span class="fw-bold" v-if="item.quantite && item.unit">[[round2Decimals(item.quantite)]] [[item.unit]]</span>
                    </span>

                  </td>
                </tr>
      
                <tr v-if="item.qTotalX"  :class="{'table-secondary': showAllColIngredients}">
                  <td class="toCopyTd">[[item.ingredient]]</td>
                  <td class="small">[[item.totalAssiettes]] couverts - [[item.totalRecettes]] recettes </td>
      
                  <td class="text-end toCopyTd">
                    <template v-for="(quantite, index) in item.qTotalX" >
                      <span v-if="quantite.unit !== ''"> [[round2Decimals(quantite.qTotal)]] [[quantite.unit]] </span>
                      
                      <span v-else class="small"> non précisé </span>
                      <span v-if="index < item.qTotalX.length - 1" class="mx-1">+</span>
                      
                    </template>
                  </td>
      
                  <td v-show="printAddCol === '1' || printAddCol ===  '2' " class="printonly print-td-15" ></td>
                  <td v-show=" printAddCol ===  '2' || printAddCol ===  '3' " class="printonly print-td-15" ></td>
                </tr>
                </template>
            </tbody>
          </table>
      
        </div>
      </div>
      {{ end }}
    </div>
      </div>
    </div>
</div>

{{/* ::: Affiches */}}
<div class="row">
  <h2 class="text-center no-print mt-5">Les Affiches</h2>
  <div class="col-md-4  no-print">
    <div id="affiches">
    
      <div class="row">
        <div class="col-8"><div class="fw-bold">Police: </div></div>
        <div class="col-4"><div class="fw-bold">Taille: </div></div>
      </div>
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Date" "displayCheckbox" "true" "label" "Date")}}  

      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Horaire" "displayCheckbox" "true" "label" "Horaire")}}
     
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Desc" "displayCheckbox" "true" "label" "Description")}}
    
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Cat" "displayCheckbox" "true" "label" "Catégories")}}
    
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Recettes"  "label" "Recette")}}
    
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Regimes" "displayCheckbox" "true" "label" "Régimes")}}
    
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Alert" "displayCheckbox" "true" "label" "Allergenes")}}
    
      {{ partial "evenement/poster-custom-ui.html" (dict "vmodel" "Ing" "displayCheckbox" "true" "label" "Liste Ingredients")}}
    
      <div class="card p-2">
        <div class="h6 mt-2">Options impressions: </div>
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" type="checkbox" v-model="catPageBreak" id="catPageBreak">
          <label class="small" for="catPageBreak">Nouvelle page par catégorie (entrée/plat/dessert)</label>
        </div>
        <div v-if="catPageBreak" class="form-check form-switch mb-3">
          <input class="form-check-input" type="checkbox" v-model="dateByPageBreak" id="dateByPageBreak">
          <label class="small" for="dateByPageBreak">Date en haut de chaque page</label>
        </div>
      </div>

    </div>
  </div>
  
  <div id="affichesSection" class="col-md-8 print-col-12 break-before" :class="{'no-print' : !toPrint.affichesSection}">



    {{- range sort .Params.repas ".date_service" -}}
    {{ $dateService := .date_service | time.Format "2006-01-02" }}
    {{ $dateService = replace $dateService "-" "" }}
    
    <div id="affiche{{$dateService}}{{.horaire}}" class="page-break-after " :class="{ 'no-print' : !toPrint.affiche{{$dateService}}{{.horaire}} }" >
        <div class="card mb-3 print-nocard">

          {{/*  <button type="button" class="btn btn-outline-primary" onclick="downloadInnerHtml('affiche{{$dateService}}{{.horaire}}', 'affiche{{$dateService}}{{.horaire}}')">Download</button>  */}}
          <div class="card-body pt-2" >
            <div>
              <a class="btn btn-sm btn-outline-primary float-end no-print mx-1"
                @click="printThis('affiche{{$dateService}}{{.horaire}}', 'affichesSection')">{{ partial "inline-svg" (dict "src" "fonticons/printer"  "fs" 3) }}</a>
            </div>
            
              <div>
                <p v-show="fontDate !== 'noDisplay'" class="m-0 text-center h3" :class="[[fontDate]]" :style="fontSizeDate">{{.date_service | time.Format "Monday 2 January "}}</p>
                <p v-show="fontHoraire !== 'noDisplay'" class="text-center m-0 h3" :class="[[fontHoraire]]" :style="fontSizeHoraire" >{{ .horaire }}</p>
                <p v-show="fontHoraire !== 'noDisplay' || fontDate !== 'noDisplay'" class="fs-4 text-center fw-bold m-0">·•·•·•·•·•·•··•·•·•·•·•·•·</p>
              </div>
              
              <div class="avoid-break-inside">{{ partial "evenement/poster.html" (dict "recettes_du_repas" .recettes_du_repas  "recetteCat" "entree" "recetteCatFormat" "Entrée") }}</div>

            <div :class="{'page-break-before' : catPageBreak}">
              <div v-if="dateByPageBreak && catPageBreak" class="printonly ">
                <p v-show="fontDate !== 'noDisplay'" class="m-0 text-center h3" :class="[[fontDate]]" :style="fontSizeDate">{{.date_service | time.Format "Monday 2 January "}}</p>
                <p v-show="fontHoraire !== 'noDisplay'" class="text-center m-0 h3" :class="[[fontHoraire]]" :style="fontSizeHoraire" >{{ .horaire }}</p>
                <p v-show="fontHoraire !== 'noDisplay' || fontDate !== 'noDisplay'" class="fs-4 text-center fw-bold m-0">·•·•·•·•·•·•··•·•·•·•·•·•·</p>
              </div>
              <div class="avoid-break-inside">{{ partial "evenement/poster.html" (dict "recettes_du_repas" .recettes_du_repas  "recetteCat" "plat" "recetteCatFormat" "Plat") }}</div>
            </div>
              
            
            <div :class="{'page-break-before' : catPageBreak}">
              <div v-if="dateByPageBreak && catPageBreak" class="printonly ">
                <p v-show="fontDate !== 'noDisplay'" class="m-0 text-center h3" :class="[[fontDate]]" :style="fontSizeDate">{{.date_service | time.Format "Monday 2 January "}}</p>
                <p v-show="fontHoraire !== 'noDisplay'" class="text-center m-0 h3" :class="[[fontHoraire]]" :style="fontSizeHoraire" >{{ .horaire }}</p>
                <p v-show="fontHoraire !== 'noDisplay' || fontDate !== 'noDisplay'" class="fs-4 text-center fw-bold m-0">·•·•·•·•·•·•··•·•·•·•·•·•·</p>
              </div>
              <div class="avoid-break-inside">{{ partial "evenement/poster.html" (dict "recettes_du_repas" .recettes_du_repas  "recetteCat" "dessert" "recetteCatFormat" "Dessert") }}</div>
            </div>

          </div>
        </div>
      </div>
      
      {{ end }}
  </div>
</div>

</div> 
</div>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,700;0,900;1,900&family=Gluten:wght@500&family=Montserrat:wght@100..900&family=Pacifico&display=swap" rel="stylesheet">

{{/*  Import de flatpiker, utilisé seulement sur cette page  */}}
<script type="text/javascript">

  function copyTable(el) {
  var body = document.body,
    range,
    sel;
  if (document.createRange && window.getSelection) {
    range = document.createRange();
    sel = window.getSelection();
    sel.removeAllRanges();
    try {
      range.selectNodeContents(el);
      sel.addRange(range);
    } catch (e) {
      range.selectNode(el);
      sel.addRange(range);
    }
  } else if (body.createTextRange) {
    range = body.createTextRange();
    range.moveToElementText(el);
    range.select();
  }
  document.execCommand("Copy");
}


  function copyOrExport(format)  {
    const titles = document.querySelectorAll('span.toCopy');
    const titlesArray = [];
    if (titles.length === 0) {
      {{/*  console.error("Aucun élément avec la classe '.toCopy' n'a été trouvé.");  */}}
      return;
    }
    titles.forEach((title, index) => {
      titlesArray.push(title.textContent);
      {{/*  console.log(title.textContent);  */}}
    });

    const dates = document.querySelector('div.toCopyDate');
    if (!dates) {
      {{/*  console.error("Aucun élément avec la classe 'toCopyDate' n'a été trouvé.");  */}}
    }
    let date = ""
    if (dates) {
      date = dates.textContent
    }
    
    const tables = document.querySelectorAll('table.toCopy');
    let data = '';
  
    tables.forEach((table, index) => {
      const dataElements = table.querySelectorAll('td.toCopyTd');
      const td1Array = [];
      const td3Array = [];
  
      Array.from(dataElements).forEach((element, index) => {
        if (index % 2 === 0) {
          const td1 = element.textContent;
          const td3 =  dataElements[index + 1].textContent; // Récupère l'élément suivant dans le tableau dataElements
          td1Array.push(td1);
          td3Array.push(td3);
        }
      });
      let title = titlesArray[index];

      if (date && !/\d/.test(title) ) {
        // La variable date existe et ne contient pas de chiffres
        title += ` - ${date}`
      }

      if (format === 'md') {
        data += `## ${title}\n\n| Ingredients | Total | Ou | Acheté |\n| --- | --- | --- | --- |\n`;
        for (let i = 0; i < td1Array.length; i++) {
          data += `| ${td1Array[i]} | ${td3Array[i]} |  |  |\n`;
        }
      } else if (format === 'csv') {
        data += `${title}\n"Ingredients","Total","Ou","Acheté"\n`;
        for (let i = 0; i < td1Array.length; i++) {
          data += `"${td1Array[i]}","${td3Array[i]}",,\n`;
        }
      } else if (format === 'text') {
        data += `## ${title}\n`;
        for (let i = 0; i < td1Array.length; i++) {
          data += `${td1Array[i]} : ${td3Array[i]} → \n`;
        } 
      }  else if (format === 'html') {
        data += `<h2>${title}</h2>\n<table style="border-collapse: collapse; width: 100%;">\n<tr><th style="border: 1px solid black; width: 250px;">Ingredients</th><th style="border: 1px solid black; width: 250px;">Total</th><th style="border: 1px solid black; width: 100px;">Ou</th><th style="border: 1px solid black; width: 100px;">Acheté</th></tr>\n`;
        for (let i = 0; i < td1Array.length; i++) {
          data += `<tr><td style="border: 1px solid black; width: 250px;"><strong>${td1Array[i]}</strong></td><td style="border: 1px solid black; width: 250px; text-align: center;">${td3Array[i]}</td><td style="border: 1px solid black; width: 100px;"></td><td style="border: 1px solid black; width: 100px;"></td></tr>\n`;
        }
        data += '</table>\n';
      }
      
      if (index < tables.length - 1) {
        data += '\n';
      }
    });

    if (format === 'csv') {
      downloadFile(data, 'csv');
    } else if (format === 'md') {
      downloadFile(data, 'md');
    } else {
      var textArea = document.createElement("textarea");
      textArea.value = data;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
    }
  }
  
  {{/*  function downloadInnerHtml(filename, elId, mimeType) {
    var elHtml = document.getElementById(elId).innerHTML;
    var link = document.createElement('a');
    mimeType = mimeType || 'text/html';

    link.setAttribute('download', filename);
    link.setAttribute('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elHtml));
    link.click(); 
}  */}}

 
  function downloadFile(data, format) {
    if (format === 'csv') {
      type = "text/csv"
    } else if (format === 'md') {
      type = "text/plain"
    }
   
      // Create CSV file object and feed
      // our csv_data into it
      FileData = new Blob([data], {
        type: type
      });

      // Create to temporary link to initiate
      // download process
      let temp_link = document.createElement('a');

      // Download csv file
      if (format === 'csv') {
        temp_link.download = "listes-ingredients.csv";
      } else if (format === 'md') {
        temp_link.download = "listes-ingredients.md";
      }
      let url = window.URL.createObjectURL(FileData);
      temp_link.href = url;

      // This link should not be displayed
      temp_link.style.display = "none";
      document.body.appendChild(temp_link);

      // Automatically click the link to
      // trigger download
      temp_link.click();
      document.body.removeChild(temp_link);
  }
</script>


<script nonce="6GwL6l4yhLQddbSv2ftKfX9sTqEkpYcmwyUPm5LEdgqF6VP27IUA5SLae8ScqZ171xC7gGVVZAOuYPJnsiUAzPadx4yFkdQ7GNHa" type="module">
  flatpickr.localize(flatpickr.l10ns.fr);
  {{/*  :::VUEAPP  */}}
  const app = new Vue ({
    delimiters: ['[[', ']]'],
    el: '#app',
    data () {
      return {
        search: '',
        selected: [], {{/* USELESS ? */}}
        datesRepas: [], // liste des dates entre 1er et dernier repas : pour les date marqué event dans le date-picker
        startDate: null, // re-initialisé dans mounted().
        endDate: null,
        startDateSelected: null,
        endDateSelected: null, 
        endDateSelectedDebug: null,
        endDateAllowed: null,
        startDateMenu: false,
        endDateMenu: false,
        showAllColIngredients: false,
        {{/*  ingredientsTypesList: [{{ print $IngredientsTypesList }}],  */}}
        displayDetailsRecettes: true,
        
        
        ingredients: [
          {{- range $IngredientList -}}

          {{ $dictIngredient := dict "ingredient" .ingredient "quantite" .quantite "unit" .unit }}
          {{ $unit := .unit}}
          
          {
            ingredient: "{{ .ingredient }}",
            ingredientType: "{{ .ingType }}",

            quantite: {{- partial "functions/quantite-converter" (dict "fetchQuantite" true "ingredient" .ingredient "quantite" .quantite "unit" .unit) -}},           
            unit: "{{ partial "functions/quantite-converter" (dict "fetchUnit" true "ingredient" .ingredient "quantite" .quantite "unit" .unit) }}",
            {{ if eq $unit (and ("unité") ("c. à café") ("c. à soupe")) }}
            quantiteOrig: {{.quantite}},
            unitOrig: "{{.unit}}",
            {{ end }}
            
            recette: "{{ .recette }}",
            dateService:'{{ .dateService }}',
            horaire: "{{ .horaire }}",
            typePlat: "{{ .typePlat }}",
            assiettesRecettes: {{ .assiettesRecettes }},
            assiettes: {{ .assiettes }},
          },
          {{- end -}}
          ],

          ingFraisFiltered: [],
          totalRangeWithDetailResults: {},

          ingTypeList :{
            IngEpicesList : [],
            IngAutresList : [],
            IngLegumesList : [],
            IngSucresList : [],
            IngAnimauxList : [],
            IngLofList : [],
            IngSecList : [],
            IngFraisList : [],     
          },
        {{/*  ::: ___Print parameters  */}}
        printSelectIng: false,
        toPrint: {
          recettesSection: true,
          ingredients: true,
          {{- range $IngredientsTypesList -}}
          {{.iType}}: true,
          {{- end -}}
          {{ range $recettesList -}}
            "recetteID{{.recetteKey}}": true,
          {{ end -}}
          LegumesRanges: true,
          FraisRanges: true,
          AnimauxRanges: true,
          affichesSection: false,
          {{- range sort .Params.repas ".date_service" -}}
          {{ $dateService := .date_service | time.Format "2006-01-02" }}
          {{ $dateService = replace $dateService "-" "" }}
          "affiche{{$dateService}}{{.horaire}}": true,
          {{ end }}
        },

        printAddCol: [],
        {{/*  printAffiches: false,  */}}

        IngredientsTypesList: [{{ range $IngredientsTypesList }} {{ .iType }}, {{ end }} ],
      
        rangesDates: [], // Tableau pour stocker les tranches de dates
        daysPerRange: 3,
        fraisByRanges: false,
        legumesByRanges: false,
        animauxByRanges: false,
        
        configDPStart: {
          enableTime: false,
          dateFormat: "Y-m-d",
          altInput: true,
          altFormat: "D d M",
        },

        {{/* :::___Affiches  */}}
        fontDate: "montserrat-font",
        fontSizeDate: "font-size: 24px",
        fontHoraire: "montserrat-font",
        fontSizeHoraire: "font-size: 24px",
        fontCat: "montserrat-font",
        fontSizeCat: "font-size: 24px",
        fontRecettes: "pacifico-regular",
        fontSizeRecettes: "font-size: 32px",
        fontDesc: "noDisplay",
        fontSizeDesc: "font-size: 16px",
        fontRegimes: "pacifico-regular",
        fontSizeRegimes: "font-size: 18px",
        fontAlert: "",
        fontSizeAlert: "font-size: 14px",
        fontIng: "noDisplay",
        fontSizeIng: "font-size: 14px",

        catPageBreak: false,
        dateByPageBreak: false,
      


  } {{/* return */}}    
}, {{/* data */}}

created () {

},

{{/* :::MOUNTED */}}
mounted () {


  {{/*  TODO optim → hugo ?  */}}
  {{/*  ::: __date range  */}}
  datesRange: {
    // Trouver la première et la dernière date dans les données
    this.startDate = new Date(Math.min(
      ...this.ingredients.map(i => {
        return new Date(i.dateService);
      }),
      ),
    );
    this.endDate = new Date(Math.max(
      ...this.ingredients.map(i => {
        return new Date(i.dateService);
      }),
      ),
    );

    this.startDate = new Date(this.startDate).toISOString().substr(0, 10);
    this.endDate = new Date(this.endDate).toISOString().substr(0, 10);

    this.startDateSelected = this.startDate;
    this.endDateSelected = this.endDate
    // Derniere date autorisée dans la sélection (ne sera pas mutable puisque dans `mounted:`)
    this.endDateAllowed = this.endDateSelected;
  };
{{/*  TODO : optim : faire avec hugo  */}}
  datesRepasGen: {
    // Creer un tableau avec toutes les dateService, éliminer les doublon (Set). Défini le parametre `datesRepas` de `data()`, pour mettre en evidence les dateq où il y a des évenement dans les date-picker; TODO : est-ce encore utile maintenant que les `allowed-dates` fonctionne bien ? doublon ? Ne creer pas les date intermédiare si il y a des trou =>
    const dates = this.ingredients.map(i => {
      const datesFormat = i.dateService;
      return new Date(datesFormat).toISOString().substr(0, 10) // formatage
    });

    this.datesRepas = Array.from(new Set(dates)).sort(); 
  };

  {{/*  rangeDateEvents: {
    this.splitDateRanges(this.daysPerRange);
  };  */}}

  endDateDebugGen: {
    /* Ajoute un jour a la endDateSelected, pour que les derniers jours soit bien pris en compte par le filtre opéré dans totalsIngredientFiltered.
    Meme fonction dans watch() pour la mise a jour en fonction de la selection dans le date-picker */
    const lastDateSelected = new Date(this.endDateSelected)
    this.endDateSelectedDebug = new Date(lastDateSelected.setDate(lastDateSelected.getDate() + 1 )).toISOString().substr(0, 10);
  };

  {{/*  ::: __flatpikr  */}}
  datePickerInit: {
    const datePicker = this.datePickerReset();
  };

  {{/*  Listes des ingrédients filtré par types : utilisé par les filtres dates et search.  */}}
  ingTypeListGen:  {
    const ingredientTypes = ["Autres", "Epices", "Frais", "Legumes", "Animaux", "Sec", "Sucres", "Lof"];
    {{/*  TODO : WTF ?  */}}
    for (const i of this.ingredients) {

      if (i.unit === 'grammes' || i.unit === 'gr.') {
        i.quantite = i.quantite / 1000 ;
        i.unit = 'Kg';
      }
      else if (i.unit === 'ml') {
        i.quantite = i.quantite / 1000 ;
        i.unit = 'l.';
      }
      else if (i.unit === 'litre') {
        i.unit = 'l.';
      }

      this.ingTypeList[`Ing${i.ingredientType}List`].push(i);
    }
  };

  {{/*  initialise les listes d'ingrédients  par types  */}}


}, // mounted() end

{{/*  :::COMPUTED  */}}
computed: { 


  {{/*  :::__Total Date picker Ingredients  */}}
  filterByDatePicker: function () {
    const filtered = {};
    const endDateReal = this.DateAddDays(this.endDateSelected).toISOString().slice(0, 10);
  
    for (const [type, ingredients] of Object.entries(this.ingTypeList)) {
      filtered[type] = ingredients.filter(
        ingredient => ingredient.dateService >= this.startDateSelected && ingredient.dateService <= endDateReal
      );
    }
  
    return filtered;
  },

  computeTotalDP() {
    // Utilisé pour le tableau du total de ingredient filtré par datepicker. Renvoie les totaux des ingredients flitrés, classés par type.
    const ingFiltered = this.filterByDatePicker;
    let ingredientTotals = new Map();

    for (const [type, ingredients] of Object.entries(ingFiltered)) {
      ingredients.forEach((i) => {
        // Vérifier si l'élément existe dans ingredientTotals
        if (!ingredientTotals[type]) {
          ingredientTotals[type] = {};
        }

        let ingredientItem = ingredientTotals[type][i.ingredient];

        // Vérifier si l'élément existe dans ingredientTotals[type]
        if (!ingredientItem) {
          ingredientItem = {
            ingredient: i.ingredient,
            qTotalX:[],
            totalRecettes: 1,
            totalAssiettes: i.assiettes,
            iType: i.ingredientType
          };

          // Ajouter l'élément à ingredientTotals[type]
          ingredientTotals[type][i.ingredient] = ingredientItem;
        } else {
          // Si l'élément existe, mettre à jour les totaux
          ingredientItem.totalRecettes++;
          ingredientItem.totalAssiettes += i.assiettes;
        }

        // Vérifier si l'unité est déjà présente dans qTotalX
        const existingUnit = ingredientItem.qTotalX.find(item => item.unit === i.unit);

        if (existingUnit) {
          existingUnit.qTotal += i.quantite;
        } else {
          // Ajouter une nouvelle unité à qTotalX
          ingredientItem.qTotalX.push({
            qTotal: i.quantite,
            unit: i.unit,
          });
        }
      });
    };
    return ingredientTotals;
  },

  totalQuantitesDP () {
    const ingTotaux = this.computeTotalDP; 
    const ingDetail = this.filterByDatePicker;
    const mergedResult = new Map();
    
    for (const key in ingDetail) {
      if (ingDetail.hasOwnProperty(key) && ingTotaux.hasOwnProperty(key)) {
        mergedResult[key] = Object.assign({}, ingDetail[key], ingTotaux[key]);
      }
    }
    // Sort the sub-objects in each Ing...List based on the ingredient value
    for (const key in mergedResult) {
      if (mergedResult.hasOwnProperty(key)) {
        mergedResult[key] = Object.values(mergedResult[key]).sort((a, b) => a.ingredient.localeCompare(b.ingredient));
      }
    }

    if (this.search.length > 2) {
      return this.searchFilter(mergedResult);
    } else {
      return mergedResult;
    }
  },

  
  splitDateRanges() {
    let currentRange = [];
    this.rangesDates = [];
    const newDaysPerRange = this.daysPerRange;
    // split dates
    for (let i = 0; i < this.datesRepas.length; i++) {
      currentRange.push(this.datesRepas[i]);
      // push the current range
      if (currentRange.length >= Number(newDaysPerRange)) {
        this.rangesDates.push([...currentRange]);
        currentRange = [];
      }
    }
      // push the last range
      if (currentRange.length > 0) {
      this.rangesDates.push([...currentRange]);
    }
    return this.rangesDates;
  },



}, // computed end

{{/*  :::WATCH  */}}
watch: {

  startDateSelected: function () {
    this.filterByDatePicker;
  },

  endDateSelected: function () {
    this.filterByDatePicker;
  },

  splitDateRanges: function () {
    this.totalRangeWithDetail;
  }

},  {{/*  watch end  */}}


{{/*  :::METHODS  */}}
methods: { 
  
  {{/*  ::: __print  */}}
  printThis(el, section) {
    this.$nextTick(() => {
      let printThat = [el, section];
      Object.keys(this.toPrint).forEach((param) => {
        if (!printThat.includes(param)) {
          this.toPrint[param] = false;
        } else {
          this.toPrint[param] = true;
        }
      });
      this.$nextTick(() => {
        window.print();
      });
    });
  },

  printGlobal() {

    Object.keys(this.toPrint).forEach((param) => {
      if (!affichesSection) {this.toPrint[param] = true;}
      
      
    });
  },

  print() {
      setTimeout(() => {
        window.print();
      }, 500); 
  },

  {{/*  USELESS . C'est quoi ? Pas de reference  */}}
  updateSelectedAttribute (e) {
    let sel, i;
    sel = document.getElementById(e.target.id);
          // remove 'selected' from prior user selection
    for (i = 0; i < sel.length; i += 1) {
      sel[i].removeAttribute("selected");
    }
          // and add 'selected' to current selection
    sel[sel.selectedIndex].setAttribute("selected", "selected");
  },

  {{/*  :::__Date picker  */}}
  
  datesReset: function () {
    this.startDateSelected = this.startDate;
    this.endDateSelected = this.endDateAllowed;
    const datePickerReset = this.datePickerReset();
  },

  datePickerReset() {
    const configDPStart = {
      enableTime: false,
      dateFormat: "Y-m-d",
      altInput: true,
      altFormat: "D d M",
      defaultDate: this.startDate,
      minDate: this.startDate,
      maxDate: this.endDateAllowed,
    };
    const configDPEnd = {
      enableTime: false,
      dateFormat: "Y-m-d",
      altInput: true,
      altFormat: "D d M",
      defaultDate: this.endDateAllowed,
      minDate: this.startDate,
      maxDate: this.endDateAllowed,
    };
 
    flatpickr(datepickerStart, configDPStart);
    flatpickr(datepickerEnd, configDPEnd);   
  },

  DateAddDays(dateDebug) {
    dateDebug = new Date(dateDebug);
    dateDebug.setDate(dateDebug.getDate() + 1);
    return dateDebug;
  },

  
  {{/* ::: __calculs des totaux des ingredients  */}}


  {{/*  Totals des ingredients filtré ...  */}}

  
  {{/*  tableaux des ingredients filtrés en fonction des dates séléctionné et types  */}}
 
  totalRange(iType, start, end) {
    // BUG
    const key = `${iType}_${start}_${end}`;
    if (this.search.length > 2) {
      return this.searchFilterRange(this.totalRangeWithDetailResults[key])
    } else {
      return this.totalRangeWithDetailResults[key]
    }
  },
  
  totalRangeWithDetail(iType, start, end) {

    const key = `${iType}_${start}_${end}`;

    // Vérifiez si les données existent déjà
    if (this.totalRangeWithDetailResults[key]) {
        // Si les données existent, retournez-les directement
        return this.totalRangeWithDetailResults[key];
    }

    const totalArray = this.totalRangeArray(iType, start, end);

    
    const ingDetailList = this.ingFraisFiltered;

    const result = new Set([...ingDetailList, ...totalArray].sort((a, b) => a.ingredient.localeCompare(b.ingredient)));
    {{/*  console.log("tQWD: ", result);  */}}

    this.totalRangeWithDetailResults[key] = result;

    return result;
  },

  totalRangeArray(iType, start, end) {
    // renvoie un tableau d'objets {ingredient, unitTotal, qTotal} a partir de computeTotalRange

    const total  = this.computeTotalRange(this.filteredIngredientsRange(iType, start, end));
    
    const result = Object.entries(total).flatMap(([ingredient, values]) => {
    return values.map(({ unitTotal, qTotal, totalAssiettes }) => {
      return {
        ingredient,
        unitTotal,
        qTotal: Math.round(qTotal * 100) / 100,
        totalAssiettes
        };
      });
    });
    {{/*  console.log("tQ: ", result);  */}}
    return result;
  },

  computeTotalRange(filteredIng) {
    const totalArray = [];

    filteredIng.forEach((item) => {     
      item = this.convertUnit(item);
      
      const { ingredient, quantite, unit, assiettes, totalRecettes } = item;
  
      if (!totalArray[ingredient]) {
        totalArray[ingredient] = [];
      }
      
      const existingItem = totalArray[ingredient].find((item) => item.unitTotal === unit);
      if (existingItem) {
        existingItem.qTotal += quantite !== 0 ? quantite : 1;
        existingItem.totalAssiettes += assiettes;
        existingItem.totalRecettes += 1;
      } else {
        totalArray[ingredient].push({
          unitTotal: unit,
          qTotal: quantite !== 0 ? quantite : 1,
          totalAssiettes: assiettes,
          totalRecettes: 1,
        });
      }
    });
  
    {{/*  console.log("cTQ : ", totalArray);  */}}
    return totalArray;
  },

  filteredIngredientsRange: function (iType, start, end, allo) {
    {{/* `allo` sert au debug...  */}}
    // Récupérer la liste des ingrédients
    const ingredients = this.ingTypeList[`Ing${iType}List`];

    // Debug de la date (ajout d'un jour pour que la derniere date soit prise en compte) → si 'end' est définie, alors on envoie à DateAddDays, puis on reformate la date. 
    end  = this.DateAddDays(end).toISOString().slice(0, 10);


    // Filtrer les ingrédients selon les critères spécifiés
 
      const filtered = ingredients.filter(
        (i) =>
          i.dateService >= start &&
          i.dateService <=end 
      );
    
    this.ingFraisFiltered = filtered;
    {{/*  console.log("filtered", filtered);  */}}
    return filtered
  },

  convertUnit(item) {
    if (item.unit === 'grammes' || item.unit === 'gr.') {
      item.quantite = item.quantite / 1000 ;
      item.unit = 'Kg';
    }
    if (item.unit === 'ml') {
      item.quantite = item.quantite / 1000 ;
      item.unit = 'l.';
    }
    return item
  },
  
  round2Decimals(x) {
    return Math.round(x * 100) / 100;
  },


  {{/* :::__ search filter  */}}
  searchFilterRange(totalRange) {
    const filteredSet = new Set();
    // BUG searchRange
    // TODO : diacritique... 
    totalRange.forEach((item) => {
      // Vérifier si l'élément de l'ensemble contient la chaîne de recherche
      if (item.toString().includes(this.search)) {
        filteredSet.add(item);
      }
    });
  
    return filteredSet;
  },
  
 
  searchFilter(merge_ing_list) {
    // Utiliser pour les tableaux ingredients RangeDay. Cherche a l'interieur de chaque type...
    const filtered = {};

    for (const [type, ingredients] of Object.entries(merge_ing_list)) {
      filtered[type] = ingredients.filter(
        ingredient => ingredient.ingredient.toLowerCase().includes(this.search.toLowerCase())
      );
    }
    return filtered;
    
    
  },} {{/* fin de methods */}}
}); {{/* fin New Vue */}}

</script>




{{ end }}
