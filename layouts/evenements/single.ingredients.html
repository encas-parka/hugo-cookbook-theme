<!doctype html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Redirection vers la liste de courses</title>
    <script>
      /**
       * Extrait l'ID de l'événement depuis l'URL
       * @returns {string} L'ID de l'événement
       * @throws {Error} Si l'ID ne peut pas être extrait
       */
      function getEventId() {
        const pathname = window.location.pathname;
        const eventMatch = pathname.match(/\/evenements\/([^\/]+)/);

        if (!eventMatch) {
          throw new Error(
            "ID d'événement non trouvé dans l'URL. Format attendu : /evenements/[event-id]",
          );
        }

        return eventMatch[1];
      }

      /**
       * Redirige vers l'application Svelte avec le bon paramètre
       */
      function redirectToProductsApp() {
        try {
          const eventId = getEventId();
          const productsAppUrl = `/sv_products/?listId=${encodeURIComponent(eventId)}`;

          console.log(`Redirection vers : ${productsAppUrl}`);
          window.location.href = productsAppUrl;
        } catch (error) {
          console.error("Erreur lors de la redirection :", error.message);

          // Afficher un message d'erreur à l'utilisateur
          document.body.innerHTML = `
                    <div style="
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                        font-family: system-ui, -apple-system, sans-serif;
                        background: #f8f9fa;
                        margin: 0;
                        padding: 20px;
                    ">
                        <div style="
                            max-width: 500px;
                            background: white;
                            padding: 2rem;
                            border-radius: 8px;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                            text-align: center;
                        ">
                            <div style="
                                width: 48px;
                                height: 48px;
                                margin: 0 auto 1rem;
                                background: #dc3545;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 24px;
                            ">✕</div>

                            <h2 style="color: #dc3545; margin: 0 0 1rem 0;">Erreur de redirection</h2>
                            <p style="color: #666; margin: 0 0 1.5rem 0; line-height: 1.5;">
                                ${error.message}
                            </p>

                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <a href="/" style="
                                    display: inline-block;
                                    padding: 0.5rem 1rem;
                                    background: #007bff;
                                    color: white;
                                    text-decoration: none;
                                    border-radius: 4px;
                                    font-weight: 500;
                                ">Accueil</a>

                                <a href="/evenements/" style="
                                    display: inline-block;
                                    padding: 0.5rem 1rem;
                                    background: #6c757d;
                                    color: white;
                                    text-decoration: none;
                                    border-radius: 4px;
                                    font-weight: 500;
                                ">Événements</a>
                            </div>

                            <details style="margin-top: 2rem; text-align: left;">
                                <summary style="cursor: pointer; color: #666; font-size: 0.9rem;">
                                    Informations techniques
                                </summary>
                                <pre style="
                                    background: #f8f9fa;
                                    padding: 1rem;
                                    border-radius: 4px;
                                    font-size: 0.8rem;
                                    overflow-x: auto;
                                    margin-top: 0.5rem;
                                ">URL actuelle: ${window.location.pathname}
Message: ${error.message}</pre>
                            </details>
                        </div>
                    </div>
                `;
        }
      }

      // Rediriger immédiatement au chargement de la page
      document.addEventListener("DOMContentLoaded", redirectToProductsApp);

      // Au cas où DOMContentLoaded s'est déjà déclenché
      if (document.readyState === "loading") {
        // Sera géré par DOMContentLoaded
      } else {
        redirectToProductsApp();
      }
    </script>

    <style>
      /* Éviter le flash de contenu pendant la redirection */
      body {
        margin: 0;
        padding: 0;
        background: #f8f9fa;
      }

      /* Spinner de chargement optionnel */
      .loading-spinner {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Optionnel: Afficher un spinner pendant la redirection -->
    <div
      class="loading-spinner"
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      "
    >
      <div
        style="
          width: 40px;
          height: 40px;
          border: 3px solid #f3f3f3;
          border-top: 3px solid #007bff;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        "
      ></div>
    </div>

    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </body>
</html>
