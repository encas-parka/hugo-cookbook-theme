{{- /* Génère les options de filtres pour les recettes avec cache optimisé */ -}}
{{- $ingredientsIndex := partialCached "functions/ingredients-index.html" "ingredients-index" -}}
{{- $bySlug := $ingredientsIndex.bySlug -}}
{{- $byUUID := $ingredientsIndex.byUUID -}}

{{- /* Préparation des données optimisée avec une seule passe */ -}}
{{- $globalTypes := dict "legumes" (slice) "sec" (slice) "animaux" (slice) "lof" (slice) "sucres" (slice) "frais" (slice) "epices" (slice) "autres" (slice) -}}
{{- $iCategories := slice -}}
{{- $allRegimes := slice -}}
{{- $allSaisons := slice -}}
{{- $allTemperature := slice -}}
{{- $allCuisson := slice -}}
{{- $allCheck := slice -}}

{{- /* Clé de cache basée sur le nombre de pages et leur date de modification */ -}}
{{- $cacheKey := printf "filter-options-%s" (now.Format "20060102-1504") -}}
{{- $filterData := partialCached "functions/filter-data-builder.html" (dict
  "pages" .RegularPagesRecursive
  "byUUID" $byUUID
) $cacheKey -}}

{{- /* Extraire les données du builder */ -}}
{{- $globalTypes := $filterData.globalTypes -}}
{{- $iCategories := $filterData.categories | uniq -}}
{{- $allRegimes := $filterData.regimes | uniq -}}
{{- $allSaisons := $filterData.saisons | uniq -}}
{{- $allTemperature := $filterData.temperature | uniq -}}
{{- $allCuisson := $filterData.cuisson | uniq -}}
{{- $allCheck := $filterData.check | uniq -}}

{{- /* Préparer les listes uniques pour les filtres */ -}}
{{- $ilegumes := index $globalTypes "legumes" | uniq | sort -}}
{{- $isec := index $globalTypes "sec" | uniq | sort -}}
{{- $ianimaux := index $globalTypes "animaux" | uniq | sort -}}
{{- $ilof := index $globalTypes "lof" | uniq | sort -}}
{{- $isucre := index $globalTypes "sucres" | uniq | sort -}}
{{- $ifrais := index $globalTypes "frais" | uniq | sort -}}
{{- $iepices := index $globalTypes "epices" | uniq | sort -}}
{{- $iautres := index $globalTypes "autres" | uniq | sort -}}

{{- /* Générer les options HTML */ -}}
<div class="filters-container" style="display: none;">
  <!-- Catégories -->
  <select id="MsCategories" data-filter-type="categories">
    {{- range $iCategories -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>

  <!-- Ingrédients par type -->
  {{- if $ilegumes -}}
  <select id="MsLegume" data-filter-type="ilegumes">
    {{- range $ilegumes -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $isec -}}
  <select id="MsSec" data-filter-type="isec">
    {{- range $isec -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $ianimaux -}}
  <select id="MsAnimaux" data-filter-type="ianimaux">
    {{- range $ianimaux -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $ilof -}}
  <select id="MsLof" data-filter-type="ilof">
    {{- range $ilof -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $isucre -}}
  <select id="MsSucre" data-filter-type="isucre">
    {{- range $isucre -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $ifrais -}}
  <select id="MsFrais" data-filter-type="ifrais">
    {{- range $ifrais -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $iautres -}}
  <select id="MsAutres" data-filter-type="iautres">
    {{- range $iautres -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}

  {{- if $iepices -}}
  <select id="MsEpices" data-filter-type="iepices">
    {{- range $iepices -}}
    <option value="{{ . }}">{{ . }}</option>
    {{- end -}}
  </select>
  {{- end -}}
</div>

{{- /* Générer les données JavaScript pour les filtres */ -}}
<script>
  window.filterOptions = {
    categories: [
      {{- range $iCategories -}}
      "{{ . }}",
      {{- end -}}
    ],
    regimes: [
      {{- range $allRegimes -}}
      "{{ . }}",
      {{- end -}}
    ],
    saison: [
      {{- range $allSaisons -}}
      "{{ . }}",
      {{- end -}}
    ],
    temperature: [
      {{- range $allTemperature -}}
      "{{ . }}",
      {{- end -}}
    ],
    cuisson: [
      {{- range $allCuisson -}}
      "{{ . }}",
      {{- end -}}
    ],
    check: [
      {{- range $allCheck -}}
      "{{ . }}",
      {{- end -}}
    ],
    ilegumes: [
      {{- range $ilegumes -}}
      "{{ . }}",
      {{- end -}}
    ],
    isec: [
      {{- range $isec -}}
      "{{ . }}",
      {{- end -}}
    ],
    ianimaux: [
      {{- range $ianimaux -}}
      "{{ . }}",
      {{- end -}}
    ],
    ilof: [
      {{- range $ilof -}}
      "{{ . }}",
      {{- end -}}
    ],
    isucre: [
      {{- range $isucre -}}
      "{{ . }}",
      {{- end -}}
    ],
    ifrais: [
      {{- range $ifrais -}}
      "{{ . }}",
      {{- end -}}
    ],
    iepices: [
      {{- range $iepices -}}
      "{{ . }}",
      {{- end -}}
    ],
    iautres: [
      {{- range $iautres -}}
      "{{ . }}",
      {{- end -}}
    ]
  };
</script>