{{/* DOCUMENTATION
  Module de recherche des recettes Vue.js. Utilisé dans la home-page et dans le header (navbar)
  Il sert de point de montage pour l'application Vue.js et inclut les données des recettes.
  Lié au script dans assets/js/components/search-modules.js.
*/}}

{{/* Préparation des données pour la recherche de recettes */}}
{{- $recettesIndex := partialCached "functions/recettes-index.html" "recettes-index-global" -}}
{{- $byUUIDRecette := $recettesIndex.byUUIDRecette -}}
{{- $recipesData := slice -}}
{{- range $uuid, $meta := $byUUIDRecette -}}
  {{- $recipesData = $recipesData | append (dict
    "title" $meta.title
    "url" $meta.permalink
    "type" $meta.type
    "auteur" (default "" $meta.auteur)
    "specialite" (default "" $meta.spécialité)
    "saison" (default (slice) $meta.saison)
    "categories" (default (slice) $meta.categories)
    "regimes" (default (slice) (sort $meta.regime))
    "temperature" (default "" $meta.temperature)
    "cuisson" (default "" $meta.cuisson)
    "materiel" (default (slice) $meta.materiel)
  ) -}}
{{- end -}}
{{- $recipesJSON := $recipesData | jsonify -}}

<div id="app-search-recipes" data-recipes='{{ $recipesJSON }}'>
  <input
    type="text"
    v-model="searchRecipesInput"
    @keydown.esc="closeSearch"
    @keydown.down.prevent="selectNext"
    @keydown.up.prevent="selectPrevious"
    @keydown.enter.prevent="navigateToSelected"
    placeholder="Rechercher une recette..."
    class="form-control form-control-lg"
    id="qsearch-recipes"
    autofocus
  />

  <div v-if="searchRecipesInput.length > 2 && filteredRecipes.length > 0"
       class="search-results-container"
       ref="resultsContainer">
    <a v-for="(recipe, index) in filteredRecipes"
       :href="recipe.url"
       :key="recipe.url"
       :class="{ 'active': index === selectedIndex }"
       ref="resultLinks">
      <div class="searchCard">
        <div>
          <div>
            <span class="fs-5">[[ recipe.title ]]</span>
            <span class="fs-6 text-muted ms-3">[[ recipe.auteur ]]</span>
          </div>
          <div class="float-end mt-1">
            <span class="badge bg-red">[[ recipe.type ]]</span>
            <template v-for="categorie in recipe.categories">
              <span class="badge bg-green">[[ categorie ]]</span>
            </template>
            <span>
              <template v-for="saison in recipe.saison">
                <span class="badge bg-pink">[[ saison ]]</span>
              </template>
            </span>
            <template v-if="recipe.specialite !== ''">
              <span class="badge bg-grey">[[ recipe.specialite ]]</span>
            </template>
          </div>
        </div>
        <div>
          <template v-if="recipe.temperature === 'Chaud'">
            <span class="badge bg-orange mx-0">Servir Chaud</span>
          </template>
          <template v-if="recipe.temperature === 'Froid'">
            <span class="badge bg-blue">Servir Froid</span>
          </template>
          <template v-if="recipe.cuisson === 'Oui'">
            <span class="badge bg-orange">Avec Cuisson</span>
          </template>
          <template v-if="recipe.cuisson === 'Non'">
            <span class="badge bg-blue">Sans Cuisson</span>
          </template>
          <template v-for="regime in recipe.regimes">
            <span class="badge bg-grey me-1">[[ regime ]]</span>
          </template>
        </div>
        <template v-if="recipe.materiel && recipe.materiel.length > 0">
          <div>
            <template v-for="materiel_item in recipe.materiel">
              <span class="badge bg-grey me-1">[[ materiel_item ]]</span>
            </template>
          </div>
        </template>
      </div>
    </a>
  </div>

  <div v-if="searchRecipesInput.length > 2 && filteredRecipes.length === 0" class="text-muted mt-3 p-3">
    Aucune recette trouvée correspondant à votre recherche.
  </div>
</div>