{{/* Nouveau template simplifié - toutes les données sont déjà dans le frontmatter */}}
{{- $recipes := slice -}}
{{- range where .Site.RegularPages "Section" "recettes" -}}
  {{- if .Title -}}

    {{/* Extraire les noms des ingrédients directement depuis le frontmatter */}}
    {{- $ingredientNames := slice -}}
    {{- range .Params.ingredients -}}
      {{- $ingredientNames = $ingredientNames | append .name -}}
    {{- end -}}

    {{- $permissionWrite := .Params.permissionWrite | default slice -}}

    {{/* Build recipe object with abbreviated keys - métadonnées essentielles pour l'index */}}
    {{- $recipe := dict
      "id" .Params.id
      "title" .Title
      "draft" .Draft
      "typeR" .Params.typeR
      "categories" .Params.categories
      "regime" .Params.regime
      "cuisson" .Params.cuisson
      "auteur" .Params.auteur
      "serveHot" .Params.serveHot
      "plates" .Params.plate
      "check" .Params.check
      "publishedAt" (.Params.publishedAt | default "2025-01-01T00:00:00Z")
      "materiel" .Params.materiel
      "saison" .Params.saison
      "region" .Params.region
      "ingredients" $ingredientNames
      "permissionWrite" (.Params.permissionWrite | default (slice) )
    -}}
    {{- $recipes = $recipes | append $recipe -}}
  {{- end -}}
{{- end -}}

{{/* Generate unified JSON output */}}
{{- dict "recipes" $recipes | jsonify -}}
