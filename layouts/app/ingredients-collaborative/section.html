{{ define "main" }}

{{/* SCRIPT VUE - Charger depuis les assets */}}
{{ $vueJs := resources.Get "js/vue.global.js" }}
{{ $vueProd := resources.Get "js/vue.global.prod.js" }}
{{ $vueTableProd := resources.Get "js/vuetable.production.js" }}
{{ $vueTableDev := resources.Get "js/vuetable.development.js" }}


{{ if and $vueJs hugo.IsDevelopment }}
  <script src="{{ $vueJs.RelPermalink }}"></script>
  {{ else if and $vueProd hugo.IsProduction }}
  <script src="{{ $vueProd.RelPermalink }}"></script>
{{ else }}
  {{ warnf "Le script Vue.js n'a pas été trouvé dans js/" }}
{{ end }}

{{ if and $vueTableProd hugo.IsProduction }}
  <script src="{{ $vueTableProd.RelPermalink }}"></script>
{{ else if and $vueTableDev hugo.IsDevelopment }}
  <script src="{{ $vueTableDev.RelPermalink }}"></script>
{{ else }}
  {{ warnf "Le script vuetable n'a pas été trouvé dans js/" }}
{{ end }}

<div id="collaborativeApp">
  <!-- Template principal de l'application Vue.js -->
  <div class="container-fluid">
    {{ partial "aw_app_ingredients/app-header.html" . }} {{ partial
    "aw_app_ingredients/app-filters.html" . }}

    <!-- Sélecteur de vue -->
    {{ partial "aw_app_ingredients/view-toggle.html" . }}

    <!-- Tableau classique (vue actuelle) -->
    <div v-if="currentView === 'table'">
      {{ partial "aw_app_ingredients/ingredients-table.html" . }}
    </div>

    <!-- Vue groupée par magasin -->
    <div v-if="currentView === 'grouped'">
      {{ partial "aw_app_ingredients/tanstack-table-template.html" . }}
    </div>

    <!-- Vue cartes (à implémenter) -->
    <div v-if="currentView === 'cards'"></div>

    <!-- Vue compacte (à implémenter) -->
    <div v-if="currentView === 'compact'"></div>

    {{ partial "aw_app_ingredients/app-modals.html" . }}
  </div>



  <!-- add partial toast connexion -->

  <!-- Indicateur de chargement initial (sera masqué par Vue.js) -->
  <div class="loading-spinner" v-show="isLoading">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="mt-2">Chargement de la liste collaborative...</p>
    </div>
  </div>
</div>

<!-- CSS pour l'application collaborative -->
{{ $collaborativeCSS := resources.Get "scss/collaborative-ingredients.scss" |
css.Sass | resources.Minify | fingerprint }}
<link
  rel="stylesheet"
  href="{{ $collaborativeCSS.RelPermalink }}"
  integrity="{{ $collaborativeCSS.Data.Integrity }}"
/>


<!-- Scripts Appwrite (nécessaires pour l'application collaborative) -->
<script src="https://cdn.jsdelivr.net/npm/appwrite@18.2.0"></script>

<!-- Construction des modules JS nécessaires -->
{{ $appwriteClient := resources.Get "js/appwrite-client.js" | js.Build (dict "targetPath" "assets-bundled/appwrite-client.js" "minify" true) | fingerprint }}
{{ $collaborativeApp := resources.Get "js/collaborative-ingredients/app_aw_ingredients.js" | js.Build (dict "targetPath" "assets-bundled/collaborative-app.js" "minify" true ) | fingerprint }}

<script type="module" src="{{ $collaborativeApp.RelPermalink }}"></script>
{{ end }}
