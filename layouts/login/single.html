{{ define "main" }}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <!-- =============================================== -->
      <!--      État de chargement initial                 -->
      <!-- =============================================== -->
      <div id="loading-state" class="text-center p-5">
        <div
          class="spinner-border text-primary"
          role="status"
          style="width: 3rem; height: 3rem"
        >
          <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="mt-3">Vérification de la session...</p>
      </div>

      <!-- =============================================== -->
      <!--   Section affichée si l'utilisateur est connecté -->
      <!-- =============================================== -->
      <div id="user-logged-in" style="display: none">
        <div class="card text-center">
          <div class="card-body">
            <img src="/cover.png" alt="logo" class="mb-3" width="150px" />
            <h5 class="card-title">Bienvenue !</h5>
            <p class="card-text">
              Vous pouvez accéder à l'interface d'édition en cliquant sur le
              bouton ci-dessous.
            </p>
            <button id="logout-button" class="btn btn-secondary me-3">
              Se déconnecter
            </button>
            <a href="/sveltia/" class="btn btn-primary">Editer le site</a>
          </div>
        </div>
      </div>

      <!-- =============================================== -->
      <!-- Section affichée si l'utilisateur n'est PAS
 connecté -->
      <!-- =============================================== -->
      <div id="user-logged-out" style="display: none">
        <div class="card">
          <div class="card-body p-4">
            <div class="text-center mb-4">
              <img src="/cover.png" alt="logo" class="m-auto" width="150px" />
              <h4 class="mt-3">Accès à l'interface d'édition</h4>
            </div>

            <form id="login-form">
              <!-- Placeholder pour les messages d'erreur -->
              <div
                id="error-message"
                class="alert alert-danger"
                style="display: none"
                role="alert"
              ></div>

              <div class="mb-3">
                <label for="login-email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="login-email"
                  required
                  autocomplete="email"
                />
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label"
                  >Mot de passe</label
                >
                <input
                  type="password"
                  class="form-control"
                  id="login-password"
                  required
                  autocomplete="current-password"
                />
              </div>
              <div class="d-grid">
                <button
                  type="submit"
                  id="login-button"
                  class="btn btn-primary btn-lg"
                >
                  <span
                    class="spinner-border spinner-border-sm"
                    role="status"
                    aria-hidden="true"
                    style="display: none"
                  ></span>
                  Se connecter
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sections pour les utilisateurs non connectés -->
  <div id="logged-out-sections" style="display: none;" >
    <div class="row row-cols-lg-2 g-5 mt-5 justify-content-evenly">
    <!-- Section "Demander un accès" -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header fw-bold">Demander un accès</div>
          <div class="card-body small">
            <p>
              Si vous souhaitez participer au site, et que vous connaissez quelqu'un·e qui y est déjà inscrit·e, le mieux est de lui demander de vous inviter.
              <br>
              Sinon, remplissez ce formulaire pour recevoir une invitation, en indiquant à quelle cantine vous participez, ou les raisons pour lesquelles vous souhaitez avoir un compte.
            </p>
            <form id="access-request-form" class="contact-form">
              <!-- Emplacement pour les messages de succès/erreur -->
              <div id="form-feedback" class="mb-3"></div>

              <div class="form-group">
                <label for="contact-form-email" class="visually-hidden"
                  >Email</label
                >
                <input
                  id="contact-form-email"
                  name="Email"
                  type="email"
                  placeholder="Votre email"
                  class="form-control mb-3"
                  required
                  autocomplete="off"
                  maxlength="100"
                />

                <label for="contact-form-message" class="visually-hidden"
                  >Message</label
                >
                <textarea
                  class="form-control"
                  id="contact-form-message"
                  name="Message"
                  placeholder="Quelques mots de présentation (qui vous a parlé du site ? etc.)"
                  rows="4"
                ></textarea>

                <div class="d-flex justify-content-end mt-3">
                  <button
                    class="btn btn-info"
                    type="submit"
                    value="Submit"
                    id="Form-submit"
                  >
                    <span
                      class="spinner-border spinner-border-sm me-2"
                      role="status"
                      aria-hidden="true"
                      style="display: none"
                    ></span>
                    Envoyer la demande
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

    <!-- Section de présentation du site -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header fw-bold">À propos de ce site</div>
          <div class="card-body small">
            <p>
              Ce site est un outil collaboratif pour le partage de recettes de cuisine, principalement destiné aux collectifs cuisinant pour des événements militants et solidaires.
            </p>
            <h6>Fonctionnalités principales :</h6>
            <ul>
              <li><strong>Recettes</strong> avec calcul automatique des quantités en fonction du nombre de convives</li>
              <li><strong>Création de menus</strong> et de séries de menus pour des événements sur plusieurs jours</li>
              <li><strong>Recherche avancée</strong> de recettes par catégories, régimes spéciaux, ingrédients, etc.</li>
              <li><strong>Pages événements</strong> pour organiser les repas et calculer les listes d'ingrédients nécessaires</li>
              <li><strong>Export Pdf et impression</strong> des menus, affiches de menus, listes d'ingrédients...</li>
            </ul>
            <p>
              Le contenu est publié sous licence <strong>GPL-3.0</strong>, encourageant le partage et la réutilisation des recettes.
            </p>
            <p class="mb-0">
              <a href="https://github.com/encas-parka/hugo-cookbook-theme" target="_blank" rel="noopener">Voir le projet sur GitHub</a>
            </p>
          </div>
        </div>
    </div>
  </div>
  </div>
</div>

<!-- Script d'authentification - chargé uniquement sur la page de login, traité par ESBuild -->
{{ partial "footer/esbuild" (dict "src" "js/authAppwrite.js" "targetPath"
"authAppwrite.js" "load" "async" "transpile" false) -}} {{ end }}
