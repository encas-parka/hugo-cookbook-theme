import{H as W,t as q}from"./icons.js";import{p as M,V as f,k as p,h as c,b as g,Z as z,g as L,W as w,X as A,a2 as E,a1 as O,c as R,d as H,$ as K,v as i,q as k,m as x}from"./appwrite.js";import{M as F,a as N,b as Q,c as T}from"./index.js";var X=f('<div class="alert alert-warning alert-soft max-md:alert-vertical text-base"><!> <span> </span></div>'),Z=f('<span class="loading loading-spinner loading-xs"></span> Enregistrement...',1),j=f("<!> Enregistrer et quitter",1),B=f('<button class="btn btn-ghost">Rester</button> <button class="btn btn-error">Quitter sans sauvegarder</button> <button class="btn btn-primary"><!></button>',1),D=f("<!> <!> <!>",1);function I(C,e){let o=M(e,"isSaving",3,!1),s=M(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?");F(C,{get isOpen(){return e.isOpen},get onClose(){return e.onCancel},children:(u,t)=>{var h=D(),_=p(h);N(_,{title:"Modifications non sauvegardées",get onClose(){return e.onCancel}});var m=c(_,2);Q(m,{children:(n,y)=>{var r=X(),l=L(r);W(l,{class:"h-5 w-5"});var v=c(l,2),d=L(v);w(()=>A(d,s())),g(n,r)}});var S=c(m,2);T(S,{children:(n,y)=>{var r=B(),l=p(r);l.__click=function(...a){e.onCancel?.apply(this,a)};var v=c(l,2);v.__click=function(...a){e.onLeaveWithoutSave?.apply(this,a)};var d=c(v,2);d.__click=function(...a){e.onSaveAndLeave?.apply(this,a)};var G=L(d);{var U=a=>{var b=Z();g(a,b)},P=a=>{var b=j(),V=p(b);q(V,{class:"mr-1 h-4 w-4"}),g(a,b)};E(G,a=>{o()?a(U):a(P,!1)})}w(()=>{l.disabled=o(),v.disabled=o(),d.disabled=o()}),g(n,r)}}),g(u,h)},$$slots:{default:!0}})}z(["click"]);function ee(C,e){H(e,!0);let o=M(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?"),s=k(!1),u=k(!1),t=null;async function h(n,y){return e.shouldProtect()?(console.log(`[UnsavedChangesGuard] Navigation protégée pour ${e.routeKey}`),i(s,!0),new Promise(r=>{t=r})):!0}async function _(){i(s,!1),await e.onLeaveWithoutSave(),t&&(t(!0),t=null)}async function m(){i(u,!0);try{if(await e.onSaveAndLeave()===!1){console.log("[UnsavedChangesGuard] Sauvegarde échouée, navigation annulée");return}i(s,!1),t&&(t(!0),t=null)}catch(n){console.error("[UnsavedChangesGuard] Erreur lors de la sauvegarde:",n)}finally{i(u,!1)}}function S(){i(s,!1),t&&(t(!1),t=null)}O(()=>{const n={beforeLeave:h};return K.registerRouteGuard(e.routeKey,n)}),I(C,{get isOpen(){return x(s)},get isSaving(){return x(u)},get message(){return o()},onLeaveWithoutSave:_,onSaveAndLeave:m,onCancel:S}),R()}export{ee as U};
