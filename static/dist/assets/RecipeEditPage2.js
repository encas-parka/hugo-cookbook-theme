import{f as ra,X as sa,z as La,B as Yt,D as ia,G as la,k as Sa,I as Ia,r as qa,J as Ra,K as za,N as Ca,O as Pa,Q as na,P as Lt,T as oa,S as Ta,V as Da,W as ja,Y as Fa,Z as Oa,_ as Ua,$ as Ba,a0 as Ma,a1 as Na,b as Ha,U as $t,a2 as Qa,M as Va,a3 as Ga}from"./icons.js";import{B as rt,d as st,p as Te,z as St,H as Ke,m as e,u as Se,y as ne,A as g,v as u,I as y,g as a,h as r,P as mt,w as E,C as V,L as Pe,Q as at,R as Qe,b as d,c as it,ab as ut,x as R,e as Ge,i as ht,j as Ze,k as ke,o as t,U as me,ai as Wa,aj as Xe,ak as It,al as gt,am as Ka,K as he,an as Za,M as Je,a6 as Ja,O as da,ao as Xa,t as Ya,ap as ca,Z as $a,$ as er,aq as tr,G as pt,F as Qt,S as ar,_ as rr,ar as sr,J as ir,as as lr,at as nr,ag as or}from"./appwrite.js";import{r as Ve}from"./RecipeDataStore.svelte.js";import{g as ea}from"./products-display.js";import{M as va,a as ua,b as pa,c as fa,s as dr,f as cr}from"./index.js";import{E as vr,i as ur,M as pr}from"./tiptap-markdown.es.js";import{F as fr}from"./Fieldset.js";import{B as _r}from"./BtnGroupCheck.js";var br=u('<legend class="fieldset-legend"> </legend>'),gr=u('<button type="button" role="option"><span> </span> <!></button>'),mr=u('<div class="text-base-content/50 px-4 py-2 text-sm">Aucune option disponible</div>'),hr=u('<div id="options-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!></div>'),xr=u('<div class="badge badge-lg badge-primary gap-2"><span> </span> <button type="button" class="btn btn-ghost btn-sm hover:bg-primary-focus h-4 min-h-0 w-4 p-0"><!></button></div>'),yr=u('<div class="mt-2 flex flex-wrap gap-2"></div>'),wr=u('<div class="fieldset-label"><span class="fieldset-label-text-alt opacity-70"> </span></div>'),kr=u('<fieldset class="fieldset w-full"><!> <div class="relative"><div id="multi-select"><input type="text" class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="options-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div> <!> <!></fieldset>');function ta(l,s){st(s,!0);let o=Te(s,"options",19,()=>[]),i=Te(s,"selected",31,()=>St([])),n=Te(s,"placeholder",3,"Sélectionnez des options..."),f=Te(s,"disabled",3,!1),b=Te(s,"closeOnSelect",3,!1),q=ne(""),w=ne(!1),Q=ne(0),oe=ne(void 0),K=ne(void 0),$=Se(()=>e(q).length>0?o().filter(p=>p.toLowerCase().includes(e(q).toLowerCase())):o());Ke(()=>{e($).length>0&&e(Q)>=e($).length&&g(Q,0)});function pe(p){return i().includes(p)}function de(p){pe(p)?P(p):fe(p)}function fe(p){i().includes(p)||(i([...i(),p]),s.onChange?.(i())),g(q,""),g(Q,0),b()?z():e(K)?.focus()}function P(p){i(i().filter(D=>D!==p)),s.onChange?.(i())}function _(){if(i().length>0&&e(q)===""){const p=i()[i().length-1];P(p)}}function A(){f()||(g(w,!0),g(Q,0))}function z(){g(w,!1),g(q,""),g(Q,0)}function se(){e(w)?z():A()}function ce(p){if(!f())switch(p.key){case"ArrowDown":p.preventDefault(),e(w)?e(Q)<e($).length-1&&ut(Q):A();break;case"ArrowUp":p.preventDefault(),e(w)&&e(Q)>0&&ut(Q,-1);break;case"Enter":p.preventDefault(),e(w)&&e($).length>0?de(e($)[e(Q)]):e(w)||A();break;case"Escape":p.preventDefault(),z(),e(K)?.blur();break;case"Backspace":e(q)===""&&i().length>0&&(p.preventDefault(),_());break;case"Tab":e(w)&&z();break}}function ee(p){e(oe)&&!e(oe).contains(p.target)&&z()}Ke(()=>{if(e(w))return document.addEventListener("mousedown",ee),()=>{document.removeEventListener("mousedown",ee)}});var te=kr(),J=a(te);{var Z=p=>{var D=br(),G=a(D,!0);t(D),E(()=>R(G,s.label)),d(p,D)};y(J,p=>{s.label&&p(Z)})}var X=r(J,2),T=a(X),C=a(T);me(C),C.__keydown=ce,mt(C,p=>g(K,p),()=>e(K)),t(T);var U=r(T,2);U.__click=se;var O=a(U);{let p=Se(()=>e(w)?"rotate-180":"");ra(O,{get class(){return`h-4 w-4 transition-transform ${e(p)??""}`}})}t(U);var c=r(U,2);{var L=p=>{var D=hr(),G=a(D);{var S=F=>{var Y=Ze(),W=ke(Y);Ge(W,17,()=>e($),ht,(B,re,De,Be)=>{const Ae=Se(()=>pe(e(re)));var I=gr();Pe(I,"id",`option-${De}`),I.__click=()=>de(e(re));var Le=a(I),Ie=a(Le,!0);t(Le);var qe=r(Le,2);{var Me=_e=>{La(_e,{class:"text-success h-4 w-4"})};y(qe,_e=>{e(Ae)&&_e(Me)})}t(I),E(()=>{V(I,1,`hover:bg-base-200 flex w-full items-center justify-between gap-2 px-4 py-2 text-left hover:cursor-pointer ${De===e(Q)?"bg-base-200":""} ${e(Ae)?"bg-success/20":""}`),Pe(I,"aria-selected",e(Ae)),R(Ie,e(re))}),at("mouseenter",I,()=>g(Q,De,!0)),d(B,I)}),d(F,Y)},j=F=>{var Y=mr();d(F,Y)};y(G,F=>{e($).length>0?F(S):F(j,!1)})}t(D),d(p,D)};y(c,p=>{e(w)&&p(L)})}t(X);var M=r(X,2);{var ae=p=>{var D=yr();Ge(D,21,i,ht,(G,S)=>{var j=xr(),F=a(j),Y=a(F,!0);t(F);var W=r(F,2);W.__click=()=>P(e(S));var B=a(W);sa(B,{class:"h-3 w-3"}),t(W),t(j),E(()=>{R(Y,e(S)),W.disabled=f(),Pe(W,"aria-label",`Supprimer ${e(S)??""}`)}),d(G,j)}),t(D),d(p,D)};y(M,p=>{i().length>0&&p(ae)})}var ie=r(M,2);{var N=p=>{var D=wr(),G=a(D),S=a(G,!0);t(G),t(D),E(()=>R(S,s.helpText)),d(p,D)};y(ie,p=>{s.helpText&&p(N)})}t(te),mt(te,p=>g(oe,p),()=>e(oe)),E(()=>{V(T,1,`input flex w-full items-center gap-2 pr-10 ${f()?"input-disabled":""}`),Pe(C,"placeholder",n()),C.disabled=f(),Pe(C,"aria-expanded",e(w)),Pe(C,"aria-activedescendant",e(w)?`option-${e(Q)}`:void 0),U.disabled=f(),Pe(U,"aria-label",e(w)?"Fermer le menu":"Ouvrir le menu")}),at("focus",C,A),Qe(C,()=>e(q),p=>g(q,p)),d(l,te),it()}rt(["keydown","click"]);var Er=u('<span class="text-error"> </span>'),Ar=u('<span class="text-error text-wrap"> </span>'),Lr=u('<fieldset class="fieldset min-w-1/5"><legend class="fieldset-legend">Version</legend> <label class="input input-lg w-full"><span class="badge badge-ghost font-mono"> </span> <span class="px-1 opacity-40">-</span> <input type="text" placeholder="username" maxlength="20" class="grow font-mono text-sm"/></label> <p class="fieldset-label truncate" title="ex: &quot;économique&quot;, &quot;sans fromages&quot;, &quot;plus rapide&quot;...">ex: "économique", "sans fromages", "plus rapide"...</p> <!></fieldset>'),Sr=u('<span class="badge badge-secondary badge-lg h-full"> </span>'),Ir=u('<span class="text-error"> </span>'),qr=u('<span class="text-error"> </span>'),Rr=u('<span class="text-error"> </span>'),zr=u('<div class="fieldset-label"><span class="text-error"> </span></div>'),Cr=u('<div class="fieldset-label"><span class="text-error"> </span></div>'),Pr=u('<div class="fieldset-label"><span class="text-error"> </span></div>'),Tr=u('<label class="flex cursor-pointer items-center gap-1"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="text-sm"> </span></label>'),Dr=u('<div class="fieldset-label"><span class="text-error"> </span></div>'),jr=u('<div class="lg:col-span-1"><!></div>'),Fr=u('<div class="fieldset-label"><span class="text-error"> </span></div>'),Or=u('<p class="text-warning/70">Une recette non testée est forcément conservée en brouillon.</p>'),Ur=u(`<div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Informations générales</h2> <div class="flex flex-col gap-4"><div class="flex flex-col gap-x-10 gap-y-2"><div class="flex flex-wrap items-start gap-x-10"><fieldset class="fieldset min-w-3/5 flex-1"><legend class="fieldset-legend">Titre de la recette</legend> <label><!> <input id="recipe-title" type="text" placeholder="Ex: Houmous maison" maxlength="80" aria-describedby="title-help" aria-required="true"/></label> <div class="fieldset-label" id="title-help"><!> <span class="fieldset-label ms-auto italic"> </span></div></fieldset> <!></div> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description</legend> <input type="text" name="description" id="description" maxlength="200" placeholder="Brève description de la recette"/> <span class="fieldset-label"><span class="ms-auto italic"> </span> <!></span></fieldset></div> <div class="flex flex-wrap justify-between gap-10"><div class="flex flex-wrap gap-x-10 gap-y-2"><fieldset class="fieldset"><legend class="fieldset-legend">Nombre de couverts</legend> <label><!> <input id="recipe-plate" type="number" min="1" max="80000" aria-describedby="plate-help" aria-required="true"/></label> <div class="fieldset-label" id="plate-help"><span class="italic">Quantités indiquées pour combien ?</span> <!></div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description des quantités</legend> <label><!> <input id="recipe-quantite-desc" type="text" placeholder="Ex: '24 parts par gastro'; '2 beignets/personne' ..." maxlength="100"/></label> <div class="fieldset-label"><!> <span class="ms-auto italic"> </span></div></fieldset></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset sm:w-auto"><legend class="fieldset-legend">Type de recette</legend> <label><!> <select id="recipe-type" aria-describedby="type-help"><option disabled selected>Sélectionner un type</option><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select></label> <!></fieldset> <div class="flex-1 sm:max-w-md"><!></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend pe-4"><!> <span>Température de service</span></legend> <label><select id="recipe-servehot"><option disabled selected>--</option><option>Chaud</option><option>Froid</option></select></label> <!></fieldset> <fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend pe-4"><!> <span>Nécessite une cuisson</span></legend> <label><select id="recipe-cuisson"><option disabled selected>--</option><option>Oui</option><option>Non</option></select></label> <!></fieldset></div> <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"><fieldset class="fieldset"><legend class="fieldset-legend">Saisons</legend> <div class="flex flex-wrap gap-2"></div> <div class="fieldset-label italic">Si certains ingrédients ne se trouvent qu'à certaines saisons...</div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Spécialité</legend> <label><!> <input id="recipe-region" type="text" placeholder="Ex: Basque, Italien" maxlength="50"/></label> <!></fieldset> <!></div> <div id="recipe-check-fieldset"><div class="flex w-full flex-wrap gap-x-6 gap-y-2"><div>Avez-vous testé la recette pour le nombre de couverts indiqué ?</div> <div class="flex gap-4"><label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Oui</span></label> <label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Non</span></label></div></div> <!> <label class="flex w-full cursor-pointer gap-3"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm mt-1"/> <div class="flex flex-col"><p class="text-sm font-medium">Brouillon</p> <p class="opacity-70">Les brouillons sont visibles uniquement pour les utilisateur·ices
              inscrite, mais peuvent tout de même être ajoutés à vos événements.
              Le status "brouillon" vous permettra de retrouver facilement les
              recettes que vous n'avez pas finalisé.</p> <!></div></label></div></div></div></div>`);function Xs(l,s){st(s,!0);const o=[];let i=Te(s,"recipe",15);var n=Ur(),f=a(n),b=a(f),q=a(b);Yt(q,{class:"h-5 w-5"}),he(),t(b);var w=r(b,2),Q=a(w),oe=a(Q),K=a(oe),$=r(a(K),2),pe=a($);Yt(pe,{class:"h-4 w-4 opacity-50"});var de=r(pe,2);me(de),t($);var fe=r($,2),P=a(fe);{var _=v=>{var x=Er(),H=a(x,!0);t(x),E(()=>R(H,s.validationErrors.title)),d(v,x)};y(P,v=>{s.validationErrors.title&&v(_)})}var A=r(P,2),z=a(A);t(A),t(fe),t(K);var se=r(K,2);{var ce=v=>{var x=Ze(),H=ke(x);{var ve=He=>{const We=Se(()=>i().versionLabel.match(/^v(\d+)/)?parseInt(i().versionLabel.match(/^v(\d+)/)[1]):null);var vt=Ze(),Ft=ke(vt);{var wa=Ot=>{var Ut=Lr(),Bt=r(a(Ut),2),Mt=a(Bt),ka=a(Mt);t(Mt);var Nt=r(Mt,4);me(Nt),Nt.__input=tt=>{let Ht=tt.target.value.toLowerCase().trim();i(i().versionLabel=`v${e(We)} - ${Ht}`,!0)},t(Bt);var Ea=r(Bt,4);{var Aa=tt=>{var At=Ar(),Ht=a(At,!0);t(At),E(()=>R(Ht,s.validationErrors.versionLabel)),d(tt,At)};y(Ea,tt=>{s.validationErrors.versionLabel&&tt(Aa)})}t(Ut),E(tt=>{R(ka,`v${e(We)??""}`),Za(Nt,tt)},[()=>i().versionLabel.replace(/^v\d+\s*-\s*/,"")]),d(Ot,Ut)};y(Ft,Ot=>{e(We)&&Ot(wa)})}d(He,vt)};y(H,He=>{i().versionLabel&&He(ve)})}d(v,x)},ee=v=>{var x=Ze(),H=ke(x);{var ve=He=>{var We=Sr(),vt=a(We,!0);t(We),E(()=>R(vt,i().versionLabel)),d(He,We)};y(H,He=>{i().versionLabel&&He(ve)},!0)}d(v,x)};y(se,v=>{s.canEdit?v(ce):v(ee,!1)})}t(oe);var te=r(oe,2),J=r(a(te),2);me(J);var Z=r(J,2),X=a(Z),T=a(X);t(X);var C=r(X,2);{var U=v=>{var x=Ir(),H=a(x,!0);t(x),E(()=>R(H,s.validationErrors.description)),d(v,x)};y(C,v=>{s.validationErrors.description&&v(U)})}t(Z),t(te),t(Q);var O=r(Q,2),c=a(O),L=a(c),M=r(a(L),2),ae=a(M);ia(ae,{class:"h-4 w-4 opacity-50"});var ie=r(ae,2);me(ie),t(M);var N=r(M,2),p=r(a(N),2);{var D=v=>{var x=qr(),H=a(x,!0);t(x),E(()=>R(H,s.validationErrors.plate)),d(v,x)};y(p,v=>{s.validationErrors.plate&&v(D)})}t(N),t(L);var G=r(L,2),S=r(a(G),2),j=a(S);la(j,{class:"h-4 w-4 opacity-50"});var F=r(j,2);me(F),t(S);var Y=r(S,2),W=a(Y);{var B=v=>{var x=Rr(),H=a(x,!0);t(x),E(()=>R(H,s.validationErrors.quantite_desc)),d(v,x)};y(W,v=>{s.validationErrors.quantite_desc&&v(B)})}var re=r(W,2),De=a(re);t(re),t(Y),t(G),t(c),t(O);var Be=r(O,2),Ae=a(Be),I=r(a(Ae),2),Le=a(I);Sa(Le,{class:"h-4 w-4 opacity-50"});var Ie=r(Le,2),qe=a(Ie);qe.value=qe.__value="";var Me=r(qe),_e={},Ee=r(Me),je={},Fe=r(Ee),xe={},be=r(Fe),ue={};t(Ie),t(I);var Oe=r(I,2);{var Re=v=>{var x=zr(),H=a(x),ve=a(H,!0);t(H),t(x),E(()=>R(ve,s.validationErrors.typeR)),d(v,x)};y(Oe,v=>{s.validationErrors.typeR&&v(Re)})}t(Ae);var ye=r(Ae,2),we=a(ye);{var m=v=>{{let x=Se(()=>!s.canEdit);ta(v,{get options(){return s.recipeInfo.categories},label:"Sous-Catégories",placeholder:"Rechercher une catégorie...",get disabled(){return e(x)},closeOnSelect:!0,get selected(){return i().categories},set selected(H){i(i().categories=H,!0)}})}};y(we,v=>{s.recipeInfo&&s.recipeInfo.categories&&i().categories&&v(m)})}t(ye),t(Be);var h=r(Be,2),k=a(h),le=a(k),ge=a(le);Ia(ge,{class:"h-4 w-4"}),he(2),t(le);var ze=r(le,2),Ce=a(ze),Ue=a(Ce);Ue.value=Ue.__value="";var Ye=r(Ue);Ye.value=Ye.__value=!0;var lt=r(Ye);lt.value=lt.__value=!1,t(Ce),t(ze);var ft=r(ze,2);{var _t=v=>{var x=Cr(),H=a(x),ve=a(H,!0);t(H),t(x),E(()=>R(ve,s.validationErrors.serveHot)),d(v,x)};y(ft,v=>{s.validationErrors.serveHot&&v(_t)})}t(k);var nt=r(k,2),$e=a(nt),xt=a($e);qa(xt,{class:"h-4 w-4"}),he(2),t($e);var ot=r($e,2),dt=a(ot),ct=a(dt);ct.value=ct.__value="";var et=r(ct);et.value=et.__value=!0;var Ne=r(et);Ne.value=Ne.__value=!1,t(dt),t(ot);var bt=r(ot,2);{var qt=v=>{var x=Pr(),H=a(x),ve=a(H,!0);t(H),t(x),E(()=>R(ve,s.validationErrors.cuisson)),d(v,x)};y(bt,v=>{s.validationErrors.cuisson&&v(qt)})}t(nt),t(h);var Rt=r(h,2),zt=a(Rt),Vt=r(a(zt),2);Ge(Vt,20,()=>[{value:"printemps",label:"Printemps"},{value:"ete",label:"Été"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}],v=>v.value,(v,x)=>{var H=Tr(),ve=a(H);me(ve);var He,We=r(ve,2),vt=a(We,!0);t(We),t(H),E(()=>{ve.disabled=!s.canEdit,He!==(He=x.value)&&(ve.value=(ve.__value=x.value)??""),R(vt,x.label)}),Wa(o,[],ve,()=>(x.value,i().saison),Ft=>i(i().saison=Ft,!0)),d(v,H)}),t(Vt),he(2),t(zt);var Ct=r(zt,2),yt=r(a(Ct),2),Gt=a(yt);Ra(Gt,{class:"h-4 w-4 opacity-50"});var Pt=r(Gt,2);me(Pt),t(yt);var _a=r(yt,2);{var ba=v=>{var x=Dr(),H=a(x),ve=a(H,!0);t(H),t(x),E(()=>R(ve,s.validationErrors.region)),d(v,x)};y(_a,v=>{s.validationErrors.region&&v(ba)})}t(Ct);var ga=r(Ct,2);{var ma=v=>{var x=jr(),H=a(x);{let ve=Se(()=>!s.canEdit);ta(H,{get options(){return s.recipeInfo.materiel},label:"Matériel nécessaire",placeholder:"Rechercher du matériel...",get disabled(){return e(ve)},closeOnSelect:!0,get selected(){return i().materiel},set selected(He){i(i().materiel=He,!0)}})}t(x),d(v,x)};y(ga,v=>{i().materiel&&s.recipeInfo&&s.recipeInfo.materiel&&v(ma)})}t(Rt);var Tt=r(Rt,2),Dt=a(Tt),Wt=r(a(Dt),2),jt=a(Wt),wt=a(jt);me(wt),wt.__change=()=>i()&&i(i().check=!0,!0),he(2),t(jt);var Kt=r(jt,2),kt=a(Kt);me(kt),kt.__change=()=>i()&&i(i().check=!1,!0),he(2),t(Kt),t(Wt),t(Dt);var Zt=r(Dt,2);{var ha=v=>{var x=Fr(),H=a(x),ve=a(H,!0);t(H),t(x),E(()=>R(ve,s.validationErrors.check)),d(v,x)};y(Zt,v=>{s.validationErrors.check&&v(ha)})}var Jt=r(Zt,2),Et=a(Jt);me(Et);var Xt=r(Et,2),xa=r(a(Xt),4);{var ya=v=>{var x=Or();d(v,x)};y(xa,v=>{i().check!==!0&&v(ya)})}t(Xt),t(Jt),t(Tt),t(w),t(f),t(n),E(()=>{V($,1,`input input-lg w-full ${s.validationErrors.title?"input-error":""}`),de.disabled=!s.canEdit,R(z,`${(i().title?.length||0)??""}/80 caractères`),J.disabled=!s.canEdit,V(J,1,`input w-full ${s.validationErrors.description?"input-error":""}`),R(T,`${(i().description?.length||0)??""}/200 caractères`),V(M,1,`input ${s.validationErrors.plate?"input-error":""}`),ie.disabled=!s.canEdit,V(S,1,`input w-full min-w-lg ${s.validationErrors.quantite_desc?"input-error":""}`),F.disabled=!s.canEdit,R(De,`${(i().quantite_desc?.length||0)??""}/100 caractères`),V(I,1,`select ${s.validationErrors.typeR?"select-error":""}`),Ie.disabled=!s.canEdit,_e!==(_e=Xe.ENTREE)&&(Me.value=(Me.__value=Xe.ENTREE)??""),je!==(je=Xe.PLAT)&&(Ee.value=(Ee.__value=Xe.PLAT)??""),xe!==(xe=Xe.DESSERT)&&(Fe.value=(Fe.__value=Xe.DESSERT)??""),ue!==(ue=Xe.AUTRE)&&(be.value=(be.__value=Xe.AUTRE)??""),V(ze,1,`select w-full ${s.validationErrors.serveHot?"select-error":""}`),Ce.disabled=!s.canEdit,V(ot,1,`select w-full ${s.validationErrors.cuisson?"select-error":""}`),dt.disabled=!s.canEdit,V(yt,1,`input ${s.validationErrors.region?"input-error":""}`),Pt.disabled=!s.canEdit,V(Tt,1,` flex w-full flex-wrap space-y-6 rounded-xl border-1 p-4 ${s.validationErrors.check?"border-error":"border-base-300"}`),It(wt,i()?.check===!0),wt.disabled=!s.canEdit,It(kt,i()?.check===!1),kt.disabled=!s.canEdit,Et.disabled=!s.canEdit||i().check!==!0}),Qe(de,()=>i().title,v=>i(i().title=v,!0)),Qe(J,()=>i().description,v=>i(i().description=v,!0)),Qe(ie,()=>i().plate,v=>i(i().plate=v,!0)),Qe(F,()=>i().quantite_desc,v=>i(i().quantite_desc=v,!0)),gt(Ie,()=>i().typeR,v=>i(i().typeR=v,!0)),gt(Ce,()=>i().serveHot,v=>i(i().serveHot=v,!0)),gt(dt,()=>i().cuisson,v=>i(i().cuisson=v,!0)),Qe(Pt,()=>i().region,v=>i(i().region=v,!0)),Ka(Et,()=>i().draft,v=>i(i().draft=v,!0)),d(l,n),it()}rt(["input","change"]);var Br=u('<div class="alert alert-error max-md:alert-vertical text-sm"><!> <span> </span></div>'),Mr=u('<p class="text-error text-xs"> </p>'),Nr=u("<option> </option>"),Hr=u('<p class="text-error text-xs"> </p>'),Qr=u('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="label-text"> </span></label>'),Vr=u('<p class="text-error text-xs"> </p>'),Gr=u('<p class="text-error text-xs"> </p>'),Wr=u('<p class="text-error text-xs"> </p>'),Kr=u('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="label-text"> </span></label>'),Zr=u(`<form class="flex flex-col space-y-6"><!> <fieldset class="space-y-4"><div class="fieldset"><legend class="fieldset-legend">Nom *</legend> <label><!> <input id="ingredient-name-input" type="text" placeholder="Nom de l'ingrédient" required minlength="2" maxlength="60"/></label> <!></div> <div class="fieldset"><legend class="fieldset-legend">Type *</legend> <select><option>Sélectionner un type...</option><!></select> <!></div> <div class="fieldset"><legend class="fieldset-legend">Allergènes *</legend> <p class="text-base-content/60 mb-2 text-xs">Précisez les allergènes présents dans l'ingrédient et/ou la nature
            de l'ingrédients (ou cochez "Aucun"). Sert notamment à la
            classification des recettes comme végétarienne, sans-gluten, etc.)</p> <div class="flex flex-wrap gap-2"></div> <!></div> <div class="grid gap-4 md:grid-cols-2"><div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span>frais ? *</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Fruits et légumes frais, ou ingrédients qui se conservent au frigo</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div> <div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span>Produit surgelé ? *</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Ingrédients qui se conservent au congélateur</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div></div> <div class="fieldset"><legend class="fieldset-legend">Saisons (optionnel)</legend> <p class="text-base-content/60 mb-2 text-xs">Si l'ingrédient se trouve surtout à certaines saisons</p> <div class="flex flex-wrap gap-2"></div></div></fieldset></form>`),Jr=u('<span class="loading loading-spinner"></span>'),Xr=u(`<button type="button" class="btn btn-ghost">Annuler</button> <button type="submit" class="btn btn-primary"><!> Créer l'ingrédient</button>`,1),Yr=u("<!> <!> <!>",1);function $r(l,s){st(s,!0);let o=Te(s,"open",15,!1),i=Te(s,"initialName",3,""),n=ne(St({name:i(),type:"",allergens:[],pF:null,pS:null,saisons:[]})),f=ne(!1),b=ne(!1),q=ne(null),w=ne(St({}));const Q=[{value:"frais",label:"Produits Frais (beurre, fromage, yahourt..."},{value:"legumes",label:"Fruits et Légumes (frais, concerves, surgelés, etc."},{value:"lof",label:"LOF : Laits, oeuf, farines, huiles..."},{value:"sucres",label:"Sucrés (jus, sirop, confiture ...)"},{value:"epices",label:"Assaisonnements (épices, herbes, sauces...)"},{value:"sec",label:"Sec (riz, pâtes, lentilles...)"},{value:"animaux",label:"Viandes et Poissons"},{value:"autres",label:"Autres"}],oe=["Aucun","Produit laitier","Gluten","Crustacé","Oeuf","Poisson","Viande","Porc","Arachides","Soja","Fruits à coque","Céleri","Moutarde","Sésame","Sulfites","Lupin","Mollusque","Alcool","Vérifier emballage"],K=[{value:"printemps",label:"Printemps"},{value:"ete",label:"Eté"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}];function $(){const _={};return e(n).name.trim()||(_.name="Le nom est requis"),e(n).type.trim()||(_.type="Le type est requis"),e(n).allergens.length===0&&(_.allergens="Cochez 'Aucun' si l'ingrédient ne contient aucun allergène"),e(n).pF===null&&(_.pF="Indiquez si c'est un produit frais"),e(n).pS===null&&(_.pS="Indiquez si c'est un produit surgelé"),_}function pe(_){_==="Aucun"?e(n).allergens=["Aucun"]:(e(n).allergens=e(n).allergens.filter(A=>A!=="Aucun"),e(n).allergens.includes(_)?e(n).allergens=e(n).allergens.filter(A=>A!==_):e(n).allergens.push(_))}async function de(){if(!e(f)&&(g(b,!0),g(w,$(),!0),!(Object.keys(e(w)).length>0))){g(f,!0),g(q,null);try{const _={name:e(n).name.trim(),type:e(n).type,allergens:e(n).allergens.includes("Aucun")?[]:e(n).allergens,pF:e(n).pF===!0,pS:e(n).pS===!0,saisons:e(n).saisons.length>0?e(n).saisons:void 0},A=await Ve.addIngredient(_);Je.success(`Ingrédient "${A.n}" créé avec succès`),s.onIngredientCreated&&s.onIngredientCreated(A),fe(),o(!1)}catch(_){g(q,_ instanceof Error?_.message:"Erreur lors de la création",!0),Je.error(e(q))}finally{g(f,!1)}}}function fe(){g(n,{name:"",type:"",allergens:[],pF:null,pS:null,saisons:[]},!0),g(b,!1),g(q,null),g(w,{},!0)}function P(){o(!1),fe()}Ke(()=>{o()&&setTimeout(()=>{document.getElementById("ingredient-name-input")?.focus()},50)}),Ke(()=>{i()&&e(n).name===""&&(e(n).name=i())}),va(l,{get isOpen(){return o()},onClose:P,children:(_,A)=>{var z=Yr(),se=ke(z);ua(se,{title:"Créer un nouvel ingrédient",onClose:P});var ce=r(se,2);pa(ce,{children:(te,J)=>{var Z=Zr(),X=a(Z);{var T=m=>{var h=Br(),k=a(h);na(k,{size:18});var le=r(k,2),ge=a(le,!0);t(le),t(h),E(()=>R(ge,e(q))),d(m,h)};y(X,m=>{e(q)&&m(T)})}var C=r(X,2),U=a(C),O=r(a(U),2),c=a(O);za(c,{class:"text-base-content/50 h-5 w-5"});var L=r(c,2);me(L),t(O);var M=r(O,2);{var ae=m=>{var h=Mr(),k=a(h,!0);t(h),E(()=>R(k,e(w).name)),d(m,h)};y(M,m=>{e(b)&&e(w).name&&m(ae)})}t(U);var ie=r(U,2),N=r(a(ie),2),p=a(N);p.value=p.__value="";var D=r(p);Ge(D,17,()=>Q,m=>m.value,(m,h)=>{var k=Nr(),le=a(k,!0);t(k);var ge={};E(()=>{R(le,e(h).label),ge!==(ge=e(h).value)&&(k.value=(k.__value=e(h).value)??"")}),d(m,k)}),t(N);var G=r(N,2);{var S=m=>{var h=Hr(),k=a(h,!0);t(h),E(()=>R(k,e(w).type)),d(m,h)};y(G,m=>{e(b)&&e(w).type&&m(S)})}t(ie);var j=r(ie,2),F=r(a(j),4);Ge(F,20,()=>oe,m=>m,(m,h)=>{var k=Qr(),le=a(k);me(le),le.__change=()=>pe(h);var ge=r(le,2),ze=a(ge,!0);t(ge),t(k),E((Ce,Ue)=>{V(k,1,`label border-base-300 cursor-pointer gap-2 rounded-lg border px-3 py-1 ${Ce??""} ${e(b)&&e(w).allergens&&!e(n).allergens.length?"border-error":""}`),It(le,Ue),R(ze,h)},[()=>e(n).allergens.includes(h)?"bg-primary/20 border-primary":"bg-base-200",()=>e(n).allergens.includes(h)]),d(m,k)}),t(F);var Y=r(F,2);{var W=m=>{var h=Vr(),k=a(h,!0);t(h),E(()=>R(k,e(w).allergens)),d(m,h)};y(Y,m=>{e(b)&&e(w).allergens&&m(W)})}t(j);var B=r(j,2),re=a(B),De=a(re),Be=a(De),Ae=a(Be);Ca(Ae,{size:16,class:"opacity-50"}),he(2),t(Be),t(De);var I=r(De,4),Le=a(I);Le.__click=()=>e(n).pF=!0;var Ie=r(Le,2);Ie.__click=()=>e(n).pF=!1,t(I);var qe=r(I,2);{var Me=m=>{var h=Gr(),k=a(h,!0);t(h),E(()=>R(k,e(w).pF)),d(m,h)};y(qe,m=>{e(b)&&e(w).pF&&m(Me)})}t(re);var _e=r(re,2),Ee=a(_e),je=a(Ee),Fe=a(je);Pa(Fe,{size:16,class:"opacity-50"}),he(2),t(je),t(Ee);var xe=r(Ee,4),be=a(xe);be.__click=()=>e(n).pS=!0;var ue=r(be,2);ue.__click=()=>e(n).pS=!1,t(xe);var Oe=r(xe,2);{var Re=m=>{var h=Wr(),k=a(h,!0);t(h),E(()=>R(k,e(w).pS)),d(m,h)};y(Oe,m=>{e(b)&&e(w).pS&&m(Re)})}t(_e),t(B);var ye=r(B,2),we=r(a(ye),4);Ge(we,21,()=>K,m=>m.value,(m,h)=>{var k=Kr(),le=a(k);me(le),le.__change=Ce=>{Ce.currentTarget.checked?e(n).saisons=[...e(n).saisons,e(h).value]:e(n).saisons=e(n).saisons.filter(Ue=>Ue!==e(h).value)};var ge=r(le,2),ze=a(ge,!0);t(ge),t(k),E((Ce,Ue)=>{V(k,1,`label border-base-300 cursor-pointer gap-2 rounded-lg px-3 py-1 ${Ce??""}`),It(le,Ue),R(ze,e(h).label)},[()=>e(n).saisons.includes(e(h).value)?"bg-success/20 border-success":"bg-base-200",()=>e(n).saisons.includes(e(h).value)]),d(m,k)}),t(we),t(ye),t(C),t(Z),E(()=>{C.disabled=e(f),V(O,1,`input w-full ${e(b)&&e(w).name?"input-error":""}`),V(N,1,`select select-bordered w-full ${e(b)&&e(w).type?"select-error":""}`),V(I,1,`join w-full ${e(b)&&e(w).pF?"join-error":""}`),V(Le,1,`btn join-item flex-1 ${e(n).pF===!0?"btn-success":""}`),V(Ie,1,`btn join-item flex-1 ${e(n).pF===!1?"btn-error":""}`),V(xe,1,`join w-full ${e(b)&&e(w).pS?"join-error":""}`),V(be,1,`btn join-item flex-1 ${e(n).pS===!0?"btn-info":""}`),V(ue,1,`btn join-item flex-1 ${e(n).pS===!1?"btn-error":""}`)}),at("submit",Z,m=>{m.preventDefault(),de()}),Qe(L,()=>e(n).name,m=>e(n).name=m),gt(N,()=>e(n).type,m=>e(n).type=m),d(te,Z)}});var ee=r(ce,2);fa(ee,{children:(te,J)=>{var Z=Xr(),X=ke(Z);X.__click=P;var T=r(X,2);T.__click=de;var C=a(T);{var U=c=>{var L=Jr();d(c,L)},O=c=>{Lt(c,{size:18})};y(C,c=>{e(f)?c(U):c(O,!1)})}he(),t(T),E(()=>{X.disabled=e(f),T.disabled=e(f)}),d(te,Z)}}),d(_,z)},$$slots:{default:!0}}),it()}rt(["change","click"]);var es=u('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body p-4"><div class="flex items-center gap-3"><div class="loading loading-spinner loading-sm"></div> <span class="text-sm">Chargement des ingrédients...</span></div></div></div>'),ts=u('<div class="card bg-error/10 border-error/20 border shadow-sm"><div class="card-body p-4"><div class="text-error flex items-center gap-3"><!> <span class="text-sm"> </span></div></div></div>'),as=u('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span> <span class="text-base-content/50 text-xs"> </span></button></div>'),rs=u('<div class="text-base-content/50 px-4 py-2 text-sm">Aucun ingrédient trouvé</div> <!>',1),ss=u('<button type="button" role="option"><div class="flex-1"><span class="truncate text-sm font-medium"> </span></div></button>'),is=u('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span></button></div>'),ls=u("<!> <!>",1),ns=u('<div class="text-base-content/50 px-4 py-2 text-sm">Tapez au moins 2 caractères pour rechercher</div>'),os=u('<div id="ingredients-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!></div>'),ds=u('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center gap-2 font-bold"><!> Ajouter un ingrédient</div> <div class="mt-2"><div class="relative"><div><!> <input type="text" placeholder="Rechercher un ingrédient..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="ingredients-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div></div></div>'),cs=u('<div class="text-base-content/60 text-xs italic"> </div>'),vs=u('<div class="card bg-base-100 border-base-200 border shadow-sm"><div class="card-body p-3"><div class="flex items-start justify-between gap-3"><div class="flex-1 space-y-2"><div class="flex flex-wrap gap-2"><div class="item-start flex min-w-1/2 flex-1 justify-between"><div class="text-base font-medium"> </div> <button class="btn btn-ghost btn-sm btn-square text-error" title="Supprimer cet ingrédient"><!></button></div> <div class="flex flex-wrap gap-2"><label class="input input-sm w-44"><span class="label text-base-content/80">Quantité</span> <div class="flex items-center gap-1"><input type="number" class="text-center" min="0" step="0.1" placeholder="0"/></div></label> <label class="select select-sm w-44"><span class="label text-base-content/80">unité</span> <select class="text-center"><option>Kg</option><option>gr.</option><option>unité</option><option>l.</option><option>ml</option><option>c. à soupe</option><option>c. à café</option><option>pincées</option><option>tête·s</option><option>gousse·s</option><option>bottes</option><option>au goût</option></select></label></div> <!></div> <label class="input input-sm w-full"><span class="label">Note</span> <input type="text" placeholder="Ex: coupées en dés; pour la sauce..." maxlength="100"/></label></div></div></div></div>'),us=u('<div class="card bg-base-300 border-base-300 border shadow-sm"><div class="card-body p-2"><div class="card-title text-secondary/80 flex items-center gap-2 px-4 text-sm font-semibold"><!> <span class="badge badge-xs badge-primary badge-soft"> </span></div> <div class="space-y-3"></div></div></div>'),ps=u('<div class="space-y-4" id="recipe-ingredients-editor"><!> <!></div> <!>',1);function fs(l,s){st(s,!0);let o=Te(s,"ingredients",15),i=Te(s,"disabled",3,!1),n=ne(""),f=ne(-1),b=ne(!1),q=ne(void 0),w=ne(void 0),Q=ne(!1),oe=ne(""),K=Se(()=>e(n).length>1?Ve.searchIngredients(e(n)):[]),$=Se(()=>()=>{const c={};return o().forEach(L=>{const M=L.type||"autres";c[M]||(c[M]=[]),c[M].push(L)}),Object.keys(c).forEach(L=>{c[L].sort((M,ae)=>M.name.localeCompare(ae.name,"fr",{sensitivity:"base"}))}),c});Ke(()=>{!Ve.isInitialized&&!Ve.loading&&Ve.initialize().catch(c=>{console.error("[RecipeIngredientsEditor] Erreur lors de l'initialisation du recipeDataStore:",c)})}),Ke(()=>{e(K).length>0&&e(f)===-1?g(f,0):e(K).length===0&&g(f,-1)}),Ke(()=>{e(K).length>0&&e(f)>=e(K).length&&g(f,0)}),Ke(()=>{if(e(b)){const c=L=>{e(q)&&!e(q).contains(L.target)&&(g(b,!1),g(n,""))};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}}});function pe(c){const L=Ve.getIngredientByUuid(c);if(!L)return;const M={uuid:Xa(),name:L.n,originalQuantity:0,originalUnit:"gr.",normalizedQuantity:0,normalizedUnit:"gr.",comment:"",allergens:L.a||[],type:L.t||""};o([...o(),M]),g(n,""),g(b,!1),g(f,-1);const ae=ea(M.type).displayName;Je.success(`Ingredient ajouté dans ${ae}`)}function de(){!i()&&!Ve.loading&&!Ve.error&&(g(b,!0),g(f,0))}function fe(){g(b,!1),g(n,""),g(f,-1)}function P(){e(b)?fe():de()}function _(c){o(o().filter(L=>L.uuid!==c))}function A(c){if(!i())switch(c.key){case"ArrowDown":c.preventDefault(),e(b)?e(f)<e(K).length-1&&ut(f):de();break;case"ArrowUp":c.preventDefault(),e(b)&&e(f)>0&&ut(f,-1);break;case"Enter":c.preventDefault(),e(b)&&e(K).length>0?pe(e(K)[e(f)].u):e(b)||de();break;case"Escape":c.preventDefault(),fe(),e(w)?.blur();break;case"Tab":e(b)&&fe();break}}function z(c){if(!c.originalQuantity||c.originalQuantity<=0)return"";const L=ca.normalize(c.originalQuantity,c.originalUnit||"",c.name);return L.hasConversion?`≈ ${L.quantity} ${L.unit}`:""}function se(c){}function ce(){g(oe,e(n).trim(),!0),g(Q,!0),fe()}function ee(c){pe(c.u)}var te=ps(),J=ke(te),Z=a(J);{var X=c=>{var L=es();d(c,L)},T=c=>{var L=Ze(),M=ke(L);{var ae=N=>{var p=ts(),D=a(p),G=a(D),S=a(G);na(S,{class:"h-4 w-4"});var j=r(S,2),F=a(j);t(j),t(G),t(D),t(p),E(()=>R(F,`Erreur lors du chargement: ${Ve.error??""}`)),d(N,p)},ie=N=>{var p=ds(),D=a(p),G=a(D),S=a(G);Lt(S,{class:"text-primary h-4 w-4"}),he(),t(G);var j=r(G,2),F=a(j),Y=a(F),W=a(Y);Ta(W,{class:"h-4 w-4 opacity-50"});var B=r(W,2);me(B),B.__keydown=A,mt(B,I=>g(w,I),()=>e(w)),t(Y);var re=r(Y,2);re.__click=P;var De=a(re);{let I=Se(()=>e(b)?"rotate-180":"");ra(De,{get class(){return`h-4 w-4 transition-transform ${e(I)??""}`}})}t(re);var Be=r(re,2);{var Ae=I=>{var Le=os(),Ie=a(Le);{var qe=_e=>{var Ee=rs(),je=r(ke(Ee),2);{var Fe=xe=>{var be=as(),ue=a(be);ue.__click=()=>ce();var Oe=a(ue);Lt(Oe,{class:"h-4 w-4"});var Re=r(Oe,4),ye=a(Re);t(Re),t(ue),t(be),E(()=>{ue.disabled=i(),R(ye,`"${e(n)??""}"`)}),d(xe,be)};y(je,xe=>{e(n).trim().length>0&&xe(Fe)})}d(_e,Ee)},Me=_e=>{var Ee=Ze(),je=ke(Ee);{var Fe=be=>{var ue=ls(),Oe=ke(ue);Ge(Oe,19,()=>e(K),we=>we.u,(we,m,h)=>{var k=ss();k.__click=()=>pe(e(m).u);var le=a(k),ge=a(le),ze=a(ge,!0);t(ge),t(le),t(k),E(()=>{Pe(k,"id",`ingredient-${e(h)??""}`),V(k,1,`hover:bg-base-200 flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer ${e(h)===e(f)?"bg-base-200":""}`),Pe(k,"aria-selected",e(h)===e(f)),k.disabled=i(),R(ze,e(m).n)}),at("mouseenter",k,()=>g(f,e(h),!0)),d(we,k)});var Re=r(Oe,2);{var ye=we=>{var m=is(),h=a(m);h.__click=()=>ce();var k=a(h);Lt(k,{class:"h-4 w-4"}),he(2),t(h),t(m),E(()=>h.disabled=i()),d(we,m)};y(Re,we=>{e(n).trim().length>0&&we(ye)})}d(be,ue)},xe=be=>{var ue=Ze(),Oe=ke(ue);{var Re=ye=>{var we=ns();d(ye,we)};y(Oe,ye=>{e(n).length<=1&&ye(Re)},!0)}d(be,ue)};y(je,be=>{e(K).length>0?be(Fe):be(xe,!1)},!0)}d(_e,Ee)};y(Ie,_e=>{e(n).length>1&&e(K).length===0?_e(qe):_e(Me,!1)})}t(Le),d(I,Le)};y(Be,I=>{e(b)&&I(Ae)})}t(F),t(j),mt(j,I=>g(q,I),()=>e(q)),t(D),t(p),E(()=>{V(Y,1,`input flex w-full items-center gap-2 pr-10 ${i()?"input-disabled":""}`),B.disabled=i(),Pe(B,"aria-expanded",e(b)),Pe(B,"aria-activedescendant",e(b)?`ingredient-${e(f)}`:void 0),re.disabled=i(),Pe(re,"aria-label",e(b)?"Fermer le menu":"Ouvrir le menu")}),at("focus",B,de),Qe(B,()=>e(n),I=>g(n,I)),d(N,p)};y(M,N=>{Ve.error?N(ae):N(ie,!1)},!0)}d(c,L)};y(Z,c=>{Ve.loading?c(X):c(T,!1)})}var C=r(Z,2);{var U=c=>{var L=Ze(),M=ke(L);Ge(M,17,()=>Object.entries(e($)()),([ae,ie])=>ae,(ae,ie)=>{var N=Se(()=>Ya(e(ie),2));let p=()=>e(N)[0],D=()=>e(N)[1];const G=Se(()=>ea(p())),S=Se(()=>e(G).icon);var j=us(),F=a(j),Y=a(F),W=a(Y);Ja(W,()=>e(S),(Ae,I)=>{I(Ae,{class:"h-4 w-4"})});var B=r(W),re=r(B),De=a(re,!0);t(re),t(Y);var Be=r(Y,2);Ge(Be,21,D,ht,(Ae,I,Le)=>{const Ie=Se(()=>z(e(I)));var qe=vs(),Me=a(qe),_e=a(Me),Ee=a(_e),je=a(Ee),Fe=a(je),xe=a(Fe),be=a(xe,!0);t(xe);var ue=r(xe,2);ue.__click=()=>_(e(I).uuid);var Oe=a(ue);oa(Oe,{class:"h-4 w-4"}),t(ue),t(Fe);var Re=r(Fe,2),ye=a(Re),we=r(a(ye),2),m=a(we);me(m),t(we),t(ye);var h=r(ye,2),k=r(a(h),2);k.__change=()=>{e(I).originalUnit==="au goût"&&(e(I).originalQuantity=1)};var le=a(k);le.value=le.__value="kg";var ge=r(le);ge.value=ge.__value="gr.";var ze=r(ge);ze.value=ze.__value="unité";var Ce=r(ze);Ce.value=Ce.__value="l.";var Ue=r(Ce);Ue.value=Ue.__value="ml";var Ye=r(Ue);Ye.value=Ye.__value="c. à soupe";var lt=r(Ye);lt.value=lt.__value="c. à café";var ft=r(lt);ft.value=ft.__value="pincées";var _t=r(ft);_t.value=_t.__value="tête·s";var nt=r(_t);nt.value=nt.__value="gousse·s";var $e=r(nt);$e.value=$e.__value="bottes";var xt=r($e);xt.value=xt.__value="au goût",t(k),t(h),t(Re);var ot=r(Re,2);{var dt=Ne=>{var bt=cs(),qt=a(bt,!0);t(bt),E(()=>R(qt,e(Ie))),d(Ne,bt)};y(ot,Ne=>{e(Ie)&&Ne(dt)})}t(je);var ct=r(je,2),et=r(a(ct),2);me(et),t(ct),t(Ee),t(_e),t(Me),t(qe),E(()=>{R(be,e(I).name),ue.disabled=i(),m.disabled=e(I).originalUnit==="au goût",k.disabled=i(),et.disabled=i()}),at("blur",m,()=>(e(I),void 0)),Qe(m,()=>e(I).originalQuantity,Ne=>e(I).originalQuantity=Ne),at("blur",k,()=>(e(I),void 0)),gt(k,()=>e(I).originalUnit,Ne=>e(I).originalUnit=Ne),Qe(et,()=>e(I).comment,Ne=>e(I).comment=Ne),da(3,qe,()=>dr),d(Ae,qe)}),t(Be),t(F),t(j),E(()=>{R(B,` ${e(G).displayName??""} `),R(De,D().length)}),d(ae,j)}),d(c,L)};y(C,c=>{o().length>0&&c(U)})}t(J);var O=r(J,2);$r(O,{get initialName(){return e(oe)},onIngredientCreated:ee,get open(){return e(Q)},set open(c){g(Q,c,!0)}}),d(l,te),it()}rt(["keydown","click","change"]);var _s=u('<label class="label"><span class="label-text font-medium"> </span></label>'),bs=u('<div class="border-base-200 bg-base-200 flex flex-wrap items-center gap-1 border-b p-1"><button type="button" title="Gras"><!></button> <button type="button" title="Italique"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" title="Liste à puces"><!></button> <button type="button" title="Liste ordonnée"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Annuler"><!></button> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Rétablir"><!></button></div>'),gs=u('<div class="label"><span class="text-error"> </span></div>'),ms=u('<div class=" w-full"><!> <div><!> <div></div></div> <!></div>');function aa(l,s){st(s,!0);let o=Te(s,"value",15);Te(s,"placeholder",3,"Commencez à rédiger...");let i=ne(null),n=ne(null),f=ne(0),b=ne(!1);$a(()=>{e(i)&&g(n,new vr({element:e(i),extensions:[ur.configure({codeBlock:!1,blockquote:!1}),pr.configure({html:!1,tightLists:!0})],content:o(),editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[150px] p-4"}},onUpdate:({editor:_})=>{const A=_.storage.markdown.getMarkdown();o()!==A&&o(A)},onSelectionUpdate:()=>{ut(f)},onTransaction:()=>{ut(f)},onFocus:()=>g(b,!0),onBlur:()=>g(b,!1)}),!0)}),er(()=>{e(n)&&e(n).destroy()});var q=ms(),w=a(q);{var Q=_=>{var A=_s(),z=a(A),se=a(z,!0);t(z),t(A),E(()=>{Pe(A,"for",s.id),R(se,s.label)}),d(_,A)};y(w,_=>{s.label&&_(Q)})}var oe=r(w,2);let K;var $=a(oe);{var pe=_=>{var A=bs(),z=a(A);let se;z.__click=()=>e(n).chain().focus().toggleBold().run();var ce=a(z);Da(ce,{class:"h-4 w-4"}),t(z);var ee=r(z,2);let te;ee.__click=()=>e(n).chain().focus().toggleItalic().run();var J=a(ee);ja(J,{class:"h-4 w-4"}),t(ee);var Z=r(ee,4);let X;Z.__click=()=>e(n).chain().focus().toggleBulletList().run();var T=a(Z);Fa(T,{class:"h-4 w-4"}),t(Z);var C=r(Z,2);let U;C.__click=()=>e(n).chain().focus().toggleOrderedList().run();var O=a(C);Oa(O,{class:"h-4 w-4"}),t(C);var c=r(C,4);c.__click=()=>e(n).chain().focus().undo().run();var L=a(c);Ua(L,{class:"h-4 w-4"}),t(c);var M=r(c,2);M.__click=()=>e(n).chain().focus().redo().run();var ae=a(M);Ba(ae,{class:"h-4 w-4"}),t(M),t(A),E((ie,N,p,D,G,S)=>{se=V(z,1,"btn btn-ghost btn-square btn-sm",null,se,ie),te=V(ee,1,"btn btn-ghost btn-square btn-sm",null,te,N),X=V(Z,1,"btn btn-ghost btn-square btn-sm",null,X,p),U=V(C,1,"btn btn-ghost btn-square btn-sm",null,U,D),c.disabled=G,M.disabled=S},[()=>({"btn-active":e(f)>=0&&e(n).isActive("bold")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("italic")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("bulletList")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("orderedList")}),()=>!(e(f)>=0&&e(n).can().undo()),()=>!(e(f)>=0&&e(n).can().redo())]),d(_,A)};y($,_=>{e(n)&&_(pe)})}var de=r($,2);mt(de,_=>g(i,_),()=>e(i)),t(oe);var fe=r(oe,2);{var P=_=>{var A=gs(),z=a(A),se=a(z,!0);t(z),t(A),E(()=>R(se,s.error)),d(_,A)};y(fe,_=>{s.error&&_(P)})}t(q),E(()=>{K=V(oe,1,"bg-base-100 overflow-hidden rounded-lg border-2 transition-all",null,K,{"border-primary":e(b),"border-error":s.error,"border-base-300":!e(b)&&!s.error}),Pe(de,"id",s.id)}),d(l,q),it()}rt(["click"]);var hs=u('<div class="alert alert-error mt-4"><span class="text-sm"> </span></div>'),xs=u('<p class="py-2 text-sm italic opacity-50">Aucune astuce ajoutée</p>'),ys=u('<span class="text-error text-xs"> </span>'),ws=u("<span></span>"),ks=u(`<div class="flex flex-col gap-1"><div class="flex items-start gap-2"><div class="flex-1"><textarea placeholder="Ex: Ajouter un filet d'huile d'olive au moment de servir" maxlength="250"></textarea></div> <button type="button" class="btn btn-square btn-sm text-error" title="Supprimer l'astuce"><!></button></div> <div class="flex justify-between px-1"><!> <span> </span></div></div>`),Es=u('<div class="space-y-3"></div>'),As=u(`<div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><div class="card-body"><h2 class="card-title mb-4"><!> Ingrédients</h2> <!> <!></div></div> <div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Préparation</h2> <div class="space-y-6"><!> <div><!> <p class="text-end text-xs italic opacity-60">La préparation à l'avance sera mise en évidence au dessus des autres
            étapes.</p></div></div> <div class="divider"></div> <div class="space-y-4"><div class="flex items-center justify-between"><h3 class="flex items-center gap-2 font-semibold"><!> Astuces et conseils</h3> <button type="button" class="btn btn-outline btn-primary btn-sm">+ Ajouter une astuce</button></div> <!></div></div></div></div>`);function Ys(l,s){st(s,!0);let o=Te(s,"recipe",15);var i=As(),n=a(i),f=a(n),b=a(f),q=a(b);ia(q,{class:"h-5 w-4"}),he(),t(b);var w=r(b,2);{let T=Se(()=>!s.canEdit);fs(w,{get disabled(){return e(T)},get ingredients(){return o().ingredients},set ingredients(C){o(o().ingredients=C,!0)}})}var Q=r(w,2);{var oe=T=>{var C=hs(),U=a(C),O=a(U,!0);t(U),t(C),E(()=>R(O,s.validationErrors.ingredients)),d(T,C)};y(Q,T=>{s.validationErrors.ingredients&&o().ingredients.length===0&&T(oe)})}t(f),t(n);var K=r(n,2),$=a(K),pe=a($),de=a(pe);la(de,{class:"h-5 w-4"}),he(),t(pe);var fe=r(pe,2),P=a(fe);aa(P,{id:"recipe-preparation",label:"Instructions de préparation",get error(){return s.validationErrors.preparation},placeholder:"Décrivez les étapes de préparation...",get value(){return o().preparation},set value(T){o(o().preparation=T,!0)}});var _=r(P,2),A=a(_);aa(A,{id:"recipe-preparation24h",label:"Préparation à l'avance (optionnel)",get error(){return s.validationErrors.preparation24h},placeholder:"Étapes à réaliser avant le jour j...",get value(){return o().preparation24h},set value(T){o(o().preparation24h=T,!0)}}),he(2),t(_),t(fe);var z=r(fe,4),se=a(z),ce=a(se),ee=a(ce);Ma(ee,{class:"text-warning h-4 w-4"}),he(),t(ce);var te=r(ce,2);te.__click=()=>{o(o().astuces=[...o().astuces,{astuce:""}],!0)},t(se);var J=r(se,2);{var Z=T=>{var C=xs();d(T,C)},X=T=>{var C=Es();Ge(C,21,()=>o().astuces,ht,(U,O,c)=>{var L=ks(),M=a(L),ae=a(M),ie=a(ae);tr(ie),t(ae);var N=r(ae,2);N.__click=()=>{o(o().astuces=o().astuces.filter((W,B)=>B!==c),!0)};var p=a(N);oa(p,{size:14}),t(N),t(M);var D=r(M,2),G=a(D);{var S=W=>{var B=ys(),re=a(B,!0);t(B),E(()=>R(re,s.validationErrors.astuces[c])),d(W,B)},j=W=>{var B=ws();d(W,B)};y(G,W=>{s.validationErrors.astuces?.[c]?W(S):W(j,!1)})}var F=r(G,2),Y=a(F);t(F),t(D),t(L),E(()=>{ie.disabled=!s.canEdit,V(ie,1,`textarea textarea-bordered h-20 w-full text-sm ${s.validationErrors.astuces?.[c]?"textarea-error":""}`),N.disabled=!s.canEdit,V(F,1,`text-xs ${e(O).astuce.length>250?"text-error font-bold":"opacity-50"}`),R(Y,`${e(O).astuce.length??""} / 250`)}),Qe(ie,()=>e(O).astuce,W=>e(O).astuce=W),d(U,L)}),t(C),d(T,C)};y(J,T=>{o().astuces.length===0?T(Z):T(X,!1)})}t(z),t($),t(K),t(i),E(()=>{V(n,1,`card bg-base-100 shadow-xl ${s.validationErrors.ingredients?"ring-error ring-2":""}`),te.disabled=!s.canEdit}),d(l,i),it()}rt(["click"]);var Ls=u('<button class="btn btn-circle btn-xs btn-error btn-ghost ms-2" title="Retirer les droits"><!></button>'),Ss=u('<div class="badge badge-lg badge-soft gap-2 p-4"><span> </span> <!></div>'),Is=u('<button class="btn btn-primary btn-sm btn-outline ms-4" title="Gérer les collaborateurs"><!> Ajouter des contributeur·ices</button>'),qs=u(`<div class="space-y-4"><div class="alert alert-info alert-soft border-info/20 max-md:alert-vertical text-xs"><!> <span>Par défaut, seul l'auteur·ice peut modifier la recette. Les autres
        utilisateur·ices peuvent la consulter ou la dupliquer pour créer leur
        propre version. Ajoutez des collaborateur·ices ici pour leur donner
        explicitement le droit de modifier cette version originale.</span></div> <div class="flex flex-wrap gap-2"><div class="badge badge-lg badge-soft badge-info gap-2 p-4"><!> <span> </span> <div class="badge badge-xs">Auteur</div></div> <!> <!></div></div>`),Rs=u('<span class="loading loading-spinner loading-xs"></span>'),zs=u('<p class="text-error mt-2 flex items-center gap-1 text-xs"><!> </p>'),Cs=u('<p class="text-xs opacity-60">Sélectionnez des membres de vos équipes pour les ajouter :</p> <div class="max-h-48 overflow-y-auto pr-2"><!></div>',1),Ps=u(`<p class="py-4 text-center text-sm italic opacity-40">Vous n'avez pas encore d'équipe créée.</p>`),Ts=u('<p class="py-4 text-center text-sm italic opacity-40">Tous les membres de vos équipes sont déjà ajoutés.</p>'),Ds=u('<div class="space-y-6"><fieldset class="fieldset"><legend class="fieldset-legend">Ajouter par email</legend> <div class="flex gap-2"><label class="input input-bordered flex grow items-center gap-2"><!> <input type="email" class="grow" placeholder="utilisateur@email.com"/></label> <button class="btn btn-primary"><!></button></div> <!></fieldset> <div class="divider text-xs font-bold tracking-widest uppercase opacity-50">Ou via vos équipes</div> <div class="space-y-4"><!></div></div>'),js=u('<button class="btn btn-block btn-primary">Terminer</button>'),Fs=u("<!> <!> <!>",1),Os=u("<!> <!>",1);function $s(l,s){st(s,!0);let o=Te(s,"permissionWrite",15),i=ne(!1),n=ne(""),f=ne(!1),b=ne(null),q=St({});Ke(()=>{s.createdBy===pt.userId&&(q[s.createdBy]=pt.userName||"Propriétaire");for(const P of Qt.teams)if(P.members)for(const _ of P.members)_.name&&!q[_.id]&&(q[_.id]=_.name)});let w=Se(()=>{const P=[];for(const _ of Qt.teams)if(_.members)for(const A of _.members)A.id!==s.createdBy&&(P.some(z=>z.id===A.id)||P.push({id:A.id,label:A.name,selected:!1}));return P});async function Q(){if(!e(n))return;const P=e(n).trim();g(f,!0),g(b,null);try{const{checkUserEmails:_}=await rr(async()=>{const{checkUserEmails:se}=await import("./appwrite.js").then(ce=>ce.b4);return{checkUserEmails:se}},[]),z=(await _([P]))[P];z?o()?.includes(z.id)?g(b,"Cet utilisateur a déjà les droits d'écriture."):(o([...o()||[],z.id]),q[z.id]=z.name||P,g(n,""),Je.success(`Permission d'édition ajouté pour ${z.name||P}`)):g(b,"Utilisateur introuvable. Seuls les utilisateur·ices inscrit sur enka-cookbook peuvent être ajouté·es. Vous pouvez invitez des personnes depuis votre dashboard")}catch(_){console.error("Erreur check email:",_),g(b,"Erreur lors de la vérification de l'email.")}finally{g(f,!1)}}function oe(P){o()?.includes(P)?o((o()||[]).filter(_=>_!==P)):o([...o()||[],P])}function K(P){P!==s.createdBy&&o((o()||[]).filter(_=>_!==P))}function $(){g(i,!1),g(n,""),g(b,null)}var pe=Os(),de=ke(pe);fr(de,{get iconComponent(){return $t},legend:"Permissions",children:(P,_)=>{var A=qs(),z=a(A),se=a(z);Na(se,{size:16}),he(2),t(z);var ce=r(z,2),ee=a(ce),te=a(ee);Ha(te,{size:14});var J=r(te,2),Z=a(J,!0);t(J),he(2),t(ee);var X=r(ee,2);Ge(X,17,()=>(o()||[]).filter(U=>s.createdBy!==void 0&&U!==s.createdBy),ht,(U,O)=>{var c=Ss(),L=a(c),M=a(L,!0);t(L);var ae=r(L,2);{var ie=N=>{var p=Ls();p.__click=()=>K(e(O));var D=a(p);sa(D,{size:16}),t(p),d(N,p)};y(ae,N=>{s.canEdit&&N(ie)})}t(c),E(()=>R(M,q[e(O)]||e(O))),da(3,c,()=>cr,()=>({duration:200})),d(U,c)});var T=r(X,2);{var C=U=>{var O=Is();O.__click=()=>g(i,!0);var c=a(O);Qa(c,{size:18}),he(),t(O),d(U,O)};y(T,U=>{s.canEdit&&U(C)})}t(ce),t(A),E(()=>R(Z,s.createdBy&&q[s.createdBy]||"Propriétaire")),d(P,A)},$$slots:{default:!0}});var fe=r(de,2);va(fe,{get isOpen(){return e(i)},onClose:$,children:(P,_)=>{var A=Fs(),z=ke(A);ua(z,{title:"Gérer les collaborateurs",onClose:$,children:(ee,te)=>{$t(ee,{class:"text-primary"})},$$slots:{default:!0}});var se=r(z,2);pa(se,{children:(ee,te)=>{var J=Ds(),Z=a(J),X=r(a(Z),2),T=a(X),C=a(T);Va(C,{class:"opacity-40",size:18});var U=r(C,2);me(U),U.__keydown=S=>S.key==="Enter"&&Q(),t(T);var O=r(T,2);O.__click=Q;var c=a(O);{var L=S=>{var j=Rs();d(S,j)},M=S=>{var j=ar("Ajouter");d(S,j)};y(c,S=>{e(f)?S(L):S(M,!1)})}t(O),t(X);var ae=r(X,2);{var ie=S=>{var j=zs(),F=a(j);Ga(F,{size:14});var Y=r(F);t(j),E(()=>R(Y,` ${e(b)??""}`)),d(S,j)};y(ae,S=>{e(b)&&S(ie)})}t(Z);var N=r(Z,4),p=a(N);{var D=S=>{var j=Cs(),F=r(ke(j),2),Y=a(F);_r(Y,{get items(){return e(w)},onToggleItem:oe,size:"sm"}),t(F),d(S,j)},G=S=>{var j=Ze(),F=ke(j);{var Y=B=>{var re=Ps();d(B,re)},W=B=>{var re=Ts();d(B,re)};y(F,B=>{Qt.teams.length===0?B(Y):B(W,!1)},!0)}d(S,j)};y(p,S=>{e(w).length>0?S(D):S(G,!1)})}t(N),t(J),E(()=>O.disabled=e(f)||!e(n)),Qe(U,()=>e(n),S=>g(n,S)),d(ee,J)}});var ce=r(se,2);fa(ce,{children:(ee,te)=>{var J=js();J.__click=$,d(ee,J)}}),d(P,A)},$$slots:{default:!0}}),d(l,pe),it()}rt(["click","keydown"]);const Us=["title","description","plate","preparation","preparation24h","cuisson","serveHot","typeR","categories","regime","saison","ingredients","quantite_desc","auteur","astuces","prepAlt","check","draft","permissionWrite","materiel","region","rootRecipeId","versionLabel","manuallyAddedVariants","variantsToRemove"];function ei(){return{title:"",plate:100,ingredients:[],preparation:"",materiel:[],preparation24h:"",astuces:[],categories:[],saison:[],typeR:"",cuisson:"",serveHot:"",regime:[],description:"",quantite_desc:"",region:"",prepAlt:[],check:null,draft:!0,lockedBy:null,auteur:null,publishedAt:null,createdBy:pt.userId||"",permissionWrite:[pt.userId||""],teams:null,status:sr.PUBLIC,rootRecipeId:null,versionLabel:null,manuallyAddedVariants:[],variantsToRemove:[]}}function ti(l,s={}){return{...l,...s,categories:l.categories||[],saison:l.saison||[],ingredients:l.ingredients??[],astuces:l.astuces??[],prepAlt:l.prepAlt||[],materiel:l.materiel||[],regime:l.regime||[],check:l.check??null}}function ai(l){const s={};return Us.forEach(o=>{s[o]=l[o]}),JSON.stringify(s)}function ri(l){return{title:l.title,plate:l.plate,preparation:l.preparation,cuisson:l.cuisson===""?!1:l.cuisson,serveHot:l.serveHot===""?!0:l.serveHot,check:l.check??!1,typeR:l.typeR,permissionWrite:l.permissionWrite&&l.permissionWrite.length>0?l.permissionWrite:[pt.userId],draft:l.draft??!0,categories:l.categories||[],regime:l.regime||[],saison:l.saison||[],materiel:l.materiel||[],quantite_desc:l.quantite_desc||null,description:l.description||null,region:l.region||null,auteur:l.auteur||null,preparation24h:l.preparation24h||null,teams:l.teams||null,status:l.status||"private",ingredients:[],astuces:null,prepAlt:null,lockedBy:null,publishedAt:null,rootRecipeId:l.rootRecipeId||null,versionLabel:l.versionLabel||null}}function si(l,s,o){const i={...s,ingredients:l.ingredients,id:o.id,createdAt:o.createdAt,updatedAt:o.updatedAt,createdBy:o.createdBy};return delete i.$id,delete i.$createdAt,delete i.$updatedAt,i}function Bs(l){if(!l.originalQuantity||l.originalQuantity<=0)return{...l,normalizedQuantity:0,normalizedUnit:l.originalUnit||"gr."};const s=ca.normalize(l.originalQuantity,l.originalUnit||"",l.name);return{...l,normalizedQuantity:s.quantity,normalizedUnit:s.unit}}function Ms(l){return l.map(s=>Bs(s))}function Ns(l){const s=new lr;let o=!1;l.forEach(f=>{f.allergens&&f.allergens.length>0&&f.allergens.forEach(b=>s.add(b)),f.type==="animaux"&&(o=!0)});const i=Array.from(s);(i.includes("Viande")||i.includes("Poisson")||i.includes("Crustacé")||i.includes("Mollusque")||i.includes("Porc"))&&(o=!0);const n=[];return!o&&!i.includes("Produit laitier")&&!i.includes("Oeuf")?n.push("vegan"):o||n.push("vegetarien"),i.includes("Gluten")||n.push("sans-gluten"),i.includes("Produit laitier")||n.push("sans-lactose"),{regimes:n}}function ii(l,s){if(!l)return!1;s.value={};let o=!1;if(!l.title?.trim())s.value.title="Le titre est obligatoire",o=!0;else if(l.title.length>100)s.value.title="Le titre ne peut pas dépasser 100 caractères",o=!0;else if(!/^[a-zA-Z0-9\s\-àâäéèêëïîôùûüçÀÂÄÉÈÊËÏÎÔÙÛÜÇ]+$/.test(l.title.trim()))s.value.title="Le titre ne peut contenir que des lettres, chiffres, espaces et tirets",o=!0;else{const n=l.title.trim().toLowerCase(),f=l.versionLabel?.trim().toLowerCase()||"";ir.recipesIndex.find(q=>{const w=q.title.trim().toLowerCase()===n,Q=q.versionLabel?.trim().toLowerCase()||"";return w&&f===Q&&q.$id!==l.$id})&&(s.value.title=l.versionLabel?"Une recette avec ce nom et cette version existe déjà":"Une recette porte déjà ce nom (sans version)",o=!0)}if(l.versionLabel&&(/^[a-zA-Z0-9\s\-]+$/.test(l.versionLabel.trim())||(s.value.versionLabel="La version ne peut contenir que des caractères alphanumériques, des espaces et des tirets",o=!0)),l.typeR||(s.value.typeR="Le type de recette est obligatoire",o=!0),(l.cuisson===null||l.cuisson===void 0)&&(s.value.cuisson="Veuillez spécifier si une cuisson est nécessaire",o=!0),(l.serveHot===null||l.serveHot===void 0)&&(s.value.serveHot="Veuillez spécifier la température de service",o=!0),!l.plate||l.plate<1?(s.value.plate="Le nombre de couverts doit être d'au moins 1",o=!0):l.plate>1e4&&(s.value.plate="Le nombre de couverts ne peut pas dépasser 10 000",o=!0),l.quantite_desc&&l.quantite_desc.length>100&&(s.value.quantite_desc="La description des quantités ne peut pas dépasser 100 caractères",o=!0),l.description&&l.description.length>200&&(s.value.description="La description ne peut pas dépasser 200 caractères",o=!0),l.region&&l.region.length>50&&(s.value.region="La spécialité ne peut pas dépasser 50 caractères",o=!0),(!l.ingredients||l.ingredients.length===0)&&(s.value.ingredients="Au moins un ingrédient est requis",o=!0),l.preparation?.trim()?l.preparation.length>15e3&&(s.value.preparation="La préparation ne peut pas dépasser 15 000 caractères",o=!0):(s.value.preparation="La préparation est obligatoire",o=!0),l.preparation24h&&l.preparation24h.length>15e3&&(s.value.preparation24h="La préparation 24h ne peut pas dépasser 15 000 caractères",o=!0),(l.check===null||l.check===void 0)&&(s.value.check="Veuillez indiquer si la recette a été testée",o=!0),l.astuces&&l.astuces.length>0){const n=[];l.astuces.forEach((f,b)=>{f.astuce.length>250&&(n[b]="Maximum 250 caractères",o=!0)}),n.length>0&&(s.value.astuces=n)}o&&(Je.error("Veuillez corriger les champs invalides",{autoCloseDelay:5e3}),setTimeout(()=>{const n=Object.keys(s.value)[0],b={title:"recipe-title",typeR:"recipe-type",cuisson:"recipe-cuisson",serveHot:"recipe-servehot",plate:"recipe-plate",quantite_desc:"recipe-quantite-desc",description:"description",region:"recipe-region",check:"recipe-check-fieldset",ingredients:"recipe-ingredients-editor",preparation:"recipe-preparation",preparation24h:"recipe-preparation24h"}[n];if(b){const q=document.getElementById(b);q&&(q.scrollIntoView({behavior:"smooth",block:"center"}),(q.tagName==="INPUT"||q.tagName==="SELECT"||q.tagName==="TEXTAREA")&&q.focus())}},100)),l.title=l.title.trim().charAt(0).toUpperCase()+l.title.trim().slice(1).toLowerCase(),l.ingredients=Ms(l.ingredients);const{regimes:i}=Ns(l.ingredients);return l.regime=i,!o}async function li(l,s){const o=Je.loading("Suppression de la recette...");try{await nr(l);try{await or("delete_recipe",l,pt.userId||"",{},!0)}catch(i){console.warn("Sync GitHub échouée lors de la suppression:",i)}s&&await s(),Je.update(o,{state:"success",message:"Recette supprimée avec succès"})}catch(i){throw console.error("Erreur suppression:",i),Je.update(o,{state:"error",message:"Erreur lors de la suppression"}),i}finally{setTimeout(()=>Je.dismiss(o),3e3)}}export{Xs as R,ai as a,Ys as b,ei as c,$s as d,Ns as e,li as f,ri as n,si as p,ti as t,ii as v};
