var Cc=Object.defineProperty;var Nc=Object.getPrototypeOf;var kc=Reflect.get;var gi=t=>{throw TypeError(t)};var qc=(t,e,n)=>e in t?Cc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var k=(t,e,n)=>qc(t,typeof e!="symbol"?e+"":e,n),wo=(t,e,n)=>e.has(t)||gi("Cannot "+n);var a=(t,e,n)=>(wo(t,e,"read from private field"),n?n.call(t):e.get(t)),v=(t,e,n)=>e.has(t)?gi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),_=(t,e,n,s)=>(wo(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n),S=(t,e,n)=>(wo(t,e,"access private method"),n);var yi=(t,e,n)=>kc(Nc(t),n,e);var cr=Array.isArray,jc=Array.prototype.indexOf,Jo=Array.from,$o=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,la=Object.getOwnPropertyDescriptors,ua=Object.prototype,Lc=Array.prototype,to=Object.getPrototypeOf,wi=Object.isExtensible;function Nn(t){return typeof t=="function"}const nn=()=>{};function Uc(t){return t()}function Mo(t){for(var e=0;e<t.length;e++)t[e]()}function da(){var t,e,n=new Promise((s,r)=>{t=s,e=r});return{promise:n,resolve:t,reject:e}}function Df(t,e,n=!1){return t===void 0?n?e():e:t}function $f(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const n=[];for(const s of t)if(n.push(s),n.length===e)break;return n}const Se=2,Ko=4,no=8,Xt=16,St=32,Zt=64,Yo=128,je=256,Br=512,de=1024,Ue=2048,Ft=4096,We=8192,Sn=16384,so=32768,en=65536,vi=1<<17,xc=1<<18,_n=1<<19,fa=1<<20,Co=1<<21,ro=1<<22,wn=1<<23,at=Symbol("$state"),pa=Symbol("legacy props"),Bc=Symbol(""),ps=new class extends Error{constructor(){super(...arguments);k(this,"name","StaleReactionError");k(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function ha(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Hc(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function zc(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Oc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Wc(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Gc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Vc(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Qc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Jc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Kc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Yc(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const oo=1,io=2,ma=4,Xc=8,Zc=16,Fc=1,el=2,tl=4,nl=8,sl=16,rl=1,ol=2,il=4,al=1,cl=2,re=Symbol(),ll="http://www.w3.org/1999/xhtml",ul="http://www.w3.org/2000/svg",dl="@attach";function fl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function pl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let hl=!1;function ga(t){return t===this.v}function ya(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function ml(t,e){return t!==e}function wa(t){return!ya(t,this.v)}let Fn=!1;function Cf(){Fn=!0}const gl=[];function Er(t,e=!1,n=!1){return Pr(t,new Map,"",gl,null,n)}function Pr(t,e,n,s,r=null,o=!1){if(typeof t=="object"&&t!==null){var i=e.get(t);if(i!==void 0)return i;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(cr(t)){var c=Array(t.length);e.set(t,c),r!==null&&e.set(r,c);for(var l=0;l<t.length;l+=1){var u=t[l];l in t&&(c[l]=Pr(u,e,n,s,null,o))}return c}if(to(t)===ua){c={},e.set(t,c),r!==null&&e.set(r,c);for(var d in t)c[d]=Pr(t[d],e,n,s,null,o);return c}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!o)return Pr(t.toJSON(),e,n,s,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let ee=null;function Kn(t){ee=t}function yl(t,e=!1,n){ee={p:ee,c:null,e:null,s:t,x:null,l:Fn&&!e?{s:null,u:null,$:[]}:null}}function wl(t){var e=ee,n=e.e;if(n!==null){e.e=null;for(var s of n)ka(s)}return ee=e.p,{}}function es(){return!Fn||ee!==null&&ee.l===null}let on=[];function va(){var t=on;on=[],Mo(t)}function Ve(t){if(on.length===0&&!hs){var e=on;queueMicrotask(()=>{e===on&&va()})}on.push(t)}function vl(){for(;on.length>0;)va()}const bl=new WeakMap;function ba(t){var e=O;if(e===null)return G.f|=wn,t;if((e.f&so)===0){if((e.f&Yo)===0)throw!e.parent&&t instanceof Error&&Ia(t),t;e.b.error(t)}else Yn(t,e)}function Yn(t,e){for(;e!==null;){if((e.f&Yo)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&Ia(t),t}function Ia(t){const e=bl.get(t);e&&($o(t,"message",{value:e.message}),$o(t,"stack",{value:e.stack}))}const Sr=new Set;let J=null,Dr=null,No=new Set,rt=[],ao=null,ko=!1,hs=!1;var Ln,Un,cn,bs,xn,Bn,ln,Hn,Is,Es,Le,qo,$r,jo;const kn=class kn{constructor(){v(this,Le);k(this,"current",new Map);v(this,Ln,new Map);v(this,Un,new Set);v(this,cn,0);v(this,bs,null);v(this,xn,[]);v(this,Bn,[]);v(this,ln,[]);v(this,Hn,[]);v(this,Is,[]);v(this,Es,[]);k(this,"skipped_effects",new Set)}process(e){rt=[],Dr=null;var n=kn.apply(this);for(const o of e)S(this,Le,qo).call(this,o);if(a(this,cn)===0){S(this,Le,jo).call(this);var s=a(this,Bn),r=a(this,ln);_(this,Bn,[]),_(this,ln,[]),_(this,Hn,[]),Dr=this,J=null,bi(s),bi(r),Dr=null,a(this,bs)?.resolve()}else S(this,Le,$r).call(this,a(this,Bn)),S(this,Le,$r).call(this,a(this,ln)),S(this,Le,$r).call(this,a(this,Hn));n();for(const o of a(this,xn))ys(o);_(this,xn,[])}capture(e,n){a(this,Ln).has(e)||a(this,Ln).set(e,n),this.current.set(e,e.v)}activate(){J=this}deactivate(){J=null}flush(){if(rt.length>0){if(this.activate(),Ea(),J!==null&&J!==this)return}else a(this,cn)===0&&S(this,Le,jo).call(this);this.deactivate();for(const e of No)if(No.delete(e),e(),J!==null)break}increment(){_(this,cn,a(this,cn)+1)}decrement(){_(this,cn,a(this,cn)-1);for(const e of a(this,Is))he(e,Ue),bn(e);for(const e of a(this,Es))he(e,Ft),bn(e);this.flush()}add_callback(e){a(this,Un).add(e)}settled(){return(a(this,bs)??_(this,bs,da())).promise}static ensure(){if(J===null){const e=J=new kn;Sr.add(J),hs||kn.enqueue(()=>{J===e&&e.flush()})}return J}static enqueue(e){Ve(e)}static apply(e){return nn}};Ln=new WeakMap,Un=new WeakMap,cn=new WeakMap,bs=new WeakMap,xn=new WeakMap,Bn=new WeakMap,ln=new WeakMap,Hn=new WeakMap,Is=new WeakMap,Es=new WeakMap,Le=new WeakSet,qo=function(e){e.f^=de;for(var n=e.first;n!==null;){var s=n.f,r=(s&(St|Zt))!==0,o=r&&(s&de)!==0,i=o||(s&We)!==0||this.skipped_effects.has(n);if(!i&&n.fn!==null){r?n.f^=de:(s&Ko)!==0?a(this,ln).push(n):(s&de)===0&&((s&ro)!==0&&n.b?.is_pending()?a(this,xn).push(n):po(n)&&((n.f&Xt)!==0&&a(this,Hn).push(n),ys(n)));var c=n.first;if(c!==null){n=c;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}},$r=function(e){for(const n of e)((n.f&Ue)!==0?a(this,Is):a(this,Es)).push(n),he(n,de);e.length=0},jo=function(){var e;for(const n of a(this,Un))n();if(a(this,Un).clear(),Sr.size>1){a(this,Ln).clear();let n=!0;for(const s of Sr){if(s===this){n=!1;continue}for(const[r,o]of this.current){if(s.current.has(r))if(n)s.current.set(r,o);else continue;Sa(r)}if(rt.length>0){J=s;const r=kn.apply(s);for(const o of rt)S(e=s,Le,qo).call(e,o);rt=[],r()}}J=null}Sr.delete(this)};let ot=kn;function Il(t){var e=hs;hs=!0;try{for(var n;;){if(vl(),rt.length===0&&(J?.flush(),rt.length===0))return ao=null,n;Ea()}}finally{hs=e}}function Ea(){var t=qn;ko=!0;try{var e=0;for(_i(!0);rt.length>0;){var n=ot.ensure();if(e++>1e3){var s,r;El()}n.process(rt),Qt.clear()}}finally{ko=!1,_i(t),ao=null}}function El(){try{Gc()}catch(t){Yn(t,ao)}}let sn=null;function bi(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var s=t[n++];if((s.f&(Sn|We))===0&&po(s)&&(sn=[],ys(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null&&s.ac===null?Ua(s):s.fn=null),sn?.length>0)){Qt.clear();for(const r of sn)ys(r);sn=[]}}sn=null}}function Sa(t){if(t.reactions!==null)for(const e of t.reactions){const n=e.f;(n&Se)!==0?Sa(e):(n&(ro|Xt))!==0&&(he(e,Ue),bn(e))}}function bn(t){for(var e=ao=t;e.parent!==null;){e=e.parent;var n=e.f;if(ko&&e===O&&(n&Xt)!==0)return;if((n&(Zt|St))!==0){if((n&de)===0)return;e.f^=de}}rt.push(e)}function Xo(t){let e=0,n=It(0),s;return()=>{Ul()&&(f(n),fr(()=>(e===0&&(s=At(()=>t(()=>Me(n)))),e+=1,()=>{Ve(()=>{e-=1,e===0&&(s?.(),s=void 0,Me(n))})})))}}var Sl=en|_n|Yo;function _l(t,e,n){new Rl(t,e,n)}var xe,ke,Qo,Xe,un,Ze,qe,ye,Fe,Mt,dn,Ct,fn,Nt,Vr,Qr,me,Al,Tl,Mr,Cr,Lo;class Rl{constructor(e,n,s){v(this,me);k(this,"parent");v(this,xe,!1);v(this,ke);v(this,Qo,null);v(this,Xe);v(this,un);v(this,Ze);v(this,qe,null);v(this,ye,null);v(this,Fe,null);v(this,Mt,null);v(this,dn,0);v(this,Ct,0);v(this,fn,!1);v(this,Nt,null);v(this,Vr,()=>{a(this,Nt)&&Xn(a(this,Nt),a(this,dn))});v(this,Qr,Xo(()=>(_(this,Nt,It(a(this,dn))),()=>{_(this,Nt,null)})));_(this,ke,e),_(this,Xe,n),_(this,un,s),this.parent=O.b,_(this,xe,!!a(this,Xe).pending),_(this,Ze,Rt(()=>{O.b=this;{try{_(this,qe,ae(()=>s(a(this,ke))))}catch(r){this.error(r)}a(this,Ct)>0?S(this,me,Cr).call(this):_(this,xe,!1)}},Sl))}is_pending(){return a(this,xe)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!a(this,Xe).pending}update_pending_count(e){S(this,me,Lo).call(this,e),_(this,dn,a(this,dn)+e),No.add(a(this,Vr))}get_effect_pending(){return a(this,Qr).call(this),f(a(this,Nt))}error(e){var n=a(this,Xe).onerror;let s=a(this,Xe).failed;if(a(this,fn)||!n&&!s)throw e;a(this,qe)&&(ie(a(this,qe)),_(this,qe,null)),a(this,ye)&&(ie(a(this,ye)),_(this,ye,null)),a(this,Fe)&&(ie(a(this,Fe)),_(this,Fe,null));var r=!1,o=!1;const i=()=>{if(r){pl();return}r=!0,o&&Yc(),ot.ensure(),_(this,dn,0),a(this,Fe)!==null&&vt(a(this,Fe),()=>{_(this,Fe,null)}),_(this,xe,this.has_pending_snippet()),_(this,qe,S(this,me,Mr).call(this,()=>(_(this,fn,!1),ae(()=>a(this,un).call(this,a(this,ke)))))),a(this,Ct)>0?S(this,me,Cr).call(this):_(this,xe,!1)};var c=G;try{Ee(null),o=!0,n?.(e,i),o=!1}catch(l){Yn(l,a(this,Ze)&&a(this,Ze).parent)}finally{Ee(c)}s&&Ve(()=>{_(this,Fe,S(this,me,Mr).call(this,()=>{_(this,fn,!0);try{return ae(()=>{s(a(this,ke),()=>e,()=>i)})}catch(l){return Yn(l,a(this,Ze).parent),null}finally{_(this,fn,!1)}}))})}}xe=new WeakMap,ke=new WeakMap,Qo=new WeakMap,Xe=new WeakMap,un=new WeakMap,Ze=new WeakMap,qe=new WeakMap,ye=new WeakMap,Fe=new WeakMap,Mt=new WeakMap,dn=new WeakMap,Ct=new WeakMap,fn=new WeakMap,Nt=new WeakMap,Vr=new WeakMap,Qr=new WeakMap,me=new WeakSet,Al=function(){try{_(this,qe,ae(()=>a(this,un).call(this,a(this,ke))))}catch(e){this.error(e)}_(this,xe,!1)},Tl=function(){const e=a(this,Xe).pending;e&&(_(this,ye,ae(()=>e(a(this,ke)))),ot.enqueue(()=>{_(this,qe,S(this,me,Mr).call(this,()=>(ot.ensure(),ae(()=>a(this,un).call(this,a(this,ke)))))),a(this,Ct)>0?S(this,me,Cr).call(this):(vt(a(this,ye),()=>{_(this,ye,null)}),_(this,xe,!1))}))},Mr=function(e){var n=O,s=G,r=ee;lt(a(this,Ze)),Ee(a(this,Ze)),Kn(a(this,Ze).ctx);try{return e()}catch(o){return ba(o),null}finally{lt(n),Ee(s),Kn(r)}},Cr=function(){const e=a(this,Xe).pending;a(this,qe)!==null&&(_(this,Mt,document.createDocumentFragment()),Pl(a(this,qe),a(this,Mt))),a(this,ye)===null&&_(this,ye,ae(()=>e(a(this,ke))))},Lo=function(e){var n;if(!this.has_pending_snippet()){this.parent&&S(n=this.parent,me,Lo).call(n,e);return}_(this,Ct,a(this,Ct)+e),a(this,Ct)===0&&(_(this,xe,!1),a(this,ye)&&vt(a(this,ye),()=>{_(this,ye,null)}),a(this,Mt)&&(a(this,ke).before(a(this,Mt)),_(this,Mt,null)),Ve(()=>{ot.ensure().flush()}))};function Pl(t,e){for(var n=t.nodes_start,s=t.nodes_end;n!==null;){var r=n===s?null:ur(n);e.append(n),n=r}}function _a(t,e,n){const s=es()?lr:Zo;if(e.length===0){n(t.map(s));return}var r=J,o=O,i=Dl();Promise.all(e.map(c=>$l(c))).then(c=>{i();try{n([...t.map(s),...c])}catch(l){(o.f&Sn)===0&&Yn(l,o)}r?.deactivate(),Ra()}).catch(c=>{Yn(c,o)})}function Dl(){var t=O,e=G,n=ee,s=J;return function(){lt(t),Ee(e),Kn(n),s?.activate()}}function Ra(){lt(null),Ee(null),Kn(null)}function lr(t){var e=Se|Ue,n=G!==null&&(G.f&Se)!==0?G:null;return O===null||n!==null&&(n.f&je)!==0?e|=je:O.f|=_n,{ctx:ee,deps:null,effects:null,equals:ga,f:e,fn:t,reactions:null,rv:0,v:re,wv:0,parent:n??O,ac:null}}function $l(t,e){let n=O;n===null&&Hc();var s=n.b,r=void 0,o=It(re),i=!G,c=new Map;return zl(()=>{var l=da();r=l.promise;try{Promise.resolve(t()).then(l.resolve,l.reject)}catch(h){l.reject(h)}var u=J,d=s.is_pending();i&&(s.update_pending_count(1),d||(u.increment(),c.get(u)?.reject(ps),c.set(u,l)));const p=(h,m=void 0)=>{d||u.activate(),m?m!==ps&&(o.f|=wn,Xn(o,m)):((o.f&wn)!==0&&(o.f^=wn),Xn(o,h)),i&&(s.update_pending_count(-1),d||u.decrement()),Ra()};l.promise.then(p,h=>p(null,h||"unknown"))}),uo(()=>{for(const l of c.values())l.reject(ps)}),new Promise(l=>{function u(d){function p(){d===r?l(o):u(r)}d.then(p,p)}u(r)})}function Y(t){const e=lr(t);return Ha(e),e}function Zo(t){const e=lr(t);return e.equals=wa,e}function Aa(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)ie(e[n])}}function Ml(t){for(var e=t.parent;e!==null;){if((e.f&Se)===0)return e;e=e.parent}return null}function Fo(t){var e,n=O;lt(Ml(t));try{Aa(t),e=Ga(t)}finally{lt(n)}return e}function Ta(t){var e=Fo(t);if(t.equals(e)||(t.v=e,t.wv=Oa()),!Rn){var n=(Wt||(t.f&je)!==0)&&t.deps!==null?Ft:de;he(t,n)}}const Qt=new Map;function It(t,e){var n={f:0,v:t,reactions:null,equals:ga,rv:0,wv:0};return n}function D(t,e){const n=It(t);return Ha(n),n}function Cl(t,e=!1,n=!0){var r;const s=It(t);return e||(s.equals=wa),Fn&&n&&ee!==null&&ee.l!==null&&((r=ee.l).s??(r.s=[])).push(s),s}function g(t,e,n=!1){G!==null&&(!ze||(G.f&vi)!==0)&&es()&&(G.f&(Se|Xt|ro|vi))!==0&&!bt?.includes(t)&&Kc();let s=n?oe(e):e;return Xn(t,s)}function Xn(t,e){if(!t.equals(e)){var n=t.v;Rn?Qt.set(t,e):Qt.set(t,n),t.v=e;var s=ot.ensure();s.capture(t,n),(t.f&Se)!==0&&((t.f&Ue)!==0&&Fo(t),he(t,(t.f&je)===0?de:Ft)),t.wv=Oa(),Pa(t,Ue),es()&&O!==null&&(O.f&de)!==0&&(O.f&(St|Zt))===0&&(Ne===null?Gl([t]):Ne.push(t))}return e}function Nf(t,e=1){var n=f(t),s=e===1?n++:n--;return g(t,n),s}function Me(t){g(t,t.v+1)}function Pa(t,e){var n=t.reactions;if(n!==null)for(var s=es(),r=n.length,o=0;o<r;o++){var i=n[o],c=i.f;if(!(!s&&i===O)){var l=(c&Ue)===0;l&&he(i,e),(c&Se)!==0?Pa(i,Ft):l&&((c&Xt)!==0&&sn!==null&&sn.push(i),bn(i))}}}function oe(t){if(typeof t!="object"||t===null||at in t)return t;const e=to(t);if(e!==ua&&e!==Lc)return t;var n=new Map,s=cr(t),r=D(0),o=Ge,i=c=>{if(Ge===o)return c();var l=G,u=Ge;Ee(null),Ai(o);var d=c();return Ee(l),Ai(u),d};return s&&n.set("length",D(t.length)),new Proxy(t,{defineProperty(c,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Qc();var d=n.get(l);return d===void 0?d=i(()=>{var p=D(u.value);return n.set(l,p),p}):g(d,u.value,!0),!0},deleteProperty(c,l){var u=n.get(l);if(u===void 0){if(l in c){const d=i(()=>D(re));n.set(l,d),Me(r)}}else g(u,re),Me(r);return!0},get(c,l,u){if(l===at)return t;var d=n.get(l),p=l in c;if(d===void 0&&(!p||Vt(c,l)?.writable)&&(d=i(()=>{var m=oe(p?c[l]:re),y=D(m);return y}),n.set(l,d)),d!==void 0){var h=f(d);return h===re?void 0:h}return Reflect.get(c,l,u)},getOwnPropertyDescriptor(c,l){var u=Reflect.getOwnPropertyDescriptor(c,l);if(u&&"value"in u){var d=n.get(l);d&&(u.value=f(d))}else if(u===void 0){var p=n.get(l),h=p?.v;if(p!==void 0&&h!==re)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return u},has(c,l){if(l===at)return!0;var u=n.get(l),d=u!==void 0&&u.v!==re||Reflect.has(c,l);if(u!==void 0||O!==null&&(!d||Vt(c,l)?.writable)){u===void 0&&(u=i(()=>{var h=d?oe(c[l]):re,m=D(h);return m}),n.set(l,u));var p=f(u);if(p===re)return!1}return d},set(c,l,u,d){var p=n.get(l),h=l in c;if(s&&l==="length")for(var m=u;m<p.v;m+=1){var y=n.get(m+"");y!==void 0?g(y,re):m in c&&(y=i(()=>D(re)),n.set(m+"",y))}if(p===void 0)(!h||Vt(c,l)?.writable)&&(p=i(()=>D(void 0)),g(p,oe(u)),n.set(l,p));else{h=p.v!==re;var I=i(()=>oe(u));g(p,I)}var E=Reflect.getOwnPropertyDescriptor(c,l);if(E?.set&&E.set.call(d,u),!h){if(s&&typeof l=="string"){var A=n.get("length"),T=Number(l);Number.isInteger(T)&&T>=A.v&&g(A,T+1)}Me(r)}return!0},ownKeys(c){f(r);var l=Reflect.ownKeys(c).filter(p=>{var h=n.get(p);return h===void 0||h.v!==re});for(var[u,d]of n)d.v!==re&&!(u in c)&&l.push(u);return l},setPrototypeOf(){Jc()}})}function Ii(t){try{if(t!==null&&typeof t=="object"&&at in t)return t[at]}catch{}return t}function Da(t,e){return Object.is(Ii(t),Ii(e))}var Ei,$a,Ma,Ca;function Nl(){if(Ei===void 0){Ei=window,$a=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Ma=Vt(e,"firstChild").get,Ca=Vt(e,"nextSibling").get,wi(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),wi(n)&&(n.__t=void 0)}}function _t(t=""){return document.createTextNode(t)}function it(t){return Ma.call(t)}function ur(t){return Ca.call(t)}function kf(t,e){return it(t)}function qf(t,e=!1){{var n=it(t);return n instanceof Comment&&n.data===""?ur(n):n}}function jf(t,e=1,n=!1){let s=t;for(;e--;)s=ur(s);return s}function kl(t){t.textContent=""}function co(){return!1}function ql(t,e){if(e){const n=document.body;t.autofocus=!0,Ve(()=>{document.activeElement===n&&t.focus()})}}let Si=!1;function jl(){Si||(Si=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function ts(t){var e=G,n=O;Ee(null),lt(null);try{return t()}finally{Ee(e),lt(n)}}function lo(t,e,n,s=n){t.addEventListener(e,()=>ts(n));const r=t.__on_r;r?t.__on_r=()=>{r(),s(!0)}:t.__on_r=()=>s(!0),jl()}function Na(t){O===null&&G===null&&Wc(),G!==null&&(G.f&je)!==0&&O===null&&Oc(),Rn&&zc()}function Ll(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Qe(t,e,n,s=!0){var r=O;r!==null&&(r.f&We)!==0&&(t|=We);var o={ctx:ee,deps:null,nodes_start:null,nodes_end:null,f:t|Ue,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{ys(o),o.f|=so}catch(l){throw ie(o),l}else e!==null&&bn(o);if(s){var i=o;if(n&&i.deps===null&&i.teardown===null&&i.nodes_start===null&&i.first===i.last&&(i.f&_n)===0&&(i=i.first),i!==null&&(i.parent=r,r!==null&&Ll(i,r),G!==null&&(G.f&Se)!==0&&(t&Zt)===0)){var c=G;(c.effects??(c.effects=[])).push(i)}}return o}function Ul(){return G!==null&&!ze}function uo(t){const e=Qe(no,null,!1);return he(e,de),e.teardown=t,e}function Hr(t){Na();var e=O.f,n=!G&&(e&St)!==0&&(e&so)===0;if(n){var s=ee;(s.e??(s.e=[])).push(t)}else return ka(t)}function ka(t){return Qe(Ko|fa,t,!1)}function xl(t){return Na(),Qe(no|fa,t,!0)}function Bl(t){ot.ensure();const e=Qe(Zt|_n,t,!0);return()=>{ie(e)}}function Hl(t){ot.ensure();const e=Qe(Zt|_n,t,!0);return(n={})=>new Promise(s=>{n.outro?vt(e,()=>{ie(e),s(void 0)}):(ie(e),s(void 0))})}function dr(t){return Qe(Ko,t,!1)}function zl(t){return Qe(ro|_n,t,!0)}function fr(t,e=0){return Qe(no|e,t,!0)}function Ol(t,e=[],n=[]){_a(e,n,s=>{Qe(no,()=>t(...s.map(f)),!0)})}function Rt(t,e=0){var n=Qe(Xt|e,t,!0);return n}function ae(t,e=!0){return Qe(St|_n,t,!0,e)}function qa(t){var e=t.teardown;if(e!==null){const n=Rn,s=G;Ri(!0),Ee(null);try{e.call(null)}finally{Ri(n),Ee(s)}}}function ja(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const r=n.ac;r!==null&&ts(()=>{r.abort(ps)});var s=n.next;(n.f&Zt)!==0?n.parent=null:ie(n,e),n=s}}function Wl(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&St)===0&&ie(e),e=n}}function ie(t,e=!0){var n=!1;(e||(t.f&xc)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(La(t.nodes_start,t.nodes_end),n=!0),ja(t,e&&!n),zr(t,0),he(t,Sn);var s=t.transitions;if(s!==null)for(const o of s)o.stop();qa(t);var r=t.parent;r!==null&&r.first!==null&&Ua(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function La(t,e){for(;t!==null;){var n=t===e?null:ur(t);t.remove(),t=n}}function Ua(t){var e=t.parent,n=t.prev,s=t.next;n!==null&&(n.next=s),s!==null&&(s.prev=n),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=n))}function vt(t,e){var n=[];ei(t,n,!0),xa(n,()=>{ie(t),e&&e()})}function xa(t,e){var n=t.length;if(n>0){var s=()=>--n||e();for(var r of t)r.out(s)}else e()}function ei(t,e,n){if((t.f&We)===0){if(t.f^=We,t.transitions!==null)for(const i of t.transitions)(i.is_global||n)&&e.push(i);for(var s=t.first;s!==null;){var r=s.next,o=(s.f&en)!==0||(s.f&St)!==0;ei(s,e,o?n:!1),s=r}}}function fo(t){Ba(t,!0)}function Ba(t,e){if((t.f&We)!==0){t.f^=We,(t.f&de)===0&&(he(t,Ue),bn(t));for(var n=t.first;n!==null;){var s=n.next,r=(n.f&en)!==0||(n.f&St)!==0;Ba(n,r?e:!1),n=s}if(t.transitions!==null)for(const o of t.transitions)(o.is_global||e)&&o.in()}}let qn=!1;function _i(t){qn=t}let Rn=!1;function Ri(t){Rn=t}let G=null,ze=!1;function Ee(t){G=t}let O=null;function lt(t){O=t}let bt=null;function Ha(t){G!==null&&(bt===null?bt=[t]:bt.push(t))}let pe=null,Re=0,Ne=null;function Gl(t){Ne=t}let za=1,gs=0,Ge=gs;function Ai(t){Ge=t}let Wt=!1;function Oa(){return++za}function po(t){var e=t.f;if((e&Ue)!==0)return!0;if((e&Ft)!==0){var n=t.deps,s=(e&je)!==0;if(n!==null){var r,o,i=(e&Br)!==0,c=s&&O!==null&&!Wt,l=n.length;if((i||c)&&(O===null||(O.f&Sn)===0)){var u=t,d=u.parent;for(r=0;r<l;r++)o=n[r],(i||!o?.reactions?.includes(u))&&(o.reactions??(o.reactions=[])).push(u);i&&(u.f^=Br),c&&d!==null&&(d.f&je)===0&&(u.f^=je)}for(r=0;r<l;r++)if(o=n[r],po(o)&&Ta(o),o.wv>t.wv)return!0}(!s||O!==null&&!Wt)&&he(t,de)}return!1}function Wa(t,e,n=!0){var s=t.reactions;if(s!==null&&!bt?.includes(t))for(var r=0;r<s.length;r++){var o=s[r];(o.f&Se)!==0?Wa(o,e,!1):e===o&&(n?he(o,Ue):(o.f&de)!==0&&he(o,Ft),bn(o))}}function Ga(t){var I;var e=pe,n=Re,s=Ne,r=G,o=Wt,i=bt,c=ee,l=ze,u=Ge,d=t.f;pe=null,Re=0,Ne=null,Wt=(d&je)!==0&&(ze||!qn||G===null),G=(d&(St|Zt))===0?t:null,bt=null,Kn(t.ctx),ze=!1,Ge=++gs,t.ac!==null&&(ts(()=>{t.ac.abort(ps)}),t.ac=null);try{t.f|=Co;var p=t.fn,h=p(),m=t.deps;if(pe!==null){var y;if(zr(t,Re),m!==null&&Re>0)for(m.length=Re+pe.length,y=0;y<pe.length;y++)m[Re+y]=pe[y];else t.deps=m=pe;if(!Wt||(d&Se)!==0&&t.reactions!==null)for(y=Re;y<m.length;y++)((I=m[y]).reactions??(I.reactions=[])).push(t)}else m!==null&&Re<m.length&&(zr(t,Re),m.length=Re);if(es()&&Ne!==null&&!ze&&m!==null&&(t.f&(Se|Ft|Ue))===0)for(y=0;y<Ne.length;y++)Wa(Ne[y],t);return r!==null&&r!==t&&(gs++,Ne!==null&&(s===null?s=Ne:s.push(...Ne))),(t.f&wn)!==0&&(t.f^=wn),h}catch(E){return ba(E)}finally{t.f^=Co,pe=e,Re=n,Ne=s,G=r,Wt=o,bt=i,Kn(c),ze=l,Ge=u}}function Vl(t,e){let n=e.reactions;if(n!==null){var s=jc.call(n,t);if(s!==-1){var r=n.length-1;r===0?n=e.reactions=null:(n[s]=n[r],n.pop())}}n===null&&(e.f&Se)!==0&&(pe===null||!pe.includes(e))&&(he(e,Ft),(e.f&(je|Br))===0&&(e.f^=Br),Aa(e),zr(e,0))}function zr(t,e){var n=t.deps;if(n!==null)for(var s=e;s<n.length;s++)Vl(t,n[s])}function ys(t){var e=t.f;if((e&Sn)===0){he(t,de);var n=O,s=qn;O=t,qn=!0;try{(e&Xt)!==0?Wl(t):ja(t),qa(t);var r=Ga(t);t.teardown=typeof r=="function"?r:null,t.wv=za;var o}finally{qn=s,O=n}}}async function Ql(){await Promise.resolve(),Il()}function f(t){var e=t.f,n=(e&Se)!==0;if(G!==null&&!ze){var s=O!==null&&(O.f&Sn)!==0;if(!s&&!bt?.includes(t)){var r=G.deps;if((G.f&Co)!==0)t.rv<gs&&(t.rv=gs,pe===null&&r!==null&&r[Re]===t?Re++:pe===null?pe=[t]:(!Wt||!pe.includes(t))&&pe.push(t));else{(G.deps??(G.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[G]:o.includes(G)||o.push(G)}}}else if(n&&t.deps===null&&t.effects===null){var i=t,c=i.parent;c!==null&&(c.f&je)===0&&(i.f^=je)}if(Rn){if(Qt.has(t))return Qt.get(t);if(n){i=t;var l=i.v;return((i.f&de)===0&&i.reactions!==null||Va(i))&&(l=Fo(i)),Qt.set(i,l),l}}else n&&(i=t,po(i)&&Ta(i));if((t.f&wn)!==0)throw t.v;return t.v}function Va(t){if(t.v===re)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Qt.has(e)||(e.f&Se)!==0&&Va(e))return!0;return!1}function At(t){var e=ze;try{return ze=!0,t()}finally{ze=e}}const Jl=-7169;function he(t,e){t.f=t.f&Jl|e}function Kl(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(at in t)Uo(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&at in n&&Uo(n)}}}function Uo(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let s in t)try{Uo(t[s],e)}catch{}const n=to(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const s=la(n);for(let r in s){const o=s[r].get;if(o)try{o.call(t)}catch{}}}}}function Yl(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const Xl=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Zl(t){return Xl.includes(t)}const Fl={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function eu(t){return t=t.toLowerCase(),Fl[t]??t}const tu=["touchstart","touchmove"];function nu(t){return tu.includes(t)}const Qa=new Set,xo=new Set;function ti(t,e,n,s={}){function r(o){if(s.capture||ls.call(e,o),!o.cancelBubble)return ts(()=>n?.call(this,o))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Ve(()=>{e.addEventListener(t,r,s)}):e.addEventListener(t,r,s),r}function Bo(t,e,n,s={}){var r=ti(e,t,n,s);return()=>{t.removeEventListener(e,r,s)}}function Lf(t,e,n,s,r){var o={capture:s,passive:r},i=ti(t,e,n,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&uo(()=>{e.removeEventListener(t,i,o)})}function su(t){for(var e=0;e<t.length;e++)Qa.add(t[e]);for(var n of xo)n(t)}let Ti=null;function ls(t){var e=this,n=e.ownerDocument,s=t.type,r=t.composedPath?.()||[],o=r[0]||t.target;Ti=t;var i=0,c=Ti===t&&t.__root;if(c){var l=r.indexOf(c);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var u=r.indexOf(e);if(u===-1)return;l<=u&&(i=l)}if(o=r[i]||t.target,o!==e){$o(t,"currentTarget",{configurable:!0,get(){return o||n}});var d=G,p=O;Ee(null),lt(null);try{for(var h,m=[];o!==null;){var y=o.assignedSlot||o.parentNode||o.host||null;try{var I=o["__"+s];if(I!=null&&(!o.disabled||t.target===o))if(cr(I)){var[E,...A]=I;E.apply(o,[t,...A])}else I.call(o,t)}catch(T){h?m.push(T):h=T}if(t.cancelBubble||y===e||y===null)break;o=y}if(h){for(let T of m)queueMicrotask(()=>{throw T});throw h}}finally{t.__root=e,delete t.currentTarget,Ee(d),lt(p)}}}function ni(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function In(t,e){var n=O;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function Uf(t,e){var n=(e&al)!==0,s=(e&cl)!==0,r,o=!t.startsWith("<!>");return()=>{r===void 0&&(r=ni(o?t:"<!>"+t),n||(r=it(r)));var i=s||$a?document.importNode(r,!0):r.cloneNode(!0);if(n){var c=it(i),l=i.lastChild;In(c,l)}else In(i,i);return i}}function ru(t,e,n="svg"){var s=!t.startsWith("<!>"),r=`<${n}>${s?t:"<!>"+t}</${n}>`,o;return()=>{if(!o){var i=ni(r),c=it(i);o=it(c)}var l=o.cloneNode(!0);return In(l,l),l}}function xf(t,e){return ru(t,e,"svg")}function Bf(t=""){{var e=_t(t+"");return In(e,e),e}}function Hf(){var t=document.createDocumentFragment(),e=document.createComment(""),n=_t();return t.append(e,n),In(e,n),t}function zf(t,e){t!==null&&t.before(e)}let Or=!0;function Pi(t){Or=t}function Of(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Wf(t,e){return ou(t,e)}const Cn=new Map;function ou(t,{target:e,anchor:n,props:s={},events:r,context:o,intro:i=!0}){Nl();var c=new Set,l=p=>{for(var h=0;h<p.length;h++){var m=p[h];if(!c.has(m)){c.add(m);var y=nu(m);e.addEventListener(m,ls,{passive:y});var I=Cn.get(m);I===void 0?(document.addEventListener(m,ls,{passive:y}),Cn.set(m,1)):Cn.set(m,I+1)}}};l(Jo(Qa)),xo.add(l);var u=void 0,d=Hl(()=>{var p=n??e.appendChild(_t());return _l(p,{pending:()=>{}},h=>{if(o){yl({});var m=ee;m.c=o}r&&(s.$$events=r),Or=i,u=t(h,s)||{},Or=!0,o&&wl()}),()=>{for(var h of c){e.removeEventListener(h,ls);var m=Cn.get(h);--m===0?(document.removeEventListener(h,ls),Cn.delete(h)):Cn.set(h,m)}xo.delete(l),p!==n&&p.parentNode?.removeChild(p)}});return iu.set(u,d),u}let iu=new WeakMap;function Gf(t,e,n=!1){var s=t,r=null,o=null,i=re,c=n?en:0,l=!1;const u=(m,y=!0)=>{l=!0,h(y,m)};var d=null;function p(){d!==null&&(d.lastChild.remove(),s.before(d),d=null);var m=i?r:o,y=i?o:r;m&&fo(m),y&&vt(y,()=>{i?o=null:r=null})}const h=(m,y)=>{if(i!==(i=m)){var I=co(),E=s;if(I&&(d=document.createDocumentFragment(),d.append(E=_t())),i?r??(r=y&&ae(()=>y(E))):o??(o=y&&ae(()=>y(E))),I){var A=J,T=i?r:o,R=i?o:r;T&&A.skipped_effects.delete(T),R&&A.skipped_effects.add(R),A.add_callback(p)}else p()}};Rt(()=>{l=!1,e(u),l||h(null,null)},c)}function Vf(t,e,n){var s=t,r=re,o,i,c=null,l=es()?ml:ya;function u(){o&&vt(o),c!==null&&(c.lastChild.remove(),s.before(c),c=null),o=i}Rt(()=>{if(l(r,r=e())){var d=s,p=co();p&&(c=document.createDocumentFragment(),c.append(d=_t())),i=ae(()=>n(d)),p?J.add_callback(u):u()}})}let vn=null;function Di(t){vn=t}function Qf(t,e){return e}function au(t,e,n){for(var s=t.items,r=[],o=e.length,i=0;i<o;i++)ei(e[i].e,r,!0);var c=o>0&&r.length===0&&n!==null;if(c){var l=n.parentNode;kl(l),l.append(n),s.clear(),Ye(t,e[0].prev,e[o-1].next)}xa(r,()=>{for(var u=0;u<o;u++){var d=e[u];c||(s.delete(d.k),Ye(t,d.prev,d.next)),ie(d.e,!c)}})}function Jf(t,e,n,s,r,o=null){var i=t,c={flags:e,items:new Map,first:null},l=(e&ma)!==0;if(l){var u=t;i=u.appendChild(_t())}var d=null,p=!1,h=new Map,m=Zo(()=>{var A=n();return cr(A)?A:A==null?[]:Jo(A)}),y,I;function E(){cu(I,y,c,h,i,r,e,s,n),o!==null&&(y.length===0?d?fo(d):d=ae(()=>o(i)):d!==null&&vt(d,()=>{d=null}))}Rt(()=>{I??(I=O),y=f(m);var A=y.length;if(!(p&&A===0)){p=A===0;var T,R,M,B;if(co()){var q=new Set,j=J;for(R=0;R<A;R+=1){M=y[R],B=s(M,R);var ce=c.items.get(B)??h.get(B);ce?(e&(oo|io))!==0&&Ja(ce,M,R,e):(T=Ka(null,c,null,null,M,B,R,r,e,n,!0),h.set(B,T)),q.add(B)}for(const[_e,rs]of c.items)q.has(_e)||j.skipped_effects.add(rs.e);j.add_callback(E)}else E();f(m)}})}function cu(t,e,n,s,r,o,i,c,l){var u=(i&Xc)!==0,d=(i&(oo|io))!==0,p=e.length,h=n.items,m=n.first,y=m,I,E=null,A,T=[],R=[],M,B,q,j;if(u)for(j=0;j<p;j+=1)M=e[j],B=c(M,j),q=h.get(B),q!==void 0&&(q.a?.measure(),(A??(A=new Set)).add(q));for(j=0;j<p;j+=1){if(M=e[j],B=c(M,j),q=h.get(B),q===void 0){var ce=s.get(B);if(ce!==void 0){s.delete(B),h.set(B,ce);var _e=E?E.next:y;Ye(n,E,ce),Ye(n,ce,_e),vo(ce,_e,r),E=ce}else{var rs=y?y.e.nodes_start:r;E=Ka(rs,n,E,E===null?n.first:E.next,M,B,j,o,i,l)}h.set(B,E),T=[],R=[],y=E.next;continue}if(d&&Ja(q,M,j,i),(q.e.f&We)!==0&&(fo(q.e),u&&(q.a?.unfix(),(A??(A=new Set)).delete(q))),q!==y){if(I!==void 0&&I.has(q)){if(T.length<R.length){var Pn=R[0],Je;E=Pn.prev;var os=T[0],Dn=T[T.length-1];for(Je=0;Je<T.length;Je+=1)vo(T[Je],Pn,r);for(Je=0;Je<R.length;Je+=1)I.delete(R[Je]);Ye(n,os.prev,Dn.next),Ye(n,E,os),Ye(n,Dn,Pn),y=Pn,E=Dn,j-=1,T=[],R=[]}else I.delete(q),vo(q,y,r),Ye(n,q.prev,q.next),Ye(n,q,E===null?n.first:E.next),Ye(n,E,q),E=q;continue}for(T=[],R=[];y!==null&&y.k!==B;)(y.e.f&We)===0&&(I??(I=new Set)).add(y),R.push(y),y=y.next;if(y===null)continue;q=y}T.push(q),E=q,y=q.next}if(y!==null||I!==void 0){for(var Tt=I===void 0?[]:Jo(I);y!==null;)(y.e.f&We)===0&&Tt.push(y),y=y.next;var $n=Tt.length;if($n>0){var br=(i&ma)!==0&&p===0?r:null;if(u){for(j=0;j<$n;j+=1)Tt[j].a?.measure();for(j=0;j<$n;j+=1)Tt[j].a?.fix()}au(n,Tt,br)}}u&&Ve(()=>{if(A!==void 0)for(q of A)q.a?.apply()}),t.first=n.first&&n.first.e,t.last=E&&E.e;for(var Ir of s.values())ie(Ir.e);s.clear()}function Ja(t,e,n,s){(s&oo)!==0&&Xn(t.v,e),(s&io)!==0?Xn(t.i,n):t.i=n}function Ka(t,e,n,s,r,o,i,c,l,u,d){var p=vn,h=(l&oo)!==0,m=(l&Zc)===0,y=h?m?Cl(r,!1,!1):It(r):r,I=(l&io)===0?i:It(i),E={i:I,v:y,k:o,a:null,e:null,prev:n,next:s};vn=E;try{if(t===null){var A=document.createDocumentFragment();A.append(t=_t())}return E.e=ae(()=>c(t,y,I,u),hl),E.e.prev=n&&n.e,E.e.next=s&&s.e,n===null?d||(e.first=E):(n.next=E,n.e.next=E.e),s!==null&&(s.prev=E,s.e.prev=E.e),E}finally{vn=p}}function vo(t,e,n){for(var s=t.next?t.next.e.nodes_start:n,r=e?e.e.nodes_start:n,o=t.e.nodes_start;o!==null&&o!==s;){var i=ur(o);r.before(o),o=i}}function Ye(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function Kf(t,e,n=!1,s=!1,r=!1){var o=t,i="";Ol(()=>{var c=O;if(i!==(i=e()??"")&&(c.nodes_start!==null&&(La(c.nodes_start,c.nodes_end),c.nodes_start=c.nodes_end=null),i!=="")){var l=i+"";n?l=`<svg>${l}</svg>`:s&&(l=`<math>${l}</math>`);var u=ni(l);if((n||s)&&(u=it(u)),In(it(u),u.lastChild),n||s)for(;it(u);)o.before(it(u));else o.before(u)}})}function Yf(t,e,...n){var s=t,r=nn,o;Rt(()=>{r!==(r=e())&&(o&&(ie(o),o=null),o=ae(()=>r(s,...n)))},en)}function Xf(t,e,n){var s=t,r,o,i=null,c=null;function l(){o&&(vt(o),o=null),i&&(i.lastChild.remove(),s.before(i),i=null),o=c,c=null}Rt(()=>{if(r!==(r=e())){var u=co();if(r){var d=s;u&&(i=document.createDocumentFragment(),i.append(d=_t()),o&&J.skipped_effects.add(o)),c=ae(()=>n(d,r))}u?J.add_callback(l):l()}},en)}function Zf(t,e,n,s,r,o){var i,c,l=null,u=t,d,p=vn;Rt(()=>{const h=e()||null;var m=ul;if(h!==i){var y=vn;Di(p),d&&(h===null?vt(d,()=>{d=null,c=null}):h===c?fo(d):(ie(d),Pi(!1))),h&&h!==c&&(d=ae(()=>{if(l=document.createElementNS(m,h),In(l,l),s){var I=l.appendChild(_t());s(l,I)}O.nodes_end=l,u.before(l)})),i=h,i&&(c=i),Pi(!0),Di(y)}},en)}function lu(t,e){var n=void 0,s;Rt(()=>{n!==(n=e())&&(s&&(ie(s),s=null),n&&(s=ae(()=>{dr(()=>n(t))})))})}function Ya(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=Ya(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function uu(){for(var t,e,n=0,s="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=Ya(t))&&(s&&(s+=" "),s+=e);return s}function du(t){return typeof t=="object"?uu(t):t??""}const $i=[...` 	
\r\fÂ \v\uFEFF`];function fu(t,e,n){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),n){for(var r in n)if(n[r])s=s?s+" "+r:r;else if(s.length)for(var o=r.length,i=0;(i=s.indexOf(r,i))>=0;){var c=i+o;(i===0||$i.includes(s[i-1]))&&(c===s.length||$i.includes(s[c]))?s=(i===0?"":s.substring(0,i))+s.substring(c+1):i=c}}return s===""?null:s}function Mi(t,e=!1){var n=e?" !important;":";",s="";for(var r in t){var o=t[r];o!=null&&o!==""&&(s+=" "+r+": "+o+n)}return s}function bo(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function pu(t,e){if(e){var n="",s,r;if(Array.isArray(e)?(s=e[0],r=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(bo)),r&&l.push(...Object.keys(r).map(bo));var u=0,d=-1;const I=t.length;for(var p=0;p<I;p++){var h=t[p];if(c?h==="/"&&t[p-1]==="*"&&(c=!1):o?o===h&&(o=!1):h==="/"&&t[p+1]==="*"?c=!0:h==='"'||h==="'"?o=h:h==="("?i++:h===")"&&i--,!c&&o===!1&&i===0){if(h===":"&&d===-1)d=p;else if(h===";"||p===I-1){if(d!==-1){var m=bo(t.substring(u,d).trim());if(!l.includes(m)){h!==";"&&p++;var y=t.substring(u,p).trim();n+=" "+y+";"}}u=p+1,d=-1}}}}return s&&(n+=Mi(s)),r&&(n+=Mi(r,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function hu(t,e,n,s,r,o){var i=t.__className;if(i!==n||i===void 0){var c=fu(n,s,o);c==null?t.removeAttribute("class"):e?t.className=c:t.setAttribute("class",c),t.__className=n}else if(o&&r!==o)for(var l in o){var u=!!o[l];(r==null||u!==!!r[l])&&t.classList.toggle(l,u)}return o}function Io(t,e={},n,s){for(var r in n){var o=n[r];e[r]!==o&&(n[r]==null?t.style.removeProperty(r):t.style.setProperty(r,o,s))}}function mu(t,e,n,s){var r=t.__style;if(r!==e){var o=pu(e,s);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else s&&(Array.isArray(s)?(Io(t,n?.[0],s[0]),Io(t,n?.[1],s[1],"important")):Io(t,n,s));return s}function Wr(t,e,n=!1){if(t.multiple){if(e==null)return;if(!cr(e))return fl();for(var s of t.options)s.selected=e.includes(ms(s));return}for(s of t.options){var r=ms(s);if(Da(r,e)){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Xa(t){var e=new MutationObserver(()=>{Wr(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),uo(()=>{e.disconnect()})}function Ff(t,e,n=e){var s=!0;lo(t,"change",r=>{var o=r?"[selected]":":checked",i;if(t.multiple)i=[].map.call(t.querySelectorAll(o),ms);else{var c=t.querySelector(o)??t.querySelector("option:not([disabled])");i=c&&ms(c)}n(i)}),dr(()=>{var r=e();if(Wr(t,r,s),s&&r===void 0){var o=t.querySelector(":checked");o!==null&&(r=ms(o),n(r))}t.__value=r,s=!1}),Xa(t)}function ms(t){return"__value"in t?t.__value:t.value}const is=Symbol("class"),as=Symbol("style"),Za=Symbol("is custom element"),Fa=Symbol("is html");function ep(t,e){var n=ho(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function tp(t,e){var n=ho(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function gu(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function Ci(t,e,n,s){var r=ho(t);r[e]!==(r[e]=n)&&(e==="loading"&&(t[Bc]=n),n==null?t.removeAttribute(e):typeof n!="string"&&ec(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function yu(t,e,n,s,r=!1,o=!1){var i=ho(t),c=i[Za],l=!i[Fa],u=e||{},d=t.tagName==="OPTION";for(var p in e)p in n||(n[p]=null);n.class?n.class=du(n.class):n[is]&&(n.class=null),n[as]&&(n.style??(n.style=null));var h=ec(t);for(const R in n){let M=n[R];if(d&&R==="value"&&M==null){t.value=t.__value="",u[R]=M;continue}if(R==="class"){var m=t.namespaceURI==="http://www.w3.org/1999/xhtml";hu(t,m,M,s,e?.[is],n[is]),u[R]=M,u[is]=n[is];continue}if(R==="style"){mu(t,M,e?.[as],n[as]),u[R]=M,u[as]=n[as];continue}var y=u[R];if(!(M===y&&!(M===void 0&&t.hasAttribute(R)))){u[R]=M;var I=R[0]+R[1];if(I!=="$$")if(I==="on"){const B={},q="$$"+R;let j=R.slice(2);var E=Zl(j);if(Yl(j)&&(j=j.slice(0,-7),B.capture=!0),!E&&y){if(M!=null)continue;t.removeEventListener(j,u[q],B),u[q]=null}if(M!=null)if(E)t[`__${j}`]=M,su([j]);else{let ce=function(_e){u[R].call(this,_e)};u[q]=ti(j,t,ce,B)}else E&&(t[`__${j}`]=void 0)}else if(R==="style")Ci(t,R,M);else if(R==="autofocus")ql(t,!!M);else if(!c&&(R==="__value"||R==="value"&&M!=null))t.value=t.__value=M;else if(R==="selected"&&d)gu(t,M);else{var A=R;l||(A=eu(A));var T=A==="defaultValue"||A==="defaultChecked";if(M==null&&!c&&!T)if(i[R]=null,A==="value"||A==="checked"){let B=t;const q=e===void 0;if(A==="value"){let j=B.defaultValue;B.removeAttribute(A),B.defaultValue=j,B.value=B.__value=q?j:null}else{let j=B.defaultChecked;B.removeAttribute(A),B.defaultChecked=j,B.checked=q?j:!1}}else t.removeAttribute(R);else T||h.includes(A)&&(c||typeof M!="string")?(t[A]=M,A in i&&(i[A]=re)):typeof M!="function"&&Ci(t,A,M)}}}return u}function np(t,e,n=[],s=[],r,o=!1,i=!1){_a(n,s,c=>{var l=void 0,u={},d=t.nodeName==="SELECT",p=!1;if(Rt(()=>{var m=e(...c.map(f)),y=yu(t,l,m,r,o,i);p&&d&&"value"in m&&Wr(t,m.value);for(let E of Object.getOwnPropertySymbols(u))m[E]||ie(u[E]);for(let E of Object.getOwnPropertySymbols(m)){var I=m[E];E.description===dl&&(!l||I!==l[E])&&(u[E]&&ie(u[E]),u[E]=ae(()=>lu(t,()=>I))),y[E]=I}l=y}),d){var h=t;dr(()=>{Wr(h,l.value,!0),Xa(h)})}p=!0})}function ho(t){return t.__attributes??(t.__attributes={[Za]:t.nodeName.includes("-"),[Fa]:t.namespaceURI===ll})}var Ni=new Map;function ec(t){var e=t.getAttribute("is")||t.nodeName,n=Ni.get(e);if(n)return n;Ni.set(e,n=[]);for(var s,r=t,o=Element.prototype;o!==r;){s=la(r);for(var i in s)s[i].set&&n.push(i);r=to(r)}return n}const wu=()=>performance.now(),yt={tick:t=>requestAnimationFrame(t),now:()=>wu(),tasks:new Set};function tc(){const t=yt.now();yt.tasks.forEach(e=>{e.c(t)||(yt.tasks.delete(e),e.f())}),yt.tasks.size!==0&&yt.tick(tc)}function vu(t){let e;return yt.tasks.size===0&&yt.tick(tc),{promise:new Promise(n=>{yt.tasks.add(e={c:t,f:n})}),abort(){yt.tasks.delete(e)}}}function _r(t,e){ts(()=>{t.dispatchEvent(new CustomEvent(e))})}function bu(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("")}function ki(t){const e={},n=t.split(";");for(const s of n){const[r,o]=s.split(":");if(!r||o===void 0)break;const i=bu(r.trim());e[i]=o.trim()}return e}const Iu=t=>t;function sp(t,e,n){var s=vn,r,o,i,c=null;s.a??(s.a={element:t,measure(){r=this.element.getBoundingClientRect()},apply(){if(i?.abort(),o=this.element.getBoundingClientRect(),r.left!==o.left||r.right!==o.right||r.top!==o.top||r.bottom!==o.bottom){const l=e()(this.element,{from:r,to:o},n?.());i=Gr(this.element,l,void 0,1,()=>{i?.abort(),i=void 0})}},fix(){if(!t.getAnimations().length){var{position:l,width:u,height:d}=getComputedStyle(t);if(l!=="absolute"&&l!=="fixed"){var p=t.style;c={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=u,p.height=d;var h=t.getBoundingClientRect();if(r.left!==h.left||r.top!==h.top){var m=`translate(${r.left-h.left}px, ${r.top-h.top}px)`;p.transform=p.transform?`${p.transform} ${m}`:m}}}},unfix(){if(c){var l=t.style;l.position=c.position,l.width=c.width,l.height=c.height,l.transform=c.transform}}}),s.a.element=t}function rp(t,e,n,s){var r=(t&rl)!==0,o=(t&ol)!==0,i=r&&o,c=(t&il)!==0,l=i?"both":r?"in":"out",u,d=e.inert,p=e.style.overflow,h,m;function y(){return ts(()=>u??(u=n()(e,s?.()??{},{direction:l})))}var I={is_global:c,in(){if(e.inert=d,!r){m?.abort(),m?.reset?.();return}o||h?.abort(),_r(e,"introstart"),h=Gr(e,y(),m,1,()=>{_r(e,"introend"),h?.abort(),h=u=void 0,e.style.overflow=p})},out(R){if(!o){R?.(),u=void 0;return}e.inert=!0,_r(e,"outrostart"),m=Gr(e,y(),h,0,()=>{_r(e,"outroend"),R?.()})},stop:()=>{h?.abort(),m?.abort()}},E=O;if((E.transitions??(E.transitions=[])).push(I),r&&Or){var A=c;if(!A){for(var T=E.parent;T&&(T.f&en)!==0;)for(;(T=T.parent)&&(T.f&Xt)===0;);A=!T||(T.f&so)!==0}A&&dr(()=>{At(()=>I.in())})}}function Gr(t,e,n,s,r){var o=s===1;if(Nn(e)){var i,c=!1;return Ve(()=>{if(!c){var E=e({direction:o?"in":"out"});i=Gr(t,E,n,s,r)}}),{abort:()=>{c=!0,i?.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(n?.deactivate(),!e?.duration)return r(),{abort:nn,deactivate:nn,reset:nn,t:()=>s};const{delay:l=0,css:u,tick:d,easing:p=Iu}=e;var h=[];if(o&&n===void 0&&(d&&d(0,1),u)){var m=ki(u(0,1));h.push(m,m)}var y=()=>1-s,I=t.animate(h,{duration:l,fill:"forwards"});return I.onfinish=()=>{I.cancel();var E=n?.t()??1-s;n?.abort();var A=s-E,T=e.duration*Math.abs(A),R=[];if(T>0){var M=!1;if(u)for(var B=Math.ceil(T/16.666666666666668),q=0;q<=B;q+=1){var j=E+A*p(q/B),ce=ki(u(j,1-j));R.push(ce),M||(M=ce.overflow==="hidden")}M&&(t.style.overflow="hidden"),y=()=>{var _e=I.currentTime;return E+A*p(_e/T)},d&&vu(()=>{if(I.playState!=="running")return!1;var _e=y();return d(_e,1-_e),!0})}I=t.animate(R,{duration:T,fill:"forwards"}),I.onfinish=()=>{y=()=>s,d?.(s,1-s),r()}},{abort:()=>{I&&(I.cancel(),I.effect=null,I.onfinish=nn)},deactivate:()=>{r=nn},reset:()=>{s===0&&d?.(1,0)},t:()=>y()}}function op(t,e,n=e){var s=new WeakSet;lo(t,"input",async r=>{var o=r?t.defaultValue:t.value;if(o=So(t)?_o(o):o,n(o),J!==null&&s.add(J),await Ql(),o!==(o=e())){var i=t.selectionStart,c=t.selectionEnd;t.value=o??"",c!==null&&(t.selectionStart=i,t.selectionEnd=Math.min(c,t.value.length))}}),At(e)==null&&t.value&&(n(So(t)?_o(t.value):t.value),J!==null&&s.add(J)),fr(()=>{var r=e();if(t===document.activeElement){var o=Dr??J;if(s.has(o))return}So(t)&&r===_o(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}const Eo=new Set;function ip(t,e,n,s,r=s){var o=n.getAttribute("type")==="checkbox",i=t;if(e!==null)for(var c of e)i=i[c]??(i[c]=[]);i.push(n),lo(n,"change",()=>{var l=n.__value;o&&(l=Eu(i,l,n.checked)),r(l)},()=>r(o?[]:null)),fr(()=>{var l=s();o?(l=l||[],n.checked=l.includes(n.__value)):n.checked=Da(n.__value,l)}),uo(()=>{var l=i.indexOf(n);l!==-1&&i.splice(l,1)}),Eo.has(i)||(Eo.add(i),Ve(()=>{i.sort((l,u)=>l.compareDocumentPosition(u)===4?-1:1),Eo.delete(i)})),Ve(()=>{})}function ap(t,e,n=e){lo(t,"change",s=>{var r=s?t.defaultChecked:t.checked;n(r)}),At(e)==null&&n(t.checked),fr(()=>{var s=e();t.checked=!!s})}function Eu(t,e,n){for(var s=new Set,r=0;r<t.length;r+=1)t[r].checked&&s.add(t[r].__value);return n||s.delete(e),Array.from(s)}function So(t){var e=t.type;return e==="number"||e==="range"}function _o(t){return t===""?null:+t}function qi(t,e){return t===e||t?.[at]===e}function cp(t={},e,n,s){return dr(()=>{var r,o;return fr(()=>{r=o,o=[],At(()=>{t!==n(...o)&&(e(t,...o),r&&qi(n(...r),t)&&e(null,...r))})}),()=>{Ve(()=>{o&&qi(n(...o),t)&&e(null,...o)})}}),t}function lp(t=!1){const e=ee,n=e.l.u;if(!n)return;let s=()=>Kl(e.s);if(t){let r=0,o={};const i=lr(()=>{let c=!1;const l=e.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&r++,r});s=()=>f(i)}n.b.length&&xl(()=>{ji(e,s),Mo(n.b)}),Hr(()=>{const r=At(()=>n.m.map(Uc));return()=>{for(const o of r)typeof o=="function"&&o()}}),n.a.length&&Hr(()=>{ji(e,s),Mo(n.a)})}function ji(t,e){if(t.l.s)for(const n of t.l.s)f(n);e()}let Rr=!1;function Su(t){var e=Rr;try{return Rr=!1,[t(),Rr]}finally{Rr=e}}const _u={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function up(t,e,n){return new Proxy({props:t,exclude:e},_u)}const Ru={get(t,e){let n=t.props.length;for(;n--;){let s=t.props[n];if(Nn(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(t,e,n){let s=t.props.length;for(;s--;){let r=t.props[s];Nn(r)&&(r=r());const o=Vt(r,e);if(o&&o.set)return o.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let s=t.props[n];if(Nn(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const r=Vt(s,e);return r&&!r.configurable&&(r.configurable=!0),r}}},has(t,e){if(e===at||e===pa)return!1;for(let n of t.props)if(Nn(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(Nn(n)&&(n=n()),!!n){for(const s in n)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(n))e.includes(s)||e.push(s)}return e}};function dp(...t){return new Proxy({props:t},Ru)}function fp(t,e,n,s){var r=!Fn||(n&el)!==0,o=(n&nl)!==0,i=(n&sl)!==0,c=s,l=!0,u=()=>(l&&(l=!1,c=i?At(s):s),c),d;if(o){var p=at in t||pa in t;d=Vt(t,e)?.set??(p&&e in t?R=>t[e]=R:void 0)}var h,m=!1;o?[h,m]=Su(()=>t[e]):h=t[e],h===void 0&&s!==void 0&&(h=u(),d&&(r&&Vc(),d(h)));var y;if(r?y=()=>{var R=t[e];return R===void 0?u():(l=!0,R)}:y=()=>{var R=t[e];return R!==void 0&&(c=void 0),R===void 0?c:R},r&&(n&tl)===0)return y;if(d){var I=t.$$legacy;return(function(R,M){return arguments.length>0?((!r||!M||I||m)&&d(M?y():R),R):y()})}var E=!1,A=((n&Fc)!==0?lr:Zo)(()=>(E=!1,y()));o&&f(A);var T=O;return(function(R,M){if(arguments.length>0){const B=M?f(A):r&&o?oe(R):R;return g(A,B),E=!0,c!==void 0&&(c=B),R}return Rn&&E||(T.f&Sn)!==0?A.v:f(A)})}function Au(t){ee===null&&ha(),Fn&&ee.l!==null?Tu(ee).m.push(t):Hr(()=>{const e=At(t);if(typeof e=="function")return e})}function pp(t){ee===null&&ha(),Au(()=>()=>At(t))}function Tu(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Pu="modulepreload",Du=function(t){return"/"+t},Li={},Ro=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=i?.nonce||i?.getAttribute("nonce");r=l(n.map(u=>{if(u=Du(u),u in Li)return;Li[u]=!0;const d=u.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Pu,d||(h.as="script"),h.crossOrigin="",h.href=u,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((m,y)=>{h.addEventListener("load",m),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};var $u=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Mu=["difference","intersection","symmetricDifference","union"],Ui=!1,zn,Be,kt,Jr,Zn,nc,sc;const Kr=class Kr extends Set{constructor(n){super();v(this,Zn);v(this,zn,new Map);v(this,Be,D(0));v(this,kt,D(0));v(this,Jr,Ge||-1);if(n){for(var s of n)super.add(s);a(this,kt).v=super.size}Ui||S(this,Zn,sc).call(this)}has(n){var s=super.has(n),r=a(this,zn),o=r.get(n);if(o===void 0){if(!s)return f(a(this,Be)),!1;o=S(this,Zn,nc).call(this,!0),r.set(n,o)}return f(o),s}add(n){return super.has(n)||(super.add(n),g(a(this,kt),super.size),Me(a(this,Be))),this}delete(n){var s=super.delete(n),r=a(this,zn),o=r.get(n);return o!==void 0&&(r.delete(n),g(o,!1)),s&&(g(a(this,kt),super.size),Me(a(this,Be))),s}clear(){if(super.size!==0){super.clear();var n=a(this,zn);for(var s of n.values())g(s,!1);n.clear(),g(a(this,kt),0),Me(a(this,Be))}}keys(){return this.values()}values(){return f(a(this,Be)),super.values()}entries(){return f(a(this,Be)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return f(a(this,kt))}};zn=new WeakMap,Be=new WeakMap,kt=new WeakMap,Jr=new WeakMap,Zn=new WeakSet,nc=function(n){return Ge===a(this,Jr)?D(n):It(n)},sc=function(){Ui=!0;var n=Kr.prototype,s=Set.prototype;for(const r of $u)n[r]=function(...o){return f(a(this,Be)),s[r].apply(this,o)};for(const r of Mu)n[r]=function(...o){f(a(this,Be));var i=s[r].apply(this,o);return new Kr(i)}};let xi=Kr;var et,tt,pt,Yr,Oe,us,Nr;const li=class li extends Map{constructor(n){super();v(this,Oe);v(this,et,new Map);v(this,tt,D(0));v(this,pt,D(0));v(this,Yr,Ge||-1);if(n){for(var[s,r]of n)super.set(s,r);a(this,pt).v=super.size}}has(n){var s=a(this,et),r=s.get(n);if(r===void 0){var o=super.get(n);if(o!==void 0)r=S(this,Oe,us).call(this,0),s.set(n,r);else return f(a(this,tt)),!1}return f(r),!0}forEach(n,s){S(this,Oe,Nr).call(this),super.forEach(n,s)}get(n){var s=a(this,et),r=s.get(n);if(r===void 0){var o=super.get(n);if(o!==void 0)r=S(this,Oe,us).call(this,0),s.set(n,r);else{f(a(this,tt));return}}return f(r),super.get(n)}set(n,s){var r=a(this,et),o=r.get(n),i=super.get(n),c=super.set(n,s),l=a(this,tt);if(o===void 0)o=S(this,Oe,us).call(this,0),r.set(n,o),g(a(this,pt),super.size),Me(l);else if(i!==s){Me(o);var u=l.reactions===null?null:new Set(l.reactions),d=u===null||!o.reactions?.every(p=>u.has(p));d&&Me(l)}return c}delete(n){var s=a(this,et),r=s.get(n),o=super.delete(n);return r!==void 0&&(s.delete(n),g(a(this,pt),super.size),g(r,-1),Me(a(this,tt))),o}clear(){if(super.size!==0){super.clear();var n=a(this,et);g(a(this,pt),0);for(var s of n.values())g(s,-1);Me(a(this,tt)),n.clear()}}keys(){return f(a(this,tt)),super.keys()}values(){return S(this,Oe,Nr).call(this),super.values()}entries(){return S(this,Oe,Nr).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(a(this,pt)),super.size}};et=new WeakMap,tt=new WeakMap,pt=new WeakMap,Yr=new WeakMap,Oe=new WeakSet,us=function(n){return Ge===a(this,Yr)?D(n):It(n)},Nr=function(){f(a(this,tt));var n=a(this,et);if(a(this,pt).v!==n.size){for(var s of yi(li.prototype,this,"keys").call(this))if(!n.has(s)){var r=S(this,Oe,us).call(this,0);n.set(s,r)}}for([,r]of a(this,et))f(r)};let Yt=li;var Ss,_s;class Cu{constructor(e,n){v(this,Ss);v(this,_s);_(this,Ss,e),_(this,_s,Xo(n))}get current(){return a(this,_s).call(this),a(this,Ss).call(this)}}Ss=new WeakMap,_s=new WeakMap;const Nu=/\(.+\)/,ku=new Set(["all","print","screen","and","or","not","only"]);class Bi extends Cu{constructor(e,n){let s=Nu.test(e)||e.split(/[\s,]+/).some(o=>ku.has(o.trim()))?e:`(${e})`;const r=window.matchMedia(s);super(()=>r.matches,o=>Bo(r,"change",o))}}const qu=typeof window<"u"?window:void 0;function ju(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}var On,Rs;class Lu{constructor(e={}){v(this,On);v(this,Rs);const{window:n=qu,document:s=n?.document}=e;n!==void 0&&(_(this,On,s),_(this,Rs,Xo(r=>{const o=Bo(n,"focusin",r),i=Bo(n,"focusout",r);return()=>{o(),i()}})))}get current(){var e;return(e=a(this,Rs))==null||e.call(this),a(this,On)?ju(a(this,On)):null}}On=new WeakMap,Rs=new WeakMap;new Lu;function Uu(t){return typeof t=="function"}function xu(t,e){if(Uu(t)){const s=t();return s===void 0?e:s}return t===void 0?e:t}function Bu(t,e){let n=D(null);const s=Y(()=>xu(e,250));function r(...o){if(f(n))f(n).timeout&&clearTimeout(f(n).timeout);else{let i,c;const l=new Promise((u,d)=>{i=u,c=d});g(n,{timeout:null,runner:null,promise:l,resolve:i,reject:c},!0)}return f(n).runner=async()=>{if(!f(n))return;const i=f(n);g(n,null);try{i.resolve(await t.apply(this,o))}catch(c){i.reject(c)}},f(n).timeout=setTimeout(f(n).runner,f(s)),f(n).promise}return r.cancel=async()=>{(!f(n)||f(n).timeout===null)&&(await new Promise(o=>setTimeout(o,0)),!f(n)||f(n).timeout===null)||(clearTimeout(f(n).timeout),f(n).reject("Cancelled"),g(n,null))},r.runScheduledNow=async()=>{(!f(n)||!f(n).timeout)&&(await new Promise(o=>setTimeout(o,0)),!f(n)||!f(n).timeout)||(clearTimeout(f(n).timeout),f(n).timeout=null,await f(n).runner?.())},Object.defineProperty(r,"pending",{enumerable:!0,get(){return!!f(n)?.timeout}}),r}function rc(t,e){switch(e){case"kg":case"l.":return Math.round(t*100)/100;case"gr.":case"ml":return Math.round(t);default:return Math.round(t*10)/10}}function ct(t){return t?.length?t.map(e=>an(e.q,e.u)).join(" et "):"-"}function Hu(t,e){const n=typeof t=="number"?t:parseFloat(t);if(isNaN(n))return{value:0,unit:e};let s=e,r=n;return(e==="gr."||e==="ml")&&n>=1e3?(r=n/1e3,s=e==="gr."?"kg":"l."):(e==="kg"||e==="l.")&&n<1&&n>0&&(r=n*1e3,s=e==="kg"?"gr.":"ml"),{value:rc(r,s),unit:s}}function an(t,e){const{value:n,unit:s}=Hu(t,e);let r;return s==="kg"||s==="l."?r=n.toFixed(2).replace(/\.?0+$/,""):r=n.toString(),`${r} ${s}`}function hp(t,e,n){if(e==="au goÃ»t")return{quantity:t,unit:e,formatted:`${t} ${e}`,formattedNumber:`${t}`};const s=t*n,{q:r,u:o}=zu(s,e),i=rc(r,o);let c=`${i}`;return(o==="kg"||o==="l.")&&(c=i.toFixed(2).replace(/\.?0+$/,"")),{quantity:i,unit:o,formatted:`${c} ${o}`,formattedNumber:c}}function zu(t,e){const n=e.toLowerCase().trim();return(n==="gr."||n==="ml")&&t>=1e3?{q:t/1e3,u:n==="gr."?"kg":"l."}:(n==="kg"||n==="l.")&&t<1&&t>0?{q:t*1e3,u:n==="kg"?"gr.":"ml"}:{q:t,u:e}}function Ho(t){if(!t?.length)return[];const e=new Map;return t.forEach(({q:n,u:s})=>{if(typeof n=="number"&&!isNaN(n)){const r=e.get(s)||0;e.set(s,r+n)}}),Array.from(e.entries()).map(([n,s])=>({q:s,u:n}))}function Ou(t,e){const n=new Map,s=new Map;t.forEach(({q:i,u:c})=>{n.set(c,(n.get(c)||0)+i)}),e.forEach(({q:i,u:c})=>{s.set(c,(s.get(c)||0)+i)});const r=[],o=new Set([...n.keys(),...s.keys()]);for(const i of o){const c=n.get(i)||0,l=s.get(i)||0,u=c-l;Math.abs(u)>.001&&r.push({q:u,u:i})}return r}function Gt(t){if(!t?.trim())return null;try{return JSON.parse(t)}catch(e){return console.warn("[ProductsStore] Erreur parsing JSON:",e),null}}function si(t){return t?.length?t.filter(e=>e.quantity!=null&&e.unit).map(e=>({q:typeof e.quantity=="number"?e.quantity:parseFloat(e.quantity),u:e.unit})).filter(e=>!isNaN(e.q)):[]}function ri(t){if(!t?.length)return[];const e=new Map;return t.forEach(n=>{if(!n.q||!n.u||typeof n.q!="number"||isNaN(n.q))return;const s=e.get(n.u)||0;e.set(n.u,s+n.q)}),Array.from(e.entries()).map(([n,s])=>({q:s,u:n}))}function mo(t,e){if(!t?.length)return{numeric:[],display:"â Complet"};if(!e?.length){const c=t.map(l=>an(l.q,l.u)).join(" et ");return{numeric:t,display:c}}const n=new Map,s=new Map;t.forEach(c=>{const l=parseFloat(c.q);isNaN(l)||n.set(c.u,(n.get(c.u)||0)+l)}),e.forEach(c=>{s.set(c.u,(s.get(c.u)||0)+c.q)});const r=[],o=[];n.forEach((c,l)=>{const u=s.get(l)||0,d=c-u;d>0&&(r.push({q:d,u:l}),o.push(an(d,l)))});const i=o.length>0?o.join(" et "):"â Complet";return{numeric:r,display:i}}function Wu(t){return t?Object.values(t).some(e=>e.recipes?.some(n=>n.q!==void 0||n.u!==void 0)):!1}function mp(t){if(!t)return[];const e=[];return Object.entries(t).forEach(([n,s])=>{s.recipes?.forEach(r=>{e.push({...r,date:n,dateTimeService:n})})}),e}function Gu(t){if(!t?.length)return"ÃquilibrÃ©";const e=t.filter(s=>s.q>0),n=t.filter(s=>s.q<0);if(e.length>0&&n.length>0){const s=e.map(o=>an(o.q,o.u)).join(" et "),r=n.map(o=>an(Math.abs(o.q),o.u)).join(" et ");return`${s} disponibles, ${r} manquant${n.length>1?"s":""}`}else return e.length>0?e.map(s=>"+"+an(s.q,s.u)).join(" et ")+" disponibles":n.length>0?n.map(s=>an(Math.abs(s.q),s.u)).join(" et ")+` manquant${n.length>1?"s":""}`:"ÃquilibrÃ©"}function Vu(t,e){if(e.searchQuery.trim()){const s=e.searchQuery.toLowerCase();if(!t.productName.toLowerCase().includes(s))return!1}if(e.selectedStores.length>0&&(!t.storeInfo?.storeName||!e.selectedStores.includes(t.storeInfo.storeName))||e.selectedWho.length>0&&(!t.who||!t.who.some(s=>e.selectedWho.includes(s)))||e.selectedProductTypes.length>0&&(!t.productType||!e.selectedProductTypes.includes(t.productType)))return!1;const n=e.temperatureFilter;if(n&&n!=="all")switch(n){case"frais":if(!t.pF)return!1;break;case"not-frais":if(t.pF)return!1;break;case"surgele":if(!t.pS)return!1;break;case"not-surgele":if(t.pS)return!1;break}return!0}function oc(t){return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function Qu(t,e,n=.01){if(!t?.length&&!e?.length)return!0;if(!t?.length||!e?.length)return!1;const s=new Map(t.map(c=>[c.u,c.q])),r=new Map(e.map(c=>[c.u,c.q])),o=Array.from(s.keys()).sort(),i=Array.from(r.keys()).sort();if(o.length!==i.length||!o.every((c,l)=>c===i[l]))return!1;for(const[c,l]of s){const u=r.get(c);if(u===void 0)return!1;const d=Math.abs(l-u),p=Math.max(l,u),h=Math.max(p*n,1);if(d>h)return!1}return!0}function gp(t){const e=t.totalNeededOverrideParsed;if(!e)return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};if(!(e.totalComputedWhenOverride!==void 0&&e.platesNbWhenOverride!==void 0&&e.recipesNbWhenOverride!==void 0))return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};const s=e.totalComputedWhenOverride,r=t.totalNeededArray,o=e.platesNbWhenOverride,i=t.totalAssiettes,c=e.recipesNbWhenOverride,l=t.nbRecipes,u=!Qu(s,r),d=o!==i,p=c!==l,h=u||d||p;return{hasMismatch:h,computedChanged:u,platesChanged:d,recipesChanged:p,details:h?{oldComputed:s,newComputed:r,oldPlates:o,newPlates:i,oldRecipes:c,newRecipes:l}:void 0}}function Hi(t){return{...t,products:t.products?.map(e=>typeof e=="string"?e:e.$id)||[],mainId:t.mainId}}class oi{static normalize(e,n,s=""){const r=n.toLowerCase(),o=s.toLowerCase(),i=r.includes("caf"),c=r.includes("soupe"),l=r.includes("pinc"),u=r.includes("gousse"),d=r.includes("tÃªte"),p=r.includes("unit")||r==="piÃ¨ce"||r==="piece",h=o.includes("sucre"),m=o.includes("sel"),y=o.includes("farine"),I=o.includes("crÃ¨me Ã©paisse")||o.includes("creme epaisse"),E=o==="ail",A=o.includes("oignon"),T=o==="tomate",R=o==="poireau",M=o.includes("aubergine"),B=o==="courgette",q=o==="Ã©chalote"||o==="echalote",j=o==="orange"&&!o.includes("jus"),ce=o.includes("citron")&&!o.includes("jus"),_e=o==="concombre",rs=o==="levure chimique",Pn=o==="carotte",Je=o==="betterave rouge",os=o.includes("semoule"),Dn=o.includes("poivre"),Tt=o.includes("cacao"),$n=o.includes("sucre glace"),br=o.includes("maizena")||o.includes("maÃ¯zena"),Ir=o.includes("bicarbonate"),ui=o.includes("curcuma"),di=o.includes("cumin"),fi=o.includes("curry"),pi=o.includes("muscade"),hi=o.includes("paprika"),mi=o.includes("miel");let dt=e,Mn=n,Ke=!1,tn="",H="";if(i){Ke=!0;let $="cafe_default";H="ml",h?($="cafe_sucre",H="gr."):m?($="cafe_sel",H="gr."):y?($="cafe_farine",H="gr."):os?($="cafe_semoule",H="gr."):Dn?($="cafe_poivre",H="gr."):Tt?($="cafe_cacao",H="gr."):$n?($="cafe_sucre_glace",H="gr."):br?($="cafe_maizena",H="gr."):Ir?($="cafe_bicarbonate",H="gr."):ui?($="cafe_curcuma",H="gr."):di?($="cafe_cumin",H="gr."):fi?($="cafe_curry",H="gr."):pi?($="cafe_muscade",H="gr."):hi?($="cafe_paprika",H="gr."):mi?($="cafe_miel",H="gr."):I&&($="cafe_creme_epaisse",H="ml"),dt=e*this.CONVERSION_RULES[$],tn=`1 c. Ã  cafÃ© = ${this.CONVERSION_RULES[$]} ${H}`}else if(c){Ke=!0;let $="soupe_default";H="ml",h?($="soupe_sucre",H="gr."):m?($="soupe_sel",H="gr."):y?($="soupe_farine",H="gr."):os?($="soupe_semoule",H="gr."):Dn?($="soupe_poivre",H="gr."):Tt?($="soupe_cacao",H="gr."):$n?($="soupe_sucre_glace",H="gr."):br?($="soupe_maizena",H="gr."):I?($="soupe_creme_epaisse",H="ml"):Ir?($="soupe_bicarbonate",H="gr."):ui?($="soupe_curcuma",H="gr."):di?($="soupe_cumin",H="gr."):fi?($="soupe_curry",H="gr."):pi?($="soupe_muscade",H="gr."):hi?($="soupe_paprika",H="gr."):mi&&($="soupe_miel",H="gr."),dt=e*this.CONVERSION_RULES[$],tn=`1 c. Ã  soupe = ${this.CONVERSION_RULES[$]} ${H}`}else if(l)Ke=!0,H="gr.",dt=e*this.CONVERSION_RULES.pincee,tn="1 pincÃ©e = 0.4 gr.";else if(u&&E)Ke=!0,H="gr.",dt=e*this.CONVERSION_RULES.gousse_ail,tn="1 gousse = 6.5 gr.";else if(d&&E)Ke=!0,H="gr.",dt=e*this.CONVERSION_RULES.tete_ail,tn="1 tÃªte = 80 gr.";else if(p){Ke=!0,H="gr.";let $="";A?$="unite_oignon":E?$="unite_ail":T?$="unite_tomate":R?$="unite_poireau":M?$="unite_aubergine":B?$="unite_courgette":q?$="unite_eshalote":j?$="unite_orange":ce?$="unite_citron":_e?$="unite_concombre":rs?$="unite_levure_chimique":Pn?$="unite_carotte":Je?$="unite_betterave_rouge":Ke=!1,Ke&&(dt=e*this.CONVERSION_RULES[$],tn=`1 unitÃ© = ${this.CONVERSION_RULES[$]} gr.`)}return Ke?Mn=H:r==="kg"?(dt=e*1e3,Mn="gr."):r==="l."?(dt=e*1e3,Mn="ml"):r==="gr."?Mn="gr.":r==="ml"&&(Mn="ml"),{quantity:dt,unit:Mn,originalUnit:n,ruleUsed:tn,hasConversion:Ke}}}k(oi,"CONVERSION_RULES",{cafe_sucre:5,cafe_sel:5,cafe_farine:3,cafe_semoule:4,cafe_poivre:2.5,cafe_cacao:2.5,cafe_sucre_glace:3,cafe_maizena:3,cafe_bicarbonate:5,cafe_curcuma:2,cafe_cumin:2,cafe_curry:2,cafe_muscade:2,cafe_paprika:2,cafe_miel:10,cafe_creme_epaisse:5,cafe_default:5,soupe_sucre:15,soupe_sel:15,soupe_farine:10,soupe_semoule:12,soupe_poivre:8,soupe_cacao:8,soupe_sucre_glace:9,soupe_maizena:10,soupe_creme_epaisse:15,soupe_bicarbonate:15,soupe_curcuma:6,soupe_cumin:6,soupe_curry:6,soupe_muscade:7,soupe_paprika:6,soupe_miel:30,soupe_default:15,pincee:.4,gousse_ail:6.5,tete_ail:80,unite_oignon:120,unite_ail:6.5,unite_tomate:120,unite_poireau:150,unite_aubergine:250,unite_courgette:200,unite_eshalote:30,unite_orange:200,unite_citron:100,unite_concombre:200,unite_levure_chimique:11,unite_carotte:125,unite_betterave_rouge:250});const ic=2;function Ju(t){const n=new Date(t).getHours();return n>=11&&n<=13?"sun":n>=19&&n<=21?"moon":n>=7&&n<=9?"cloud":null}function Ku(t){return{formattedDate:new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),timeIcon:Ju(t)}}function Yu(t){const e={};for(const n of t)e[n]=Ku(n);return e}function Xu(t,e,n){if(!t.byDate)return{requiredQuantities:[],requiredQuantitiesFormatted:"-",stockBalance:[],availableStockQuantities:[],missingStockQuantities:[],availableStockFormatted:"-",missingStockFormatted:"-",hasAvailableStock:!1,hasMissingStock:!1,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map};const s=new Date(e);s.setHours(0,0,0,0);const r=new Date(n);r.setHours(23,59,59,999);const o=[],i=new Map,c=new Map;let l=0,u=0;for(const[T,R]of Object.entries(t.byDate)){const M=new Date(T);M>=s&&M<=r&&(o.push(T),l+=R.totalAssiettes||0,R.recipes?.length&&(i.set(T,R.recipes),u+=R.recipes.length),R.totalConsolidated&&R.totalConsolidated.forEach(({q:B,u:q})=>{c.set(q,(c.get(q)||0)+B)}))}const d=Array.from(c.entries()).map(([T,R])=>({q:R,u:T})),p=d.length>0?ct(d):"-",h=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:d,m=Zu(t,e,n,h),y=m.filter(T=>T.q>0),I=new Date().toISOString().split("T")[0],A=n<I?[]:m.filter(T=>T.q<0);return{requiredQuantities:d,requiredQuantitiesFormatted:p,stockBalance:m,availableStockQuantities:y,missingStockQuantities:A,availableStockFormatted:Gu(m),missingStockFormatted:ct(A.map(T=>({q:Math.abs(T.q),u:T.u}))),hasAvailableStock:y.length>0,hasMissingStock:A.length>0,totalRecipesInRange:u,totalPortionsInRange:l,datesInSelectedRange:o,recipesByDate:i}}function Zu(t,e,n,s){let r=[],o="";t.stockParsed?.dateTime&&t.stockParsed.dateTime<=e&&(r=[{q:parseFloat(t.stockParsed.quantity),u:t.stockParsed.unit}],o=t.stockParsed.dateTime);const i=[];if(t.purchases)for(const u of t.purchases)Fu(u,e,n,o)&&i.push({q:u.quantity,u:u.unit});const c=[...r,...i],l=Ho(c);return Ou(l,s)}function Fu(t,e,n,s=""){if(t.status==="cancelled")return!1;const r=t.deliveryDate||t.$createdAt;if(!r)return!1;const o=new Date(n);return o.setHours(o.getHours()+ic),!(o<new Date||r>o.toISOString()||s&&t.$createdAt<s)}function ed(t){const e=Gt(t.specs)??null,n=ri(si(t.purchases??[]));let s=[];e?.quantity&&(s=[e.quantity]);const r=Gt(t.totalNeededOverride),o=r?[r.totalOverride]:s,{numeric:i,display:c}=mo(o,n);let l=Gt(t.stockReel)??null;if(l&&l.quantity&&l.unit){const h=oi.normalize(parseFloat(l.quantity),l.unit);l={...l,quantity:h.quantity,unit:h.unit}}const u=ct(n),d=t.store?Gt(t.store):null,p=l?`${l.quantity} ${l.unit}`:u;return{$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,productHugoUuid:t.productHugoUuid||"",productName:t.productName,productType:t.productType||"none",pF:e?.pF??!1,pS:e?.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:t.isSynced,mainId:t.mainId,totalNeededRaw:[],status:t.status,who:t.who,store:t.store,stockReel:t.stockReel,previousNames:t.previousNames,isMerged:t.isMerged,mergedFrom:t.mergedFrom,mergeDate:t.mergeDate,mergeReason:t.mergeReason,mergedInto:t.mergedInto,totalNeededOverride:t.totalNeededOverride,purchases:t.purchases,specs:t.specs,byDate:{},storeInfo:d,stockParsed:l,specsParsed:e,totalNeededArray:s,totalPurchasesArray:n,missingQuantityArray:i,stockOrTotalPurchases:p,displayTotalNeeded:ct(s),displayTotalPurchases:u,displayMissingQuantity:c,totalNeededOverrideParsed:r,displayTotalOverride:r?ct([r.totalOverride]):"",dateDisplayInfo:{}}}function Ar(t,e){const n=t.purchases??e.purchases,s=t.specs??e.specs,r=s?Gt(s):e.specsParsed,o=ri(si(n??[])),i=ct(o);let c=e.totalNeededArray;!e.productHugoUuid&&r?.quantity&&(c=[r.quantity]);const l=Gt(t.totalNeededOverride??e.totalNeededOverride),u=l?[l.totalOverride]:c,{numeric:d,display:p}=mo(u,o),h=t.stockReel??e.stockReel;let m=h?Gt(h):e.stockParsed;if(m&&m.quantity&&m.unit){const A=oi.normalize(parseFloat(m.quantity),m.unit);m={...m,quantity:A.quantity,unit:A.unit}}const y=t.store??e.store,I=y?Gt(y):e.storeInfo,E=m?`${m.quantity} ${m.unit}`:i;return t.purchases===void 0&&e.purchases?.length&&console.log(`[ProductsStore] Fusion intelligente : prÃ©servation de ${e.purchases.length} purchases pour ${e.productName}`),{...e,$updatedAt:t.$updatedAt,productName:t.productName??e.productName,productType:t.productType??e.productType,isSynced:t.isSynced??e.isSynced,mainId:t.mainId??e.mainId,pF:r?.pF??e.pF,pS:r?.pS??e.pS,status:t.status??e.status,who:t.who??e.who,store:y,stockReel:h,specs:s,purchases:n,previousNames:t.previousNames??e.previousNames,isMerged:t.isMerged??e.isMerged,mergedFrom:t.mergedFrom??e.mergedFrom,mergeDate:t.mergeDate??e.mergeDate,mergeReason:t.mergeReason??e.mergeReason,mergedInto:t.mergedInto??e.mergedInto,totalNeededOverride:t.totalNeededOverride??e.totalNeededOverride,storeInfo:I,stockParsed:m,specsParsed:r,totalNeededArray:c,totalPurchasesArray:o,missingQuantityArray:d,stockOrTotalPurchases:E,displayTotalPurchases:i,displayMissingQuantity:p,displayTotalNeeded:ct(c),totalNeededOverrideParsed:l,displayTotalOverride:l?ct([l.totalOverride]):""}}function td(t){t.totalPurchasesArray=ri(si(t.purchases??[]));const e=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray,{numeric:n,display:s}=mo(e,t.totalPurchasesArray);t.missingQuantityArray=n,t.displayMissingQuantity=s}async function zi(t,e,n){console.log(`[productEnrichment] Calcul pour Ã©vÃ©nement ${t.$id} avec ${t.meals.length} repas`);const s=new Map;for(const o of t.meals)await nd(o,e,s);const r=[];for(const[o,i]of s)r.push(rd(i,n));return console.log(`[productEnrichment] ${r.length} produits calculÃ©s`),r}async function nd(t,e,n){const s=t.date;for(const r of t.recipes){const o=await e(r.recipeUuid);if(!o){console.warn(`[processMeal] Recette ${r.recipeUuid} introuvable`);continue}const i=r.plates/o.plate;for(const c of o.ingredients)sd(c,i,s,n,o.title,r.plates)}}function sd(t,e,n,s,r,o){const i=t.uuid;s.has(i)||s.set(i,{productHugoUuid:i,productName:t.name,productType:t.type,pF:t.pF??!1,pS:t.pS??!1,byDate:{},allergens:new Set(t.allergens||[])});const c=s.get(i),l=t.normalizedUnit==="au goÃ»t"?t.normalizedQuantity:t.normalizedQuantity*e,u=t.normalizedUnit==="au goÃ»t"?t.originalQuantity:t.originalQuantity*e;c.byDate[n]||(c.byDate[n]={quantities:[],recipes:[],totalAssiettes:0});const d=c.byDate[n];d.quantities.push({q:l,u:t.normalizedUnit}),d.recipes.push({r,q:u,u:t.originalUnit,qEq:l,uEq:t.normalizedUnit,a:o}),d.totalAssiettes+=o,t.allergens&&t.allergens.forEach(p=>c.allergens.add(p))}function rd(t,e){const n=oc(t.productName).substring(0,20),s=e.slice(-10),r=`${n}_${s}`,o={};for(const[A,T]of Object.entries(t.byDate))o[A]={totalConsolidated:Ho(T.quantities),recipes:T.recipes,totalAssiettes:T.totalAssiettes,recipeCount:T.recipes.length};const i=Object.values(o).flatMap(A=>A.totalConsolidated),c=Ho(i),l=[],u=[],d=c,{numeric:p,display:h}=mo(d,l),m=Object.values(o).reduce((A,T)=>A+T.recipeCount,0),y=Object.values(o).reduce((A,T)=>A+T.totalAssiettes,0),I=Yu(Object.keys(o));return{$id:r,mainId:e,productHugoUuid:t.productHugoUuid,productName:t.productName,productType:t.productType,byDate:o,totalNeededArray:c,totalPurchasesArray:l,missingQuantityArray:p,displayTotalNeeded:ct(c),displayTotalPurchases:ct(l),displayMissingQuantity:h,isSynced:!1,status:"active",who:[],store:"",storeInfo:null,purchases:u,stockReel:"",stockParsed:null,totalNeededOverride:null,totalNeededOverrideParsed:null,displayTotalOverride:"",stockOrTotalPurchases:"",previousNames:null,isMerged:!1,mergedFrom:[],mergeDate:null,mergeReason:null,mergedInto:null,specs:null,specsParsed:null,pF:t.pF??!1,pS:t.pS??!1,nbRecipes:m,totalAssiettes:y,totalNeededRaw:c,dateDisplayInfo:I,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],$databaseId:"",$tableId:""}}const od={loading:0,success:2e3,info:3e3,warning:5e3,error:0},id=2;var te,En,ac,zo;class ad{constructor(){v(this,En);v(this,te,D(oe([])));k(this,"MAX_TOASTS",3)}get toasts(){return[...f(a(this,te))].sort((e,n)=>n.timestamp-e.timestamp)}create(e){const n=e.id||crypto.randomUUID(),s={id:n,state:e.state,message:e.message,timestamp:Date.now(),source:e.source||"user",position:e.position,timeoutId:void 0,autoCloseDelay:e.autoCloseDelay,details:e.details,actions:e.actions||[]};return S(this,En,ac).call(this,s),n}update(e,n){const s=f(a(this,te)).findIndex(o=>o.id===e);if(s===-1)return;const r=f(a(this,te))[s];r.timeoutId&&clearTimeout(r.timeoutId),f(a(this,te))[s]={...r,state:n.state||r.state,message:n.message||r.message,source:n.source||r.source,position:n.position||r.position,actions:n.actions||r.actions,autoCloseDelay:n.autoCloseDelay!==void 0?n.autoCloseDelay:r.autoCloseDelay},S(this,En,zo).call(this,f(a(this,te))[s])}async track(e,n){const s=this.create({id:n.id,state:"loading",message:n.loading,source:"user",position:n.position});try{const r=await e;return this.update(s,{state:"success",message:n.success||"OpÃ©ration rÃ©ussie",autoCloseDelay:n.successDelay}),r}catch(r){throw this.update(s,{state:"error",message:n.error||"Erreur lors de l'opÃ©ration",autoCloseDelay:n.errorDelay}),r}}dismiss(e){const n=f(a(this,te)).findIndex(r=>r.id===e);if(n===-1)return;const s=f(a(this,te))[n];s.timeoutId&&clearTimeout(s.timeoutId),f(a(this,te)).splice(n,1)}dismissAll(){f(a(this,te)).forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId)}),g(a(this,te),[],!0)}success(e,n){return this.create({state:"success",message:e,details:n?.details,autoCloseDelay:n?.autoCloseDelay,position:n?.position})}error(e,n){return this.create({state:"error",message:e,details:n?.details,autoCloseDelay:n?.autoCloseDelay,position:n?.position})}warning(e,n){return this.create({state:"warning",message:e,source:n?.source||"system",details:n?.details,actions:n?.actions,autoCloseDelay:n?.autoCloseDelay,position:n?.position})}info(e,n){return this.create({state:"info",message:e,source:n?.source||"system",details:n?.details,autoCloseDelay:n?.autoCloseDelay,position:n?.position})}loading(e,n){return this.create({state:"loading",message:e,details:n?.details,autoCloseDelay:n?.autoCloseDelay,position:n?.position})}}te=new WeakMap,En=new WeakSet,ac=function(e){const n=f(a(this,te)).findIndex(s=>s.source===e.source);if(n>=0){const s=f(a(this,te))[n];s.timeoutId&&clearTimeout(s.timeoutId),f(a(this,te))[n]=e}else if(f(a(this,te)).length<this.MAX_TOASTS)f(a(this,te)).push(e);else{const s=f(a(this,te))[0];s.timeoutId&&clearTimeout(s.timeoutId),f(a(this,te)).shift(),f(a(this,te)).push(e)}S(this,En,zo).call(this,e)},zo=function(e){e.timeoutId&&clearTimeout(e.timeoutId);let n;if(e.autoCloseDelay!==void 0)n=e.autoCloseDelay===0?void 0:e.autoCloseDelay;else{const s=od[e.state];e.source==="realtime-other"&&s>0?n=s*id:n=s===0?void 0:s}n!==void 0&&(e.timeoutId=setTimeout(()=>{this.dismiss(e.id)},n))};const wt=new ad;function Ao(t,e,n,s){function r(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function c(d){try{u(s.next(d))}catch(p){i(p)}}function l(d){try{u(s.throw(d))}catch(p){i(p)}}function u(d){d.done?o(d.value):r(d.value).then(c,l)}u((s=s.apply(t,[])).next())})}function cd(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?s:n==="a"?s.call(t):s?s.value:e.get(t)}class b{constructor(e,n,s){this.method=e,this.attribute=n,s!==void 0&&(Array.isArray(s)?this.values=s:this.values=[s])}toString(){return JSON.stringify({method:this.method,attribute:this.attribute,values:this.values})}}b.equal=(t,e)=>new b("equal",t,e).toString();b.notEqual=(t,e)=>new b("notEqual",t,e).toString();b.lessThan=(t,e)=>new b("lessThan",t,e).toString();b.lessThanEqual=(t,e)=>new b("lessThanEqual",t,e).toString();b.greaterThan=(t,e)=>new b("greaterThan",t,e).toString();b.greaterThanEqual=(t,e)=>new b("greaterThanEqual",t,e).toString();b.isNull=t=>new b("isNull",t).toString();b.isNotNull=t=>new b("isNotNull",t).toString();b.between=(t,e,n)=>new b("between",t,[e,n]).toString();b.startsWith=(t,e)=>new b("startsWith",t,e).toString();b.endsWith=(t,e)=>new b("endsWith",t,e).toString();b.select=t=>new b("select",void 0,t).toString();b.search=(t,e)=>new b("search",t,e).toString();b.orderDesc=t=>new b("orderDesc",t).toString();b.orderAsc=t=>new b("orderAsc",t).toString();b.orderRandom=()=>new b("orderRandom").toString();b.cursorAfter=t=>new b("cursorAfter",void 0,t).toString();b.cursorBefore=t=>new b("cursorBefore",void 0,t).toString();b.limit=t=>new b("limit",void 0,t).toString();b.offset=t=>new b("offset",void 0,t).toString();b.contains=(t,e)=>new b("contains",t,e).toString();b.notContains=(t,e)=>new b("notContains",t,e).toString();b.notSearch=(t,e)=>new b("notSearch",t,e).toString();b.notBetween=(t,e,n)=>new b("notBetween",t,[e,n]).toString();b.notStartsWith=(t,e)=>new b("notStartsWith",t,e).toString();b.notEndsWith=(t,e)=>new b("notEndsWith",t,e).toString();b.createdBefore=t=>b.lessThan("$createdAt",t);b.createdAfter=t=>b.greaterThan("$createdAt",t);b.createdBetween=(t,e)=>b.between("$createdAt",t,e);b.updatedBefore=t=>b.lessThan("$updatedAt",t);b.updatedAfter=t=>b.greaterThan("$updatedAt",t);b.updatedBetween=(t,e)=>b.between("$updatedAt",t,e);b.or=t=>new b("or",void 0,t.map(e=>JSON.parse(e))).toString();b.and=t=>new b("and",void 0,t.map(e=>JSON.parse(e))).toString();b.distanceEqual=(t,e,n,s=!0)=>new b("distanceEqual",t,[[e,n,s]]).toString();b.distanceNotEqual=(t,e,n,s=!0)=>new b("distanceNotEqual",t,[[e,n,s]]).toString();b.distanceGreaterThan=(t,e,n,s=!0)=>new b("distanceGreaterThan",t,[[e,n,s]]).toString();b.distanceLessThan=(t,e,n,s=!0)=>new b("distanceLessThan",t,[[e,n,s]]).toString();b.intersects=(t,e)=>new b("intersects",t,[e]).toString();b.notIntersects=(t,e)=>new b("notIntersects",t,[e]).toString();b.crosses=(t,e)=>new b("crosses",t,[e]).toString();b.notCrosses=(t,e)=>new b("notCrosses",t,[e]).toString();b.overlaps=(t,e)=>new b("overlaps",t,[e]).toString();b.notOverlaps=(t,e)=>new b("notOverlaps",t,[e]).toString();b.touches=(t,e)=>new b("touches",t,[e]).toString();b.notTouches=(t,e)=>new b("notTouches",t,[e]).toString();class w extends Error{constructor(e,n=0,s="",r=""){super(e),this.name="AppwriteException",this.message=e,this.code=n,this.type=s,this.response=r}}class ft{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.4.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var e;(e=this.realtime.socket)===null||e===void 0||e.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var e,n,s;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(e=this.realtime.socket)===null||e===void 0||e.close();return}const r=new URLSearchParams;this.config.project&&r.set("project",this.config.project),this.realtime.channels.forEach(i=>{r.append("channels[]",i)});const o=this.config.endpointRealtime+"/realtime?"+r.toString();(o!==this.realtime.url||!this.realtime.socket||((n=this.realtime.socket)===null||n===void 0?void 0:n.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((s=this.realtime.socket)===null||s===void 0?void 0:s.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=o,this.realtime.socket=new WebSocket(o),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",i=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",i=>{var c,l,u;if(!this.realtime.reconnect||((l=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||l===void 0?void 0:l.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,i.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:e=>{var n,s;try{const r=JSON.parse(e.data);switch(this.realtime.lastMessage=r,r.type){case"connected":let o=this.config.session;if(!o){const l=JSON.parse((n=window.localStorage.getItem("cookieFallback"))!==null&&n!==void 0?n:"{}");o=l?.[`a_session_${this.config.project}`]}const i=r.data;o&&!i.user&&((s=this.realtime.socket)===null||s===void 0||s.send(JSON.stringify({type:"authentication",data:{session:o}})));break;case"event":let c=r.data;if(c?.channels){if(!c.channels.some(u=>this.realtime.channels.has(u)))return;this.realtime.subscriptions.forEach(u=>{c.channels.some(d=>u.channels.includes(d))&&setTimeout(()=>u.callback(c))})}break;case"pong":break;case"error":throw r.data;default:break}}catch(r){console.error(r)}},cleanUp:e=>{this.realtime.channels.forEach(n=>{e.includes(n)&&(Array.from(this.realtime.subscriptions).some(([r,o])=>o.channels.includes(n))||this.realtime.channels.delete(n))})}}}setEndpoint(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new w("Invalid endpoint URL: "+e);return this.config.endpoint=e,this.config.endpointRealtime=e.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){if(!e.startsWith("ws://")&&!e.startsWith("wss://"))throw new w("Invalid realtime endpoint URL: "+e);return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}setSession(e){return this.headers["X-Appwrite-Session"]=e,this.config.session=e,this}setDevKey(e){return this.headers["X-Appwrite-Dev-Key"]=e,this.config.devkey=e,this}subscribe(e,n){let s=typeof e=="string"?[e]:e;s.forEach(o=>this.realtime.channels.add(o));const r=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(r,{channels:s,callback:n}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(r),this.realtime.cleanUp(s),this.realtime.connect()}}prepareRequest(e,n,s={},r={}){if(e=e.toUpperCase(),s=Object.assign({},this.headers,s),typeof window<"u"&&window.localStorage){const i=window.localStorage.getItem("cookieFallback");i&&(s["X-Fallback-Cookies"]=i)}let o={method:e,headers:s};if(s["X-Appwrite-Dev-Key"]===void 0&&(o.credentials="include"),e==="GET")for(const[i,c]of Object.entries(ft.flatten(r)))n.searchParams.append(i,c);else switch(s["content-type"]){case"application/json":o.body=JSON.stringify(r);break;case"multipart/form-data":const i=new FormData;for(const[c,l]of Object.entries(r))if(l instanceof File)i.append(c,l,l.name);else if(Array.isArray(l))for(const u of l)i.append(`${c}[]`,u);else i.append(c,l);o.body=i,delete s["content-type"];break}return{uri:n.toString(),options:o}}chunkedUpload(e,n,s={},r={},o){var i;return Ao(this,void 0,void 0,function*(){const[c,l]=(i=Object.entries(r).find(([p,h])=>h instanceof File))!==null&&i!==void 0?i:[];if(!l||!c)throw new Error("File not found in payload");if(l.size<=ft.CHUNK_SIZE)return yield this.call(e,n,s,r);let u=0,d=null;for(;u<l.size;){let p=u+ft.CHUNK_SIZE;p>=l.size&&(p=l.size),s["content-range"]=`bytes ${u}-${p-1}/${l.size}`;const h=l.slice(u,p);let m=Object.assign({},r);m[c]=new File([h],l.name),d=yield this.call(e,n,s,m),o&&typeof o=="function"&&o({$id:d.$id,progress:Math.round(p/l.size*100),sizeUploaded:p,chunksTotal:Math.ceil(l.size/ft.CHUNK_SIZE),chunksUploaded:Math.ceil(p/ft.CHUNK_SIZE)}),d&&d.$id&&(s["x-appwrite-id"]=d.$id),u=p}return d})}ping(){return Ao(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(e,n,s={},r={},o="json"){var i,c;return Ao(this,void 0,void 0,function*(){const{uri:l,options:u}=this.prepareRequest(e,n,s,r);let d=null;const p=yield fetch(l,u);if(p.type==="opaque")throw new w(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const h=p.headers.get("x-appwrite-warning");if(h&&h.split(";").forEach(y=>console.warn("Warning: "+y)),!((i=p.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?d=yield p.json():o==="arrayBuffer"?d=yield p.arrayBuffer():d={message:yield p.text()},400<=p.status){let y="";throw!((c=p.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||o==="arrayBuffer"?y=JSON.stringify(d):y=d?.message,new w(d?.message,p.status,d?.type,y)}const m=p.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&m&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",m)),d})}static flatten(e,n=""){let s={};for(const[r,o]of Object.entries(e)){let i=n?n+"["+r+"]":r;Array.isArray(o)?s=Object.assign(Object.assign({},s),ft.flatten(o,i)):s[i]=o}return s}}ft.CHUNK_SIZE=1024*1024*5;class ws{constructor(e){this.client=e}static flatten(e,n=""){let s={};for(const[r,o]of Object.entries(e)){let i=n?n+"["+r+"]":r;Array.isArray(o)?s=Object.assign(Object.assign({},s),ws.flatten(o,i)):s[i]=o}return s}}ws.CHUNK_SIZE=5*1024*1024;class ld{constructor(e){this.client=e}get(){const e="/account",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}create(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:n[0],password:n[1],name:n[2]};const r=s.userId,o=s.email,i=s.password,c=s.name;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "email"');if(typeof i>"u")throw new w('Missing required parameter: "password"');const l="/account",u={};typeof r<"u"&&(u.userId=r),typeof o<"u"&&(u.email=o),typeof i<"u"&&(u.password=i),typeof c<"u"&&(u.name=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("post",d,p,u)}updateEmail(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:n[0]};const r=s.email,o=s.password;if(typeof r>"u")throw new w('Missing required parameter: "email"');if(typeof o>"u")throw new w('Missing required parameter: "password"');const i="/account/email",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}listIdentities(e,...n){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:n[0]};const r=s.queries,o=s.total,i="/account/identities",c={};typeof r<"u"&&(c.queries=r),typeof o<"u"&&(c.total=o);const l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}deleteIdentity(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={identityId:e};const s=n.identityId;if(typeof s>"u")throw new w('Missing required parameter: "identityId"');const r="/account/identities/{identityId}".replace("{identityId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createJWT(){const e="/account/jwts",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,n)}listLogs(e,...n){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:n[0]};const r=s.queries,o=s.total,i="/account/logs",c={};typeof r<"u"&&(c.queries=r),typeof o<"u"&&(c.total=o);const l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}updateMFA(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={mfa:e};const s=n.mfa;if(typeof s>"u")throw new w('Missing required parameter: "mfa"');const r="/account/mfa",o={};typeof s<"u"&&(o.mfa=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}createMfaAuthenticator(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?n=e||{}:n={type:e};const s=n.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createMFAAuthenticator(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?n=e||{}:n={type:e};const s=n.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateMfaAuthenticator(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:n[0]};const r=s.type,o=s.otp;if(typeof r>"u")throw new w('Missing required parameter: "type"');if(typeof o>"u")throw new w('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",r),c={};typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAAuthenticator(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:n[0]};const r=s.type,o=s.otp;if(typeof r>"u")throw new w('Missing required parameter: "type"');if(typeof o>"u")throw new w('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",r),c={};typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deleteMfaAuthenticator(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?n=e||{}:n={type:e};const s=n.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}deleteMFAAuthenticator(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?n=e||{}:n={type:e};const s=n.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createMfaChallenge(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?n=e||{}:n={factor:e};const s=n.factor;if(typeof s>"u")throw new w('Missing required parameter: "factor"');const r="/account/mfa/challenge",o={};typeof s<"u"&&(o.factor=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createMFAChallenge(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?n=e||{}:n={factor:e};const s=n.factor;if(typeof s>"u")throw new w('Missing required parameter: "factor"');const r="/account/mfa/challenge",o={};typeof s<"u"&&(o.factor=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateMfaChallenge(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:n[0]};const r=s.challengeId,o=s.otp;if(typeof r>"u")throw new w('Missing required parameter: "challengeId"');if(typeof o>"u")throw new w('Missing required parameter: "otp"');const i="/account/mfa/challenge",c={};typeof r<"u"&&(c.challengeId=r),typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAChallenge(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:n[0]};const r=s.challengeId,o=s.otp;if(typeof r>"u")throw new w('Missing required parameter: "challengeId"');if(typeof o>"u")throw new w('Missing required parameter: "otp"');const i="/account/mfa/challenge",c={};typeof r<"u"&&(c.challengeId=r),typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}listMfaFactors(){const e="/account/mfa/factors",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}listMFAFactors(){const e="/account/mfa/factors",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}getMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}getMFARecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}createMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,n)}createMFARecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,n)}updateMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,n)}updateMFARecoveryCodes(){const e="/account/mfa/recovery-codes",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,n)}updateName(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={name:e};const s=n.name;if(typeof s>"u")throw new w('Missing required parameter: "name"');const r="/account/name",o={};typeof s<"u"&&(o.name=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}updatePassword(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={password:e,oldPassword:n[0]};const r=s.password,o=s.oldPassword;if(typeof r>"u")throw new w('Missing required parameter: "password"');const i="/account/password",c={};typeof r<"u"&&(c.password=r),typeof o<"u"&&(c.oldPassword=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}updatePhone(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={phone:e,password:n[0]};const r=s.phone,o=s.password;if(typeof r>"u")throw new w('Missing required parameter: "phone"');if(typeof o>"u")throw new w('Missing required parameter: "password"');const i="/account/phone",c={};typeof r<"u"&&(c.phone=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}getPrefs(){const e="/account/prefs",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}updatePrefs(e){let n;e&&typeof e=="object"&&!Array.isArray(e)&&"prefs"in e?n=e||{}:n={prefs:e};const s=n.prefs;if(typeof s>"u")throw new w('Missing required parameter: "prefs"');const r="/account/prefs",o={};typeof s<"u"&&(o.prefs=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}createRecovery(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,url:n[0]};const r=s.email,o=s.url;if(typeof r>"u")throw new w('Missing required parameter: "email"');if(typeof o>"u")throw new w('Missing required parameter: "url"');const i="/account/recovery",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.url=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateRecovery(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0],password:n[1]};const r=s.userId,o=s.secret,i=s.password;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');if(typeof i>"u")throw new w('Missing required parameter: "password"');const c="/account/recovery",l={};typeof r<"u"&&(l.userId=r),typeof o<"u"&&(l.secret=o),typeof i<"u"&&(l.password=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("put",u,d,l)}listSessions(){const e="/account/sessions",n={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,n)}deleteSessions(){const e="/account/sessions",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("delete",s,r,n)}createAnonymousSession(){const e="/account/sessions/anonymous",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,n)}createEmailPasswordSession(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:n[0]};const r=s.email,o=s.password;if(typeof r>"u")throw new w('Missing required parameter: "email"');if(typeof o>"u")throw new w('Missing required parameter: "password"');const i="/account/sessions/email",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateMagicURLSession(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/sessions/magic-url",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createOAuth2Session(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:n[0],failure:n[1],scopes:n[2]};const r=s.provider,o=s.success,i=s.failure,c=s.scopes;if(typeof r>"u")throw new w('Missing required parameter: "provider"');const l="/account/sessions/oauth2/{provider}".replace("{provider}",r),u={};typeof o<"u"&&(u.success=o),typeof i<"u"&&(u.failure=i),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[p,h]of Object.entries(ws.flatten(u)))d.searchParams.append(p,h);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}updatePhoneSession(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/sessions/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createSession(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/sessions/token",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}getSession(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={sessionId:e};const s=n.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateSession(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={sessionId:e};const s=n.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}deleteSession(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={sessionId:e};const s=n.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}updateStatus(){const e="/account/status",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,n)}createPushTarget(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:n[0],providerId:n[1]};const r=s.targetId,o=s.identifier,i=s.providerId;if(typeof r>"u")throw new w('Missing required parameter: "targetId"');if(typeof o>"u")throw new w('Missing required parameter: "identifier"');const c="/account/targets/push",l={};typeof r<"u"&&(l.targetId=r),typeof o<"u"&&(l.identifier=o),typeof i<"u"&&(l.providerId=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}updatePushTarget(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:n[0]};const r=s.targetId,o=s.identifier;if(typeof r>"u")throw new w('Missing required parameter: "targetId"');if(typeof o>"u")throw new w('Missing required parameter: "identifier"');const i="/account/targets/{targetId}/push".replace("{targetId}",r),c={};typeof o<"u"&&(c.identifier=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deletePushTarget(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={targetId:e};const s=n.targetId;if(typeof s>"u")throw new w('Missing required parameter: "targetId"');const r="/account/targets/{targetId}/push".replace("{targetId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createEmailToken(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:n[0],phrase:n[1]};const r=s.userId,o=s.email,i=s.phrase;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "email"');const c="/account/tokens/email",l={};typeof r<"u"&&(l.userId=r),typeof o<"u"&&(l.email=o),typeof i<"u"&&(l.phrase=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}createMagicURLToken(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:n[0],url:n[1],phrase:n[2]};const r=s.userId,o=s.email,i=s.url,c=s.phrase;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "email"');const l="/account/tokens/magic-url",u={};typeof r<"u"&&(u.userId=r),typeof o<"u"&&(u.email=o),typeof i<"u"&&(u.url=i),typeof c<"u"&&(u.phrase=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("post",d,p,u)}createOAuth2Token(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:n[0],failure:n[1],scopes:n[2]};const r=s.provider,o=s.success,i=s.failure,c=s.scopes;if(typeof r>"u")throw new w('Missing required parameter: "provider"');const l="/account/tokens/oauth2/{provider}".replace("{provider}",r),u={};typeof o<"u"&&(u.success=o),typeof i<"u"&&(u.failure=i),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[p,h]of Object.entries(ws.flatten(u)))d.searchParams.append(p,h);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}createPhoneToken(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,phone:n[0]};const r=s.userId,o=s.phone;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "phone"');const i="/account/tokens/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.phone=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}createEmailVerification(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={url:e};const s=n.url;if(typeof s>"u")throw new w('Missing required parameter: "url"');const r="/account/verifications/email",o={};typeof s<"u"&&(o.url=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createVerification(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={url:e};const s=n.url;if(typeof s>"u")throw new w('Missing required parameter: "url"');const r="/account/verifications/email",o={};typeof s<"u"&&(o.url=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateEmailVerification(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/verifications/email",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateVerification(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/verifications/email",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createPhoneVerification(){const e="/account/verifications/phone",n={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,n)}updatePhoneVerification(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:n[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "userId"');if(typeof o>"u")throw new w('Missing required parameter: "secret"');const i="/account/verifications/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}class ud{constructor(e){this.client=e}listTransactions(e){let n;!e||e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={queries:e};const s=n.queries,r="/databases/transactions",o={};typeof s<"u"&&(o.queries=s);const i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}createTransaction(e){let n;!e||e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={ttl:e};const s=n.ttl,r="/databases/transactions",o={};typeof s<"u"&&(o.ttl=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}getTransaction(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={transactionId:e};const s=n.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const r="/databases/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateTransaction(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:n[0],rollback:n[1]};const r=s.transactionId,o=s.commit,i=s.rollback;if(typeof r>"u")throw new w('Missing required parameter: "transactionId"');const c="/databases/transactions/{transactionId}".replace("{transactionId}",r),l={};typeof o<"u"&&(l.commit=o),typeof i<"u"&&(l.rollback=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={transactionId:e};const s=n.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const r="/databases/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createOperations(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:n[0]};const r=s.transactionId,o=s.operations;if(typeof r>"u")throw new w('Missing required parameter: "transactionId"');const i="/databases/transactions/{transactionId}/operations".replace("{transactionId}",r),c={};typeof o<"u"&&(c.operations=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listDocuments(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],queries:n[1],transactionId:n[2],total:n[3]};const r=s.databaseId,o=s.collectionId,i=s.queries,c=s.transactionId,l=s.total;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');const u="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",r).replace("{collectionId}",o),d={};typeof i<"u"&&(d.queries=i),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}createDocument(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",r).replace("{collectionId}",o),p={};typeof i<"u"&&(p.documentId=i),typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",h,m,p)}getDocument(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],queries:n[2],transactionId:n[3]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.queries,l=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');const u="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}upsertDocument(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",h,m,p)}updateDocument(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",h,m,p)}deleteDocument(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],transactionId:n[2]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');const l="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("delete",d,p,u)}decrementDocumentAttribute(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],attribute:n[2],value:n[3],min:n[4],transactionId:n[5]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.attribute,l=s.value,u=s.min,d=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "attribute"');const p="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/decrement".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i).replace("{attribute}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.min=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("patch",m,y,h)}incrementDocumentAttribute(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:n[0],documentId:n[1],attribute:n[2],value:n[3],max:n[4],transactionId:n[5]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.attribute,l=s.value,u=s.max,d=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "collectionId"');if(typeof i>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "attribute"');const p="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/increment".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i).replace("{attribute}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.max=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("patch",m,y,h)}}class dd{constructor(e){this.client=e}listExecutions(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,queries:n[0],total:n[1]};const r=s.functionId,o=s.queries,i=s.total;if(typeof r>"u")throw new w('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",r),l={};typeof o<"u"&&(l.queries=o),typeof i<"u"&&(l.total=i);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}createExecution(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,body:n[0],async:n[1],xpath:n[2],method:n[3],headers:n[4],scheduledAt:n[5]};const r=s.functionId,o=s.body,i=s.async,c=s.xpath,l=s.method,u=s.headers,d=s.scheduledAt;if(typeof r>"u")throw new w('Missing required parameter: "functionId"');const p="/functions/{functionId}/executions".replace("{functionId}",r),h={};typeof o<"u"&&(h.body=o),typeof i<"u"&&(h.async=i),typeof c<"u"&&(h.path=c),typeof l<"u"&&(h.method=l),typeof u<"u"&&(h.headers=u),typeof d<"u"&&(h.scheduledAt=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("post",m,y,h)}getExecution(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,executionId:n[0]};const r=s.functionId,o=s.executionId;if(typeof r>"u")throw new w('Missing required parameter: "functionId"');if(typeof o>"u")throw new w('Missing required parameter: "executionId"');const i="/functions/{functionId}/executions/{executionId}".replace("{functionId}",r).replace("{executionId}",o),c={},l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}}class fd{constructor(e){this.client=e}listTransactions(e){let n;!e||e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={queries:e};const s=n.queries,r="/tablesdb/transactions",o={};typeof s<"u"&&(o.queries=s);const i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}createTransaction(e){let n;!e||e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={ttl:e};const s=n.ttl,r="/tablesdb/transactions",o={};typeof s<"u"&&(o.ttl=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}getTransaction(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={transactionId:e};const s=n.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const r="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateTransaction(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:n[0],rollback:n[1]};const r=s.transactionId,o=s.commit,i=s.rollback;if(typeof r>"u")throw new w('Missing required parameter: "transactionId"');const c="/tablesdb/transactions/{transactionId}".replace("{transactionId}",r),l={};typeof o<"u"&&(l.commit=o),typeof i<"u"&&(l.rollback=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={transactionId:e};const s=n.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const r="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createOperations(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:n[0]};const r=s.transactionId,o=s.operations;if(typeof r>"u")throw new w('Missing required parameter: "transactionId"');const i="/tablesdb/transactions/{transactionId}/operations".replace("{transactionId}",r),c={};typeof o<"u"&&(c.operations=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listRows(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],queries:n[1],transactionId:n[2],total:n[3]};const r=s.databaseId,o=s.tableId,i=s.queries,c=s.transactionId,l=s.total;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",r).replace("{tableId}",o),d={};typeof i<"u"&&(d.queries=i),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}createRow(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",r).replace("{tableId}",o),p={};typeof i<"u"&&(p.rowId=i),typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",h,m,p)}getRow(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],queries:n[2],transactionId:n[3]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.queries,l=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}upsertRow(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",h,m,p)}updateRow(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],data:n[2],permissions:n[3],transactionId:n[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",h,m,p)}deleteRow(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],transactionId:n[2]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');const l="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("delete",d,p,u)}decrementRowColumn(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],column:n[2],value:n[3],min:n[4],transactionId:n[5]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.column,l=s.value,u=s.min,d=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "column"');const p="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/decrement".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i).replace("{column}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.min=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("patch",m,y,h)}incrementRowColumn(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:n[0],rowId:n[1],column:n[2],value:n[3],max:n[4],transactionId:n[5]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.column,l=s.value,u=s.max,d=s.transactionId;if(typeof r>"u")throw new w('Missing required parameter: "databaseId"');if(typeof o>"u")throw new w('Missing required parameter: "tableId"');if(typeof i>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "column"');const p="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/increment".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i).replace("{column}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.max=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("patch",m,y,h)}}class pd{constructor(e){this.client=e}list(e,...n){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,search:n[0],total:n[1]};const r=s.queries,o=s.search,i=s.total,c="/teams",l={};typeof r<"u"&&(l.queries=r),typeof o<"u"&&(l.search=o),typeof i<"u"&&(l.total=i);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}create(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:n[0],roles:n[1]};const r=s.teamId,o=s.name,i=s.roles;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "name"');const c="/teams",l={};typeof r<"u"&&(l.teamId=r),typeof o<"u"&&(l.name=o),typeof i<"u"&&(l.roles=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}get(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={teamId:e};const s=n.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const r="/teams/{teamId}".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateName(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:n[0]};const r=s.teamId,o=s.name;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "name"');const i="/teams/{teamId}".replace("{teamId}",r),c={};typeof o<"u"&&(c.name=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}delete(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={teamId:e};const s=n.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const r="/teams/{teamId}".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}listMemberships(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,queries:n[0],search:n[1],total:n[2]};const r=s.teamId,o=s.queries,i=s.search,c=s.total;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');const l="/teams/{teamId}/memberships".replace("{teamId}",r),u={};typeof o<"u"&&(u.queries=o),typeof i<"u"&&(u.search=i),typeof c<"u"&&(u.total=c);const d=new URL(this.client.config.endpoint+l),p={};return this.client.call("get",d,p,u)}createMembership(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,roles:n[0],email:n[1],userId:n[2],phone:n[3],url:n[4],name:n[5]};const r=s.teamId,o=s.roles,i=s.email,c=s.userId,l=s.phone,u=s.url,d=s.name;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "roles"');const p="/teams/{teamId}/memberships".replace("{teamId}",r),h={};typeof i<"u"&&(h.email=i),typeof c<"u"&&(h.userId=c),typeof l<"u"&&(h.phone=l),typeof o<"u"&&(h.roles=o),typeof u<"u"&&(h.url=u),typeof d<"u"&&(h.name=d);const m=new URL(this.client.config.endpoint+p),y={"content-type":"application/json"};return this.client.call("post",m,y,h)}getMembership(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:n[0]};const r=s.teamId,o=s.membershipId;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "membershipId"');const i="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),c={},l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}updateMembership(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:n[0],roles:n[1]};const r=s.teamId,o=s.membershipId,i=s.roles;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "membershipId"');if(typeof i>"u")throw new w('Missing required parameter: "roles"');const c="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),l={};typeof i<"u"&&(l.roles=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteMembership(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:n[0]};const r=s.teamId,o=s.membershipId;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "membershipId"');const i="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),c={},l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("delete",l,u,c)}updateMembershipStatus(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:n[0],userId:n[1],secret:n[2]};const r=s.teamId,o=s.membershipId,i=s.userId,c=s.secret;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "membershipId"');if(typeof i>"u")throw new w('Missing required parameter: "userId"');if(typeof c>"u")throw new w('Missing required parameter: "secret"');const l="/teams/{teamId}/memberships/{membershipId}/status".replace("{teamId}",r).replace("{membershipId}",o),u={};typeof i<"u"&&(u.userId=i),typeof c<"u"&&(u.secret=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("patch",d,p,u)}getPrefs(e){let n;e&&typeof e=="object"&&!Array.isArray(e)?n=e||{}:n={teamId:e};const s=n.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const r="/teams/{teamId}/prefs".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updatePrefs(e,...n){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,prefs:n[0]};const r=s.teamId,o=s.prefs;if(typeof r>"u")throw new w('Missing required parameter: "teamId"');if(typeof o>"u")throw new w('Missing required parameter: "prefs"');const i="/teams/{teamId}/prefs".replace("{teamId}",r),c={};typeof o<"u"&&(c.prefs=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}var Oi;(function(t){t[t.NORMAL_CLOSURE=1e3]="NORMAL_CLOSURE",t[t.POLICY_VIOLATION=1008]="POLICY_VIOLATION",t[t.UNKNOWN_ERROR=-1]="UNKNOWN_ERROR"})(Oi||(Oi={}));class Q{}Q.read=t=>`read("${t}")`;Q.write=t=>`write("${t}")`;Q.create=t=>`create("${t}")`;Q.update=t=>`update("${t}")`;Q.delete=t=>`delete("${t}")`;class F{static any(){return"any"}static user(e,n=""){return n===""?`user:${e}`:`user:${e}/${n}`}static users(e=""){return e===""?"users":`users/${e}`}static guests(){return"guests"}static team(e,n=""){return n===""?`team:${e}`:`team:${e}/${n}`}static member(e){return`member:${e}`}static label(e){return`label:${e}`}}var cc,lc;class Ce{static custom(e){return e}static unique(e=7){const n=cd(Ce,cc,"m",lc).call(Ce);let s="";for(let r=0;r<e;r++){const o=Math.floor(Math.random()*16).toString(16);s+=o}return n+s}}cc=Ce,lc=function(){const e=new Date,n=Math.floor(e.getTime()/1e3),s=e.getMilliseconds();return n.toString(16)+s.toString(16).padStart(5,"0")};var Wi;(function(t){t.Equal="equal",t.NotEqual="notEqual",t.GreaterThan="greaterThan",t.GreaterThanEqual="greaterThanEqual",t.LessThan="lessThan",t.LessThanEqual="lessThanEqual",t.Contains="contains",t.IsNull="isNull",t.IsNotNull="isNotNull"})(Wi||(Wi={}));var Gi;(function(t){t.Totp="totp"})(Gi||(Gi={}));var Vi;(function(t){t.Email="email",t.Phone="phone",t.Totp="totp",t.Recoverycode="recoverycode"})(Vi||(Vi={}));var Qi;(function(t){t.Amazon="amazon",t.Apple="apple",t.Auth0="auth0",t.Authentik="authentik",t.Autodesk="autodesk",t.Bitbucket="bitbucket",t.Bitly="bitly",t.Box="box",t.Dailymotion="dailymotion",t.Discord="discord",t.Disqus="disqus",t.Dropbox="dropbox",t.Etsy="etsy",t.Facebook="facebook",t.Figma="figma",t.Github="github",t.Gitlab="gitlab",t.Google="google",t.Linkedin="linkedin",t.Microsoft="microsoft",t.Notion="notion",t.Oidc="oidc",t.Okta="okta",t.Paypal="paypal",t.PaypalSandbox="paypalSandbox",t.Podio="podio",t.Salesforce="salesforce",t.Slack="slack",t.Spotify="spotify",t.Stripe="stripe",t.Tradeshift="tradeshift",t.TradeshiftBox="tradeshiftBox",t.Twitch="twitch",t.Wordpress="wordpress",t.Yahoo="yahoo",t.Yammer="yammer",t.Yandex="yandex",t.Zoho="zoho",t.Zoom="zoom",t.Mock="mock"})(Qi||(Qi={}));var Ji;(function(t){t.AvantBrowser="aa",t.AndroidWebViewBeta="an",t.GoogleChrome="ch",t.GoogleChromeIOS="ci",t.GoogleChromeMobile="cm",t.Chromium="cr",t.MozillaFirefox="ff",t.Safari="sf",t.MobileSafari="mf",t.MicrosoftEdge="ps",t.MicrosoftEdgeIOS="oi",t.OperaMini="om",t.Opera="op",t.OperaNext="on"})(Ji||(Ji={}));var Ki;(function(t){t.AmericanExpress="amex",t.Argencard="argencard",t.Cabal="cabal",t.Cencosud="cencosud",t.DinersClub="diners",t.Discover="discover",t.Elo="elo",t.Hipercard="hipercard",t.JCB="jcb",t.Mastercard="mastercard",t.Naranja="naranja",t.TarjetaShopping="targeta-shopping",t.UnionPay="unionpay",t.Visa="visa",t.MIR="mir",t.Maestro="maestro",t.Rupay="rupay"})(Ki||(Ki={}));var Yi;(function(t){t.Afghanistan="af",t.Angola="ao",t.Albania="al",t.Andorra="ad",t.UnitedArabEmirates="ae",t.Argentina="ar",t.Armenia="am",t.AntiguaAndBarbuda="ag",t.Australia="au",t.Austria="at",t.Azerbaijan="az",t.Burundi="bi",t.Belgium="be",t.Benin="bj",t.BurkinaFaso="bf",t.Bangladesh="bd",t.Bulgaria="bg",t.Bahrain="bh",t.Bahamas="bs",t.BosniaAndHerzegovina="ba",t.Belarus="by",t.Belize="bz",t.Bolivia="bo",t.Brazil="br",t.Barbados="bb",t.BruneiDarussalam="bn",t.Bhutan="bt",t.Botswana="bw",t.CentralAfricanRepublic="cf",t.Canada="ca",t.Switzerland="ch",t.Chile="cl",t.China="cn",t.CoteDIvoire="ci",t.Cameroon="cm",t.DemocraticRepublicOfTheCongo="cd",t.RepublicOfTheCongo="cg",t.Colombia="co",t.Comoros="km",t.CapeVerde="cv",t.CostaRica="cr",t.Cuba="cu",t.Cyprus="cy",t.CzechRepublic="cz",t.Germany="de",t.Djibouti="dj",t.Dominica="dm",t.Denmark="dk",t.DominicanRepublic="do",t.Algeria="dz",t.Ecuador="ec",t.Egypt="eg",t.Eritrea="er",t.Spain="es",t.Estonia="ee",t.Ethiopia="et",t.Finland="fi",t.Fiji="fj",t.France="fr",t.MicronesiaFederatedStatesOf="fm",t.Gabon="ga",t.UnitedKingdom="gb",t.Georgia="ge",t.Ghana="gh",t.Guinea="gn",t.Gambia="gm",t.GuineaBissau="gw",t.EquatorialGuinea="gq",t.Greece="gr",t.Grenada="gd",t.Guatemala="gt",t.Guyana="gy",t.Honduras="hn",t.Croatia="hr",t.Haiti="ht",t.Hungary="hu",t.Indonesia="id",t.India="in",t.Ireland="ie",t.IranIslamicRepublicOf="ir",t.Iraq="iq",t.Iceland="is",t.Israel="il",t.Italy="it",t.Jamaica="jm",t.Jordan="jo",t.Japan="jp",t.Kazakhstan="kz",t.Kenya="ke",t.Kyrgyzstan="kg",t.Cambodia="kh",t.Kiribati="ki",t.SaintKittsAndNevis="kn",t.SouthKorea="kr",t.Kuwait="kw",t.LaoPeopleSDemocraticRepublic="la",t.Lebanon="lb",t.Liberia="lr",t.Libya="ly",t.SaintLucia="lc",t.Liechtenstein="li",t.SriLanka="lk",t.Lesotho="ls",t.Lithuania="lt",t.Luxembourg="lu",t.Latvia="lv",t.Morocco="ma",t.Monaco="mc",t.Moldova="md",t.Madagascar="mg",t.Maldives="mv",t.Mexico="mx",t.MarshallIslands="mh",t.NorthMacedonia="mk",t.Mali="ml",t.Malta="mt",t.Myanmar="mm",t.Montenegro="me",t.Mongolia="mn",t.Mozambique="mz",t.Mauritania="mr",t.Mauritius="mu",t.Malawi="mw",t.Malaysia="my",t.Namibia="na",t.Niger="ne",t.Nigeria="ng",t.Nicaragua="ni",t.Netherlands="nl",t.Norway="no",t.Nepal="np",t.Nauru="nr",t.NewZealand="nz",t.Oman="om",t.Pakistan="pk",t.Panama="pa",t.Peru="pe",t.Philippines="ph",t.Palau="pw",t.PapuaNewGuinea="pg",t.Poland="pl",t.FrenchPolynesia="pf",t.NorthKorea="kp",t.Portugal="pt",t.Paraguay="py",t.Qatar="qa",t.Romania="ro",t.Russia="ru",t.Rwanda="rw",t.SaudiArabia="sa",t.Sudan="sd",t.Senegal="sn",t.Singapore="sg",t.SolomonIslands="sb",t.SierraLeone="sl",t.ElSalvador="sv",t.SanMarino="sm",t.Somalia="so",t.Serbia="rs",t.SouthSudan="ss",t.SaoTomeAndPrincipe="st",t.Suriname="sr",t.Slovakia="sk",t.Slovenia="si",t.Sweden="se",t.Eswatini="sz",t.Seychelles="sc",t.Syria="sy",t.Chad="td",t.Togo="tg",t.Thailand="th",t.Tajikistan="tj",t.Turkmenistan="tm",t.TimorLeste="tl",t.Tonga="to",t.TrinidadAndTobago="tt",t.Tunisia="tn",t.Turkey="tr",t.Tuvalu="tv",t.Tanzania="tz",t.Uganda="ug",t.Ukraine="ua",t.Uruguay="uy",t.UnitedStates="us",t.Uzbekistan="uz",t.VaticanCity="va",t.SaintVincentAndTheGrenadines="vc",t.Venezuela="ve",t.Vietnam="vn",t.Vanuatu="vu",t.Samoa="ws",t.Yemen="ye",t.SouthAfrica="za",t.Zambia="zm",t.Zimbabwe="zw"})(Yi||(Yi={}));var vs;(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.DELETE="DELETE",t.OPTIONS="OPTIONS",t.HEAD="HEAD"})(vs||(vs={}));var Xi;(function(t){t.Center="center",t.Topleft="top-left",t.Top="top",t.Topright="top-right",t.Left="left",t.Right="right",t.Bottomleft="bottom-left",t.Bottom="bottom",t.Bottomright="bottom-right"})(Xi||(Xi={}));var Zi;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(Zi||(Zi={}));var Fi;(function(t){t.Http="http",t.Schedule="schedule",t.Event="event"})(Fi||(Fi={}));var ea;(function(t){t.Waiting="waiting",t.Processing="processing",t.Completed="completed",t.Failed="failed",t.Scheduled="scheduled"})(ea||(ea={}));const $e={endpoint:"https://aw.oupla.net/v1",projectId:"696b7acb0037bde79e3f",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3",usersTeamsManager:"692cb2cd000cbb24549c",enkaData:"68f00487000c624533a3"},collections:{events:"main",ingredients:"ingredients",main:"main",purchases:"purchases",products:"products",kteams:"kteams",locks:"locks",user_notifications:"user_notifications",materiel_loan:"materiel_loan",teamdocs:"teamdocs"}};let ds=null;async function P(){if(ds)return ds;console.log("[appwrite] Initialisation des instances Appwrite...");const t=new ft().setEndpoint($e.endpoint).setProject($e.projectId),e=new ld(t),n=new ud(t),s=new fd(t),r=new dd(t),o=new pd(t);return ds={client:t,account:e,databases:n,tables:s,functions:r,teams:o,config:$e},console.log("[appwrite] Instances initialisÃ©es avec succÃ¨s"),ds}function hd(){console.log("[appwrite] Cache rÃ©initialisÃ©"),ds=null}function ns(){return{APPWRITE_ENDPOINT:$e.endpoint,APPWRITE_PROJECT_ID:$e.projectId,APPWRITE_DATABASE_ID:$e.databaseId,APPWRITE_FUNCTION_ID:$e.functions.batchUpdate,ACCESS_REQUEST_FUNCTION_ID:$e.functions.accessRequest,MANAGE_RECIPE_FUNCTION_ID:$e.functions.enkaData,APPWRITE_CONFIG:$e}}function $t(){return $e.databaseId}function rn(t){return $e.collections[t]}function ii(t){return $e.functions[t]}function uc(t,e){const{operationName:n,maxAutoRetries:s=1,autoRetryDelay:r=1e3}=e;let o=1;return new Promise((i,c)=>{const l=async()=>{try{console.log(`[RetryUtils] ${n} - Tentative ${o}/${s+1}`);const u=await t();console.log(`[RetryUtils] ${n} - SuccÃ¨s`),e.onSuccess?.(u),i(u)}catch(u){if(console.error(`[RetryUtils] Erreur ${n} (Tentative ${o}):`,u),u instanceof Error&&u.message,o<=s){o++,console.log(`[RetryUtils] Nouvelle tentative dans ${r/1e3}s...`),setTimeout(()=>l(),r);return}console.error(`[RetryUtils] ${n} - Ãchec aprÃ¨s ${o} tentatives`),e.onError?.(u),c(u)}};l()})}async function ut(t,e={}){const{maxAttempts:n=3,timeout:s=1e4,context:r="Operation",successMessage:o,errorMessage:i,retryDelay:c=1e3,silent:l=!1}=e;let u=null;for(let d=1;d<=n;d++)try{console.log(`[${r}] Tentative ${d}/${n}`);const p=await Promise.race([t(),md(s)]);return d>1&&console.log(`[${r}] â SuccÃ¨s aprÃ¨s ${d} tentatives`),o&&!l&&wt.success(o),p}catch(p){if(u=p instanceof Error?p:new Error(String(p)),console.error(`[${r}] â Tentative ${d}/${n} Ã©chouÃ©e:`,u.message),d===n)throw console.error(`[${r}] â Ãchec aprÃ¨s ${n} tentatives`),i&&!l&&wt.error(i),u;const h=c*d;console.log(`[${r}] Nouvelle tentative dans ${h}ms...`),await gd(h)}throw u||new Error(`${r}: Ãchec inconnu`)}function md(t){return new Promise((e,n)=>{setTimeout(()=>{n(new Error(`Timeout aprÃ¨s ${t}ms`))},t)})}function gd(t){return new Promise(e=>setTimeout(e,t))}function pr(t,e={}){const{fallback:n=null,context:s="JSON.parse"}=e;try{return JSON.parse(t)}catch(r){return console.error(`[${s}] â JSON invalide:`,r instanceof Error?r.message:r),n}}function ai(t,e={}){const{context:n="JSON.parseArray",itemFallback:s}=e;return!t||!Array.isArray(t)?(console.warn(`[${n}] Tableau vide ou invalide`),[]):t.map((r,o)=>{const i=pr(r,{context:`${n}[${o}]`,fallback:void 0});return i===void 0&&s?s(r,o):i}).filter(r=>r!==null)}const{APPWRITE_CONFIG:Et}=ns(),An="main";async function ta(t,e=null){return ut(async()=>{const{tables:n}=await P(),s=[b.orderDesc("dateStart")];return e&&s.push(b.greaterThanEqual("dateEnd",e)),{events:(await n.listRows({databaseId:Et.databaseId,tableId:An,queries:s})).rows}},{context:"AppwriteEvents.listEvents",timeout:2e4,errorMessage:"Erreur lors du chargement des Ã©vÃ©nements"})}async function yd(t){try{return await ut(async()=>{const{tables:e}=await P();return await e.getRow({databaseId:Et.databaseId,tableId:An,rowId:t})},{context:"AppwriteEvents.getEvent",timeout:1e4,errorMessage:"Erreur lors du chargement de l'Ã©vÃ©nement"})}catch(e){if(e.code===404)return null;throw e}}async function wd(t,e){return ut(async()=>{const{tables:n}=await P(),s=Ce.unique(),r=await n.createRow({databaseId:Et.databaseId,tableId:An,rowId:s,data:{name:t.name,dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(i=>JSON.stringify(i)):[],createdBy:e,teams:t.teams??[],contributors:t.contributors?t.contributors.map(i=>JSON.stringify(i)):[],todos:t.todos?t.todos.map(i=>JSON.stringify(i)):[]}});console.log(`[appwrite-events] Event created: ${s}`);const{functions:o}=await P();return await o.createExecution({functionId:Et.functions.usersTeamsManager,body:JSON.stringify({action:"add-label-to-user",mainId:s,userId:e}),async:!1}),console.log(`[appwrite-events] Label ${s} attribuÃ© au crÃ©ateur ${e}`),r},{context:"AppwriteEvents.createEvent",timeout:15e3,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function vd(t,e,n=[],s=!0){return ut(async()=>{const{functions:r}=await P(),o={name:t.name,description:t.description||"",dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(d=>JSON.stringify(d)):[],createdBy:e,teams:t.teams||[],teamsId:t.teamsId||[],contributors:t.contributors?t.contributors.map(d=>JSON.stringify(d)):[],todos:t.todos?t.todos.map(d=>JSON.stringify(d)):[],status:t.status||"proposition"};console.log(`[appwrite-events] CrÃ©ation Ã©vÃ©nement avec ${n.length} team(s)`);const i=await r.createExecution({functionId:Et.functions.usersTeamsManager,body:JSON.stringify({action:"create-event-with-teams",eventData:o,creatorId:e,teamIds:n,sendEmailToExistingMembers:s}),async:!1}),c=JSON.parse(i.responseBody);if(!c.success)throw new Error(c.error||"Erreur lors de la crÃ©ation");console.log(`[appwrite-events] ÃvÃ©nement crÃ©Ã© avec teams: ${c.eventId}`);const{tables:l}=await P();return await l.getRow({databaseId:Et.databaseId,tableId:An,rowId:c.eventId})},{context:"AppwriteEvents.createEventWithTeams",timeout:3e4,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function na(t,e){return ut(async()=>{const{tables:n}=await P(),s={...e};e.meals&&(s.meals=e.meals.map(o=>JSON.stringify(o))),e.contributors&&(s.contributors=Array.isArray(e.contributors)?e.contributors.map(o=>JSON.stringify(o)):[]),e.todos&&(s.todos=e.todos.map(o=>JSON.stringify(o))),e.allDates&&(s.allDates=e.allDates);const r=await n.updateRow({databaseId:Et.databaseId,tableId:An,rowId:t,data:s});return console.log(`[appwrite-events] Event updated: ${t}`),r},{context:"AppwriteEvents.updateEvent",timeout:1e4,successMessage:"ÃvÃ©nement mis Ã  jour",errorMessage:"Erreur lors de la mise Ã  jour"})}async function bd(t){return ut(async()=>{const{tables:e,functions:n}=await P();await e.deleteRow({databaseId:Et.databaseId,tableId:An,rowId:t}),console.log(`[appwrite-events] Event deleted: ${t}`),await n.createExecution({functionId:Et.functions.usersTeamsManager,body:JSON.stringify({action:"delete-event-label",mainId:t}),async:!0}),console.log(`[appwrite-events] Label deletion initiated for event: ${t}`)},{context:"AppwriteEvents.deleteEvent",timeout:1e4,successMessage:"ÃvÃ©nement supprimÃ©",errorMessage:"Erreur lors de la suppression"})}async function Id(){const{teams:t}=await P();return await t.list()}async function Ed(t){const{teams:e}=await P();return await e.get({teamId:t})}async function Sd(t){const{teams:e}=await P();return await e.create({teamId:Ce.unique(),name:t})}async function _d(t,e){const{teams:n}=await P();return await n.updateName({teamId:t,name:e})}async function Rd(t){const{teams:e}=await P();await e.delete({teamId:t})}async function Ad(t){const{teams:e}=await P();return await e.listMemberships({teamId:t})}async function Td(t,e){const{teams:n}=await P();await n.deleteMembership({teamId:t,membershipId:e})}async function Pd(t,e,n){const{functions:s}=await P(),r=ii("usersTeamsManager"),o={action:"native-invite",teamId:t,emails:e,message:n},i=await s.createExecution({functionId:r,body:JSON.stringify(o)});if(i.status!=="completed")throw new Error(`Erreur lors de l'invitation : ${i.errors}`);return JSON.parse(i.responseBody)}async function sa(t,e){const{teams:n}=await P();return await n.updatePrefs({teamId:t,prefs:e})}var nt,pn,ht,Xr,dc;class Dd{constructor(){v(this,Xr);v(this,nt,[]);v(this,pn,null);v(this,ht,!1)}register(e,n){a(this,ht)&&console.warn("[RealtimeManager] Enregistrement aprÃ¨s initialisation. Utilisez registerDynamic() pour les inscriptions dynamiques."),a(this,nt).push({channels:e,callback:n}),console.log("[RealtimeManager] Channels enregistrÃ©s:",e)}registerDynamic(e,n){return a(this,nt).push({channels:e,callback:n}),console.log("[RealtimeManager] Channels dynamiques enregistrÃ©s:",e),a(this,ht)&&S(this,Xr,dc).call(this,e,n),()=>{const s=a(this,nt).findIndex(r=>r.channels===e&&r.callback===n);s!==-1&&(a(this,nt).splice(s,1),console.log("[RealtimeManager] Channels dynamiques dÃ©senregistrÃ©s:",e))}}async initialize(){if(a(this,ht))return;const e=[...new Set(a(this,nt).flatMap(n=>n.channels))];if(e.length===0){console.log("[RealtimeManager] Aucun channel Ã  souscrire."),_(this,ht,!0);return}try{console.log(`[RealtimeManager] Initialisation de la connexion unique avec ${e.length} channels...`);const{client:n}=await P();_(this,pn,n.subscribe(e,s=>{for(const r of a(this,nt))s.channels.some(i=>r.channels.includes(i))&&r.callback(s)})),_(this,ht,!0),console.log("[RealtimeManager] â Connexion Realtime Ã©tablie.")}catch(n){throw console.error("[RealtimeManager] Erreur lors de l'initialisation:",n),n}}destroy(){a(this,pn)&&(a(this,pn).call(this),_(this,pn,null)),_(this,nt,[]),_(this,ht,!1),console.log("[RealtimeManager] Connexion Realtime fermÃ©e.")}}nt=new WeakMap,pn=new WeakMap,ht=new WeakMap,Xr=new WeakSet,dc=async function(e,n){try{console.log(`[RealtimeManager] Ajout de ${e.length} channels Ã  la connexion existante...`);const{client:s}=await P();s.subscribe(e,r=>{n(r)}),console.log("[RealtimeManager] â Channels dynamiques ajoutÃ©s:",e)}catch(s){console.error("[RealtimeManager] Erreur lors de l'ajout de channels dynamiques:",s)}};const hr=new Dd;var we,qt,hn,mt,Wn,As,Kt,kr,fc;class $d{constructor(){v(this,Kt);v(this,we,new Yt);v(this,qt,D(!1));v(this,hn,D(null));v(this,mt,D(!1));v(this,Wn,!1);v(this,As,Y(()=>Array.from(a(this,we).values())))}get loading(){return f(a(this,qt))}get error(){return f(a(this,hn))}get isInitialized(){return f(a(this,mt))}get count(){return a(this,we).size}get teams(){return f(a(this,As))}isUserInAnyTeam(e){return Array.from(a(this,we).values()).some(n=>n.members?.some(s=>s.id===e))}get myTeams(){return V.userId?f(a(this,As)):[]}async loadCache(){if(!f(a(this,mt))){if(!V.userId){g(a(this,mt),!0);return}g(a(this,mt),!0),console.log("[NativeTeamsStore] Cache chargÃ© : 0 Ã©quipes (pas de cache)")}}async syncFromRemote(){g(a(this,qt),!0),g(a(this,hn),null);try{if(!V.userId)return;await S(this,Kt,kr).call(this),console.log(`[NativeTeamsStore] Sync terminÃ© : ${a(this,we).size} Ã©quipes`)}catch(e){throw g(a(this,hn),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[NativeTeamsStore] SyncFromRemote error:",e),e}finally{g(a(this,qt),!1)}}async setupRealtime(){if(V.userId){if(a(this,Wn)){console.log("[NativeTeamsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await S(this,Kt,fc).call(this),_(this,Wn,!0),console.log("[NativeTeamsStore] Realtime configurÃ©")}catch(e){throw g(a(this,hn),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[NativeTeamsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async hardReset(){console.log("[NativeTeamsStore] Hard reset..."),a(this,we).clear(),g(a(this,mt),!1),await this.initialize(),console.log("[NativeTeamsStore] Hard reset terminÃ©")}getTeamById(e){return a(this,we).get(e)}getTeamMemberNames(e){const n=a(this,we).get(e);return!n||!n.members?[]:n.members.map(s=>s.name?s.name:s.userEmail?s.userEmail.split("@")[0]:"Inconnu").filter(Boolean)}async fetchTeam(e){try{const n=await Ed(e),s=await Ad(e),r={$id:n.$id,name:n.name,total:n.total,$createdAt:n.$createdAt,$updatedAt:n.$updatedAt,prefs:n.prefs,members:s.memberships.map(o=>({$id:o.$id,id:o.userId,name:o.userName,userEmail:o.userEmail,roles:o.roles,joinedAt:o.joined,confirmed:o.confirm}))};return a(this,we).set(e,r),r}catch(n){return console.error(`[NativeTeamsStore] Error fetching team ${e}:`,n),null}}async createTeam(e,n){const s=await Sd(e);n&&Object.keys(n).length>0&&await sa(s.$id,n);const r=await this.fetchTeam(s.$id);if(!r)throw new Error("Erreur aprÃ¨s crÃ©ation d'Ã©quipe");return r}async updateTeam(e,n,s){n&&await _d(e,n),s&&Object.keys(s).length>0&&await sa(e,s),await this.fetchTeam(e)}async deleteTeam(e){await Rd(e),a(this,we).delete(e)}async inviteTeamMember(e,n,s){await Pd(e,n,s),await this.fetchTeam(e)}async removeMember(e,n){await Td(e,n),await this.fetchTeam(e)}async reload(){g(a(this,qt),!0);try{a(this,we).clear(),await S(this,Kt,kr).call(this)}finally{g(a(this,qt),!1)}}destroy(){a(this,we).clear(),g(a(this,mt),!1),_(this,Wn,!1)}}we=new WeakMap,qt=new WeakMap,hn=new WeakMap,mt=new WeakMap,Wn=new WeakMap,As=new WeakMap,Kt=new WeakSet,kr=async function(){const e=await Id();for(const n of e.teams)await this.fetchTeam(n.$id)},fc=async function(){hr.register(["teams","memberships"],async e=>{console.log("[NativeTeamsStore] â¡ï¸ Realtime RECEIVED:",e.events),await S(this,Kt,kr).call(this)})};const Pt=new $d;var Ts,Ps,Ds;class Md{constructor(){k(this,"routes",[]);v(this,Ts,D(""));v(this,Ps,D(oe({})));v(this,Ds,D(oe({})));k(this,"currentRouteMatch",null);k(this,"isNavigating",!1);k(this,"dynamicGuards",new Map);k(this,"componentCache",new Map);this.currentPath=this.getHashPath(),this.updateQueryParams(),window.addEventListener("hashchange",()=>{const e=this.getHashPath();this.handleHashChange(e)})}get currentPath(){return f(a(this,Ts))}set currentPath(e){g(a(this,Ts),e,!0)}get currentParams(){return f(a(this,Ps))}set currentParams(e){g(a(this,Ps),e,!0)}get currentQuery(){return f(a(this,Ds))}set currentQuery(e){g(a(this,Ds),e,!0)}addRoute(e,n,s){this.routes.push({path:e,component:n,guards:s})}registerRouteGuard(e,n){return this.dynamicGuards.set(e,n),()=>{this.dynamicGuards.delete(e)}}async handleHashChange(e){if(this.isNavigating)return;this.updateQueryParams();const n={path:this.currentPath,params:this.currentParams,query:this.currentQuery},s={path:e,params:{},query:this.currentQuery},r=this.dynamicGuards.get(n.path);if(r?.beforeLeave)try{if(!await r.beforeLeave(n,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard dynamique)"),window.location.hash=n.path;return}}catch(i){console.error("[Router] Erreur dans beforeLeave (guard dynamique):",i)}if(this.currentRouteMatch?.guards?.beforeLeave)try{if(!await this.currentRouteMatch.guards.beforeLeave(n,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard statique)"),window.location.hash=n.path;return}}catch(i){console.error("[Router] Erreur dans beforeLeave (guard statique):",i)}const o=await this.findRouteMatch(e);if(!o){this.currentPath=e,this.currentParams={},this.currentRouteMatch=null;return}if(s.params=o.params,o.guards?.beforeEnter)try{if(!await o.guards.beforeEnter(s,n)){console.log("[Router] Navigation annulÃ©e par beforeEnter"),window.location.hash=n.path;return}}catch(i){console.error("[Router] Erreur dans beforeEnter:",i)}this.currentPath=e,this.currentParams=o.params,this.currentRouteMatch=o}async navigate(e,n){if(!this.isNavigating){this.isNavigating=!0;try{const s={path:this.currentPath,params:this.currentParams,query:this.currentQuery},r=await this.findRouteMatch(e),o={path:e,params:r?.params||{},query:n||{}};if(this.currentRouteMatch?.guards?.beforeLeave&&!await this.currentRouteMatch.guards.beforeLeave(s,o)){console.log("[Router] Navigation annulÃ©e par beforeLeave");return}if(r?.guards?.beforeEnter&&!await r.guards.beforeEnter(o,s)){console.log("[Router] Navigation annulÃ©e par beforeEnter");return}const i=n?"?"+new URLSearchParams(n).toString():"",c="#"+(e.startsWith("/")?e:"/"+e)+i;window.location.hash=c}finally{this.isNavigating=!1}}}async findRouteMatch(e){for(const n of this.routes){const s=this.matchRoute(n.path,e);if(s)return{component:await this.resolveComponent(n.path.toString(),n.component),params:s.params,query:this.currentQuery,guards:n.guards}}return null}async resolveComponent(e,n){if(typeof n!="function"||n.length>0)return n;if(this.componentCache.has(e))return this.componentCache.get(e);try{const r=(await n()).default;return this.componentCache.set(e,r),r}catch(s){throw console.error(`[Router] Erreur lors du chargement du composant pour ${e}:`,s),s}}async match(){const e=await this.findRouteMatch(this.currentPath);return e&&(this.currentParams=e.params,this.currentRouteMatch=e),e}matchRoute(e,n){if(e instanceof RegExp){const c=n.match(e);return c?{params:c.groups||{}}:null}const s=[],r=e.replace(/:([^/]+)/g,(c,l)=>(s.push(l),"([^/]+)")),o=new RegExp(`^${r}$`),i=n.match(o);if(i){const c={};return s.forEach((l,u)=>{c[l]=i[u+1]}),{params:c}}return null}getHashPath(){return window.location.hash.slice(1).split("?")[0]||"/"}updateQueryParams(){const n=window.location.hash.slice(1).split("?")[1],s={};n&&new URLSearchParams(n).forEach((o,i)=>{s[i]=o}),this.currentQuery=s}get path(){return this.currentPath}get params(){return this.currentParams}get query(){return this.currentQuery}async preload(e){const n=this.routes.find(s=>typeof s.path=="string"?s.path===e:!1);n&&(await this.resolveComponent(n.path.toString(),n.component),console.log(`[Router] Composant prÃ©chargÃ©: ${e}`))}}Ts=new WeakMap,Ps=new WeakMap,Ds=new WeakMap;const jn=new Md;function yp(t,e){jn.navigate(t,e)}function wp(t){return jn.query[t]}function vp(t){return jn.preload(t)}var X,Ae,jt,Lt,mn,$s,Ms,Cs,Ns,ks;class Cd{constructor(){k(this,"isMobileQuery",new Bi("max-width: 768px"));k(this,"isDesktopQuery",new Bi("min-width: 1024px"));v(this,X,D(null));v(this,Ae,D(oe([])));v(this,jt,D(!1));v(this,Lt,D(null));v(this,mn,D(!1));v(this,$s,Y(()=>{const e=jn.path,n=jn.params.mainid||jn.params.mainId;return e.startsWith("/products/")&&n?n:null}));v(this,Ms,D(oe({isOpen:!1,conflicts:[]})));v(this,Cs,D(oe({isOpen:!1})));v(this,Ns,D(oe({isRunning:!1,name:"",progress:0})));v(this,ks,D(oe({isOpen:!1})))}get user(){return f(a(this,X))}get userId(){return f(a(this,X))?.$id??null}get userEmail(){return f(a(this,X))?.email??null}get userTeams(){return f(a(this,Ae))}get isAuthenticated(){return f(a(this,X))!==null}get authLoading(){return f(a(this,jt))}get authError(){return f(a(this,Lt))}get authInitialized(){return f(a(this,mn))}async initializeAuth(){if(f(a(this,mn))){console.log("[GlobalState] Authentification dÃ©jÃ  initialisÃ©e");return}console.log("[GlobalState] Initialisation de l'authentification..."),g(a(this,jt),!0),g(a(this,Lt),null);try{const{account:e}=await P();g(a(this,X),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(a(this,X)).name),localStorage.setItem("appwrite-user-email",f(a(this,X)).email),localStorage.setItem("appwrite-user-id",f(a(this,X)).$id),await Pt.initialize(),g(a(this,Ae),Pt.myTeams.map(n=>n.$id),!0),console.log(`[GlobalState] AuthentifiÃ©: ${f(a(this,X)).name} (${f(a(this,Ae)).length} Ã©quipes)`)}catch(e){g(a(this,X),null),g(a(this,Ae),[],!0),g(a(this,Lt),e instanceof Error?e.message:"Erreur d'authentification",!0),console.log("[GlobalState] Utilisateur non connectÃ©")}finally{g(a(this,jt),!1),g(a(this,mn),!0)}}async refreshAuthAfterLogin(){console.log("[GlobalState] RÃ©initialisation aprÃ¨s login..."),g(a(this,jt),!0),g(a(this,Lt),null);try{const{account:e}=await P();g(a(this,X),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(a(this,X)).name),localStorage.setItem("appwrite-user-email",f(a(this,X)).email),localStorage.setItem("appwrite-user-id",f(a(this,X)).$id),await Pt.initialize(),g(a(this,Ae),Pt.myTeams.map(n=>n.$id),!0),console.log(`[GlobalState] RÃ©initialisÃ© aprÃ¨s login: ${f(a(this,X)).name} (${f(a(this,Ae)).length} Ã©quipes)`)}catch(e){console.error("[GlobalState] Erreur lors de la rÃ©initialisation:",e),g(a(this,Lt),e instanceof Error?e.message:"Erreur de rÃ©initialisation",!0)}finally{g(a(this,jt),!1)}}async logout(){try{const{account:e}=await P();await e.deleteSession({sessionId:"current"}),hd(),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-id"),g(a(this,X),null),g(a(this,Ae),[],!0),g(a(this,mn),!1),console.log("[GlobalState] DÃ©connexion rÃ©ussie")}catch(e){throw console.error("[GlobalState] Erreur lors de la dÃ©connexion:",e),e}}async refreshTeams(){if(!f(a(this,X))){console.warn("[GlobalState] Impossible de rafraÃ®chir les Ã©quipes: utilisateur non connectÃ©");return}try{await Pt.syncFromRemote();const e=Pt.myTeams.map(n=>n.$id);(e.length>0||f(a(this,Ae)).length===0)&&(g(a(this,Ae),e,!0),console.log(`[GlobalState] Ãquipes rafraÃ®chies: ${f(a(this,Ae)).length}`))}catch(e){console.error("[GlobalState] Erreur lors du rafraÃ®chissement des Ã©quipes:",e)}}isTeamOwner(e){if(!f(a(this,X)))return!1;const n=Pt.myTeams.find(r=>r.$id===e);return n?n.members.find(r=>r.id===f(a(this,X)).$id)?.roles?.includes("owner")??!1:!1}hasTeamRole(e,n){if(!f(a(this,X)))return!1;const s=Pt.myTeams.find(o=>o.$id===e);return s?s.members.find(o=>o.id===f(a(this,X)).$id)?.roles?.includes(n)??!1:!1}get currentMainId(){return f(a(this,$s))}setCurrentMainId(e){g(a(this,$s),e),console.log(`[GlobalState] currentMainId mis Ã  jour: ${e}`)}get isMobile(){return this.isMobileQuery.current}get isDesktop(){return this.isDesktopQuery.current}get userName(){return f(a(this,X))?.name||localStorage.getItem("appwrite-user-name")||""}get toasts(){return wt.toasts}get toast(){return wt}get modalOverride(){return f(a(this,Ms))}set modalOverride(e){g(a(this,Ms),e,!0)}get modal(){return f(a(this,Cs))}set modal(e){g(a(this,Cs),e,!0)}get backgroundOperation(){return f(a(this,Ns))}set backgroundOperation(e){g(a(this,Ns),e,!0)}get authModal(){return f(a(this,ks))}set authModal(e){g(a(this,ks),e,!0)}}X=new WeakMap,Ae=new WeakMap,jt=new WeakMap,Lt=new WeakMap,mn=new WeakMap,$s=new WeakMap,Ms=new WeakMap,Cs=new WeakMap,Ns=new WeakMap,ks=new WeakMap;const V=new Cd;var qs,js;class Nd{constructor(){v(this,qs,D("survolez des Ã©lÃ©ment pour obtenir de l'aide"));v(this,js,D(!0));k(this,"reset",()=>{this.msg="survolez des Ã©lÃ©ment pour obtenir de l'aide"});k(this,"toggle",()=>{this.isExpanded=!this.isExpanded});k(this,"expand",()=>{this.isExpanded=!0});k(this,"collapse",()=>{this.isExpanded=!1})}get msg(){return f(a(this,qs))}set msg(e){g(a(this,qs),e,!0)}get isExpanded(){return f(a(this,js))}set isExpanded(e){g(a(this,js),e,!0)}get help(){return this.msg}set help(e){this.msg=e}}qs=new WeakMap,js=new WeakMap;const bp=new Nd;let kd=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function qd(t){return ai(t,{context:"parseEventMeals",itemFallback:(e,n)=>(console.warn(`[parseEventMeals] Meal ${n} invalide, utilisation d'un fallback`,e),{id:`unknown-${n}`,name:"Repas inconnu",date:new Date().toISOString(),guests:1,recipes:[]})})}function jd(t){return ai(t,{context:"parseEventContributors",itemFallback:(e,n)=>(console.warn(`[parseEventContributors] Contributor ${n} invalide, utilisation d'un fallback`,e),{id:typeof e=="string"?e:`unknown-${n}`,status:"accepted",invitedAt:new Date().toISOString()})})}function Ld(t){return ai(t,{context:"parseEventTodos",itemFallback:(e,n)=>(console.warn(`[parseEventTodos] Todo ${n} invalide, utilisation d'un fallback`,e),{id:`unknown-${n}`,taskName:"TÃ¢che invalide",taskDescription:null,dueDate:null,priority:null,status:null,taskOn:null,requiredPeopleNb:1,assignedTo:null})})}class Ud{constructor(){k(this,"dbName","events-cache");k(this,"db",null);k(this,"version",2);k(this,"EVENTS_STORE","events");k(this,"METADATA_STORE","metadata");k(this,"POSTER_CONFIGS_STORE","poster-configs");k(this,"LAST_SYNC_KEY","lastSync")}async open(){if(this.db)return;const e=()=>new Promise((i,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>i(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.EVENTS_STORE)||(d.createObjectStore(this.EVENTS_STORE,{keyPath:"$id"}),console.log("[EventsIDBCache] Object store 'events' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[EventsIDBCache] Object store 'metadata' crÃ©Ã©")),d.objectStoreNames.contains(this.POSTER_CONFIGS_STORE)||(d.createObjectStore(this.POSTER_CONFIGS_STORE,{keyPath:"eventId"}),console.log("[EventsIDBCache] Object store 'poster-configs' crÃ©Ã©"))}});let n=await e();const s=n.objectStoreNames.contains(this.EVENTS_STORE),r=n.objectStoreNames.contains(this.METADATA_STORE),o=n.objectStoreNames.contains(this.POSTER_CONFIGS_STORE);(!s||!r||!o)&&(console.warn(`[EventsIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (events=${s}, metadata=${r}, posters=${o}), suppression et recrÃ©ation...`),n.close(),await new Promise((i,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>i(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[EventsIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),n=await e()),this.db=n,console.log(`[EventsIDBCache] Base ouverte: ${this.dbName}`)}async loadEvents(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.EVENTS_STORE,"readonly").objectStore(this.EVENTS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[EventsIDBCache] ${i.size} Ã©vÃ©nements chargÃ©s`),e(i)},o.onerror=()=>n(o.error)})}async saveEvents(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.EVENTS_STORE,"readwrite"),o=r.objectStore(this.EVENTS_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[EventsIDBCache] ${e.size} Ã©vÃ©nements sauvegardÃ©s`),n()},r.onerror=()=>s(r.error)})}async saveEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).put(e);i.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e.$id} sauvegardÃ©`),n()},i.onerror=()=>s(i.error)})}async deleteEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).delete(e);i.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e} supprimÃ©`),n()},i.onerror=()=>s(i.error)})}async loadPosterConfig(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const o=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE),i=o.get(e);i.onsuccess=()=>{const c=i.result;if(!c){n(null);return}if(c.config&&!c.current){console.log(`[EventsIDBCache] Migration config affiche V1 -> V2 pour ${e}`);const l={current:c.config,versions:[]};o.put({eventId:e,...l,updatedAt:new Date().toISOString()}),n(l)}else c.current?n({current:c.current,versions:c.versions}):n(null)},i.onerror=()=>s(i.error)})}async savePosterConfig(e,n){if(!this.db)throw new Error("DB non ouverte");return new Promise((s,r)=>{const c=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE).put({eventId:e,...n,updatedAt:new Date().toISOString()});c.onsuccess=()=>{console.log(`[EventsIDBCache] Config affiche (container) pour ${e} sauvegardÃ©e`),s()},c.onerror=()=>r(c.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={lastSync:null};i.forEach(l=>{l.key===this.LAST_SYNC_KEY&&(c.lastSync=l.value)}),console.log(`[EventsIDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}`),e(c)},o.onerror=()=>n(o.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite");r.objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e.lastSync}),r.oncomplete=()=>{console.log("[EventsIDBCache] Metadata sauvegardÃ©es"),n()},r.onerror=()=>s(r.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const s=this.db.transaction([this.EVENTS_STORE,this.METADATA_STORE,this.POSTER_CONFIGS_STORE],"readwrite");s.objectStore(this.EVENTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.objectStore(this.POSTER_CONFIGS_STORE).clear(),s.oncomplete=()=>{console.log("[EventsIDBCache] Cache vidÃ©"),e()},s.onerror=()=>n(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[EventsIDBCache] Connexion fermÃ©e"))}}async function xd(){const t=new Ud;return await t.open(),t}var C,le,Te,Ut,z,Pe,Ls,Zr,Us,xt,Gn,ue,qr,Dt,pc;class Bd{constructor(){v(this,ue);v(this,C,new Yt);v(this,le,D(!1));v(this,Te,D(null));v(this,Ut,D(!1));v(this,z,null);v(this,Pe,null);v(this,Ls,[]);v(this,Zr,Y(()=>{const e=new Date;return e.setHours(0,0,0,0),Array.from(a(this,C).values()).filter(n=>!n.dateStart||!n.dateEnd?!1:new Date(n.dateEnd)>=e)}));v(this,Us,Y(()=>{const e=new Date;return Array.from(a(this,C).values()).filter(n=>n.dateEnd?new Date(n.dateEnd)<e:!1)}));v(this,xt,null);v(this,Gn,!1)}get loading(){return f(a(this,le))}get error(){return f(a(this,Te))}get isInitialized(){return f(a(this,Ut))}get events(){return Array.from(a(this,C).values())}get count(){return a(this,C).size}get currentEvents(){return f(a(this,Zr))}get pastEvents(){return f(a(this,Us))}get pastEventsCount(){return f(a(this,Us)).length}async loadCache(){if(f(a(this,Ut))){console.log("[EventsStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[EventsStore] Chargement du cache..."),g(a(this,le),!0),g(a(this,Te),null);try{if(!V.isAuthenticated)throw new Error("Utilisateur non connectÃ©");_(this,Pe,V.userId),_(this,Ls,V.userTeams),_(this,z,await xd());const e=await a(this,z).loadEvents();if(e.size>0){console.log(`[EventsStore] ${e.size} Ã©vÃ©nements chargÃ©s depuis le cache`),a(this,C).clear();for(const[n,s]of e)a(this,C).set(n,s)}g(a(this,Ut),!0),console.log(`[EventsStore] Cache chargÃ©: ${a(this,C).size} Ã©vÃ©nements`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(a(this,Te),n,!0),console.error("[EventsStore]",n,e),e}finally{g(a(this,le),!1)}}async syncFromRemote(){if(!a(this,z)){console.warn("[EventsStore] Impossible de sync : cache non initialisÃ©");return}console.log("[EventsStore] Synchronisation depuis Appwrite..."),g(a(this,le),!0);try{await S(this,ue,qr).call(this),await a(this,z).saveEvents(a(this,C)),await a(this,z).saveMetadata({lastSync:new Date().toISOString()}),console.log(`[EventsStore] Synchronisation terminÃ©e: ${a(this,C).size} Ã©vÃ©nements`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(a(this,Te),n,!0),console.error("[EventsStore]",n,e),e}finally{g(a(this,le),!1)}}async setupRealtime(){if(!a(this,z)){console.warn("[EventsStore] Impossible de setup realtime : cache non initialisÃ©");return}if(a(this,Gn)){console.log("[EventsStore] Realtime dÃ©jÃ  configurÃ©");return}console.log("[EventsStore] Configuration du realtime..."),await S(this,ue,pc).call(this),_(this,Gn,!0)}async initialize(){if(f(a(this,Ut))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}return a(this,xt)?(console.log("[EventsStore] Initialisation dÃ©jÃ  en cours, attente..."),a(this,xt)):(console.log("[EventsStore] Initialisation complÃ¨te..."),g(a(this,le),!0),g(a(this,Te),null),_(this,xt,(async()=>{try{await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),console.log(`[EventsStore] Initialisation complÃ©tÃ©e: ${a(this,C).size} Ã©vÃ©nements`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(a(this,Te),n,!0),console.error("[EventsStore]",n,e),e}finally{g(a(this,le),!1),_(this,xt,null)}})()),a(this,xt))}getEventById(e){return a(this,C).get(e)||null}async fetchEvent(e){try{const n=await yd(e);if(n){const s=S(this,ue,Dt).call(this,n);return a(this,C).set(e,s),s}return null}catch(n){return console.error(`[EventsStore] Erreur lors du fetch de ${e}:`,n),null}}getEventsByDateRange(e,n){return this.events.filter(s=>s.dateStart&&s.dateEnd&&s.dateStart>=e&&s.dateEnd<=n)}canEditEvent(e){if(!a(this,Pe))return!1;const n=a(this,C).get(e);return n?!!(n.createdBy===a(this,Pe)||n.teams?.some(s=>a(this,Ls).includes(s))||n.contributors&&n.contributors.some(s=>s.id===a(this,Pe)&&s.status==="accepted")):!1}canUserEditEvent(e,n,s){if(!n)return!1;const r=a(this,C).get(e);return r?!!(r.createdBy===n||r.teams?.length&&s?.length&&r.teams.some(o=>s.includes(o))||r.contributors&&r.contributors.some(o=>o.id===n&&o.status==="accepted")):!1}async createEvent(e){if(!V.userId)throw new Error("Utilisateur non connectÃ©");const n=await wd(e,V.userId),s=S(this,ue,Dt).call(this,n);return a(this,C).set(n.$id,s),a(this,z)&&await a(this,z).saveEvent(s),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã©: ${n.$id}`),s}async createEventWithTeams(e,n=[],s=!0){if(!V.userId)throw new Error("Utilisateur non connectÃ©");const r=await vd(e,V.userId,n,s),o=S(this,ue,Dt).call(this,r);return a(this,C).set(r.$id,o),a(this,z)&&await a(this,z).saveEvent(o),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã© avec ${n.length} team(s): ${r.$id}`),o}async updateEvent(e,n){const s=await na(e,n),r=S(this,ue,Dt).call(this,s);return a(this,C).set(e,r),a(this,z)&&await a(this,z).saveEvent(r),console.log(`[EventsStore] ÃvÃ©nement mis Ã  jour: ${e}`),r}async updateEventStatus(e,n){try{await na(e,{status:n});const s=a(this,C).get(e);s&&(s.status=n),console.log(`[EventsStore] Statut mis Ã  jour: ${e} -> ${n}`)}catch(s){throw console.error(`[EventsStore] Erreur mise Ã  jour statut ${e}:`,s),s}}async deleteEvent(e){await bd(e),a(this,C).delete(e),a(this,z)&&await a(this,z).deleteEvent(e),console.log(`[EventsStore] ÃvÃ©nement supprimÃ©: ${e}`)}getContributors(e){const n=a(this,C).get(e);return n?n.contributors:[]}getContributorStatus(e){const n=a(this,C).get(e);if(!n)return"";const s=n.contributors.filter(r=>r.id===a(this,Pe));return s.length>0?s[0].status:""}async removeContributor(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{removeUserFromEvent:r}=await Ro(async()=>{const{removeUserFromEvent:i}=await Promise.resolve().then(()=>Do);return{removeUserFromEvent:i}},void 0);await r(e,n);const o=s.contributors.filter(i=>i.id!==n&&i.email!==n);return s.contributors.length===o.length?s:await this.updateEvent(e,{contributors:o})}catch(s){throw console.error("[EventsStore] Erreur suppression contributeur:",s),s}}async inviteParticipants(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{teamIds:r=[],emails:o=[],userIds:i=[],sendEmailToExistingMembers:c=!0}=n;if(r.length===0&&o.length===0&&i.length===0)return console.log("[EventsStore] Aucun participant Ã  inviter"),s;const{inviteParticipantsToEvent:l}=await Ro(async()=>{const{inviteParticipantsToEvent:h}=await Promise.resolve().then(()=>Do);return{inviteParticipantsToEvent:h}},void 0),u=await l(e,s.name,{teamIds:r,emails:o,userIds:i,sendEmailToExistingMembers:c});console.log(`[EventsStore] Invitation result: ${u.processed} traitÃ©s`);const d=r.length>0?2e3:500;await new Promise(h=>setTimeout(h,d));const p=await this.fetchEvent(e);if(!p)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return p}catch(s){throw console.error("[EventsStore] Erreur invitation participants:",s),s}}async removeTeam(e,n){try{const{removeTeamFromEvent:s}=await Ro(async()=>{const{removeTeamFromEvent:o}=await Promise.resolve().then(()=>Do);return{removeTeamFromEvent:o}},void 0);await s(e,n),await new Promise(o=>setTimeout(o,1e3));const r=await this.fetchEvent(e);if(!r)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return console.log(`[EventsStore] Team ${n} retirÃ©e de l'Ã©vÃ©nement ${e}`),r}catch(s){throw console.error("[EventsStore] Erreur retrait team:",s),s}}async updateContributorStatus(e,n,s){try{const r=a(this,C).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.contributors],i=o.findIndex(c=>c.id===n||c.email===n);if(i===-1)throw new Error("Contributeur introuvable");return o[i]={...o[i],status:s,respondedAt:new Date().toISOString()},await this.updateEvent(e,{contributors:o})}catch(r){throw console.error("[EventsStore] Erreur maj statut:",r),r}}getMeals(e){const n=a(this,C).get(e);return n?n.meals:[]}async addMeal(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.meals,n];return await this.updateEvent(e,{meals:r})}catch(s){throw console.error("[EventsStore] Erreur ajout meal:",s),s}}async updateMeal(e,n,s){try{const r=a(this,C).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.meals];if(n<0||n>=o.length)throw new Error("Index invalide");return o[n]=s,await this.updateEvent(e,{meals:o})}catch(r){throw console.error("[EventsStore] Erreur maj meal:",r),r}}async deleteMeal(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.meals];if(n<0||n>=r.length)throw new Error("Index invalide");return r.splice(n,1),await this.updateEvent(e,{meals:r})}catch(s){throw console.error("[EventsStore] Erreur suppression meal:",s),s}}getTodos(e){const n=a(this,C).get(e);return n?n.todos:[]}async addTodo(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.todos,n];return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur ajout todo:",s),s}}async addTodos(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.todos,...n];return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur ajout todos:",s),s}}async updateTodoStatus(e,n,s){try{const r=a(this,C).get(e);r&&(r.todos=r.todos.map(c=>c.id===n?{...c,status:s,updatedAt:new Date().toISOString()}:c));const{functions:o,config:i}=await P();await o.createExecution(i.functions.enkaData,JSON.stringify({action:"update_todo_status",data:{eventId:e,todoId:n,status:s}}),!1,"/",vs.POST)}catch(r){throw console.error("[EventsStore] Erreur updateTodoStatus:",r),r}}async toggleTodoAssignment(e,n){try{const s=V.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const r=a(this,C).get(e);if(r){const c=r.todos.find(l=>l.id===n);if(c){let l=[];Array.isArray(c.assignedTo)?l=[...c.assignedTo]:c.assignedTo&&(l=[c.assignedTo]),l.includes(s)?l=l.filter(u=>u!==s):l.push(s),r.todos=r.todos.map(u=>u.id===n?{...u,assignedTo:l.length>0?l:null,updatedAt:new Date().toISOString()}:u)}}const{functions:o,config:i}=await P();await o.createExecution(i.functions.enkaData,JSON.stringify({action:"toggle_todo_assignment",data:{eventId:e,todoId:n}}),!1,"/",vs.POST)}catch(s){throw console.error("[EventsStore] Erreur toggleTodoAssignment:",s),s}}async updateTodo(e,n,s){try{const r=a(this,C).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=r.todos.map(i=>i.id===n?{...i,...s,updatedAt:new Date().toISOString()}:i);return await this.updateEvent(e,{todos:o})}catch(r){throw console.error("[EventsStore] Erreur maj todo:",r),r}}async deleteTodo(e,n){try{const s=a(this,C).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=s.todos.filter(o=>o.id!==n);return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur suppression todo:",s),s}}async loadAllPastEvents(){try{if(console.log("[EventsStore] Chargement de TOUS les Ã©vÃ©nements..."),!a(this,Pe)){console.warn("[EventsStore] userId non dÃ©fini");return}g(a(this,le),!0);const{events:e}=await ta(a(this,Pe),null);e.forEach(n=>{a(this,C).set(n.$id,S(this,ue,Dt).call(this,n))}),console.log(`[EventsStore] ${e.length} Ã©vÃ©nements chargÃ©s (sans filtre de date, total: ${a(this,C).size})`)}catch(e){throw console.error("[EventsStore] Erreur lors du chargement:",e),e}finally{g(a(this,le),!1)}}calculateScaleFactor(e,n){return e/n}async loadPosterConfig(e){return a(this,z)?await a(this,z).loadPosterConfig(e):null}async savePosterConfig(e,n){if(!a(this,z))return;const r=await a(this,z).loadPosterConfig(e)||{versions:[]};r.current=n,await a(this,z).savePosterConfig(e,r)}async createPosterVersion(e,n,s){if(!a(this,z))return;const o=await a(this,z).loadPosterConfig(e)||{current:n,versions:[]};if(o.versions||(o.versions=[]),o.versions.length>=3)throw new Error("Limite de 3 versions atteinte");const i={id:crypto.randomUUID(),name:s,config:JSON.parse(JSON.stringify(n)),createdAt:new Date().toISOString()};return o.versions.push(i),o.current=n,await a(this,z).savePosterConfig(e,o),i}async deletePosterVersion(e,n){if(!a(this,z))return;const s=await a(this,z).loadPosterConfig(e);!s||!s.versions||(s.versions=s.versions.filter(r=>r.id!==n),await a(this,z).savePosterConfig(e,s))}async reload(){console.log("[EventsStore] Rechargement..."),g(a(this,le),!0),g(a(this,Te),null);try{a(this,C).clear(),await S(this,ue,qr).call(this),console.log("[EventsStore] Rechargement complÃ©tÃ©")}catch(e){const n=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(a(this,Te),n,!0),console.error("[EventsStore]",n,e),e}finally{g(a(this,le),!1)}}async hardReset(){console.log("[EventsStore] ð HARD RESET - Vidage complet..."),g(a(this,le),!0),g(a(this,Te),null);try{a(this,C).clear(),a(this,z)&&(await a(this,z).clear(),console.log("[EventsStore] Cache IDB vidÃ©")),await S(this,ue,qr).call(this),a(this,z)&&(await a(this,z).saveEvents(a(this,C)),await a(this,z).saveMetadata({lastSync:new Date().toISOString()}),console.log("[EventsStore] Cache IDB recrÃ©Ã©")),console.log("[EventsStore] â HARD RESET terminÃ©")}catch(e){const n=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(a(this,Te),n,!0),console.error("[EventsStore]",n,e),e}finally{g(a(this,le),!1)}}destroy(){a(this,z)&&(a(this,z).close(),_(this,z,null)),a(this,C).clear(),g(a(this,Ut),!1),_(this,Gn,!1),console.log("[EventsStore] Ressources nettoyÃ©es")}}C=new WeakMap,le=new WeakMap,Te=new WeakMap,Ut=new WeakMap,z=new WeakMap,Pe=new WeakMap,Ls=new WeakMap,Zr=new WeakMap,Us=new WeakMap,xt=new WeakMap,Gn=new WeakMap,ue=new WeakSet,qr=async function(e=null){try{if(console.log("[EventsStore] Chargement des Ã©vÃ©nements..."),!a(this,Pe)){console.warn("[EventsStore] userId non dÃ©fini, impossible de charger les Ã©vÃ©nements");return}if(!e){const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()-15),e=r.toISOString()}const{events:n}=await ta(a(this,Pe),e);n.forEach(s=>{a(this,C).set(s.$id,S(this,ue,Dt).call(this,s))}),console.log(`[EventsStore] ${n.length} Ã©vÃ©nements chargÃ©s (filtrÃ©s pour userId: ${a(this,Pe)}, date >= ${e})`)}catch(n){throw console.error("[EventsStore] Erreur lors du chargement:",n),n}},Dt=function(e){return{...e,meals:qd(e.meals),contributors:jd(e.contributors),todos:Ld(e.todos)}},pc=async function(){try{console.log("[EventsStore] Activation du Realtime...");const e=$t();hr.register([`databases.${e}.collections.${An}.documents`],async n=>{const s=n.events.some(o=>o.includes(".create"))?"create":n.events.some(o=>o.includes(".delete"))?"delete":"update",r=n.payload;if(console.log(`[EventsStore] â¡ï¸ Realtime RECEIVED: ${s} pour ${r.$id}`,{name:r.name,updatedAt:r.$updatedAt}),s==="create"||s==="update"){const o=S(this,ue,Dt).call(this,r);a(this,C).set(r.$id,o),a(this,z)&&await a(this,z).saveEvent(o)}else s==="delete"&&(a(this,C).delete(r.$id),a(this,z)&&await a(this,z).deleteEvent(r.$id))}),console.log("[EventsStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[EventsStore] Erreur lors de la configuration du realtime:",e)}};const Jt=new Bd;function mr(t){if(!t)return[];const e=[],n=t.$id;return e.push(Q.read(F.label(n)),Q.update(F.label(n))),e}function Hd(t,e){switch(t){case"store":return{store:JSON.stringify(e)};case"who":return{who:e.names};default:throw new Error(`Unsupported update type: ${t}`)}}function zd(t,e,n){return{$id:t.$id,productHugoUuid:t.productHugoUuid,productName:t.productName,mainId:t.mainId,status:t.status||null,who:e.who!==void 0?e.who:t.who,store:e.store!==void 0?e.store:t.store,stockReel:t.stockReel||null,previousNames:t.previousNames||null,isMerged:t.isMerged||!1,mergedFrom:t.mergedFrom||null,mergeDate:t.mergeDate||null,mergeReason:t.mergeReason||null,mergedInto:t.mergedInto||null,totalNeededOverride:t.totalNeededOverride||null,$permissions:[Q.read(F.label(n)),Q.update(F.label(n))]}}function Od(t,e){return{$id:t.$id,mainId:t.mainId,productHugoUuid:t.productHugoUuid,productName:t.productName,...e}}async function Wd(t){const{account:e}=await P(),n=await e.get();return{...t,updatedBy:n.name}}function ci(){return localStorage.getItem("appwrite-user-name")||""}async function Gd(t,e,n=100){try{const{tables:s,config:r}=await P(),o=await s.listRows({databaseId:r.databaseId,tableId:r.collections.purchases,queries:[b.greaterThan("$updatedAt",e),b.equal("mainId",t),b.limit(n)]});return console.log(`[Appwrite Interactions] ${o.rows.length} purchases modifiÃ©s chargÃ©s`),o.rows}catch(s){return console.error("[Appwrite Interactions] Erreur chargement purchases modifiÃ©s:",s),[]}}async function Vd(t,e){const{lastSync:n,limit:s=1e3}=e;try{const{tables:r,config:o}=await P();if(!n){console.log("[Appwrite Interactions] Chargement complet des produits et achats");const h=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.products,queries:[b.equal("mainId",t),b.limit(s)]})).rows,y=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.purchases,queries:[b.equal("mainId",t),b.limit(s*2)]})).rows,I=new Map;return h.forEach(E=>{I.set(E.$id,{...E,purchases:[]})}),y.forEach(E=>{E.products?.forEach(A=>{const T=I.get(A);T&&(T.purchases||(T.purchases=[]),T.purchases.push(E))})}),console.log(`[Appwrite Interactions] ${h.length} produits chargÃ©s avec ${y.length} achats`),Array.from(I.values())}const i=await r.listRows({databaseId:o.databaseId,tableId:o.collections.products,queries:[b.greaterThan("$updatedAt",n),b.equal("mainId",t),b.limit(s)]}),c=i.rows,u=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.purchases,queries:[b.greaterThan("$updatedAt",n),b.equal("mainId",t),b.limit(s*2)]})).rows,d=new Map;return c.forEach(p=>{d.set(p.$id,{...p,purchases:[]})}),u.forEach(p=>{p.products?.forEach(h=>{const m=d.get(h);m&&(m.purchases||(m.purchases=[]),m.purchases.push(p))})}),i.rows.length>0&&console.log(`[Appwrite Interactions] ${i.rows.length} produits synchronisÃ©s (delta)`),Array.from(d.values())}catch(r){console.error(`[Appwrite Interactions] Erreur sync produits avec purchases pour mainId ${t}:`,r);const o=r instanceof Error?r.message:"Erreur lors de la synchronisation";throw new Error(`Ãchec de la synchronisation: ${o}`)}}async function ss(t,e,n=!0){const{tables:s,config:r}=await P();return n&&(e.updatedBy=ci()),await s.updateRow({databaseId:r.databaseId,tableId:r.collections.products,rowId:t,data:e})}async function Qd(t,e,n){try{const s=n(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour crÃ©ation`);console.log(`[Appwrite Interactions] CrÃ©ation produit ${t} sur Appwrite...`);const r=Od(s,e),o=await Wd(r),{tables:i,config:c}=await P(),l=Jt.getEventById(o.mainId),u=mr(l),d=await i.createRow({databaseId:c.databaseId,tableId:c.collections.products,rowId:t,data:o,permissions:u});return console.log(`[Appwrite Interactions] Produit ${t} crÃ©Ã© avec permissions (labels + teams)`),d}catch(s){console.error(`[Appwrite Interactions] Erreur crÃ©ation produit ${t}:`,s);const r=s instanceof Error?s.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation du produit: ${r}`)}}async function Ip(t,e){try{const{tables:n,config:s}=await P(),o=`${oc(t.productName).substring(0,10)}_${Date.now().toString(36)}`,i={quantity:t.quantity,pF:t.pF||!1,pS:t.pS||!1},c={productHugoUuid:null,productName:t.productName,productType:t.productType||"Autre",store:t.store?JSON.stringify(t.store):null,who:t.who||[],isSynced:!0,mainId:e,status:"active",updatedBy:ci(),stockReel:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,mergedInto:null,totalNeededOverride:null,specs:JSON.stringify(i)};console.log(`[Appwrite Interactions] CrÃ©ation produit manuel ${o}...`,c);const l=Jt.getEventById(e),u=mr(l),d=await n.createRow({databaseId:s.databaseId,tableId:s.collections.products,rowId:o,data:c,permissions:u});return console.log(`[Appwrite Interactions] Produit manuel ${o} crÃ©Ã© avec permissions Label`),d}catch(n){throw console.error("[Appwrite Interactions] Erreur crÃ©ation produit manuel:",n),n}}async function Ep(t,e){if(!t)throw new Error("ID du produit requis pour la mise Ã  jour du magasin");const n=e?JSON.stringify(e):null,s=await ss(t,{store:n||void 0});return console.log(`[Appwrite Interactions] Magasin mis Ã  jour pour produit ${t}, nouvelle valeur:`,s.store),s}async function Sp(t,e){return ss(t,{who:e})}async function _p(t,e){return ss(t,{stockReel:e})}async function Rp(t,e,n=!1){if(!t)throw new Error("ID du produit requis pour la mise Ã  jour de l'override");const s=JSON.stringify(e),r=await ss(t,{totalNeededOverride:s},n);return console.log(`[Appwrite Interactions] Total override mis Ã  jour pour le produit ${t}:`,e),r}async function Ap(t,e=!0){if(!t)throw new Error("ID du produit requis pour la suppression de l'override");const n=await ss(t,{totalNeededOverride:""},e);return console.log(`[Appwrite Interactions] Total override supprimÃ© pour le produit ${t}`),n}async function Tp(t,e,n){try{const s=n(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour mise Ã  jour batch`);const r={};return e.stockReel!==void 0&&(r.stockReel=e.stockReel),e.who!==void 0&&(r.who=e.who),e.storeInfo!==void 0&&(r.store=JSON.stringify(e.storeInfo)),s.isSynced?(console.log(`[Appwrite Interactions] Produit ${t} dÃ©jÃ  sync, update batch normal...`),await ss(t,r)):(console.log(`[Appwrite Interactions] Produit ${t} local, crÃ©ation batch avec upsert...`),await Qd(t,r,n))}catch(s){throw console.error(`[Appwrite Interactions] Erreur lors de la mise Ã  jour batch du produit ${t}:`,s),s}}async function Pp(t){const{tables:e,config:n}=await P(),s={...t,createdBy:ci()},r=Jt.getEventById(t.mainId),o=mr(r),i=await e.createRow(n.databaseId,n.collections.purchases,Ce.unique(),s,o);return console.log("[Appwrite Interactions] Achat crÃ©Ã© avec permissions Label:",i),i}async function Dp(t,e){try{const{tables:n,config:s}=await P(),r=await n.updateRow(s.databaseId,s.collections.purchases,t,e);return console.log(`[Appwrite Interactions] Achat ${t} mis Ã  jour:`,e),r}catch(n){console.error(`[Appwrite Interactions] Erreur mise Ã  jour achat ${t}:`,n);const s=n instanceof Error?n.message:"Erreur inconnue";throw new Error(`Ãchec de la mise Ã  jour de l'achat: ${s}`)}}async function $p(t){try{const{tables:e,config:n}=await P();await e.deleteRow(n.databaseId,n.collections.purchases,t),console.log(`[Appwrite Interactions] Achat ${t} supprimÃ©`)}catch(e){console.error(`[Appwrite Interactions] Erreur suppression achat ${t}:`,e);const n=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec de la suppression de l'achat: ${n}`)}}async function Jd(t){if(!t?.length)return[];try{const{tables:e,config:n}=await P(),s=await e.listRows(n.databaseId,n.collections.purchases,[b.equal("$id",t)]);return console.log(`[Appwrite Interactions] ${s.rows.length} purchases chargÃ©s avec relations products`),s.rows}catch(e){console.error("[Appwrite Interactions] Erreur chargement purchases avec relations:",e);const n=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec du chargement des purchases: ${n}`)}}async function Mp(t,e,n,s){try{const{functions:r,config:o,account:i}=await P(),c=pf.currentMainId;if(!c)throw new Error("No current event - cannot determine mainId for permissions");const l=await i.get(),u=Hd(n,s),d=t.map(y=>{const I=e.find(E=>E.$id===y);if(!I)throw new Error(`Product ${y} not found in products data`);return zd(I,u,c)});console.log(`[Appwrite Interactions] Lancement mise Ã  jour groupÃ©e OPTIMISÃE: ${d.length} produits, type: ${n}`);const p={operation:"batchUpdateProductsOptimized",data:{rows:d,fromUserId:l.$id}},h=await uc(()=>r.createExecution(o.functions.batchUpdate,JSON.stringify(p),!1,"/",vs.POST),{operationName:`batchUpdateProductsOptimized (${d.length} products, type: ${n})`,maxAutoRetries:1,autoRetryDelay:2e3});if(!h)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives de mise Ã  jour groupÃ©e optimisÃ©e");if(h.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${h.status}. Erreur: ${h.stderr||h.responseBody}`);const m=JSON.parse(h.responseBody);return m.success?console.log(`[Appwrite Interactions] Mise Ã  jour groupÃ©e optimisÃ©e rÃ©ussie: ${m.updatedCount} produits mis Ã  jour`):console.error("[Appwrite Interactions] Mise Ã  jour groupÃ©e optimisÃ©e Ã©chouÃ©e:",m.error),m}catch(r){console.error("[Appwrite Interactions] Erreur mise Ã  jour groupÃ©e optimisÃ©e:",r);const o=r instanceof Error?r.message:"Erreur inconnue";return{success:!1,updatedCount:t.length,updateType:n,error:o,timestamp:new Date().toISOString()}}}async function Cp(t,e,n,s={}){try{const{tables:r,config:o,account:i}=await P(),c=await i.get(),l=Jt.getEventById(t),u=mr(l),d=[];console.log("[Appwrite Interactions] Debug createQuickValidationPurchases:",{mainId:t,productId:e,productIdType:typeof e,quantities:n,options:s});for(const p of n){const h={products:[e],mainId:t,quantity:p.q,unit:p.u,status:"delivered",notes:s.notes||`Validation rapide ${new Date().toLocaleDateString("fr-FR")}`,store:s.store??null,who:c.name,price:null,orderDate:null,deliveryDate:null,createdBy:c.$id,invoiceId:s.invoiceId,invoiceTotal:null},m=await r.createRow(o.databaseId,o.collections.purchases,Ce.unique(),h,u);d.push(m)}return console.log(`[Appwrite Interactions] ${d.length} validations rapides crÃ©Ã©es avec permissions (labels + teams) pour produit ${e}`),d}catch(r){console.error("[Appwrite Interactions] Erreur crÃ©ation validation rapide:",r);const o=r instanceof Error?r.message:"Erreur inconnue";throw new Error(`Ãchec de la validation rapide: ${o}`)}}async function Np(t,e,n,s,r,o){try{const{tables:i,config:c,account:l}=await P(),u=await l.get(),d=e||Ce.unique(),p=u.name;if(!n)throw new Error("invoiceTotal est requis pour une dÃ©pense");const h=Jt.getEventById(t),m=mr(h),y={products:[],mainId:t,quantity:1,unit:"global",status:"expense",notes:r||"",store:s??null,who:p||u.name,price:n,invoiceId:d,invoiceTotal:n,orderDate:null,deliveryDate:null,createdBy:u.$id},I=await i.createRow(c.databaseId,c.collections.purchases,Ce.unique(),y,m);return console.log("[Appwrite Interactions] DÃ©pense crÃ©Ã©e avec permissions (labels + teams):",I),I}catch(i){console.error("[Appwrite Interactions] Erreur crÃ©ation dÃ©pense:",i);const c=i instanceof Error?i.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation de la dÃ©pense: ${c}`)}}async function Kd(t){try{const{tables:e,config:n}=await P(),s=await e.listRows(n.databaseId,n.collections.purchases,[b.equal("mainId",t),b.equal("status","expense"),b.limit(1e3)]);return console.log(`[Appwrite Interactions] ${s.rows.length} dÃ©penses globales chargÃ©es`),s.rows}catch(e){return console.error("[Appwrite Interactions] Erreur chargement dÃ©penses globales:",e),[]}}class Yd{constructor(e){k(this,"dbName");k(this,"db",null);k(this,"version",1);k(this,"PRODUCTS_STORE","products");k(this,"METADATA_STORE","metadata");k(this,"LAST_SYNC_KEY","lastSync");k(this,"ALL_DATES_KEY","allDates");k(this,"HUGO_HASH_KEY","hugoContentHash");this.dbName=`products-cache-${e}`}async open(){if(!this.db)return new Promise((e,n)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>n(s.error),s.onsuccess=()=>{this.db=s.result,console.log(`[IDBCache] Base ouverte: ${this.dbName}`),e()},s.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(this.PRODUCTS_STORE)||(o.createObjectStore(this.PRODUCTS_STORE,{keyPath:"$id"}),console.log("[IDBCache] Object store 'products' crÃ©Ã©")),o.objectStoreNames.contains(this.METADATA_STORE)||(o.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[IDBCache] Object store 'metadata' crÃ©Ã© avec keyPath"))}})}async loadProducts(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readonly").objectStore(this.PRODUCTS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[IDBCache] ${i.size} produits chargÃ©s`),e(i)},o.onerror=()=>n(o.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={lastSync:null,allDates:[],hugoContentHash:null};i.forEach(l=>{l.key===this.LAST_SYNC_KEY?c.lastSync=l.value:l.key===this.ALL_DATES_KEY?c.allDates=l.value||[]:l.key===this.HUGO_HASH_KEY&&(c.hugoContentHash=l.value)}),console.log(`[IDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}, dates=${c.allDates?.length||0}, hash=${c.hugoContentHash}`),e(c)},o.onerror=()=>n(o.error)})}async saveProducts(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.PRODUCTS_STORE,"readwrite"),o=r.objectStore(this.PRODUCTS_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[IDBCache] ${e.size} produits sauvegardÃ©s`),n()},r.onerror=()=>s(r.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite"),o=r.objectStore(this.METADATA_STORE);o.put({key:this.LAST_SYNC_KEY,value:e.lastSync}),o.put({key:this.ALL_DATES_KEY,value:e.allDates}),e.hugoContentHash!==void 0&&o.put({key:this.HUGO_HASH_KEY,value:e.hugoContentHash}),r.oncomplete=()=>{console.log("[IDBCache] Metadata sauvegardÃ©es (objets {key, value})"),n()},r.onerror=()=>s(r.error)})}async updateLastSync(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] lastSync mis Ã  jour: ${e}`),n()},i.onerror=()=>s(i.error)})}async updateAllDates(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.ALL_DATES_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] allDates mis Ã  jour: ${e.length} dates`),n()},i.onerror=()=>s(i.error)})}async updateHugoContentHash(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.HUGO_HASH_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] hugoContentHash mis Ã  jour: ${e}`),n()},i.onerror=()=>s(i.error)})}async updateLastHugoMenuUpdate(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:"lastHugoMenuUpdate",value:e});i.onsuccess=()=>{console.log("[IDBCache] lastHugoMenuUpdate sauvegardÃ©"),n()},i.onerror=()=>s(i.error)})}async upsertProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).put(e);i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}async deleteProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).delete(e);i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const s=this.db.transaction([this.PRODUCTS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.PRODUCTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[IDBCache] Cache vidÃ©"),e()},s.onerror=()=>n(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[IDBCache] Connexion fermÃ©e"))}}async function Xd(t){const e=new Yd(t);return await e.open(),e}var xs,Bs;class cs{constructor(e,n){v(this,xs,D(oe({})));k(this,"dateStore");v(this,Bs,Y(()=>{const e=this.dateStore.current;this.dateStore.dates;let n;if(e.start&&e.end)n=Xu(this.data,e.start,e.end);else return{quantities:[],formattedQuantities:"",nbRecipes:0,totalAssiettes:0,stockResult:[],availableQuantities:[],missingQuantities:[],formattedMissingQuantities:"",formattedAvailableQuantities:"En attente",hasAvailable:!1,hasMissing:!1,concernedDates:[],recipesByDate:new Map};return{quantities:n.requiredQuantities,formattedQuantities:n.requiredQuantitiesFormatted,nbRecipes:n.totalRecipesInRange,totalAssiettes:n.totalPortionsInRange,stockResult:n.stockBalance,availableQuantities:n.availableStockQuantities,missingQuantities:n.missingStockQuantities,formattedMissingQuantities:n.missingStockFormatted,formattedAvailableQuantities:n.availableStockFormatted,hasAvailable:n.hasAvailableStock,hasMissing:n.hasMissingStock,concernedDates:n.datesInSelectedRange,recipesByDate:n.recipesByDate}}));this.data=e,this.dateStore=n}get data(){return f(a(this,xs))}set data(e){g(a(this,xs),e,!0)}update(e){this.data=e}get $id(){return this.data.$id}get productName(){return this.data.productName}get productType(){return this.data.productType}get storeInfo(){return this.data.storeInfo}get who(){return this.data.who}get pF(){return this.data.pF}get pS(){return this.data.pS}get status(){return this.data.status}get previousNames(){return this.data.previousNames}get purchases(){return this.data.purchases}get totalNeededOverrideParsed(){return this.data.totalNeededOverrideParsed}get displayMissingQuantity(){return this.data.displayMissingQuantity}get missingQuantityArray(){return this.data.missingQuantityArray}get isSynced(){return this.data.isSynced}get byDate(){return this.data.byDate}get stats(){return f(a(this,Bs))}set stats(e){g(a(this,Bs),e)}}xs=new WeakMap,Bs=new WeakMap;var Z,ne,se,Hs,zs,Os,Ws,Gs,Vs,Qs,Js,Ks;class Zd{constructor(e=[]){v(this,Z,D(oe([])));v(this,ne,D(null));v(this,se,D(null));v(this,Hs,Y(()=>[...f(a(this,Z))].sort()[0]));v(this,zs,Y(()=>[...f(a(this,Z))].sort()[f(a(this,Z)).length-1]));v(this,Os,Y(()=>{if(f(a(this,Z)).length===0)return!0;const e=this.lastAvailableDate?new Date(this.lastAvailableDate):new Date;return e.setHours(23,59,59,999),e<new Date}));v(this,Ws,Y(()=>{if(f(a(this,Z)).length===0)return!1;const e=new Date;return e.setHours(0,0,0,0),f(a(this,Z)).some(n=>new Date(n)>=e)}));v(this,Gs,Y(()=>f(a(this,ne))===this.firstAvailableDate&&f(a(this,se))===this.lastAvailableDate));v(this,Vs,Y(()=>{if(f(a(this,Z)).length===0)return!1;const e=[...f(a(this,Z))].sort(),n=new Date;n.setHours(0,0,0,0);const s=e.find(i=>new Date(i)>=n)||null;let r,o;if(s)r=s,o=e[e.length-1];else{const i=e[e.length-1];r=i,o=i}return f(a(this,ne))===r&&f(a(this,se))===o}));v(this,Qs,Y(()=>f(a(this,Z)).length===1));v(this,Js,Y(()=>!!(f(a(this,ne))&&f(a(this,ne))===f(a(this,se)))));v(this,Ks,Y(()=>{if(!f(a(this,ne))||!f(a(this,se))||this.isEventPassed)return!1;const e=new Date(f(a(this,ne)));return e.setHours(e.getHours()+ic),e<new Date}));g(a(this,Z),e,!0),this.initializeSmartRange()}get start(){return f(a(this,ne))}get end(){return f(a(this,se))}get dates(){return f(a(this,Z))}get firstAvailableDate(){return f(a(this,Hs))}set firstAvailableDate(e){g(a(this,Hs),e)}get lastAvailableDate(){return f(a(this,zs))}set lastAvailableDate(e){g(a(this,zs),e)}get current(){return{start:f(a(this,ne)),end:f(a(this,se))}}get isEventPassed(){return f(a(this,Os))}set isEventPassed(e){g(a(this,Os),e)}get hasUpcomingDates(){return f(a(this,Ws))}set hasUpcomingDates(e){g(a(this,Ws),e)}get isFullRange(){return f(a(this,Gs))}set isFullRange(e){g(a(this,Gs),e)}get isUpcomingRange(){return f(a(this,Vs))}set isUpcomingRange(e){g(a(this,Vs),e)}get hasSingleDateEvent(){return f(a(this,Qs))}set hasSingleDateEvent(e){g(a(this,Qs),e)}get hasSingleDateInRange(){return f(a(this,Js))}set hasSingleDateInRange(e){g(a(this,Js),e)}get hasPastDatesInRange(){return f(a(this,Ks))}set hasPastDatesInRange(e){g(a(this,Ks),e)}setAvailableDates(e){g(a(this,Z),e,!0),this.initializeSmartRange()}setRange(e,n){if(!e&&!n){g(a(this,ne),null),g(a(this,se),null);return}if(!e||!n){const o=e||n;g(a(this,ne),o,!0),g(a(this,se),o,!0);return}const s=new Date(e)<=new Date(n)?e:n,r=new Date(e)>=new Date(n)?e:n;g(a(this,ne),s,!0),g(a(this,se),r,!0)}selectAll(){f(a(this,Z)).length!==0&&(g(a(this,ne),f(a(this,Z))[0],!0),g(a(this,se),f(a(this,Z))[f(a(this,Z)).length-1],!0))}selectUpcoming(){if(f(a(this,Z)).length===0)return;const e=[...f(a(this,Z))].sort(),n=new Date;n.setHours(0,0,0,0);const s=e.find(r=>new Date(r)>=n)||null;if(s)g(a(this,ne),s,!0),g(a(this,se),e[e.length-1],!0);else{const r=e[e.length-1];g(a(this,ne),r,!0),g(a(this,se),r,!0)}}selectFutureDatesOnly(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const n=f(a(this,Z)).filter(s=>new Date(s)>=e);n.length>0&&(g(a(this,ne),n[0],!0),g(a(this,se),n[n.length-1],!0))}initializeSmartRange(){if(f(a(this,Z)).length===0)return;const e=[...f(a(this,Z))].sort(),n=this.isEventPassed,s=new Date(e[0])<new Date,r=new Date;let o;n?o=e[0]:s?o=r.toISOString().slice(0,19)+"Z":o=e[0],g(a(this,ne),o,!0),g(a(this,se),e[e.length-1],!0),console.log(`[DateRangeStore] Initialized: ${f(a(this,ne))} - ${f(a(this,se))}`)}reset(){g(a(this,Z),[],!0),g(a(this,ne),null),g(a(this,se),null),console.log("[DateRangeStore] Reset")}}Z=new WeakMap,ne=new WeakMap,se=new WeakMap,Hs=new WeakMap,zs=new WeakMap,Os=new WeakMap,Ws=new WeakMap,Gs=new WeakMap,Vs=new WeakMap,Qs=new WeakMap,Js=new WeakMap,Ks=new WeakMap;class Fd{constructor(){k(this,"dbName","recipes-cache");k(this,"db",null);k(this,"version",5);k(this,"RECIPES_INDEX_STORE","recipes-index");k(this,"RECIPES_DETAILS_STORE","recipes-details");k(this,"METADATA_STORE","metadata");k(this,"BUILD_TIMESTAMP_KEY","buildTimestamp");k(this,"LAST_APPWRITE_SYNC_KEY","lastAppwriteSync");k(this,"RECIPES_COUNT_KEY","recipesCount")}async open(){if(this.db)return;const e=()=>new Promise((i,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>i(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.RECIPES_INDEX_STORE)||(d.createObjectStore(this.RECIPES_INDEX_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-index' crÃ©Ã©")),d.objectStoreNames.contains(this.RECIPES_DETAILS_STORE)||(d.createObjectStore(this.RECIPES_DETAILS_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-details' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[RecipesIDBCache] Object store 'metadata' crÃ©Ã©"))}});let n=await e();const s=n.objectStoreNames.contains(this.RECIPES_INDEX_STORE),r=n.objectStoreNames.contains(this.RECIPES_DETAILS_STORE),o=n.objectStoreNames.contains(this.METADATA_STORE);(!s||!r||!o)&&(console.warn(`[RecipesIDBCache] Base corrompue dÃ©tectÃ©e (index=${s}, details=${r}, metadata=${o}), suppression et recrÃ©ation...`),n.close(),await new Promise((i,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>i(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[RecipesIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),n=await e()),this.db=n,console.log(`[RecipesIDBCache] Base ouverte: ${this.dbName}`)}async loadRecipesIndex(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.RECIPES_INDEX_STORE,"readonly").objectStore(this.RECIPES_INDEX_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${i.size} recettes (index) chargÃ©es`),e(i)},o.onerror=()=>n(o.error)})}async saveRecipesIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.RECIPES_INDEX_STORE,"readwrite"),o=r.objectStore(this.RECIPES_INDEX_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[RecipesIDBCache] ${e.size} recettes (index) sauvegardÃ©es`),n()},r.onerror=()=>s(r.error)})}async loadRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).get(e);i.onsuccess=()=>{const c=i.result;c&&console.log(`[RecipesIDBCache] DÃ©tails de ${e} chargÃ©s depuis le cache`),n(c||null)},i.onerror=()=>s(i.error)})}async saveRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).put(e);i.onsuccess=()=>{console.log(`[RecipesIDBCache] DÃ©tails de ${e.$id} sauvegardÃ©s`),n()},i.onerror=()=>s(i.error)})}async loadAllRecipeDetails(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${i.size} dÃ©tails de recettes chargÃ©s`),e(i)},o.onerror=()=>n(o.error)})}async loadRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE),i=new Map;let c=0;const l=e.length;for(const u of e){const d=o.get(u);d.onsuccess=()=>{const p=d.result;p&&i.set(u,p),c++,c===l&&(console.log(`[RecipesIDBCache] ${i.size}/${l} recettes chargÃ©es en bulk`),n(i))},d.onerror=()=>{console.warn(`[RecipesIDBCache] Erreur chargement ${u} en bulk:`,d.error),c++,c===l&&(console.log(`[RecipesIDBCache] ${i.size}/${l} recettes chargÃ©es en bulk (avec erreurs)`),n(i))}}l===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  charger en bulk"),n(i))})}async saveRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite"),o=r.objectStore(this.RECIPES_DETAILS_STORE);let i=0;const c=e.size;e.forEach(l=>{const u=o.put(l);u.onsuccess=()=>{i++,i===c&&(console.log(`[RecipesIDBCache] ${c} recettes sauvegardÃ©es en bulk`),n())},u.onerror=()=>{console.error(`[RecipesIDBCache] Erreur sauvegarde ${l.$id} en bulk:`,u.error),s(u.error)}}),c===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  sauvegarder en bulk"),n()),r.onerror=()=>s(r.error)})}async deleteRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).delete(e);i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}async deleteRecipeFromIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE],"readwrite"),o=r.objectStore(this.RECIPES_INDEX_STORE),i=r.objectStore(this.RECIPES_DETAILS_STORE);o.delete(e),i.delete(e),r.oncomplete=()=>{console.log(`[RecipesIDBCache] Recette ${e} supprimÃ©e de l'index et des dÃ©tails`),n()},r.onerror=()=>s(r.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={buildTimestamp:null,lastAppwriteSync:null,recipesCount:0,cacheVersion:1};i.forEach(l=>{l.key===this.RECIPES_COUNT_KEY?c.recipesCount=l.value:l.key===this.BUILD_TIMESTAMP_KEY?c.buildTimestamp=l.value:l.key===this.LAST_APPWRITE_SYNC_KEY&&(c.lastAppwriteSync=l.value)}),console.log(`[RecipesIDBCache] Metadata chargÃ©es: count=${c.recipesCount}, build=${c.buildTimestamp}, sync=${c.lastAppwriteSync}`),e(c)},o.onerror=()=>n(o.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((n,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite"),o=r.objectStore(this.METADATA_STORE);o.put({key:this.BUILD_TIMESTAMP_KEY,value:e.buildTimestamp}),o.put({key:this.LAST_APPWRITE_SYNC_KEY,value:e.lastAppwriteSync}),o.put({key:this.RECIPES_COUNT_KEY,value:e.recipesCount}),r.oncomplete=()=>{console.log("[RecipesIDBCache] Metadata sauvegardÃ©es"),n()},r.onerror=()=>s(r.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,n)=>{const s=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.RECIPES_INDEX_STORE).clear(),s.objectStore(this.RECIPES_DETAILS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[RecipesIDBCache] Cache vidÃ©"),e()},s.onerror=()=>n(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[RecipesIDBCache] Connexion fermÃ©e"))}}async function ef(){const t=new Fd;return await t.open(),t}function kp(t){return t.map(e=>JSON.stringify(e))}function jr(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{return JSON.parse(e)}catch(n){return console.warn("[ingredientUtils] Failed to parse ingredient:",e,n),null}}).filter(e=>e!==null)}const ra={"BouchÃ©es salÃ©es":"sandwich",Boisson:"cup-soda",Cake:"cake-slice","CrÃ¨mes dessert":"fast-food-pudding",Friture:"fryer",Gateau:"cake-slice",Pain:"bread","Plat au Four":"oven","Plat en Sauce":"pot",Salade:"lettuce",Sauce:"sauce",Snacking:"hamburger",Soupe:"soup","Tarte (salÃ©e)":"pizza","Tarte (sucrÃ©e)":"pie",Tartinade:"tartinade"},tf={entree:"salad",plat:"dish",dessert:"fast-food-pudding"};function qp(t,e){const n=Array.isArray(e)?e[0]:e;if(n&&ra[n])return{label:n,iconId:ra[n]};const s=nf(t),r=tf[t]||"no-cat";return{label:s,iconId:r}}function nf(t){switch(t){case"entree":return"EntrÃ©e";case"plat":return"Plat";case"dessert":return"Dessert";default:return t}}function To(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{const n=JSON.parse(e);if(n&&typeof n.astuce=="string")return n;if(typeof e=="string")return{astuce:e}}catch(n){console.warn("[recipeUtils] Failed to parse astuce:",e,n)}return null}).filter(e=>e!==null)}function jp(t){return!t||!Array.isArray(t)||t.length===0?null:t.map(e=>JSON.stringify(typeof e=="string"?{astuce:e}:e))}function sf(t){if(!t||typeof t!="object"||Array.isArray(t))throw new Error(`Format d'ingrÃ©dient invalide: ${JSON.stringify(t)}`);return{uuid:t.uuid||"",name:t.name||"",originalQuantity:t.originalQuantity||0,originalUnit:t.originalUnit||"",normalizedQuantity:t.normalizedQuantity||0,normalizedUnit:t.normalizedUnit||"",comment:t.comment||"",allergens:Array.isArray(t.allergens)?t.allergens:[],type:t.type||"",pF:t.pF??!1,pS:t.pS??!1}}function oa(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(n=>{try{e.push(sf(n))}catch(s){console.warn("[parseRecipeData] IngrÃ©dient invalide ignorÃ©:",s)}}),{...t,$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||"",ingredients:e}}function rf(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es d'index de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(n=>{typeof n=="string"?e.push(n):n&&typeof n.name=="string"&&e.push(n.name)}),{title:t.title||"",typeR:t.typeR||"",categories:Array.isArray(t.categories)?t.categories:[],regime:t.regime||null,draft:t.draft??!1,materiel:Array.isArray(t.materiel)?t.materiel:[],region:t.region||"",serveHot:t.serveHot??!1,cuisson:t.cuisson??!1,check:t.check??!1,saison:Array.isArray(t.saison)?t.saison:[],permissionWrite:Array.isArray(t.permissionWrite)?t.permissionWrite:[],lockedBy:t.lockedBy||null,plate:t.plate??100,ingredients:e,auteur:t.auteur||"",createdBy:t.createdBy||"",$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||""}}function Tr(t){let e=[];return t.ingredients&&(e=jr(t.ingredients).map(s=>s.name)),{title:t.title,typeR:t.typeR,categories:t.categories,regime:t.regime,draft:t.draft||!1,saison:t.saison,ingredients:e,materiel:t.materiel,region:t.region||null,serveHot:t.serveHot,cuisson:t.cuisson,check:t.check,auteur:t.auteur||t.createdBy,permissionWrite:t.permissionWrite,lockedBy:t.lockedBy||null,$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,createdBy:t.createdBy,plate:t.plate,rootRecipeId:t.rootRecipeId||null,versionLabel:t.versionLabel||null}}function of(t,e){const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),s=e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"";let r;if(s){const o=n.slice(0,16),i=s.slice(0,5);r=`${o}-${i}`}else r=n.slice(0,22);return`${r}_${kd(12).toLowerCase()}`}async function Lp(t,e,n,s,r=!1){try{const{functions:o,config:i}=await P(),c=i.functions.enkaData,l=JSON.stringify({action:t,recipeId:e,userId:n,data:s}),u=await o.createExecution({functionId:c,body:l,async:r});if(r){if(u.status==="failed")throw new Error(`Function execution failed to start: ${u.status}`);return{success:!0,executionId:u.$id}}if(u.status!=="completed")throw new Error(`Function execution failed: ${u.status} - ${u.responseBody}`);const d=JSON.parse(u.responseBody);if(!d.success)throw new Error(d.error||"Unknown error in manage_recipe");return d.data}catch(o){throw console.error(`[appwrite-recipes] Error executing manage_recipe (${t}):`,o),o}}const Tn="recettes";async function ia(){try{const{tables:t,config:e}=await P();return(await t.listRows({databaseId:e.databaseId,tableId:Tn})).rows}catch(t){throw console.error("[appwrite-recipes] Error listing all recipes:",t),t}}async function af(t){try{const{tables:e,config:n}=await P(),s=[b.greaterThan("$updatedAt",t)];return(await e.listRows({databaseId:n.databaseId,tableId:Tn,queries:s})).rows}catch(e){throw console.error(`[appwrite-recipes] Error listing updated recipes since ${t}:`,e),e}}async function Po(t){try{const{tables:e,config:n}=await P();return await e.getRow({databaseId:n.databaseId,tableId:Tn,rowId:t})}catch(e){if(e.code===404)return null;throw console.error(`[appwrite-recipes] Error getting recipe ${t}:`,e),e}}async function Up(t,e){try{const{tables:n,config:s,account:r}=await P(),o=of(t.title,t.versionLabel||void 0),i=[Q.read(F.users()),Q.update(F.user(e)),Q.delete(F.user(e))],l=(await r.get()).name,u={title:t.title,plate:t.plate,ingredients:t.ingredients,preparation:t.preparation,draft:t.draft??!0,typeR:t.typeR,categories:t.categories??[],regime:t.regime??[],check:t.check??!1,description:t.description??null,quantite_desc:t.quantite_desc??null,region:t.region??null,saison:t.saison??[],cuisson:t.cuisson??[],serveHot:t.serveHot??!0,auteur:l,preparation24h:t.preparation24h??null,astuces:t.astuces??null,publishedAt:t.publishedAt||new Date().toISOString().split("T")[0]+"T00:00:00Z",$id:o,createdBy:e,permissionWrite:t.permissionWrite||[e],rootRecipeId:t.rootRecipeId??null,versionLabel:t.versionLabel??null},d=await n.createRow({databaseId:s.databaseId,tableId:Tn,rowId:o,data:u,permissions:i});return console.log(`[appwrite-recipes] Recipe created: ${o}`),d}catch(n){throw console.error("[appwrite-recipes] Error creating recipe:",n),n}}async function cf(t,e,n){try{const{tables:s,config:r}=await P(),o={...e,check:e.check??!1,...e.publishedAt&&{publishedAt:e.publishedAt}},i=await s.updateRow({databaseId:r.databaseId,tableId:Tn,rowId:t,data:o});return console.log(`[appwrite-recipes] Recipe updated: ${t}`),i}catch(s){throw console.error(`[appwrite-recipes] Error updating recipe ${t}:`,s),s}}async function xp(t){try{const{tables:e,config:n}=await P();await e.updateRow({databaseId:n.databaseId,tableId:Tn,rowId:t,data:{status:"deleted"}}),console.log(`[appwrite-recipes] Recipe soft deleted: ${t}`)}catch(e){throw console.error(`[appwrite-recipes] Error deleting recipe ${t}:`,e),e}}const lf="/api/data.json";var W,ve,be,Bt,Ys,U,st,Ht,Vn,ge,Oo,hc,mc,Wo,Go;class uf{constructor(){v(this,ge);v(this,W,D(oe(new Yt)));v(this,ve,D(!1));v(this,be,D(null));v(this,Bt,D(!1));v(this,Ys,D(null));v(this,U,null);v(this,st,new Set);v(this,Ht,null);v(this,Vn,!1)}get loading(){return f(a(this,ve))}get error(){return f(a(this,be))}get isInitialized(){return f(a(this,Bt))}get recipesIndex(){return Array.from(f(a(this,W)).values())}get count(){return f(a(this,W)).size}getAllRecipes(){return Array.from(f(a(this,W)).values())}async loadCache(){if(f(a(this,Bt))){console.log("[RecipesStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[RecipesStore] Chargement du cache..."),g(a(this,ve),!0),g(a(this,be),null);try{_(this,U,await ef());const e=await a(this,U).loadRecipesIndex(),n=await a(this,U).loadMetadata();e.size>0&&(console.log(`[RecipesStore] ${e.size} recettes (index) chargÃ©es depuis le cache`),g(a(this,W),new Yt(e),!0)),g(a(this,Bt),!0),console.log(`[RecipesStore] Cache chargÃ©: ${f(a(this,W)).size} recettes`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(a(this,be),n,!0),console.error("[RecipesStore]",n,e),e}finally{g(a(this,ve),!1)}}async syncFromRemote(){if(!a(this,U)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation depuis sources distantes..."),g(a(this,ve),!0);try{const e=await a(this,U).loadMetadata();try{await S(this,ge,Oo).call(this,e)}catch(n){if(console.error("[RecipesStore] Erreur chargement data.json:",n),f(a(this,W)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}if(V.userId)try{await S(this,ge,hc).call(this,e)}catch(n){console.warn("[RecipesStore] Erreur sync Appwrite:",n)}console.log(`[RecipesStore] Synchronisation terminÃ©e: ${f(a(this,W)).size} recettes`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(a(this,be),n,!0),console.error("[RecipesStore]",n,e),e}finally{g(a(this,ve),!1)}}async setupRealtime(){if(!a(this,U)){console.warn("[RecipesStore] Impossible de setup realtime : cache non initialisÃ©");return}if(a(this,Vn)){console.log("[RecipesStore] Realtime dÃ©jÃ  configurÃ©");return}if(console.log("[RecipesStore] Configuration du realtime..."),V.userId)try{S(this,ge,mc).call(this),_(this,Vn,!0)}catch(e){console.warn("[RecipesStore] Erreur activation realtime:",e)}}async initialize(){if(f(a(this,Bt))){console.log("[RecipesStore] DÃ©jÃ  initialisÃ©");return}return a(this,Ht)?(console.log("[RecipesStore] Initialisation dÃ©jÃ  en cours, attente..."),a(this,Ht)):(console.log("[RecipesStore] Initialisation..."),g(a(this,ve),!0),g(a(this,be),null),_(this,Ht,(async()=>{try{if(await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),f(a(this,W)).size===0){const e="Aucune recette disponible aprÃ¨s initialisation";g(a(this,be),e),console.warn("[RecipesStore]",e)}console.log(`[RecipesStore] Initialisation complÃ©tÃ©e: ${f(a(this,W)).size} recettes`)}catch(e){const n=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(a(this,be),n,!0),console.error("[RecipesStore] ECHEC Initialisation:",n,e),e}finally{g(a(this,ve),!1),_(this,Ht,null)}})()),a(this,Ht))}async forceReloadAllRecipes(){if(!V.userId)throw new Error("Utilisateur non connectÃ©");g(a(this,ve),!0),g(a(this,be),null);try{console.log("[RecipesStore] Rechargement forcÃ© des recettes Appwrite...");const e=await ia();let n=0,s=0;if(e.forEach(r=>{r.status==="deleted"?f(a(this,W)).has(r.$id)&&(f(a(this,W)).delete(r.$id),s++,console.log(`[RecipesStore] Recette ${r.$id} supprimÃ©e (status=deleted)`)):(f(a(this,W)).set(r.$id,Tr(r)),n++)}),console.log(`[RecipesStore] ${n} recettes Appwrite chargÃ©es, ${s} supprimÃ©es`),a(this,U)){const r=await a(this,U).loadMetadata(),o=new Date().toISOString();await a(this,U).saveRecipesIndex(f(a(this,W))),await a(this,U).saveMetadata({...r,lastAppwriteSync:o,recipesCount:f(a(this,W)).size,cacheVersion:1})}console.log("[RecipesStore] Rechargement forcÃ© terminÃ©")}catch(e){const n=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(a(this,be),n,!0),console.error("[RecipesStore] Erreur rechargement forcÃ©:",e),e}finally{g(a(this,ve),!1)}}async hardReset(){if(!V.userId)throw new Error("Utilisateur non connectÃ©");console.log("[RecipesStore] ð HARD RESET - Vidage complet..."),g(a(this,ve),!0),g(a(this,be),null);try{f(a(this,W)).clear(),a(this,U)&&(await a(this,U).clear(),console.log("[RecipesStore] Cache IDB vidÃ©")),await S(this,ge,Oo).call(this,null);const e=await ia();let n=0,s=0;if(e.forEach(r=>{r.status!=="deleted"?(f(a(this,W)).set(r.$id,Tr(r)),n++):s++}),console.log(`[RecipesStore] ${n} recettes Appwrite chargÃ©es, ${s} supprimÃ©es ignorÃ©es`),a(this,U)){const r=new Date().toISOString();await a(this,U).saveRecipesIndex(f(a(this,W))),await a(this,U).saveMetadata({buildTimestamp:f(a(this,Ys)),lastAppwriteSync:r,recipesCount:f(a(this,W)).size,cacheVersion:1}),console.log("[RecipesStore] Cache IDB recrÃ©Ã©")}console.log("[RecipesStore] â HARD RESET terminÃ©")}catch(e){const n=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(a(this,be),n,!0),console.error("[RecipesStore] Erreur hard reset:",e),e}finally{g(a(this,ve),!1)}}getRecipeIndexByUuid(e){return f(a(this,W)).get(e)||null}searchRecipes(e){if(!e.trim())return this.recipesIndex;const n=S(this,ge,Wo).call(this,e.trim()).split(/\s+/);return this.recipesIndex.filter(s=>{const o=S(this,ge,Wo).call(this,s.title).split(/[\s\-_]+/);return n.every(i=>o.some(c=>c.startsWith(i)))})}get availableTypes(){const e=new Set;return this.recipesIndex.forEach(n=>e.add(n.typeR)),Array.from(e).sort()}async canEditRecipe(e){if(!V.userId)return!1;try{const n=await Po(e);return n?n.createdBy===V.userId||!!n.permissionWrite?.includes(V.userId)||!!n.teams?.some(s=>V.userTeams.includes(s)):!1}catch(n){return console.error(`[RecipesStore] Erreur lors de la vÃ©rification des permissions pour ${e}:`,n),!1}}getRecipeLockStatus(e){return f(a(this,W)).get(e)?.lockedBy||null}async updateRecipeLock(e,n){if(V.userId)try{await cf(e,{lockedBy:n},V.userId),console.log(`[RecipesStore] Verrou ${e} mis Ã  jour: ${n||"libÃ©rÃ©"}`);const s=f(a(this,W)).get(e);s&&f(a(this,W)).set(e,{...s,lockedBy:n})}catch(s){throw console.error(`[RecipesStore] Erreur verrouillage ${e}:`,s),s}}async getRecipeByUuid(e){if(a(this,st).has(e)){for(console.log(`[RecipesStore] Chargement de ${e} dÃ©jÃ  en cours, attente...`);a(this,st).has(e);)await new Promise(n=>setTimeout(n,50));return a(this,U)&&await a(this,U).loadRecipeDetail(e)||null}a(this,st).add(e);try{if(a(this,U)){const s=await a(this,U).loadRecipeDetail(e);if(s)return s}let n=null;try{const s=`/recettes/${e}/recipe.json`,r=await fetch(s);if(r.ok){const o=await r.json();n=oa(o),console.log(`[RecipesStore] ${e} chargÃ©e depuis Hugo`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Hugo`)}if(!n&&V.userId)try{const s=await Po(e);if(s){const r=jr(s.ingredients||[]);n={...s,ingredients:r,astuces:To(s.astuces),prepAlt:s.prepAlt||null,categories:s.categories,regime:s.regime,saison:s.saison,teams:s.teams,permissionWrite:s.permissionWrite},console.log(`[RecipesStore] ${e} chargÃ©e depuis Appwrite (fallback)`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Appwrite`)}return n&&a(this,U)&&await a(this,U).saveRecipeDetail(n),n||console.warn(`[RecipesStore] ${e} non trouvÃ©e (Hugo ni Appwrite)`),n}catch(n){return console.error(`[RecipesStore] Erreur lors du chargement de ${e}:`,n),null}finally{a(this,st).delete(e)}}async getRecipesByUuidsBulk(e){const n=performance.now(),s=[...new Set(e.filter(Boolean))];if(s.length===0)return new Map;console.log(`[RecipesStore] Chargement bulk de ${s.length} recettes...`);const r=new Map;a(this,U)&&(await a(this,U).loadRecipeDetailsBulk(s)).forEach((d,p)=>r.set(p,d));const o=s.filter(u=>!r.has(u));console.log(`[RecipesStore] Bulk: ${r.size} dans le cache, ${o.length} Ã  fetch`);const i=new Map;if(o.length>0){o.forEach(u=>a(this,st).add(u));try{const u=o.map(async p=>{let h=null;try{const m=`/recettes/${p}/recipe.json`,y=await fetch(m);if(y.ok){const I=await y.json();h=oa(I)}}catch{}if(!h&&V.userId)try{const m=await Po(p);if(m){const y=jr(m.ingredients||[]);h={...m,ingredients:y,astuces:To(m.astuces),prepAlt:m.prepAlt||null,categories:m.categories,regime:m.regime,saison:m.saison,teams:m.teams,permissionWrite:m.permissionWrite}}}catch{}return h?{uuid:p,recipe:h}:null});(await Promise.all(u)).forEach(p=>{p&&i.set(p.uuid,p.recipe)}),i.size>0&&a(this,U)&&await a(this,U).saveRecipeDetailsBulk(i),o.forEach(p=>a(this,st).delete(p))}catch(u){console.error("[RecipesStore] Erreur lors du fetch bulk:",u),o.forEach(d=>a(this,st).delete(d))}}const c=new Map([...r,...i]),l=performance.now()-n;return console.log(`[RecipesStore] Bulk terminÃ©: ${c.size}/${s.length} recettes en ${l.toFixed(0)}ms`),c}async preloadRecipes(e){console.log(`[RecipesStore] PrÃ©chargement de ${e.length} recettes...`);const n=e.map(s=>this.getRecipeByUuid(s));await Promise.all(n),console.log("[RecipesStore] PrÃ©chargement terminÃ©")}async getVariantGroup(e,n=2){const s=this.getRecipeIndexByUuid(e);if(!s)return{root:null,variants:[],isRoot:!1};const r=new Map,o=new Set;let i=s;for(;i.rootRecipeId&&!o.has(i.rootRecipeId);){o.add(i.$id);const l=this.getRecipeIndexByUuid(i.rootRecipeId);if(!l)break;i=l}const c=i;return r.set(c.$id,c),await S(this,ge,Go).call(this,c.$id,r,new Set([c.$id]),0,n),{root:c,variants:Array.from(r.values()),isRoot:!s.rootRecipeId||s.rootRecipeId===s.$id}}findRootRecipe(e){const n=new Set;let s=e,r=10;for(let o=0;o<r;o++){const i=this.getRecipeIndexByUuid(s);if(!i||!i.rootRecipeId)return s;if(n.has(s))return console.error("[RecipesStore] Cycle dÃ©tectÃ© dans rootRecipeId, retour Ã ",e),e;n.add(s),s=i.rootRecipeId}return e}destroy(){a(this,U)&&(a(this,U).close(),_(this,U,null)),f(a(this,W)).clear(),g(a(this,Bt),!1),_(this,Vn,!1),console.log("[RecipesStore] Ressources nettoyÃ©es")}}W=new WeakMap,ve=new WeakMap,be=new WeakMap,Bt=new WeakMap,Ys=new WeakMap,U=new WeakMap,st=new WeakMap,Ht=new WeakMap,Vn=new WeakMap,ge=new WeakSet,Oo=async function(e){try{console.log("[RecipesStore] Chargement data.json...");const n=await fetch(lf);if(!n.ok)throw new Error(`Erreur HTTP: ${n.status}`);const s=await n.json();if(!Array.isArray(s.recipes))throw new Error("Format invalide: recipes n'est pas un tableau");const r=s.meta?.timestamp;if(g(a(this,Ys),r,!0),r&&e&&e.buildTimestamp&&e.buildTimestamp>=r){console.log(`[RecipesStore] Cache Ã  jour (Ts: ${e.buildTimestamp} >= ${r})`);return}console.log(`[RecipesStore] Nouvelle version dÃ©tectÃ©e ou cache manquant (Ts: ${r}), Traitement...`);const o=s.recipes.map(c=>rf(c));let i=0;o.forEach(c=>{const l=f(a(this,W)).get(c.$id);let u=!1;if(!l)u=!0;else{const d=new Date(c.$updatedAt).getTime(),p=new Date(l.$updatedAt).getTime();d>p&&(u=!0)}u&&(f(a(this,W)).set(c.$id,c),i++)}),console.log(`[RecipesStore] Smart Merge: ${i} recettes mises Ã  jour/ajoutÃ©es.`),a(this,U)&&(await a(this,U).saveRecipesIndex(f(a(this,W))),await a(this,U).saveMetadata({...e,buildTimestamp:r||Date.now()/1e3,recipesCount:f(a(this,W)).size,cacheVersion:1}))}catch(n){throw console.error("[RecipesStore] Erreur loadIndexFromDataJson:",n),n}},hc=async function(e){console.log("[RecipesStore] Sync incrÃ©mentiel Appwrite...");const n=e?.lastAppwriteSync||"1970-01-01T00:00:00.000Z";e?.buildTimestamp&&new Date(e.buildTimestamp*1e3).toISOString(),console.log(`[RecipesStore] Sync Appwrite: depuis ${n}`);const s=await af(n);if(s.length===0){console.log("[RecipesStore] Aucune mise Ã  jour Appwrite dÃ©tectÃ©e.");return}console.log(`[RecipesStore] ${s.length} recettes mises Ã  jour depuis Appwrite.`);let r=0,o=0;s.forEach(c=>{if(c.status==="deleted")f(a(this,W)).has(c.$id)&&(f(a(this,W)).delete(c.$id),o++,console.log(`[RecipesStore] Recette ${c.$id} supprimÃ©e (status=deleted)`));else{const l=Tr(c);f(a(this,W)).set(l.$id,l),r++}});const i=new Date().toISOString();a(this,U)&&(await a(this,U).saveRecipesIndex(f(a(this,W))),await a(this,U).saveMetadata({...e,lastAppwriteSync:i})),console.log(`[RecipesStore] Sync incrÃ©mentiel terminÃ© (${r} mises Ã  jour, ${o} supprimÃ©es).`)},mc=async function(){try{console.log("[RecipesStore] Configuration du Realtime...");const e=$t();hr.register([`databases.${e}.collections.${Tn}.documents`],async n=>{const s=n.payload;let r="update";if(n.events.some(o=>o.includes(".create"))?r="create":n.events.some(o=>o.includes(".delete"))&&(r="delete"),console.log(`[RecipesStore] â¡ï¸ Realtime RECEIVED: ${r} pour ${s.$id}`),r==="create"||r==="update"){if(s.status==="deleted"){if(f(a(this,W)).delete(s.$id),a(this,U))try{await a(this,U).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e de l'index (status=deleted)`)}catch(l){console.warn(`[RecipesStore] Erreur suppression index ${s.$id}:`,l)}return}const o=Tr(s);f(a(this,W)).set(s.$id,o);const i=jr(s.ingredients),c={...s,ingredients:i,astuces:To(s.astuces)};if(a(this,U))try{await a(this,U).saveRecipeDetail(c),console.log(`[RecipesStore] DÃ©tails de ${s.$id} mis Ã  jour dans le cache`)}catch(l){console.warn(`[RecipesStore] Erreur mise Ã  jour cache dÃ©tails ${s.$id}:`,l)}}else if(r==="delete"&&(f(a(this,W)).delete(s.$id),a(this,U)))try{await a(this,U).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e du cache`)}catch(o){console.warn(`[RecipesStore] Erreur suppression cache ${s.$id}:`,o)}}),console.log("[RecipesStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[RecipesStore] Erreur lors de la configuration du realtime:",e)}},Wo=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},Go=async function(e,n,s,r,o){if(!(r>o))for(const[i,c]of f(a(this,W)))n.has(i)||c.rootRecipeId===e&&(n.set(i,c),c.rootRecipeId&&c.rootRecipeId!==e&&!s.has(c.rootRecipeId)&&(s.add(c.rootRecipeId),await S(this,ge,Go).call(this,c.rootRecipeId,n,s,r+1,o)))};const aa=new uf,ca=1e3;var x,De,fe,He,zt,Xs,Qn,gn,yn,Ie,K,Ot,Zs,L,Fs,er,tr,nr,sr,Fr,rr,or,eo,N,gc,Jn,gt,yc,wc,Lr,Ur,vc,Vo,ff,fs,bc,Ic,Ec,Sc,_c,xr,Rc,Ac,Tc,ir,ar;class df{constructor(){v(this,N);v(this,x,new Yt);v(this,De,new Yt);v(this,fe,D(null));v(this,He,D(null));v(this,zt,D(!1));v(this,Xs,D(!1));v(this,Qn,D(null));v(this,gn,D(!1));v(this,yn,D(!1));v(this,Ie,D(null));k(this,"dateStore",new Zd);v(this,K,null);v(this,Ot,null);v(this,Zs,D(oe([])));v(this,L,D(oe({searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"})));v(this,Fs,Y(()=>{const e=Array.from(a(this,x).values()).map(n=>n.data);return console.log(`[ProductsStore] enrichedProducts recalculated: ${e.length} products`),e}));v(this,er,Y(()=>{if(console.log("[Store] Filtering products by date range (Map)"),!this.dateRange.start||!this.dateRange.end)return new Map;const e=new Date(this.dateRange.start),n=new Date(this.dateRange.end),s=new Map;for(const[r,o]of a(this,x)){const i=o.data,c=!i.productHugoUuid;if(!i.byDate&&!c||!Vu(i,f(a(this,L))))continue;if(f(a(this,L)).completionStatus!=="all"){const d=o.stats.hasMissing;if(f(a(this,L)).completionStatus==="completed"&&d||f(a(this,L)).completionStatus==="incomplete"&&!d)continue}let u=!1;if(i.byDate){const d=new Date(e);d.setHours(0,0,0,0);const p=new Date(n);p.setHours(23,59,59,999),u=Object.keys(i.byDate).some(h=>{const m=new Date(h);return m>=d&&m<=p})}(u||c)&&s.set(r,o)}return s}));v(this,tr,Y(()=>({total:a(this,x).size,frais:Array.from(a(this,x).values()).filter(e=>e.pF).length,surgel:Array.from(a(this,x).values()).filter(e=>e.pS).length,merged:Array.from(a(this,x).values()).filter(e=>e.data.isMerged).length})));v(this,nr,Y(()=>{const e=Array.from(a(this,x).values()).map(n=>n.storeInfo?.storeName).filter(Boolean);return[...new Set(e)]}));v(this,sr,Y(()=>{if(!f(a(this,He)))return[];const e=Jt.getEventById(f(a(this,He)));return e?.contributors?e.contributors.filter(n=>n.status==="accepted"&&n.name?.trim()).map(n=>n.name.trim()).sort():[]}));v(this,Fr,Y(()=>{const e=Array.from(a(this,x).values()).flatMap(n=>n.who||[]);return[...new Set(e)].sort()}));v(this,rr,Y(()=>{const e=new Set([...this.eventContributors,...f(a(this,Fr))]);return Array.from(e).sort()}));v(this,or,Y(()=>{const e=Array.from(a(this,x).values()).map(n=>n.productType).filter(Boolean);return[...new Set(e)]}));v(this,eo,Y(()=>{const n=Array.from(this.filteredProductsMap.values()).sort((i,c)=>i.$id.localeCompare(c.$id));if(f(a(this,L)).groupBy==="none")return{"":n};const s=Object.groupBy(n,i=>f(a(this,L)).groupBy==="store"?i.storeInfo?.storeName||"Non dÃ©fini":i.productType||"Non dÃ©fini"),r=Object.keys(s).sort((i,c)=>i===""?1:c===""?-1:i.localeCompare(c)),o={};return r.forEach(i=>{o[i]=s[i]}),o}));v(this,Jn,"");v(this,gt,null);k(this,"setSearchQuery",Bu(e=>{f(a(this,L)).searchQuery=e},()=>500));v(this,ir,Y(()=>{let e=0,n=0;for(const s of a(this,x).values())s.stats.hasMissing?n++:e++;return{completed:e,missing:n,total:e+n}}));v(this,ar,Y(()=>{let e=0;const n={},s={},r=[];for(const o of a(this,De).values()){const i=o.invoiceTotal||o.price||0;e+=i;const c=o.store||"Non dÃ©fini";n[c]=(n[c]||0)+i;const l=o.who||"Non dÃ©fini";s[l]=(s[l]||0)+i,r.push(o)}for(const o of a(this,x).values()){const i=o.data;if(i.purchases&&i.purchases.length>0){for(const c of i.purchases)if(c.price){e+=c.price;const l=c.store||"Non dÃ©fini";n[l]=(n[l]||0)+c.price;const u=c.who||"Non dÃ©fini";s[u]=(s[u]||0)+c.price;const d={...c,_productName:i.productName};r.push(d)}}}return r.sort((o,i)=>{const c=new Date(o.orderDate||o.$createdAt).getTime();return new Date(i.orderDate||i.$createdAt).getTime()-c}),{totalGlobal:e,byStore:n,byWho:s,allPurchases:r}}))}get currentMainId(){return f(a(this,fe))}get dateRange(){return this.dateStore.current}get availableDates(){return this.dateStore.dates}get isEventPassed(){return this.dateStore.isEventPassed}get hasSingleDateEvent(){return this.dateStore.hasSingleDateEvent}get hasSingleDateInRange(){return this.dateStore.hasSingleDateInRange}get hasPastDatesInRange(){return this.dateStore.hasPastDatesInRange}get hasPendingConflicts(){return f(a(this,Zs)).length>0}get pendingConflicts(){return f(a(this,Zs))}get filters(){return f(a(this,L))}get hasFilters(){return this.filters.searchQuery!==""||this.filters.selectedStores.length>0||this.filters.selectedWho.length>0||this.filters.selectedProductTypes.length>0||this.filters.selectedTemperatures.length>0||this.filters.temperatureFilter!=="all"||this.filters.completionStatus!=="all"}get groupedFilteredProducts(){return f(a(this,eo))}get loading(){return f(a(this,Xs))}get error(){return f(a(this,Qn))}get lastSync(){return f(a(this,Ie))}get syncing(){return f(a(this,gn))}setDateRange(e,n){this.dateStore.setRange(e,n)}isFullRange(){return this.dateStore.isFullRange}initializeDateRange(){this.dateStore.initializeSmartRange()}selectUpcomingDates(){this.dateStore.selectUpcoming()}isUpcomingRange(){return this.dateStore.isUpcomingRange}get firstAvailableDate(){return this.dateStore.firstAvailableDate}get lastAvailableDate(){return this.dateStore.lastAvailableDate}selectFutureDatesOnly(){this.dateStore.selectFutureDatesOnly()}get realtimeConnected(){return f(a(this,yn))}get enrichedProducts(){return f(a(this,Fs))}set enrichedProducts(e){g(a(this,Fs),e)}get filteredProductsMap(){return f(a(this,er))}set filteredProductsMap(e){g(a(this,er),e)}get stats(){return f(a(this,tr))}set stats(e){g(a(this,tr),e)}get uniqueStores(){return f(a(this,nr))}set uniqueStores(e){g(a(this,nr),e)}get eventContributors(){return f(a(this,sr))}set eventContributors(e){g(a(this,sr),e)}get uniqueWho(){return f(a(this,rr))}set uniqueWho(e){g(a(this,rr),e)}get uniqueProductTypes(){return f(a(this,or))}set uniqueProductTypes(e){g(a(this,or),e)}async initialize(e){if(!e?.trim())throw new Error("eventId invalide fourni");if(f(a(this,zt))&&f(a(this,He))===e){console.log(`[ProductsStore] DÃ©jÃ  initialisÃ© pour eventId: ${e}`);return}f(a(this,zt))&&f(a(this,He))!==e&&(console.log(`[ProductsStore] Changement d'Ã©vÃ©nement: ${f(a(this,He))} â ${e}, reset...`),this.reset()),console.log(`[ProductsStore] Initialisation avec eventId: ${e}`);const n=Jt.getEventById(e);if(!n)throw new Error(`ÃvÃ©nement ${e} introuvable dans EventsStore`);try{g(a(this,He),n.$id,!0),g(a(this,fe),n.$id,!0),V.setCurrentMainId(f(a(this,fe))),console.log(`[ProductsStore] Initialisation du cache IDB pour mainId: ${f(a(this,fe))}`),_(this,K,await Xd(f(a(this,fe)))),await S(this,N,wc).call(this),a(this,x).size===0&&(console.log("[ProductsStore] Cache vide, calcul depuis event.meals..."),await S(this,N,yc).call(this,n),await S(this,N,Lr).call(this)),this.dateStore.setAvailableDates([...n.allDates||[]]),this.initializeDateRange(),await this.syncFromAppwrite(),await S(this,N,Tc).call(this),g(a(this,zt),!0);const s=S(this,N,Rc).call(this);S(this,N,Ac).call(this,s),a(this,gt)&&a(this,gt).call(this),_(this,gt,Bl(()=>{Hr(()=>{const r=Jt.getEventById(e);r&&S(this,N,gc).call(this,r)})})),console.log(`[ProductsStore] Initialisation complÃ©tÃ©e: ${a(this,x).size} produits`)}catch(s){const r=s instanceof Error?s.message:"Erreur lors de l'initialisation";throw g(a(this,Qn),r,!0),console.error("[ProductsStore]",r,s),s}}async syncFromAppwrite(){if(f(a(this,fe))){g(a(this,gn),!0),console.log(`[ProductsStore] DÃ©but syncFromAppwrite pour mainId: ${f(a(this,fe))}`);try{console.log(`[ProductsStore] RÃ©cupÃ©ration des produits modifiÃ©s depuis lastSync: ${f(a(this,Ie))}`);const e=await Vd(f(a(this,fe)),{lastSync:f(a(this,Ie)),limit:ca});if(console.log(`[ProductsStore] ${e.length} produits rÃ©cupÃ©rÃ©s depuis Appwrite`),e.forEach(n=>{const s=a(this,x).get(n.$id);console.log(`[ProductsStore] Sync produit ${n.$id}: existing=${!!s}, who=${n.who}, store=${n.store}`);const r=S(this,N,Vo).call(this,n,s?.data);r.isSynced=!0,r.status="active",s?s.update(r):a(this,x).set(n.$id,new cs(r,this.dateStore))}),f(a(this,Ie))){console.log(`[ProductsStore] RÃ©cupÃ©ration des purchases modifiÃ©s depuis lastSync: ${f(a(this,Ie))}`);const n=await Gd(f(a(this,fe)),f(a(this,Ie)),ca);console.log(`[ProductsStore] ${n.length} purchases modifiÃ©s rÃ©cupÃ©rÃ©s`),n.forEach(s=>{if(s.status==="expense")a(this,De).set(s.$id,s);else if(s.products?.length){const r=s.products.map(o=>typeof o=="string"?o:o.$id);S(this,N,xr).call(this,r,s)}})}S(this,N,vc).call(this),await S(this,N,Lr).call(this),console.log("[ProductsStore] SyncFromAppwrite terminÃ© avec succÃ¨s")}catch(e){throw console.error("[ProductsStore] Erreur lors du sync:",e),e}finally{g(a(this,gn),!1)}}}toggleProductType(e){const n=f(a(this,L)).selectedProductTypes.indexOf(e);n>-1?f(a(this,L)).selectedProductTypes.splice(n,1):f(a(this,L)).selectedProductTypes.push(e)}toggleTemperature(e){const n=f(a(this,L)).selectedTemperatures.indexOf(e);n>-1?f(a(this,L)).selectedTemperatures.splice(n,1):f(a(this,L)).selectedTemperatures.push(e)}setTemperatureFilter(e){f(a(this,L)).temperatureFilter=e}clearTypeAndTemperatureFilters(){f(a(this,L)).selectedProductTypes=[],f(a(this,L)).selectedTemperatures=[],f(a(this,L)).temperatureFilter="all"}setGroupBy(e){f(a(this,L)).groupBy=e}toggleStore(e){const n=f(a(this,L)).selectedStores.indexOf(e);n>-1?f(a(this,L)).selectedStores.splice(n,1):f(a(this,L)).selectedStores.push(e)}toggleWho(e){const n=f(a(this,L)).selectedWho.indexOf(e);n>-1?f(a(this,L)).selectedWho.splice(n,1):f(a(this,L)).selectedWho.push(e)}clearStoreFilters(){f(a(this,L)).selectedStores=[]}clearWhoFilters(){f(a(this,L)).selectedWho=[]}setCompletionStatus(e){f(a(this,L)).completionStatus=e}handleSort(e){f(a(this,L)).sortColumn===e?f(a(this,L)).sortDirection=f(a(this,L)).sortDirection==="asc"?"desc":"asc":(f(a(this,L)).sortColumn=e,f(a(this,L)).sortDirection="asc")}clearFilters(){g(a(this,L),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0)}sortProducts(e){return f(a(this,L)).sortColumn?[...e].sort((n,s)=>{let r=n[f(a(this,L)).sortColumn],o=s[f(a(this,L)).sortColumn];return f(a(this,L)).sortColumn==="totalNeededConsolidated"?(r=parseFloat(r)||0,o=parseFloat(o)||0):f(a(this,L)).sortColumn==="purchases"&&(r=n.purchases?.length||0,o=s.purchases?.length||0),r<o?f(a(this,L)).sortDirection==="asc"?-1:1:r>o?f(a(this,L)).sortDirection==="asc"?1:-1:0}):e}getEnrichedProductById(e){return a(this,x).get(e)?.data??null}getProductModelById(e){return a(this,x).get(e)??null}hasConversions(e){const n=a(this,x).get(e)?.data;return n?.byDate?Wu(n.byDate):!1}async forceReload(e){await this.clearCache(),await this.initialize(e)}async clearCache(){a(this,x).clear(),g(a(this,Ie),null),a(this,K)&&await a(this,K).clear(),console.log("[ProductsStore] Cache vidÃ©")}setSyncStatus(e,n){const s=n?"isSyncing":"active";e.forEach(r=>{const o=a(this,x).get(r);if(o){const i={...o.data,status:s};o.update(i)}}),console.log(`[ProductsStore] Statut de synchronisation mis Ã  jour: ${e.length} produits â ${s}`)}clearSyncStatus(){const e=[];for(const[n,s]of a(this,x))s.status==="isSyncing"&&e.push(n);e.length>0&&(this.setSyncStatus(e,!1),console.log(`[ProductsStore] Nettoyage de ${e.length} produits en statut "isSyncing"`))}reset(){var e;console.log(`[ProductsStore] Reset pour eventId: ${f(a(this,He))}`),(e=a(this,Ot))==null||e.call(this),_(this,Ot,null),a(this,gt)&&(a(this,gt).call(this),_(this,gt,null)),a(this,K)&&(a(this,K).close(),_(this,K,null)),a(this,x).clear(),a(this,De).clear(),g(a(this,fe),null),g(a(this,He),null),g(a(this,zt),!1),g(a(this,Xs),!1),g(a(this,Qn),null),g(a(this,gn),!1),g(a(this,yn),!1),g(a(this,Ie),null),_(this,Jn,""),this.dateStore.reset(),g(a(this,L),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0),console.log("[ProductsStore] Reset terminÃ©")}destroy(){var e;(e=a(this,Ot))==null||e.call(this),_(this,Ot,null),a(this,K)&&(a(this,K).close(),_(this,K,null)),console.log("[ProductsStore] Ressources nettoyÃ©es")}get completionStats(){return f(a(this,ir))}set completionStats(e){g(a(this,ir),e)}get financialStats(){return f(a(this,ar))}set financialStats(e){g(a(this,ar),e)}}x=new WeakMap,De=new WeakMap,fe=new WeakMap,He=new WeakMap,zt=new WeakMap,Xs=new WeakMap,Qn=new WeakMap,gn=new WeakMap,yn=new WeakMap,Ie=new WeakMap,K=new WeakMap,Ot=new WeakMap,Zs=new WeakMap,L=new WeakMap,Fs=new WeakMap,er=new WeakMap,tr=new WeakMap,nr=new WeakMap,sr=new WeakMap,Fr=new WeakMap,rr=new WeakMap,or=new WeakMap,eo=new WeakMap,N=new WeakSet,gc=async function(e){if(!f(a(this,zt))){console.warn("[ProductsStore] Sync ignorÃ© car store non initialisÃ©");return}const n=JSON.stringify(e.meals);if(a(this,Jn)===n)return;console.log(`[ProductsStore] â¡ï¸ CHANGEMENT REPAS DÃTECTÃ pour ${e.$id} (Hash: ${n.substring(0,10)}...), recalcul...`),_(this,Jn,n);const r=await zi(e,async i=>await aa.getRecipeByUuid(i),e.$id);r.forEach(i=>{const c=a(this,x).get(i.$id);if(c){const u={...c.data,byDate:i.byDate,totalNeededArray:i.totalNeededArray,totalNeededRaw:i.totalNeededRaw,nbRecipes:i.nbRecipes,totalAssiettes:i.totalAssiettes};td(u),c.update(u)}else a(this,x).set(i.$id,new cs(i,this.dateStore))});const o=new Set(r.map(i=>i.$id));for(const[i,c]of a(this,x))o.has(i)||!c.data.isSynced&&!c.data.purchases?.length&&a(this,x).delete(i);this.dateStore.setAvailableDates([...e.allDates||[]]),S(this,N,Lr).call(this)},Jn=new WeakMap,gt=new WeakMap,yc=async function(e){const s=await zi(e,async r=>await aa.getRecipeByUuid(r),e.$id);s.forEach(r=>{a(this,x).set(r.$id,new cs(r,this.dateStore))}),console.log(`[ProductsStore] ${s.length} produits calculÃ©s depuis ${e.meals.length} repas`)},wc=async function(){if(a(this,K))try{const e=await a(this,K).loadProducts();e.forEach((s,r)=>{s.status==="isSyncing"&&(s.status="active"),a(this,x).set(r,new cs(s,this.dateStore))});const n=await a(this,K).loadMetadata();g(a(this,Ie),n.lastSync,!0),this.dateStore.setAvailableDates([...n.allDates]),console.log(`[ProductsStore] ${e.size} produits chargÃ©s du cache IDB, lastSync: ${n.lastSync}`)}catch(e){console.warn("[ProductsStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Lr=async function(){if(a(this,K))try{const e=new Map;a(this,x).forEach((n,s)=>{const r=Er(n.data);r.status==="isSyncing"&&(r.status="active"),e.set(s,r)}),await a(this,K).saveProducts(e),await a(this,K).saveMetadata({lastSync:f(a(this,Ie)),allDates:[...this.dateStore.dates]}),console.log("[ProductsStore] Cache IDB persistÃ©")}catch(e){console.error("[ProductsStore] Erreur persist cache IDB:",e)}},Ur=async function(e){if(!(!a(this,K)||e.length===0))try{const n=e.map(s=>a(this,x).get(s)?.data).filter(s=>s!=null).map(s=>{const r=Er(s);return r.status==="isSyncing"&&(r.status="active"),a(this,K).upsertProduct(r)});n.length>0&&(await Promise.all(n),console.log(`[ProductsStore] ${n.length} produits affectÃ©s persistÃ©s`))}catch(n){console.error("[ProductsStore] Erreur persistence produits affectÃ©s:",n)}},vc=function(){g(a(this,Ie),new Date().toISOString(),!0)},Vo=function(e,n){return n?Ar(e,n):ed(e)},ff=function(e){e.length&&(e.forEach(n=>S(this,N,fs).call(this,n)),console.log(`[ProductsStore] ${e.length} produits upserted`))},fs=function(e){const n=a(this,x).get(e.$id),s=S(this,N,Vo).call(this,e,n?.data);n?n.update(s):(this.dateStore.dates,a(this,x).set(e.$id,new cs(s,this.dateStore)))},bc=function(e){a(this,x).delete(e)},Ic=async function(e){if(!e.products?.length)return console.warn("[ProductsStore] Purchase crÃ©Ã© sans products:",e.$id),[];const n=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return S(this,N,_c).call(this,n,e),n},Ec=async function(e){if(e.products?.length){const n=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return S(this,N,xr).call(this,n,e),n}console.log("[ProductsStore] Purchase update sans products[], rechargement...");try{const[n]=await Jd([e.$id]);if(n?.products?.length){const s=n.products.map(r=>typeof r=="string"?r:r.$id).filter(Boolean);return S(this,N,xr).call(this,s,n),s}return[]}catch(n){return console.error("[ProductsStore] Erreur rechargement purchase:",n),[]}},Sc=async function(e){const n=Array.from(a(this,x).values()).map(s=>s.data).filter(s=>s.purchases?.some(r=>r.$id===e));return n.forEach(s=>{S(this,N,fs).call(this,s)}),n.map(s=>s.$id)},_c=function(e,n){const s=Hi(n),r=[];e.forEach(o=>{const i=a(this,x).get(o);if(i){const c=i.data,l=c.purchases||[];if(!l.some(u=>u.$id===s.$id)){const u=Ar({...c,purchases:[...l,s],status:"active"},c);r.push(u)}}}),r.forEach(o=>{const i=a(this,x).get(o.$id);i&&i.update(o)})},xr=function(e,n){const s=Hi(n),r=[];e.forEach(o=>{const i=a(this,x).get(o);if(i){const c=i.data,l=c.purchases||[],u=l.findIndex(d=>d.$id===s.$id);if(u>=0){const d=[...l];d[u]=s;const p=Ar({...c,purchases:d,status:"active"},c);r.push(p)}else{const d=Ar({...c,purchases:[...l,n],status:"active"},c);r.push(d)}}}),r.forEach(o=>{const i=a(this,x).get(o.$id);i&&i.update(o)})},Rc=function(){return{onProductCreate:e=>{if(S(this,N,fs).call(this,e),a(this,K)){const n=a(this,x).get(e.$id);n&&a(this,K).upsertProduct(Er(n.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},onProductUpdate:e=>{if(S(this,N,fs).call(this,e),a(this,K)){const n=a(this,x).get(e.$id);n&&a(this,K).upsertProduct(Er(n.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},onProductDelete:e=>{S(this,N,bc).call(this,e),a(this,K)&&a(this,K).deleteProduct(e).catch(n=>console.error("[ProductsStore] Erreur suppression produit:",n))},onPurchaseCreate:async e=>{if(e.status==="expense"){a(this,De).set(e.$id,e);return}const n=await S(this,N,Ic).call(this,e);await S(this,N,Ur).call(this,n)},onPurchaseUpdate:async e=>{if(e.status==="expense"){a(this,De).set(e.$id,e);return}a(this,De).has(e.$id)&&a(this,De).delete(e.$id);const n=await S(this,N,Ec).call(this,e);await S(this,N,Ur).call(this,n)},onPurchaseDelete:async e=>{if(a(this,De).has(e)){a(this,De).delete(e);return}const n=await S(this,N,Sc).call(this,e);await S(this,N,Ur).call(this,n)},onConnect:()=>{g(a(this,yn),!0)},onDisconnect:()=>{g(a(this,yn),!1)},onError:e=>{console.error("[ProductsStore] Erreur realtime:",e)}}},Ac=function(e){const n=$t(),s=rn("products"),r=rn("purchases"),o=[`databases.${n}.collections.${s}.documents`,`databases.${n}.collections.${r}.documents`],i=c=>{const{events:l,payload:u}=c;if(!u)return;if(c.event==="client.connected"){e.onConnect();return}const d=l.some(I=>I.includes("products.")),p=l.some(I=>I.includes("purchases.")),h=l.some(I=>I.includes(".create")),m=l.some(I=>I.includes(".update")),y=l.some(I=>I.includes(".delete"));if(d){const I=u;I.updatedBy&&I.updatedBy!==V.userName&&(h||m?wt.info(`${I.updatedBy} a modifiÃ© le produit "${I.productName}"`,{source:"realtime-other"}):y&&wt.info(`${I.updatedBy} a supprimÃ© un produit`,{source:"realtime-other"})),h&&e.onProductCreate?e.onProductCreate(I):m&&e.onProductUpdate?e.onProductUpdate(I):y&&e.onProductDelete&&e.onProductDelete(I.$id)}else if(p){const I=u;if(I.createdBy&&I.createdBy!==V.userName){const E="un produit";h&&I.who!==V.userName?wt.info(`${I.who} a ajoutÃ© un achat pour ${E}`,{source:"realtime-other"}):m&&I.who!==V.userName?wt.info(`${I.who} a modifiÃ© un achat pour ${E}`,{source:"realtime-other"}):y&&wt.info(`${I.who} a supprimÃ© un achat pour ${E}`,{source:"realtime-other"})}h&&e.onPurchaseCreate?e.onPurchaseCreate(I):m&&e.onPurchaseUpdate?e.onPurchaseUpdate(I):y&&e.onPurchaseDelete&&e.onPurchaseDelete(I.$id)}};_(this,Ot,hr.registerDynamic(o,i)),console.log(`[ProductsStore] â Realtime configurÃ© via RealtimeManager (${o.length} channels)`)},Tc=async function(){if(f(a(this,fe)))try{const e=await Kd(f(a(this,fe)));e.forEach(n=>{a(this,De).set(n.$id,n)}),console.log(`[ProductsStore] ${e.length} dÃ©penses globales chargÃ©es`)}catch(e){console.error("[ProductsStore] Erreur chargement dÃ©penses globales:",e)}},ir=new WeakMap,ar=new WeakMap;const pf=new df,gr=ns(),yr="materiel";async function Bp(t){try{const{tables:e}=await P();return(await e.listRows({databaseId:gr.APPWRITE_CONFIG.databaseId,tableId:yr,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel] Error listing materiels:",e),e}}async function Hp(t,e){try{const{tables:n}=await P(),s=Ce.unique();let r;try{r=typeof t.owner=="string"?JSON.parse(t.owner):t.owner}catch(c){throw console.error("[appwrite-materiel] Error parsing owner:",t.owner,c),new Error("Invalid owner format")}const o=[Q.read(F.user(e)),Q.update(F.user(e))];r.teamId?o.push(Q.read(F.team(r.teamId)),Q.update(F.team(r.teamId))):r.userId&&o.push(Q.read(F.user(r.userId)),Q.update(F.user(r.userId)));const i=await n.createRow({databaseId:gr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:s,data:{name:t.name,description:t.description||null,type:t.type||null,quantity:t.quantity,status:t.status||"ok",location:t.location||null,shareableWith:t.shareableWith||null,owner:t.owner},permissions:o});return console.log(`[appwrite-materiel] Materiel created: ${s}`),i}catch(n){throw console.error("[appwrite-materiel] Error creating materiel:",n),n}}async function zp(t,e){try{const{tables:n}=await P(),s=await n.updateRow({databaseId:gr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:t,data:e});return console.log(`[appwrite-materiel] Materiel updated: ${t}`),s}catch(n){throw console.error(`[appwrite-materiel] Error updating materiel ${t}:`,n),n}}async function Op(t){try{const{tables:e}=await P();await e.deleteRow({databaseId:gr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:t}),console.log(`[appwrite-materiel] Materiel deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel] Error deleting materiel ${t}:`,e),e}}function Wp(){return[`databases.${gr.APPWRITE_CONFIG.databaseId}.collections.${yr}.documents`]}const wr=ns(),vr="materiel_loan";async function Gp(t){try{const{tables:e}=await P();return(await e.listRows({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:vr,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel-loan] Error listing loans:",e),e}}async function Vp(t,e){try{const{tables:n}=await P(),s=Ce.unique(),r=[Q.read(F.user(e)),Q.update(F.user(e)),Q.read(F.team(t.ownerId)),Q.update(F.team(t.ownerId))],o=await n.createRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:vr,rowId:s,data:{startDate:t.startDate,endDate:t.endDate,responsibleId:t.responsibleId,responsibleName:t.responsibleName,ownerId:t.ownerId,ownerName:t.ownerName,materiels:t.materiels.map(i=>JSON.stringify(i)),notes:t.notes||null,status:t.status||"asked",completedAt:null,returnedAt:null,returnNotes:null},permissions:r});return console.log(`[appwrite-materiel-loan] Loan created: ${s}`),o}catch(n){throw console.error("[appwrite-materiel-loan] Error creating loan:",n),n}}async function Qp(t,e){try{const{tables:n}=await P(),s={};e.startDate!==void 0&&(s.startDate=e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate),e.materiels!==void 0&&(s.materiels=e.materiels.map(o=>JSON.stringify(o))),e.status!==void 0&&(s.status=e.status),e.notes!==void 0&&(s.notes=e.notes),e.returnedAt!==void 0&&(s.returnedAt=e.returnedAt),e.returnNotes!==void 0&&(s.returnNotes=e.returnNotes);const r=await n.updateRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:vr,rowId:t,data:s});return console.log(`[appwrite-materiel-loan] Loan updated: ${t}`),r}catch(n){throw console.error(`[appwrite-materiel-loan] Error updating loan ${t}:`,n),n}}async function Jp(t){try{const{tables:e}=await P();await e.deleteRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:vr,rowId:t}),console.log(`[appwrite-materiel-loan] Loan deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel-loan] Error deleting loan ${t}:`,e),e}}function Kp(){return[`databases.${wr.APPWRITE_CONFIG.databaseId}.collections.${vr}.documents`]}const go="teamdocs";async function Yp(){try{const{tables:t,config:e}=await P();return(await t.listRows({databaseId:e.databaseId,tableId:go})).rows}catch(t){throw console.error("[appwrite-teamdocs] Error listing documents:",t),t}}async function Xp(t,e,n,s){try{const{tables:r,config:o}=await P(),i=[Q.read(F.team(e)),Q.update(F.team(e)),Q.delete(F.team(e))],c=await r.createRow({databaseId:o.databaseId,tableId:go,rowId:Ce.unique(),data:{...t,teamId:e,createdBy:n},permissions:i});return console.log(`[appwrite-teamdocs] Document created: ${c.$id}`),c}catch(r){throw console.error("[appwrite-teamdocs] Error creating document:",r),r}}async function hf(t,e){try{const{tables:n,config:s}=await P(),r=await n.updateRow({databaseId:s.databaseId,tableId:go,rowId:t,data:e});return console.log(`[appwrite-teamdocs] Document updated: ${t}`),r}catch(n){throw console.error(`[appwrite-teamdocs] Error updating document ${t}:`,n),n}}async function Zp(t){try{const{tables:e,config:n}=await P();await e.deleteRow({databaseId:n.databaseId,tableId:go,rowId:t}),console.log(`[appwrite-teamdocs] Document deleted: ${t}`)}catch(e){throw console.error(`[appwrite-teamdocs] Error deleting document ${t}:`,e),e}}async function Fp(t,e){try{await hf(t,{lockedBy:e}),console.log(`[appwrite-teamdocs] Lock ${t} mis Ã  jour: ${e||"libÃ©rÃ©"}`)}catch(n){throw console.error(`[appwrite-teamdocs] Erreur verrouillage ${t}:`,n),n}}const{APPWRITE_CONFIG:yo}=ns();async function mf(t,e){return ut(async()=>{const{functions:n}=await P(),s=await n.createExecution({functionId:yo.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,teamId:e}),async:!1}),r=pr(s.responseBody,{context:"removeTeamFromEvent",fallback:null});if(!r||!r.success)throw new Error(r?.error||"Erreur lors du retrait de la team");console.log(`[appwrite-functions] Team ${e} retirÃ©e de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeTeamFromEvent",timeout:6e4,errorMessage:"Erreur lors du retrait de la team"})}async function gf(t){return ut(async()=>{const{functions:e}=await P(),n=await e.createExecution({functionId:yo.functions.usersTeamsManager,body:JSON.stringify({action:"checkEmails",emails:t}),async:!1}),s=pr(n.responseBody,{context:"checkUserEmails",fallback:null});if(!s||!s.success)throw new Error(s?.error||"Erreur lors de la vÃ©rification des emails");return s.data},{context:"AppwriteFunctions.checkUserEmails",timeout:15e3,errorMessage:"Erreur lors de la vÃ©rification des emails"})}async function yf(t,e,n){const{teamIds:s=[],emails:r=[],userIds:o=[],message:i,sendEmailToExistingMembers:c=!0}=n;return ut(async()=>{const{functions:l}=await P(),u=await l.createExecution({functionId:yo.functions.usersTeamsManager,body:JSON.stringify({action:"invite",context:{type:"event",id:t,name:e},teamIds:s,emails:r,userIds:o,message:i,sendEmailToExistingMembers:c}),async:!1}),d=pr(u.responseBody,{context:"inviteParticipantsToEvent",fallback:null});if(!d||!d.success)throw new Error(d?.error||"Erreur lors de l'invitation");return console.log(`[appwrite-functions] ${d.processed} invitations traitÃ©es pour ${e}`),d},{context:"AppwriteFunctions.inviteParticipantsToEvent",timeout:6e4,errorMessage:"Erreur lors de l'invitation"})}async function wf(t,e){return ut(async()=>{const{functions:n}=await P(),s=await n.createExecution({functionId:yo.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,userId:e}),async:!1}),r=pr(s.responseBody,{context:"removeUserFromEvent",fallback:null});if(!r||!r.success)throw new Error(r?.error||"Erreur lors du retrait de l'utilisateur");console.log(`[appwrite-functions] Utilisateur ${e} retirÃ© de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeUserFromEvent",timeout:1e4,errorMessage:"Erreur lors du retrait de l'utilisateur"})}const Do=Object.freeze(Object.defineProperty({__proto__:null,checkUserEmails:gf,inviteParticipantsToEvent:yf,removeTeamFromEvent:mf,removeUserFromEvent:wf},Symbol.toStringTag,{value:"Module"}));var vf=(t=>(t.ENTREE="entree",t.PLAT="plat",t.DESSERT="dessert",t.AUTRE="autre",t))(vf||{}),bf=(t=>(t.PUBLIC="public",t.PRIVATE="private",t.DELETED="deleted",t))(bf||{});const If=600*1e3,Pc={usersTeamsManager:"appwrite_warmup_usersTeamsManager",enkaData:"appwrite_warmup_enkaData"};function Dc(t){const e=localStorage.getItem(Pc[t]);return e?Date.now()-parseInt(e,10)>If:!0}function $c(t){localStorage.setItem(Pc[t],Date.now().toString())}async function Mc(t,e){try{const{functions:n}=await P(),s=await n.createExecution({functionId:t,body:JSON.stringify(e)});return s.responseStatusCode===200?(console.log(`[warmup] â Ping rÃ©ussi pour ${t}`),!0):(console.warn(`[warmup] â ï¸ Ping Ã©chouÃ© pour ${t}: ${s.responseStatusCode}`),!1)}catch(n){return console.error(`[warmup] â Erreur ping ${t}:`,n),!1}}async function eh(){if(!Dc("usersTeamsManager")){console.log("[warmup] â­ï¸ usersTeamsManager encore chaud (< 10 min)");return}console.log("[warmup] ð¥ RÃ©veil de usersTeamsManager..."),await Mc(ii("usersTeamsManager"),{action:"ping"}),$c("usersTeamsManager")}async function th(){if(!Dc("enkaData")){console.log("[warmup] â­ï¸ enkaData encore chaud (< 10 min)");return}console.log("[warmup] ð¥ RÃ©veil d'enkaData..."),await Mc(ii("enkaData"),{operation:"ping"}),$c("enkaData")}const Ef=ns().APPWRITE_CONFIG;async function nh(t,e,n){try{const{functions:s}=await P(),r=await s.createExecution({functionId:Ef.functions.usersTeamsManager,body:JSON.stringify({action:"exchange-invite",userId:t,eventId:e,teamId:n})}),o=JSON.parse(r.responseBody);if(!o.success)throw new Error(o.error||"L'invitation est invalide.");return{token:o.token,userId:o.userId}}catch(s){throw console.error("[invitations] Error validating invitation:",s),s}}const Sf=7,sh={async getLock(t){const{tables:e}=await P();try{const n=await e.getRow({databaseId:$t(),tableId:rn("locks"),rowId:t});return!n.userId||new Date(n.expiresAt)<new Date?null:n}catch(n){if(n.code===404)return null;throw n}},async acquireLock(t,e,n){const{tables:s}=await P(),r=new Date(Date.now()+Sf*60*1e3).toISOString(),o={userId:e,userName:n,expiresAt:r},i=[Q.read(F.any()),Q.update(F.user(e))];try{return await s.updateRow({databaseId:$t(),tableId:rn("locks"),rowId:t,data:o,permissions:i}),!0}catch(c){if(c.code===404)try{return await s.createRow({databaseId:$t(),tableId:rn("locks"),rowId:t,data:o,permissions:i}),!0}catch(l){return console.error("[locksService] Erreur crÃ©ation verrou:",l),!1}return console.warn("[locksService] Acquisition refusÃ©e (peut-Ãªtre dÃ©jÃ  verrouillÃ©):",c.message),!1}},async releaseLock(t,e){const{tables:n}=await P();try{await n.updateRow({databaseId:$t(),tableId:rn("locks"),rowId:t,data:{userId:"",userName:"",expiresAt:new Date(0).toISOString()},permissions:[Q.read(F.any()),Q.update(F.any())]}),console.log(`[locksService] Verrou libÃ©rÃ© (rÃ©initialisÃ©) pour ${t}`)}catch(s){if(s.code===404){console.log(`[locksService] Verrou dÃ©jÃ  libÃ©rÃ© pour ${t}`);return}console.warn("[locksService] Impossible de libÃ©rer le verrou sur le serveur:",s.message)}},subscribeToLock(t,e){const n=$t(),s=rn("locks"),r=`databases.${n}.collections.${s}.documents.${t}`;return console.log("[locksService] Enregistrement du channel de lock:",r),hr.registerDynamic([r],o=>{if(o.events?.some(c=>c.endsWith(".delete"))){e(null);return}if(!o.payload)return;const i=o.payload;!i.userId||new Date(i.expiresAt)<new Date?e(null):e(i)})}};function _f(t,e){const n=t.reduce((r,o)=>r+o.missingQuantities.length,0),s=e.invoiceTotal?1:0;return n+s}async function Rf(t,e,n){let s=null;try{const{account:c}=await P();s=(await c.get()).$id}catch(c){console.warn("[Appwrite Transaction] Impossible de rÃ©cupÃ©rer l'utilisateur connectÃ©:",c)}const r=e.purchaseStatus||"delivered";let o=e.purchaseDeliveryDate||null;r==="delivered"&&!o&&(o=new Date().toISOString());const i=t.flatMap(c=>c.missingQuantities.map(l=>({productId:c.productId,quantity:l.q,unit:l.u,status:r,notes:e.notes||"",store:e.store||"",who:e.who||void 0,price:void 0,orderDate:null,deliveryDate:o,createdBy:s})));return{mainId:n,purchasesData:i,invoiceData:e,fromUserId:s||""}}function Af(t,e,n=98){const s=[];let r=[],o=0;const i=!!e.invoiceTotal;let c=!1;for(const l of t){const u=l.missingQuantities.length;let d=o+u>n;i&&!c&&r.length>0&&(d=o+u+1>n),d&&r.length>0?(s.push(r),r=[l],o=u,c=!1):(r.push(l),o+=u)}return r.length>0&&s.push(r),s}async function Tf(t){try{const e=ns(),{functions:n}=await P(),s={operation:"createGroupPurchaseWithSync",data:t};console.log(`[Appwrite Interactions] ExÃ©cution du lot: ${t.purchasesData.length} achats Ã  crÃ©er`);const r=await n.createExecution(e.APPWRITE_CONFIG.functions.batchUpdate,JSON.stringify(s),!1,"/","POST");if(r.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${r.status}.`);const o=JSON.parse(r.responseBody);return o.success?console.log(`[Appwrite Interactions] Lot exÃ©cutÃ© avec succÃ¨s: ${o.purchasesCreated} achats crÃ©Ã©s`):console.error("[Appwrite Interactions] Lot Ã©chouÃ©:",o.error),o}catch(e){console.error("[Appwrite Interactions] Erreur exÃ©cution lot:",e);const n=e instanceof Error?e.message:"Erreur inconnue";return{success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:t.invoiceData.invoiceId,error:n,timestamp:new Date().toISOString()}}}async function rh(t,e,n){if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};const s=_f(e,n);console.log(`[Appwrite Interactions] Achat groupÃ©: ${e.length} produits, ${s} achats Ã  crÃ©er`);const r=Af(e,n,98);console.log(`[Appwrite Interactions] DÃ©coupage en ${r.length} lot(s) pour respecter la limite de 100 achats par lot`);const o=[];let i=0,c=0,l=0;for(let p=0;p<r.length;p++){const h=r[p];console.log(`[Appwrite Interactions] ExÃ©cution du lot ${p+1}/${r.length} (${h.length} produits)`);try{const m=await Rf(h,n,t),y=await uc(()=>Tf(m),{operationName:`Lot ${p+1}/${r.length}`,maxAutoRetries:1,autoRetryDelay:2e3});if(!y)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives");if(o.push(y),y.success)i+=y.productsCreated,c+=y.purchasesCreated,l+=y.expenseCreated?1:0;else{console.error(`[Appwrite Interactions] Erreur sur le lot ${p+1}: ${y.error}`);break}}catch(m){const y=m instanceof Error?m.message:"Erreur inconnue";console.error(`[Appwrite Interactions] Erreur lors de l'exÃ©cution du lot ${p+1}:`,m),o.push({success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:n.invoiceId,error:y,timestamp:new Date().toISOString()});break}}const u=o.every(p=>p.success),d=o.some(p=>!p.success);return{success:u,results:o,totalProductsCreated:i,totalPurchasesCreated:c,totalExpensesCreated:l,error:d?"Un ou plusieurs lots ont Ã©chouÃ©":void 0}}export{jn as $,Pt as A,pf as B,wt as C,P as D,Bp as E,Gp as F,Wp as G,Kp as H,Hp as I,zp as J,Op as K,Vp as L,Qp as M,Jp as N,Yp as O,Xp as P,b as Q,hf as R,Yt as S,Zp as T,Fp as U,Uf as V,Ol as W,Of as X,oe as Y,su as Z,hu as _,np as a,Ep as a$,yp as a0,Hr as a1,Gf as a2,Lf as a3,op as a4,Bf as a5,aa as a6,Ci as a7,Cu as a8,Bo as a9,ap as aA,ep as aB,kd as aC,oi as aD,bf as aE,xi as aF,xp as aG,eh as aH,wp as aI,nh as aJ,Vf as aK,sp as aL,Er as aM,At as aN,sh as aO,lu as aP,hp as aQ,rh as aR,Ip as aS,mp as aT,Hu as aU,Qd as aV,Pp as aW,Dp as aX,$p as aY,_p as aZ,Sp as a_,rp as aa,Cf as ab,Kf as ac,lp as ad,Ro as ae,Au as af,pp as ag,Ql as ah,vp as ai,Xf as aj,Wf as ak,qp as al,du as am,Nf as an,cp as ao,th as ap,of as aq,jp as ar,kp as as,Up as at,Lp as au,cf as av,ip as aw,vf as ax,tp as ay,Ff as az,zf as b,Rp as b0,Ap as b1,Tp as b2,an as b3,zu as b4,rc as b5,gp as b6,ct as b7,Ju as b8,ic as b9,bp as ba,Ku as bb,Mp as bc,Np as bd,Cp as be,mu as bf,Zo as bg,Df as bh,Do as bi,wl as c,yl as d,Jf as e,xf as f,kf as g,jf as h,Qf as i,Hf as j,qf as k,Zf as l,f as m,nn as n,dp as o,fp as p,D as q,up as r,Yf as s,$f as t,Y as u,g as v,$t as w,hr as x,V as y,Jt as z};
