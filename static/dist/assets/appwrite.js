var Qc=Object.defineProperty;var Jc=Object.getPrototypeOf;var Kc=Reflect.get;var vi=n=>{throw TypeError(n)};var Yc=(n,e,t)=>e in n?Qc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>Yc(n,typeof e!="symbol"?e+"":e,t),Eo=(n,e,t)=>e.has(n)||vi("Cannot "+t);var a=(n,e,t)=>(Eo(n,e,"read from private field"),t?t.call(n):e.get(n)),v=(n,e,t)=>e.has(n)?vi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),_=(n,e,t,s)=>(Eo(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),I=(n,e,t)=>(Eo(n,e,"access private method"),t);var bi=(n,e,t)=>Kc(Jc(n),t,e);var lr=Array.isArray,Xc=Array.prototype.indexOf,Xo=Array.from,ko=Object.defineProperty,Jt=Object.getOwnPropertyDescriptor,fa=Object.getOwnPropertyDescriptors,pa=Object.prototype,Zc=Array.prototype,oo=Object.getPrototypeOf,Ii=Object.isExtensible;function kn(n){return typeof n=="function"}const sn=()=>{};function Fc(n){return n()}function qo(n){for(var e=0;e<n.length;e++)n[e]()}function ha(){var n,e,t=new Promise((s,r)=>{n=s,e=r});return{promise:t,resolve:n,reject:e}}function Wf(n,e,t=!1){return n===void 0?t?e():e:n}function Gf(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const s of n)if(t.push(s),t.length===e)break;return t}const _e=2,Zo=4,io=8,Zt=16,Rt=32,Ft=64,Fo=128,Ue=256,zr=512,pe=1024,Be=2048,en=4096,Ge=8192,_n=16384,ao=32768,tn=65536,Ei=1<<17,el=1<<18,Rn=1<<19,ma=1<<20,jo=1<<21,co=1<<22,vn=1<<23,ct=Symbol("$state"),ga=Symbol("legacy props"),tl=Symbol(""),hs=new class extends Error{constructor(){super(...arguments);j(this,"name","StaleReactionError");j(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function wa(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function nl(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function sl(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function rl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ol(n){throw new Error("https://svelte.dev/e/effect_orphan")}function il(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function al(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function cl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ll(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ul(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function dl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const lo=1,uo=2,ya=4,fl=8,pl=16,hl=1,ml=2,gl=4,wl=8,yl=16,vl=1,bl=2,Il=4,El=1,Sl=2,oe=Symbol(),_l="http://www.w3.org/1999/xhtml",Rl="http://www.w3.org/2000/svg",Al="@attach";function Tl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Pl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Dl=!1;function va(n){return n===this.v}function ba(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function $l(n,e){return n!==e}function Ia(n){return!ba(n,this.v)}let es=!1;function Qf(){es=!0}const Ml=[];function Sr(n,e=!1,t=!1){return Dr(n,new Map,"",Ml,null,t)}function Dr(n,e,t,s,r=null,o=!1){if(typeof n=="object"&&n!==null){var i=e.get(n);if(i!==void 0)return i;if(n instanceof Map)return new Map(n);if(n instanceof Set)return new Set(n);if(lr(n)){var c=Array(n.length);e.set(n,c),r!==null&&e.set(r,c);for(var l=0;l<n.length;l+=1){var u=n[l];l in n&&(c[l]=Dr(u,e,t,s,null,o))}return c}if(oo(n)===pa){c={},e.set(n,c),r!==null&&e.set(r,c);for(var d in n)c[d]=Dr(n[d],e,t,s,null,o);return c}if(n instanceof Date)return structuredClone(n);if(typeof n.toJSON=="function"&&!o)return Dr(n.toJSON(),e,t,s,n)}if(n instanceof EventTarget)return n;try{return structuredClone(n)}catch{return n}}let ne=null;function Yn(n){ne=n}function Cl(n,e=!1,t){ne={p:ne,c:null,e:null,s:n,x:null,l:es&&!e?{s:null,u:null,$:[]}:null}}function Nl(n){var e=ne,t=e.e;if(t!==null){e.e=null;for(var s of t)La(s)}return ne=e.p,{}}function ts(){return!es||ne!==null&&ne.l===null}let an=[];function Ea(){var n=an;an=[],qo(n)}function Qe(n){if(an.length===0&&!ms){var e=an;queueMicrotask(()=>{e===an&&Ea()})}an.push(n)}function kl(){for(;an.length>0;)Ea()}const ql=new WeakMap;function Sa(n){var e=G;if(e===null)return V.f|=vn,n;if((e.f&ao)===0){if((e.f&Fo)===0)throw!e.parent&&n instanceof Error&&_a(n),n;e.b.error(n)}else Xn(n,e)}function Xn(n,e){for(;e!==null;){if((e.f&Fo)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&_a(n),n}function _a(n){const e=ql.get(n);e&&(ko(n,"message",{value:e.message}),ko(n,"stack",{value:e.stack}))}const _r=new Set;let K=null,$r=null,Lo=new Set,ot=[],fo=null,Uo=!1,ms=!1;var Un,xn,ln,Is,Bn,Hn,un,On,Es,Ss,xe,xo,Mr,Bo;const qn=class qn{constructor(){v(this,xe);j(this,"current",new Map);v(this,Un,new Map);v(this,xn,new Set);v(this,ln,0);v(this,Is,null);v(this,Bn,[]);v(this,Hn,[]);v(this,un,[]);v(this,On,[]);v(this,Es,[]);v(this,Ss,[]);j(this,"skipped_effects",new Set)}process(e){ot=[],$r=null;var t=qn.apply(this);for(const o of e)I(this,xe,xo).call(this,o);if(a(this,ln)===0){I(this,xe,Bo).call(this);var s=a(this,Hn),r=a(this,un);_(this,Hn,[]),_(this,un,[]),_(this,On,[]),$r=this,K=null,Si(s),Si(r),$r=null,a(this,Is)?.resolve()}else I(this,xe,Mr).call(this,a(this,Hn)),I(this,xe,Mr).call(this,a(this,un)),I(this,xe,Mr).call(this,a(this,On));t();for(const o of a(this,Bn))ys(o);_(this,Bn,[])}capture(e,t){a(this,Un).has(e)||a(this,Un).set(e,t),this.current.set(e,e.v)}activate(){K=this}deactivate(){K=null}flush(){if(ot.length>0){if(this.activate(),Ra(),K!==null&&K!==this)return}else a(this,ln)===0&&I(this,xe,Bo).call(this);this.deactivate();for(const e of Lo)if(Lo.delete(e),e(),K!==null)break}increment(){_(this,ln,a(this,ln)+1)}decrement(){_(this,ln,a(this,ln)-1);for(const e of a(this,Es))ye(e,Be),In(e);for(const e of a(this,Ss))ye(e,en),In(e);this.flush()}add_callback(e){a(this,xn).add(e)}settled(){return(a(this,Is)??_(this,Is,ha())).promise}static ensure(){if(K===null){const e=K=new qn;_r.add(K),ms||qn.enqueue(()=>{K===e&&e.flush()})}return K}static enqueue(e){Qe(e)}static apply(e){return sn}};Un=new WeakMap,xn=new WeakMap,ln=new WeakMap,Is=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,un=new WeakMap,On=new WeakMap,Es=new WeakMap,Ss=new WeakMap,xe=new WeakSet,xo=function(e){e.f^=pe;for(var t=e.first;t!==null;){var s=t.f,r=(s&(Rt|Ft))!==0,o=r&&(s&pe)!==0,i=o||(s&Ge)!==0||this.skipped_effects.has(t);if(!i&&t.fn!==null){r?t.f^=pe:(s&Zo)!==0?a(this,un).push(t):(s&pe)===0&&((s&co)!==0&&t.b?.is_pending()?a(this,Bn).push(t):wo(t)&&((t.f&Zt)!==0&&a(this,On).push(t),ys(t)));var c=t.first;if(c!==null){t=c;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}},Mr=function(e){for(const t of e)((t.f&Be)!==0?a(this,Es):a(this,Ss)).push(t),ye(t,pe);e.length=0},Bo=function(){var e;for(const t of a(this,xn))t();if(a(this,xn).clear(),_r.size>1){a(this,Un).clear();let t=!0;for(const s of _r){if(s===this){t=!1;continue}for(const[r,o]of this.current){if(s.current.has(r))if(t)s.current.set(r,o);else continue;Aa(r)}if(ot.length>0){K=s;const r=qn.apply(s);for(const o of ot)I(e=s,xe,xo).call(e,o);ot=[],r()}}K=null}_r.delete(this)};let it=qn;function jl(n){var e=ms;ms=!0;try{for(var t;;){if(kl(),ot.length===0&&(K?.flush(),ot.length===0))return fo=null,t;Ra()}}finally{ms=e}}function Ra(){var n=jn;Uo=!0;try{var e=0;for(Ti(!0);ot.length>0;){var t=it.ensure();if(e++>1e3){var s,r;Ll()}t.process(ot),Kt.clear()}}finally{Uo=!1,Ti(n),fo=null}}function Ll(){try{il()}catch(n){Xn(n,fo)}}let rn=null;function Si(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if((s.f&(_n|Ge))===0&&wo(s)&&(rn=[],ys(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null&&s.ac===null?Ha(s):s.fn=null),rn?.length>0)){Kt.clear();for(const r of rn)ys(r);rn=[]}}rn=null}}function Aa(n){if(n.reactions!==null)for(const e of n.reactions){const t=e.f;(t&_e)!==0?Aa(e):(t&(co|Zt))!==0&&(ye(e,Be),In(e))}}function In(n){for(var e=fo=n;e.parent!==null;){e=e.parent;var t=e.f;if(Uo&&e===G&&(t&Zt)!==0)return;if((t&(Ft|Rt))!==0){if((t&pe)===0)return;e.f^=pe}}ot.push(e)}function ei(n){let e=0,t=ut(0),s;return()=>{Fl()&&(f(t),pr(()=>(e===0&&(s=Pt(()=>n(()=>Ne(t)))),e+=1,()=>{Qe(()=>{e-=1,e===0&&(s?.(),s=void 0,Ne(t))})})))}}var Ul=tn|Rn|Fo;function xl(n,e,t){new Bl(n,e,t)}var He,je,Yo,Ze,dn,Fe,Le,be,et,Nt,fn,kt,pn,qt,Kr,Yr,ve,Hl,Ol,Cr,Nr,Ho;class Bl{constructor(e,t,s){v(this,ve);j(this,"parent");v(this,He,!1);v(this,je);v(this,Yo,null);v(this,Ze);v(this,dn);v(this,Fe);v(this,Le,null);v(this,be,null);v(this,et,null);v(this,Nt,null);v(this,fn,0);v(this,kt,0);v(this,pn,!1);v(this,qt,null);v(this,Kr,()=>{a(this,qt)&&Zn(a(this,qt),a(this,fn))});v(this,Yr,ei(()=>(_(this,qt,ut(a(this,fn))),()=>{_(this,qt,null)})));_(this,je,e),_(this,Ze,t),_(this,dn,s),this.parent=G.b,_(this,He,!!a(this,Ze).pending),_(this,Fe,Tt(()=>{G.b=this;{try{_(this,Le,ce(()=>s(a(this,je))))}catch(r){this.error(r)}a(this,kt)>0?I(this,ve,Nr).call(this):_(this,He,!1)}},Ul))}is_pending(){return a(this,He)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!a(this,Ze).pending}update_pending_count(e){I(this,ve,Ho).call(this,e),_(this,fn,a(this,fn)+e),Lo.add(a(this,Kr))}get_effect_pending(){return a(this,Yr).call(this),f(a(this,qt))}error(e){var t=a(this,Ze).onerror;let s=a(this,Ze).failed;if(a(this,pn)||!t&&!s)throw e;a(this,Le)&&(ae(a(this,Le)),_(this,Le,null)),a(this,be)&&(ae(a(this,be)),_(this,be,null)),a(this,et)&&(ae(a(this,et)),_(this,et,null));var r=!1,o=!1;const i=()=>{if(r){Pl();return}r=!0,o&&dl(),it.ensure(),_(this,fn,0),a(this,et)!==null&&Et(a(this,et),()=>{_(this,et,null)}),_(this,He,this.has_pending_snippet()),_(this,Le,I(this,ve,Cr).call(this,()=>(_(this,pn,!1),ce(()=>a(this,dn).call(this,a(this,je)))))),a(this,kt)>0?I(this,ve,Nr).call(this):_(this,He,!1)};var c=V;try{Se(null),o=!0,t?.(e,i),o=!1}catch(l){Xn(l,a(this,Fe)&&a(this,Fe).parent)}finally{Se(c)}s&&Qe(()=>{_(this,et,I(this,ve,Cr).call(this,()=>{_(this,pn,!0);try{return ce(()=>{s(a(this,je),()=>e,()=>i)})}catch(l){return Xn(l,a(this,Fe).parent),null}finally{_(this,pn,!1)}}))})}}He=new WeakMap,je=new WeakMap,Yo=new WeakMap,Ze=new WeakMap,dn=new WeakMap,Fe=new WeakMap,Le=new WeakMap,be=new WeakMap,et=new WeakMap,Nt=new WeakMap,fn=new WeakMap,kt=new WeakMap,pn=new WeakMap,qt=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,ve=new WeakSet,Hl=function(){try{_(this,Le,ce(()=>a(this,dn).call(this,a(this,je))))}catch(e){this.error(e)}_(this,He,!1)},Ol=function(){const e=a(this,Ze).pending;e&&(_(this,be,ce(()=>e(a(this,je)))),it.enqueue(()=>{_(this,Le,I(this,ve,Cr).call(this,()=>(it.ensure(),ce(()=>a(this,dn).call(this,a(this,je)))))),a(this,kt)>0?I(this,ve,Nr).call(this):(Et(a(this,be),()=>{_(this,be,null)}),_(this,He,!1))}))},Cr=function(e){var t=G,s=V,r=ne;dt(a(this,Fe)),Se(a(this,Fe)),Yn(a(this,Fe).ctx);try{return e()}catch(o){return Sa(o),null}finally{dt(t),Se(s),Yn(r)}},Nr=function(){const e=a(this,Ze).pending;a(this,Le)!==null&&(_(this,Nt,document.createDocumentFragment()),zl(a(this,Le),a(this,Nt))),a(this,be)===null&&_(this,be,ce(()=>e(a(this,je))))},Ho=function(e){var t;if(!this.has_pending_snippet()){this.parent&&I(t=this.parent,ve,Ho).call(t,e);return}_(this,kt,a(this,kt)+e),a(this,kt)===0&&(_(this,He,!1),a(this,be)&&Et(a(this,be),()=>{_(this,be,null)}),a(this,Nt)&&(a(this,je).before(a(this,Nt)),_(this,Nt,null)),Qe(()=>{it.ensure().flush()}))};function zl(n,e){for(var t=n.nodes_start,s=n.nodes_end;t!==null;){var r=t===s?null:dr(t);e.append(t),t=r}}function Ta(n,e,t){const s=ts()?ur:ti;if(e.length===0){t(n.map(s));return}var r=K,o=G,i=Wl();Promise.all(e.map(c=>Gl(c))).then(c=>{i();try{t([...n.map(s),...c])}catch(l){(o.f&_n)===0&&Xn(l,o)}r?.deactivate(),Pa()}).catch(c=>{Xn(c,o)})}function Wl(){var n=G,e=V,t=ne,s=K;return function(){dt(n),Se(e),Yn(t),s?.activate()}}function Pa(){dt(null),Se(null),Yn(null)}function ur(n){var e=_e|Be,t=V!==null&&(V.f&_e)!==0?V:null;return G===null||t!==null&&(t.f&Ue)!==0?e|=Ue:G.f|=Rn,{ctx:ne,deps:null,effects:null,equals:va,f:e,fn:n,reactions:null,rv:0,v:oe,wv:0,parent:t??G,ac:null}}function Gl(n,e){let t=G;t===null&&nl();var s=t.b,r=void 0,o=ut(oe),i=!V,c=new Map;return su(()=>{var l=ha();r=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject)}catch(h){l.reject(h)}var u=K,d=s.is_pending();i&&(s.update_pending_count(1),d||(u.increment(),c.get(u)?.reject(hs),c.set(u,l)));const p=(h,m=void 0)=>{d||u.activate(),m?m!==hs&&(o.f|=vn,Zn(o,m)):((o.f&vn)!==0&&(o.f^=vn),Zn(o,h)),i&&(s.update_pending_count(-1),d||u.decrement()),Pa()};l.promise.then(p,h=>p(null,h||"unknown"))}),mo(()=>{for(const l of c.values())l.reject(hs)}),new Promise(l=>{function u(d){function p(){d===r?l(o):u(r)}d.then(p,p)}u(r)})}function X(n){const e=ur(n);return Wa(e),e}function ti(n){const e=ur(n);return e.equals=Ia,e}function Da(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)ae(e[t])}}function Vl(n){for(var e=n.parent;e!==null;){if((e.f&_e)===0)return e;e=e.parent}return null}function ni(n){var e,t=G;dt(Vl(n));try{Da(n),e=Ja(n)}finally{dt(t)}return e}function $a(n){var e=ni(n);if(n.equals(e)||(n.v=e,n.wv=Va()),!An){var t=(Vt||(n.f&Ue)!==0)&&n.deps!==null?en:pe;ye(n,t)}}const Kt=new Map;function ut(n,e){var t={f:0,v:n,reactions:null,equals:va,rv:0,wv:0};return t}function C(n,e){const t=ut(n);return Wa(t),t}function Ql(n,e=!1,t=!0){var r;const s=ut(n);return e||(s.equals=Ia),es&&t&&ne!==null&&ne.l!==null&&((r=ne.l).s??(r.s=[])).push(s),s}function g(n,e,t=!1){V!==null&&(!ze||(V.f&Ei)!==0)&&ts()&&(V.f&(_e|Zt|co|Ei))!==0&&!St?.includes(n)&&ul();let s=t?ie(e):e;return Zn(n,s)}function Zn(n,e){if(!n.equals(e)){var t=n.v;An?Kt.set(n,e):Kt.set(n,t),n.v=e;var s=it.ensure();s.capture(n,t),(n.f&_e)!==0&&((n.f&Be)!==0&&ni(n),ye(n,(n.f&Ue)===0?pe:en)),n.wv=Va(),Ma(n,Be),ts()&&G!==null&&(G.f&pe)!==0&&(G.f&(Rt|Ft))===0&&(qe===null?iu([n]):qe.push(n))}return e}function Jf(n,e=1){var t=f(n),s=e===1?t++:t--;return g(n,t),s}function Ne(n){g(n,n.v+1)}function Ma(n,e){var t=n.reactions;if(t!==null)for(var s=ts(),r=t.length,o=0;o<r;o++){var i=t[o],c=i.f;if(!(!s&&i===G)){var l=(c&Be)===0;l&&ye(i,e),(c&_e)!==0?Ma(i,en):l&&((c&Zt)!==0&&rn!==null&&rn.push(i),In(i))}}}function ie(n){if(typeof n!="object"||n===null||ct in n)return n;const e=oo(n);if(e!==pa&&e!==Zc)return n;var t=new Map,s=lr(n),r=C(0),o=Ve,i=c=>{if(Ve===o)return c();var l=V,u=Ve;Se(null),Di(o);var d=c();return Se(l),Di(u),d};return s&&t.set("length",C(n.length)),new Proxy(n,{defineProperty(c,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&cl();var d=t.get(l);return d===void 0?d=i(()=>{var p=C(u.value);return t.set(l,p),p}):g(d,u.value,!0),!0},deleteProperty(c,l){var u=t.get(l);if(u===void 0){if(l in c){const d=i(()=>C(oe));t.set(l,d),Ne(r)}}else g(u,oe),Ne(r);return!0},get(c,l,u){if(l===ct)return n;var d=t.get(l),p=l in c;if(d===void 0&&(!p||Jt(c,l)?.writable)&&(d=i(()=>{var m=ie(p?c[l]:oe),w=C(m);return w}),t.set(l,d)),d!==void 0){var h=f(d);return h===oe?void 0:h}return Reflect.get(c,l,u)},getOwnPropertyDescriptor(c,l){var u=Reflect.getOwnPropertyDescriptor(c,l);if(u&&"value"in u){var d=t.get(l);d&&(u.value=f(d))}else if(u===void 0){var p=t.get(l),h=p?.v;if(p!==void 0&&h!==oe)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return u},has(c,l){if(l===ct)return!0;var u=t.get(l),d=u!==void 0&&u.v!==oe||Reflect.has(c,l);if(u!==void 0||G!==null&&(!d||Jt(c,l)?.writable)){u===void 0&&(u=i(()=>{var h=d?ie(c[l]):oe,m=C(h);return m}),t.set(l,u));var p=f(u);if(p===oe)return!1}return d},set(c,l,u,d){var p=t.get(l),h=l in c;if(s&&l==="length")for(var m=u;m<p.v;m+=1){var w=t.get(m+"");w!==void 0?g(w,oe):m in c&&(w=i(()=>C(oe)),t.set(m+"",w))}if(p===void 0)(!h||Jt(c,l)?.writable)&&(p=i(()=>C(void 0)),g(p,ie(u)),t.set(l,p));else{h=p.v!==oe;var E=i(()=>ie(u));g(p,E)}var S=Reflect.getOwnPropertyDescriptor(c,l);if(S?.set&&S.set.call(d,u),!h){if(s&&typeof l=="string"){var A=t.get("length"),T=Number(l);Number.isInteger(T)&&T>=A.v&&g(A,T+1)}Ne(r)}return!0},ownKeys(c){f(r);var l=Reflect.ownKeys(c).filter(p=>{var h=t.get(p);return h===void 0||h.v!==oe});for(var[u,d]of t)d.v!==oe&&!(u in c)&&l.push(u);return l},setPrototypeOf(){ll()}})}function _i(n){try{if(n!==null&&typeof n=="object"&&ct in n)return n[ct]}catch{}return n}function Ca(n,e){return Object.is(_i(n),_i(e))}var Ri,Na,ka,qa;function Jl(){if(Ri===void 0){Ri=window,Na=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;ka=Jt(e,"firstChild").get,qa=Jt(e,"nextSibling").get,Ii(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),Ii(t)&&(t.__t=void 0)}}function At(n=""){return document.createTextNode(n)}function at(n){return ka.call(n)}function dr(n){return qa.call(n)}function Kf(n,e){return at(n)}function Yf(n,e=!1){{var t=at(n);return t instanceof Comment&&t.data===""?dr(t):t}}function Xf(n,e=1,t=!1){let s=n;for(;e--;)s=dr(s);return s}function Kl(n){n.textContent=""}function po(){return!1}function Yl(n,e){if(e){const t=document.body;n.autofocus=!0,Qe(()=>{document.activeElement===t&&n.focus()})}}let Ai=!1;function Xl(){Ai||(Ai=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function ns(n){var e=V,t=G;Se(null),dt(null);try{return n()}finally{Se(e),dt(t)}}function ho(n,e,t,s=t){n.addEventListener(e,()=>ns(t));const r=n.__on_r;r?n.__on_r=()=>{r(),s(!0)}:n.__on_r=()=>s(!0),Xl()}function ja(n){G===null&&V===null&&ol(),V!==null&&(V.f&Ue)!==0&&G===null&&rl(),An&&sl()}function Zl(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Je(n,e,t,s=!0){var r=G;r!==null&&(r.f&Ge)!==0&&(n|=Ge);var o={ctx:ne,deps:null,nodes_start:null,nodes_end:null,f:n|Be,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{ys(o),o.f|=ao}catch(l){throw ae(o),l}else e!==null&&In(o);if(s){var i=o;if(t&&i.deps===null&&i.teardown===null&&i.nodes_start===null&&i.first===i.last&&(i.f&Rn)===0&&(i=i.first),i!==null&&(i.parent=r,r!==null&&Zl(i,r),V!==null&&(V.f&_e)!==0&&(n&Ft)===0)){var c=V;(c.effects??(c.effects=[])).push(i)}}return o}function Fl(){return V!==null&&!ze}function mo(n){const e=Je(io,null,!1);return ye(e,pe),e.teardown=n,e}function Wr(n){ja();var e=G.f,t=!V&&(e&Rt)!==0&&(e&ao)===0;if(t){var s=ne;(s.e??(s.e=[])).push(n)}else return La(n)}function La(n){return Je(Zo|ma,n,!1)}function eu(n){return ja(),Je(io|ma,n,!0)}function tu(n){it.ensure();const e=Je(Ft|Rn,n,!0);return()=>{ae(e)}}function nu(n){it.ensure();const e=Je(Ft|Rn,n,!0);return(t={})=>new Promise(s=>{t.outro?Et(e,()=>{ae(e),s(void 0)}):(ae(e),s(void 0))})}function fr(n){return Je(Zo,n,!1)}function su(n){return Je(co|Rn,n,!0)}function pr(n,e=0){return Je(io|e,n,!0)}function ru(n,e=[],t=[]){Ta(e,t,s=>{Je(io,()=>n(...s.map(f)),!0)})}function Tt(n,e=0){var t=Je(Zt|e,n,!0);return t}function ce(n,e=!0){return Je(Rt|Rn,n,!0,e)}function Ua(n){var e=n.teardown;if(e!==null){const t=An,s=V;Pi(!0),Se(null);try{e.call(null)}finally{Pi(t),Se(s)}}}function xa(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&ns(()=>{r.abort(hs)});var s=t.next;(t.f&Ft)!==0?t.parent=null:ae(t,e),t=s}}function ou(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Rt)===0&&ae(e),e=t}}function ae(n,e=!0){var t=!1;(e||(n.f&el)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(Ba(n.nodes_start,n.nodes_end),t=!0),xa(n,e&&!t),Gr(n,0),ye(n,_n);var s=n.transitions;if(s!==null)for(const o of s)o.stop();Ua(n);var r=n.parent;r!==null&&r.first!==null&&Ha(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function Ba(n,e){for(;n!==null;){var t=n===e?null:dr(n);n.remove(),n=t}}function Ha(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function Et(n,e){var t=[];si(n,t,!0),Oa(t,()=>{ae(n),e&&e()})}function Oa(n,e){var t=n.length;if(t>0){var s=()=>--t||e();for(var r of n)r.out(s)}else e()}function si(n,e,t){if((n.f&Ge)===0){if(n.f^=Ge,n.transitions!==null)for(const i of n.transitions)(i.is_global||t)&&e.push(i);for(var s=n.first;s!==null;){var r=s.next,o=(s.f&tn)!==0||(s.f&Rt)!==0;si(s,e,o?t:!1),s=r}}}function go(n){za(n,!0)}function za(n,e){if((n.f&Ge)!==0){n.f^=Ge,(n.f&pe)===0&&(ye(n,Be),In(n));for(var t=n.first;t!==null;){var s=t.next,r=(t.f&tn)!==0||(t.f&Rt)!==0;za(t,r?e:!1),t=s}if(n.transitions!==null)for(const o of n.transitions)(o.is_global||e)&&o.in()}}let jn=!1;function Ti(n){jn=n}let An=!1;function Pi(n){An=n}let V=null,ze=!1;function Se(n){V=n}let G=null;function dt(n){G=n}let St=null;function Wa(n){V!==null&&(St===null?St=[n]:St.push(n))}let we=null,Ae=0,qe=null;function iu(n){qe=n}let Ga=1,ws=0,Ve=ws;function Di(n){Ve=n}let Vt=!1;function Va(){return++Ga}function wo(n){var e=n.f;if((e&Be)!==0)return!0;if((e&en)!==0){var t=n.deps,s=(e&Ue)!==0;if(t!==null){var r,o,i=(e&zr)!==0,c=s&&G!==null&&!Vt,l=t.length;if((i||c)&&(G===null||(G.f&_n)===0)){var u=n,d=u.parent;for(r=0;r<l;r++)o=t[r],(i||!o?.reactions?.includes(u))&&(o.reactions??(o.reactions=[])).push(u);i&&(u.f^=zr),c&&d!==null&&(d.f&Ue)===0&&(u.f^=Ue)}for(r=0;r<l;r++)if(o=t[r],wo(o)&&$a(o),o.wv>n.wv)return!0}(!s||G!==null&&!Vt)&&ye(n,pe)}return!1}function Qa(n,e,t=!0){var s=n.reactions;if(s!==null&&!St?.includes(n))for(var r=0;r<s.length;r++){var o=s[r];(o.f&_e)!==0?Qa(o,e,!1):e===o&&(t?ye(o,Be):(o.f&pe)!==0&&ye(o,en),In(o))}}function Ja(n){var E;var e=we,t=Ae,s=qe,r=V,o=Vt,i=St,c=ne,l=ze,u=Ve,d=n.f;we=null,Ae=0,qe=null,Vt=(d&Ue)!==0&&(ze||!jn||V===null),V=(d&(Rt|Ft))===0?n:null,St=null,Yn(n.ctx),ze=!1,Ve=++ws,n.ac!==null&&(ns(()=>{n.ac.abort(hs)}),n.ac=null);try{n.f|=jo;var p=n.fn,h=p(),m=n.deps;if(we!==null){var w;if(Gr(n,Ae),m!==null&&Ae>0)for(m.length=Ae+we.length,w=0;w<we.length;w++)m[Ae+w]=we[w];else n.deps=m=we;if(!Vt||(d&_e)!==0&&n.reactions!==null)for(w=Ae;w<m.length;w++)((E=m[w]).reactions??(E.reactions=[])).push(n)}else m!==null&&Ae<m.length&&(Gr(n,Ae),m.length=Ae);if(ts()&&qe!==null&&!ze&&m!==null&&(n.f&(_e|en|Be))===0)for(w=0;w<qe.length;w++)Qa(qe[w],n);return r!==null&&r!==n&&(ws++,qe!==null&&(s===null?s=qe:s.push(...qe))),(n.f&vn)!==0&&(n.f^=vn),h}catch(S){return Sa(S)}finally{n.f^=jo,we=e,Ae=t,qe=s,V=r,Vt=o,St=i,Yn(c),ze=l,Ve=u}}function au(n,e){let t=e.reactions;if(t!==null){var s=Xc.call(t,n);if(s!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[s]=t[r],t.pop())}}t===null&&(e.f&_e)!==0&&(we===null||!we.includes(e))&&(ye(e,en),(e.f&(Ue|zr))===0&&(e.f^=zr),Da(e),Gr(e,0))}function Gr(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)au(n,t[s])}function ys(n){var e=n.f;if((e&_n)===0){ye(n,pe);var t=G,s=jn;G=n,jn=!0;try{(e&Zt)!==0?ou(n):xa(n),Ua(n);var r=Ja(n);n.teardown=typeof r=="function"?r:null,n.wv=Ga;var o}finally{jn=s,G=t}}}async function cu(){await Promise.resolve(),jl()}function f(n){var e=n.f,t=(e&_e)!==0;if(V!==null&&!ze){var s=G!==null&&(G.f&_n)!==0;if(!s&&!St?.includes(n)){var r=V.deps;if((V.f&jo)!==0)n.rv<ws&&(n.rv=ws,we===null&&r!==null&&r[Ae]===n?Ae++:we===null?we=[n]:(!Vt||!we.includes(n))&&we.push(n));else{(V.deps??(V.deps=[])).push(n);var o=n.reactions;o===null?n.reactions=[V]:o.includes(V)||o.push(V)}}}else if(t&&n.deps===null&&n.effects===null){var i=n,c=i.parent;c!==null&&(c.f&Ue)===0&&(i.f^=Ue)}if(An){if(Kt.has(n))return Kt.get(n);if(t){i=n;var l=i.v;return((i.f&pe)===0&&i.reactions!==null||Ka(i))&&(l=ni(i)),Kt.set(i,l),l}}else t&&(i=n,wo(i)&&$a(i));if((n.f&vn)!==0)throw n.v;return n.v}function Ka(n){if(n.v===oe)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Kt.has(e)||(e.f&_e)!==0&&Ka(e))return!0;return!1}function Pt(n){var e=ze;try{return ze=!0,n()}finally{ze=e}}const lu=-7169;function ye(n,e){n.f=n.f&lu|e}function uu(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(ct in n)Oo(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&ct in t&&Oo(t)}}}function Oo(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{Oo(n[s],e)}catch{}const t=oo(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=fa(t);for(let r in s){const o=s[r].get;if(o)try{o.call(n)}catch{}}}}}function du(n){return n.endsWith("capture")&&n!=="gotpointercapture"&&n!=="lostpointercapture"}const fu=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function pu(n){return fu.includes(n)}const hu={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function mu(n){return n=n.toLowerCase(),hu[n]??n}const gu=["touchstart","touchmove"];function wu(n){return gu.includes(n)}const Ya=new Set,zo=new Set;function ri(n,e,t,s={}){function r(o){if(s.capture||us.call(e,o),!o.cancelBubble)return ns(()=>t?.call(this,o))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Qe(()=>{e.addEventListener(n,r,s)}):e.addEventListener(n,r,s),r}function Wo(n,e,t,s={}){var r=ri(e,n,t,s);return()=>{n.removeEventListener(e,r,s)}}function Zf(n,e,t,s,r){var o={capture:s,passive:r},i=ri(n,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&mo(()=>{e.removeEventListener(n,i,o)})}function yu(n){for(var e=0;e<n.length;e++)Ya.add(n[e]);for(var t of zo)t(n)}let $i=null;function us(n){var e=this,t=e.ownerDocument,s=n.type,r=n.composedPath?.()||[],o=r[0]||n.target;$i=n;var i=0,c=$i===n&&n.__root;if(c){var l=r.indexOf(c);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var u=r.indexOf(e);if(u===-1)return;l<=u&&(i=l)}if(o=r[i]||n.target,o!==e){ko(n,"currentTarget",{configurable:!0,get(){return o||t}});var d=V,p=G;Se(null),dt(null);try{for(var h,m=[];o!==null;){var w=o.assignedSlot||o.parentNode||o.host||null;try{var E=o["__"+s];if(E!=null&&(!o.disabled||n.target===o))if(lr(E)){var[S,...A]=E;S.apply(o,[n,...A])}else E.call(o,n)}catch(T){h?m.push(T):h=T}if(n.cancelBubble||w===e||w===null)break;o=w}if(h){for(let T of m)queueMicrotask(()=>{throw T});throw h}}finally{n.__root=e,delete n.currentTarget,Se(d),dt(p)}}}function oi(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function En(n,e){var t=G;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function Ff(n,e){var t=(e&El)!==0,s=(e&Sl)!==0,r,o=!n.startsWith("<!>");return()=>{r===void 0&&(r=oi(o?n:"<!>"+n),t||(r=at(r)));var i=s||Na?document.importNode(r,!0):r.cloneNode(!0);if(t){var c=at(i),l=i.lastChild;En(c,l)}else En(i,i);return i}}function vu(n,e,t="svg"){var s=!n.startsWith("<!>"),r=`<${t}>${s?n:"<!>"+n}</${t}>`,o;return()=>{if(!o){var i=oi(r),c=at(i);o=at(c)}var l=o.cloneNode(!0);return En(l,l),l}}function ep(n,e){return vu(n,e,"svg")}function tp(n=""){{var e=At(n+"");return En(e,e),e}}function np(){var n=document.createDocumentFragment(),e=document.createComment(""),t=At();return n.append(e,t),En(e,t),n}function sp(n,e){n!==null&&n.before(e)}let Vr=!0;function Mi(n){Vr=n}function rp(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function op(n,e){return bu(n,e)}const Nn=new Map;function bu(n,{target:e,anchor:t,props:s={},events:r,context:o,intro:i=!0}){Jl();var c=new Set,l=p=>{for(var h=0;h<p.length;h++){var m=p[h];if(!c.has(m)){c.add(m);var w=wu(m);e.addEventListener(m,us,{passive:w});var E=Nn.get(m);E===void 0?(document.addEventListener(m,us,{passive:w}),Nn.set(m,1)):Nn.set(m,E+1)}}};l(Xo(Ya)),zo.add(l);var u=void 0,d=nu(()=>{var p=t??e.appendChild(At());return xl(p,{pending:()=>{}},h=>{if(o){Cl({});var m=ne;m.c=o}r&&(s.$$events=r),Vr=i,u=n(h,s)||{},Vr=!0,o&&Nl()}),()=>{for(var h of c){e.removeEventListener(h,us);var m=Nn.get(h);--m===0?(document.removeEventListener(h,us),Nn.delete(h)):Nn.set(h,m)}zo.delete(l),p!==t&&p.parentNode?.removeChild(p)}});return Iu.set(u,d),u}let Iu=new WeakMap;function ip(n,e,t=!1){var s=n,r=null,o=null,i=oe,c=t?tn:0,l=!1;const u=(m,w=!0)=>{l=!0,h(w,m)};var d=null;function p(){d!==null&&(d.lastChild.remove(),s.before(d),d=null);var m=i?r:o,w=i?o:r;m&&go(m),w&&Et(w,()=>{i?o=null:r=null})}const h=(m,w)=>{if(i!==(i=m)){var E=po(),S=s;if(E&&(d=document.createDocumentFragment(),d.append(S=At())),i?r??(r=w&&ce(()=>w(S))):o??(o=w&&ce(()=>w(S))),E){var A=K,T=i?r:o,R=i?o:r;T&&A.skipped_effects.delete(T),R&&A.skipped_effects.add(R),A.add_callback(p)}else p()}};Tt(()=>{l=!1,e(u),l||h(null,null)},c)}function ap(n,e,t){var s=n,r=oe,o,i,c=null,l=ts()?$l:ba;function u(){o&&Et(o),c!==null&&(c.lastChild.remove(),s.before(c),c=null),o=i}Tt(()=>{if(l(r,r=e())){var d=s,p=po();p&&(c=document.createDocumentFragment(),c.append(d=At())),i=ce(()=>t(d)),p?K.add_callback(u):u()}})}let bn=null;function Ci(n){bn=n}function cp(n,e){return e}function Eu(n,e,t){for(var s=n.items,r=[],o=e.length,i=0;i<o;i++)si(e[i].e,r,!0);var c=o>0&&r.length===0&&t!==null;if(c){var l=t.parentNode;Kl(l),l.append(t),s.clear(),Xe(n,e[0].prev,e[o-1].next)}Oa(r,()=>{for(var u=0;u<o;u++){var d=e[u];c||(s.delete(d.k),Xe(n,d.prev,d.next)),ae(d.e,!c)}})}function lp(n,e,t,s,r,o=null){var i=n,c={flags:e,items:new Map,first:null},l=(e&ya)!==0;if(l){var u=n;i=u.appendChild(At())}var d=null,p=!1,h=new Map,m=ti(()=>{var A=t();return lr(A)?A:A==null?[]:Xo(A)}),w,E;function S(){Su(E,w,c,h,i,r,e,s,t),o!==null&&(w.length===0?d?go(d):d=ce(()=>o(i)):d!==null&&Et(d,()=>{d=null}))}Tt(()=>{E??(E=G),w=f(m);var A=w.length;if(!(p&&A===0)){p=A===0;var T,R,q,O;if(po()){var L=new Set,U=K;for(R=0;R<A;R+=1){q=w[R],O=s(q,R);var le=c.items.get(O)??h.get(O);le?(e&(lo|uo))!==0&&Xa(le,q,R,e):(T=Za(null,c,null,null,q,O,R,r,e,t,!0),h.set(O,T)),L.add(O)}for(const[Re,os]of c.items)L.has(Re)||U.skipped_effects.add(os.e);U.add_callback(S)}else S();f(m)}})}function Su(n,e,t,s,r,o,i,c,l){var u=(i&fl)!==0,d=(i&(lo|uo))!==0,p=e.length,h=t.items,m=t.first,w=m,E,S=null,A,T=[],R=[],q,O,L,U;if(u)for(U=0;U<p;U+=1)q=e[U],O=c(q,U),L=h.get(O),L!==void 0&&(L.a?.measure(),(A??(A=new Set)).add(L));for(U=0;U<p;U+=1){if(q=e[U],O=c(q,U),L=h.get(O),L===void 0){var le=s.get(O);if(le!==void 0){s.delete(O),h.set(O,le);var Re=S?S.next:w;Xe(t,S,le),Xe(t,le,Re),So(le,Re,r),S=le}else{var os=w?w.e.nodes_start:r;S=Za(os,t,S,S===null?t.first:S.next,q,O,U,o,i,l)}h.set(O,S),T=[],R=[],w=S.next;continue}if(d&&Xa(L,q,U,i),(L.e.f&Ge)!==0&&(go(L.e),u&&(L.a?.unfix(),(A??(A=new Set)).delete(L))),L!==w){if(E!==void 0&&E.has(L)){if(T.length<R.length){var Dn=R[0],Ke;S=Dn.prev;var is=T[0],$n=T[T.length-1];for(Ke=0;Ke<T.length;Ke+=1)So(T[Ke],Dn,r);for(Ke=0;Ke<R.length;Ke+=1)E.delete(R[Ke]);Xe(t,is.prev,$n.next),Xe(t,S,is),Xe(t,$n,Dn),w=Dn,S=$n,U-=1,T=[],R=[]}else E.delete(L),So(L,w,r),Xe(t,L.prev,L.next),Xe(t,L,S===null?t.first:S.next),Xe(t,S,L),S=L;continue}for(T=[],R=[];w!==null&&w.k!==O;)(w.e.f&Ge)===0&&(E??(E=new Set)).add(w),R.push(w),w=w.next;if(w===null)continue;L=w}T.push(L),S=L,w=L.next}if(w!==null||E!==void 0){for(var Dt=E===void 0?[]:Xo(E);w!==null;)(w.e.f&Ge)===0&&Dt.push(w),w=w.next;var Mn=Dt.length;if(Mn>0){var Ir=(i&ya)!==0&&p===0?r:null;if(u){for(U=0;U<Mn;U+=1)Dt[U].a?.measure();for(U=0;U<Mn;U+=1)Dt[U].a?.fix()}Eu(t,Dt,Ir)}}u&&Qe(()=>{if(A!==void 0)for(L of A)L.a?.apply()}),n.first=t.first&&t.first.e,n.last=S&&S.e;for(var Er of s.values())ae(Er.e);s.clear()}function Xa(n,e,t,s){(s&lo)!==0&&Zn(n.v,e),(s&uo)!==0?Zn(n.i,t):n.i=t}function Za(n,e,t,s,r,o,i,c,l,u,d){var p=bn,h=(l&lo)!==0,m=(l&pl)===0,w=h?m?Ql(r,!1,!1):ut(r):r,E=(l&uo)===0?i:ut(i),S={i:E,v:w,k:o,a:null,e:null,prev:t,next:s};bn=S;try{if(n===null){var A=document.createDocumentFragment();A.append(n=At())}return S.e=ce(()=>c(n,w,E,u),Dl),S.e.prev=t&&t.e,S.e.next=s&&s.e,t===null?d||(e.first=S):(t.next=S,t.e.next=S.e),s!==null&&(s.prev=S,s.e.prev=S.e),S}finally{bn=p}}function So(n,e,t){for(var s=n.next?n.next.e.nodes_start:t,r=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==s;){var i=dr(o);r.before(o),o=i}}function Xe(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function up(n,e,t=!1,s=!1,r=!1){var o=n,i="";ru(()=>{var c=G;if(i!==(i=e()??"")&&(c.nodes_start!==null&&(Ba(c.nodes_start,c.nodes_end),c.nodes_start=c.nodes_end=null),i!=="")){var l=i+"";t?l=`<svg>${l}</svg>`:s&&(l=`<math>${l}</math>`);var u=oi(l);if((t||s)&&(u=at(u)),En(at(u),u.lastChild),t||s)for(;at(u);)o.before(at(u));else o.before(u)}})}function dp(n,e,...t){var s=n,r=sn,o;Tt(()=>{r!==(r=e())&&(o&&(ae(o),o=null),o=ce(()=>r(s,...t)))},tn)}function fp(n,e,t){var s=n,r,o,i=null,c=null;function l(){o&&(Et(o),o=null),i&&(i.lastChild.remove(),s.before(i),i=null),o=c,c=null}Tt(()=>{if(r!==(r=e())){var u=po();if(r){var d=s;u&&(i=document.createDocumentFragment(),i.append(d=At()),o&&K.skipped_effects.add(o)),c=ce(()=>t(d,r))}u?K.add_callback(l):l()}},tn)}function pp(n,e,t,s,r,o){var i,c,l=null,u=n,d,p=bn;Tt(()=>{const h=e()||null;var m=Rl;if(h!==i){var w=bn;Ci(p),d&&(h===null?Et(d,()=>{d=null,c=null}):h===c?go(d):(ae(d),Mi(!1))),h&&h!==c&&(d=ce(()=>{if(l=document.createElementNS(m,h),En(l,l),s){var E=l.appendChild(At());s(l,E)}G.nodes_end=l,u.before(l)})),i=h,i&&(c=i),Mi(!0),Ci(w)}},tn)}function _u(n,e){var t=void 0,s;Tt(()=>{t!==(t=e())&&(s&&(ae(s),s=null),t&&(s=ce(()=>{fr(()=>t(n))})))})}function Fa(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=Fa(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function Ru(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=Fa(n))&&(s&&(s+=" "),s+=e);return s}function Au(n){return typeof n=="object"?Ru(n):n??""}const Ni=[...` 	
\r\fÂ \v\uFEFF`];function Tu(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var r in t)if(t[r])s=s?s+" "+r:r;else if(s.length)for(var o=r.length,i=0;(i=s.indexOf(r,i))>=0;){var c=i+o;(i===0||Ni.includes(s[i-1]))&&(c===s.length||Ni.includes(s[c]))?s=(i===0?"":s.substring(0,i))+s.substring(c+1):i=c}}return s===""?null:s}function ki(n,e=!1){var t=e?" !important;":";",s="";for(var r in n){var o=n[r];o!=null&&o!==""&&(s+=" "+r+": "+o+t)}return s}function _o(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function Pu(n,e){if(e){var t="",s,r;if(Array.isArray(e)?(s=e[0],r=e[1]):s=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,i=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(_o)),r&&l.push(...Object.keys(r).map(_o));var u=0,d=-1;const E=n.length;for(var p=0;p<E;p++){var h=n[p];if(c?h==="/"&&n[p-1]==="*"&&(c=!1):o?o===h&&(o=!1):h==="/"&&n[p+1]==="*"?c=!0:h==='"'||h==="'"?o=h:h==="("?i++:h===")"&&i--,!c&&o===!1&&i===0){if(h===":"&&d===-1)d=p;else if(h===";"||p===E-1){if(d!==-1){var m=_o(n.substring(u,d).trim());if(!l.includes(m)){h!==";"&&p++;var w=n.substring(u,p).trim();t+=" "+w+";"}}u=p+1,d=-1}}}}return s&&(t+=ki(s)),r&&(t+=ki(r,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Du(n,e,t,s,r,o){var i=n.__className;if(i!==t||i===void 0){var c=Tu(t,s,o);c==null?n.removeAttribute("class"):e?n.className=c:n.setAttribute("class",c),n.__className=t}else if(o&&r!==o)for(var l in o){var u=!!o[l];(r==null||u!==!!r[l])&&n.classList.toggle(l,u)}return o}function Ro(n,e={},t,s){for(var r in t){var o=t[r];e[r]!==o&&(t[r]==null?n.style.removeProperty(r):n.style.setProperty(r,o,s))}}function $u(n,e,t,s){var r=n.__style;if(r!==e){var o=Pu(e,s);o==null?n.removeAttribute("style"):n.style.cssText=o,n.__style=e}else s&&(Array.isArray(s)?(Ro(n,t?.[0],s[0]),Ro(n,t?.[1],s[1],"important")):Ro(n,t,s));return s}function Qr(n,e,t=!1){if(n.multiple){if(e==null)return;if(!lr(e))return Tl();for(var s of n.options)s.selected=e.includes(gs(s));return}for(s of n.options){var r=gs(s);if(Ca(r,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function ec(n){var e=new MutationObserver(()=>{Qr(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),mo(()=>{e.disconnect()})}function hp(n,e,t=e){var s=!0;ho(n,"change",r=>{var o=r?"[selected]":":checked",i;if(n.multiple)i=[].map.call(n.querySelectorAll(o),gs);else{var c=n.querySelector(o)??n.querySelector("option:not([disabled])");i=c&&gs(c)}t(i)}),fr(()=>{var r=e();if(Qr(n,r,s),s&&r===void 0){var o=n.querySelector(":checked");o!==null&&(r=gs(o),t(r))}n.__value=r,s=!1}),ec(n)}function gs(n){return"__value"in n?n.__value:n.value}const as=Symbol("class"),cs=Symbol("style"),tc=Symbol("is custom element"),nc=Symbol("is html");function mp(n,e){var t=yo(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function gp(n,e){var t=yo(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function Mu(n,e){e?n.hasAttribute("selected")||n.setAttribute("selected",""):n.removeAttribute("selected")}function qi(n,e,t,s){var r=yo(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[tl]=t),t==null?n.removeAttribute(e):typeof t!="string"&&sc(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Cu(n,e,t,s,r=!1,o=!1){var i=yo(n),c=i[tc],l=!i[nc],u=e||{},d=n.tagName==="OPTION";for(var p in e)p in t||(t[p]=null);t.class?t.class=Au(t.class):t[as]&&(t.class=null),t[cs]&&(t.style??(t.style=null));var h=sc(n);for(const R in t){let q=t[R];if(d&&R==="value"&&q==null){n.value=n.__value="",u[R]=q;continue}if(R==="class"){var m=n.namespaceURI==="http://www.w3.org/1999/xhtml";Du(n,m,q,s,e?.[as],t[as]),u[R]=q,u[as]=t[as];continue}if(R==="style"){$u(n,q,e?.[cs],t[cs]),u[R]=q,u[cs]=t[cs];continue}var w=u[R];if(!(q===w&&!(q===void 0&&n.hasAttribute(R)))){u[R]=q;var E=R[0]+R[1];if(E!=="$$")if(E==="on"){const O={},L="$$"+R;let U=R.slice(2);var S=pu(U);if(du(U)&&(U=U.slice(0,-7),O.capture=!0),!S&&w){if(q!=null)continue;n.removeEventListener(U,u[L],O),u[L]=null}if(q!=null)if(S)n[`__${U}`]=q,yu([U]);else{let le=function(Re){u[R].call(this,Re)};u[L]=ri(U,n,le,O)}else S&&(n[`__${U}`]=void 0)}else if(R==="style")qi(n,R,q);else if(R==="autofocus")Yl(n,!!q);else if(!c&&(R==="__value"||R==="value"&&q!=null))n.value=n.__value=q;else if(R==="selected"&&d)Mu(n,q);else{var A=R;l||(A=mu(A));var T=A==="defaultValue"||A==="defaultChecked";if(q==null&&!c&&!T)if(i[R]=null,A==="value"||A==="checked"){let O=n;const L=e===void 0;if(A==="value"){let U=O.defaultValue;O.removeAttribute(A),O.defaultValue=U,O.value=O.__value=L?U:null}else{let U=O.defaultChecked;O.removeAttribute(A),O.defaultChecked=U,O.checked=L?U:!1}}else n.removeAttribute(R);else T||h.includes(A)&&(c||typeof q!="string")?(n[A]=q,A in i&&(i[A]=oe)):typeof q!="function"&&qi(n,A,q)}}}return u}function wp(n,e,t=[],s=[],r,o=!1,i=!1){Ta(t,s,c=>{var l=void 0,u={},d=n.nodeName==="SELECT",p=!1;if(Tt(()=>{var m=e(...c.map(f)),w=Cu(n,l,m,r,o,i);p&&d&&"value"in m&&Qr(n,m.value);for(let S of Object.getOwnPropertySymbols(u))m[S]||ae(u[S]);for(let S of Object.getOwnPropertySymbols(m)){var E=m[S];S.description===Al&&(!l||E!==l[S])&&(u[S]&&ae(u[S]),u[S]=ce(()=>_u(n,()=>E))),w[S]=E}l=w}),d){var h=n;fr(()=>{Qr(h,l.value,!0),ec(h)})}p=!0})}function yo(n){return n.__attributes??(n.__attributes={[tc]:n.nodeName.includes("-"),[nc]:n.namespaceURI===_l})}var ji=new Map;function sc(n){var e=n.getAttribute("is")||n.nodeName,t=ji.get(e);if(t)return t;ji.set(e,t=[]);for(var s,r=n,o=Element.prototype;o!==r;){s=fa(r);for(var i in s)s[i].set&&t.push(i);r=oo(r)}return t}const Nu=()=>performance.now(),vt={tick:n=>requestAnimationFrame(n),now:()=>Nu(),tasks:new Set};function rc(){const n=vt.now();vt.tasks.forEach(e=>{e.c(n)||(vt.tasks.delete(e),e.f())}),vt.tasks.size!==0&&vt.tick(rc)}function ku(n){let e;return vt.tasks.size===0&&vt.tick(rc),{promise:new Promise(t=>{vt.tasks.add(e={c:n,f:t})}),abort(){vt.tasks.delete(e)}}}function Rr(n,e){ns(()=>{n.dispatchEvent(new CustomEvent(e))})}function qu(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Li(n){const e={},t=n.split(";");for(const s of t){const[r,o]=s.split(":");if(!r||o===void 0)break;const i=qu(r.trim());e[i]=o.trim()}return e}const ju=n=>n;function yp(n,e,t){var s=bn,r,o,i,c=null;s.a??(s.a={element:n,measure(){r=this.element.getBoundingClientRect()},apply(){if(i?.abort(),o=this.element.getBoundingClientRect(),r.left!==o.left||r.right!==o.right||r.top!==o.top||r.bottom!==o.bottom){const l=e()(this.element,{from:r,to:o},t?.());i=Jr(this.element,l,void 0,1,()=>{i?.abort(),i=void 0})}},fix(){if(!n.getAnimations().length){var{position:l,width:u,height:d}=getComputedStyle(n);if(l!=="absolute"&&l!=="fixed"){var p=n.style;c={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=u,p.height=d;var h=n.getBoundingClientRect();if(r.left!==h.left||r.top!==h.top){var m=`translate(${r.left-h.left}px, ${r.top-h.top}px)`;p.transform=p.transform?`${p.transform} ${m}`:m}}}},unfix(){if(c){var l=n.style;l.position=c.position,l.width=c.width,l.height=c.height,l.transform=c.transform}}}),s.a.element=n}function vp(n,e,t,s){var r=(n&vl)!==0,o=(n&bl)!==0,i=r&&o,c=(n&Il)!==0,l=i?"both":r?"in":"out",u,d=e.inert,p=e.style.overflow,h,m;function w(){return ns(()=>u??(u=t()(e,s?.()??{},{direction:l})))}var E={is_global:c,in(){if(e.inert=d,!r){m?.abort(),m?.reset?.();return}o||h?.abort(),Rr(e,"introstart"),h=Jr(e,w(),m,1,()=>{Rr(e,"introend"),h?.abort(),h=u=void 0,e.style.overflow=p})},out(R){if(!o){R?.(),u=void 0;return}e.inert=!0,Rr(e,"outrostart"),m=Jr(e,w(),h,0,()=>{Rr(e,"outroend"),R?.()})},stop:()=>{h?.abort(),m?.abort()}},S=G;if((S.transitions??(S.transitions=[])).push(E),r&&Vr){var A=c;if(!A){for(var T=S.parent;T&&(T.f&tn)!==0;)for(;(T=T.parent)&&(T.f&Zt)===0;);A=!T||(T.f&ao)!==0}A&&fr(()=>{Pt(()=>E.in())})}}function Jr(n,e,t,s,r){var o=s===1;if(kn(e)){var i,c=!1;return Qe(()=>{if(!c){var S=e({direction:o?"in":"out"});i=Jr(n,S,t,s,r)}}),{abort:()=>{c=!0,i?.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(t?.deactivate(),!e?.duration)return r(),{abort:sn,deactivate:sn,reset:sn,t:()=>s};const{delay:l=0,css:u,tick:d,easing:p=ju}=e;var h=[];if(o&&t===void 0&&(d&&d(0,1),u)){var m=Li(u(0,1));h.push(m,m)}var w=()=>1-s,E=n.animate(h,{duration:l,fill:"forwards"});return E.onfinish=()=>{E.cancel();var S=t?.t()??1-s;t?.abort();var A=s-S,T=e.duration*Math.abs(A),R=[];if(T>0){var q=!1;if(u)for(var O=Math.ceil(T/16.666666666666668),L=0;L<=O;L+=1){var U=S+A*p(L/O),le=Li(u(U,1-U));R.push(le),q||(q=le.overflow==="hidden")}q&&(n.style.overflow="hidden"),w=()=>{var Re=E.currentTime;return S+A*p(Re/T)},d&&ku(()=>{if(E.playState!=="running")return!1;var Re=w();return d(Re,1-Re),!0})}E=n.animate(R,{duration:T,fill:"forwards"}),E.onfinish=()=>{w=()=>s,d?.(s,1-s),r()}},{abort:()=>{E&&(E.cancel(),E.effect=null,E.onfinish=sn)},deactivate:()=>{r=sn},reset:()=>{s===0&&d?.(1,0)},t:()=>w()}}function bp(n,e,t=e){var s=new WeakSet;ho(n,"input",async r=>{var o=r?n.defaultValue:n.value;if(o=To(n)?Po(o):o,t(o),K!==null&&s.add(K),await cu(),o!==(o=e())){var i=n.selectionStart,c=n.selectionEnd;n.value=o??"",c!==null&&(n.selectionStart=i,n.selectionEnd=Math.min(c,n.value.length))}}),Pt(e)==null&&n.value&&(t(To(n)?Po(n.value):n.value),K!==null&&s.add(K)),pr(()=>{var r=e();if(n===document.activeElement){var o=$r??K;if(s.has(o))return}To(n)&&r===Po(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}const Ao=new Set;function Ip(n,e,t,s,r=s){var o=t.getAttribute("type")==="checkbox",i=n;if(e!==null)for(var c of e)i=i[c]??(i[c]=[]);i.push(t),ho(t,"change",()=>{var l=t.__value;o&&(l=Lu(i,l,t.checked)),r(l)},()=>r(o?[]:null)),pr(()=>{var l=s();o?(l=l||[],t.checked=l.includes(t.__value)):t.checked=Ca(t.__value,l)}),mo(()=>{var l=i.indexOf(t);l!==-1&&i.splice(l,1)}),Ao.has(i)||(Ao.add(i),Qe(()=>{i.sort((l,u)=>l.compareDocumentPosition(u)===4?-1:1),Ao.delete(i)})),Qe(()=>{})}function Ep(n,e,t=e){ho(n,"change",s=>{var r=s?n.defaultChecked:n.checked;t(r)}),Pt(e)==null&&t(n.checked),pr(()=>{var s=e();n.checked=!!s})}function Lu(n,e,t){for(var s=new Set,r=0;r<n.length;r+=1)n[r].checked&&s.add(n[r].__value);return t||s.delete(e),Array.from(s)}function To(n){var e=n.type;return e==="number"||e==="range"}function Po(n){return n===""?null:+n}function Ui(n,e){return n===e||n?.[ct]===e}function Sp(n={},e,t,s){return fr(()=>{var r,o;return pr(()=>{r=o,o=[],Pt(()=>{n!==t(...o)&&(e(n,...o),r&&Ui(t(...r),n)&&e(null,...r))})}),()=>{Qe(()=>{o&&Ui(t(...o),n)&&e(null,...o)})}}),n}function _p(n=!1){const e=ne,t=e.l.u;if(!t)return;let s=()=>uu(e.s);if(n){let r=0,o={};const i=ur(()=>{let c=!1;const l=e.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],c=!0);return c&&r++,r});s=()=>f(i)}t.b.length&&eu(()=>{xi(e,s),qo(t.b)}),Wr(()=>{const r=Pt(()=>t.m.map(Fc));return()=>{for(const o of r)typeof o=="function"&&o()}}),t.a.length&&Wr(()=>{xi(e,s),qo(t.a)})}function xi(n,e){if(n.l.s)for(const t of n.l.s)f(t);e()}function Rp(n){var e=ut(0);return function(){return arguments.length===1?(g(e,f(e)+1),arguments[0]):(f(e),n())}}let Ar=!1;function Uu(n){var e=Ar;try{return Ar=!1,[n(),Ar]}finally{Ar=e}}const xu={get(n,e){if(!n.exclude.includes(e))return n.props[e]},set(n,e){return!1},getOwnPropertyDescriptor(n,e){if(!n.exclude.includes(e)&&e in n.props)return{enumerable:!0,configurable:!0,value:n.props[e]}},has(n,e){return n.exclude.includes(e)?!1:e in n.props},ownKeys(n){return Reflect.ownKeys(n.props).filter(e=>!n.exclude.includes(e))}};function Ap(n,e,t){return new Proxy({props:n,exclude:e},xu)}const Bu={get(n,e){let t=n.props.length;for(;t--;){let s=n.props[t];if(kn(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(n,e,t){let s=n.props.length;for(;s--;){let r=n.props[s];kn(r)&&(r=r());const o=Jt(r,e);if(o&&o.set)return o.set(t),!0}return!1},getOwnPropertyDescriptor(n,e){let t=n.props.length;for(;t--;){let s=n.props[t];if(kn(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const r=Jt(s,e);return r&&!r.configurable&&(r.configurable=!0),r}}},has(n,e){if(e===ct||e===ga)return!1;for(let t of n.props)if(kn(t)&&(t=t()),t!=null&&e in t)return!0;return!1},ownKeys(n){const e=[];for(let t of n.props)if(kn(t)&&(t=t()),!!t){for(const s in t)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(t))e.includes(s)||e.push(s)}return e}};function Tp(...n){return new Proxy({props:n},Bu)}function Pp(n,e,t,s){var r=!es||(t&ml)!==0,o=(t&wl)!==0,i=(t&yl)!==0,c=s,l=!0,u=()=>(l&&(l=!1,c=i?Pt(s):s),c),d;if(o){var p=ct in n||ga in n;d=Jt(n,e)?.set??(p&&e in n?R=>n[e]=R:void 0)}var h,m=!1;o?[h,m]=Uu(()=>n[e]):h=n[e],h===void 0&&s!==void 0&&(h=u(),d&&(r&&al(),d(h)));var w;if(r?w=()=>{var R=n[e];return R===void 0?u():(l=!0,R)}:w=()=>{var R=n[e];return R!==void 0&&(c=void 0),R===void 0?c:R},r&&(t&gl)===0)return w;if(d){var E=n.$$legacy;return(function(R,q){return arguments.length>0?((!r||!q||E||m)&&d(q?w():R),R):w()})}var S=!1,A=((t&hl)!==0?ur:ti)(()=>(S=!1,w()));o&&f(A);var T=G;return(function(R,q){if(arguments.length>0){const O=q?f(A):r&&o?ie(R):R;return g(A,O),S=!0,c!==void 0&&(c=O),R}return An&&S||(T.f&_n)!==0?A.v:f(A)})}function Hu(n){ne===null&&wa(),es&&ne.l!==null?Ou(ne).m.push(n):Wr(()=>{const e=Pt(n);if(typeof e=="function")return e})}function Dp(n){ne===null&&wa(),Hu(()=>()=>Pt(n))}function Ou(n){var e=n.l;return e.u??(e.u={a:[],b:[],m:[]})}const zu="modulepreload",Wu=function(n){return"/"+n},Bi={},Do=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=i?.nonce||i?.getAttribute("nonce");r=l(t.map(u=>{if(u=Wu(u),u in Bi)return;Bi[u]=!0;const d=u.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":zu,d||(h.as="script"),h.crossOrigin="",h.href=u,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((m,w)=>{h.addEventListener("load",m),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};var Gu=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Vu=["difference","intersection","symmetricDifference","union"],Hi=!1,zn,Oe,jt,Xr,Fn,oc,ic;const Zr=class Zr extends Set{constructor(t){super();v(this,Fn);v(this,zn,new Map);v(this,Oe,C(0));v(this,jt,C(0));v(this,Xr,Ve||-1);if(t){for(var s of t)super.add(s);a(this,jt).v=super.size}Hi||I(this,Fn,ic).call(this)}has(t){var s=super.has(t),r=a(this,zn),o=r.get(t);if(o===void 0){if(!s)return f(a(this,Oe)),!1;o=I(this,Fn,oc).call(this,!0),r.set(t,o)}return f(o),s}add(t){return super.has(t)||(super.add(t),g(a(this,jt),super.size),Ne(a(this,Oe))),this}delete(t){var s=super.delete(t),r=a(this,zn),o=r.get(t);return o!==void 0&&(r.delete(t),g(o,!1)),s&&(g(a(this,jt),super.size),Ne(a(this,Oe))),s}clear(){if(super.size!==0){super.clear();var t=a(this,zn);for(var s of t.values())g(s,!1);t.clear(),g(a(this,jt),0),Ne(a(this,Oe))}}keys(){return this.values()}values(){return f(a(this,Oe)),super.values()}entries(){return f(a(this,Oe)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return f(a(this,jt))}};zn=new WeakMap,Oe=new WeakMap,jt=new WeakMap,Xr=new WeakMap,Fn=new WeakSet,oc=function(t){return Ve===a(this,Xr)?C(t):ut(t)},ic=function(){Hi=!0;var t=Zr.prototype,s=Set.prototype;for(const r of Gu)t[r]=function(...o){return f(a(this,Oe)),s[r].apply(this,o)};for(const r of Vu)t[r]=function(...o){f(a(this,Oe));var i=s[r].apply(this,o);return new Zr(i)}};let Oi=Zr;var tt,nt,mt,Fr,We,ds,kr;const fi=class fi extends Map{constructor(t){super();v(this,We);v(this,tt,new Map);v(this,nt,C(0));v(this,mt,C(0));v(this,Fr,Ve||-1);if(t){for(var[s,r]of t)super.set(s,r);a(this,mt).v=super.size}}has(t){var s=a(this,tt),r=s.get(t);if(r===void 0){var o=super.get(t);if(o!==void 0)r=I(this,We,ds).call(this,0),s.set(t,r);else return f(a(this,nt)),!1}return f(r),!0}forEach(t,s){I(this,We,kr).call(this),super.forEach(t,s)}get(t){var s=a(this,tt),r=s.get(t);if(r===void 0){var o=super.get(t);if(o!==void 0)r=I(this,We,ds).call(this,0),s.set(t,r);else{f(a(this,nt));return}}return f(r),super.get(t)}set(t,s){var r=a(this,tt),o=r.get(t),i=super.get(t),c=super.set(t,s),l=a(this,nt);if(o===void 0)o=I(this,We,ds).call(this,0),r.set(t,o),g(a(this,mt),super.size),Ne(l);else if(i!==s){Ne(o);var u=l.reactions===null?null:new Set(l.reactions),d=u===null||!o.reactions?.every(p=>u.has(p));d&&Ne(l)}return c}delete(t){var s=a(this,tt),r=s.get(t),o=super.delete(t);return r!==void 0&&(s.delete(t),g(a(this,mt),super.size),g(r,-1),Ne(a(this,nt))),o}clear(){if(super.size!==0){super.clear();var t=a(this,tt);g(a(this,mt),0);for(var s of t.values())g(s,-1);Ne(a(this,nt)),t.clear()}}keys(){return f(a(this,nt)),super.keys()}values(){return I(this,We,kr).call(this),super.values()}entries(){return I(this,We,kr).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(a(this,mt)),super.size}};tt=new WeakMap,nt=new WeakMap,mt=new WeakMap,Fr=new WeakMap,We=new WeakSet,ds=function(t){return Ve===a(this,Fr)?C(t):ut(t)},kr=function(){f(a(this,nt));var t=a(this,tt);if(a(this,mt).v!==t.size){for(var s of bi(fi.prototype,this,"keys").call(this))if(!t.has(s)){var r=I(this,We,ds).call(this,0);t.set(s,r)}}for([,r]of a(this,tt))f(r)};let Xt=fi;var _s,Rs;class Qu{constructor(e,t){v(this,_s);v(this,Rs);_(this,_s,e),_(this,Rs,ei(t))}get current(){return a(this,Rs).call(this),a(this,_s).call(this)}}_s=new WeakMap,Rs=new WeakMap;const Ju=/\(.+\)/,Ku=new Set(["all","print","screen","and","or","not","only"]);class zi extends Qu{constructor(e,t){let s=Ju.test(e)||e.split(/[\s,]+/).some(o=>Ku.has(o.trim()))?e:`(${e})`;const r=window.matchMedia(s);super(()=>r.matches,o=>Wo(r,"change",o))}}const Yu=typeof window<"u"?window:void 0;function Xu(n){let e=n.activeElement;for(;e?.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}var Wn,As;class Zu{constructor(e={}){v(this,Wn);v(this,As);const{window:t=Yu,document:s=t?.document}=e;t!==void 0&&(_(this,Wn,s),_(this,As,ei(r=>{const o=Wo(t,"focusin",r),i=Wo(t,"focusout",r);return()=>{o(),i()}})))}get current(){var e;return(e=a(this,As))==null||e.call(this),a(this,Wn)?Xu(a(this,Wn)):null}}Wn=new WeakMap,As=new WeakMap;new Zu;function Fu(n){return typeof n=="function"}function ed(n,e){if(Fu(n)){const s=n();return s===void 0?e:s}return n===void 0?e:n}function td(n,e){let t=C(null);const s=X(()=>ed(e,250));function r(...o){if(f(t))f(t).timeout&&clearTimeout(f(t).timeout);else{let i,c;const l=new Promise((u,d)=>{i=u,c=d});g(t,{timeout:null,runner:null,promise:l,resolve:i,reject:c},!0)}return f(t).runner=async()=>{if(!f(t))return;const i=f(t);g(t,null);try{i.resolve(await n.apply(this,o))}catch(c){i.reject(c)}},f(t).timeout=setTimeout(f(t).runner,f(s)),f(t).promise}return r.cancel=async()=>{(!f(t)||f(t).timeout===null)&&(await new Promise(o=>setTimeout(o,0)),!f(t)||f(t).timeout===null)||(clearTimeout(f(t).timeout),f(t).reject("Cancelled"),g(t,null))},r.runScheduledNow=async()=>{(!f(t)||!f(t).timeout)&&(await new Promise(o=>setTimeout(o,0)),!f(t)||!f(t).timeout)||(clearTimeout(f(t).timeout),f(t).timeout=null,await f(t).runner?.())},Object.defineProperty(r,"pending",{enumerable:!0,get(){return!!f(t)?.timeout}}),r}function ac(n,e){switch(e){case"kg":case"l.":return Math.round(n*100)/100;case"gr.":case"ml":return Math.round(n);default:return Math.round(n*10)/10}}function lt(n){return n?.length?n.map(e=>cn(e.q,e.u)).join(" et "):"-"}function nd(n,e){const t=typeof n=="number"?n:parseFloat(n);if(isNaN(t))return{value:0,unit:e};let s=e,r=t;return(e==="gr."||e==="ml")&&t>=1e3?(r=t/1e3,s=e==="gr."?"kg":"l."):(e==="kg"||e==="l.")&&t<1&&t>0&&(r=t*1e3,s=e==="kg"?"gr.":"ml"),{value:ac(r,s),unit:s}}function cn(n,e){const{value:t,unit:s}=nd(n,e);let r;return s==="kg"||s==="l."?r=t.toFixed(2).replace(/\.?0+$/,""):r=t.toString(),`${r} ${s}`}function $p(n,e,t){if(e==="au goÃ»t")return{quantity:n,unit:e,formatted:`${n} ${e}`,formattedNumber:`${n}`};const s=n*t,{q:r,u:o}=sd(s,e),i=ac(r,o);let c=`${i}`;return(o==="kg"||o==="l.")&&(c=i.toFixed(2).replace(/\.?0+$/,"")),{quantity:i,unit:o,formatted:`${c} ${o}`,formattedNumber:c}}function sd(n,e){const t=e.toLowerCase().trim();return(t==="gr."||t==="ml")&&n>=1e3?{q:n/1e3,u:t==="gr."?"kg":"l."}:(t==="kg"||t==="l.")&&n<1&&n>0?{q:n*1e3,u:t==="kg"?"gr.":"ml"}:{q:n,u:e}}function Go(n){if(!n?.length)return[];const e=new Map;return n.forEach(({q:t,u:s})=>{if(typeof t=="number"&&!isNaN(t)){const r=e.get(s)||0;e.set(s,r+t)}}),Array.from(e.entries()).map(([t,s])=>({q:s,u:t}))}function rd(n,e){const t=new Map,s=new Map;n.forEach(({q:i,u:c})=>{t.set(c,(t.get(c)||0)+i)}),e.forEach(({q:i,u:c})=>{s.set(c,(s.get(c)||0)+i)});const r=[],o=new Set([...t.keys(),...s.keys()]);for(const i of o){const c=t.get(i)||0,l=s.get(i)||0,u=c-l;Math.abs(u)>.001&&r.push({q:u,u:i})}return r}function Qt(n){if(!n?.trim())return null;try{return JSON.parse(n)}catch(e){return console.warn("[ProductsStore] Erreur parsing JSON:",e),null}}function ii(n){return n?.length?n.filter(e=>e.quantity!=null&&e.unit).map(e=>({q:typeof e.quantity=="number"?e.quantity:parseFloat(e.quantity),u:e.unit})).filter(e=>!isNaN(e.q)):[]}function ai(n){if(!n?.length)return[];const e=new Map;return n.forEach(t=>{if(!t.q||!t.u||typeof t.q!="number"||isNaN(t.q))return;const s=e.get(t.u)||0;e.set(t.u,s+t.q)}),Array.from(e.entries()).map(([t,s])=>({q:s,u:t}))}function vo(n,e){if(!n?.length)return{numeric:[],display:"â Complet"};if(!e?.length){const c=n.map(l=>cn(l.q,l.u)).join(" et ");return{numeric:n,display:c}}const t=new Map,s=new Map;n.forEach(c=>{const l=parseFloat(c.q);isNaN(l)||t.set(c.u,(t.get(c.u)||0)+l)}),e.forEach(c=>{s.set(c.u,(s.get(c.u)||0)+c.q)});const r=[],o=[];t.forEach((c,l)=>{const u=s.get(l)||0,d=c-u;d>0&&(r.push({q:d,u:l}),o.push(cn(d,l)))});const i=o.length>0?o.join(" et "):"â Complet";return{numeric:r,display:i}}function od(n){return n?Object.values(n).some(e=>e.recipes?.some(t=>t.q!==void 0||t.u!==void 0)):!1}function Mp(n){if(!n)return[];const e=[];return Object.entries(n).forEach(([t,s])=>{s.recipes?.forEach(r=>{e.push({...r,date:t,dateTimeService:t})})}),e}function id(n){if(!n?.length)return"ÃquilibrÃ©";const e=n.filter(s=>s.q>0),t=n.filter(s=>s.q<0);if(e.length>0&&t.length>0){const s=e.map(o=>cn(o.q,o.u)).join(" et "),r=t.map(o=>cn(Math.abs(o.q),o.u)).join(" et ");return`${s} disponibles, ${r} manquant${t.length>1?"s":""}`}else return e.length>0?e.map(s=>"+"+cn(s.q,s.u)).join(" et ")+" disponibles":t.length>0?t.map(s=>cn(Math.abs(s.q),s.u)).join(" et ")+` manquant${t.length>1?"s":""}`:"ÃquilibrÃ©"}function ad(n,e){if(e.searchQuery.trim()){const s=e.searchQuery.toLowerCase();if(!n.productName.toLowerCase().includes(s))return!1}if(e.selectedStores.length>0&&(!n.storeInfo?.storeName||!e.selectedStores.includes(n.storeInfo.storeName))||e.selectedWho.length>0&&(!n.who||!n.who.some(s=>e.selectedWho.includes(s)))||e.selectedProductTypes.length>0&&(!n.productType||!e.selectedProductTypes.includes(n.productType)))return!1;const t=e.temperatureFilter;if(t&&t!=="all")switch(t){case"frais":if(!n.pF)return!1;break;case"not-frais":if(n.pF)return!1;break;case"surgele":if(!n.pS)return!1;break;case"not-surgele":if(n.pS)return!1;break}return!0}function cc(n){return n.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function cd(n,e,t=.01){if(!n?.length&&!e?.length)return!0;if(!n?.length||!e?.length)return!1;const s=new Map(n.map(c=>[c.u,c.q])),r=new Map(e.map(c=>[c.u,c.q])),o=Array.from(s.keys()).sort(),i=Array.from(r.keys()).sort();if(o.length!==i.length||!o.every((c,l)=>c===i[l]))return!1;for(const[c,l]of s){const u=r.get(c);if(u===void 0)return!1;const d=Math.abs(l-u),p=Math.max(l,u),h=Math.max(p*t,1);if(d>h)return!1}return!0}function Cp(n){const e=n.totalNeededOverrideParsed;if(!e)return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};if(!(e.totalComputedWhenOverride!==void 0&&e.platesNbWhenOverride!==void 0&&e.recipesNbWhenOverride!==void 0))return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};const s=e.totalComputedWhenOverride,r=n.totalNeededArray,o=e.platesNbWhenOverride,i=n.totalAssiettes,c=e.recipesNbWhenOverride,l=n.nbRecipes,u=!cd(s,r),d=o!==i,p=c!==l,h=u||d||p;return{hasMismatch:h,computedChanged:u,platesChanged:d,recipesChanged:p,details:h?{oldComputed:s,newComputed:r,oldPlates:o,newPlates:i,oldRecipes:c,newRecipes:l}:void 0}}function Wi(n){return{...n,products:n.products?.map(e=>typeof e=="string"?e:e.$id)||[],mainId:n.mainId}}class ci{static normalize(e,t,s=""){const r=t.toLowerCase(),o=s.toLowerCase(),i=r.includes("caf"),c=r.includes("soupe"),l=r.includes("pinc"),u=r.includes("gousse"),d=r.includes("tÃªte"),p=r.includes("unit")||r==="piÃ¨ce"||r==="piece",h=o.includes("sucre"),m=o.includes("sel"),w=o.includes("farine"),E=o.includes("crÃ¨me Ã©paisse")||o.includes("creme epaisse"),S=o==="ail",A=o.includes("oignon"),T=o==="tomate",R=o==="poireau",q=o.includes("aubergine"),O=o==="courgette",L=o==="Ã©chalote"||o==="echalote",U=o==="orange"&&!o.includes("jus"),le=o.includes("citron")&&!o.includes("jus"),Re=o==="concombre",os=o==="levure chimique",Dn=o==="carotte",Ke=o==="betterave rouge",is=o.includes("semoule"),$n=o.includes("poivre"),Dt=o.includes("cacao"),Mn=o.includes("sucre glace"),Ir=o.includes("maizena")||o.includes("maÃ¯zena"),Er=o.includes("bicarbonate"),pi=o.includes("curcuma"),hi=o.includes("cumin"),mi=o.includes("curry"),gi=o.includes("muscade"),wi=o.includes("paprika"),yi=o.includes("miel");let pt=e,Cn=t,Ye=!1,nn="",z="";if(i){Ye=!0;let N="cafe_default";z="ml",h?(N="cafe_sucre",z="gr."):m?(N="cafe_sel",z="gr."):w?(N="cafe_farine",z="gr."):is?(N="cafe_semoule",z="gr."):$n?(N="cafe_poivre",z="gr."):Dt?(N="cafe_cacao",z="gr."):Mn?(N="cafe_sucre_glace",z="gr."):Ir?(N="cafe_maizena",z="gr."):Er?(N="cafe_bicarbonate",z="gr."):pi?(N="cafe_curcuma",z="gr."):hi?(N="cafe_cumin",z="gr."):mi?(N="cafe_curry",z="gr."):gi?(N="cafe_muscade",z="gr."):wi?(N="cafe_paprika",z="gr."):yi?(N="cafe_miel",z="gr."):E&&(N="cafe_creme_epaisse",z="ml"),pt=e*this.CONVERSION_RULES[N],nn=`1 c. Ã  cafÃ© = ${this.CONVERSION_RULES[N]} ${z}`}else if(c){Ye=!0;let N="soupe_default";z="ml",h?(N="soupe_sucre",z="gr."):m?(N="soupe_sel",z="gr."):w?(N="soupe_farine",z="gr."):is?(N="soupe_semoule",z="gr."):$n?(N="soupe_poivre",z="gr."):Dt?(N="soupe_cacao",z="gr."):Mn?(N="soupe_sucre_glace",z="gr."):Ir?(N="soupe_maizena",z="gr."):E?(N="soupe_creme_epaisse",z="ml"):Er?(N="soupe_bicarbonate",z="gr."):pi?(N="soupe_curcuma",z="gr."):hi?(N="soupe_cumin",z="gr."):mi?(N="soupe_curry",z="gr."):gi?(N="soupe_muscade",z="gr."):wi?(N="soupe_paprika",z="gr."):yi&&(N="soupe_miel",z="gr."),pt=e*this.CONVERSION_RULES[N],nn=`1 c. Ã  soupe = ${this.CONVERSION_RULES[N]} ${z}`}else if(l)Ye=!0,z="gr.",pt=e*this.CONVERSION_RULES.pincee,nn="1 pincÃ©e = 0.4 gr.";else if(u&&S)Ye=!0,z="gr.",pt=e*this.CONVERSION_RULES.gousse_ail,nn="1 gousse = 6.5 gr.";else if(d&&S)Ye=!0,z="gr.",pt=e*this.CONVERSION_RULES.tete_ail,nn="1 tÃªte = 80 gr.";else if(p){Ye=!0,z="gr.";let N="";A?N="unite_oignon":S?N="unite_ail":T?N="unite_tomate":R?N="unite_poireau":q?N="unite_aubergine":O?N="unite_courgette":L?N="unite_eshalote":U?N="unite_orange":le?N="unite_citron":Re?N="unite_concombre":os?N="unite_levure_chimique":Dn?N="unite_carotte":Ke?N="unite_betterave_rouge":Ye=!1,Ye&&(pt=e*this.CONVERSION_RULES[N],nn=`1 unitÃ© = ${this.CONVERSION_RULES[N]} gr.`)}return Ye?Cn=z:r==="kg"?(pt=e*1e3,Cn="gr."):r==="l."?(pt=e*1e3,Cn="ml"):r==="gr."?Cn="gr.":r==="ml"&&(Cn="ml"),{quantity:pt,unit:Cn,originalUnit:t,ruleUsed:nn,hasConversion:Ye}}}j(ci,"CONVERSION_RULES",{cafe_sucre:5,cafe_sel:5,cafe_farine:3,cafe_semoule:4,cafe_poivre:2.5,cafe_cacao:2.5,cafe_sucre_glace:3,cafe_maizena:3,cafe_bicarbonate:5,cafe_curcuma:2,cafe_cumin:2,cafe_curry:2,cafe_muscade:2,cafe_paprika:2,cafe_miel:10,cafe_creme_epaisse:5,cafe_default:5,soupe_sucre:15,soupe_sel:15,soupe_farine:10,soupe_semoule:12,soupe_poivre:8,soupe_cacao:8,soupe_sucre_glace:9,soupe_maizena:10,soupe_creme_epaisse:15,soupe_bicarbonate:15,soupe_curcuma:6,soupe_cumin:6,soupe_curry:6,soupe_muscade:7,soupe_paprika:6,soupe_miel:30,soupe_default:15,pincee:.4,gousse_ail:6.5,tete_ail:80,unite_oignon:120,unite_ail:6.5,unite_tomate:120,unite_poireau:150,unite_aubergine:250,unite_courgette:200,unite_eshalote:30,unite_orange:200,unite_citron:100,unite_concombre:200,unite_levure_chimique:11,unite_carotte:125,unite_betterave_rouge:250});const lc=2;function ld(n){const t=new Date(n).getHours();return t>=11&&t<=13?"sun":t>=19&&t<=21?"moon":t>=7&&t<=9?"cloud":null}function ud(n){return{formattedDate:new Date(n).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),timeIcon:ld(n)}}function dd(n){const e={};for(const t of n)e[t]=ud(t);return e}function fd(n,e,t){if(!n.byDate)return{requiredQuantities:[],requiredQuantitiesFormatted:"-",stockBalance:[],availableStockQuantities:[],missingStockQuantities:[],availableStockFormatted:"-",missingStockFormatted:"-",hasAvailableStock:!1,hasMissingStock:!1,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map};const s=new Date(e);s.setHours(0,0,0,0);const r=new Date(t);r.setHours(23,59,59,999);const o=[],i=new Map,c=new Map;let l=0,u=0;for(const[T,R]of Object.entries(n.byDate)){const q=new Date(T);q>=s&&q<=r&&(o.push(T),l+=R.totalAssiettes||0,R.recipes?.length&&(i.set(T,R.recipes),u+=R.recipes.length),R.totalConsolidated&&R.totalConsolidated.forEach(({q:O,u:L})=>{c.set(L,(c.get(L)||0)+O)}))}const d=Array.from(c.entries()).map(([T,R])=>({q:R,u:T})),p=d.length>0?lt(d):"-",h=n.totalNeededOverrideParsed?[n.totalNeededOverrideParsed.totalOverride]:d,m=pd(n,e,t,h),w=m.filter(T=>T.q>0),E=new Date().toISOString().split("T")[0],A=t<E?[]:m.filter(T=>T.q<0);return{requiredQuantities:d,requiredQuantitiesFormatted:p,stockBalance:m,availableStockQuantities:w,missingStockQuantities:A,availableStockFormatted:id(m),missingStockFormatted:lt(A.map(T=>({q:Math.abs(T.q),u:T.u}))),hasAvailableStock:w.length>0,hasMissingStock:A.length>0,totalRecipesInRange:u,totalPortionsInRange:l,datesInSelectedRange:o,recipesByDate:i}}function pd(n,e,t,s){let r=[],o="";n.stockParsed?.dateTime&&n.stockParsed.dateTime<=e&&(r=[{q:parseFloat(n.stockParsed.quantity),u:n.stockParsed.unit}],o=n.stockParsed.dateTime);const i=[];if(n.purchases)for(const u of n.purchases)hd(u,e,t,o)&&i.push({q:u.quantity,u:u.unit});const c=[...r,...i],l=Go(c);return rd(l,s)}function hd(n,e,t,s=""){if(n.status==="cancelled")return!1;const r=n.deliveryDate||n.$createdAt;if(!r)return!1;const o=new Date(t);return o.setHours(o.getHours()+lc),!(o<new Date||r>o.toISOString()||s&&n.$createdAt<s)}function md(n){const e=Qt(n.specs)??null,t=ai(ii(n.purchases??[]));let s=[];e?.quantity&&(s=[e.quantity]);const r=Qt(n.totalNeededOverride),o=r?[r.totalOverride]:s,{numeric:i,display:c}=vo(o,t);let l=Qt(n.stockReel)??null;if(l&&l.quantity&&l.unit){const h=ci.normalize(parseFloat(l.quantity),l.unit);l={...l,quantity:h.quantity,unit:h.unit}}const u=lt(t),d=n.store?Qt(n.store):null,p=l?`${l.quantity} ${l.unit}`:u;return{$id:n.$id,$createdAt:n.$createdAt,$updatedAt:n.$updatedAt,productHugoUuid:n.productHugoUuid||"",productName:n.productName,productType:n.productType||"none",pF:e?.pF??!1,pS:e?.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:n.isSynced,mainId:n.mainId,totalNeededRaw:[],status:n.status,who:n.who,store:n.store,stockReel:n.stockReel,previousNames:n.previousNames,isMerged:n.isMerged,mergedFrom:n.mergedFrom,mergeDate:n.mergeDate,mergeReason:n.mergeReason,mergedInto:n.mergedInto,totalNeededOverride:n.totalNeededOverride,purchases:n.purchases,specs:n.specs,byDate:{},storeInfo:d,stockParsed:l,specsParsed:e,totalNeededArray:s,totalPurchasesArray:t,missingQuantityArray:i,stockOrTotalPurchases:p,displayTotalNeeded:lt(s),displayTotalPurchases:u,displayMissingQuantity:c,totalNeededOverrideParsed:r,displayTotalOverride:r?lt([r.totalOverride]):"",dateDisplayInfo:{}}}function Tr(n,e){const t=n.purchases??e.purchases,s=n.specs??e.specs,r=s?Qt(s):e.specsParsed,o=ai(ii(t??[])),i=lt(o);let c=e.totalNeededArray;!e.productHugoUuid&&r?.quantity&&(c=[r.quantity]);const l=Qt(n.totalNeededOverride??e.totalNeededOverride),u=l?[l.totalOverride]:c,{numeric:d,display:p}=vo(u,o),h=n.stockReel??e.stockReel;let m=h?Qt(h):e.stockParsed;if(m&&m.quantity&&m.unit){const A=ci.normalize(parseFloat(m.quantity),m.unit);m={...m,quantity:A.quantity,unit:A.unit}}const w=n.store??e.store,E=w?Qt(w):e.storeInfo,S=m?`${m.quantity} ${m.unit}`:i;return n.purchases===void 0&&e.purchases?.length&&console.log(`[ProductsStore] Fusion intelligente : prÃ©servation de ${e.purchases.length} purchases pour ${e.productName}`),{...e,$updatedAt:n.$updatedAt,productName:n.productName??e.productName,productType:n.productType??e.productType,isSynced:n.isSynced??e.isSynced,mainId:n.mainId??e.mainId,pF:r?.pF??e.pF,pS:r?.pS??e.pS,status:n.status??e.status,who:n.who??e.who,store:w,stockReel:h,specs:s,purchases:t,previousNames:n.previousNames??e.previousNames,isMerged:n.isMerged??e.isMerged,mergedFrom:n.mergedFrom??e.mergedFrom,mergeDate:n.mergeDate??e.mergeDate,mergeReason:n.mergeReason??e.mergeReason,mergedInto:n.mergedInto??e.mergedInto,totalNeededOverride:n.totalNeededOverride??e.totalNeededOverride,storeInfo:E,stockParsed:m,specsParsed:r,totalNeededArray:c,totalPurchasesArray:o,missingQuantityArray:d,stockOrTotalPurchases:S,displayTotalPurchases:i,displayMissingQuantity:p,displayTotalNeeded:lt(c),totalNeededOverrideParsed:l,displayTotalOverride:l?lt([l.totalOverride]):""}}function gd(n){n.totalPurchasesArray=ai(ii(n.purchases??[]));const e=n.totalNeededOverrideParsed?[n.totalNeededOverrideParsed.totalOverride]:n.totalNeededArray,{numeric:t,display:s}=vo(e,n.totalPurchasesArray);n.missingQuantityArray=t,n.displayMissingQuantity=s}async function Gi(n,e,t){console.log(`[productEnrichment] Calcul pour Ã©vÃ©nement ${n.$id} avec ${n.meals.length} repas`);const s=new Map;for(const o of n.meals)await wd(o,e,s);const r=[];for(const[o,i]of s)r.push(vd(i,t));return console.log(`[productEnrichment] ${r.length} produits calculÃ©s`),r}async function wd(n,e,t){const s=n.date;for(const r of n.recipes){const o=await e(r.recipeUuid);if(!o){console.warn(`[processMeal] Recette ${r.recipeUuid} introuvable`);continue}const i=r.plates/o.plate;for(const c of o.ingredients)yd(c,i,s,t,o.title,r.plates)}}function yd(n,e,t,s,r,o){const i=n.uuid;s.has(i)||s.set(i,{productHugoUuid:i,productName:n.name,productType:n.type,pF:n.pF??!1,pS:n.pS??!1,byDate:{},allergens:new Set(n.allergens||[])});const c=s.get(i),l=n.normalizedUnit==="au goÃ»t"?n.normalizedQuantity:n.normalizedQuantity*e,u=n.normalizedUnit==="au goÃ»t"?n.originalQuantity:n.originalQuantity*e;c.byDate[t]||(c.byDate[t]={quantities:[],recipes:[],totalAssiettes:0});const d=c.byDate[t];d.quantities.push({q:l,u:n.normalizedUnit}),d.recipes.push({r,q:u,u:n.originalUnit,qEq:l,uEq:n.normalizedUnit,a:o}),d.totalAssiettes+=o,n.allergens&&n.allergens.forEach(p=>c.allergens.add(p))}function vd(n,e){const t=cc(n.productName).substring(0,20),s=e.slice(-10),r=`${t}_${s}`,o={};for(const[A,T]of Object.entries(n.byDate))o[A]={totalConsolidated:Go(T.quantities),recipes:T.recipes,totalAssiettes:T.totalAssiettes,recipeCount:T.recipes.length};const i=Object.values(o).flatMap(A=>A.totalConsolidated),c=Go(i),l=[],u=[],d=c,{numeric:p,display:h}=vo(d,l),m=Object.values(o).reduce((A,T)=>A+T.recipeCount,0),w=Object.values(o).reduce((A,T)=>A+T.totalAssiettes,0),E=dd(Object.keys(o));return{$id:r,mainId:e,productHugoUuid:n.productHugoUuid,productName:n.productName,productType:n.productType,byDate:o,totalNeededArray:c,totalPurchasesArray:l,missingQuantityArray:p,displayTotalNeeded:lt(c),displayTotalPurchases:lt(l),displayMissingQuantity:h,isSynced:!1,status:"active",who:[],store:"",storeInfo:null,purchases:u,stockReel:"",stockParsed:null,totalNeededOverride:null,totalNeededOverrideParsed:null,displayTotalOverride:"",stockOrTotalPurchases:"",previousNames:null,isMerged:!1,mergedFrom:[],mergeDate:null,mergeReason:null,mergedInto:null,specs:null,specsParsed:null,pF:n.pF??!1,pS:n.pS??!1,nbRecipes:m,totalAssiettes:w,totalNeededRaw:c,dateDisplayInfo:E,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],$databaseId:"",$tableId:""}}const bd={loading:0,success:2e3,info:3e3,warning:5e3,error:0},Id=2;var te,Sn,uc,Vo;class Ed{constructor(){v(this,Sn);v(this,te,C(ie([])));j(this,"MAX_TOASTS",3)}get toasts(){return[...f(a(this,te))].sort((e,t)=>t.timestamp-e.timestamp)}create(e){const t=e.id||crypto.randomUUID(),s={id:t,state:e.state,message:e.message,timestamp:Date.now(),source:e.source||"user",position:e.position,timeoutId:void 0,autoCloseDelay:e.autoCloseDelay,details:e.details,actions:e.actions||[]};return I(this,Sn,uc).call(this,s),t}update(e,t){const s=f(a(this,te)).findIndex(o=>o.id===e);if(s===-1)return;const r=f(a(this,te))[s];r.timeoutId&&clearTimeout(r.timeoutId),r.loadingTimeoutId&&clearTimeout(r.loadingTimeoutId),f(a(this,te))[s]={...r,state:t.state||r.state,message:t.message||r.message,source:t.source||r.source,position:t.position||r.position,actions:t.actions||r.actions,autoCloseDelay:t.autoCloseDelay!==void 0?t.autoCloseDelay:r.autoCloseDelay,loadingTimeoutId:void 0},I(this,Sn,Vo).call(this,f(a(this,te))[s])}async track(e,t){const s=this.create({id:t.id,state:"loading",message:t.loading,source:"user",position:t.position});try{const r=await e;return this.update(s,{state:"success",message:t.success||"OpÃ©ration rÃ©ussie",autoCloseDelay:t.successDelay}),r}catch(r){throw this.update(s,{state:"error",message:t.error||"Erreur lors de l'opÃ©ration",autoCloseDelay:t.errorDelay}),r}}dismiss(e){const t=f(a(this,te)).findIndex(r=>r.id===e);if(t===-1)return;const s=f(a(this,te))[t];s.timeoutId&&clearTimeout(s.timeoutId),s.loadingTimeoutId&&clearTimeout(s.loadingTimeoutId),f(a(this,te)).splice(t,1)}dismissAll(){f(a(this,te)).forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.loadingTimeoutId&&clearTimeout(e.loadingTimeoutId)}),g(a(this,te),[],!0)}success(e,t){return this.create({state:"success",message:e,details:t?.details,autoCloseDelay:t?.autoCloseDelay,position:t?.position})}error(e,t){return this.create({state:"error",message:e,details:t?.details,autoCloseDelay:t?.autoCloseDelay,position:t?.position})}warning(e,t){return this.create({state:"warning",message:e,source:t?.source||"system",details:t?.details,actions:t?.actions,autoCloseDelay:t?.autoCloseDelay,position:t?.position})}info(e,t){return this.create({state:"info",message:e,source:t?.source||"system",details:t?.details,autoCloseDelay:t?.autoCloseDelay,position:t?.position})}loading(e,t){const r=t?.autoCloseDelay??3e4,o=this.create({state:"loading",message:e,details:t?.details,autoCloseDelay:r,position:t?.position}),i=setTimeout(()=>{this.update(o,{state:"warning",message:"Ãchec, temps expirÃ©",autoCloseDelay:2e3})},r-2e3),c=f(a(this,te)).findIndex(l=>l.id===o);return c!==-1&&(f(a(this,te))[c].loadingTimeoutId=i),o}}te=new WeakMap,Sn=new WeakSet,uc=function(e){const t=f(a(this,te)).findIndex(s=>s.source===e.source);if(t>=0){const s=f(a(this,te))[t];s.timeoutId&&clearTimeout(s.timeoutId),f(a(this,te))[t]=e}else if(f(a(this,te)).length<this.MAX_TOASTS)f(a(this,te)).push(e);else{const s=f(a(this,te))[0];s.timeoutId&&clearTimeout(s.timeoutId),f(a(this,te)).shift(),f(a(this,te)).push(e)}I(this,Sn,Vo).call(this,e)},Vo=function(e){e.timeoutId&&clearTimeout(e.timeoutId);let t;if(e.autoCloseDelay!==void 0)t=e.autoCloseDelay===0?void 0:e.autoCloseDelay;else{const s=bd[e.state];e.source==="realtime-other"&&s>0?t=s*Id:t=s===0?void 0:s}t!==void 0&&(e.timeoutId=setTimeout(()=>{this.dismiss(e.id)},t))};const bt=new Ed;function $o(n,e,t,s){function r(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(d){try{u(s.next(d))}catch(p){i(p)}}function l(d){try{u(s.throw(d))}catch(p){i(p)}}function u(d){d.done?o(d.value):r(d.value).then(c,l)}u((s=s.apply(n,[])).next())})}function Sd(n,e,t,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}class b{constructor(e,t,s){this.method=e,this.attribute=t,s!==void 0&&(Array.isArray(s)?this.values=s:this.values=[s])}toString(){return JSON.stringify({method:this.method,attribute:this.attribute,values:this.values})}}b.equal=(n,e)=>new b("equal",n,e).toString();b.notEqual=(n,e)=>new b("notEqual",n,e).toString();b.lessThan=(n,e)=>new b("lessThan",n,e).toString();b.lessThanEqual=(n,e)=>new b("lessThanEqual",n,e).toString();b.greaterThan=(n,e)=>new b("greaterThan",n,e).toString();b.greaterThanEqual=(n,e)=>new b("greaterThanEqual",n,e).toString();b.isNull=n=>new b("isNull",n).toString();b.isNotNull=n=>new b("isNotNull",n).toString();b.between=(n,e,t)=>new b("between",n,[e,t]).toString();b.startsWith=(n,e)=>new b("startsWith",n,e).toString();b.endsWith=(n,e)=>new b("endsWith",n,e).toString();b.select=n=>new b("select",void 0,n).toString();b.search=(n,e)=>new b("search",n,e).toString();b.orderDesc=n=>new b("orderDesc",n).toString();b.orderAsc=n=>new b("orderAsc",n).toString();b.orderRandom=()=>new b("orderRandom").toString();b.cursorAfter=n=>new b("cursorAfter",void 0,n).toString();b.cursorBefore=n=>new b("cursorBefore",void 0,n).toString();b.limit=n=>new b("limit",void 0,n).toString();b.offset=n=>new b("offset",void 0,n).toString();b.contains=(n,e)=>new b("contains",n,e).toString();b.notContains=(n,e)=>new b("notContains",n,e).toString();b.notSearch=(n,e)=>new b("notSearch",n,e).toString();b.notBetween=(n,e,t)=>new b("notBetween",n,[e,t]).toString();b.notStartsWith=(n,e)=>new b("notStartsWith",n,e).toString();b.notEndsWith=(n,e)=>new b("notEndsWith",n,e).toString();b.createdBefore=n=>b.lessThan("$createdAt",n);b.createdAfter=n=>b.greaterThan("$createdAt",n);b.createdBetween=(n,e)=>b.between("$createdAt",n,e);b.updatedBefore=n=>b.lessThan("$updatedAt",n);b.updatedAfter=n=>b.greaterThan("$updatedAt",n);b.updatedBetween=(n,e)=>b.between("$updatedAt",n,e);b.or=n=>new b("or",void 0,n.map(e=>JSON.parse(e))).toString();b.and=n=>new b("and",void 0,n.map(e=>JSON.parse(e))).toString();b.distanceEqual=(n,e,t,s=!0)=>new b("distanceEqual",n,[[e,t,s]]).toString();b.distanceNotEqual=(n,e,t,s=!0)=>new b("distanceNotEqual",n,[[e,t,s]]).toString();b.distanceGreaterThan=(n,e,t,s=!0)=>new b("distanceGreaterThan",n,[[e,t,s]]).toString();b.distanceLessThan=(n,e,t,s=!0)=>new b("distanceLessThan",n,[[e,t,s]]).toString();b.intersects=(n,e)=>new b("intersects",n,[e]).toString();b.notIntersects=(n,e)=>new b("notIntersects",n,[e]).toString();b.crosses=(n,e)=>new b("crosses",n,[e]).toString();b.notCrosses=(n,e)=>new b("notCrosses",n,[e]).toString();b.overlaps=(n,e)=>new b("overlaps",n,[e]).toString();b.notOverlaps=(n,e)=>new b("notOverlaps",n,[e]).toString();b.touches=(n,e)=>new b("touches",n,[e]).toString();b.notTouches=(n,e)=>new b("notTouches",n,[e]).toString();class y extends Error{constructor(e,t=0,s="",r=""){super(e),this.name="AppwriteException",this.message=e,this.code=t,this.type=s,this.response=r}}class ht{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.4.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var e;(e=this.realtime.socket)===null||e===void 0||e.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var e,t,s;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(e=this.realtime.socket)===null||e===void 0||e.close();return}const r=new URLSearchParams;this.config.project&&r.set("project",this.config.project),this.realtime.channels.forEach(i=>{r.append("channels[]",i)});const o=this.config.endpointRealtime+"/realtime?"+r.toString();(o!==this.realtime.url||!this.realtime.socket||((t=this.realtime.socket)===null||t===void 0?void 0:t.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((s=this.realtime.socket)===null||s===void 0?void 0:s.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=o,this.realtime.socket=new WebSocket(o),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",i=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",i=>{var c,l,u;if(!this.realtime.reconnect||((l=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||l===void 0?void 0:l.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,i.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:e=>{var t,s;try{const r=JSON.parse(e.data);switch(this.realtime.lastMessage=r,r.type){case"connected":let o=this.config.session;if(!o){const l=JSON.parse((t=window.localStorage.getItem("cookieFallback"))!==null&&t!==void 0?t:"{}");o=l?.[`a_session_${this.config.project}`]}const i=r.data;o&&!i.user&&((s=this.realtime.socket)===null||s===void 0||s.send(JSON.stringify({type:"authentication",data:{session:o}})));break;case"event":let c=r.data;if(c?.channels){if(!c.channels.some(u=>this.realtime.channels.has(u)))return;this.realtime.subscriptions.forEach(u=>{c.channels.some(d=>u.channels.includes(d))&&setTimeout(()=>u.callback(c))})}break;case"pong":break;case"error":throw r.data;default:break}}catch(r){console.error(r)}},cleanUp:e=>{this.realtime.channels.forEach(t=>{e.includes(t)&&(Array.from(this.realtime.subscriptions).some(([r,o])=>o.channels.includes(t))||this.realtime.channels.delete(t))})}}}setEndpoint(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new y("Invalid endpoint URL: "+e);return this.config.endpoint=e,this.config.endpointRealtime=e.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){if(!e.startsWith("ws://")&&!e.startsWith("wss://"))throw new y("Invalid realtime endpoint URL: "+e);return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}setSession(e){return this.headers["X-Appwrite-Session"]=e,this.config.session=e,this}setDevKey(e){return this.headers["X-Appwrite-Dev-Key"]=e,this.config.devkey=e,this}subscribe(e,t){let s=typeof e=="string"?[e]:e;s.forEach(o=>this.realtime.channels.add(o));const r=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(r,{channels:s,callback:t}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(r),this.realtime.cleanUp(s),this.realtime.connect()}}prepareRequest(e,t,s={},r={}){if(e=e.toUpperCase(),s=Object.assign({},this.headers,s),typeof window<"u"&&window.localStorage){const i=window.localStorage.getItem("cookieFallback");i&&(s["X-Fallback-Cookies"]=i)}let o={method:e,headers:s};if(s["X-Appwrite-Dev-Key"]===void 0&&(o.credentials="include"),e==="GET")for(const[i,c]of Object.entries(ht.flatten(r)))t.searchParams.append(i,c);else switch(s["content-type"]){case"application/json":o.body=JSON.stringify(r);break;case"multipart/form-data":const i=new FormData;for(const[c,l]of Object.entries(r))if(l instanceof File)i.append(c,l,l.name);else if(Array.isArray(l))for(const u of l)i.append(`${c}[]`,u);else i.append(c,l);o.body=i,delete s["content-type"];break}return{uri:t.toString(),options:o}}chunkedUpload(e,t,s={},r={},o){var i;return $o(this,void 0,void 0,function*(){const[c,l]=(i=Object.entries(r).find(([p,h])=>h instanceof File))!==null&&i!==void 0?i:[];if(!l||!c)throw new Error("File not found in payload");if(l.size<=ht.CHUNK_SIZE)return yield this.call(e,t,s,r);let u=0,d=null;for(;u<l.size;){let p=u+ht.CHUNK_SIZE;p>=l.size&&(p=l.size),s["content-range"]=`bytes ${u}-${p-1}/${l.size}`;const h=l.slice(u,p);let m=Object.assign({},r);m[c]=new File([h],l.name),d=yield this.call(e,t,s,m),o&&typeof o=="function"&&o({$id:d.$id,progress:Math.round(p/l.size*100),sizeUploaded:p,chunksTotal:Math.ceil(l.size/ht.CHUNK_SIZE),chunksUploaded:Math.ceil(p/ht.CHUNK_SIZE)}),d&&d.$id&&(s["x-appwrite-id"]=d.$id),u=p}return d})}ping(){return $o(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(e,t,s={},r={},o="json"){var i,c;return $o(this,void 0,void 0,function*(){const{uri:l,options:u}=this.prepareRequest(e,t,s,r);let d=null;const p=yield fetch(l,u);if(p.type==="opaque")throw new y(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const h=p.headers.get("x-appwrite-warning");if(h&&h.split(";").forEach(w=>console.warn("Warning: "+w)),!((i=p.headers.get("content-type"))===null||i===void 0)&&i.includes("application/json")?d=yield p.json():o==="arrayBuffer"?d=yield p.arrayBuffer():d={message:yield p.text()},400<=p.status){let w="";throw!((c=p.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||o==="arrayBuffer"?w=JSON.stringify(d):w=d?.message,new y(d?.message,p.status,d?.type,w)}const m=p.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&m&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",m)),d})}static flatten(e,t=""){let s={};for(const[r,o]of Object.entries(e)){let i=t?t+"["+r+"]":r;Array.isArray(o)?s=Object.assign(Object.assign({},s),ht.flatten(o,i)):s[i]=o}return s}}ht.CHUNK_SIZE=1024*1024*5;class vs{constructor(e){this.client=e}static flatten(e,t=""){let s={};for(const[r,o]of Object.entries(e)){let i=t?t+"["+r+"]":r;Array.isArray(o)?s=Object.assign(Object.assign({},s),vs.flatten(o,i)):s[i]=o}return s}}vs.CHUNK_SIZE=5*1024*1024;class _d{constructor(e){this.client=e}get(){const e="/account",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}create(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:t[0],password:t[1],name:t[2]};const r=s.userId,o=s.email,i=s.password,c=s.name;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "email"');if(typeof i>"u")throw new y('Missing required parameter: "password"');const l="/account",u={};typeof r<"u"&&(u.userId=r),typeof o<"u"&&(u.email=o),typeof i<"u"&&(u.password=i),typeof c<"u"&&(u.name=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("post",d,p,u)}updateEmail(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:t[0]};const r=s.email,o=s.password;if(typeof r>"u")throw new y('Missing required parameter: "email"');if(typeof o>"u")throw new y('Missing required parameter: "password"');const i="/account/email",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}listIdentities(e,...t){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:t[0]};const r=s.queries,o=s.total,i="/account/identities",c={};typeof r<"u"&&(c.queries=r),typeof o<"u"&&(c.total=o);const l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}deleteIdentity(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={identityId:e};const s=t.identityId;if(typeof s>"u")throw new y('Missing required parameter: "identityId"');const r="/account/identities/{identityId}".replace("{identityId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createJWT(){const e="/account/jwts",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,t)}listLogs(e,...t){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:t[0]};const r=s.queries,o=s.total,i="/account/logs",c={};typeof r<"u"&&(c.queries=r),typeof o<"u"&&(c.total=o);const l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}updateMFA(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={mfa:e};const s=t.mfa;if(typeof s>"u")throw new y('Missing required parameter: "mfa"');const r="/account/mfa",o={};typeof s<"u"&&(o.mfa=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}createMfaAuthenticator(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?t=e||{}:t={type:e};const s=t.type;if(typeof s>"u")throw new y('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createMFAAuthenticator(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?t=e||{}:t={type:e};const s=t.type;if(typeof s>"u")throw new y('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateMfaAuthenticator(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:t[0]};const r=s.type,o=s.otp;if(typeof r>"u")throw new y('Missing required parameter: "type"');if(typeof o>"u")throw new y('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",r),c={};typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAAuthenticator(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:t[0]};const r=s.type,o=s.otp;if(typeof r>"u")throw new y('Missing required parameter: "type"');if(typeof o>"u")throw new y('Missing required parameter: "otp"');const i="/account/mfa/authenticators/{type}".replace("{type}",r),c={};typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deleteMfaAuthenticator(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?t=e||{}:t={type:e};const s=t.type;if(typeof s>"u")throw new y('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}deleteMFAAuthenticator(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?t=e||{}:t={type:e};const s=t.type;if(typeof s>"u")throw new y('Missing required parameter: "type"');const r="/account/mfa/authenticators/{type}".replace("{type}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createMfaChallenge(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?t=e||{}:t={factor:e};const s=t.factor;if(typeof s>"u")throw new y('Missing required parameter: "factor"');const r="/account/mfa/challenge",o={};typeof s<"u"&&(o.factor=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createMFAChallenge(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?t=e||{}:t={factor:e};const s=t.factor;if(typeof s>"u")throw new y('Missing required parameter: "factor"');const r="/account/mfa/challenge",o={};typeof s<"u"&&(o.factor=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateMfaChallenge(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:t[0]};const r=s.challengeId,o=s.otp;if(typeof r>"u")throw new y('Missing required parameter: "challengeId"');if(typeof o>"u")throw new y('Missing required parameter: "otp"');const i="/account/mfa/challenge",c={};typeof r<"u"&&(c.challengeId=r),typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAChallenge(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:t[0]};const r=s.challengeId,o=s.otp;if(typeof r>"u")throw new y('Missing required parameter: "challengeId"');if(typeof o>"u")throw new y('Missing required parameter: "otp"');const i="/account/mfa/challenge",c={};typeof r<"u"&&(c.challengeId=r),typeof o<"u"&&(c.otp=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}listMfaFactors(){const e="/account/mfa/factors",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}listMFAFactors(){const e="/account/mfa/factors",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}getMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}getMFARecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}createMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,t)}createMFARecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,t)}updateMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,t)}updateMFARecoveryCodes(){const e="/account/mfa/recovery-codes",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,t)}updateName(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={name:e};const s=t.name;if(typeof s>"u")throw new y('Missing required parameter: "name"');const r="/account/name",o={};typeof s<"u"&&(o.name=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}updatePassword(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={password:e,oldPassword:t[0]};const r=s.password,o=s.oldPassword;if(typeof r>"u")throw new y('Missing required parameter: "password"');const i="/account/password",c={};typeof r<"u"&&(c.password=r),typeof o<"u"&&(c.oldPassword=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}updatePhone(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={phone:e,password:t[0]};const r=s.phone,o=s.password;if(typeof r>"u")throw new y('Missing required parameter: "phone"');if(typeof o>"u")throw new y('Missing required parameter: "password"');const i="/account/phone",c={};typeof r<"u"&&(c.phone=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}getPrefs(){const e="/account/prefs",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}updatePrefs(e){let t;e&&typeof e=="object"&&!Array.isArray(e)&&"prefs"in e?t=e||{}:t={prefs:e};const s=t.prefs;if(typeof s>"u")throw new y('Missing required parameter: "prefs"');const r="/account/prefs",o={};typeof s<"u"&&(o.prefs=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}createRecovery(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,url:t[0]};const r=s.email,o=s.url;if(typeof r>"u")throw new y('Missing required parameter: "email"');if(typeof o>"u")throw new y('Missing required parameter: "url"');const i="/account/recovery",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.url=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateRecovery(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0],password:t[1]};const r=s.userId,o=s.secret,i=s.password;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');if(typeof i>"u")throw new y('Missing required parameter: "password"');const c="/account/recovery",l={};typeof r<"u"&&(l.userId=r),typeof o<"u"&&(l.secret=o),typeof i<"u"&&(l.password=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("put",u,d,l)}listSessions(){const e="/account/sessions",t={},s=new URL(this.client.config.endpoint+e),r={};return this.client.call("get",s,r,t)}deleteSessions(){const e="/account/sessions",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("delete",s,r,t)}createAnonymousSession(){const e="/account/sessions/anonymous",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,t)}createEmailPasswordSession(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:t[0]};const r=s.email,o=s.password;if(typeof r>"u")throw new y('Missing required parameter: "email"');if(typeof o>"u")throw new y('Missing required parameter: "password"');const i="/account/sessions/email",c={};typeof r<"u"&&(c.email=r),typeof o<"u"&&(c.password=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateMagicURLSession(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/sessions/magic-url",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createOAuth2Session(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:t[0],failure:t[1],scopes:t[2]};const r=s.provider,o=s.success,i=s.failure,c=s.scopes;if(typeof r>"u")throw new y('Missing required parameter: "provider"');const l="/account/sessions/oauth2/{provider}".replace("{provider}",r),u={};typeof o<"u"&&(u.success=o),typeof i<"u"&&(u.failure=i),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[p,h]of Object.entries(vs.flatten(u)))d.searchParams.append(p,h);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}updatePhoneSession(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/sessions/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createSession(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/sessions/token",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}getSession(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={sessionId:e};const s=t.sessionId;if(typeof s>"u")throw new y('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateSession(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={sessionId:e};const s=t.sessionId;if(typeof s>"u")throw new y('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("patch",i,c,o)}deleteSession(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={sessionId:e};const s=t.sessionId;if(typeof s>"u")throw new y('Missing required parameter: "sessionId"');const r="/account/sessions/{sessionId}".replace("{sessionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}updateStatus(){const e="/account/status",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("patch",s,r,t)}createPushTarget(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:t[0],providerId:t[1]};const r=s.targetId,o=s.identifier,i=s.providerId;if(typeof r>"u")throw new y('Missing required parameter: "targetId"');if(typeof o>"u")throw new y('Missing required parameter: "identifier"');const c="/account/targets/push",l={};typeof r<"u"&&(l.targetId=r),typeof o<"u"&&(l.identifier=o),typeof i<"u"&&(l.providerId=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}updatePushTarget(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:t[0]};const r=s.targetId,o=s.identifier;if(typeof r>"u")throw new y('Missing required parameter: "targetId"');if(typeof o>"u")throw new y('Missing required parameter: "identifier"');const i="/account/targets/{targetId}/push".replace("{targetId}",r),c={};typeof o<"u"&&(c.identifier=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deletePushTarget(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={targetId:e};const s=t.targetId;if(typeof s>"u")throw new y('Missing required parameter: "targetId"');const r="/account/targets/{targetId}/push".replace("{targetId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createEmailToken(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:t[0],phrase:t[1]};const r=s.userId,o=s.email,i=s.phrase;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "email"');const c="/account/tokens/email",l={};typeof r<"u"&&(l.userId=r),typeof o<"u"&&(l.email=o),typeof i<"u"&&(l.phrase=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}createMagicURLToken(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:t[0],url:t[1],phrase:t[2]};const r=s.userId,o=s.email,i=s.url,c=s.phrase;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "email"');const l="/account/tokens/magic-url",u={};typeof r<"u"&&(u.userId=r),typeof o<"u"&&(u.email=o),typeof i<"u"&&(u.url=i),typeof c<"u"&&(u.phrase=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("post",d,p,u)}createOAuth2Token(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:t[0],failure:t[1],scopes:t[2]};const r=s.provider,o=s.success,i=s.failure,c=s.scopes;if(typeof r>"u")throw new y('Missing required parameter: "provider"');const l="/account/tokens/oauth2/{provider}".replace("{provider}",r),u={};typeof o<"u"&&(u.success=o),typeof i<"u"&&(u.failure=i),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[p,h]of Object.entries(vs.flatten(u)))d.searchParams.append(p,h);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}createPhoneToken(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,phone:t[0]};const r=s.userId,o=s.phone;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "phone"');const i="/account/tokens/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.phone=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}createEmailVerification(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={url:e};const s=t.url;if(typeof s>"u")throw new y('Missing required parameter: "url"');const r="/account/verifications/email",o={};typeof s<"u"&&(o.url=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}createVerification(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={url:e};const s=t.url;if(typeof s>"u")throw new y('Missing required parameter: "url"');const r="/account/verifications/email",o={};typeof s<"u"&&(o.url=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}updateEmailVerification(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/verifications/email",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateVerification(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/verifications/email",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createPhoneVerification(){const e="/account/verifications/phone",t={},s=new URL(this.client.config.endpoint+e),r={"content-type":"application/json"};return this.client.call("post",s,r,t)}updatePhoneVerification(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:t[0]};const r=s.userId,o=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "userId"');if(typeof o>"u")throw new y('Missing required parameter: "secret"');const i="/account/verifications/phone",c={};typeof r<"u"&&(c.userId=r),typeof o<"u"&&(c.secret=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}class Rd{constructor(e){this.client=e}listTransactions(e){let t;!e||e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={queries:e};const s=t.queries,r="/databases/transactions",o={};typeof s<"u"&&(o.queries=s);const i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}createTransaction(e){let t;!e||e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={ttl:e};const s=t.ttl,r="/databases/transactions",o={};typeof s<"u"&&(o.ttl=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}getTransaction(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={transactionId:e};const s=t.transactionId;if(typeof s>"u")throw new y('Missing required parameter: "transactionId"');const r="/databases/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateTransaction(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:t[0],rollback:t[1]};const r=s.transactionId,o=s.commit,i=s.rollback;if(typeof r>"u")throw new y('Missing required parameter: "transactionId"');const c="/databases/transactions/{transactionId}".replace("{transactionId}",r),l={};typeof o<"u"&&(l.commit=o),typeof i<"u"&&(l.rollback=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={transactionId:e};const s=t.transactionId;if(typeof s>"u")throw new y('Missing required parameter: "transactionId"');const r="/databases/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createOperations(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:t[0]};const r=s.transactionId,o=s.operations;if(typeof r>"u")throw new y('Missing required parameter: "transactionId"');const i="/databases/transactions/{transactionId}/operations".replace("{transactionId}",r),c={};typeof o<"u"&&(c.operations=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listDocuments(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],queries:t[1],transactionId:t[2],total:t[3]};const r=s.databaseId,o=s.collectionId,i=s.queries,c=s.transactionId,l=s.total;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');const u="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",r).replace("{collectionId}",o),d={};typeof i<"u"&&(d.queries=i),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}createDocument(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');if(typeof c>"u")throw new y('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",r).replace("{collectionId}",o),p={};typeof i<"u"&&(p.documentId=i),typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",h,m,p)}getDocument(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],queries:t[2],transactionId:t[3]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.queries,l=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');const u="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}upsertDocument(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');if(typeof c>"u")throw new y('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",h,m,p)}updateDocument(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",h,m,p)}deleteDocument(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],transactionId:t[2]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');const l="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("delete",d,p,u)}decrementDocumentAttribute(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],attribute:t[2],value:t[3],min:t[4],transactionId:t[5]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.attribute,l=s.value,u=s.min,d=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');if(typeof c>"u")throw new y('Missing required parameter: "attribute"');const p="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/decrement".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i).replace("{attribute}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.min=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("patch",m,w,h)}incrementDocumentAttribute(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:t[0],documentId:t[1],attribute:t[2],value:t[3],max:t[4],transactionId:t[5]};const r=s.databaseId,o=s.collectionId,i=s.documentId,c=s.attribute,l=s.value,u=s.max,d=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "collectionId"');if(typeof i>"u")throw new y('Missing required parameter: "documentId"');if(typeof c>"u")throw new y('Missing required parameter: "attribute"');const p="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/increment".replace("{databaseId}",r).replace("{collectionId}",o).replace("{documentId}",i).replace("{attribute}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.max=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("patch",m,w,h)}}class Ad{constructor(e){this.client=e}listExecutions(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,queries:t[0],total:t[1]};const r=s.functionId,o=s.queries,i=s.total;if(typeof r>"u")throw new y('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",r),l={};typeof o<"u"&&(l.queries=o),typeof i<"u"&&(l.total=i);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}createExecution(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,body:t[0],async:t[1],xpath:t[2],method:t[3],headers:t[4],scheduledAt:t[5]};const r=s.functionId,o=s.body,i=s.async,c=s.xpath,l=s.method,u=s.headers,d=s.scheduledAt;if(typeof r>"u")throw new y('Missing required parameter: "functionId"');const p="/functions/{functionId}/executions".replace("{functionId}",r),h={};typeof o<"u"&&(h.body=o),typeof i<"u"&&(h.async=i),typeof c<"u"&&(h.path=c),typeof l<"u"&&(h.method=l),typeof u<"u"&&(h.headers=u),typeof d<"u"&&(h.scheduledAt=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("post",m,w,h)}getExecution(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,executionId:t[0]};const r=s.functionId,o=s.executionId;if(typeof r>"u")throw new y('Missing required parameter: "functionId"');if(typeof o>"u")throw new y('Missing required parameter: "executionId"');const i="/functions/{functionId}/executions/{executionId}".replace("{functionId}",r).replace("{executionId}",o),c={},l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}}class Td{constructor(e){this.client=e}listTransactions(e){let t;!e||e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={queries:e};const s=t.queries,r="/tablesdb/transactions",o={};typeof s<"u"&&(o.queries=s);const i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}createTransaction(e){let t;!e||e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={ttl:e};const s=t.ttl,r="/tablesdb/transactions",o={};typeof s<"u"&&(o.ttl=s);const i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("post",i,c,o)}getTransaction(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={transactionId:e};const s=t.transactionId;if(typeof s>"u")throw new y('Missing required parameter: "transactionId"');const r="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateTransaction(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:t[0],rollback:t[1]};const r=s.transactionId,o=s.commit,i=s.rollback;if(typeof r>"u")throw new y('Missing required parameter: "transactionId"');const c="/tablesdb/transactions/{transactionId}".replace("{transactionId}",r),l={};typeof o<"u"&&(l.commit=o),typeof i<"u"&&(l.rollback=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={transactionId:e};const s=t.transactionId;if(typeof s>"u")throw new y('Missing required parameter: "transactionId"');const r="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}createOperations(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:t[0]};const r=s.transactionId,o=s.operations;if(typeof r>"u")throw new y('Missing required parameter: "transactionId"');const i="/tablesdb/transactions/{transactionId}/operations".replace("{transactionId}",r),c={};typeof o<"u"&&(c.operations=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listRows(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],queries:t[1],transactionId:t[2],total:t[3]};const r=s.databaseId,o=s.tableId,i=s.queries,c=s.transactionId,l=s.total;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",r).replace("{tableId}",o),d={};typeof i<"u"&&(d.queries=i),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}createRow(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');if(typeof c>"u")throw new y('Missing required parameter: "data"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",r).replace("{tableId}",o),p={};typeof i<"u"&&(p.rowId=i),typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",h,m,p)}getRow(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],queries:t[2],transactionId:t[3]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.queries,l=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const p=new URL(this.client.config.endpoint+u),h={};return this.client.call("get",p,h,d)}upsertRow(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",h,m,p)}updateRow(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],data:t[2],permissions:t[3],transactionId:t[4]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),p={};typeof c<"u"&&(p.data=c),typeof l<"u"&&(p.permissions=l),typeof u<"u"&&(p.transactionId=u);const h=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",h,m,p)}deleteRow(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],transactionId:t[2]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');const l="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("delete",d,p,u)}decrementRowColumn(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],column:t[2],value:t[3],min:t[4],transactionId:t[5]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.column,l=s.value,u=s.min,d=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');if(typeof c>"u")throw new y('Missing required parameter: "column"');const p="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/decrement".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i).replace("{column}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.min=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("patch",m,w,h)}incrementRowColumn(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:t[0],rowId:t[1],column:t[2],value:t[3],max:t[4],transactionId:t[5]};const r=s.databaseId,o=s.tableId,i=s.rowId,c=s.column,l=s.value,u=s.max,d=s.transactionId;if(typeof r>"u")throw new y('Missing required parameter: "databaseId"');if(typeof o>"u")throw new y('Missing required parameter: "tableId"');if(typeof i>"u")throw new y('Missing required parameter: "rowId"');if(typeof c>"u")throw new y('Missing required parameter: "column"');const p="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/increment".replace("{databaseId}",r).replace("{tableId}",o).replace("{rowId}",i).replace("{column}",c),h={};typeof l<"u"&&(h.value=l),typeof u<"u"&&(h.max=u),typeof d<"u"&&(h.transactionId=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("patch",m,w,h)}}class Pd{constructor(e){this.client=e}list(e,...t){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,search:t[0],total:t[1]};const r=s.queries,o=s.search,i=s.total,c="/teams",l={};typeof r<"u"&&(l.queries=r),typeof o<"u"&&(l.search=o),typeof i<"u"&&(l.total=i);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}create(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:t[0],roles:t[1]};const r=s.teamId,o=s.name,i=s.roles;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "name"');const c="/teams",l={};typeof r<"u"&&(l.teamId=r),typeof o<"u"&&(l.name=o),typeof i<"u"&&(l.roles=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}get(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={teamId:e};const s=t.teamId;if(typeof s>"u")throw new y('Missing required parameter: "teamId"');const r="/teams/{teamId}".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updateName(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:t[0]};const r=s.teamId,o=s.name;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "name"');const i="/teams/{teamId}".replace("{teamId}",r),c={};typeof o<"u"&&(c.name=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}delete(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={teamId:e};const s=t.teamId;if(typeof s>"u")throw new y('Missing required parameter: "teamId"');const r="/teams/{teamId}".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={"content-type":"application/json"};return this.client.call("delete",i,c,o)}listMemberships(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,queries:t[0],search:t[1],total:t[2]};const r=s.teamId,o=s.queries,i=s.search,c=s.total;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');const l="/teams/{teamId}/memberships".replace("{teamId}",r),u={};typeof o<"u"&&(u.queries=o),typeof i<"u"&&(u.search=i),typeof c<"u"&&(u.total=c);const d=new URL(this.client.config.endpoint+l),p={};return this.client.call("get",d,p,u)}createMembership(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,roles:t[0],email:t[1],userId:t[2],phone:t[3],url:t[4],name:t[5]};const r=s.teamId,o=s.roles,i=s.email,c=s.userId,l=s.phone,u=s.url,d=s.name;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "roles"');const p="/teams/{teamId}/memberships".replace("{teamId}",r),h={};typeof i<"u"&&(h.email=i),typeof c<"u"&&(h.userId=c),typeof l<"u"&&(h.phone=l),typeof o<"u"&&(h.roles=o),typeof u<"u"&&(h.url=u),typeof d<"u"&&(h.name=d);const m=new URL(this.client.config.endpoint+p),w={"content-type":"application/json"};return this.client.call("post",m,w,h)}getMembership(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:t[0]};const r=s.teamId,o=s.membershipId;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "membershipId"');const i="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),c={},l=new URL(this.client.config.endpoint+i),u={};return this.client.call("get",l,u,c)}updateMembership(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:t[0],roles:t[1]};const r=s.teamId,o=s.membershipId,i=s.roles;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "membershipId"');if(typeof i>"u")throw new y('Missing required parameter: "roles"');const c="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),l={};typeof i<"u"&&(l.roles=i);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteMembership(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:t[0]};const r=s.teamId,o=s.membershipId;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "membershipId"');const i="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",r).replace("{membershipId}",o),c={},l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("delete",l,u,c)}updateMembershipStatus(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:t[0],userId:t[1],secret:t[2]};const r=s.teamId,o=s.membershipId,i=s.userId,c=s.secret;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "membershipId"');if(typeof i>"u")throw new y('Missing required parameter: "userId"');if(typeof c>"u")throw new y('Missing required parameter: "secret"');const l="/teams/{teamId}/memberships/{membershipId}/status".replace("{teamId}",r).replace("{membershipId}",o),u={};typeof i<"u"&&(u.userId=i),typeof c<"u"&&(u.secret=c);const d=new URL(this.client.config.endpoint+l),p={"content-type":"application/json"};return this.client.call("patch",d,p,u)}getPrefs(e){let t;e&&typeof e=="object"&&!Array.isArray(e)?t=e||{}:t={teamId:e};const s=t.teamId;if(typeof s>"u")throw new y('Missing required parameter: "teamId"');const r="/teams/{teamId}/prefs".replace("{teamId}",s),o={},i=new URL(this.client.config.endpoint+r),c={};return this.client.call("get",i,c,o)}updatePrefs(e,...t){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,prefs:t[0]};const r=s.teamId,o=s.prefs;if(typeof r>"u")throw new y('Missing required parameter: "teamId"');if(typeof o>"u")throw new y('Missing required parameter: "prefs"');const i="/teams/{teamId}/prefs".replace("{teamId}",r),c={};typeof o<"u"&&(c.prefs=o);const l=new URL(this.client.config.endpoint+i),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}var Vi;(function(n){n[n.NORMAL_CLOSURE=1e3]="NORMAL_CLOSURE",n[n.POLICY_VIOLATION=1008]="POLICY_VIOLATION",n[n.UNKNOWN_ERROR=-1]="UNKNOWN_ERROR"})(Vi||(Vi={}));class J{}J.read=n=>`read("${n}")`;J.write=n=>`write("${n}")`;J.create=n=>`create("${n}")`;J.update=n=>`update("${n}")`;J.delete=n=>`delete("${n}")`;class ee{static any(){return"any"}static user(e,t=""){return t===""?`user:${e}`:`user:${e}/${t}`}static users(e=""){return e===""?"users":`users/${e}`}static guests(){return"guests"}static team(e,t=""){return t===""?`team:${e}`:`team:${e}/${t}`}static member(e){return`member:${e}`}static label(e){return`label:${e}`}}var dc,fc;class ke{static custom(e){return e}static unique(e=7){const t=Sd(ke,dc,"m",fc).call(ke);let s="";for(let r=0;r<e;r++){const o=Math.floor(Math.random()*16).toString(16);s+=o}return t+s}}dc=ke,fc=function(){const e=new Date,t=Math.floor(e.getTime()/1e3),s=e.getMilliseconds();return t.toString(16)+s.toString(16).padStart(5,"0")};var Qi;(function(n){n.Equal="equal",n.NotEqual="notEqual",n.GreaterThan="greaterThan",n.GreaterThanEqual="greaterThanEqual",n.LessThan="lessThan",n.LessThanEqual="lessThanEqual",n.Contains="contains",n.IsNull="isNull",n.IsNotNull="isNotNull"})(Qi||(Qi={}));var Ji;(function(n){n.Totp="totp"})(Ji||(Ji={}));var Ki;(function(n){n.Email="email",n.Phone="phone",n.Totp="totp",n.Recoverycode="recoverycode"})(Ki||(Ki={}));var Yi;(function(n){n.Amazon="amazon",n.Apple="apple",n.Auth0="auth0",n.Authentik="authentik",n.Autodesk="autodesk",n.Bitbucket="bitbucket",n.Bitly="bitly",n.Box="box",n.Dailymotion="dailymotion",n.Discord="discord",n.Disqus="disqus",n.Dropbox="dropbox",n.Etsy="etsy",n.Facebook="facebook",n.Figma="figma",n.Github="github",n.Gitlab="gitlab",n.Google="google",n.Linkedin="linkedin",n.Microsoft="microsoft",n.Notion="notion",n.Oidc="oidc",n.Okta="okta",n.Paypal="paypal",n.PaypalSandbox="paypalSandbox",n.Podio="podio",n.Salesforce="salesforce",n.Slack="slack",n.Spotify="spotify",n.Stripe="stripe",n.Tradeshift="tradeshift",n.TradeshiftBox="tradeshiftBox",n.Twitch="twitch",n.Wordpress="wordpress",n.Yahoo="yahoo",n.Yammer="yammer",n.Yandex="yandex",n.Zoho="zoho",n.Zoom="zoom",n.Mock="mock"})(Yi||(Yi={}));var Xi;(function(n){n.AvantBrowser="aa",n.AndroidWebViewBeta="an",n.GoogleChrome="ch",n.GoogleChromeIOS="ci",n.GoogleChromeMobile="cm",n.Chromium="cr",n.MozillaFirefox="ff",n.Safari="sf",n.MobileSafari="mf",n.MicrosoftEdge="ps",n.MicrosoftEdgeIOS="oi",n.OperaMini="om",n.Opera="op",n.OperaNext="on"})(Xi||(Xi={}));var Zi;(function(n){n.AmericanExpress="amex",n.Argencard="argencard",n.Cabal="cabal",n.Cencosud="cencosud",n.DinersClub="diners",n.Discover="discover",n.Elo="elo",n.Hipercard="hipercard",n.JCB="jcb",n.Mastercard="mastercard",n.Naranja="naranja",n.TarjetaShopping="targeta-shopping",n.UnionPay="unionpay",n.Visa="visa",n.MIR="mir",n.Maestro="maestro",n.Rupay="rupay"})(Zi||(Zi={}));var Fi;(function(n){n.Afghanistan="af",n.Angola="ao",n.Albania="al",n.Andorra="ad",n.UnitedArabEmirates="ae",n.Argentina="ar",n.Armenia="am",n.AntiguaAndBarbuda="ag",n.Australia="au",n.Austria="at",n.Azerbaijan="az",n.Burundi="bi",n.Belgium="be",n.Benin="bj",n.BurkinaFaso="bf",n.Bangladesh="bd",n.Bulgaria="bg",n.Bahrain="bh",n.Bahamas="bs",n.BosniaAndHerzegovina="ba",n.Belarus="by",n.Belize="bz",n.Bolivia="bo",n.Brazil="br",n.Barbados="bb",n.BruneiDarussalam="bn",n.Bhutan="bt",n.Botswana="bw",n.CentralAfricanRepublic="cf",n.Canada="ca",n.Switzerland="ch",n.Chile="cl",n.China="cn",n.CoteDIvoire="ci",n.Cameroon="cm",n.DemocraticRepublicOfTheCongo="cd",n.RepublicOfTheCongo="cg",n.Colombia="co",n.Comoros="km",n.CapeVerde="cv",n.CostaRica="cr",n.Cuba="cu",n.Cyprus="cy",n.CzechRepublic="cz",n.Germany="de",n.Djibouti="dj",n.Dominica="dm",n.Denmark="dk",n.DominicanRepublic="do",n.Algeria="dz",n.Ecuador="ec",n.Egypt="eg",n.Eritrea="er",n.Spain="es",n.Estonia="ee",n.Ethiopia="et",n.Finland="fi",n.Fiji="fj",n.France="fr",n.MicronesiaFederatedStatesOf="fm",n.Gabon="ga",n.UnitedKingdom="gb",n.Georgia="ge",n.Ghana="gh",n.Guinea="gn",n.Gambia="gm",n.GuineaBissau="gw",n.EquatorialGuinea="gq",n.Greece="gr",n.Grenada="gd",n.Guatemala="gt",n.Guyana="gy",n.Honduras="hn",n.Croatia="hr",n.Haiti="ht",n.Hungary="hu",n.Indonesia="id",n.India="in",n.Ireland="ie",n.IranIslamicRepublicOf="ir",n.Iraq="iq",n.Iceland="is",n.Israel="il",n.Italy="it",n.Jamaica="jm",n.Jordan="jo",n.Japan="jp",n.Kazakhstan="kz",n.Kenya="ke",n.Kyrgyzstan="kg",n.Cambodia="kh",n.Kiribati="ki",n.SaintKittsAndNevis="kn",n.SouthKorea="kr",n.Kuwait="kw",n.LaoPeopleSDemocraticRepublic="la",n.Lebanon="lb",n.Liberia="lr",n.Libya="ly",n.SaintLucia="lc",n.Liechtenstein="li",n.SriLanka="lk",n.Lesotho="ls",n.Lithuania="lt",n.Luxembourg="lu",n.Latvia="lv",n.Morocco="ma",n.Monaco="mc",n.Moldova="md",n.Madagascar="mg",n.Maldives="mv",n.Mexico="mx",n.MarshallIslands="mh",n.NorthMacedonia="mk",n.Mali="ml",n.Malta="mt",n.Myanmar="mm",n.Montenegro="me",n.Mongolia="mn",n.Mozambique="mz",n.Mauritania="mr",n.Mauritius="mu",n.Malawi="mw",n.Malaysia="my",n.Namibia="na",n.Niger="ne",n.Nigeria="ng",n.Nicaragua="ni",n.Netherlands="nl",n.Norway="no",n.Nepal="np",n.Nauru="nr",n.NewZealand="nz",n.Oman="om",n.Pakistan="pk",n.Panama="pa",n.Peru="pe",n.Philippines="ph",n.Palau="pw",n.PapuaNewGuinea="pg",n.Poland="pl",n.FrenchPolynesia="pf",n.NorthKorea="kp",n.Portugal="pt",n.Paraguay="py",n.Qatar="qa",n.Romania="ro",n.Russia="ru",n.Rwanda="rw",n.SaudiArabia="sa",n.Sudan="sd",n.Senegal="sn",n.Singapore="sg",n.SolomonIslands="sb",n.SierraLeone="sl",n.ElSalvador="sv",n.SanMarino="sm",n.Somalia="so",n.Serbia="rs",n.SouthSudan="ss",n.SaoTomeAndPrincipe="st",n.Suriname="sr",n.Slovakia="sk",n.Slovenia="si",n.Sweden="se",n.Eswatini="sz",n.Seychelles="sc",n.Syria="sy",n.Chad="td",n.Togo="tg",n.Thailand="th",n.Tajikistan="tj",n.Turkmenistan="tm",n.TimorLeste="tl",n.Tonga="to",n.TrinidadAndTobago="tt",n.Tunisia="tn",n.Turkey="tr",n.Tuvalu="tv",n.Tanzania="tz",n.Uganda="ug",n.Ukraine="ua",n.Uruguay="uy",n.UnitedStates="us",n.Uzbekistan="uz",n.VaticanCity="va",n.SaintVincentAndTheGrenadines="vc",n.Venezuela="ve",n.Vietnam="vn",n.Vanuatu="vu",n.Samoa="ws",n.Yemen="ye",n.SouthAfrica="za",n.Zambia="zm",n.Zimbabwe="zw"})(Fi||(Fi={}));var bs;(function(n){n.GET="GET",n.POST="POST",n.PUT="PUT",n.PATCH="PATCH",n.DELETE="DELETE",n.OPTIONS="OPTIONS",n.HEAD="HEAD"})(bs||(bs={}));var ea;(function(n){n.Center="center",n.Topleft="top-left",n.Top="top",n.Topright="top-right",n.Left="left",n.Right="right",n.Bottomleft="bottom-left",n.Bottom="bottom",n.Bottomright="bottom-right"})(ea||(ea={}));var ta;(function(n){n.Jpg="jpg",n.Jpeg="jpeg",n.Png="png",n.Webp="webp",n.Heic="heic",n.Avif="avif",n.Gif="gif"})(ta||(ta={}));var na;(function(n){n.Http="http",n.Schedule="schedule",n.Event="event"})(na||(na={}));var sa;(function(n){n.Waiting="waiting",n.Processing="processing",n.Completed="completed",n.Failed="failed",n.Scheduled="scheduled"})(sa||(sa={}));const Ce={endpoint:"https://aw.oupla.net/v1",projectId:"696b7acb0037bde79e3f",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3",usersTeamsManager:"692cb2cd000cbb24549c",enkaData:"68f00487000c624533a3"},collections:{events:"main",ingredients:"ingredients",main:"main",purchases:"purchases",products:"products",kteams:"kteams",locks:"locks",user_notifications:"user_notifications",materiel_loan:"materiel_loan",teamdocs:"teamdocs"}};let fs=null;async function D(){if(fs)return fs;console.log("[appwrite] Initialisation des instances Appwrite...");const n=new ht().setEndpoint(Ce.endpoint).setProject(Ce.projectId),e=new _d(n),t=new Rd(n),s=new Td(n),r=new Ad(n),o=new Pd(n);return fs={client:n,account:e,databases:t,tables:s,functions:r,teams:o,config:Ce},console.log("[appwrite] Instances initialisÃ©es avec succÃ¨s"),fs}function Dd(){console.log("[appwrite] Cache rÃ©initialisÃ©"),fs=null}function ss(){return{APPWRITE_ENDPOINT:Ce.endpoint,APPWRITE_PROJECT_ID:Ce.projectId,APPWRITE_DATABASE_ID:Ce.databaseId,APPWRITE_FUNCTION_ID:Ce.functions.batchUpdate,ACCESS_REQUEST_FUNCTION_ID:Ce.functions.accessRequest,MANAGE_RECIPE_FUNCTION_ID:Ce.functions.enkaData,APPWRITE_CONFIG:Ce}}function Ct(){return Ce.databaseId}function on(n){return Ce.collections[n]}function li(n){return Ce.functions[n]}function pc(n,e){const{operationName:t,maxAutoRetries:s=1,autoRetryDelay:r=1e3}=e;let o=1;return new Promise((i,c)=>{const l=async()=>{try{console.log(`[RetryUtils] ${t} - Tentative ${o}/${s+1}`);const u=await n();console.log(`[RetryUtils] ${t} - SuccÃ¨s`),e.onSuccess?.(u),i(u)}catch(u){if(console.error(`[RetryUtils] Erreur ${t} (Tentative ${o}):`,u),u instanceof Error&&u.message,o<=s){o++,console.log(`[RetryUtils] Nouvelle tentative dans ${r/1e3}s...`),setTimeout(()=>l(),r);return}console.error(`[RetryUtils] ${t} - Ãchec aprÃ¨s ${o} tentatives`),e.onError?.(u),c(u)}};l()})}async function ft(n,e={}){const{maxAttempts:t=3,timeout:s=1e4,context:r="Operation",successMessage:o,errorMessage:i,retryDelay:c=1e3,silent:l=!1}=e;let u=null;for(let d=1;d<=t;d++)try{console.log(`[${r}] Tentative ${d}/${t}`);const p=await Promise.race([n(),$d(s)]);return d>1&&console.log(`[${r}] â SuccÃ¨s aprÃ¨s ${d} tentatives`),o&&!l&&bt.success(o),p}catch(p){if(u=p instanceof Error?p:new Error(String(p)),console.error(`[${r}] â Tentative ${d}/${t} Ã©chouÃ©e:`,u.message),d===t)throw console.error(`[${r}] â Ãchec aprÃ¨s ${t} tentatives`),i&&!l&&bt.error(i),u;const h=c*d;console.log(`[${r}] Nouvelle tentative dans ${h}ms...`),await Md(h)}throw u||new Error(`${r}: Ãchec inconnu`)}function $d(n){return new Promise((e,t)=>{setTimeout(()=>{t(new Error(`Timeout aprÃ¨s ${n}ms`))},n)})}function Md(n){return new Promise(e=>setTimeout(e,n))}function hr(n,e={}){const{fallback:t=null,context:s="JSON.parse"}=e;try{return JSON.parse(n)}catch(r){return console.error(`[${s}] â JSON invalide:`,r instanceof Error?r.message:r),t}}function ui(n,e={}){const{context:t="JSON.parseArray",itemFallback:s}=e;return!n||!Array.isArray(n)?(console.warn(`[${t}] Tableau vide ou invalide`),[]):n.map((r,o)=>{const i=hr(r,{context:`${t}[${o}]`,fallback:void 0});return i===void 0&&s?s(r,o):i}).filter(r=>r!==null)}const{APPWRITE_CONFIG:_t}=ss(),Tn="main";async function ra(n,e=null){return ft(async()=>{const{tables:t}=await D(),s=[b.orderDesc("dateStart")];return e&&s.push(b.greaterThanEqual("dateEnd",e)),{events:(await t.listRows({databaseId:_t.databaseId,tableId:Tn,queries:s})).rows}},{context:"AppwriteEvents.listEvents",timeout:2e4,errorMessage:"Erreur lors du chargement des Ã©vÃ©nements"})}async function Cd(n){try{return await ft(async()=>{const{tables:e}=await D();return await e.getRow({databaseId:_t.databaseId,tableId:Tn,rowId:n})},{context:"AppwriteEvents.getEvent",timeout:1e4,errorMessage:"Erreur lors du chargement de l'Ã©vÃ©nement"})}catch(e){if(e.code===404)return null;throw e}}async function Nd(n,e){return ft(async()=>{const{tables:t}=await D(),s=ke.unique(),r=await t.createRow({databaseId:_t.databaseId,tableId:Tn,rowId:s,data:{name:n.name,dateStart:n.dateStart,dateEnd:n.dateEnd,allDates:n.allDates,meals:n.meals?n.meals.map(i=>JSON.stringify(i)):[],createdBy:e,teams:n.teams??[],contributors:n.contributors?n.contributors.map(i=>JSON.stringify(i)):[],todos:n.todos?n.todos.map(i=>JSON.stringify(i)):[]}});console.log(`[appwrite-events] Event created: ${s}`);const{functions:o}=await D();return await o.createExecution({functionId:_t.functions.usersTeamsManager,body:JSON.stringify({action:"add-label-to-user",mainId:s,userId:e}),async:!1}),console.log(`[appwrite-events] Label ${s} attribuÃ© au crÃ©ateur ${e}`),r},{context:"AppwriteEvents.createEvent",timeout:15e3,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function kd(n,e,t=[],s=!0){return ft(async()=>{const{functions:r}=await D(),o={name:n.name,description:n.description||"",dateStart:n.dateStart,dateEnd:n.dateEnd,allDates:n.allDates,meals:n.meals?n.meals.map(d=>JSON.stringify(d)):[],createdBy:e,teams:n.teams||[],teamsId:n.teamsId||[],contributors:n.contributors?n.contributors.map(d=>JSON.stringify(d)):[],todos:n.todos?n.todos.map(d=>JSON.stringify(d)):[],status:n.status||"proposition"};console.log(`[appwrite-events] CrÃ©ation Ã©vÃ©nement avec ${t.length} team(s)`);const i=await r.createExecution({functionId:_t.functions.usersTeamsManager,body:JSON.stringify({action:"create-event-with-teams",eventData:o,creatorId:e,teamIds:t,sendEmailToExistingMembers:s}),async:!1}),c=JSON.parse(i.responseBody);if(!c.success)throw new Error(c.error||"Erreur lors de la crÃ©ation");console.log(`[appwrite-events] ÃvÃ©nement crÃ©Ã© avec teams: ${c.eventId}`);const{tables:l}=await D();return await l.getRow({databaseId:_t.databaseId,tableId:Tn,rowId:c.eventId})},{context:"AppwriteEvents.createEventWithTeams",timeout:3e4,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function oa(n,e){return ft(async()=>{const{tables:t}=await D(),s={...e};e.meals&&(s.meals=e.meals.map(o=>JSON.stringify(o))),e.contributors&&(s.contributors=Array.isArray(e.contributors)?e.contributors.map(o=>JSON.stringify(o)):[]),e.todos&&(s.todos=e.todos.map(o=>JSON.stringify(o))),e.allDates&&(s.allDates=e.allDates);const r=await t.updateRow({databaseId:_t.databaseId,tableId:Tn,rowId:n,data:s});return console.log(`[appwrite-events] Event updated: ${n}`),r},{context:"AppwriteEvents.updateEvent",timeout:1e4,successMessage:"ÃvÃ©nement mis Ã  jour",errorMessage:"Erreur lors de la mise Ã  jour"})}async function qd(n){return ft(async()=>{const{tables:e,functions:t}=await D();await e.deleteRow({databaseId:_t.databaseId,tableId:Tn,rowId:n}),console.log(`[appwrite-events] Event deleted: ${n}`),await t.createExecution({functionId:_t.functions.usersTeamsManager,body:JSON.stringify({action:"delete-event-label",mainId:n}),async:!0}),console.log(`[appwrite-events] Label deletion initiated for event: ${n}`)},{context:"AppwriteEvents.deleteEvent",timeout:1e4,successMessage:"ÃvÃ©nement supprimÃ©",errorMessage:"Erreur lors de la suppression"})}async function jd(){const{teams:n}=await D();return await n.list()}async function Ld(n){const{teams:e}=await D();return await e.get({teamId:n})}async function Ud(n){const{teams:e}=await D();return await e.create({teamId:ke.unique(),name:n})}async function xd(n,e){const{teams:t}=await D();return await t.updateName({teamId:n,name:e})}async function Bd(n){const{teams:e}=await D();await e.delete({teamId:n})}async function Hd(n){const{teams:e}=await D();return await e.listMemberships({teamId:n})}async function Od(n,e){const{teams:t}=await D();await t.deleteMembership({teamId:n,membershipId:e})}async function zd(n,e,t){const{functions:s}=await D(),r=li("usersTeamsManager"),o={action:"native-invite",teamId:n,emails:e,message:t},i=await s.createExecution({functionId:r,body:JSON.stringify(o)});if(i.status!=="completed")throw new Error(`Erreur lors de l'invitation : ${i.errors}`);return JSON.parse(i.responseBody)}async function ia(n,e){const{teams:t}=await D();return await t.updatePrefs({teamId:n,prefs:e})}var st,hn,gt,eo,hc;class Wd{constructor(){v(this,eo);v(this,st,[]);v(this,hn,null);v(this,gt,!1)}register(e,t){a(this,gt)&&console.warn("[RealtimeManager] Enregistrement aprÃ¨s initialisation. Utilisez registerDynamic() pour les inscriptions dynamiques."),a(this,st).push({channels:e,callback:t}),console.log("[RealtimeManager] Channels enregistrÃ©s:",e)}registerDynamic(e,t){return a(this,st).push({channels:e,callback:t}),console.log("[RealtimeManager] Channels dynamiques enregistrÃ©s:",e),a(this,gt)&&I(this,eo,hc).call(this,e,t),()=>{const s=a(this,st).findIndex(r=>r.channels===e&&r.callback===t);s!==-1&&(a(this,st).splice(s,1),console.log("[RealtimeManager] Channels dynamiques dÃ©senregistrÃ©s:",e))}}async initialize(){if(a(this,gt))return;const e=[...new Set(a(this,st).flatMap(t=>t.channels))];if(e.length===0){console.log("[RealtimeManager] Aucun channel Ã  souscrire."),_(this,gt,!0);return}try{console.log(`[RealtimeManager] Initialisation de la connexion unique avec ${e.length} channels...`);const{client:t}=await D();_(this,hn,t.subscribe(e,s=>{for(const r of a(this,st))s.channels.some(i=>r.channels.includes(i))&&r.callback(s)})),_(this,gt,!0),console.log("[RealtimeManager] â Connexion Realtime Ã©tablie.")}catch(t){throw console.error("[RealtimeManager] Erreur lors de l'initialisation:",t),t}}destroy(){a(this,hn)&&(a(this,hn).call(this),_(this,hn,null)),_(this,st,[]),_(this,gt,!1),console.log("[RealtimeManager] Connexion Realtime fermÃ©e.")}}st=new WeakMap,hn=new WeakMap,gt=new WeakMap,eo=new WeakSet,hc=async function(e,t){try{console.log(`[RealtimeManager] Ajout de ${e.length} channels Ã  la connexion existante...`);const{client:s}=await D();s.subscribe(e,r=>{t(r)}),console.log("[RealtimeManager] â Channels dynamiques ajoutÃ©s:",e)}catch(s){console.error("[RealtimeManager] Erreur lors de l'ajout de channels dynamiques:",s)}};const mr=new Wd;var Ie,Lt,mn,wt,Gn,Ts,Yt,qr,mc;class Gd{constructor(){v(this,Yt);v(this,Ie,new Xt);v(this,Lt,C(!1));v(this,mn,C(null));v(this,wt,C(!1));v(this,Gn,!1);v(this,Ts,X(()=>Array.from(a(this,Ie).values())))}get loading(){return f(a(this,Lt))}get error(){return f(a(this,mn))}get isInitialized(){return f(a(this,wt))}get count(){return a(this,Ie).size}get teams(){return f(a(this,Ts))}isUserInAnyTeam(e){return Array.from(a(this,Ie).values()).some(t=>t.members?.some(s=>s.id===e))}get myTeams(){return Q.userId?f(a(this,Ts)):[]}async loadCache(){if(!f(a(this,wt))){if(!Q.userId){g(a(this,wt),!0);return}g(a(this,wt),!0),console.log("[NativeTeamsStore] Cache chargÃ© : 0 Ã©quipes (pas de cache)")}}async syncFromRemote(){g(a(this,Lt),!0),g(a(this,mn),null);try{if(!Q.userId)return;await I(this,Yt,qr).call(this),console.log(`[NativeTeamsStore] Sync terminÃ© : ${a(this,Ie).size} Ã©quipes`)}catch(e){throw g(a(this,mn),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[NativeTeamsStore] SyncFromRemote error:",e),e}finally{g(a(this,Lt),!1)}}async setupRealtime(){if(Q.userId){if(a(this,Gn)){console.log("[NativeTeamsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await I(this,Yt,mc).call(this),_(this,Gn,!0),console.log("[NativeTeamsStore] Realtime configurÃ©")}catch(e){throw g(a(this,mn),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[NativeTeamsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async hardReset(){console.log("[NativeTeamsStore] Hard reset..."),a(this,Ie).clear(),g(a(this,wt),!1),await this.initialize(),console.log("[NativeTeamsStore] Hard reset terminÃ©")}getTeamById(e){return a(this,Ie).get(e)}getTeamMemberNames(e){const t=a(this,Ie).get(e);return!t||!t.members?[]:t.members.map(s=>s.name?s.name:s.userEmail?s.userEmail.split("@")[0]:"Inconnu").filter(Boolean)}async fetchTeam(e){try{const t=await Ld(e),s=await Hd(e),r={$id:t.$id,name:t.name,total:t.total,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,prefs:t.prefs,members:s.memberships.map(o=>({$id:o.$id,id:o.userId,name:o.userName,userEmail:o.userEmail,roles:o.roles,joinedAt:o.joined,confirmed:o.confirm}))};return a(this,Ie).set(e,r),r}catch(t){return console.error(`[NativeTeamsStore] Error fetching team ${e}:`,t),null}}async createTeam(e,t){const s=await Ud(e);t&&Object.keys(t).length>0&&await ia(s.$id,t);const r=await this.fetchTeam(s.$id);if(!r)throw new Error("Erreur aprÃ¨s crÃ©ation d'Ã©quipe");return r}async updateTeam(e,t,s){t&&await xd(e,t),s&&Object.keys(s).length>0&&await ia(e,s),await this.fetchTeam(e)}async deleteTeam(e){await Bd(e),a(this,Ie).delete(e)}async inviteTeamMember(e,t,s){await zd(e,t,s),await this.fetchTeam(e)}async removeMember(e,t){await Od(e,t),await this.fetchTeam(e)}async reload(){g(a(this,Lt),!0);try{a(this,Ie).clear(),await I(this,Yt,qr).call(this)}finally{g(a(this,Lt),!1)}}destroy(){a(this,Ie).clear(),g(a(this,wt),!1),_(this,Gn,!1)}}Ie=new WeakMap,Lt=new WeakMap,mn=new WeakMap,wt=new WeakMap,Gn=new WeakMap,Ts=new WeakMap,Yt=new WeakSet,qr=async function(){const e=await jd();for(const t of e.teams)await this.fetchTeam(t.$id)},mc=async function(){mr.register(["teams","memberships"],async e=>{console.log("[NativeTeamsStore] â¡ï¸ Realtime RECEIVED:",e.events),await I(this,Yt,qr).call(this)})};const $t=new Gd;var Ps,Ds,$s;class Vd{constructor(){j(this,"routes",[]);v(this,Ps,C(""));v(this,Ds,C(ie({})));v(this,$s,C(ie({})));j(this,"currentRouteMatch",null);j(this,"isNavigating",!1);j(this,"dynamicGuards",new Map);j(this,"componentCache",new Map);this.currentPath=this.getHashPath(),this.updateQueryParams(),window.addEventListener("hashchange",()=>{const e=this.getHashPath();this.handleHashChange(e)})}get currentPath(){return f(a(this,Ps))}set currentPath(e){g(a(this,Ps),e,!0)}get currentParams(){return f(a(this,Ds))}set currentParams(e){g(a(this,Ds),e,!0)}get currentQuery(){return f(a(this,$s))}set currentQuery(e){g(a(this,$s),e,!0)}addRoute(e,t,s){this.routes.push({path:e,component:t,guards:s})}registerRouteGuard(e,t){return this.dynamicGuards.set(e,t),()=>{this.dynamicGuards.delete(e)}}async handleHashChange(e){if(this.isNavigating)return;this.updateQueryParams();const t={path:this.currentPath,params:this.currentParams,query:this.currentQuery},s={path:e,params:{},query:this.currentQuery},r=this.dynamicGuards.get(t.path);if(r?.beforeLeave)try{if(!await r.beforeLeave(t,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard dynamique)"),window.location.hash=t.path;return}}catch(i){console.error("[Router] Erreur dans beforeLeave (guard dynamique):",i)}if(this.currentRouteMatch?.guards?.beforeLeave)try{if(!await this.currentRouteMatch.guards.beforeLeave(t,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard statique)"),window.location.hash=t.path;return}}catch(i){console.error("[Router] Erreur dans beforeLeave (guard statique):",i)}const o=await this.findRouteMatch(e);if(!o){this.currentPath=e,this.currentParams={},this.currentRouteMatch=null;return}if(s.params=o.params,o.guards?.beforeEnter)try{if(!await o.guards.beforeEnter(s,t)){console.log("[Router] Navigation annulÃ©e par beforeEnter"),window.location.hash=t.path;return}}catch(i){console.error("[Router] Erreur dans beforeEnter:",i)}this.currentPath=e,this.currentParams=o.params,this.currentRouteMatch=o}async navigate(e,t){if(!this.isNavigating){this.isNavigating=!0;try{const s={path:this.currentPath,params:this.currentParams,query:this.currentQuery},r=await this.findRouteMatch(e),o={path:e,params:r?.params||{},query:t||{}};if(this.currentRouteMatch?.guards?.beforeLeave&&!await this.currentRouteMatch.guards.beforeLeave(s,o)){console.log("[Router] Navigation annulÃ©e par beforeLeave");return}if(r?.guards?.beforeEnter&&!await r.guards.beforeEnter(o,s)){console.log("[Router] Navigation annulÃ©e par beforeEnter");return}const i=t?"?"+new URLSearchParams(t).toString():"",c="#"+(e.startsWith("/")?e:"/"+e)+i;window.location.hash=c}finally{this.isNavigating=!1}}}async findRouteMatch(e){for(const t of this.routes){const s=this.matchRoute(t.path,e);if(s)return{component:await this.resolveComponent(t.path.toString(),t.component),params:s.params,query:this.currentQuery,guards:t.guards}}return null}async resolveComponent(e,t){if(typeof t!="function"||t.length>0)return t;if(this.componentCache.has(e))return this.componentCache.get(e);try{const r=(await t()).default;return this.componentCache.set(e,r),r}catch(s){throw console.error(`[Router] Erreur lors du chargement du composant pour ${e}:`,s),s}}async match(){const e=await this.findRouteMatch(this.currentPath);return e&&(this.currentParams=e.params,this.currentRouteMatch=e),e}matchRoute(e,t){if(e instanceof RegExp){const c=t.match(e);return c?{params:c.groups||{}}:null}const s=[],r=e.replace(/:([^/]+)/g,(c,l)=>(s.push(l),"([^/]+)")),o=new RegExp(`^${r}$`),i=t.match(o);if(i){const c={};return s.forEach((l,u)=>{c[l]=i[u+1]}),{params:c}}return null}getHashPath(){return window.location.hash.slice(1).split("?")[0]||"/"}updateQueryParams(){const t=window.location.hash.slice(1).split("?")[1],s={};t&&new URLSearchParams(t).forEach((o,i)=>{s[i]=o}),this.currentQuery=s}get path(){return this.currentPath}get params(){return this.currentParams}get query(){return this.currentQuery}async preload(e){const t=this.routes.find(s=>typeof s.path=="string"?s.path===e:!1);t&&(await this.resolveComponent(t.path.toString(),t.component),console.log(`[Router] Composant prÃ©chargÃ©: ${e}`))}}Ps=new WeakMap,Ds=new WeakMap,$s=new WeakMap;const Ln=new Vd;function Np(n,e){Ln.navigate(n,e)}function kp(n){return Ln.query[n]}function qp(n){return Ln.preload(n)}var Z,Te,Ut,xt,gn,Ms,Cs,Ns,ks,qs;class Qd{constructor(){j(this,"isMobileQuery",new zi("max-width: 768px"));j(this,"isDesktopQuery",new zi("min-width: 1024px"));v(this,Z,C(null));v(this,Te,C(ie([])));v(this,Ut,C(!1));v(this,xt,C(null));v(this,gn,C(!1));v(this,Ms,X(()=>{const e=Ln.path,t=Ln.params.mainid||Ln.params.mainId;return e.startsWith("/products/")&&t?t:null}));v(this,Cs,C(ie({isOpen:!1,conflicts:[]})));v(this,Ns,C(ie({isOpen:!1})));v(this,ks,C(ie({isRunning:!1,name:"",progress:0})));v(this,qs,C(ie({isOpen:!1})))}get user(){return f(a(this,Z))}get userId(){return f(a(this,Z))?.$id??null}get userEmail(){return f(a(this,Z))?.email??null}get userTeams(){return f(a(this,Te))}get isAuthenticated(){return f(a(this,Z))!==null}get authLoading(){return f(a(this,Ut))}get authError(){return f(a(this,xt))}get authInitialized(){return f(a(this,gn))}async initializeAuth(){if(f(a(this,gn))){console.log("[GlobalState] Authentification dÃ©jÃ  initialisÃ©e");return}console.log("[GlobalState] Initialisation de l'authentification..."),g(a(this,Ut),!0),g(a(this,xt),null);try{const{account:e}=await D();g(a(this,Z),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(a(this,Z)).name),localStorage.setItem("appwrite-user-email",f(a(this,Z)).email),localStorage.setItem("appwrite-user-id",f(a(this,Z)).$id),await $t.initialize(),g(a(this,Te),$t.myTeams.map(t=>t.$id),!0),console.log(`[GlobalState] AuthentifiÃ©: ${f(a(this,Z)).name} (${f(a(this,Te)).length} Ã©quipes)`)}catch(e){g(a(this,Z),null),g(a(this,Te),[],!0),g(a(this,xt),e instanceof Error?e.message:"Erreur d'authentification",!0),console.log("[GlobalState] Utilisateur non connectÃ©")}finally{g(a(this,Ut),!1),g(a(this,gn),!0)}}async refreshAuthAfterLogin(){console.log("[GlobalState] RÃ©initialisation aprÃ¨s login..."),g(a(this,Ut),!0),g(a(this,xt),null);try{const{account:e}=await D();g(a(this,Z),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(a(this,Z)).name),localStorage.setItem("appwrite-user-email",f(a(this,Z)).email),localStorage.setItem("appwrite-user-id",f(a(this,Z)).$id),await $t.initialize(),g(a(this,Te),$t.myTeams.map(t=>t.$id),!0),console.log(`[GlobalState] RÃ©initialisÃ© aprÃ¨s login: ${f(a(this,Z)).name} (${f(a(this,Te)).length} Ã©quipes)`)}catch(e){console.error("[GlobalState] Erreur lors de la rÃ©initialisation:",e),g(a(this,xt),e instanceof Error?e.message:"Erreur de rÃ©initialisation",!0)}finally{g(a(this,Ut),!1)}}async logout(){try{const{account:e}=await D();await e.deleteSession({sessionId:"current"}),Dd(),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-id"),g(a(this,Z),null),g(a(this,Te),[],!0),g(a(this,gn),!1),console.log("[GlobalState] DÃ©connexion rÃ©ussie")}catch(e){throw console.error("[GlobalState] Erreur lors de la dÃ©connexion:",e),e}}async refreshTeams(){if(!f(a(this,Z))){console.warn("[GlobalState] Impossible de rafraÃ®chir les Ã©quipes: utilisateur non connectÃ©");return}try{await $t.syncFromRemote();const e=$t.myTeams.map(t=>t.$id);(e.length>0||f(a(this,Te)).length===0)&&(g(a(this,Te),e,!0),console.log(`[GlobalState] Ãquipes rafraÃ®chies: ${f(a(this,Te)).length}`))}catch(e){console.error("[GlobalState] Erreur lors du rafraÃ®chissement des Ã©quipes:",e)}}isTeamOwner(e){if(!f(a(this,Z)))return!1;const t=$t.myTeams.find(r=>r.$id===e);return t?t.members.find(r=>r.id===f(a(this,Z)).$id)?.roles?.includes("owner")??!1:!1}hasTeamRole(e,t){if(!f(a(this,Z)))return!1;const s=$t.myTeams.find(o=>o.$id===e);return s?s.members.find(o=>o.id===f(a(this,Z)).$id)?.roles?.includes(t)??!1:!1}get currentMainId(){return f(a(this,Ms))}setCurrentMainId(e){g(a(this,Ms),e),console.log(`[GlobalState] currentMainId mis Ã  jour: ${e}`)}get isMobile(){return this.isMobileQuery.current}get isDesktop(){return this.isDesktopQuery.current}get userName(){return f(a(this,Z))?.name||localStorage.getItem("appwrite-user-name")||""}get toasts(){return bt.toasts}get toast(){return bt}get modalOverride(){return f(a(this,Cs))}set modalOverride(e){g(a(this,Cs),e,!0)}get modal(){return f(a(this,Ns))}set modal(e){g(a(this,Ns),e,!0)}get backgroundOperation(){return f(a(this,ks))}set backgroundOperation(e){g(a(this,ks),e,!0)}get authModal(){return f(a(this,qs))}set authModal(e){g(a(this,qs),e,!0)}}Z=new WeakMap,Te=new WeakMap,Ut=new WeakMap,xt=new WeakMap,gn=new WeakMap,Ms=new WeakMap,Cs=new WeakMap,Ns=new WeakMap,ks=new WeakMap,qs=new WeakMap;const Q=new Qd;var js,Ls;class Jd{constructor(){v(this,js,C("survolez des Ã©lÃ©ment pour obtenir de l'aide"));v(this,Ls,C(!0));j(this,"reset",()=>{this.msg="survolez des Ã©lÃ©ment pour obtenir de l'aide"});j(this,"toggle",()=>{this.isExpanded=!this.isExpanded});j(this,"expand",()=>{this.isExpanded=!0});j(this,"collapse",()=>{this.isExpanded=!1})}get msg(){return f(a(this,js))}set msg(e){g(a(this,js),e,!0)}get isExpanded(){return f(a(this,Ls))}set isExpanded(e){g(a(this,Ls),e,!0)}get help(){return this.msg}set help(e){this.msg=e}}js=new WeakMap,Ls=new WeakMap;const jp=new Jd;let Kd=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function Yd(n){return ui(n,{context:"parseEventMeals",itemFallback:(e,t)=>(console.warn(`[parseEventMeals] Meal ${t} invalide, utilisation d'un fallback`,e),{id:`unknown-${t}`,name:"Repas inconnu",date:new Date().toISOString(),guests:1,recipes:[]})})}function Xd(n){return ui(n,{context:"parseEventContributors",itemFallback:(e,t)=>(console.warn(`[parseEventContributors] Contributor ${t} invalide, utilisation d'un fallback`,e),{id:typeof e=="string"?e:`unknown-${t}`,status:"accepted",invitedAt:new Date().toISOString()})})}function Zd(n){return ui(n,{context:"parseEventTodos",itemFallback:(e,t)=>(console.warn(`[parseEventTodos] Todo ${t} invalide, utilisation d'un fallback`,e),{id:`unknown-${t}`,taskName:"TÃ¢che invalide",taskDescription:null,dueDate:null,priority:null,status:null,taskOn:null,requiredPeopleNb:1,assignedTo:null})})}class Fd{constructor(){j(this,"dbName","events-cache");j(this,"db",null);j(this,"version",2);j(this,"EVENTS_STORE","events");j(this,"METADATA_STORE","metadata");j(this,"POSTER_CONFIGS_STORE","poster-configs");j(this,"LAST_SYNC_KEY","lastSync")}async open(){if(this.db)return;const e=()=>new Promise((i,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>i(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.EVENTS_STORE)||(d.createObjectStore(this.EVENTS_STORE,{keyPath:"$id"}),console.log("[EventsIDBCache] Object store 'events' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[EventsIDBCache] Object store 'metadata' crÃ©Ã©")),d.objectStoreNames.contains(this.POSTER_CONFIGS_STORE)||(d.createObjectStore(this.POSTER_CONFIGS_STORE,{keyPath:"eventId"}),console.log("[EventsIDBCache] Object store 'poster-configs' crÃ©Ã©"))}});let t=await e();const s=t.objectStoreNames.contains(this.EVENTS_STORE),r=t.objectStoreNames.contains(this.METADATA_STORE),o=t.objectStoreNames.contains(this.POSTER_CONFIGS_STORE);(!s||!r||!o)&&(console.warn(`[EventsIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (events=${s}, metadata=${r}, posters=${o}), suppression et recrÃ©ation...`),t.close(),await new Promise((i,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>i(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[EventsIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),t=await e()),this.db=t,console.log(`[EventsIDBCache] Base ouverte: ${this.dbName}`)}async loadEvents(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.EVENTS_STORE,"readonly").objectStore(this.EVENTS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[EventsIDBCache] ${i.size} Ã©vÃ©nements chargÃ©s`),e(i)},o.onerror=()=>t(o.error)})}async saveEvents(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.EVENTS_STORE,"readwrite"),o=r.objectStore(this.EVENTS_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[EventsIDBCache] ${e.size} Ã©vÃ©nements sauvegardÃ©s`),t()},r.onerror=()=>s(r.error)})}async saveEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).put(e);i.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e.$id} sauvegardÃ©`),t()},i.onerror=()=>s(i.error)})}async deleteEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).delete(e);i.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e} supprimÃ©`),t()},i.onerror=()=>s(i.error)})}async loadPosterConfig(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const o=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE),i=o.get(e);i.onsuccess=()=>{const c=i.result;if(!c){t(null);return}if(c.config&&!c.current){console.log(`[EventsIDBCache] Migration config affiche V1 -> V2 pour ${e}`);const l={current:c.config,versions:[]};o.put({eventId:e,...l,updatedAt:new Date().toISOString()}),t(l)}else c.current?t({current:c.current,versions:c.versions}):t(null)},i.onerror=()=>s(i.error)})}async savePosterConfig(e,t){if(!this.db)throw new Error("DB non ouverte");return new Promise((s,r)=>{const c=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE).put({eventId:e,...t,updatedAt:new Date().toISOString()});c.onsuccess=()=>{console.log(`[EventsIDBCache] Config affiche (container) pour ${e} sauvegardÃ©e`),s()},c.onerror=()=>r(c.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={lastSync:null};i.forEach(l=>{l.key===this.LAST_SYNC_KEY&&(c.lastSync=l.value)}),console.log(`[EventsIDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}`),e(c)},o.onerror=()=>t(o.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite");r.objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e.lastSync}),r.oncomplete=()=>{console.log("[EventsIDBCache] Metadata sauvegardÃ©es"),t()},r.onerror=()=>s(r.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const s=this.db.transaction([this.EVENTS_STORE,this.METADATA_STORE,this.POSTER_CONFIGS_STORE],"readwrite");s.objectStore(this.EVENTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.objectStore(this.POSTER_CONFIGS_STORE).clear(),s.oncomplete=()=>{console.log("[EventsIDBCache] Cache vidÃ©"),e()},s.onerror=()=>t(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[EventsIDBCache] Connexion fermÃ©e"))}}async function ef(){const n=new Fd;return await n.open(),n}var P,de,Pe,Bt,$,De,Us,to,M,ue,no,xs,Ht,Vn,jr,Mt,gc,wc,yc,vc,bc,Ic,Ec,Sc,_c,Rc,Ac,Tc,Pc;class tf{constructor(){v(this,M);v(this,P,new Xt);v(this,de,C(!1));v(this,Pe,C(null));v(this,Bt,C(!1));v(this,$,null);v(this,De,null);v(this,Us,[]);v(this,to,null);v(this,no,X(()=>{const e=new Date;return e.setHours(0,0,0,0),Array.from(a(this,P).values()).filter(t=>!t.dateStart||!t.dateEnd?!1:new Date(t.dateEnd)>=e)}));v(this,xs,X(()=>{const e=new Date;return Array.from(a(this,P).values()).filter(t=>t.dateEnd?new Date(t.dateEnd)<e:!1)}));v(this,Ht,null);v(this,Vn,!1)}get loading(){return f(a(this,de))}get error(){return f(a(this,Pe))}get isInitialized(){return f(a(this,Bt))}get events(){return Array.from(a(this,P).values())}get count(){return a(this,P).size}get currentEvents(){return f(a(this,no))}get pastEvents(){return f(a(this,xs))}get pastEventsCount(){return f(a(this,xs)).length}async loadCache(){if(f(a(this,Bt))){console.log("[EventsStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[EventsStore] Chargement du cache..."),g(a(this,de),!0),g(a(this,Pe),null);try{if(!Q.isAuthenticated)throw new Error("Utilisateur non connectÃ©");_(this,De,Q.userId),_(this,Us,Q.userTeams),_(this,$,await ef());const e=await a(this,$).loadEvents();if(e.size>0){console.log(`[EventsStore] ${e.size} Ã©vÃ©nements chargÃ©s depuis le cache`),a(this,P).clear();for(const[t,s]of e)a(this,P).set(t,s)}g(a(this,Bt),!0),console.log(`[EventsStore] Cache chargÃ©: ${a(this,P).size} Ã©vÃ©nements`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(a(this,Pe),t,!0),console.error("[EventsStore]",t,e),e}finally{g(a(this,de),!1)}}async syncFromRemote(){if(!a(this,$)){console.warn("[EventsStore] Impossible de sync : cache non initialisÃ©");return}if(I(this,M,ue).call(this)){console.log("[EventsStore] Mode local: skip syncFromRemote");return}console.log("[EventsStore] Synchronisation depuis Appwrite..."),g(a(this,de),!0);try{await I(this,M,jr).call(this),await a(this,$).saveEvents(a(this,P)),await a(this,$).saveMetadata({lastSync:new Date().toISOString()}),console.log(`[EventsStore] Synchronisation terminÃ©e: ${a(this,P).size} Ã©vÃ©nements`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(a(this,Pe),t,!0),console.error("[EventsStore]",t,e),e}finally{g(a(this,de),!1)}}async setupRealtime(){if(!a(this,$)){console.warn("[EventsStore] Impossible de setup realtime : cache non initialisÃ©");return}if(a(this,Vn)){console.log("[EventsStore] Realtime dÃ©jÃ  configurÃ©");return}console.log("[EventsStore] Configuration du realtime..."),await I(this,M,Pc).call(this),_(this,Vn,!0)}async initialize(){if(f(a(this,Bt))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}return a(this,Ht)?(console.log("[EventsStore] Initialisation dÃ©jÃ  en cours, attente..."),a(this,Ht)):(console.log("[EventsStore] Initialisation complÃ¨te..."),g(a(this,de),!0),g(a(this,Pe),null),_(this,Ht,(async()=>{try{await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),console.log(`[EventsStore] Initialisation complÃ©tÃ©e: ${a(this,P).size} Ã©vÃ©nements`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(a(this,Pe),t,!0),console.error("[EventsStore]",t,e),e}finally{g(a(this,de),!1),_(this,Ht,null)}})()),a(this,Ht))}getEventById(e){return a(this,P).get(e)||null}async fetchEvent(e){try{const t=await Cd(e);if(t){const s=I(this,M,Mt).call(this,t);return a(this,P).set(e,s),s}return null}catch(t){return console.error(`[EventsStore] Erreur lors du fetch de ${e}:`,t),null}}getEventsByDateRange(e,t){return this.events.filter(s=>s.dateStart&&s.dateEnd&&s.dateStart>=e&&s.dateEnd<=t)}canEditEvent(e){if(!a(this,De))return!1;const t=a(this,P).get(e);return t?!!(t.createdBy===a(this,De)||t.teams?.some(s=>a(this,Us).includes(s))||t.contributors&&t.contributors.some(s=>s.id===a(this,De)&&s.status==="accepted")):!1}canUserEditEvent(e,t,s){if(!t)return!1;const r=a(this,P).get(e);return r?!!(r.createdBy===t||r.teams?.length&&s?.length&&r.teams.some(o=>s.includes(o))||r.contributors&&r.contributors.some(o=>o.id===t&&o.status==="accepted")):!1}async createEvent(e){if(!Q.userId)throw new Error("Utilisateur non connectÃ©");const t=await Nd(e,Q.userId),s=I(this,M,Mt).call(this,t);return a(this,P).set(t.$id,s),a(this,$)&&await a(this,$).saveEvent(s),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã©: ${t.$id}`),s}async createEventWithTeams(e,t=[],s=!0){if(!Q.userId)throw new Error("Utilisateur non connectÃ©");const r=await kd(e,Q.userId,t,s),o=I(this,M,Mt).call(this,r);return a(this,P).set(r.$id,o),a(this,$)&&await a(this,$).saveEvent(o),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã© avec ${t.length} team(s): ${r.$id}`),o}async updateEvent(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,gc).call(this,e,t);const s=await oa(e,t),r=I(this,M,Mt).call(this,s);return a(this,P).set(e,r),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] ÃvÃ©nement mis Ã  jour: ${e}`),r}async updateEventStatus(e,t){if(I(this,M,ue).call(this,e)){await I(this,M,wc).call(this,e,t);return}try{await oa(e,{status:t});const s=a(this,P).get(e);s&&(s.status=t),console.log(`[EventsStore] Statut mis Ã  jour: ${e} -> ${t}`)}catch(s){throw console.error(`[EventsStore] Erreur mise Ã  jour statut ${e}:`,s),s}}async deleteEvent(e){await qd(e),a(this,P).delete(e),a(this,$)&&await a(this,$).deleteEvent(e),console.log(`[EventsStore] ÃvÃ©nement supprimÃ©: ${e}`)}getContributors(e){const t=a(this,P).get(e);return t?t.contributors:[]}getContributorStatus(e){const t=a(this,P).get(e);if(!t)return"";const s=t.contributors.filter(r=>r.id===a(this,De));return s.length>0?s[0].status:""}async removeContributor(e,t){try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{removeUserFromEvent:r}=await Do(async()=>{const{removeUserFromEvent:i}=await Promise.resolve().then(()=>No);return{removeUserFromEvent:i}},void 0);await r(e,t);const o=s.contributors.filter(i=>i.id!==t&&i.email!==t);return s.contributors.length===o.length?s:await this.updateEvent(e,{contributors:o})}catch(s){throw console.error("[EventsStore] Erreur suppression contributeur:",s),s}}async inviteParticipants(e,t){try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{teamIds:r=[],emails:o=[],userIds:i=[],sendEmailToExistingMembers:c=!0}=t;if(r.length===0&&o.length===0&&i.length===0)return console.log("[EventsStore] Aucun participant Ã  inviter"),s;const{inviteParticipantsToEvent:l}=await Do(async()=>{const{inviteParticipantsToEvent:h}=await Promise.resolve().then(()=>No);return{inviteParticipantsToEvent:h}},void 0),u=await l(e,s.name,{teamIds:r,emails:o,userIds:i,sendEmailToExistingMembers:c});console.log(`[EventsStore] Invitation result: ${u.processed} traitÃ©s`);const d=r.length>0?2e3:500;await new Promise(h=>setTimeout(h,d));const p=await this.fetchEvent(e);if(!p)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return p}catch(s){throw console.error("[EventsStore] Erreur invitation participants:",s),s}}async removeTeam(e,t){try{const{removeTeamFromEvent:s}=await Do(async()=>{const{removeTeamFromEvent:o}=await Promise.resolve().then(()=>No);return{removeTeamFromEvent:o}},void 0);await s(e,t),await new Promise(o=>setTimeout(o,1e3));const r=await this.fetchEvent(e);if(!r)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return console.log(`[EventsStore] Team ${t} retirÃ©e de l'Ã©vÃ©nement ${e}`),r}catch(s){throw console.error("[EventsStore] Erreur retrait team:",s),s}}async updateContributorStatus(e,t,s){if(I(this,M,ue).call(this,e))return await I(this,M,Tc).call(this,e,t,s);try{const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.contributors],i=o.findIndex(c=>c.id===t||c.email===t);if(i===-1)throw new Error("Contributeur introuvable");return o[i]={...o[i],status:s,respondedAt:new Date().toISOString()},await this.updateEvent(e,{contributors:o})}catch(r){throw console.error("[EventsStore] Erreur maj statut:",r),r}}getMeals(e){const t=a(this,P).get(e);return t?t.meals:[]}async addMeal(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,yc).call(this,e,t);try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.meals,t];return await this.updateEvent(e,{meals:r})}catch(s){throw console.error("[EventsStore] Erreur ajout meal:",s),s}}async updateMeal(e,t,s){if(I(this,M,ue).call(this,e))return await I(this,M,vc).call(this,e,t,s);try{const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.meals];if(t<0||t>=o.length)throw new Error("Index invalide");return o[t]=s,await this.updateEvent(e,{meals:o})}catch(r){throw console.error("[EventsStore] Erreur maj meal:",r),r}}async deleteMeal(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,bc).call(this,e,t);try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.meals];if(t<0||t>=r.length)throw new Error("Index invalide");return r.splice(t,1),await this.updateEvent(e,{meals:r})}catch(s){throw console.error("[EventsStore] Erreur suppression meal:",s),s}}getTodos(e){const t=a(this,P).get(e);return t?t.todos:[]}async addTodo(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,Ic).call(this,e,t);try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.todos,t];return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur ajout todo:",s),s}}async addTodos(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,Ec).call(this,e,t);try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.todos,...t];return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur ajout todos:",s),s}}async updateTodoStatus(e,t,s){if(I(this,M,ue).call(this,e)){await I(this,M,Rc).call(this,e,t,s);return}try{const r=a(this,P).get(e);r&&(r.todos=r.todos.map(c=>c.id===t?{...c,status:s,updatedAt:new Date().toISOString()}:c));const{functions:o,config:i}=await D();await o.createExecution(i.functions.enkaData,JSON.stringify({action:"update_todo_status",data:{eventId:e,todoId:t,status:s}}),!1,"/",bs.POST)}catch(r){throw console.error("[EventsStore] Erreur updateTodoStatus:",r),r}}async toggleTodoAssignment(e,t){if(I(this,M,ue).call(this,e)){await I(this,M,Ac).call(this,e,t);return}try{const s=Q.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const r=a(this,P).get(e);if(r){const c=r.todos.find(l=>l.id===t);if(c){let l=[];Array.isArray(c.assignedTo)?l=[...c.assignedTo]:c.assignedTo&&(l=[c.assignedTo]),l.includes(s)?l=l.filter(u=>u!==s):l.push(s),r.todos=r.todos.map(u=>u.id===t?{...u,assignedTo:l.length>0?l:null,updatedAt:new Date().toISOString()}:u)}}const{functions:o,config:i}=await D();await o.createExecution(i.functions.enkaData,JSON.stringify({action:"toggle_todo_assignment",data:{eventId:e,todoId:t}}),!1,"/",bs.POST)}catch(s){throw console.error("[EventsStore] Erreur toggleTodoAssignment:",s),s}}async updateTodo(e,t,s){if(I(this,M,ue).call(this,e))return await I(this,M,Sc).call(this,e,t,s);try{const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=r.todos.map(i=>i.id===t?{...i,...s,updatedAt:new Date().toISOString()}:i);return await this.updateEvent(e,{todos:o})}catch(r){throw console.error("[EventsStore] Erreur maj todo:",r),r}}async deleteTodo(e,t){if(I(this,M,ue).call(this,e))return await I(this,M,_c).call(this,e,t);try{const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=s.todos.filter(o=>o.id!==t);return await this.updateEvent(e,{todos:r})}catch(s){throw console.error("[EventsStore] Erreur suppression todo:",s),s}}async loadAllPastEvents(){try{if(console.log("[EventsStore] Chargement de TOUS les Ã©vÃ©nements..."),!a(this,De)){console.warn("[EventsStore] userId non dÃ©fini");return}g(a(this,de),!0);const{events:e}=await ra(a(this,De),null);e.forEach(t=>{a(this,P).set(t.$id,I(this,M,Mt).call(this,t))}),console.log(`[EventsStore] ${e.length} Ã©vÃ©nements chargÃ©s (sans filtre de date, total: ${a(this,P).size})`)}catch(e){throw console.error("[EventsStore] Erreur lors du chargement:",e),e}finally{g(a(this,de),!1)}}calculateScaleFactor(e,t){return e/t}async loadPosterConfig(e){return a(this,$)?await a(this,$).loadPosterConfig(e):null}async savePosterConfig(e,t){if(!a(this,$))return;const r=await a(this,$).loadPosterConfig(e)||{versions:[]};r.current=t,await a(this,$).savePosterConfig(e,r)}async createPosterVersion(e,t,s){if(!a(this,$))return;const o=await a(this,$).loadPosterConfig(e)||{current:t,versions:[]};if(o.versions||(o.versions=[]),o.versions.length>=3)throw new Error("Limite de 3 versions atteinte");const i={id:crypto.randomUUID(),name:s,config:JSON.parse(JSON.stringify(t)),createdAt:new Date().toISOString()};return o.versions.push(i),o.current=t,await a(this,$).savePosterConfig(e,o),i}async deletePosterVersion(e,t){if(!a(this,$))return;const s=await a(this,$).loadPosterConfig(e);!s||!s.versions||(s.versions=s.versions.filter(r=>r.id!==t),await a(this,$).savePosterConfig(e,s))}async reload(){console.log("[EventsStore] Rechargement..."),g(a(this,de),!0),g(a(this,Pe),null);try{a(this,P).clear(),await I(this,M,jr).call(this),console.log("[EventsStore] Rechargement complÃ©tÃ©")}catch(e){const t=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(a(this,Pe),t,!0),console.error("[EventsStore]",t,e),e}finally{g(a(this,de),!1)}}async hardReset(){console.log("[EventsStore] ð HARD RESET - Vidage complet..."),g(a(this,de),!0),g(a(this,Pe),null);try{a(this,P).clear(),a(this,$)&&(await a(this,$).clear(),console.log("[EventsStore] Cache IDB vidÃ©")),await I(this,M,jr).call(this),a(this,$)&&(await a(this,$).saveEvents(a(this,P)),await a(this,$).saveMetadata({lastSync:new Date().toISOString()}),console.log("[EventsStore] Cache IDB recrÃ©Ã©")),console.log("[EventsStore] â HARD RESET terminÃ©")}catch(e){const t=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(a(this,Pe),t,!0),console.error("[EventsStore]",t,e),e}finally{g(a(this,de),!1)}}destroy(){a(this,$)&&(a(this,$).close(),_(this,$,null)),a(this,P).clear(),g(a(this,Bt),!1),_(this,Vn,!1),console.log("[EventsStore] Ressources nettoyÃ©es")}}P=new WeakMap,de=new WeakMap,Pe=new WeakMap,Bt=new WeakMap,$=new WeakMap,De=new WeakMap,Us=new WeakMap,to=new WeakMap,M=new WeakSet,ue=function(e){const t=e||a(this,to);return t?a(this,P).get(t)?.status==="local":!1},no=new WeakMap,xs=new WeakMap,Ht=new WeakMap,Vn=new WeakMap,jr=async function(e=null){if(I(this,M,ue).call(this)){console.log("[EventsStore] Mode local: skip loadEvents from Appwrite");return}try{if(console.log("[EventsStore] Chargement des Ã©vÃ©nements..."),!a(this,De)){console.warn("[EventsStore] userId non dÃ©fini, impossible de charger les Ã©vÃ©nements");return}if(!e){const s=new Date;s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()-15),e=r.toISOString()}const{events:t}=await ra(a(this,De),e);t.forEach(s=>{a(this,P).set(s.$id,I(this,M,Mt).call(this,s))}),console.log(`[EventsStore] ${t.length} Ã©vÃ©nements chargÃ©s (filtrÃ©s pour userId: ${a(this,De)}, date >= ${e})`)}catch(t){throw console.error("[EventsStore] Erreur lors du chargement:",t),t}},Mt=function(e){return{...e,meals:Yd(e.meals),contributors:Xd(e.contributors),todos:Zd(e.todos)}},gc=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r={...s,...t,$updatedAt:new Date().toISOString()};return a(this,P).set(e,r),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: Event mis Ã  jour: ${e}`),r},wc=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");s.status=t,s.$updatedAt=new Date().toISOString(),a(this,$)&&await a(this,$).saveEvent(s),console.log(`[EventsStore] Mode local: Status mis Ã  jour: ${e} -> ${t}`)},yc=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r={...s,meals:[...s.meals,t],$updatedAt:new Date().toISOString()};return a(this,P).set(e,r),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: Meal ajoutÃ© Ã  ${e}`),r},vc=async function(e,t,s){const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.meals];if(t<0||t>=o.length)throw new Error("Index invalide");o[t]=s;const i={...r,meals:o,$updatedAt:new Date().toISOString()};return a(this,P).set(e,i),a(this,$)&&await a(this,$).saveEvent(i),console.log(`[EventsStore] Mode local: Meal mis Ã  jour dans ${e}`),i},bc=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=[...s.meals];if(t<0||t>=r.length)throw new Error("Index invalide");r.splice(t,1);const o={...s,meals:r,$updatedAt:new Date().toISOString()};return a(this,P).set(e,o),a(this,$)&&await a(this,$).saveEvent(o),console.log(`[EventsStore] Mode local: Meal supprimÃ© de ${e}`),o},Ic=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r={...s,todos:[...s.todos,t],$updatedAt:new Date().toISOString()};return a(this,P).set(e,r),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: Todo ajoutÃ© Ã  ${e}`),r},Ec=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r={...s,todos:[...s.todos,...t],$updatedAt:new Date().toISOString()};return a(this,P).set(e,r),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: ${t.length} todos ajoutÃ©s Ã  ${e}`),r},Sc=async function(e,t,s){const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=r.todos.map(c=>c.id===t?{...c,...s,updatedAt:new Date().toISOString()}:c),i={...r,todos:o,$updatedAt:new Date().toISOString()};return a(this,P).set(e,i),a(this,$)&&await a(this,$).saveEvent(i),console.log(`[EventsStore] Mode local: Todo mis Ã  jour dans ${e}`),i},_c=async function(e,t){const s=a(this,P).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const r=s.todos.filter(i=>i.id!==t),o={...s,todos:r,$updatedAt:new Date().toISOString()};return a(this,P).set(e,o),a(this,$)&&await a(this,$).saveEvent(o),console.log(`[EventsStore] Mode local: Todo supprimÃ© de ${e}`),o},Rc=async function(e,t,s){const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");r.todos=r.todos.map(o=>o.id===t?{...o,status:s,updatedAt:new Date().toISOString()}:o),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: Todo status mis Ã  jour: ${t} -> ${s}`)},Ac=async function(e,t){const s=Q.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=r.todos.find(c=>c.id===t);if(!o)throw new Error("Todo introuvable");let i=[];Array.isArray(o.assignedTo)?i=[...o.assignedTo]:o.assignedTo&&(i=[o.assignedTo]),i.includes(s)?i=i.filter(c=>c!==s):i.push(s),r.todos=r.todos.map(c=>c.id===t?{...c,assignedTo:i.length>0?i:null,updatedAt:new Date().toISOString()}:c),a(this,$)&&await a(this,$).saveEvent(r),console.log(`[EventsStore] Mode local: Todo assignment toggled: ${t}`)},Tc=async function(e,t,s){const r=a(this,P).get(e);if(!r)throw new Error("ÃvÃ©nement introuvable");const o=[...r.contributors],i=o.findIndex(l=>l.id===t||l.email===t);if(i===-1)throw new Error("Contributeur introuvable");o[i]={...o[i],status:s,respondedAt:new Date().toISOString()};const c={...r,contributors:o,$updatedAt:new Date().toISOString()};return a(this,P).set(e,c),a(this,$)&&await a(this,$).saveEvent(c),console.log(`[EventsStore] Mode local: Contributor status mis Ã  jour: ${t} -> ${s}`),c},Pc=async function(){if(I(this,M,ue).call(this)){console.log("[EventsStore] Mode local: skip realtime setup");return}try{console.log("[EventsStore] Activation du Realtime...");const e=Ct();mr.register([`databases.${e}.collections.${Tn}.documents`],async t=>{const s=t.events.some(o=>o.includes(".create"))?"create":t.events.some(o=>o.includes(".delete"))?"delete":"update",r=t.payload;if(console.log(`[EventsStore] â¡ï¸ Realtime RECEIVED: ${s} pour ${r.$id}`,{name:r.name,updatedAt:r.$updatedAt}),s==="create"||s==="update"){const o=I(this,M,Mt).call(this,r);a(this,P).set(r.$id,o),a(this,$)&&await a(this,$).saveEvent(o)}else s==="delete"&&(a(this,P).delete(r.$id),a(this,$)&&await a(this,$).deleteEvent(r.$id))}),console.log("[EventsStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[EventsStore] Erreur lors de la configuration du realtime:",e)}};const It=new tf;function gr(n){if(!n)return[];const e=[],t=n.$id;return e.push(J.read(ee.label(t)),J.update(ee.label(t))),e}function nf(n,e){switch(n){case"store":return{store:JSON.stringify(e)};case"who":return{who:e.names};default:throw new Error(`Unsupported update type: ${n}`)}}function sf(n,e,t){return{$id:n.$id,productHugoUuid:n.productHugoUuid,productName:n.productName,mainId:n.mainId,status:n.status||null,who:e.who!==void 0?e.who:n.who,store:e.store!==void 0?e.store:n.store,stockReel:n.stockReel||null,previousNames:n.previousNames||null,isMerged:n.isMerged||!1,mergedFrom:n.mergedFrom||null,mergeDate:n.mergeDate||null,mergeReason:n.mergeReason||null,mergedInto:n.mergedInto||null,totalNeededOverride:n.totalNeededOverride||null,$permissions:[J.read(ee.label(t)),J.update(ee.label(t))]}}function rf(n,e){return{$id:n.$id,mainId:n.mainId,productHugoUuid:n.productHugoUuid,productName:n.productName,...e}}async function of(n){const{account:e}=await D(),t=await e.get();return{...n,updatedBy:t.name}}function di(){return localStorage.getItem("appwrite-user-name")||""}async function af(n,e,t=100){try{const{tables:s,config:r}=await D(),o=await s.listRows({databaseId:r.databaseId,tableId:r.collections.purchases,queries:[b.greaterThan("$updatedAt",e),b.equal("mainId",n),b.limit(t)]});return console.log(`[Appwrite Interactions] ${o.rows.length} purchases modifiÃ©s chargÃ©s`),o.rows}catch(s){return console.error("[Appwrite Interactions] Erreur chargement purchases modifiÃ©s:",s),[]}}async function cf(n,e){const{lastSync:t,limit:s=1e3}=e;try{const{tables:r,config:o}=await D();if(!t){console.log("[Appwrite Interactions] Chargement complet des produits et achats");const h=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.products,queries:[b.equal("mainId",n),b.limit(s)]})).rows,w=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.purchases,queries:[b.equal("mainId",n),b.limit(s*2)]})).rows,E=new Map;return h.forEach(S=>{E.set(S.$id,{...S,purchases:[]})}),w.forEach(S=>{S.products?.forEach(A=>{const T=E.get(A);T&&(T.purchases||(T.purchases=[]),T.purchases.push(S))})}),console.log(`[Appwrite Interactions] ${h.length} produits chargÃ©s avec ${w.length} achats`),Array.from(E.values())}const i=await r.listRows({databaseId:o.databaseId,tableId:o.collections.products,queries:[b.greaterThan("$updatedAt",t),b.equal("mainId",n),b.limit(s)]}),c=i.rows,u=(await r.listRows({databaseId:o.databaseId,tableId:o.collections.purchases,queries:[b.greaterThan("$updatedAt",t),b.equal("mainId",n),b.limit(s*2)]})).rows,d=new Map;return c.forEach(p=>{d.set(p.$id,{...p,purchases:[]})}),u.forEach(p=>{p.products?.forEach(h=>{const m=d.get(h);m&&(m.purchases||(m.purchases=[]),m.purchases.push(p))})}),i.rows.length>0&&console.log(`[Appwrite Interactions] ${i.rows.length} produits synchronisÃ©s (delta)`),Array.from(d.values())}catch(r){console.error(`[Appwrite Interactions] Erreur sync produits avec purchases pour mainId ${n}:`,r);const o=r instanceof Error?r.message:"Erreur lors de la synchronisation";throw new Error(`Ãchec de la synchronisation: ${o}`)}}async function rs(n,e,t=!0){const{tables:s,config:r}=await D();return t&&(e.updatedBy=di()),await s.updateRow({databaseId:r.databaseId,tableId:r.collections.products,rowId:n,data:e})}async function lf(n,e,t){try{const s=t(n);if(!s)throw new Error(`Produit ${n} non trouvÃ© localement pour crÃ©ation`);console.log(`[Appwrite Interactions] CrÃ©ation produit ${n} sur Appwrite...`);const r=rf(s,e),o=await of(r),{tables:i,config:c}=await D(),l=It.getEventById(o.mainId),u=gr(l),d=await i.createRow({databaseId:c.databaseId,tableId:c.collections.products,rowId:n,data:o,permissions:u});return console.log(`[Appwrite Interactions] Produit ${n} crÃ©Ã© avec permissions (labels + teams)`),d}catch(s){console.error(`[Appwrite Interactions] Erreur crÃ©ation produit ${n}:`,s);const r=s instanceof Error?s.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation du produit: ${r}`)}}async function Lp(n,e){try{const{tables:t,config:s}=await D(),o=`${cc(n.productName).substring(0,10)}_${Date.now().toString(36)}`,i={quantity:n.quantity,pF:n.pF||!1,pS:n.pS||!1},c={productHugoUuid:null,productName:n.productName,productType:n.productType||"Autre",store:n.store?JSON.stringify(n.store):null,who:n.who||[],isSynced:!0,mainId:e,status:"active",updatedBy:di(),stockReel:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,mergedInto:null,totalNeededOverride:null,specs:JSON.stringify(i)};console.log(`[Appwrite Interactions] CrÃ©ation produit manuel ${o}...`,c);const l=It.getEventById(e),u=gr(l),d=await t.createRow({databaseId:s.databaseId,tableId:s.collections.products,rowId:o,data:c,permissions:u});return console.log(`[Appwrite Interactions] Produit manuel ${o} crÃ©Ã© avec permissions Label`),d}catch(t){throw console.error("[Appwrite Interactions] Erreur crÃ©ation produit manuel:",t),t}}async function Up(n,e){if(!n)throw new Error("ID du produit requis pour la mise Ã  jour du magasin");const t=e?JSON.stringify(e):null,s=await rs(n,{store:t||void 0});return console.log(`[Appwrite Interactions] Magasin mis Ã  jour pour produit ${n}, nouvelle valeur:`,s.store),s}async function xp(n,e){return rs(n,{who:e})}async function Bp(n,e){return rs(n,{stockReel:e})}async function Hp(n,e,t=!1){if(!n)throw new Error("ID du produit requis pour la mise Ã  jour de l'override");const s=JSON.stringify(e),r=await rs(n,{totalNeededOverride:s},t);return console.log(`[Appwrite Interactions] Total override mis Ã  jour pour le produit ${n}:`,e),r}async function Op(n,e=!0){if(!n)throw new Error("ID du produit requis pour la suppression de l'override");const t=await rs(n,{totalNeededOverride:""},e);return console.log(`[Appwrite Interactions] Total override supprimÃ© pour le produit ${n}`),t}async function zp(n,e,t){try{const s=t(n);if(!s)throw new Error(`Produit ${n} non trouvÃ© localement pour mise Ã  jour batch`);const r={};return e.stockReel!==void 0&&(r.stockReel=e.stockReel),e.who!==void 0&&(r.who=e.who),e.storeInfo!==void 0&&(r.store=JSON.stringify(e.storeInfo)),s.isSynced?(console.log(`[Appwrite Interactions] Produit ${n} dÃ©jÃ  sync, update batch normal...`),await rs(n,r)):(console.log(`[Appwrite Interactions] Produit ${n} local, crÃ©ation batch avec upsert...`),await lf(n,r,t))}catch(s){throw console.error(`[Appwrite Interactions] Erreur lors de la mise Ã  jour batch du produit ${n}:`,s),s}}async function Wp(n){const{tables:e,config:t}=await D(),s={...n,createdBy:di()},r=It.getEventById(n.mainId),o=gr(r),i=await e.createRow(t.databaseId,t.collections.purchases,ke.unique(),s,o);return console.log("[Appwrite Interactions] Achat crÃ©Ã© avec permissions Label:",i),i}async function Gp(n,e){try{const{tables:t,config:s}=await D(),r=await t.updateRow(s.databaseId,s.collections.purchases,n,e);return console.log(`[Appwrite Interactions] Achat ${n} mis Ã  jour:`,e),r}catch(t){console.error(`[Appwrite Interactions] Erreur mise Ã  jour achat ${n}:`,t);const s=t instanceof Error?t.message:"Erreur inconnue";throw new Error(`Ãchec de la mise Ã  jour de l'achat: ${s}`)}}async function Vp(n){try{const{tables:e,config:t}=await D();await e.deleteRow(t.databaseId,t.collections.purchases,n),console.log(`[Appwrite Interactions] Achat ${n} supprimÃ©`)}catch(e){console.error(`[Appwrite Interactions] Erreur suppression achat ${n}:`,e);const t=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec de la suppression de l'achat: ${t}`)}}async function uf(n){if(!n?.length)return[];try{const{tables:e,config:t}=await D(),s=await e.listRows(t.databaseId,t.collections.purchases,[b.equal("$id",n)]);return console.log(`[Appwrite Interactions] ${s.rows.length} purchases chargÃ©s avec relations products`),s.rows}catch(e){console.error("[Appwrite Interactions] Erreur chargement purchases avec relations:",e);const t=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec du chargement des purchases: ${t}`)}}async function Qp(n,e,t,s){try{const{functions:r,config:o,account:i}=await D(),c=Pf.currentMainId;if(!c)throw new Error("No current event - cannot determine mainId for permissions");const l=await i.get(),u=nf(t,s),d=n.map(w=>{const E=e.find(S=>S.$id===w);if(!E)throw new Error(`Product ${w} not found in products data`);return sf(E,u,c)});console.log(`[Appwrite Interactions] Lancement mise Ã  jour groupÃ©e OPTIMISÃE: ${d.length} produits, type: ${t}`);const p={operation:"batchUpdateProductsOptimized",data:{rows:d,fromUserId:l.$id}},h=await pc(()=>r.createExecution(o.functions.batchUpdate,JSON.stringify(p),!1,"/",bs.POST),{operationName:`batchUpdateProductsOptimized (${d.length} products, type: ${t})`,maxAutoRetries:1,autoRetryDelay:2e3});if(!h)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives de mise Ã  jour groupÃ©e optimisÃ©e");if(h.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${h.status}. Erreur: ${h.stderr||h.responseBody}`);const m=JSON.parse(h.responseBody);return m.success?console.log(`[Appwrite Interactions] Mise Ã  jour groupÃ©e optimisÃ©e rÃ©ussie: ${m.updatedCount} produits mis Ã  jour`):console.error("[Appwrite Interactions] Mise Ã  jour groupÃ©e optimisÃ©e Ã©chouÃ©e:",m.error),m}catch(r){console.error("[Appwrite Interactions] Erreur mise Ã  jour groupÃ©e optimisÃ©e:",r);const o=r instanceof Error?r.message:"Erreur inconnue";return{success:!1,updatedCount:n.length,updateType:t,error:o,timestamp:new Date().toISOString()}}}async function Jp(n,e,t,s={}){try{const{tables:r,config:o,account:i}=await D(),c=await i.get(),l=It.getEventById(n),u=gr(l),d=[];console.log("[Appwrite Interactions] Debug createQuickValidationPurchases:",{mainId:n,productId:e,productIdType:typeof e,quantities:t,options:s});for(const p of t){const h={products:[e],mainId:n,quantity:p.q,unit:p.u,status:"delivered",notes:s.notes||`Validation rapide ${new Date().toLocaleDateString("fr-FR")}`,store:s.store??null,who:c.name,price:null,orderDate:null,deliveryDate:null,createdBy:c.$id,invoiceId:s.invoiceId,invoiceTotal:null},m=await r.createRow(o.databaseId,o.collections.purchases,ke.unique(),h,u);d.push(m)}return console.log(`[Appwrite Interactions] ${d.length} validations rapides crÃ©Ã©es avec permissions (labels + teams) pour produit ${e}`),d}catch(r){console.error("[Appwrite Interactions] Erreur crÃ©ation validation rapide:",r);const o=r instanceof Error?r.message:"Erreur inconnue";throw new Error(`Ãchec de la validation rapide: ${o}`)}}async function Kp(n,e,t,s,r,o){try{const{tables:i,config:c,account:l}=await D(),u=await l.get(),d=e||ke.unique(),p=u.name;if(!t)throw new Error("invoiceTotal est requis pour une dÃ©pense");const h=It.getEventById(n),m=gr(h),w={products:[],mainId:n,quantity:1,unit:"global",status:"expense",notes:r||"",store:s??null,who:p||u.name,price:t,invoiceId:d,invoiceTotal:t,orderDate:null,deliveryDate:null,createdBy:u.$id},E=await i.createRow(c.databaseId,c.collections.purchases,ke.unique(),w,m);return console.log("[Appwrite Interactions] DÃ©pense crÃ©Ã©e avec permissions (labels + teams):",E),E}catch(i){console.error("[Appwrite Interactions] Erreur crÃ©ation dÃ©pense:",i);const c=i instanceof Error?i.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation de la dÃ©pense: ${c}`)}}async function df(n){try{const{tables:e,config:t}=await D(),s=await e.listRows(t.databaseId,t.collections.purchases,[b.equal("mainId",n),b.equal("status","expense"),b.limit(1e3)]);return console.log(`[Appwrite Interactions] ${s.rows.length} dÃ©penses globales chargÃ©es`),s.rows}catch(e){return console.error("[Appwrite Interactions] Erreur chargement dÃ©penses globales:",e),[]}}class ff{constructor(e){j(this,"dbName");j(this,"db",null);j(this,"version",1);j(this,"PRODUCTS_STORE","products");j(this,"METADATA_STORE","metadata");j(this,"LAST_SYNC_KEY","lastSync");j(this,"ALL_DATES_KEY","allDates");j(this,"HUGO_HASH_KEY","hugoContentHash");this.dbName=`products-cache-${e}`}async open(){if(!this.db)return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,console.log(`[IDBCache] Base ouverte: ${this.dbName}`),e()},s.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(this.PRODUCTS_STORE)||(o.createObjectStore(this.PRODUCTS_STORE,{keyPath:"$id"}),console.log("[IDBCache] Object store 'products' crÃ©Ã©")),o.objectStoreNames.contains(this.METADATA_STORE)||(o.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[IDBCache] Object store 'metadata' crÃ©Ã© avec keyPath"))}})}async loadProducts(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readonly").objectStore(this.PRODUCTS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[IDBCache] ${i.size} produits chargÃ©s`),e(i)},o.onerror=()=>t(o.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={lastSync:null,allDates:[],hugoContentHash:null};i.forEach(l=>{l.key===this.LAST_SYNC_KEY?c.lastSync=l.value:l.key===this.ALL_DATES_KEY?c.allDates=l.value||[]:l.key===this.HUGO_HASH_KEY&&(c.hugoContentHash=l.value)}),console.log(`[IDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}, dates=${c.allDates?.length||0}, hash=${c.hugoContentHash}`),e(c)},o.onerror=()=>t(o.error)})}async saveProducts(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.PRODUCTS_STORE,"readwrite"),o=r.objectStore(this.PRODUCTS_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[IDBCache] ${e.size} produits sauvegardÃ©s`),t()},r.onerror=()=>s(r.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite"),o=r.objectStore(this.METADATA_STORE);o.put({key:this.LAST_SYNC_KEY,value:e.lastSync}),o.put({key:this.ALL_DATES_KEY,value:e.allDates}),e.hugoContentHash!==void 0&&o.put({key:this.HUGO_HASH_KEY,value:e.hugoContentHash}),r.oncomplete=()=>{console.log("[IDBCache] Metadata sauvegardÃ©es (objets {key, value})"),t()},r.onerror=()=>s(r.error)})}async updateLastSync(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] lastSync mis Ã  jour: ${e}`),t()},i.onerror=()=>s(i.error)})}async updateAllDates(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.ALL_DATES_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] allDates mis Ã  jour: ${e.length} dates`),t()},i.onerror=()=>s(i.error)})}async updateHugoContentHash(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.HUGO_HASH_KEY,value:e});i.onsuccess=()=>{console.log(`[IDBCache] hugoContentHash mis Ã  jour: ${e}`),t()},i.onerror=()=>s(i.error)})}async updateLastHugoMenuUpdate(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:"lastHugoMenuUpdate",value:e});i.onsuccess=()=>{console.log("[IDBCache] lastHugoMenuUpdate sauvegardÃ©"),t()},i.onerror=()=>s(i.error)})}async upsertProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).put(e);i.onsuccess=()=>t(),i.onerror=()=>s(i.error)})}async deleteProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).delete(e);i.onsuccess=()=>t(),i.onerror=()=>s(i.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const s=this.db.transaction([this.PRODUCTS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.PRODUCTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[IDBCache] Cache vidÃ©"),e()},s.onerror=()=>t(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[IDBCache] Connexion fermÃ©e"))}}async function pf(n){const e=new ff(n);return await e.open(),e}var Bs,Hs;class ls{constructor(e,t){v(this,Bs,C(ie({})));j(this,"dateStore");v(this,Hs,X(()=>{const e=this.dateStore.current;this.dateStore.dates;let t;if(e.start&&e.end)t=fd(this.data,e.start,e.end);else return{quantities:[],formattedQuantities:"",nbRecipes:0,totalAssiettes:0,stockResult:[],availableQuantities:[],missingQuantities:[],formattedMissingQuantities:"",formattedAvailableQuantities:"En attente",hasAvailable:!1,hasMissing:!1,concernedDates:[],recipesByDate:new Map};return{quantities:t.requiredQuantities,formattedQuantities:t.requiredQuantitiesFormatted,nbRecipes:t.totalRecipesInRange,totalAssiettes:t.totalPortionsInRange,stockResult:t.stockBalance,availableQuantities:t.availableStockQuantities,missingQuantities:t.missingStockQuantities,formattedMissingQuantities:t.missingStockFormatted,formattedAvailableQuantities:t.availableStockFormatted,hasAvailable:t.hasAvailableStock,hasMissing:t.hasMissingStock,concernedDates:t.datesInSelectedRange,recipesByDate:t.recipesByDate}}));this.data=e,this.dateStore=t}get data(){return f(a(this,Bs))}set data(e){g(a(this,Bs),e,!0)}update(e){this.data=e}get $id(){return this.data.$id}get productName(){return this.data.productName}get productType(){return this.data.productType}get storeInfo(){return this.data.storeInfo}get who(){return this.data.who}get pF(){return this.data.pF}get pS(){return this.data.pS}get status(){return this.data.status}get previousNames(){return this.data.previousNames}get purchases(){return this.data.purchases}get totalNeededOverrideParsed(){return this.data.totalNeededOverrideParsed}get displayMissingQuantity(){return this.data.displayMissingQuantity}get missingQuantityArray(){return this.data.missingQuantityArray}get isSynced(){return this.data.isSynced}get byDate(){return this.data.byDate}get stats(){return f(a(this,Hs))}set stats(e){g(a(this,Hs),e)}}Bs=new WeakMap,Hs=new WeakMap;var F,se,re,Os,zs,Ws,Gs,Vs,Qs,Js,Ks,Ys;class hf{constructor(e=[]){v(this,F,C(ie([])));v(this,se,C(null));v(this,re,C(null));v(this,Os,X(()=>[...f(a(this,F))].sort()[0]));v(this,zs,X(()=>[...f(a(this,F))].sort()[f(a(this,F)).length-1]));v(this,Ws,X(()=>{if(f(a(this,F)).length===0)return!0;const e=this.lastAvailableDate?new Date(this.lastAvailableDate):new Date;return e.setHours(23,59,59,999),e<new Date}));v(this,Gs,X(()=>{if(f(a(this,F)).length===0)return!1;const e=new Date;return e.setHours(0,0,0,0),f(a(this,F)).some(t=>new Date(t)>=e)}));v(this,Vs,X(()=>f(a(this,se))===this.firstAvailableDate&&f(a(this,re))===this.lastAvailableDate));v(this,Qs,X(()=>{if(f(a(this,F)).length===0)return!1;const e=[...f(a(this,F))].sort(),t=new Date;t.setHours(0,0,0,0);const s=e.find(i=>new Date(i)>=t)||null;let r,o;if(s)r=s,o=e[e.length-1];else{const i=e[e.length-1];r=i,o=i}return f(a(this,se))===r&&f(a(this,re))===o}));v(this,Js,X(()=>f(a(this,F)).length===1));v(this,Ks,X(()=>!!(f(a(this,se))&&f(a(this,se))===f(a(this,re)))));v(this,Ys,X(()=>{if(!f(a(this,se))||!f(a(this,re))||this.isEventPassed)return!1;const e=new Date(f(a(this,se)));return e.setHours(e.getHours()+lc),e<new Date}));g(a(this,F),e,!0),this.initializeSmartRange()}get start(){return f(a(this,se))}get end(){return f(a(this,re))}get dates(){return f(a(this,F))}get firstAvailableDate(){return f(a(this,Os))}set firstAvailableDate(e){g(a(this,Os),e)}get lastAvailableDate(){return f(a(this,zs))}set lastAvailableDate(e){g(a(this,zs),e)}get current(){return{start:f(a(this,se)),end:f(a(this,re))}}get isEventPassed(){return f(a(this,Ws))}set isEventPassed(e){g(a(this,Ws),e)}get hasUpcomingDates(){return f(a(this,Gs))}set hasUpcomingDates(e){g(a(this,Gs),e)}get isFullRange(){return f(a(this,Vs))}set isFullRange(e){g(a(this,Vs),e)}get isUpcomingRange(){return f(a(this,Qs))}set isUpcomingRange(e){g(a(this,Qs),e)}get hasSingleDateEvent(){return f(a(this,Js))}set hasSingleDateEvent(e){g(a(this,Js),e)}get hasSingleDateInRange(){return f(a(this,Ks))}set hasSingleDateInRange(e){g(a(this,Ks),e)}get hasPastDatesInRange(){return f(a(this,Ys))}set hasPastDatesInRange(e){g(a(this,Ys),e)}setAvailableDates(e){g(a(this,F),e,!0),this.initializeSmartRange()}setRange(e,t){if(!e&&!t){g(a(this,se),null),g(a(this,re),null);return}if(!e||!t){const o=e||t;g(a(this,se),o,!0),g(a(this,re),o,!0);return}const s=new Date(e)<=new Date(t)?e:t,r=new Date(e)>=new Date(t)?e:t;g(a(this,se),s,!0),g(a(this,re),r,!0)}selectAll(){f(a(this,F)).length!==0&&(g(a(this,se),f(a(this,F))[0],!0),g(a(this,re),f(a(this,F))[f(a(this,F)).length-1],!0))}selectUpcoming(){if(f(a(this,F)).length===0)return;const e=[...f(a(this,F))].sort(),t=new Date;t.setHours(0,0,0,0);const s=e.find(r=>new Date(r)>=t)||null;if(s)g(a(this,se),s,!0),g(a(this,re),e[e.length-1],!0);else{const r=e[e.length-1];g(a(this,se),r,!0),g(a(this,re),r,!0)}}selectFutureDatesOnly(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const t=f(a(this,F)).filter(s=>new Date(s)>=e);t.length>0&&(g(a(this,se),t[0],!0),g(a(this,re),t[t.length-1],!0))}initializeSmartRange(){if(f(a(this,F)).length===0)return;const e=[...f(a(this,F))].sort(),t=this.isEventPassed,s=new Date(e[0])<new Date,r=new Date;let o;t?o=e[0]:s?o=r.toISOString().slice(0,19)+"Z":o=e[0],g(a(this,se),o,!0),g(a(this,re),e[e.length-1],!0),console.log(`[DateRangeStore] Initialized: ${f(a(this,se))} - ${f(a(this,re))}`)}reset(){g(a(this,F),[],!0),g(a(this,se),null),g(a(this,re),null),console.log("[DateRangeStore] Reset")}}F=new WeakMap,se=new WeakMap,re=new WeakMap,Os=new WeakMap,zs=new WeakMap,Ws=new WeakMap,Gs=new WeakMap,Vs=new WeakMap,Qs=new WeakMap,Js=new WeakMap,Ks=new WeakMap,Ys=new WeakMap;class mf{constructor(){j(this,"dbName","recipes-cache");j(this,"db",null);j(this,"version",5);j(this,"RECIPES_INDEX_STORE","recipes-index");j(this,"RECIPES_DETAILS_STORE","recipes-details");j(this,"METADATA_STORE","metadata");j(this,"BUILD_TIMESTAMP_KEY","buildTimestamp");j(this,"LAST_APPWRITE_SYNC_KEY","lastAppwriteSync");j(this,"RECIPES_COUNT_KEY","recipesCount")}async open(){if(this.db)return;const e=()=>new Promise((i,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>i(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.RECIPES_INDEX_STORE)||(d.createObjectStore(this.RECIPES_INDEX_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-index' crÃ©Ã©")),d.objectStoreNames.contains(this.RECIPES_DETAILS_STORE)||(d.createObjectStore(this.RECIPES_DETAILS_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-details' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[RecipesIDBCache] Object store 'metadata' crÃ©Ã©"))}});let t=await e();const s=t.objectStoreNames.contains(this.RECIPES_INDEX_STORE),r=t.objectStoreNames.contains(this.RECIPES_DETAILS_STORE),o=t.objectStoreNames.contains(this.METADATA_STORE);(!s||!r||!o)&&(console.warn(`[RecipesIDBCache] Base corrompue dÃ©tectÃ©e (index=${s}, details=${r}, metadata=${o}), suppression et recrÃ©ation...`),t.close(),await new Promise((i,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>i(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[RecipesIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),t=await e()),this.db=t,console.log(`[RecipesIDBCache] Base ouverte: ${this.dbName}`)}async loadRecipesIndex(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.RECIPES_INDEX_STORE,"readonly").objectStore(this.RECIPES_INDEX_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${i.size} recettes (index) chargÃ©es`),e(i)},o.onerror=()=>t(o.error)})}async saveRecipesIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.RECIPES_INDEX_STORE,"readwrite"),o=r.objectStore(this.RECIPES_INDEX_STORE);o.clear(),e.forEach(i=>{o.put(i)}),r.oncomplete=()=>{console.log(`[RecipesIDBCache] ${e.size} recettes (index) sauvegardÃ©es`),t()},r.onerror=()=>s(r.error)})}async loadRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).get(e);i.onsuccess=()=>{const c=i.result;c&&console.log(`[RecipesIDBCache] DÃ©tails de ${e} chargÃ©s depuis le cache`),t(c||null)},i.onerror=()=>s(i.error)})}async saveRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).put(e);i.onsuccess=()=>{console.log(`[RecipesIDBCache] DÃ©tails de ${e.$id} sauvegardÃ©s`),t()},i.onerror=()=>s(i.error)})}async loadAllRecipeDetails(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).getAll();o.onsuccess=()=>{const i=new Map;o.result.forEach(c=>{i.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${i.size} dÃ©tails de recettes chargÃ©s`),e(i)},o.onerror=()=>t(o.error)})}async loadRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE),i=new Map;let c=0;const l=e.length;for(const u of e){const d=o.get(u);d.onsuccess=()=>{const p=d.result;p&&i.set(u,p),c++,c===l&&(console.log(`[RecipesIDBCache] ${i.size}/${l} recettes chargÃ©es en bulk`),t(i))},d.onerror=()=>{console.warn(`[RecipesIDBCache] Erreur chargement ${u} en bulk:`,d.error),c++,c===l&&(console.log(`[RecipesIDBCache] ${i.size}/${l} recettes chargÃ©es en bulk (avec erreurs)`),t(i))}}l===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  charger en bulk"),t(i))})}async saveRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite"),o=r.objectStore(this.RECIPES_DETAILS_STORE);let i=0;const c=e.size;e.forEach(l=>{const u=o.put(l);u.onsuccess=()=>{i++,i===c&&(console.log(`[RecipesIDBCache] ${c} recettes sauvegardÃ©es en bulk`),t())},u.onerror=()=>{console.error(`[RecipesIDBCache] Erreur sauvegarde ${l.$id} en bulk:`,u.error),s(u.error)}}),c===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  sauvegarder en bulk"),t()),r.onerror=()=>s(r.error)})}async deleteRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const i=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).delete(e);i.onsuccess=()=>t(),i.onerror=()=>s(i.error)})}async deleteRecipeFromIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE],"readwrite"),o=r.objectStore(this.RECIPES_INDEX_STORE),i=r.objectStore(this.RECIPES_DETAILS_STORE);o.delete(e),i.delete(e),r.oncomplete=()=>{console.log(`[RecipesIDBCache] Recette ${e} supprimÃ©e de l'index et des dÃ©tails`),t()},r.onerror=()=>s(r.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const o=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();o.onsuccess=()=>{const i=o.result,c={buildTimestamp:null,lastAppwriteSync:null,recipesCount:0,cacheVersion:1};i.forEach(l=>{l.key===this.RECIPES_COUNT_KEY?c.recipesCount=l.value:l.key===this.BUILD_TIMESTAMP_KEY?c.buildTimestamp=l.value:l.key===this.LAST_APPWRITE_SYNC_KEY&&(c.lastAppwriteSync=l.value)}),console.log(`[RecipesIDBCache] Metadata chargÃ©es: count=${c.recipesCount}, build=${c.buildTimestamp}, sync=${c.lastAppwriteSync}`),e(c)},o.onerror=()=>t(o.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((t,s)=>{const r=this.db.transaction(this.METADATA_STORE,"readwrite"),o=r.objectStore(this.METADATA_STORE);o.put({key:this.BUILD_TIMESTAMP_KEY,value:e.buildTimestamp}),o.put({key:this.LAST_APPWRITE_SYNC_KEY,value:e.lastAppwriteSync}),o.put({key:this.RECIPES_COUNT_KEY,value:e.recipesCount}),r.oncomplete=()=>{console.log("[RecipesIDBCache] Metadata sauvegardÃ©es"),t()},r.onerror=()=>s(r.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,t)=>{const s=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.RECIPES_INDEX_STORE).clear(),s.objectStore(this.RECIPES_DETAILS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[RecipesIDBCache] Cache vidÃ©"),e()},s.onerror=()=>t(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[RecipesIDBCache] Connexion fermÃ©e"))}}async function gf(){const n=new mf;return await n.open(),n}function Yp(n){return n.map(e=>JSON.stringify(e))}function Lr(n){return!n||!Array.isArray(n)?[]:n.map(e=>{try{return JSON.parse(e)}catch(t){return console.warn("[ingredientUtils] Failed to parse ingredient:",e,t),null}}).filter(e=>e!==null)}const aa={"BouchÃ©es salÃ©es":"sandwich",Boisson:"cup-soda",Cake:"cake-slice","CrÃ¨mes dessert":"fast-food-pudding",Friture:"fryer",Gateau:"cake-slice",Pain:"bread","Plat au Four":"oven","Plat en Sauce":"pot",Salade:"lettuce",Sauce:"sauce",Snacking:"hamburger",Soupe:"soup","Tarte (salÃ©e)":"pizza","Tarte (sucrÃ©e)":"pie",Tartinade:"tartinade"},wf={entree:"salad",plat:"dish",dessert:"fast-food-pudding"};function Xp(n,e){const t=Array.isArray(e)?e[0]:e;if(t&&aa[t])return{label:t,iconId:aa[t]};const s=yf(n),r=wf[n]||"no-cat";return{label:s,iconId:r}}function yf(n){switch(n){case"entree":return"EntrÃ©e";case"plat":return"Plat";case"dessert":return"Dessert";default:return n}}function Mo(n){return!n||!Array.isArray(n)?[]:n.map(e=>{try{const t=JSON.parse(e);if(t&&typeof t.astuce=="string")return t;if(typeof e=="string")return{astuce:e}}catch(t){console.warn("[recipeUtils] Failed to parse astuce:",e,t)}return null}).filter(e=>e!==null)}function Zp(n){return!n||!Array.isArray(n)||n.length===0?null:n.map(e=>JSON.stringify(typeof e=="string"?{astuce:e}:e))}function vf(n){if(!n||typeof n!="object"||Array.isArray(n))throw new Error(`Format d'ingrÃ©dient invalide: ${JSON.stringify(n)}`);return{uuid:n.uuid||"",name:n.name||"",originalQuantity:n.originalQuantity||0,originalUnit:n.originalUnit||"",normalizedQuantity:n.normalizedQuantity||0,normalizedUnit:n.normalizedUnit||"",comment:n.comment||"",allergens:Array.isArray(n.allergens)?n.allergens:[],type:n.type||"",pF:n.pF??!1,pS:n.pS??!1}}function ca(n){if(!n||typeof n!="object")throw new Error("DonnÃ©es de recette invalides");const e=[];return Array.isArray(n.ingredients)&&n.ingredients.forEach(t=>{try{e.push(vf(t))}catch(s){console.warn("[parseRecipeData] IngrÃ©dient invalide ignorÃ©:",s)}}),{...n,$id:n.$id||n.id||"",$createdAt:n.$createdAt||n.createdAt||"",$updatedAt:n.$updatedAt||n.updatedAt||"",ingredients:e}}function bf(n){if(!n||typeof n!="object")throw new Error("DonnÃ©es d'index de recette invalides");const e=[];return Array.isArray(n.ingredients)&&n.ingredients.forEach(t=>{typeof t=="string"?e.push(t):t&&typeof t.name=="string"&&e.push(t.name)}),{title:n.title||"",typeR:n.typeR||"",categories:Array.isArray(n.categories)?n.categories:[],regime:n.regime||null,draft:n.draft??!1,materiel:Array.isArray(n.materiel)?n.materiel:[],region:n.region||"",serveHot:n.serveHot??!1,cuisson:n.cuisson??!1,check:n.check??!1,saison:Array.isArray(n.saison)?n.saison:[],permissionWrite:Array.isArray(n.permissionWrite)?n.permissionWrite:[],lockedBy:n.lockedBy||null,plate:n.plate??100,ingredients:e,auteur:n.auteur||"",createdBy:n.createdBy||"",$id:n.$id||n.id||"",$createdAt:n.$createdAt||n.createdAt||"",$updatedAt:n.$updatedAt||n.updatedAt||""}}function Pr(n){let e=[];return n.ingredients&&(e=Lr(n.ingredients).map(s=>s.name)),{title:n.title,typeR:n.typeR,categories:n.categories,regime:n.regime,draft:n.draft||!1,saison:n.saison,ingredients:e,materiel:n.materiel,region:n.region||null,serveHot:n.serveHot,cuisson:n.cuisson,check:n.check,auteur:n.auteur||n.createdBy,permissionWrite:n.permissionWrite,lockedBy:n.lockedBy||null,$id:n.$id,$createdAt:n.$createdAt,$updatedAt:n.$updatedAt,createdBy:n.createdBy,plate:n.plate,rootRecipeId:n.rootRecipeId||null,versionLabel:n.versionLabel||null}}function If(n,e){const t=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),s=e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"";let r;if(s){const o=t.slice(0,16),i=s.slice(0,5);r=`${o}-${i}`}else r=t.slice(0,22);return`${r}_${Kd(12).toLowerCase()}`}async function Fp(n,e,t,s,r=!1){try{const{functions:o,config:i}=await D(),c=i.functions.enkaData,l=JSON.stringify({action:n,recipeId:e,userId:t,data:s}),u=await o.createExecution({functionId:c,body:l,async:r});if(r){if(u.status==="failed")throw new Error(`Function execution failed to start: ${u.status}`);return{success:!0,executionId:u.$id}}if(u.status!=="completed")throw new Error(`Function execution failed: ${u.status} - ${u.responseBody}`);const d=JSON.parse(u.responseBody);if(!d.success)throw new Error(d.error||"Unknown error in manage_recipe");return d.data}catch(o){throw console.error(`[appwrite-recipes] Error executing manage_recipe (${n}):`,o),o}}const Pn="recettes";async function la(){try{const{tables:n,config:e}=await D();return(await n.listRows({databaseId:e.databaseId,tableId:Pn})).rows}catch(n){throw console.error("[appwrite-recipes] Error listing all recipes:",n),n}}async function Ef(n){try{const{tables:e,config:t}=await D(),s=[b.greaterThan("$updatedAt",n)];return(await e.listRows({databaseId:t.databaseId,tableId:Pn,queries:s})).rows}catch(e){throw console.error(`[appwrite-recipes] Error listing updated recipes since ${n}:`,e),e}}async function Co(n){try{const{tables:e,config:t}=await D();return await e.getRow({databaseId:t.databaseId,tableId:Pn,rowId:n})}catch(e){if(e.code===404)return null;throw console.error(`[appwrite-recipes] Error getting recipe ${n}:`,e),e}}async function eh(n,e){try{const{tables:t,config:s,account:r}=await D(),o=If(n.title,n.versionLabel||void 0),i=[J.read(ee.users()),J.update(ee.user(e)),J.delete(ee.user(e))],l=(await r.get()).name,u={title:n.title,plate:n.plate,ingredients:n.ingredients,preparation:n.preparation,draft:n.draft??!0,typeR:n.typeR,categories:n.categories??[],regime:n.regime??[],check:n.check??!1,description:n.description??null,quantite_desc:n.quantite_desc??null,region:n.region??null,saison:n.saison??[],cuisson:n.cuisson??[],serveHot:n.serveHot??!0,auteur:l,preparation24h:n.preparation24h??null,astuces:n.astuces??null,publishedAt:n.publishedAt||new Date().toISOString().split("T")[0]+"T00:00:00Z",$id:o,createdBy:e,permissionWrite:n.permissionWrite||[e],rootRecipeId:n.rootRecipeId??null,versionLabel:n.versionLabel??null},d=await t.createRow({databaseId:s.databaseId,tableId:Pn,rowId:o,data:u,permissions:i});return console.log(`[appwrite-recipes] Recipe created: ${o}`),d}catch(t){throw console.error("[appwrite-recipes] Error creating recipe:",t),t}}async function Sf(n,e,t){try{const{tables:s,config:r}=await D(),o={...e,check:e.check??!1,...e.publishedAt&&{publishedAt:e.publishedAt}},i=await s.updateRow({databaseId:r.databaseId,tableId:Pn,rowId:n,data:o});return console.log(`[appwrite-recipes] Recipe updated: ${n}`),i}catch(s){throw console.error(`[appwrite-recipes] Error updating recipe ${n}:`,s),s}}async function th(n){try{const{tables:e,config:t}=await D();await e.updateRow({databaseId:t.databaseId,tableId:Pn,rowId:n,data:{status:"deleted"}}),console.log(`[appwrite-recipes] Recipe soft deleted: ${n}`)}catch(e){throw console.error(`[appwrite-recipes] Error deleting recipe ${n}:`,e),e}}const _f="/api/data.json";var W,fe,me,Ot,Xs,x,rt,zt,Qn,he,Ur,Dc,$c,Qo,Jo;class Rf{constructor(){v(this,he);v(this,W,C(ie(new Xt)));v(this,fe,C(!1));v(this,me,C(null));v(this,Ot,C(!1));v(this,Xs,C(null));v(this,x,null);v(this,rt,new Set);v(this,zt,null);v(this,Qn,!1)}get loading(){return f(a(this,fe))}get error(){return f(a(this,me))}get isInitialized(){return f(a(this,Ot))}get recipesIndex(){return Array.from(f(a(this,W)).values())}get count(){return f(a(this,W)).size}getAllRecipes(){return Array.from(f(a(this,W)).values())}async loadCache(){if(f(a(this,Ot))){console.log("[RecipesStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[RecipesStore] Chargement du cache..."),g(a(this,fe),!0),g(a(this,me),null);try{_(this,x,await gf());const e=await a(this,x).loadRecipesIndex(),t=await a(this,x).loadMetadata();e.size>0&&(console.log(`[RecipesStore] ${e.size} recettes (index) chargÃ©es depuis le cache`),g(a(this,W),new Xt(e),!0)),g(a(this,Ot),!0),console.log(`[RecipesStore] Cache chargÃ©: ${f(a(this,W)).size} recettes`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(a(this,me),t,!0),console.error("[RecipesStore]",t,e),e}finally{g(a(this,fe),!1)}}async syncFromRemote(){if(!a(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation depuis sources distantes..."),g(a(this,fe),!0);try{const e=await a(this,x).loadMetadata();try{await I(this,he,Ur).call(this,e)}catch(t){if(console.error("[RecipesStore] Erreur chargement data.json:",t),f(a(this,W)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}if(Q.userId)try{await I(this,he,Dc).call(this,e)}catch(t){console.warn("[RecipesStore] Erreur sync Appwrite:",t)}console.log(`[RecipesStore] Synchronisation terminÃ©e: ${f(a(this,W)).size} recettes`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(a(this,me),t,!0),console.error("[RecipesStore]",t,e),e}finally{g(a(this,fe),!1)}}async syncFromRemotePublicOnly(){if(!a(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation publique (Hugo uniquement)..."),g(a(this,fe),!0);try{const e=await a(this,x).loadMetadata();try{await I(this,he,Ur).call(this,e)}catch(t){if(console.error("[RecipesStore] Erreur chargement data.json:",t),f(a(this,W)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}console.log(`[RecipesStore] Synchronisation publique terminÃ©e: ${f(a(this,W)).size} recettes`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors de la synchronisation publique";throw g(a(this,me),t,!0),console.error("[RecipesStore]",t,e),e}finally{g(a(this,fe),!1)}}async setupRealtime(){if(!a(this,x)){console.warn("[RecipesStore] Impossible de setup realtime : cache non initialisÃ©");return}if(a(this,Qn)){console.log("[RecipesStore] Realtime dÃ©jÃ  configurÃ©");return}if(console.log("[RecipesStore] Configuration du realtime..."),Q.userId)try{I(this,he,$c).call(this),_(this,Qn,!0)}catch(e){console.warn("[RecipesStore] Erreur activation realtime:",e)}}async initialize(){if(f(a(this,Ot))){console.log("[RecipesStore] DÃ©jÃ  initialisÃ©");return}return a(this,zt)?(console.log("[RecipesStore] Initialisation dÃ©jÃ  en cours, attente..."),a(this,zt)):(console.log("[RecipesStore] Initialisation..."),g(a(this,fe),!0),g(a(this,me),null),_(this,zt,(async()=>{try{if(await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),f(a(this,W)).size===0){const e="Aucune recette disponible aprÃ¨s initialisation";g(a(this,me),e),console.warn("[RecipesStore]",e)}console.log(`[RecipesStore] Initialisation complÃ©tÃ©e: ${f(a(this,W)).size} recettes`)}catch(e){const t=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(a(this,me),t,!0),console.error("[RecipesStore] ECHEC Initialisation:",t,e),e}finally{g(a(this,fe),!1),_(this,zt,null)}})()),a(this,zt))}async forceReloadAllRecipes(){if(!Q.userId)throw new Error("Utilisateur non connectÃ©");g(a(this,fe),!0),g(a(this,me),null);try{console.log("[RecipesStore] Rechargement forcÃ© des recettes Appwrite...");const e=await la();let t=0,s=0;if(e.forEach(r=>{r.status==="deleted"?f(a(this,W)).has(r.$id)&&(f(a(this,W)).delete(r.$id),s++,console.log(`[RecipesStore] Recette ${r.$id} supprimÃ©e (status=deleted)`)):(f(a(this,W)).set(r.$id,Pr(r)),t++)}),console.log(`[RecipesStore] ${t} recettes Appwrite chargÃ©es, ${s} supprimÃ©es`),a(this,x)){const r=await a(this,x).loadMetadata(),o=new Date().toISOString();await a(this,x).saveRecipesIndex(f(a(this,W))),await a(this,x).saveMetadata({...r,lastAppwriteSync:o,recipesCount:f(a(this,W)).size,cacheVersion:1})}console.log("[RecipesStore] Rechargement forcÃ© terminÃ©")}catch(e){const t=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(a(this,me),t,!0),console.error("[RecipesStore] Erreur rechargement forcÃ©:",e),e}finally{g(a(this,fe),!1)}}async hardReset(){if(!Q.userId)throw new Error("Utilisateur non connectÃ©");console.log("[RecipesStore] ð HARD RESET - Vidage complet..."),g(a(this,fe),!0),g(a(this,me),null);try{f(a(this,W)).clear(),a(this,x)&&(await a(this,x).clear(),console.log("[RecipesStore] Cache IDB vidÃ©")),await I(this,he,Ur).call(this,null);const e=await la();let t=0,s=0;if(e.forEach(r=>{r.status!=="deleted"?(f(a(this,W)).set(r.$id,Pr(r)),t++):s++}),console.log(`[RecipesStore] ${t} recettes Appwrite chargÃ©es, ${s} supprimÃ©es ignorÃ©es`),a(this,x)){const r=new Date().toISOString();await a(this,x).saveRecipesIndex(f(a(this,W))),await a(this,x).saveMetadata({buildTimestamp:f(a(this,Xs)),lastAppwriteSync:r,recipesCount:f(a(this,W)).size,cacheVersion:1}),console.log("[RecipesStore] Cache IDB recrÃ©Ã©")}console.log("[RecipesStore] â HARD RESET terminÃ©")}catch(e){const t=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(a(this,me),t,!0),console.error("[RecipesStore] Erreur hard reset:",e),e}finally{g(a(this,fe),!1)}}getRecipeIndexByUuid(e){return f(a(this,W)).get(e)||null}searchRecipes(e){if(!e.trim())return this.recipesIndex;const t=I(this,he,Qo).call(this,e.trim()).split(/\s+/);return this.recipesIndex.filter(s=>{const o=I(this,he,Qo).call(this,s.title).split(/[\s\-_]+/);return t.every(i=>o.some(c=>c.startsWith(i)))})}get availableTypes(){const e=new Set;return this.recipesIndex.forEach(t=>e.add(t.typeR)),Array.from(e).sort()}async canEditRecipe(e){if(!Q.userId)return!1;try{const t=await Co(e);return t?t.createdBy===Q.userId||!!t.permissionWrite?.includes(Q.userId)||!!t.teams?.some(s=>Q.userTeams.includes(s)):!1}catch(t){return console.error(`[RecipesStore] Erreur lors de la vÃ©rification des permissions pour ${e}:`,t),!1}}getRecipeLockStatus(e){return f(a(this,W)).get(e)?.lockedBy||null}async updateRecipeLock(e,t){if(Q.userId)try{await Sf(e,{lockedBy:t},Q.userId),console.log(`[RecipesStore] Verrou ${e} mis Ã  jour: ${t||"libÃ©rÃ©"}`);const s=f(a(this,W)).get(e);s&&f(a(this,W)).set(e,{...s,lockedBy:t})}catch(s){throw console.error(`[RecipesStore] Erreur verrouillage ${e}:`,s),s}}async getRecipeByUuid(e){if(a(this,rt).has(e)){for(console.log(`[RecipesStore] Chargement de ${e} dÃ©jÃ  en cours, attente...`);a(this,rt).has(e);)await new Promise(t=>setTimeout(t,50));return a(this,x)&&await a(this,x).loadRecipeDetail(e)||null}a(this,rt).add(e);try{if(a(this,x)){const s=await a(this,x).loadRecipeDetail(e);if(s)return s}let t=null;try{const s=`/recettes/${e}/recipe.json`,r=await fetch(s);if(r.ok){const o=await r.json();t=ca(o),console.log(`[RecipesStore] ${e} chargÃ©e depuis Hugo`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Hugo`)}if(!t&&Q.userId)try{const s=await Co(e);if(s){const r=Lr(s.ingredients||[]);t={...s,ingredients:r,astuces:Mo(s.astuces),prepAlt:s.prepAlt||null,categories:s.categories,regime:s.regime,saison:s.saison,teams:s.teams,permissionWrite:s.permissionWrite},console.log(`[RecipesStore] ${e} chargÃ©e depuis Appwrite (fallback)`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Appwrite`)}return t&&a(this,x)&&await a(this,x).saveRecipeDetail(t),t||console.warn(`[RecipesStore] ${e} non trouvÃ©e (Hugo ni Appwrite)`),t}catch(t){return console.error(`[RecipesStore] Erreur lors du chargement de ${e}:`,t),null}finally{a(this,rt).delete(e)}}async getRecipesByUuidsBulk(e){const t=performance.now(),s=[...new Set(e.filter(Boolean))];if(s.length===0)return new Map;console.log(`[RecipesStore] Chargement bulk de ${s.length} recettes...`);const r=new Map;a(this,x)&&(await a(this,x).loadRecipeDetailsBulk(s)).forEach((d,p)=>r.set(p,d));const o=s.filter(u=>!r.has(u));console.log(`[RecipesStore] Bulk: ${r.size} dans le cache, ${o.length} Ã  fetch`);const i=new Map;if(o.length>0){o.forEach(u=>a(this,rt).add(u));try{const u=o.map(async p=>{let h=null;try{const m=`/recettes/${p}/recipe.json`,w=await fetch(m);if(w.ok){const E=await w.json();h=ca(E)}}catch{}if(!h&&Q.userId)try{const m=await Co(p);if(m){const w=Lr(m.ingredients||[]);h={...m,ingredients:w,astuces:Mo(m.astuces),prepAlt:m.prepAlt||null,categories:m.categories,regime:m.regime,saison:m.saison,teams:m.teams,permissionWrite:m.permissionWrite}}}catch{}return h?{uuid:p,recipe:h}:null});(await Promise.all(u)).forEach(p=>{p&&i.set(p.uuid,p.recipe)}),i.size>0&&a(this,x)&&await a(this,x).saveRecipeDetailsBulk(i),o.forEach(p=>a(this,rt).delete(p))}catch(u){console.error("[RecipesStore] Erreur lors du fetch bulk:",u),o.forEach(d=>a(this,rt).delete(d))}}const c=new Map([...r,...i]),l=performance.now()-t;return console.log(`[RecipesStore] Bulk terminÃ©: ${c.size}/${s.length} recettes en ${l.toFixed(0)}ms`),c}async preloadRecipes(e){console.log(`[RecipesStore] PrÃ©chargement de ${e.length} recettes...`);const t=e.map(s=>this.getRecipeByUuid(s));await Promise.all(t),console.log("[RecipesStore] PrÃ©chargement terminÃ©")}async getVariantGroup(e,t=2){const s=this.getRecipeIndexByUuid(e);if(!s)return{root:null,variants:[],isRoot:!1};const r=new Map,o=new Set;let i=s;for(;i.rootRecipeId&&!o.has(i.rootRecipeId);){o.add(i.$id);const l=this.getRecipeIndexByUuid(i.rootRecipeId);if(!l)break;i=l}const c=i;return r.set(c.$id,c),await I(this,he,Jo).call(this,c.$id,r,new Set([c.$id]),0,t),{root:c,variants:Array.from(r.values()),isRoot:!s.rootRecipeId||s.rootRecipeId===s.$id}}findRootRecipe(e){const t=new Set;let s=e,r=10;for(let o=0;o<r;o++){const i=this.getRecipeIndexByUuid(s);if(!i||!i.rootRecipeId)return s;if(t.has(s))return console.error("[RecipesStore] Cycle dÃ©tectÃ© dans rootRecipeId, retour Ã ",e),e;t.add(s),s=i.rootRecipeId}return e}destroy(){a(this,x)&&(a(this,x).close(),_(this,x,null)),f(a(this,W)).clear(),g(a(this,Ot),!1),_(this,Qn,!1),console.log("[RecipesStore] Ressources nettoyÃ©es")}}W=new WeakMap,fe=new WeakMap,me=new WeakMap,Ot=new WeakMap,Xs=new WeakMap,x=new WeakMap,rt=new WeakMap,zt=new WeakMap,Qn=new WeakMap,he=new WeakSet,Ur=async function(e){try{console.log("[RecipesStore] Chargement data.json...");const t=await fetch(_f);if(!t.ok)throw new Error(`Erreur HTTP: ${t.status}`);const s=await t.json();if(!Array.isArray(s.recipes))throw new Error("Format invalide: recipes n'est pas un tableau");const r=s.meta?.timestamp;if(g(a(this,Xs),r,!0),r&&e&&e.buildTimestamp&&e.buildTimestamp>=r){console.log(`[RecipesStore] Cache Ã  jour (Ts: ${e.buildTimestamp} >= ${r})`);return}console.log(`[RecipesStore] Nouvelle version dÃ©tectÃ©e ou cache manquant (Ts: ${r}), Traitement...`);const o=s.recipes.map(c=>bf(c));let i=0;o.forEach(c=>{const l=f(a(this,W)).get(c.$id);let u=!1;if(!l)u=!0;else{const d=new Date(c.$updatedAt).getTime(),p=new Date(l.$updatedAt).getTime();d>p&&(u=!0)}u&&(f(a(this,W)).set(c.$id,c),i++)}),console.log(`[RecipesStore] Smart Merge: ${i} recettes mises Ã  jour/ajoutÃ©es.`),a(this,x)&&(await a(this,x).saveRecipesIndex(f(a(this,W))),await a(this,x).saveMetadata({...e,buildTimestamp:r||Date.now()/1e3,recipesCount:f(a(this,W)).size,cacheVersion:1}))}catch(t){throw console.error("[RecipesStore] Erreur loadIndexFromDataJson:",t),t}},Dc=async function(e){console.log("[RecipesStore] Sync incrÃ©mentiel Appwrite...");const t=e?.lastAppwriteSync||"1970-01-01T00:00:00.000Z";e?.buildTimestamp&&new Date(e.buildTimestamp*1e3).toISOString(),console.log(`[RecipesStore] Sync Appwrite: depuis ${t}`);const s=await Ef(t);if(s.length===0){console.log("[RecipesStore] Aucune mise Ã  jour Appwrite dÃ©tectÃ©e.");return}console.log(`[RecipesStore] ${s.length} recettes mises Ã  jour depuis Appwrite.`);let r=0,o=0;s.forEach(c=>{if(c.status==="deleted")f(a(this,W)).has(c.$id)&&(f(a(this,W)).delete(c.$id),o++,console.log(`[RecipesStore] Recette ${c.$id} supprimÃ©e (status=deleted)`));else{const l=Pr(c);f(a(this,W)).set(l.$id,l),r++}});const i=new Date().toISOString();a(this,x)&&(await a(this,x).saveRecipesIndex(f(a(this,W))),await a(this,x).saveMetadata({...e,lastAppwriteSync:i})),console.log(`[RecipesStore] Sync incrÃ©mentiel terminÃ© (${r} mises Ã  jour, ${o} supprimÃ©es).`)},$c=async function(){try{console.log("[RecipesStore] Configuration du Realtime...");const e=Ct();mr.register([`databases.${e}.collections.${Pn}.documents`],async t=>{const s=t.payload;let r="update";if(t.events.some(o=>o.includes(".create"))?r="create":t.events.some(o=>o.includes(".delete"))&&(r="delete"),console.log(`[RecipesStore] â¡ï¸ Realtime RECEIVED: ${r} pour ${s.$id}`),r==="create"||r==="update"){if(s.status==="deleted"){if(f(a(this,W)).delete(s.$id),a(this,x))try{await a(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e de l'index (status=deleted)`)}catch(l){console.warn(`[RecipesStore] Erreur suppression index ${s.$id}:`,l)}return}const o=Pr(s);f(a(this,W)).set(s.$id,o);const i=Lr(s.ingredients),c={...s,ingredients:i,astuces:Mo(s.astuces)};if(a(this,x))try{await a(this,x).saveRecipeDetail(c),console.log(`[RecipesStore] DÃ©tails de ${s.$id} mis Ã  jour dans le cache`)}catch(l){console.warn(`[RecipesStore] Erreur mise Ã  jour cache dÃ©tails ${s.$id}:`,l)}}else if(r==="delete"&&(f(a(this,W)).delete(s.$id),a(this,x)))try{await a(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e du cache`)}catch(o){console.warn(`[RecipesStore] Erreur suppression cache ${s.$id}:`,o)}}),console.log("[RecipesStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[RecipesStore] Erreur lors de la configuration du realtime:",e)}},Qo=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},Jo=async function(e,t,s,r,o){if(!(r>o))for(const[i,c]of f(a(this,W)))t.has(i)||c.rootRecipeId===e&&(t.set(i,c),c.rootRecipeId&&c.rootRecipeId!==e&&!s.has(c.rootRecipeId)&&(s.add(c.rootRecipeId),await I(this,he,Jo).call(this,c.rootRecipeId,t,s,r+1,o)))};const ua=new Rf,da=1e3;var H,$e,ge,Me,Wt,Zs,Jn,wn,yn,Ee,Y,Gt,Fs,k,xr,B,er,tr,nr,sr,rr,so,or,ir,ro,Mc,Kn,yt,Cc,Nc,Br,Hr,kc,Ko,Tf,ps,qc,jc,Lc,Uc,xc,Or,Bc,Hc,Oc,ar,cr;class Af{constructor(){v(this,k);v(this,H,new Xt);v(this,$e,new Xt);v(this,ge,C(null));v(this,Me,C(null));v(this,Wt,C(!1));v(this,Zs,C(!1));v(this,Jn,C(null));v(this,wn,C(!1));v(this,yn,C(!1));v(this,Ee,C(null));j(this,"dateStore",new hf);v(this,Y,null);v(this,Gt,null);v(this,Fs,C(ie([])));v(this,B,C(ie({searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"})));v(this,er,X(()=>{const e=Array.from(a(this,H).values()).map(t=>t.data);return console.log(`[ProductsStore] enrichedProducts recalculated: ${e.length} products`),e}));v(this,tr,X(()=>{if(console.log("[Store] Filtering products by date range (Map)"),!this.dateRange.start||!this.dateRange.end)return new Map;const e=new Date(this.dateRange.start),t=new Date(this.dateRange.end),s=new Map;for(const[r,o]of a(this,H)){const i=o.data,c=!i.productHugoUuid;if(!i.byDate&&!c||!ad(i,f(a(this,B))))continue;if(f(a(this,B)).completionStatus!=="all"){const d=o.stats.hasMissing;if(f(a(this,B)).completionStatus==="completed"&&d||f(a(this,B)).completionStatus==="incomplete"&&!d)continue}let u=!1;if(i.byDate){const d=new Date(e);d.setHours(0,0,0,0);const p=new Date(t);p.setHours(23,59,59,999),u=Object.keys(i.byDate).some(h=>{const m=new Date(h);return m>=d&&m<=p})}(u||c)&&s.set(r,o)}return s}));v(this,nr,X(()=>({total:a(this,H).size,frais:Array.from(a(this,H).values()).filter(e=>e.pF).length,surgel:Array.from(a(this,H).values()).filter(e=>e.pS).length,merged:Array.from(a(this,H).values()).filter(e=>e.data.isMerged).length})));v(this,sr,X(()=>{const e=Array.from(a(this,H).values()).map(t=>t.storeInfo?.storeName).filter(Boolean);return[...new Set(e)]}));v(this,rr,X(()=>{if(!f(a(this,Me)))return[];const e=It.getEventById(f(a(this,Me)));return e?.contributors?e.contributors.filter(t=>t.status==="accepted"&&t.name?.trim()).map(t=>t.name.trim()).sort():[]}));v(this,so,X(()=>{const e=Array.from(a(this,H).values()).flatMap(t=>t.who||[]);return[...new Set(e)].sort()}));v(this,or,X(()=>{const e=new Set([...this.eventContributors,...f(a(this,so))]);return Array.from(e).sort()}));v(this,ir,X(()=>{const e=Array.from(a(this,H).values()).map(t=>t.productType).filter(Boolean);return[...new Set(e)]}));v(this,ro,X(()=>{const t=Array.from(this.filteredProductsMap.values()).sort((i,c)=>i.$id.localeCompare(c.$id));if(f(a(this,B)).groupBy==="none")return{"":t};const s=Object.groupBy(t,i=>f(a(this,B)).groupBy==="store"?i.storeInfo?.storeName||"Non dÃ©fini":i.productType||"Non dÃ©fini"),r=Object.keys(s).sort((i,c)=>i===""?1:c===""?-1:i.localeCompare(c)),o={};return r.forEach(i=>{o[i]=s[i]}),o}));v(this,Kn,"");v(this,yt,null);j(this,"setSearchQuery",td(e=>{f(a(this,B)).searchQuery=e},()=>500));v(this,ar,X(()=>{let e=0,t=0;for(const s of a(this,H).values())s.stats.hasMissing?t++:e++;return{completed:e,missing:t,total:e+t}}));v(this,cr,X(()=>{let e=0;const t={},s={},r=[];for(const o of a(this,$e).values()){const i=o.invoiceTotal||o.price||0;e+=i;const c=o.store||"Non dÃ©fini";t[c]=(t[c]||0)+i;const l=o.who||"Non dÃ©fini";s[l]=(s[l]||0)+i,r.push(o)}for(const o of a(this,H).values()){const i=o.data;if(i.purchases&&i.purchases.length>0){for(const c of i.purchases)if(c.price){e+=c.price;const l=c.store||"Non dÃ©fini";t[l]=(t[l]||0)+c.price;const u=c.who||"Non dÃ©fini";s[u]=(s[u]||0)+c.price;const d={...c,_productName:i.productName};r.push(d)}}}return r.sort((o,i)=>{const c=new Date(o.orderDate||o.$createdAt).getTime();return new Date(i.orderDate||i.$createdAt).getTime()-c}),{totalGlobal:e,byStore:t,byWho:s,allPurchases:r}}))}get currentMainId(){return f(a(this,ge))}get dateRange(){return this.dateStore.current}get availableDates(){return this.dateStore.dates}get isEventPassed(){return this.dateStore.isEventPassed}get hasSingleDateEvent(){return this.dateStore.hasSingleDateEvent}get hasSingleDateInRange(){return this.dateStore.hasSingleDateInRange}get hasPastDatesInRange(){return this.dateStore.hasPastDatesInRange}get hasPendingConflicts(){return f(a(this,Fs)).length>0}get pendingConflicts(){return f(a(this,Fs))}get filters(){return f(a(this,B))}get hasFilters(){return this.filters.searchQuery!==""||this.filters.selectedStores.length>0||this.filters.selectedWho.length>0||this.filters.selectedProductTypes.length>0||this.filters.selectedTemperatures.length>0||this.filters.temperatureFilter!=="all"||this.filters.completionStatus!=="all"}get groupedFilteredProducts(){return f(a(this,ro))}get loading(){return f(a(this,Zs))}get error(){return f(a(this,Jn))}get lastSync(){return f(a(this,Ee))}get syncing(){return f(a(this,wn))}setDateRange(e,t){this.dateStore.setRange(e,t)}isFullRange(){return this.dateStore.isFullRange}initializeDateRange(){this.dateStore.initializeSmartRange()}selectUpcomingDates(){this.dateStore.selectUpcoming()}isUpcomingRange(){return this.dateStore.isUpcomingRange}get firstAvailableDate(){return this.dateStore.firstAvailableDate}get lastAvailableDate(){return this.dateStore.lastAvailableDate}selectFutureDatesOnly(){this.dateStore.selectFutureDatesOnly()}get realtimeConnected(){return f(a(this,yn))}get enrichedProducts(){return f(a(this,er))}set enrichedProducts(e){g(a(this,er),e)}get filteredProductsMap(){return f(a(this,tr))}set filteredProductsMap(e){g(a(this,tr),e)}get stats(){return f(a(this,nr))}set stats(e){g(a(this,nr),e)}get uniqueStores(){return f(a(this,sr))}set uniqueStores(e){g(a(this,sr),e)}get eventContributors(){return f(a(this,rr))}set eventContributors(e){g(a(this,rr),e)}get uniqueWho(){return f(a(this,or))}set uniqueWho(e){g(a(this,or),e)}get uniqueProductTypes(){return f(a(this,ir))}set uniqueProductTypes(e){g(a(this,ir),e)}async initialize(e){if(!e?.trim())throw new Error("eventId invalide fourni");if(f(a(this,Wt))&&f(a(this,Me))===e){console.log(`[ProductsStore] DÃ©jÃ  initialisÃ© pour eventId: ${e}`);return}f(a(this,Wt))&&f(a(this,Me))!==e&&(console.log(`[ProductsStore] Changement d'Ã©vÃ©nement: ${f(a(this,Me))} â ${e}, reset...`),this.reset()),console.log(`[ProductsStore] Initialisation avec eventId: ${e}`);const t=It.getEventById(e);if(!t)throw new Error(`ÃvÃ©nement ${e} introuvable dans EventsStore`);try{g(a(this,Me),t.$id,!0),g(a(this,ge),t.$id,!0),Q.setCurrentMainId(f(a(this,ge))),console.log(`[ProductsStore] Initialisation du cache IDB pour mainId: ${f(a(this,ge))}`),_(this,Y,await pf(f(a(this,ge)))),await I(this,k,Nc).call(this),a(this,H).size===0&&(console.log("[ProductsStore] Cache vide, calcul depuis event.meals..."),await I(this,k,Cc).call(this,t),await I(this,k,Br).call(this)),this.dateStore.setAvailableDates([...t.allDates||[]]),this.initializeDateRange(),await this.syncFromAppwrite(),await I(this,k,Oc).call(this),g(a(this,Wt),!0);const s=I(this,k,Bc).call(this);I(this,k,Hc).call(this,s),a(this,yt)&&a(this,yt).call(this),_(this,yt,tu(()=>{Wr(()=>{const r=It.getEventById(e);r&&I(this,k,Mc).call(this,r)})})),console.log(`[ProductsStore] Initialisation complÃ©tÃ©e: ${a(this,H).size} produits`)}catch(s){const r=s instanceof Error?s.message:"Erreur lors de l'initialisation";throw g(a(this,Jn),r,!0),console.error("[ProductsStore]",r,s),s}}async syncFromAppwrite(){if(I(this,k,xr).call(this)){console.log("[ProductsStore] Mode local: skip syncFromAppwrite");return}if(f(a(this,ge))){g(a(this,wn),!0),console.log(`[ProductsStore] DÃ©but syncFromAppwrite pour mainId: ${f(a(this,ge))}`);try{console.log(`[ProductsStore] RÃ©cupÃ©ration des produits modifiÃ©s depuis lastSync: ${f(a(this,Ee))}`);const e=await cf(f(a(this,ge)),{lastSync:f(a(this,Ee)),limit:da});if(console.log(`[ProductsStore] ${e.length} produits rÃ©cupÃ©rÃ©s depuis Appwrite`),e.forEach(t=>{const s=a(this,H).get(t.$id);console.log(`[ProductsStore] Sync produit ${t.$id}: existing=${!!s}, who=${t.who}, store=${t.store}`);const r=I(this,k,Ko).call(this,t,s?.data);r.isSynced=!0,r.status="active",s?s.update(r):a(this,H).set(t.$id,new ls(r,this.dateStore))}),f(a(this,Ee))){console.log(`[ProductsStore] RÃ©cupÃ©ration des purchases modifiÃ©s depuis lastSync: ${f(a(this,Ee))}`);const t=await af(f(a(this,ge)),f(a(this,Ee)),da);console.log(`[ProductsStore] ${t.length} purchases modifiÃ©s rÃ©cupÃ©rÃ©s`),t.forEach(s=>{if(s.status==="expense")a(this,$e).set(s.$id,s);else if(s.products?.length){const r=s.products.map(o=>typeof o=="string"?o:o.$id);I(this,k,Or).call(this,r,s)}})}I(this,k,kc).call(this),await I(this,k,Br).call(this),console.log("[ProductsStore] SyncFromAppwrite terminÃ© avec succÃ¨s")}catch(e){throw console.error("[ProductsStore] Erreur lors du sync:",e),e}finally{g(a(this,wn),!1)}}}toggleProductType(e){const t=f(a(this,B)).selectedProductTypes.indexOf(e);t>-1?f(a(this,B)).selectedProductTypes.splice(t,1):f(a(this,B)).selectedProductTypes.push(e)}toggleTemperature(e){const t=f(a(this,B)).selectedTemperatures.indexOf(e);t>-1?f(a(this,B)).selectedTemperatures.splice(t,1):f(a(this,B)).selectedTemperatures.push(e)}setTemperatureFilter(e){f(a(this,B)).temperatureFilter=e}clearTypeAndTemperatureFilters(){f(a(this,B)).selectedProductTypes=[],f(a(this,B)).selectedTemperatures=[],f(a(this,B)).temperatureFilter="all"}setGroupBy(e){f(a(this,B)).groupBy=e}toggleStore(e){const t=f(a(this,B)).selectedStores.indexOf(e);t>-1?f(a(this,B)).selectedStores.splice(t,1):f(a(this,B)).selectedStores.push(e)}toggleWho(e){const t=f(a(this,B)).selectedWho.indexOf(e);t>-1?f(a(this,B)).selectedWho.splice(t,1):f(a(this,B)).selectedWho.push(e)}clearStoreFilters(){f(a(this,B)).selectedStores=[]}clearWhoFilters(){f(a(this,B)).selectedWho=[]}setCompletionStatus(e){f(a(this,B)).completionStatus=e}handleSort(e){f(a(this,B)).sortColumn===e?f(a(this,B)).sortDirection=f(a(this,B)).sortDirection==="asc"?"desc":"asc":(f(a(this,B)).sortColumn=e,f(a(this,B)).sortDirection="asc")}clearFilters(){g(a(this,B),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0)}sortProducts(e){return f(a(this,B)).sortColumn?[...e].sort((t,s)=>{let r=t[f(a(this,B)).sortColumn],o=s[f(a(this,B)).sortColumn];return f(a(this,B)).sortColumn==="totalNeededConsolidated"?(r=parseFloat(r)||0,o=parseFloat(o)||0):f(a(this,B)).sortColumn==="purchases"&&(r=t.purchases?.length||0,o=s.purchases?.length||0),r<o?f(a(this,B)).sortDirection==="asc"?-1:1:r>o?f(a(this,B)).sortDirection==="asc"?1:-1:0}):e}getEnrichedProductById(e){return a(this,H).get(e)?.data??null}getProductModelById(e){return a(this,H).get(e)??null}hasConversions(e){const t=a(this,H).get(e)?.data;return t?.byDate?od(t.byDate):!1}async forceReload(e){await this.clearCache(),await this.initialize(e)}async clearCache(){a(this,H).clear(),g(a(this,Ee),null),a(this,Y)&&await a(this,Y).clear(),console.log("[ProductsStore] Cache vidÃ©")}setSyncStatus(e,t){const s=t?"isSyncing":"active";e.forEach(r=>{const o=a(this,H).get(r);if(o){const i={...o.data,status:s};o.update(i)}}),console.log(`[ProductsStore] Statut de synchronisation mis Ã  jour: ${e.length} produits â ${s}`)}clearSyncStatus(){const e=[];for(const[t,s]of a(this,H))s.status==="isSyncing"&&e.push(t);e.length>0&&(this.setSyncStatus(e,!1),console.log(`[ProductsStore] Nettoyage de ${e.length} produits en statut "isSyncing"`))}reset(){var e;console.log(`[ProductsStore] Reset pour eventId: ${f(a(this,Me))}`),(e=a(this,Gt))==null||e.call(this),_(this,Gt,null),a(this,yt)&&(a(this,yt).call(this),_(this,yt,null)),a(this,Y)&&(a(this,Y).close(),_(this,Y,null)),a(this,H).clear(),a(this,$e).clear(),g(a(this,ge),null),g(a(this,Me),null),g(a(this,Wt),!1),g(a(this,Zs),!1),g(a(this,Jn),null),g(a(this,wn),!1),g(a(this,yn),!1),g(a(this,Ee),null),_(this,Kn,""),this.dateStore.reset(),g(a(this,B),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0),console.log("[ProductsStore] Reset terminÃ©")}destroy(){var e;(e=a(this,Gt))==null||e.call(this),_(this,Gt,null),a(this,Y)&&(a(this,Y).close(),_(this,Y,null)),console.log("[ProductsStore] Ressources nettoyÃ©es")}get completionStats(){return f(a(this,ar))}set completionStats(e){g(a(this,ar),e)}get financialStats(){return f(a(this,cr))}set financialStats(e){g(a(this,cr),e)}}H=new WeakMap,$e=new WeakMap,ge=new WeakMap,Me=new WeakMap,Wt=new WeakMap,Zs=new WeakMap,Jn=new WeakMap,wn=new WeakMap,yn=new WeakMap,Ee=new WeakMap,Y=new WeakMap,Gt=new WeakMap,Fs=new WeakMap,k=new WeakSet,xr=function(){return f(a(this,Me))?It.getEventById(f(a(this,Me)))?.status==="local":!1},B=new WeakMap,er=new WeakMap,tr=new WeakMap,nr=new WeakMap,sr=new WeakMap,rr=new WeakMap,so=new WeakMap,or=new WeakMap,ir=new WeakMap,ro=new WeakMap,Mc=async function(e){if(!f(a(this,Wt))){console.warn("[ProductsStore] Sync ignorÃ© car store non initialisÃ©");return}const t=JSON.stringify(e.meals);if(a(this,Kn)===t)return;console.log(`[ProductsStore] â¡ï¸ CHANGEMENT REPAS DÃTECTÃ pour ${e.$id} (Hash: ${t.substring(0,10)}...), recalcul...`),_(this,Kn,t);const r=await Gi(e,async i=>await ua.getRecipeByUuid(i),e.$id);r.forEach(i=>{const c=a(this,H).get(i.$id);if(c){const u={...c.data,byDate:i.byDate,totalNeededArray:i.totalNeededArray,totalNeededRaw:i.totalNeededRaw,nbRecipes:i.nbRecipes,totalAssiettes:i.totalAssiettes};gd(u),c.update(u)}else a(this,H).set(i.$id,new ls(i,this.dateStore))});const o=new Set(r.map(i=>i.$id));for(const[i,c]of a(this,H))o.has(i)||!c.data.isSynced&&!c.data.purchases?.length&&a(this,H).delete(i);this.dateStore.setAvailableDates([...e.allDates||[]]),I(this,k,Br).call(this)},Kn=new WeakMap,yt=new WeakMap,Cc=async function(e){const s=await Gi(e,async r=>await ua.getRecipeByUuid(r),e.$id);s.forEach(r=>{a(this,H).set(r.$id,new ls(r,this.dateStore))}),console.log(`[ProductsStore] ${s.length} produits calculÃ©s depuis ${e.meals.length} repas`)},Nc=async function(){if(a(this,Y))try{const e=await a(this,Y).loadProducts();e.forEach((s,r)=>{s.status==="isSyncing"&&(s.status="active"),a(this,H).set(r,new ls(s,this.dateStore))});const t=await a(this,Y).loadMetadata();g(a(this,Ee),t.lastSync,!0),this.dateStore.setAvailableDates([...t.allDates]),console.log(`[ProductsStore] ${e.size} produits chargÃ©s du cache IDB, lastSync: ${t.lastSync}`)}catch(e){console.warn("[ProductsStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Br=async function(){if(a(this,Y))try{const e=new Map;a(this,H).forEach((t,s)=>{const r=Sr(t.data);r.status==="isSyncing"&&(r.status="active"),e.set(s,r)}),await a(this,Y).saveProducts(e),await a(this,Y).saveMetadata({lastSync:f(a(this,Ee)),allDates:[...this.dateStore.dates]}),console.log("[ProductsStore] Cache IDB persistÃ©")}catch(e){console.error("[ProductsStore] Erreur persist cache IDB:",e)}},Hr=async function(e){if(!(!a(this,Y)||e.length===0))try{const t=e.map(s=>a(this,H).get(s)?.data).filter(s=>s!=null).map(s=>{const r=Sr(s);return r.status==="isSyncing"&&(r.status="active"),a(this,Y).upsertProduct(r)});t.length>0&&(await Promise.all(t),console.log(`[ProductsStore] ${t.length} produits affectÃ©s persistÃ©s`))}catch(t){console.error("[ProductsStore] Erreur persistence produits affectÃ©s:",t)}},kc=function(){g(a(this,Ee),new Date().toISOString(),!0)},Ko=function(e,t){return t?Tr(e,t):md(e)},Tf=function(e){e.length&&(e.forEach(t=>I(this,k,ps).call(this,t)),console.log(`[ProductsStore] ${e.length} produits upserted`))},ps=function(e){const t=a(this,H).get(e.$id),s=I(this,k,Ko).call(this,e,t?.data);t?t.update(s):(this.dateStore.dates,a(this,H).set(e.$id,new ls(s,this.dateStore)))},qc=function(e){a(this,H).delete(e)},jc=async function(e){if(!e.products?.length)return console.warn("[ProductsStore] Purchase crÃ©Ã© sans products:",e.$id),[];const t=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return I(this,k,xc).call(this,t,e),t},Lc=async function(e){if(e.products?.length){const t=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return I(this,k,Or).call(this,t,e),t}console.log("[ProductsStore] Purchase update sans products[], rechargement...");try{const[t]=await uf([e.$id]);if(t?.products?.length){const s=t.products.map(r=>typeof r=="string"?r:r.$id).filter(Boolean);return I(this,k,Or).call(this,s,t),s}return[]}catch(t){return console.error("[ProductsStore] Erreur rechargement purchase:",t),[]}},Uc=async function(e){const t=Array.from(a(this,H).values()).map(s=>s.data).filter(s=>s.purchases?.some(r=>r.$id===e));return t.forEach(s=>{I(this,k,ps).call(this,s)}),t.map(s=>s.$id)},xc=function(e,t){const s=Wi(t),r=[];e.forEach(o=>{const i=a(this,H).get(o);if(i){const c=i.data,l=c.purchases||[];if(!l.some(u=>u.$id===s.$id)){const u=Tr({...c,purchases:[...l,s],status:"active"},c);r.push(u)}}}),r.forEach(o=>{const i=a(this,H).get(o.$id);i&&i.update(o)})},Or=function(e,t){const s=Wi(t),r=[];e.forEach(o=>{const i=a(this,H).get(o);if(i){const c=i.data,l=c.purchases||[],u=l.findIndex(d=>d.$id===s.$id);if(u>=0){const d=[...l];d[u]=s;const p=Tr({...c,purchases:d,status:"active"},c);r.push(p)}else{const d=Tr({...c,purchases:[...l,t],status:"active"},c);r.push(d)}}}),r.forEach(o=>{const i=a(this,H).get(o.$id);i&&i.update(o)})},Bc=function(){return{onProductCreate:e=>{if(I(this,k,ps).call(this,e),a(this,Y)){const t=a(this,H).get(e.$id);t&&a(this,Y).upsertProduct(Sr(t.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},onProductUpdate:e=>{if(I(this,k,ps).call(this,e),a(this,Y)){const t=a(this,H).get(e.$id);t&&a(this,Y).upsertProduct(Sr(t.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},onProductDelete:e=>{I(this,k,qc).call(this,e),a(this,Y)&&a(this,Y).deleteProduct(e).catch(t=>console.error("[ProductsStore] Erreur suppression produit:",t))},onPurchaseCreate:async e=>{if(e.status==="expense"){a(this,$e).set(e.$id,e);return}const t=await I(this,k,jc).call(this,e);await I(this,k,Hr).call(this,t)},onPurchaseUpdate:async e=>{if(e.status==="expense"){a(this,$e).set(e.$id,e);return}a(this,$e).has(e.$id)&&a(this,$e).delete(e.$id);const t=await I(this,k,Lc).call(this,e);await I(this,k,Hr).call(this,t)},onPurchaseDelete:async e=>{if(a(this,$e).has(e)){a(this,$e).delete(e);return}const t=await I(this,k,Uc).call(this,e);await I(this,k,Hr).call(this,t)},onConnect:()=>{g(a(this,yn),!0)},onDisconnect:()=>{g(a(this,yn),!1)},onError:e=>{console.error("[ProductsStore] Erreur realtime:",e)}}},Hc=function(e){if(I(this,k,xr).call(this)){console.log("[ProductsStore] Mode local: skip realtime setup");return}const t=Ct(),s=on("products"),r=on("purchases"),o=[`databases.${t}.collections.${s}.documents`,`databases.${t}.collections.${r}.documents`],i=c=>{const{events:l,payload:u}=c;if(!u)return;if(c.event==="client.connected"){e.onConnect();return}const d=l.some(E=>E.includes("products.")),p=l.some(E=>E.includes("purchases.")),h=l.some(E=>E.includes(".create")),m=l.some(E=>E.includes(".update")),w=l.some(E=>E.includes(".delete"));if(d){const E=u;E.updatedBy&&E.updatedBy!==Q.userName&&(h||m?bt.info(`${E.updatedBy} a modifiÃ© le produit "${E.productName}"`,{source:"realtime-other"}):w&&bt.info(`${E.updatedBy} a supprimÃ© un produit`,{source:"realtime-other"})),h&&e.onProductCreate?e.onProductCreate(E):m&&e.onProductUpdate?e.onProductUpdate(E):w&&e.onProductDelete&&e.onProductDelete(E.$id)}else if(p){const E=u;if(E.createdBy&&E.createdBy!==Q.userName){const S="un produit";h&&E.who!==Q.userName?bt.info(`${E.who} a ajoutÃ© un achat pour ${S}`,{source:"realtime-other"}):m&&E.who!==Q.userName?bt.info(`${E.who} a modifiÃ© un achat pour ${S}`,{source:"realtime-other"}):w&&bt.info(`${E.who} a supprimÃ© un achat pour ${S}`,{source:"realtime-other"})}h&&e.onPurchaseCreate?e.onPurchaseCreate(E):m&&e.onPurchaseUpdate?e.onPurchaseUpdate(E):w&&e.onPurchaseDelete&&e.onPurchaseDelete(E.$id)}};_(this,Gt,mr.registerDynamic(o,i)),console.log(`[ProductsStore] â Realtime configurÃ© via RealtimeManager (${o.length} channels)`)},Oc=async function(){if(I(this,k,xr).call(this)){console.log("[ProductsStore] Mode local: skip loadOrphanPurchases");return}if(f(a(this,ge)))try{const e=await df(f(a(this,ge)));e.forEach(t=>{a(this,$e).set(t.$id,t)}),console.log(`[ProductsStore] ${e.length} dÃ©penses globales chargÃ©es`)}catch(e){console.error("[ProductsStore] Erreur chargement dÃ©penses globales:",e)}},ar=new WeakMap,cr=new WeakMap;const Pf=new Af,wr=ss(),yr="materiel";async function nh(n){try{const{tables:e}=await D();return(await e.listRows({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:yr,queries:n||[]})).rows}catch(e){throw console.error("[appwrite-materiel] Error listing materiels:",e),e}}async function sh(n,e){try{const{tables:t}=await D(),s=ke.unique();let r;try{r=typeof n.owner=="string"?JSON.parse(n.owner):n.owner}catch(c){throw console.error("[appwrite-materiel] Error parsing owner:",n.owner,c),new Error("Invalid owner format")}const o=[J.read(ee.user(e)),J.update(ee.user(e))];r.teamId?o.push(J.read(ee.team(r.teamId)),J.update(ee.team(r.teamId))):r.userId&&o.push(J.read(ee.user(r.userId)),J.update(ee.user(r.userId)));const i=await t.createRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:s,data:{name:n.name,description:n.description||null,type:n.type||null,quantity:n.quantity,status:n.status||"ok",location:n.location||null,shareableWith:n.shareableWith||null,owner:n.owner},permissions:o});return console.log(`[appwrite-materiel] Materiel created: ${s}`),i}catch(t){throw console.error("[appwrite-materiel] Error creating materiel:",t),t}}async function rh(n,e){try{const{tables:t}=await D(),s=await t.updateRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:n,data:e});return console.log(`[appwrite-materiel] Materiel updated: ${n}`),s}catch(t){throw console.error(`[appwrite-materiel] Error updating materiel ${n}:`,t),t}}async function oh(n){try{const{tables:e}=await D();await e.deleteRow({databaseId:wr.APPWRITE_CONFIG.databaseId,tableId:yr,rowId:n}),console.log(`[appwrite-materiel] Materiel deleted: ${n}`)}catch(e){throw console.error(`[appwrite-materiel] Error deleting materiel ${n}:`,e),e}}function ih(){return[`databases.${wr.APPWRITE_CONFIG.databaseId}.collections.${yr}.documents`]}const vr=ss(),br="materiel_loan";async function ah(n){try{const{tables:e}=await D();return(await e.listRows({databaseId:vr.APPWRITE_CONFIG.databaseId,tableId:br,queries:n||[]})).rows}catch(e){throw console.error("[appwrite-materiel-loan] Error listing loans:",e),e}}async function ch(n,e){try{const{tables:t}=await D(),s=ke.unique(),r=[J.read(ee.user(e)),J.update(ee.user(e)),J.read(ee.team(n.ownerId)),J.update(ee.team(n.ownerId))],o=await t.createRow({databaseId:vr.APPWRITE_CONFIG.databaseId,tableId:br,rowId:s,data:{startDate:n.startDate,endDate:n.endDate,responsibleId:n.responsibleId,responsibleName:n.responsibleName,ownerId:n.ownerId,ownerName:n.ownerName,materiels:n.materiels.map(i=>JSON.stringify(i)),notes:n.notes||null,status:n.status||"asked",completedAt:null,returnedAt:null,returnNotes:null},permissions:r});return console.log(`[appwrite-materiel-loan] Loan created: ${s}`),o}catch(t){throw console.error("[appwrite-materiel-loan] Error creating loan:",t),t}}async function lh(n,e){try{const{tables:t}=await D(),s={};e.startDate!==void 0&&(s.startDate=e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate),e.materiels!==void 0&&(s.materiels=e.materiels.map(o=>JSON.stringify(o))),e.status!==void 0&&(s.status=e.status),e.notes!==void 0&&(s.notes=e.notes),e.returnedAt!==void 0&&(s.returnedAt=e.returnedAt),e.returnNotes!==void 0&&(s.returnNotes=e.returnNotes);const r=await t.updateRow({databaseId:vr.APPWRITE_CONFIG.databaseId,tableId:br,rowId:n,data:s});return console.log(`[appwrite-materiel-loan] Loan updated: ${n}`),r}catch(t){throw console.error(`[appwrite-materiel-loan] Error updating loan ${n}:`,t),t}}async function uh(n){try{const{tables:e}=await D();await e.deleteRow({databaseId:vr.APPWRITE_CONFIG.databaseId,tableId:br,rowId:n}),console.log(`[appwrite-materiel-loan] Loan deleted: ${n}`)}catch(e){throw console.error(`[appwrite-materiel-loan] Error deleting loan ${n}:`,e),e}}function dh(){return[`databases.${vr.APPWRITE_CONFIG.databaseId}.collections.${br}.documents`]}const bo="teamdocs";async function fh(){try{const{tables:n,config:e}=await D();return(await n.listRows({databaseId:e.databaseId,tableId:bo})).rows}catch(n){throw console.error("[appwrite-teamdocs] Error listing documents:",n),n}}async function ph(n,e,t,s){try{const{tables:r,config:o}=await D(),i=[J.read(ee.team(e)),J.update(ee.team(e)),J.delete(ee.team(e))],c=await r.createRow({databaseId:o.databaseId,tableId:bo,rowId:ke.unique(),data:{...n,teamId:e,createdBy:t},permissions:i});return console.log(`[appwrite-teamdocs] Document created: ${c.$id}`),c}catch(r){throw console.error("[appwrite-teamdocs] Error creating document:",r),r}}async function Df(n,e){try{const{tables:t,config:s}=await D(),r=await t.updateRow({databaseId:s.databaseId,tableId:bo,rowId:n,data:e});return console.log(`[appwrite-teamdocs] Document updated: ${n}`),r}catch(t){throw console.error(`[appwrite-teamdocs] Error updating document ${n}:`,t),t}}async function hh(n){try{const{tables:e,config:t}=await D();await e.deleteRow({databaseId:t.databaseId,tableId:bo,rowId:n}),console.log(`[appwrite-teamdocs] Document deleted: ${n}`)}catch(e){throw console.error(`[appwrite-teamdocs] Error deleting document ${n}:`,e),e}}async function mh(n,e){try{await Df(n,{lockedBy:e}),console.log(`[appwrite-teamdocs] Lock ${n} mis Ã  jour: ${e||"libÃ©rÃ©"}`)}catch(t){throw console.error(`[appwrite-teamdocs] Erreur verrouillage ${n}:`,t),t}}const{APPWRITE_CONFIG:Io}=ss();async function $f(n,e){return ft(async()=>{const{functions:t}=await D(),s=await t.createExecution({functionId:Io.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:n,teamId:e}),async:!1}),r=hr(s.responseBody,{context:"removeTeamFromEvent",fallback:null});if(!r||!r.success)throw new Error(r?.error||"Erreur lors du retrait de la team");console.log(`[appwrite-functions] Team ${e} retirÃ©e de l'Ã©vÃ©nement ${n}`)},{context:"AppwriteFunctions.removeTeamFromEvent",timeout:6e4,errorMessage:"Erreur lors du retrait de la team"})}async function Mf(n){return ft(async()=>{const{functions:e}=await D(),t=await e.createExecution({functionId:Io.functions.usersTeamsManager,body:JSON.stringify({action:"checkEmails",emails:n}),async:!1}),s=hr(t.responseBody,{context:"checkUserEmails",fallback:null});if(!s||!s.success)throw new Error(s?.error||"Erreur lors de la vÃ©rification des emails");return s.data},{context:"AppwriteFunctions.checkUserEmails",timeout:15e3,errorMessage:"Erreur lors de la vÃ©rification des emails"})}async function Cf(n,e,t){const{teamIds:s=[],emails:r=[],userIds:o=[],message:i,sendEmailToExistingMembers:c=!0}=t;return ft(async()=>{const{functions:l}=await D(),u=await l.createExecution({functionId:Io.functions.usersTeamsManager,body:JSON.stringify({action:"invite",context:{type:"event",id:n,name:e},teamIds:s,emails:r,userIds:o,message:i,sendEmailToExistingMembers:c}),async:!1}),d=hr(u.responseBody,{context:"inviteParticipantsToEvent",fallback:null});if(!d||!d.success)throw new Error(d?.error||"Erreur lors de l'invitation");return console.log(`[appwrite-functions] ${d.processed} invitations traitÃ©es pour ${e}`),d},{context:"AppwriteFunctions.inviteParticipantsToEvent",timeout:6e4,errorMessage:"Erreur lors de l'invitation"})}async function Nf(n,e){return ft(async()=>{const{functions:t}=await D(),s=await t.createExecution({functionId:Io.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:n,userId:e}),async:!1}),r=hr(s.responseBody,{context:"removeUserFromEvent",fallback:null});if(!r||!r.success)throw new Error(r?.error||"Erreur lors du retrait de l'utilisateur");console.log(`[appwrite-functions] Utilisateur ${e} retirÃ© de l'Ã©vÃ©nement ${n}`)},{context:"AppwriteFunctions.removeUserFromEvent",timeout:1e4,errorMessage:"Erreur lors du retrait de l'utilisateur"})}const No=Object.freeze(Object.defineProperty({__proto__:null,checkUserEmails:Mf,inviteParticipantsToEvent:Cf,removeTeamFromEvent:$f,removeUserFromEvent:Nf},Symbol.toStringTag,{value:"Module"}));var kf=(n=>(n.ENTREE="entree",n.PLAT="plat",n.DESSERT="dessert",n.AUTRE="autre",n))(kf||{}),qf=(n=>(n.PUBLIC="public",n.PRIVATE="private",n.DELETED="deleted",n))(qf||{});const jf=600*1e3,zc={usersTeamsManager:"appwrite_warmup_usersTeamsManager",enkaData:"appwrite_warmup_enkaData"};function Wc(n){const e=localStorage.getItem(zc[n]);return e?Date.now()-parseInt(e,10)>jf:!0}function Gc(n){localStorage.setItem(zc[n],Date.now().toString())}async function Vc(n,e){try{const{functions:t}=await D(),s=await t.createExecution({functionId:n,body:JSON.stringify(e)});return s.responseStatusCode===200?(console.log(`[warmup] â Ping rÃ©ussi pour ${n}`),!0):(console.warn(`[warmup] â ï¸ Ping Ã©chouÃ© pour ${n}: ${s.responseStatusCode}`),!1)}catch(t){return console.error(`[warmup] â Erreur ping ${n}:`,t),!1}}async function gh(){if(!Wc("usersTeamsManager")){console.log("[warmup] â­ï¸ usersTeamsManager encore chaud (< 10 min)");return}console.log("[warmup] ð¥ RÃ©veil de usersTeamsManager..."),await Vc(li("usersTeamsManager"),{action:"ping"}),Gc("usersTeamsManager")}async function wh(){if(!Wc("enkaData")){console.log("[warmup] â­ï¸ enkaData encore chaud (< 10 min)");return}console.log("[warmup] ð¥ RÃ©veil d'enkaData..."),await Vc(li("enkaData"),{operation:"ping"}),Gc("enkaData")}const Lf=ss().APPWRITE_CONFIG;async function yh(n,e,t){try{const{functions:s}=await D(),r=await s.createExecution({functionId:Lf.functions.usersTeamsManager,body:JSON.stringify({action:"exchange-invite",userId:n,eventId:e,teamId:t})}),o=JSON.parse(r.responseBody);if(!o.success)throw new Error(o.error||"L'invitation est invalide.");return{token:o.token,userId:o.userId}}catch(s){throw console.error("[invitations] Error validating invitation:",s),s}}const Uf=7,vh={async getLock(n){const{tables:e}=await D();try{const t=await e.getRow({databaseId:Ct(),tableId:on("locks"),rowId:n});return!t.userId||new Date(t.expiresAt)<new Date?null:t}catch(t){if(t.code===404)return null;throw t}},async acquireLock(n,e,t){const{tables:s}=await D(),r=new Date(Date.now()+Uf*60*1e3).toISOString(),o={userId:e,userName:t,expiresAt:r},i=[J.read(ee.any()),J.update(ee.user(e))];try{return await s.updateRow({databaseId:Ct(),tableId:on("locks"),rowId:n,data:o,permissions:i}),!0}catch(c){if(c.code===404)try{return await s.createRow({databaseId:Ct(),tableId:on("locks"),rowId:n,data:o,permissions:i}),!0}catch(l){return console.error("[locksService] Erreur crÃ©ation verrou:",l),!1}return console.warn("[locksService] Acquisition refusÃ©e (peut-Ãªtre dÃ©jÃ  verrouillÃ©):",c.message),!1}},async releaseLock(n,e){const{tables:t}=await D();try{await t.updateRow({databaseId:Ct(),tableId:on("locks"),rowId:n,data:{userId:"",userName:"",expiresAt:new Date(0).toISOString()},permissions:[J.read(ee.any()),J.update(ee.any())]}),console.log(`[locksService] Verrou libÃ©rÃ© (rÃ©initialisÃ©) pour ${n}`)}catch(s){if(s.code===404){console.log(`[locksService] Verrou dÃ©jÃ  libÃ©rÃ© pour ${n}`);return}console.warn("[locksService] Impossible de libÃ©rer le verrou sur le serveur:",s.message)}},subscribeToLock(n,e){const t=Ct(),s=on("locks"),r=`databases.${t}.collections.${s}.documents.${n}`;return console.log("[locksService] Enregistrement du channel de lock:",r),mr.registerDynamic([r],o=>{if(o.events?.some(c=>c.endsWith(".delete"))){e(null);return}if(!o.payload)return;const i=o.payload;!i.userId||new Date(i.expiresAt)<new Date?e(null):e(i)})}};function xf(n,e){const t=n.reduce((r,o)=>r+o.missingQuantities.length,0),s=e.invoiceTotal?1:0;return t+s}async function Bf(n,e,t){let s=null;try{const{account:c}=await D();s=(await c.get()).$id}catch(c){console.warn("[Appwrite Transaction] Impossible de rÃ©cupÃ©rer l'utilisateur connectÃ©:",c)}const r=e.purchaseStatus||"delivered";let o=e.purchaseDeliveryDate||null;r==="delivered"&&!o&&(o=new Date().toISOString());const i=n.flatMap(c=>c.missingQuantities.map(l=>({productId:c.productId,quantity:l.q,unit:l.u,status:r,notes:e.notes||"",store:e.store||"",who:e.who||void 0,price:void 0,orderDate:null,deliveryDate:o,createdBy:s})));return{mainId:t,purchasesData:i,invoiceData:e,fromUserId:s||""}}function Hf(n,e,t=98){const s=[];let r=[],o=0;const i=!!e.invoiceTotal;let c=!1;for(const l of n){const u=l.missingQuantities.length;let d=o+u>t;i&&!c&&r.length>0&&(d=o+u+1>t),d&&r.length>0?(s.push(r),r=[l],o=u,c=!1):(r.push(l),o+=u)}return r.length>0&&s.push(r),s}async function Of(n){try{const e=ss(),{functions:t}=await D(),s={operation:"createGroupPurchaseWithSync",data:n};console.log(`[Appwrite Interactions] ExÃ©cution du lot: ${n.purchasesData.length} achats Ã  crÃ©er`);const r=await t.createExecution(e.APPWRITE_CONFIG.functions.batchUpdate,JSON.stringify(s),!1,"/","POST");if(r.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${r.status}.`);const o=JSON.parse(r.responseBody);return o.success?console.log(`[Appwrite Interactions] Lot exÃ©cutÃ© avec succÃ¨s: ${o.purchasesCreated} achats crÃ©Ã©s`):console.error("[Appwrite Interactions] Lot Ã©chouÃ©:",o.error),o}catch(e){console.error("[Appwrite Interactions] Erreur exÃ©cution lot:",e);const t=e instanceof Error?e.message:"Erreur inconnue";return{success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:n.invoiceData.invoiceId,error:t,timestamp:new Date().toISOString()}}}async function bh(n,e,t){if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};const s=xf(e,t);console.log(`[Appwrite Interactions] Achat groupÃ©: ${e.length} produits, ${s} achats Ã  crÃ©er`);const r=Hf(e,t,98);console.log(`[Appwrite Interactions] DÃ©coupage en ${r.length} lot(s) pour respecter la limite de 100 achats par lot`);const o=[];let i=0,c=0,l=0;for(let p=0;p<r.length;p++){const h=r[p];console.log(`[Appwrite Interactions] ExÃ©cution du lot ${p+1}/${r.length} (${h.length} produits)`);try{const m=await Bf(h,t,n),w=await pc(()=>Of(m),{operationName:`Lot ${p+1}/${r.length}`,maxAutoRetries:1,autoRetryDelay:2e3});if(!w)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives");if(o.push(w),w.success)i+=w.productsCreated,c+=w.purchasesCreated,l+=w.expenseCreated?1:0;else{console.error(`[Appwrite Interactions] Erreur sur le lot ${p+1}: ${w.error}`);break}}catch(m){const w=m instanceof Error?m.message:"Erreur inconnue";console.error(`[Appwrite Interactions] Erreur lors de l'exÃ©cution du lot ${p+1}:`,m),o.push({success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:t.invoiceId,error:w,timestamp:new Date().toISOString()});break}}const u=o.every(p=>p.success),d=o.some(p=>!p.success);return{success:u,results:o,totalProductsCreated:i,totalPurchasesCreated:c,totalExpensesCreated:l,error:d?"Un ou plusieurs lots ont Ã©chouÃ©":void 0}}export{Ln as $,$t as A,Pf as B,bt as C,D,nh as E,ah as F,ih as G,dh as H,sh as I,rh as J,oh as K,ch as L,lh as M,uh as N,fh as O,ph as P,b as Q,Df as R,Xt as S,hh as T,mh as U,Ff as V,ru as W,rp as X,ie as Y,yu as Z,Du as _,wp as a,xp as a$,Np as a0,Wr as a1,ip as a2,ua as a3,qi as a4,Qu as a5,Wo as a6,vp as a7,Zf as a8,bp as a9,hp as aA,Ep as aB,mp as aC,Kd as aD,ci as aE,qf as aF,Oi as aG,th as aH,gh as aI,kp as aJ,yh as aK,ap as aL,Pt as aM,yp as aN,Sr as aO,vh as aP,_u as aQ,$p as aR,bh as aS,Lp as aT,Mp as aU,nd as aV,lf as aW,Wp as aX,Gp as aY,Vp as aZ,Bp as a_,tp as aa,Qf as ab,up as ac,_p as ad,Rp as ae,Do as af,Hu as ag,Dp as ah,cu as ai,qp as aj,fp as ak,op as al,Xp as am,Au as an,Jf as ao,Sp as ap,wh as aq,If as ar,Zp as as,Yp as at,eh as au,Fp as av,Sf as aw,Ip as ax,kf as ay,gp as az,sp as b,Up as b0,Hp as b1,Op as b2,zp as b3,cn as b4,sd as b5,ac as b6,Cp as b7,lt as b8,ld as b9,lc as ba,jp as bb,ud as bc,Qp as bd,Kp as be,Jp as bf,$u as bg,ti as bh,Wf as bi,No as bj,Nl as c,Cl as d,lp as e,ep as f,Kf as g,Xf as h,cp as i,np as j,Yf as k,pp as l,f as m,sn as n,Tp as o,Pp as p,C as q,Ap as r,dp as s,Gf as t,X as u,g as v,Ct as w,mr as x,Q as y,It as z};
