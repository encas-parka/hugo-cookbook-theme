import{Z as ct,x as vt,j as H,s as I,p as Ue,b as pe,g as e,u as U,a as d,W as v,A as s,B as i,$ as T,v as c,w as ut,at as Pt,ag as rt,X as P,a3 as ae,a1 as De,o as Ze,_ as F,Y as G,a0 as Ot,as as it,ac as At,E as Mt,aj as nt,aq as jt,ar as Ft}from"./vendor.B7h_mkEd.js";import{z as He}from"./appwrite.5W8SCupm.js";import{k as It}from"./keyboardNavigation.svelte.ETytoTUJ.js";import{P as qt,S as Nt,f as zt,g as Ee,U as Lt,ao as Bt,ap as Gt,aq as lt,T as Kt,ah as ot,u as Ye,X as Vt,t as Xt,ar as Qt}from"./icons.DKN5kzXq.js";import{f as Wt}from"./products-display.CZc2PMhO.js";import{e as Yt,a as dt,d as Zt}from"./date-helpers.B6zph3v7.js";function Ht(l,r,t,f){e(r)?t():f()}function Jt(l,r,t,f,o,y,_,q,O,N,m){if(l.key==="Escape"){l.preventDefault(),r();return}if(!e(t)||!e(f).length){l.key==="Enter"&&e(o).trim().length>1&&!e(y)&&(l.preventDefault(),_());return}l.key==="ArrowDown"?(l.preventDefault(),d(q,e(q)+1),O()):l.key==="ArrowUp"?(l.preventDefault(),d(q,e(q)-1),O()):l.key==="Enter"&&e(N)>=0&&(l.preventDefault(),m(e(f)[e(N)]))}var $t=(l,r,t)=>r(e(t)),ea=v('<span class="text-base-content/70 text-xs font-normal"> </span>'),ta=v('<span class="badge badge-ghost badge-sm text-xs opacity-70">brouillon</span>'),aa=v('<button type="button" role="option"><div class="bg-base-200 rounded p-1"><!></div> <div class="flex min-w-0 flex-1 flex-wrap items-center gap-2"><span class="truncate text-sm font-medium"> </span> <!> <!></div></button>'),sa=v('<div id="recipes-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"></div>'),ra=v('<div class="mt-2"><div class="relative"><div class="input flex w-full items-center gap-2 pr-10"><!> <input type="text" placeholder="Rechercher une recette..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="recipes-list"/> <!></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div>'),ia=v('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center justify-between"><h4 class="flex items-center gap-2 font-bold"><!> Ajouter une recette</h4></div> <!></div></div>');function na(l,r){vt(r,!0);let t=H(r,"defaultPlates",3,4),f=H(r,"autoFocus",3,!1),o=H(r,"disabled",3,!1),y=I(""),_=I(void 0),q=I(Ue(t())),O=I(null),N=!1,m=I(0),K=I(!1),A=I(void 0),J=I(void 0),V=U(()=>e(K)&&!e(y).trim()?He.getAllRecipes():e(y).trim().length<2?[]:He.searchRecipes(e(y))),fe=U(()=>e(V).length>0),M=U(()=>e(fe)||e(K)),h=U(()=>e(V).length>0?e(m)===-1?0:e(m)%e(V).length:-1);pe(()=>{if(e(M)){const p=z=>{e(A)&&!e(A).contains(z.target)&&ie()};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}}});function X(){d(O,null),d(y,""),d(q,t()),d(m,0),d(K,!1)}function be(){d(K,!0),d(y,""),d(m,0)}function ie(){d(K,!1),d(y,""),d(m,0)}function se(p){d(O,p,!0);const z=p.typeR;d(_,e(_)?e(_):z,!0),r.onSelect(p,e(_),e(q)),X()}function me(){if(e(h)>=0&&e(J)){const p=e(J).querySelector(`#recipe-${e(h)}`);p&&p.scrollIntoView({block:"nearest"})}}var ne=ia(),ge=s(ne),le=s(ge),Q=s(le),Se=s(Q);qt(Se,{class:"text-primary h-4 w-4"});var he=i(le,2);{var xe=p=>{var z=ra(),oe=s(z),de=s(oe),we=s(de);Nt(we,{class:"h-4 w-4 opacity-50"});var L=i(we,2);L.__keydown=[Jt,ie,M,V,y,K,be,m,me,h,se],Pt(L,()=>It({shouldFocus:f(),onEmptySubmit:r.onEmptySubmit}));var Te=i(L,2);T(Te,D=>{});var W=i(de,2);W.__click=[Ht,M,ie,be];var Ce=s(W);{let D=U(()=>e(M)?"rotate-180":"");zt(Ce,{get class(){return`h-4 w-4 transition-transform ${e(D)??""}`}})}var Pe=i(W,2);{var Oe=D=>{var ce=sa();Ze(ce,23,()=>e(V),$=>$.$id,($,ee,re)=>{var a=aa();a.__click=[$t,se,ee],a.disabled=N;var n=s(a),u=s(n);Ee(u,{class:"h-4 w-4 opacity-70"});var b=i(n,2),E=s(b),k=s(E),B=i(E,2);{var te=x=>{var S=ea(),Z=s(S);P(()=>G(Z,`(${e(ee).versionLabel??""})`)),c(x,S)};T(B,x=>{e(ee).versionLabel&&x(te)})}var j=i(B,2);{var Y=x=>{var S=ta();c(x,S)};T(j,x=>{e(ee).draft&&x(Y)})}P(()=>{ae(a,"id",`recipe-${e(re)??""}`),F(a,1,`hover:bg-base-200 flex w-full items-center gap-2 px-4 py-3 text-left hover:cursor-pointer ${e(re)===e(h)?"bg-base-200":""}`),ae(a,"aria-selected",e(re)===e(h)),G(k,e(ee).title)}),Ot("mouseenter",a,()=>d(m,e(re),!0)),c($,a)}),rt(ce,$=>d(J,$),()=>e(J)),c(D,ce)};T(Pe,D=>{e(M)&&e(V).length>0&&D(Oe)})}rt(z,D=>d(A,D),()=>e(A)),P(()=>{L.disabled=o(),ae(L,"aria-expanded",e(M)),ae(L,"aria-activedescendant",e(M)?`recipe-${e(h)}`:void 0),W.disabled=o(),ae(W,"aria-label",e(M)?"Fermer le menu":"Ouvrir le menu")}),De(L,()=>e(y),D=>d(y,D)),c(p,z)};T(he,p=>{e(O)||p(xe)})}c(l,ne),ut()}ct(["keydown","click"]);var la=(l,r,t)=>{(l.key==="Enter"||l.key===" ")&&!r()&&t()},oa=(l,r)=>{r(!1)},da=v(`<button class="btn btn-ghost text-primary" title="Terminer l'édition">valider</button> <button class="btn btn-ghost btn-square text-error" title="Supprimer"><!></button>`,1),ca=(l,r,t)=>{r(!0),t.onEditToggle&&t.onEditToggle()},va=v('<button class="btn btn-ghost" title="Éditer"><!></button>'),ua=(l,r,t)=>r({newDate:e(t)}),_a=v('<p class="text-error mt-1 text-xs">Cette date/heure est déjà utilisée</p>'),pa=(l,r,t)=>r({newMoment:e(t)}),fa=v('<span class="text-error ms-2 text-sm font-normal">(Recette introuvable)</span>'),ba=(l,r,t,f)=>{r[t(e(f).recipeUuid)]=!1},ma=(l,r,t,f,o)=>{r[t(e(f).recipeUuid)]=!1,e(f).hasOwnPlatesNb=!1,e(f).plates=o().guests},ga=v('<div class="ring-base-300 flex items-center gap-1 rounded-xl p-1 ring-1"><div class="input w-28"><!> <input type="number" class="w-full text-center" min="1"/></div> <button class="btn btn-sm btn-circle me-1" title="Valider"><!></button> <button class="btn btn-sm btn-circle"><!></button></div>'),ha=(l,r,t,f)=>{const o=r(e(t).recipeUuid);f[o]=!0,e(t).hasOwnPlatesNb=!0},xa=v('<button title="Éditer les couverts"><span class="font-normal"> </span> <!></button>'),wa=(l,r,t)=>r(e(t).recipeUuid),ya=v('<div><div class="flex flex-1 items-center gap-2"><div><!></div> <div class="min-w-56 flex-1"><div class="font-medium"> <!></div></div></div> <div class="me-10 flex items-center gap-2"><select class="select w-24"><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select> <!></div> <div class="ms-auto"><button class="btn btn-ghost btn-sm btn-square text-error" title="Retirer la recette"><!></button></div></div>'),ka=v('<div class="mb-4 space-y-2"></div>'),Ra=v('<div class="mt-2 space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><fieldset><label><span class="label">Date</span> <input type="date" class="w-full"/></label> <!></fieldset> <label class="select"><span class="label">Moment</span> <select><option disabled selected>Choisir un moment</option><option>Matin</option><option>Midi</option><option>Soir</option></select></label> <div><label class="input"><span class="label"><!> Couverts</span> <input type="number" class="w-full" min="1"/></label> <p class="text-base-content/60 pl-2 text-xs">Peut etre modifié individuellement pour chaque recette</p></div></div> <div class="space-y-2"><div class="flex items-center justify-between"><h4 class="flex items-center gap-2 font-semibold"><!> Recettes</h4></div> <!> <!></div></div>'),Ua=v('<div><!> <span> </span> <span class="badge badge-sm badge-outline font-normal"> <!></span></div>'),Da=v('<div class="flex flex-wrap gap-2"></div>'),Ea=v('<p class="text-base-content/60 text-sm italic">Aucune recette</p>'),Sa=v('<div class="space-y-2"><!></div>'),Ta=v('<div role="button"><div class="card-body p-4"><div class="mb-2 flex items-start justify-between"><div class="flex flex-wrap items-center gap-2"><span> </span> <div><!> <div> </div></div> <div class="text-base-content/80 flex items-center gap-1 font-bold"><!> </div></div> <div class="flex gap-1"><!></div></div> <!></div></div>');function Ia(l,r){vt(r,!0);let t=H(r,"meal",15),f=H(r,"defaultGuests",3,100),o=H(r,"isEditing",15,!1),y=H(r,"allDates",19,()=>[]),_=H(r,"disabled",3,!1);pe(()=>{_()&&o()&&o(!1)});let q=!1;t().guests||t(t().guests=f(),!0),t().recipes||t(t().recipes=[],!0);let O=U(()=>dt(t().date||"")),N=I(Ue(Yt(t().date||""))),m=I(Ue(dt(t().date||""))),K=U(()=>e(m)?Zt(e(N),e(m)):""),A=U(()=>t().date?y().filter(n=>n===t().date).length>1:!1);function J({newDate:a="",newMoment:n=""}){t().date,(a||n)&&t(t().date=e(K),!0)}const V=U(()=>{const a=e(O)||"";return a==="matin"?Bt:a==="midi"?Gt:a==="soir"?lt:lt}),fe={entree:1,plat:2,dessert:3,autre:4};function M(a){return[...a].sort((n,u)=>{const b=fe[n.typeR],E=fe[u.typeR];return b-E})}pe(()=>{const a=M(t().recipes);t().recipes.some((u,b)=>u.recipeUuid!==a[b]?.recipeUuid)&&it(()=>{t(t().recipes=a,!0)})});let h=Ue({});function X(a){return`${t().id}-${a}`}pe(()=>{t().recipes.forEach(a=>{const n=X(a.recipeUuid);h[n]===void 0&&(h[n]=!1)})}),pe(()=>{const a=t().guests;t().recipes.forEach(n=>{!n.hasOwnPlatesNb&&!h[X(n.recipeUuid)]&&n.plates!==a&&it(()=>{n.plates=a})})});function be(a){if(t().recipes.some(b=>b.recipeUuid===a.$id))return;const u={recipeUuid:a.$id,plates:t().guests,typeR:a.typeR,hasOwnPlatesNb:!1};t(t().recipes=[...t().recipes,{...u}],!0)}function ie(a){t(t().recipes=t().recipes.filter(n=>n.recipeUuid!==a),!0)}function se(a){return He.getRecipeIndexByUuid(a)}function me(a){return a.split("_")[0]}function ne(a){return!se(a)}function ge(){_()||o()&&r.onEditToggle||!o()&&r.onEditToggle&&r.onEditToggle()}function le(a,n=!1){return n?"badge-error":a==="entree"?"bg-lime-100 border-lime-200":a==="plat"?"bg-orange-100 border-orange-200":a==="dessert"?"bg-pink-100 border-pink-200":a==="autre"?"bg-purple-100 border-purple-200":"bg-base-200"}var Q=Ta();Q.__click=ge,Q.__keydown=[la,o,ge];var Se=s(Q),he=s(Se),xe=s(he),p=s(xe),z=s(p),oe=i(p,2),de=s(oe);At(de,()=>e(V),(a,n)=>{n(a,{size:16})});var we=i(de,2),L=s(we),Te=i(oe,2),W=s(Te);Lt(W,{class:"h-3 w-3"});var Ce=i(W),Pe=i(xe,2),Oe=s(Pe);{var D=a=>{var n=da(),u=Mt(n);u.__click=[oa,o];var b=i(u,2);b.__click=function(...k){r.onDelete?.apply(this,k)};var E=s(b);Kt(E,{class:"h-4 w-4"}),P(()=>{u.disabled=_(),b.disabled=_()}),c(a,n)},ce=a=>{var n=va();n.__click=[ca,o,r];var u=s(n);ot(u,{class:"h-4 w-4"}),P(()=>n.disabled=_()),c(a,n)};T(Oe,a=>{o()?a(D):a(ce,!1)})}var $=i(he,2);{var ee=a=>{var n=Ra(),u=s(n),b=s(u),E=s(b),k=i(s(E),2);k.__change=[ua,J,N];var B=i(E,2);{var te=R=>{var ye=_a();c(R,ye)};T(B,R=>{e(A)&&R(te)})}var j=i(b,2),Y=i(s(j),2);Y.__change=[pa,J,m];var x=s(Y);x.value=x.__value="";var S=i(x);S.value=S.__value="matin";var Z=i(S);Z.value=Z.__value="midi";var ve=i(Z);ve.value=ve.__value="soir";var Ae=i(j,2),Me=s(Ae),ue=s(Me),je=s(ue);Ye(je,{class:"text-base-content/50 me-1 h-4 w-4"});var Fe=i(ue,2),Ie=i(u,2),Je=s(Ie),_t=s(Je),pt=s(_t);Ee(pt,{class:"h-4 w-4"});var $e=i(Je,2);{var ft=R=>{var ye=ka();Ze(ye,31,()=>t().recipes,qe=>qe.recipeUuid,(qe,g,Ca)=>{const mt=U(()=>se(e(g).recipeUuid)),Ne=U(()=>ne(e(g).recipeUuid));var ke=ya(),et=s(ke),ze=s(et),gt=s(ze);Ee(gt,{class:"h-5 w-5"});var ht=i(ze,2),xt=s(ht),tt=s(xt),wt=i(tt);{var yt=w=>{var C=fa();c(w,C)};T(wt,w=>{e(Ne)&&w(yt)})}var at=i(et,2),Le=s(at),Be=s(Le);Be.value=Be.__value="entree";var Ge=i(Be);Ge.value=Ge.__value="plat";var Ke=i(Ge);Ke.value=Ke.__value="dessert";var st=i(Ke);st.value=st.__value="autre";var kt=i(Le,2);{var Rt=w=>{var C=ga(),_e=s(C),Re=s(_e);Ye(Re,{class:"h-4 w-4 opacity-50"});var Xe=i(Re,2),Qe=i(_e,2);Qe.__click=[ba,h,X,g];var St=s(Qe);Xt(St,{class:"text-success h-4 w-4"});var We=i(Qe,2);We.__click=[ma,h,X,g,t];var Tt=s(We);Qt(Tt,{class:"text-secondary h-4 w-4"}),P(()=>ae(We,"title",`Revenir au nombre de couvert du repas (${t().guests??""})`)),De(Xe,()=>e(g).plates,Ct=>e(g).plates=Ct),c(w,C)},Ut=w=>{var C=xa();C.__click=[ha,X,g,h];var _e=s(C),Re=s(_e),Xe=i(_e,2);ot(Xe,{size:14,class:"text-base-content/70  ms-1"}),P(()=>{F(C,1,`btn ${e(g).hasOwnPlatesNb?"btn-soft btn-warning":"btn-ghost"}`),G(Re,`${e(g).plates??""}
                          pers.`)}),c(w,C)};T(kt,w=>{h[X(e(g).recipeUuid)]?w(Rt):w(Ut,!1)})}var Dt=i(at,2),Ve=s(Dt);Ve.__click=[wa,ie,g];var Et=s(Ve);Vt(Et,{class:"h-4 w-4"}),P((w,C)=>{F(ke,1,`bg-base-200 flex flex-wrap items-center gap-3 rounded-lg p-3 ${(e(Ne)&&"border-error border-2")??""}`),F(ze,1,`${w??""} rounded-md border-2 p-2`),G(tt,`${C??""} `),Ve.disabled=_()},[()=>le(e(g).typeR,e(Ne)),()=>e(mt)?.title||me(e(g).recipeUuid)]),nt(Le,()=>e(g).typeR,w=>e(g).typeR=w),jt(ke,()=>Ft,()=>({duration:200})),c(qe,ke)}),c(R,ye)};T($e,R=>{t().recipes.length>=1&&R(ft)})}var bt=i($e,2);na(bt,{onSelect:be,get defaultPlates(){return t().guests},autoFocus:q,get onEmptySubmit(){return r.onEmptySearchSubmit},get disabled(){return _()}}),P(()=>{F(E,1,`input ${e(A)?"input-error":""}`),F(Y,1,`w-full ${e(A)?"select-error":""}`)}),De(k,()=>e(N),R=>d(N,R)),nt(Y,()=>e(m),R=>d(m,R)),De(Fe,()=>t().guests,R=>t(t().guests=R,!0)),c(a,n)},re=a=>{var n=Sa(),u=s(n);{var b=k=>{var B=Da();Ze(B,21,()=>t().recipes,te=>te.recipeUuid,(te,j)=>{const Y=U(()=>se(e(j).recipeUuid)),x=U(()=>ne(e(j).recipeUuid));var S=Ua(),Z=s(S);Ee(Z,{class:"h-4 w-4"});var ve=i(Z,2),Ae=s(ve),Me=i(ve,2),ue=s(Me),je=i(ue);Ye(je,{size:12}),P((Fe,Ie)=>{F(S,1,`badge badge-lg ${Fe??""} h-auto gap-2 py-1 font-medium ${e(x)?"ring-error ring-1":""}`),G(Ae,Ie),G(ue,`${e(j).plates??""} `)},[()=>le(e(j).typeR,e(x)),()=>e(Y)?.title||me(e(j).recipeUuid)]),c(te,S)}),c(k,B)},E=k=>{var B=Ea();c(k,B)};T(u,k=>{t().recipes.length>0?k(b):k(E,!1)})}c(a,n)};T($,a=>{o()?a(ee):a(re,!1)})}P((a,n)=>{F(Q,1,`card bg-base-100 border-base-200 border shadow-sm transition-all hover:shadow-md ${o()?"ring-accent/40 ring-2":""} ${o()||_()?"":"hover:ring-accent/60 cursor-pointer hover:ring-2"} ${_()?"opacity-75":""}`),ae(Q,"tabindex",o()||_()?-1:0),F(p,1,`text-primary text-lg font-medium ${(e(A)&&"text-error")??""}`),G(z,a),F(oe,1,`font-base flex items-center gap-1 ${(e(A)&&"text-error")??""}`),G(L,n),G(Ce,` ${t().guests??""} pers.`)},[()=>t().date?Wt(t().date):"Date non définie",()=>e(O)?e(O).toUpperCase():"REPAS"]),c(l,Q),ut()}ct(["click","keydown","change"]);export{Ia as E};
