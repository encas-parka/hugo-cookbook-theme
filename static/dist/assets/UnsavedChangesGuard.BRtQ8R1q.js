import{j as w,W as f,E as p,B as c,v as g,Z as W,A as L,X as M,Y as z,$ as E,b as V,w as q,x as O,a as i,s as x,g as G}from"./vendor.B7h_mkEd.js";import{x as R}from"./appwrite.5W8SCupm.js";import{M as K,a as j,b as B,c as D}from"./index.BUL8Pmq2.js";import{D as F,r as H}from"./icons.DKN5kzXq.js";var N=f('<div class="alert alert-warning alert-soft text-base"><!> <span> </span></div>'),Q=f('<span class="loading loading-spinner loading-xs"></span> Enregistrement...',1),T=f("<!> Enregistrer et quitter",1),X=f('<button class="btn btn-ghost">Rester</button> <button class="btn btn-error">Quitter sans sauvegarder</button> <button class="btn btn-primary"><!></button>',1),Y=f("<!> <!> <!>",1);function Z(C,e){let o=w(e,"isSaving",3,!1),s=w(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?");K(C,{get isOpen(){return e.isOpen},get onClose(){return e.onCancel},children:(u,t)=>{var h=Y(),_=p(h);j(_,{title:"Modifications non sauvegardées",get onClose(){return e.onCancel}});var m=c(_,2);B(m,{children:(n,y)=>{var r=N(),l=L(r);F(l,{class:"h-5 w-5"});var v=c(l,2),d=L(v);M(()=>z(d,s())),g(n,r)}});var S=c(m,2);D(S,{children:(n,y)=>{var r=X(),l=p(r);l.__click=function(...a){e.onCancel?.apply(this,a)};var v=c(l,2);v.__click=function(...a){e.onLeaveWithoutSave?.apply(this,a)};var d=c(v,2);d.__click=function(...a){e.onSaveAndLeave?.apply(this,a)};var U=L(d);{var k=a=>{var b=Q();g(a,b)},A=a=>{var b=T(),P=p(b);H(P,{class:"mr-1 h-4 w-4"}),g(a,b)};E(U,a=>{o()?a(k):a(A,!1)})}M(()=>{l.disabled=o(),v.disabled=o(),d.disabled=o()}),g(n,r)}}),g(u,h)},$$slots:{default:!0}})}W(["click"]);function ae(C,e){O(e,!0);let o=w(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?"),s=x(!1),u=x(!1),t=null;async function h(n,y){return e.shouldProtect()?(console.log(`[UnsavedChangesGuard] Navigation protégée pour ${e.routeKey}`),i(s,!0),new Promise(r=>{t=r})):!0}async function _(){i(s,!1),await e.onLeaveWithoutSave(),t&&(t(!0),t=null)}async function m(){i(u,!0);try{if(await e.onSaveAndLeave()===!1){console.log("[UnsavedChangesGuard] Sauvegarde échouée, navigation annulée");return}i(s,!1),t&&(t(!0),t=null)}catch(n){console.error("[UnsavedChangesGuard] Erreur lors de la sauvegarde:",n)}finally{i(u,!1)}}function S(){i(s,!1),t&&(t(!1),t=null)}V(()=>{const n={beforeLeave:h};return R.registerRouteGuard(e.routeKey,n)}),Z(C,{get isOpen(){return G(s)},get isSaving(){return G(u)},get message(){return o()},onLeaveWithoutSave:_,onSaveAndLeave:m,onCancel:S}),q()}export{ae as U};
