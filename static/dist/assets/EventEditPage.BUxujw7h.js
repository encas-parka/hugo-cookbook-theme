import{Z as lt,x as dt,j as Re,s as z,p as it,b as Ye,a as n,g as e,W as l,E as ie,$ as g,A as a,B as s,u as C,v as r,X as x,a0 as tt,a1 as Xe,Y as W,D as We,o as Fe,z as at,a2 as Tt,ai as It,ak as At,w as vt,n as _t,a3 as bt,_ as Qe,ac as jt,aj as Lt,al as St,aa as Bt,c as Vt,as as Ut,aq as Ft,ar as Ht}from"./vendor.B7h_mkEd.js";import{E as Rt}from"./EventMealCard.DYuYwOzI.js";import{t as Q,a as ne,e as He,n as ht,O as rt}from"./appwrite.5W8SCupm.js";import{M as Ct,a as Dt,b as Nt,c as Mt,n as xt}from"./index.BUL8Pmq2.js";import{F as ct}from"./Fieldset.Dv39p1Lh.js";import{ah as ut,V as Wt,W as Gt,P as ot,U as $e,t as ft,a2 as mt,ai as Jt,aj as Kt,n as pt,ak as Qt,al as yt,H as kt,r as Pt,am as Xt,an as Yt,b as Zt,D as $t}from"./icons.DKN5kzXq.js";import{E as ea}from"./EventInvitationAlert.CCrCOxXJ.js";import{c as ta}from"./event-stats-helpers.D4lUGopr.js";import{E as aa}from"./EventStats.DzEo2_oU.js";import"./CheckboxBadge.CBrhHJkp.js";import{B as na}from"./BtnGroupCheck.CHrcq3x2.js";import{U as sa}from"./UnsavedChangesGuard.BRtQ8R1q.js";import{C as wt}from"./ConfirmModal.DRp-kO_g.js";import"./editor.L4rklAfR.js";import"./markdown.BkFahWn2.js";import"./keyboardNavigation.svelte.ETytoTUJ.js";import"./products-display.CZc2PMhO.js";import"./date-helpers.B6zph3v7.js";async function ra(N,t,T,c,p,y,h){if(!t()){Q.error("ID d'√©v√©nement manquant");return}const m=T.eventsStore.getEventById(t());if(!m)throw new Error("√âv√©nement introuvable");const q=e(c).filter(M=>{const E=T.nativeTeamsStore.teams.find(X=>X.$id===M);return E?!m.teams?.includes(E.name):!1}),k=e(p).map(M=>M.email).filter(Boolean);if(q.length===0&&k.length===0){Q.warning("S√©lectionnez au moins une √©quipe ou entrez un email");return}try{await Q.track(T.eventsStore.inviteParticipants(t(),{teamIds:q,emails:k,sendEmailToExistingMembers:e(y)}),{loading:"Envoi des invitations en cours...",success:"invitation envoy√© avec succ√®s",error:"Erreur lors de l'envoi des invitations"}),n(h,!1),n(p,[],!0)}catch(M){console.error("Erreur lors de l'envoi des invitations:",M)}}var ia=l('<label class="input w-56"><span class="label">Minimum</span> <input type="number" min="1" class="grow" id="min-contrib-input"/></label>'),oa=(N,t)=>{n(t,!0),setTimeout(()=>{document.getElementById("min-contrib-input")?.focus()},50)},la=l('<button class="btn justify-start"><div class="flex items-center gap-4"><span class="label">minimum</span> <span class="text-lg"> </span> <!></div></button>'),da=l('<div class="badge badge-primary badge-soft badge-lg gap-2 p-3"><!> <span class="font-medium"> </span></div>'),va=l('<fieldset class="fieldset"><legend class="legend">√âquipes invit√©es</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),ca=l('<div class="badge badge-soft badge-success gap-2 p-3"><span class="font-medium"> </span></div>'),ua=l('<fieldset class="fieldset"><legend class="legend">Participant confirm√©</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),fa=l('<div class="badge badge-warning badge-soft gap-2 p-3"><span class="font-medium"> </span></div>'),ma=l('<fieldset class="fieldset"><legend class="text-base-content/70 text-sm font-medium">Invit√©¬∑es</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),_a=(N,t)=>n(t,!0),ga=l('<div class="my-2"><button class="btn btn-primary btn-outline btn-block gap-1"><!> Inviter des participant¬∑es</button></div>'),ba=l('<fieldset class="fieldset mb-4"><!> <div class="fieldset-label ms-1">Combien faudrait-il √™tre pour tout g√©rer ?</div></fieldset> <div class="mb-6"><div class="space-y-4"><!> <!> <!></div></div> <!>',1),pa=(N,t)=>N.key==="Enter"&&t(),ha=l('<p class="text-error mt-1 text-xs"> </p>'),xa=l("<p> </p>"),ya=l('<div class="badge badge-primary badge-soft badge-lg"><!> </div>'),ka=l('<div class="mb-4"><p class="mb-2 text-sm font-medium opacity-70">√âquipes d√©j√† invit√©es :</p> <div class="flex flex-wrap gap-2"></div></div>'),wa=(N,t,T)=>t(e(T).$id),Ea=l('<label class="hover:bg-secondary/20 bg-secondary/10 flex cursor-pointer items-center gap-3 rounded-lg px-4 py-2 transition-colors"><input type="checkbox" class="checkbox bg-base-100 checkbox-sm"/> <div class="flex flex-col"><span class="text-sm font-medium"> <span class="text-xs opacity-60"> </span></span> <div class="text-xs opacity-70"> </div></div></label>'),Ta=l(`<label class="mt-4 cursor-pointer justify-center gap-4"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="font-base ms-1">Envoyer un email de notification</span></label> <p class="text-base-content/60 mt-1 text-xs">Si d√©sactiv√©, les membres auront acc√®s √† l'√©v√©nement mais ne
                recevront pas d'email. Les personnes invit√© n'ayant pas de
                compte recevront toujours un email de cr√©ation de compte.</p>`,1),Ia=l('<div class="flex flex-wrap gap-4"></div> <!>',1),Sa=l('<p class="text-sm italic opacity-60">Toutes vos √©quipes sont d√©j√† invit√©es.</p>'),Ca=l(`<p class="text-sm italic opacity-60">Vous ne faites partie d'aucune √©quipe. Cr√©ez une √©quipe pour inviter
            plusieurs personnes.</p>`),Da=l(`<div class="space-y-6"><fieldset class="fieldset"><legend class="legend">Par email</legend> <div class="flex gap-2"><label class="input flex items-center gap-2"><!> <input type="email" class="grow" placeholder="email@exemple.com"/></label> <button class="btn btn-primary"><!> Ajouter</button></div> <!> <div></div></fieldset> <div class="divider">OU</div> <fieldset class="fieldset"><legend class="fieldset-legend"><!> Inviter des √©quipes
          enti√®res</legend> <!> <!></fieldset></div>`),Na=l('<button class="btn">Annuler</button> <button class="btn btn-primary"><!> Inviter <!></button>',1),Ma=l("<!> <!> <!>",1),Pa=l("<!> <!>",1);function za(N,t){dt(t,!0);let T=Re(t,"minContrib",15);Re(t,"userId",3,"");let c=Re(t,"eventId",3,""),p=Re(t,"onStartEdit",3,()=>{}),y=z(it([])),h=z(it([])),m=z(!1),q=z(!1),k=z(!1);Ye(()=>{if(c()){const d=t.eventsStore.getEventById(c());if(d&&d.teams){const f=d.teams||[],L=[];for(const ce of f){const ee=t.nativeTeamsStore.teams.find(ue=>ue.name===ce);ee&&L.push(ee.$id)}n(y,L,!0)}}}),Ye(()=>{e(q)?p()():n(h,[],!0)});let M=z(""),E=z(null),X=C(()=>t.contributors.filter(d=>d.status==="accepted")),xe=C(()=>t.contributors.filter(d=>d.status==="invited"));function ye(d){e(y).includes(d)?n(y,e(y).filter(f=>f!==d),!0):n(y,[...e(y),d],!0)}function ke(){if(!e(M))return;const d=e(M).trim();if(t.contributors.some(L=>L.email===d)||e(h).some(L=>L.email===d)){n(E,"Cet email est d√©j√† invit√©.");return}n(E,null);const f={id:_t(),email:d,status:"invited",invitedAt:new Date().toISOString()};n(h,[...e(h),f],!0),n(M,"")}function $(){n(q,!1),n(M,""),n(E,null)}let _e=C(()=>()=>{if(!c())return[];const d=t.eventsStore.getEventById(c());return d?e(y).filter(f=>{const L=t.nativeTeamsStore.teams.find(ce=>ce.$id===f);return L?!d.teams?.includes(L.name):!1}):[]});var Y=Pa(),Ee=ie(Y);ct(Ee,{legend:"Participants",children:(d,f)=>{var L=ba(),ce=ie(L),ee=a(ce);{var ue=_=>{var w=ia(),D=s(a(w),2);D.defaultValue=1,x(()=>D.disabled=!t.canEdit),tt("focus",D,function(...j){p()?.apply(this,j)}),tt("blur",D,()=>n(k,!1)),Xe(D,T),r(_,w)},P=_=>{var w=la();w.__click=[oa,k];var D=a(w),j=s(a(D),2),B=a(j),V=s(j,2);ut(V,{class:"h-4 w-4"}),x(()=>{w.disabled=!t.canEdit,W(B,T()||1)}),r(_,w)};g(ee,_=>{e(k)?_(ue):_(P,!1)})}var le=s(ce,2),de=a(le),G=a(de);{var ge=_=>{const w=C(()=>t.eventsStore.getEventById(c()));var D=We(),j=ie(D);{var B=V=>{var Z=va(),be=s(a(Z),2);Fe(be,21,()=>e(w).teams,at,(Ce,ze)=>{var i=da(),v=a(i);$e(v,{class:"inline size-4"});var b=s(v,2),F=a(b);x(()=>W(F,e(ze))),r(Ce,i)}),r(V,Z)};g(j,V=>{e(w)&&e(w).teams&&e(w).teams.length>0&&V(B)})}r(_,D)};g(G,_=>{c()&&_(ge)})}var Te=s(G,2);{var fe=_=>{var w=ua(),D=s(a(w),2);Fe(D,21,()=>e(X),j=>j.id,(j,B)=>{var V=ca(),Z=a(V),be=a(Z);x(()=>W(be,e(B).name||e(B).email)),r(j,V)}),r(_,w)};g(Te,_=>{e(X).length>0&&_(fe)})}var te=s(Te,2);{var A=_=>{var w=ma(),D=s(a(w),2);Fe(D,21,()=>e(xe),j=>j.id,(j,B)=>{var V=fa(),Z=a(V),be=a(Z);x(()=>W(be,e(B).name||e(B).email)),r(j,V)}),r(_,w)};g(te,_=>{e(xe).length>0&&_(A)})}var H=s(le,2);{var J=_=>{var w=ga(),D=a(w);D.__click=[_a,q];var j=a(D);Wt(j,{class:"mr-2 h-4 w-4"}),r(_,w)};g(H,_=>{c()&&_(J)})}r(d,L)},$$slots:{default:!0}});var Ne=s(Ee,2);Ct(Ne,{get isOpen(){return e(q)},onClose:$,children:(d,f)=>{var L=Ma(),ce=ie(L);Dt(ce,{title:"Inviter des participants",onClose:$});var ee=s(ce,2);Nt(ee,{children:(P,le)=>{var de=Da(),G=a(de),ge=s(a(G),2),Te=a(ge),fe=a(Te);Gt(fe,{class:"h-4 w-4 opacity-70"});var te=s(fe,2);te.__keydown=[pa,ke];var A=s(Te,2);A.__click=ke;var H=a(A);ot(H,{class:"h-4 w-4 opacity-70"});var J=s(ge,2);{var _=i=>{var v=ha(),b=a(v);x(()=>W(b,e(E))),r(i,v)};g(J,i=>{e(E)&&i(_)})}var w=s(J,2);Fe(w,21,()=>e(h),at,(i,v)=>{var b=xa(),F=a(b);x(()=>W(F,e(v).email)),r(i,b)});var D=s(G,4),j=a(D),B=a(j);$e(B,{size:16,class:"inline shrink-0 opacity-60"});var V=s(j,2);{var Z=i=>{const v=C(()=>t.eventsStore.getEventById(c()));var b=We(),F=ie(b);{var U=I=>{var se=ka(),we=s(a(se),2);Fe(we,21,()=>e(v).teams,at,(Le,Oe)=>{var qe=ya(),Me=a(qe);$e(Me,{class:"inline size-4"});var pe=s(Me,1,!0);x(()=>W(pe,e(Oe))),r(Le,qe)}),r(I,se)};g(F,I=>{e(v)&&e(v).teams&&e(v).teams.length>0&&I(U)})}r(i,b)};g(V,i=>{c()&&i(Z)})}var be=s(V,2);{var Ce=i=>{const v=C(()=>t.nativeTeamsStore.myTeams.filter(se=>{if(!c())return!0;const we=t.eventsStore.getEventById(c());return!we||!we.teams?!0:!we.teams.includes(se.name)}));var b=We(),F=ie(b);{var U=se=>{var we=Ia(),Le=ie(we);Fe(Le,21,()=>e(v),at,(Me,pe)=>{var Ae=Ea(),je=a(Ae);je.__change=[wa,ye,pe];var Je=s(je,2),o=a(Je),u=a(o),S=s(u),R=a(S),ae=s(o,2),Pe=a(ae);x((O,Ie)=>{It(je,O),W(u,`${e(pe).name??""} `),W(R,`${e(pe).total??""} membre${e(pe).total>1?"s":""}`),W(Pe,Ie)},[()=>e(y).includes(e(pe).$id),()=>t.nativeTeamsStore.getTeamMemberNames(e(pe).$id).join(", ")]),r(Me,Ae)});var Oe=s(Le,2);{var qe=Me=>{var pe=Ta(),Ae=ie(pe),je=a(Ae);At(je,()=>e(m),Je=>n(m,Je)),r(Me,pe)};g(Oe,Me=>{e(y).length>0&&Me(qe)})}r(se,we)},I=se=>{var we=Sa();r(se,we)};g(F,se=>{e(v).length>0?se(U):se(I,!1)})}r(i,b)},ze=i=>{var v=Ca();r(i,v)};g(be,i=>{t.nativeTeamsStore.myTeams.length>0?i(Ce):i(ze,!1)})}x(()=>A.disabled=!e(M)),Xe(te,()=>e(M),i=>n(M,i)),r(P,de)}});var ue=s(ee,2);Mt(ue,{children:(P,le)=>{var de=Na(),G=ie(de);G.__click=$;var ge=s(G,2);ge.__click=[ra,c,t,y,h,m,q];var Te=a(ge);ft(Te,{class:"mr-2 h-4 w-4"});var fe=s(Te,2);{var te=A=>{var H=Tt();x(J=>W(H,`(${J??""})`),[()=>e(_e)().length+e(h).length]),r(A,H)};g(fe,A=>{(e(_e)().length>0||e(h).length>0)&&A(te)})}x(A=>ge.disabled=A,[()=>e(h).length===0&&e(_e)().length===0]),r(P,de)}}),r(d,L)},$$slots:{default:!0}}),r(N,Y),vt()}lt(["click","keydown","change"]);async function qa(N,t,T,c){if(e(t)||T())return;const y=c.todo.status==="done"?"todo":"done";n(t,!0);try{await He.updateTodo(c.eventId,c.todo.id,{status:y})}catch{Q.error("Erreur m√†j statut")}finally{n(t,!1)}}async function Et(N,t,T,c,p,y){if(!ne.userId||e(t)||T())return;const h=e(c)?e(p).filter(m=>m!==ne.userId):[...e(p),ne.userId];n(t,!0);try{await He.updateTodo(y.eventId,y.todo.id,{assignedTo:h.length>0?h:null}),Q.success(e(c)?"Vous avez rejoint la t√¢che":"Vous avez quitt√© la t√¢che")}catch{Q.error("Erreur assignation")}finally{n(t,!1)}}var Oa=l('<div class="flex items-center gap-2"><!> <span> </span></div>'),Aa=l('<div class="flex items-center gap-2"><!> <span>A r√©aliser avant le :</span> <span class="font-medium"> </span></div>'),ja=l("<div><div><span> </span></div></div>"),La=l('<div><div class="bg-base-300 text-base-content w-7 rounded-full"><span class="text-base"> </span></div></div>'),Ba=l('<span class="text-warning mx-1 text-base italic">Non assign√©</span>'),Va=l('<p class="text-base-content/60 mt-1 line-clamp-2 text-sm"> </p>'),Ua=l("<button><!> Fait <!></button>"),Fa=l(`<button class="btn btn-primary btn-outline btn-sm gap-1" title="Me porter volontaire pour cette t√¢che"><!> <span>M'inscrire</span></button>`),Ha=l('<button class="btn btn-error btn-sm btn-outline gap-1" title="Quitter cette t√¢che"><!> <span>me d√©sinscrire</span></button>'),Ra=(N,t)=>t.onEdit(t.todo),Wa=l('<div><div class="flex flex-col gap-3"><div class="flex min-w-0 items-start gap-3"><div class="flex min-w-0 grow flex-col gap-4"><div class="flex flex-wrap items-start justify-between gap-x-4 gap-y-2"><div> </div> <div><!> <!> <!></div></div>  <div class="flex items-center gap-2"><!> <div class="flex min-w-0 items-center gap-1"><div class="flex flex-wrap gap-2"><!> <!> <!></div> <span> </span></div></div> <!></div></div></div> <div class="mt-4 flex items-center justify-between gap-2"><div class="flex gap-2"><!></div> <div class="ms-auto flex gap-2"><!> <button class="btn btn-sm btn-square" title="Modifier la t√¢che"><!></button></div></div></div>');function Ga(N,t){dt(t,!0);let T=Re(t,"disabled",3,!1),c=Re(t,"contributors",19,()=>[]),p=z(!1);const y=C(()=>Array.isArray(t.todo.assignedTo)?t.todo.assignedTo:[]),h=C(()=>ne.userId&&e(y).includes(ne.userId)),m=C(()=>t.todo.assignedTo?t.todo.assignedTo.map(i=>{const v=c().find(U=>U.id===i),b=i===ne.userId,F=v?.name||(b?"Moi":i.substring(0,5));return{userId:i,name:F,isCurrentUser:b}}):[]),q=C(()=>e(m).length>=(t.todo.requiredPeopleNb||1)),k=C(()=>{switch(t.todo.taskOn){case"beforeEvent":return{bg:"bg-accent/30",icon:Kt,label:"Avant l'√©v√©nement"};case"afterEvent":return{bg:"bg-secondary/10",icon:Jt,label:"Apr√®s l'√©v√©nement"};case"onEvent":default:return{bg:"bg-secondary/20",icon:mt,label:"Pendant l'√©v√©nement"}}});var M=Wa();let E;var X=a(M),xe=a(X),ye=a(xe),ke=a(ye),$=a(ke),_e=a($),Y=s($,2),Ee=a(Y);{var Ne=i=>{};g(Ee,i=>{t.todo.priority&&t.todo.priority!=="low"&&i(Ne)})}var d=s(Ee,2);{var f=i=>{var v=Oa(),b=a(v);jt(b,()=>e(k).icon,(I,se)=>{se(I,{class:"size-4 shrink-0 opacity-70"})});var F=s(b,2),U=a(F);x(()=>W(U,e(k).label)),r(i,v)};g(d,i=>{t.todo.taskOn&&i(f)})}var L=s(d,2);{var ce=i=>{var v=Aa(),b=a(v);pt(b,{class:"size-4 shrink-0 opacity-70"});var F=s(b,4),U=a(F);x(I=>W(U,I),[()=>new Date(t.todo.dueDate).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})]),r(i,v)};g(L,i=>{t.todo.dueDate&&i(ce)})}var ee=s(ke,2),ue=a(ee);$e(ue,{class:"mt-1 mb-auto size-4 shrink-0 opacity-60"});var P=s(ue,2),le=a(P),de=a(le);Fe(de,19,()=>e(m).slice(0,3),i=>i.userId,(i,v)=>{var b=ja(),F=a(b),U=a(F),I=a(U);x(()=>{bt(b,"title",e(v).name+(e(v).isCurrentUser?" (vous)":"")),Qe(F,1,`badge badge-soft badge-info ${(e(v).isCurrentUser&&"ring-info font-semibold ring-1")??""}`),W(I,e(v).name)}),r(i,b)});var G=s(de,2);{var ge=i=>{var v=La(),b=a(v),F=a(b),U=a(F);x(()=>{bt(v,"title",`+${e(m).length-3} autres`),W(U,`+${e(m).length-3}`)}),r(i,v)};g(G,i=>{e(m).length>3&&i(ge)})}var Te=s(G,2);{var fe=i=>{var v=Ba();r(i,v)};g(Te,i=>{e(m).length===0&&i(fe)})}var te=s(le,2),A=a(te),H=s(ee,2);{var J=i=>{var v=Va(),b=a(v);x(()=>W(b,t.todo.taskDescription)),r(i,v)};g(H,i=>{t.todo.taskDescription&&i(J)})}var _=s(X,2),w=a(_),D=a(w);{var j=i=>{var v=Ua();v.__click=[qa,p,T,t];var b=a(v);{let I=C(()=>t.todo.status!=="done"&&"opacity-60");ft(b,{get class(){return`size-4 ${e(I)??""}`}})}var F=s(b,2);{var U=I=>{var se=Tt("?");r(I,se)};g(F,I=>{t.todo.status!=="done"&&I(U)})}x(()=>{Qe(v,1,`btn btn-sm ${t.todo.status!=="done"?"btn-dash":"btn-success"}`),bt(v,"title",t.todo.status==="done"?"Marquer √† faire":"Marquer fait"),v.disabled=T()}),r(i,v)};g(D,i=>{t.todo.taskOn==="beforeEvent"&&i(j)})}var B=s(w,2),V=a(B);{var Z=i=>{var v=Fa();v.__click=[Et,p,T,h,y,t];var b=a(v);ft(b,{class:"size-4"}),x(()=>v.disabled=T()),r(i,v)},be=i=>{var v=We(),b=ie(v);{var F=U=>{var I=Ha();I.__click=[Et,p,T,h,y,t];var se=a(I);Qt(se,{class:"size-4"}),x(()=>I.disabled=T()),r(U,I)};g(b,U=>{e(h)&&U(F)},!0)}r(i,v)};g(V,i=>{!e(h)&&e(m).length<(t.todo.requiredPeopleNb||1)?i(Z):i(be,!1)})}var Ce=s(V,2);Ce.__click=[Ra,t];var ze=a(Ce);ut(ze,{class:"size-4"}),x(i=>{E=Qe(M,1,`group bg-base-200/50 relative rounded-xl p-4 shadow transition-all ${e(q)?"shadow-success/40 ":"shadow-warning/40 "}`,null,E,i),Qe($,1,`text-base font-medium ${t.todo.status==="done"?"line-through opacity-50":""}`),W(_e,t.todo.taskName),Qe(Y,1,`card card-sm ${e(k).bg??""} ms-auto flex flex-col justify-end px-4 py-1`),Qe(te,1,`mx-1 ${e(m).length<(t.todo.requiredPeopleNb||1)?"text-warning":"text-success"} font-bold`),W(A,`${e(m).length??""}/${(t.todo.requiredPeopleNb||1)??""} pers. requise`),Ce.disabled=T()},[()=>({"opacity-50":e(p)})]),r(N,M),vt()}lt(["click"]);async function Ja(N,t,T,c,p){const y=e(t).filter(h=>h.enabled);if(y.length===0){Q.warning("S√©lectionnez au moins une t√¢che");return}n(T,!0);try{const h=new Date().toISOString(),m=y.map(q=>({id:_t(10),taskName:q.taskName,taskDescription:null,priority:"medium",taskOn:q.taskOn,requiredPeopleNb:q.requiredPeopleNb,dueDate:null,assignedTo:null,status:"todo"}));await He.addTodos(c.eventId,m),Q.success(`${m.length} t√¢che(s) cr√©√©e(s)`),p()}catch(h){Q.error("Erreur lors de la cr√©ation"),console.error(h)}finally{n(T,!1)}}var Ka=(N,t)=>n(t,"individual"),Qa=(N,t)=>n(t,"bulk"),Xa=l('<div role="tablist" class="tabs tabs-border tabs-lg mb-4"><button role="tab"><!> T√¢che individuelle</button> <button role="tab"><!> T√¢ches pr√©d√©finies</button></div>'),Ya=l('<span class="badge badge-warning badge-sm"> </span>'),Za=l('<span class="badge badge-success badge-sm flex items-center gap-1"><!> ok</span>'),$a=l(`<div class="space-y-4"><fieldset class="fieldset"><legend class="fieldset-legend">Titre</legend> <label class="input w-full"><input type="text" placeholder="Ex: Acheter du pain, Pr√©parer la salle..." class="grow"/></label></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-2"><!> Description</legend> <textarea class="textarea h-24 w-full" placeholder="D√©tails suppl√©mentaires..."></textarea></fieldset> <div class="flex flex-wrap gap-4"><fieldset class="fieldset w-80"><legend class="fieldset-legend flex items-center gap-2"><!> Moment</legend> <select class="select w-full"><option>Avant l'√©v√©nement</option><option>Pendant l'√©v√©nement</option><option>Apr√®s l'√©v√©nement</option></select></fieldset> <fieldset class="fieldset w-80"><legend class="fieldset-legend flex items-center gap-2"><!> √âch√©ance</legend> <label class="input w-full"><input type="date" class="grow"/></label></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-2"><!> Personnes requises</legend> <label class="input w-full"><input type="number" min="1" class="grow"/></label></fieldset></div> <fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-2"><!> <!></legend> <!></fieldset></div>`),en=(N,t,T)=>t(e(T)),tn=l('<div class="bg-base-100 flex items-center gap-4 rounded-lg p-3"><input type="checkbox" class="checkbox checkbox-primary"/> <input type="text" class="input flex-1"/> <div class="flex items-center gap-2"><!> <input type="number" class="input w-20" min="1"/></div></div>'),an=l('<div class="collapse-arrow bg-base-200 collapse"><input type="checkbox" checked/> <div class="collapse-title flex items-center gap-2 font-medium"><!> </div> <div class="collapse-content"><div class="mt-4 space-y-3"></div></div></div>'),nn=l('<div class="space-y-6"></div>'),sn=l("<!> <!>",1),rn=l('<span class="loading loading-spinner loading-sm"></span>'),on=l('<button type="button" class="btn btn-primary"><!> Cr√©er les t√¢ches s√©lectionn√©es</button>'),ln=(N,t)=>t(!0),dn=l('<button type="button" class="btn btn-ghost"><!> Sauvegarder & Cr√©er</button>'),vn=(N,t)=>t(!1),cn=l('<span class="loading loading-spinner loading-sm"></span>'),un=l('<!> <button type="button" class="btn btn-primary"><!> </button>',1),fn=l("<!> <!> <!>",1);function mn(N,t){dt(t,!0);let T=Re(t,"contributors",19,()=>[]);Re(t,"currentTodos",19,()=>[]);let c=z(""),p=z(""),y=z("medium"),h=z("onEvent"),m=z(1),q=z(""),k=z(it([])),M=z(!1),E=z("individual");const X={beforeEvent:["Gestion de l'approvisionnement / courses","Choix des recettes/menus","Coordination","Communication (mail, texto, affiches)","Gestion matos"],onEvent:["Pr√©parations des recettes","Service","Rangement","Vaisselle","Gestion des restes"],afterEvent:["Retour matos","D√©montage cuisine"]},xe=C(()=>t.todoToEdit?{taskName:t.todoToEdit.taskName,taskDescription:t.todoToEdit.taskDescription||"",priority:t.todoToEdit.priority||"medium",taskOn:t.todoToEdit.taskOn||"onEvent",requiredPeopleNb:t.todoToEdit.requiredPeopleNb||1,dueDate:t.todoToEdit.dueDate?t.todoToEdit.dueDate.split("T")[0]:"",assignedTo:t.todoToEdit.assignedTo?[...t.todoToEdit.assignedTo]:[]}:{taskName:"",taskDescription:"",priority:"medium",taskOn:"onEvent",requiredPeopleNb:1,dueDate:"",assignedTo:[]});Ye(()=>{if(t.open){t.todoToEdit?n(E,"individual"):n(E,"individual");const d=e(xe);n(c,d.taskName,!0),n(p,d.taskDescription,!0),n(y,d.priority,!0),n(h,d.taskOn,!0),n(m,d.requiredPeopleNb,!0),n(q,d.dueDate,!0),n(k,d.assignedTo,!0)}});function ye(){n(c,""),n(p,""),n(y,"medium"),n(h,"onEvent"),n(m,1),n(q,""),n(k,[],!0)}async function ke(d=!1){if(!e(c).trim()){Q.warning("Le titre de la t√¢che est requis");return}n(M,!0);try{const f=new Date().toISOString();if(t.todoToEdit){const L={taskName:e(c),taskDescription:e(p)||null,priority:e(y),taskOn:e(h),requiredPeopleNb:e(m),dueDate:e(q)?new Date(e(q)).toISOString():null,assignedTo:e(k).length>0?e(k):null};await He.updateTodo(t.eventId,t.todoToEdit.id,L),Q.success("T√¢che mise √† jour"),$()}else{const L={id:_t(10),taskName:e(c),taskDescription:e(p)||null,priority:e(y),taskOn:e(h),requiredPeopleNb:e(m),dueDate:e(q)?new Date(e(q)).toISOString():null,assignedTo:e(k).length>0?e(k):null,status:"todo"};await He.addTodo(t.eventId,L),Q.success("T√¢che cr√©√©e"),d?ye():$()}}catch(f){Q.error("Erreur lors de la sauvegarde"),console.error(f)}finally{n(M,!1)}}function $(){ye(),t.onClose()}function _e(d){e(k).includes(d)?n(k,e(k).filter(f=>f!==d),!0):n(k,[...e(k),d],!0)}let Y=z(it([]));Ye(()=>{t.open&&e(E)==="bulk"&&n(Y,[...X.beforeEvent.map(d=>({taskName:d,taskOn:"beforeEvent",enabled:!0,requiredPeopleNb:1})),...X.onEvent.map(d=>({taskName:d,taskOn:"onEvent",enabled:!0,requiredPeopleNb:1})),...X.afterEvent.map(d=>({taskName:d,taskOn:"afterEvent",enabled:!1,requiredPeopleNb:1}))],!0)});function Ee(d){e(Y)[d].enabled=!e(Y)[d].enabled}const Ne=C(()=>{const d=[{id:ne.userId||"",label:"Moi",selected:e(k).includes(ne.userId||"")}];return T().forEach(f=>{f.id!==ne.userId&&d.push({id:f.id,label:f.name||f.email||f.id.substring(0,5),selected:e(k).includes(f.id)})}),d});Ct(N,{get isOpen(){return t.open},onClose:$,maxWidth:"lg",maxHeight:"xl",children:(d,f)=>{var L=fn(),ce=ie(L);{let P=C(()=>t.todoToEdit?"Modifier la T√¢che":"Nouvelle T√¢che");Dt(ce,{get title(){return e(P)},onClose:$})}var ee=s(ce,2);Nt(ee,{children:(P,le)=>{var de=sn(),G=ie(de);{var ge=A=>{var H=Xa(),J=a(H);J.__click=[Ka,E];var _=a(J);yt(_,{class:"me-2 size-4"});var w=s(J,2);w.__click=[Qa,E];var D=a(w);kt(D,{class:"me-2 size-4"}),x(()=>{Qe(J,1,`tab ${e(E)==="individual"?"tab-active":""}`),Qe(w,1,`tab ${e(E)==="bulk"?"tab-active":""}`)}),r(A,H)};g(G,A=>{t.todoToEdit||A(ge)})}var Te=s(G,2);{var fe=A=>{var H=$a(),J=a(H),_=s(a(J),2),w=a(_),D=s(J,2),j=a(D),B=a(j);yt(B,{class:"size-4 opacity-50"});var V=s(j,2),Z=s(D,2),be=a(Z),Ce=a(be),ze=a(Ce);mt(ze,{class:"size-4 opacity-50"});var i=s(Ce,2),v=a(i);v.value=v.__value="beforeEvent";var b=s(v);b.value=b.__value="onEvent";var F=s(b);F.value=F.__value="afterEvent";var U=s(be,2),I=a(U),se=a(I);pt(se,{class:"size-4 opacity-50"});var we=s(I,2),Le=a(we),Oe=s(U,2),qe=a(Oe),Me=a(qe);$e(Me,{class:"size-4 opacity-50"});var pe=s(qe,2),Ae=a(pe),je=s(Z,2),Je=a(je),o=a(Je);$e(o,{class:"size-4 opacity-50"});var u=s(o),S=s(u);{var R=O=>{var Ie=Ya(),re=a(Ie);x(()=>W(re,`Manque ${e(m)-e(k).length} pers.`)),r(O,Ie)},ae=O=>{var Ie=Za(),re=a(Ie);ft(re,{class:"size-3"}),r(O,Ie)};g(S,O=>{e(k).length<e(m)?O(R):O(ae,!1)})}var Pe=s(Je,2);na(Pe,{get items(){return e(Ne)},size:"lg",color:"primary",onToggleItem:_e}),x(()=>W(u,` Assignation (${e(k).length??""}/${e(m)??""}) `)),Xe(w,()=>e(c),O=>n(c,O)),Xe(V,()=>e(p),O=>n(p,O)),Lt(i,()=>e(h),O=>n(h,O)),Xe(Le,()=>e(q),O=>n(q,O)),Xe(Ae,()=>e(m),O=>n(m,O)),r(A,H)},te=A=>{var H=nn();Fe(H,20,()=>["beforeEvent","onEvent","afterEvent"],at,(J,_)=>{const w=C(()=>_==="beforeEvent"?"Avant l'√©v√©nement":_==="onEvent"?"Pendant l'√©v√©nement":"Apr√®s l'√©v√©nement"),D=C(()=>e(Y).filter(Z=>Z.taskOn===_));var j=We(),B=ie(j);{var V=Z=>{var be=an(),Ce=a(be),ze=s(Ce,2),i=a(ze);mt(i,{class:"size-4 opacity-50"});var v=s(i),b=s(ze,2),F=a(b);Fe(F,21,()=>e(D),at,(U,I,se)=>{const we=C(()=>e(Y).indexOf(e(I)));var Le=tn(),Oe=a(Le);Oe.__change=[en,Ee,we];var qe=s(Oe,2),Me=s(qe,2),pe=a(Me);$e(pe,{class:"size-4 opacity-50"});var Ae=s(pe,2);x(()=>{It(Oe,e(I).enabled),St(qe,e(I).taskName),qe.disabled=!e(I).enabled,Ae.disabled=!e(I).enabled}),Xe(Ae,()=>e(I).requiredPeopleNb,je=>e(I).requiredPeopleNb=je),r(U,Le)}),x(U=>W(v,` ${e(w)??""} (${U??""}/${e(D).length??""})`),[()=>e(D).filter(U=>U.enabled).length]),r(Z,be)};g(B,Z=>{e(D).length>0&&Z(V)})}r(J,j)}),r(A,H)};g(Te,A=>{t.todoToEdit||e(E)==="individual"?A(fe):A(te,!1)})}r(P,de)}});var ue=s(ee,2);Mt(ue,{children:(P,le)=>{var de=We(),G=ie(de);{var ge=fe=>{var te=on();te.__click=[Ja,Y,M,t,$];var A=a(te);{var H=_=>{var w=rn();r(_,w)},J=_=>{kt(_,{class:"size-4"})};g(A,_=>{e(M)?_(H):_(J,!1)})}x(()=>te.disabled=e(M)),r(fe,te)},Te=fe=>{var te=un(),A=ie(te);{var H=B=>{var V=dn();V.__click=[ln,ke];var Z=a(V);ot(Z,{class:"size-4"}),x(()=>V.disabled=e(M)),r(B,V)};g(A,B=>{t.todoToEdit||B(H)})}var J=s(A,2);J.__click=[vn,ke];var _=a(J);{var w=B=>{var V=cn();r(B,V)},D=B=>{Pt(B,{class:"size-4"})};g(_,B=>{e(M)?B(w):B(D,!1)})}var j=s(_);x(()=>{J.disabled=e(M),W(j,` ${t.todoToEdit?"Mettre √† jour":"Cr√©er la t√¢che"}`)}),r(fe,te)};g(G,fe=>{e(E)==="bulk"?fe(ge):fe(Te,!1)})}r(P,de)}}),r(d,L)},$$slots:{default:!0}}),vt()}lt(["click","change"]);var _n=(N,t)=>N.key==="Enter"&&t(),gn=l('<div class="text-base-content/50 border-base-200 hover:border-primary/50 cursor-pointer rounded-lg border-2 border-dashed py-8 text-center text-sm italic transition-colors" role="button" tabindex="0">Aucune t√¢che pour le moment. <br/> <span class="text-primary mt-1 inline-block font-medium">Cr√©er la premi√®re t√¢che +</span></div>'),bn=l('<div class="mb-4 flex items-center justify-between"><div class="flex items-center gap-2 text-sm opacity-60"><!> <span> </span></div> <button class="btn btn-sm btn-primary gap-2"><!> Nouvelle t√¢che</button></div> <div class=" space-y-4"><!></div> <!>',1);function pn(N,t){dt(t,!0);let T=Re(t,"contributors",19,()=>[]),c=Re(t,"disabled",3,!1);const p=C(()=>t.event.todos??[]);function y(X){return{beforeEvent:1,onEvent:2,afterEvent:3}[X]??0}const h=C(()=>[...e(p)].sort((xe,ye)=>{const ke=y(xe.taskOn??""),$=y(ye.taskOn??""),_e=ke-$;if(_e!==0)return _e;const Y=xe.dueDate?new Date(xe.dueDate).getTime():1/0,Ee=ye.dueDate?new Date(ye.dueDate).getTime():1/0;return Y-Ee}));let m=z(!1),q=z(null);function k(){n(q,null),n(m,!0)}function M(X){n(q,X,!0),n(m,!0)}function E(X){t.onTodosChange?.(X)}ct(N,{legend:"T√¢ches & Organisation",legendSize:"text-lg",children:(X,xe)=>{var ye=bn(),ke=ie(ye),$=a(ke),_e=a($);Xt(_e,{class:"size-4"});var Y=s(_e,2),Ee=a(Y),Ne=s($,2);Ne.__click=k;var d=a(Ne);ot(d,{class:"size-4"});var f=s(ke,2),L=a(f);{var ce=P=>{var le=gn();le.__click=k,le.__keydown=[_n,k],r(P,le)},ee=P=>{var le=We(),de=ie(le);Fe(de,17,()=>e(h),G=>G.id,(G,ge)=>{Ga(G,{get todo(){return e(ge)},get eventId(){return t.event.$id},onEdit:M,get disabled(){return c()},get contributors(){return T()}})}),r(P,le)};g(L,P=>{e(h).length===0?P(ce):P(ee,!1)})}var ue=s(f,2);mn(ue,{get open(){return e(m)},get eventId(){return t.event.$id},get todoToEdit(){return e(q)},get contributors(){return T()},get currentTodos(){return e(p)},onClose:()=>n(m,!1),onSave:E}),x(()=>{W(Ee,`${e(p).length??""} t√¢ches`),Ne.disabled=c()}),r(X,ye)},$$slots:{default:!0}}),vt()}lt(["click","keydown"]);async function hn(N,t,T,c){n(t,!0),await T()&&(await c(),Q.success("√âv√©nement mis √† jour")),n(t,!1)}async function xn(N,t,T){await t()&&n(T,N.target.value,!0)}var yn=l('<span class="loading loading-spinner loading-xs text-primary"></span>'),kn=l('<div class="flex items-center gap-2"><button class="btn btn-accent"><!> <span class="font-bold">Enregistrer</span></button></div>'),wn=l(`<input type="text" class="input input-lg min-w-full shadow-md" placeholder="Nom de l'√©v√©nement"/>`),En=(N,t)=>n(t,!e(t)),Tn=l('<button class="btn btn-ghost"><div class="flex items-baseline gap-4"><div class="text-4xl font-bold"> </div> <!></div></button>'),In=l(`<textarea class="textarea w-full" placeholder="D√©crivez l'√©v√©nement..." maxlength="3000" rows="9"></textarea> <p class="label"> </p>`,1),Sn=(N,t)=>n(t,!0),Cn=l('<p class="whitespace-pre-wrap"> </p>'),Dn=l('<p class="text-base-content/40 italic">Ajoutez une description...</p>'),Nn=l('<button class="btn btn-ghost bg-base-100 h-auto justify-start py-4 text-left font-normal"><div class="flex w-full items-start justify-between gap-4"><div class="flex-1"><!></div> <!></div></button>'),Mn=l('<div class="badge badge-lg badge-success gap-1"><!> Confirm√©</div>'),Pn=l('<div class="badge badge-lg badge-info gap-1"><!> Proposition</div>'),zn=l('<div class="badge badge-lg badge-warning gap-1"><!> </div>'),qn=(N,t)=>n(t,!0),On=l(`<button class="btn btn-success btn-link btn-md">Confirmez l'√©v√©nement</button>`),An=(N,t)=>n(t,!0),jn=l(`<button class="btn btn-link btn-error btn-sm">Annuler l'√©v√©nement</button>`),Ln=async(N,t,T)=>{await t()&&n(T,"proposition")},Bn=l('<button class="btn btn-link btn-sm">R√©activer</button>'),Vn=l('<div class="flex flex-wrap items-center justify-between gap-2"><div class="flex items-center gap-2"><!></div> <!></div>'),Un=l('<div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:col-span-2 lg:grid-cols-3"><div class="col-span-2"><!></div> <div class="flex flex-col justify-start gap-4"><!></div></div>'),Fn=l(`<div class="alert alert-warning"><!> <div><h3 class="font-bold">√âv√©nement en cours de modification</h3> <div class="text-xs">Un autre utilisateur est en train de modifier cet √©v√©nement. Les
          contr√¥les sont temporairement d√©sactiv√©s.</div></div></div>`),Hn=l(`<div class="flex items-center justify-center py-20"><div class="flex flex-col items-center gap-4"><span class="loading loading-spinner loading-lg text-primary"></span> <p class="text-base-content/60">Chargement de l'√©v√©nement...</p></div></div>`),Rn=l('<div class="text-base-content/60 bg-base-200 rounded-box border-base-200 flex flex-col items-center justify-center border-2 border-dashed py-12"><div class="bg-base-200 mb-4 rounded-full p-4"><!></div> <p class="font-medium">Aucun repas planifi√©</p> <p class="mt-1 text-sm">Commencez par ajouter un repas √† votre √©v√©nement</p></div>'),Wn=l("<div><!></div>"),Gn=l('<div class="space-y-4"></div>'),Jn=l('<div class="grid grid-cols-1 gap-6 pb-20 lg:grid-cols-3"><div class="space-y-6 lg:col-span-1"><!> <!></div> <div class="space-y-6 md:px-4 lg:col-span-2"><div class="mb-6 flex items-center justify-between"><h3 class="card-title text-lg"> </h3> <button class="btn btn-primary"><!> Ajouter un repas</button></div> <!> <div class="flex"><button class="btn btn-outline btn-primary btn-block mt-4"><!> Ajouter un repas</button></div></div></div>'),Kn=l('<div class="bg-base-200 min-h-lvh space-y-6 px-2 pt-4 pb-20 md:px-20"><div class="flex flex-wrap items-center justify-between gap-x-6 gap-y-3"><div class="min-w-80 flex-1 gap-2"><!></div> <!></div> <!> <!> <!> <!></div> <!> <!> <!>',1);function fs(N,t){dt(t,!0);const T=o=>{var u=kn(),S=a(u);S.__click=[hn,E,te,G];var R=a(S);{var ae=O=>{var Ie=yn();r(O,Ie)},Pe=O=>{Pt(O,{size:18,class:"mr-1"})};g(R,O=>{e(E)?O(ae):O(Pe,!1)})}x(()=>S.disabled=e(E)||!e(Ne)||!e(P)),r(o,u)};let c=C(()=>t.params.id),p=z(it([])),y=z(""),h=z(""),m=z("proposition"),q=z(1);const k=C(()=>[...e(p)].sort((o,u)=>new Date(o.date).getTime()-new Date(u.date).getTime()));let M=z(!1),E=z(!1),X=z(!1),xe=z(null),ye=z(!1),ke=z(!1),$=z(!1),_e=z(!1),Y=z(null),Ee=null;const Ne=C(()=>{if(!e(ue)||!e(f))return!1;const o=JSON.stringify({name:e(f).name,meals:e(f).meals||[],description:e(f).description||"",status:e(f).status||"proposition",minContrib:e(f).minContrib||1}),u=JSON.stringify({name:e(y),meals:e(p),description:e(h),status:e(m),minContrib:e(q)});return o!==u});async function d(){return console.log("startEditing"),e(ue)?!0:e(ee)?(Q.warning(`Cet √©v√©nement est verrouill√© par ${e(le)}`),!1):await de()}const f=C(()=>He.getEventById(e(c))),L=C(()=>ta(e(f))),ce=C(()=>e(f)?.teamsId??[]),ee=C(()=>e(Y)?e(Y).userId!==ne.userId:!1),ue=C(()=>e(Y)?e(Y).userId===ne.userId:!1),P=C(()=>He.canUserEditEvent(e(c),ne.userId||"")&&!e(ee)&&!e(E)),le=C(()=>e(Y)?.userName||"un autre utilisateur");Ye(()=>{e(f)&&e(M)&&(n(p,Vt(e(f).meals||[]),!0),n(y,e(f).name||"",!0),n(h,e(f).description||"",!0),n(m,e(f).status||"proposition",!0),n(q,e(f).minContrib||1,!0),console.log("üîÑ Shadow draft synchronis√© depuis currentEvent (Preview)"))}),Ye(()=>{xt.setConfig({eventId:e(c),actions:T,isLockedByOthers:e(ee),lockedByUserName:e(le),hasUnsavedChanges:e(Ne)&&!e(ee)})}),Ye(()=>{!e(M)&&!e(E)&&Ut(async()=>{n(E,!0);try{n(Y,await rt.getLock(e(c)),!0),Ee=rt.subscribeToLock(e(c),o=>{console.log("[EventEditPage] üîí Verrou mis √† jour (Realtime):",{lockedBy:o?.userName,userId:o?.userId,expiresAt:o?.expiresAt}),n(Y,o,!0)}),n(M,!0)}finally{n(E,!1)}})}),Bt(()=>{H&&(clearTimeout(H),H=null),Ee&&(Ee(),Ee=null),e(c)&&e(ue)&&(console.log("üö™ D√©montage du composant, lib√©ration du lock..."),G()),xt.reset()});async function de(){if(!e(c)||!ne.userId||e(E)||e(X))return!1;n(X,!0);try{return await rt.acquireLock(e(c),ne.userId,ne.userName)?(J(),!0):(Q.warning(`Cet √©v√©nement est en cours de modification par ${e(le)}`),!1)}catch(o){return console.error("‚ùå Erreur acquisition verrou:",o),Q.error("Impossible de verrouiller l'√©v√©nement"),!1}finally{n(X,!1)}}async function G(){if(!(!e(c)||!ne.userId))try{await rt.releaseLock(e(c),ne.userId),console.log("üîì Verrou lib√©r√©")}catch(o){console.error("‚ùå Erreur lib√©ration verrou:",o)}}async function ge(){e(ue)&&await G()}async function Te(){const o=await te();return o&&await G(),o}function fe(){if(!e(y).trim())return{isValid:!1,errorMessage:"Veuillez renseigner le nom de l'√©v√©nement"};if(e(p).length===0)return{isValid:!1,errorMessage:"Veuillez ajouter au moins un repas"};const u=e(p).map(S=>S.date).filter((S,R,ae)=>ae.indexOf(S)!==R);return u.length>0?{isValid:!1,errorMessage:`Certaines dates sont en double: ${u.map(R=>{try{return new Date(R).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return R}}).join(", ")}`}:{isValid:!0}}async function te(){const o=fe();if(!o.isValid)return Q.error(o.errorMessage||"Erreur de validation"),!1;const u=e(L),S=Array.from(new Set(e(k).map(re=>re.date))).sort(),R=e(f)?.teams||[],ae=e(f)?.teamsId||[],Pe=new Map(ae.map((re,Ge)=>[re,R[Ge]])),O=e(ce).map(re=>ht.getTeamById(re)?.name||Pe.get(re)||re),Ie={name:e(y),description:e(h),status:e(m),minContrib:e(q),allDates:S,dateStart:S.length>0?S[0]:"",dateEnd:S.length>0?S[S.length-1]:"",teams:O,teamsId:e(ce),contributors:u,meals:e(k)};try{return await He.updateEvent(e(c),Ie),!0}catch(re){return console.error("Erreur sauvegarde:",re),Q.error("Erreur lors de la sauvegarde"),!1}}async function A(){if(!e(c)||e(E)||!e(ue))return;n(E,!0);const o=Q.loading("Sauvegarde automatique...");if(await te())await G(),Q.update(o,{state:"success",message:"Modifications sauvegard√©es automatiquement"});else{if(e(c)&&ne.userId)try{await rt.acquireLock(e(c),ne.userId,ne.userName)}catch(S){console.error("Erreur heartbeat lock:",S)}Q.update(o,{state:"warning",message:"Impossible de sauvegarder : modifications invalides"})}n(E,!1),setTimeout(()=>Q.dismiss(o),3e3)}let H=null;function J(){H&&clearTimeout(H),H=setTimeout(()=>{A()},120*1e3),console.log("‚è∞ Auto-save programm√© dans 30 secondes")}Ye(()=>{const o=e(ue),u=e(Ne),S=R=>{(o||u)&&(R.preventDefault(),R.returnValue="Vous avez des modifications non sauvegard√©es. Voulez-vous vraiment quitter ?")};return window.addEventListener("beforeunload",S),()=>{window.removeEventListener("beforeunload",S)}});async function _(){if(!await d())return;const o=_t(6);let u;if(e(k).length===0){const R=new Date;R.setHours(12,0,0,0),u=R.toISOString()}else{const R=e(k)[e(k).length-1],ae=new Date(R.date);ae.getHours()<14?ae.setHours(20,0,0,0):(ae.setDate(ae.getDate()+1),ae.setHours(12,0,0,0)),u=ae.toISOString()}const S={id:o,date:u,guests:100,recipes:[]};n(p,[...e(p),S],!0),n(xe,o,!0)}function w(o){n(p,e(p).filter(u=>u.id!==o),!0)}function D(o){n(xe,e(xe)===o?null:o,!0)}async function j(o){if(!(!e(c)||!ne.userId))try{n(E,!0);const u=o?"accepted":"declined";await He.updateContributorStatus(e(c),ne.userId,u),Q.success(o?"Invitation accept√©e":"Invitation d√©clin√©e")}catch(u){console.error("Erreur r√©ponse invitation:",u),Q.error("Erreur lors de la r√©ponse")}finally{n(E,!1)}}async function B(){await d()&&(n(m,"confirmed"),n($,!1))}async function V(){await d()&&(n(m,"canceled"),n(_e,!1))}var Z=Kn(),be=ie(Z),Ce=a(be),ze=a(Ce),i=a(ze);{var v=o=>{var u=wn();u.__input=[xn,d,y],x(()=>{St(u,e(y)),u.disabled=!e(P)}),tt("focus",u,d),tt("blur",u,()=>n(ye,!1)),r(o,u)},b=o=>{var u=Tn();u.__click=[En,ye];var S=a(u),R=a(S),ae=a(R),Pe=s(R,2);ut(Pe,{class:"h-4 w-4"}),x(()=>{u.disabled=!e(P),W(ae,e(y)||"Nom de l'√©v√©nement")}),r(o,u)};g(i,o=>{e(ye)?o(v):o(b,!1)})}var F=s(ze,2);{var U=o=>{aa(o,{get currentEvent(){return e(f)}})};g(F,o=>{e(f)&&o(U)})}var I=s(Ce,2);{var se=o=>{var u=Un(),S=a(u),R=a(S);ct(R,{legend:"Description",children:(O,Ie)=>{var re=We(),Ge=ie(re);{var Ze=Be=>{var Ve=In(),Ue=ie(Ve),Ke=s(Ue,2),oe=a(Ke);x(()=>{Ue.disabled=!e(P),W(oe,`${e(h).length??""}/3000 caract√®res`)}),tt("focus",Ue,d),tt("blur",Ue,()=>n(ke,!1)),Xe(Ue,()=>e(h),he=>n(h,he)),r(Be,Ve)},nt=Be=>{var Ve=Nn();Ve.__click=[Sn,ke];var Ue=a(Ve),Ke=a(Ue),oe=a(Ke);{var he=Se=>{var K=Cn(),me=a(K);x(()=>W(me,e(h))),r(Se,K)},ve=Se=>{var K=Dn();r(Se,K)};g(oe,Se=>{e(h)?Se(he):Se(ve,!1)})}var De=s(Ke,2);ut(De,{class:"h-4 w-4 shrink-0"}),x(()=>Ve.disabled=!e(P)),r(Be,Ve)};g(Ge,Be=>{e(ke)?Be(Ze):Be(nt,!1)})}r(O,re)},$$slots:{default:!0}});var ae=s(S,2),Pe=a(ae);ct(Pe,{legend:"Statut de l'√©v√©nement",children:(O,Ie)=>{var re=Vn(),Ge=a(re),Ze=a(Ge);{var nt=oe=>{var he=Mn(),ve=a(he);Yt(ve,{class:"h-3 w-3"}),r(oe,he)},Be=oe=>{var he=We(),ve=ie(he);{var De=K=>{var me=Pn(),et=a(me);mt(et,{class:"h-3 w-3"}),r(K,me)},Se=K=>{var me=zn(),et=a(me);$t(et,{class:"h-3 w-3"});var gt=s(et);x(()=>W(gt,` ${e(m)??""}`)),r(K,me)};g(ve,K=>{e(m)==="proposition"?K(De):K(Se,!1)},!0)}r(oe,he)};g(Ze,oe=>{e(m)==="confirmed"?oe(nt):oe(Be,!1)})}var Ve=s(Ge,2);{var Ue=oe=>{var he=On();he.__click=[qn,$],x(()=>he.disabled=!e(P)),r(oe,he)},Ke=oe=>{var he=We(),ve=ie(he);{var De=K=>{var me=jn();me.__click=[An,_e],x(()=>me.disabled=!e(P)),r(K,me)},Se=K=>{var me=Bn();me.__click=[Ln,d,m],x(()=>me.disabled=!e(P)),r(K,me)};g(ve,K=>{e(m)==="confirmed"?K(De):K(Se,!1)},!0)}r(oe,he)};g(Ve,oe=>{e(m)==="proposition"?oe(Ue):oe(Ke,!1)})}r(O,re)},$$slots:{default:!0}}),r(o,u)};g(I,o=>{e(M)&&o(se)})}var we=s(I,2);{var Le=o=>{var u=Fn(),S=a(u);Zt(S,{class:"h-6 w-6 shrink-0"}),r(o,u)};g(we,o=>{e(ee)&&o(Le)})}var Oe=s(we,2);ea(Oe,{get currentEvent(){return e(f)},get isBusy(){return e(E)},onRespond:j});var qe=s(Oe,2);{var Me=o=>{var u=Hn();r(o,u)},pe=o=>{var u=Jn(),S=a(u),R=a(S);{let ve=C(()=>ne.userId||"");za(R,{get canEdit(){return e(P)},get contributors(){return e(L)},get nativeTeamsStore(){return ht},get eventsStore(){return He},get userId(){return e(ve)},get eventId(){return e(c)},onStartEdit:d,get minContrib(){return e(q)},set minContrib(De){n(q,De,!0)}})}var ae=s(R,2);{var Pe=ve=>{{let De=C(()=>!e(P)||e(ee));pn(ve,{get event(){return e(f)},get contributors(){return e(L)},get disabled(){return e(De)}})}};g(ae,ve=>{e(f)&&ve(Pe)})}var O=s(S,2),Ie=a(O),re=a(Ie),Ge=a(re),Ze=s(re,2);Ze.__click=_;var nt=a(Ze);ot(nt,{class:"mr-1 h-4 w-4"});var Be=s(Ie,2);{var Ve=ve=>{var De=Rn(),Se=a(De),K=a(Se);pt(K,{class:"h-8 w-8 opacity-50"}),r(ve,De)},Ue=ve=>{var De=Gn();Fe(De,29,()=>e(k),Se=>Se.id+"-"+e(f)?.$updatedAt,(Se,K)=>{var me=Wn(),et=a(me);{let gt=C(()=>e(xe)===e(K).id),zt=C(()=>e(p).map(st=>st.date)),qt=C(()=>!e(P)||e(ee));Rt(et,{get isEditing(){return e(gt)},onEditToggle:async()=>{await d()&&D(e(K).id||"")},onDelete:()=>w(e(K).id||""),get allDates(){return e(zt)},get disabled(){return e(qt)},get meal(){return e(p)[e(p).findIndex(st=>st.id===e(K).id)]},set meal(st){e(p)[e(p).findIndex(Ot=>Ot.id===e(K).id)]=st}})}Ft(me,()=>Ht,()=>({delay:100,duration:400})),r(Se,me)}),r(ve,De)};g(Be,ve=>{e(k).length===0?ve(Ve):ve(Ue,!1)})}var Ke=s(Be,2),oe=a(Ke);oe.__click=_;var he=a(oe);ot(he,{class:"mr-1 h-4 w-4"}),x(()=>{W(Ge,`Repas & Menus (${e(k).length??""})`),Ze.disabled=!e(P),oe.disabled=!e(P)}),r(o,u)};g(qe,o=>{e(E)&&!e(M)?o(Me):o(pe,!1)})}var Ae=s(be,2);wt(Ae,{get isOpen(){return e($)},title:"Confirmer l'√©v√©nement",message:"√ätes-vous s√ªr de vouloir confirmer cet √©v√©nement ? ",variant:"info",confirmLabel:"Confirmer",cancelLabel:"Annuler",onConfirm:B,onCancel:()=>n($,!1)});var je=s(Ae,2);wt(je,{get isOpen(){return e(_e)},title:"Annuler la confirmation",message:"√ätes-vous s√ªr de vouloir annuler cet √©v√©nement ?.",variant:"warning",confirmLabel:"Oui, annuler",cancelLabel:"Non, garder",onConfirm:V,onCancel:()=>n(_e,!1)});var Je=s(je,2);{let o=C(()=>`/dashboard/eventEdit/${e(c)}`);sa(Je,{get routeKey(){return e(o)},shouldProtect:()=>e(Ne),onLeaveWithoutSave:ge,onSaveAndLeave:Te,message:"Vous avez des modifications non sauvegard√©es. Voulez-vous vraiment quitter ?"})}r(N,Z),vt()}lt(["click","input"]);export{fs as default};
