var br=Object.defineProperty;var Ba=_=>{throw TypeError(_)};var hr=(_,e,r)=>e in _?br(_,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):_[e]=r;var Pa=(_,e,r)=>hr(_,typeof e!="symbol"?e+"":e,r),xr=(_,e,r)=>e.has(_)||Ba("Cannot "+r);var Dt=(_,e,r)=>(xr(_,e,"read from private field"),r?r.call(_):e.get(_)),Kt=(_,e,r)=>e.has(_)?Ba("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(_):e.set(_,r);import{x as Bt,j as Pt,W as o,A as a,B as s,m as Ya,y as Za,$ as l,X as f,_ as St,a1 as _e,v as n,w as Lt,g as t,u as L,Z as Zt,a3 as pa,aj as tr,p as Ht,s as ht,b as be,a as D,E as ct,Y as c,o as Wt,z as Pe,a0 as Tt,ak as La,a2 as ae,D as Ot,a5 as Ta,am as er,ap as yr,al as wr,ac as ca,l as ar,a6 as kr,G as _a,a9 as Sr,aa as Pr}from"./vendor.B7h_mkEd.js";import{p as P,a as Yt,t as Ia,S as Mr,T as Cr,V as qr,W as je,X as Se,U as ze,Y as Dr,Z as rr,$ as Tr,a0 as Ra,a1 as Ir,a2 as $r,a3 as Ar,a4 as Er,a5 as Or,a6 as fa,a7 as sr,a8 as Nr,a9 as nr,aa as Qa,ab as De,ac as jr,ad as qt,ae as Va,af as or,ag as zr,C as Fr,e as Ua,ah as Br}from"./appwrite.5W8SCupm.js";import{b as ye,g as Fe,a as Lr,D as qe}from"./date-helpers.B6zph3v7.js";import{B as Be}from"./BtnGroupCheck.CHrcq3x2.js";import{S as $a,I as ir}from"./InfoCollapse.CWSikkxb.js";import{at as ue,au as sa,av as Rr,D as ma,a4 as Te,aw as Aa,x as Qr,P as lr,ax as dr,b as Vr,a3 as he,ay as Ur,n as Le,X as ga,T as Wr,az as vr,V as cr,aA as Gr,a as ba,u as Ea,Z as ur,ah as Hr,aB as Jr,ap as Oa,aq as Na,m as ja,U as ua,t as ha,q as Xr,F as ia,S as Kr,aC as Ca,z as qa,w as Yr,aD as Wa,e as _r,aE as Zr,aF as fr,aG as ts,af as es,an as as,a2 as Ga,aH as rs,aI as Ha,aJ as ss,aK as ns,aL as pr,Q as Ja}from"./icons.DKN5kzXq.js";import{M as Ie,a as Me,b as $e,c as xa,n as Xa}from"./index.BUL8Pmq2.js";import{a as os,b as la,c as da,g as Da,d as is,f as Ma}from"./products-display.CZc2PMhO.js";import{F as va}from"./Fieldset.Dv39p1Lh.js";import{E as ls}from"./EventStats.DzEo2_oU.js";import{L as ds}from"./LeftPanel.CojHg0lY.js";import"./editor.L4rklAfR.js";import"./markdown.BkFahWn2.js";import"./CheckboxBadge.CBrhHJkp.js";import"./event-stats-helpers.D4lUGopr.js";var vs=o('<div><label class="input w-72"><!> <input/></label> <!></div>');function Ae(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"suggestions",19,()=>[]),v=Pt(e,"disabled",3,!1),y=Pt(e,"flexCol",3,!1),u=Za(e,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const V=L(()=>i().map(k=>({id:k,label:k,disabled:k===r()})));var U=vs(),R=a(U),F=a(R);ue(F,{class:"h-4 w-4 opacity-50"});var dt=s(F,2);Ya(dt,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:v(),...u}),void 0,void 0,void 0,!0);var E=s(R,2);{var m=k=>{$a(k,{get suggestions(){return t(V)},onSuggestionClick:C=>r(C.label),buttonSize:"btn-xs"})};l(E,k=>{i().length>0&&k(m)})}f(()=>St(U,1,`flex ${y()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),_e(dt,r),n(_,U),Lt()}var cs=o('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function na(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"suggestions",19,()=>[]),v=Pt(e,"disabled",3,!1),y=Pt(e,"flexCol",3,!1);const u=L(()=>i().map(m=>({id:m,label:m,disabled:m===r()})));var V=cs(),U=a(V),R=a(U);sa(R,{class:"h-4 w-4 opacity-50"});var F=s(R,2);F.__keydown=function(...m){e.onkeydown?.apply(this,m)};var dt=s(U,2);{var E=m=>{$a(m,{get suggestions(){return t(u)},onSuggestionClick:k=>r(k.label),buttonSize:"btn-xs"})};l(dt,m=>{i().length>0&&m(E)})}f(()=>{St(V,1,`flex ${y()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),F.disabled=v()}),_e(F,r),n(_,V),Lt()}Zt(["keydown"]);var us=o('<textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea>');function Ee(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"disabled",3,!1);var v=us();f(()=>{v.disabled=i(),pa(v,"id",e.id)}),_e(v,r),n(_,v),Lt()}var _s=o('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function za(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"disabled",3,!1);var v=_s(),y=a(v);Rr(y,{class:"h-4 w-4 opacity-50"});var u=s(y,2);f(()=>u.disabled=i()),_e(u,r),n(_,v),Lt()}var fs=o('<label class="input"><span class="label">Date de livraison prévue</span> <input type="date"/></label>'),ps=o(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function mr(_,e){Bt(e,!0);let r=Pt(e,"status",15),i=Pt(e,"deliveryDate",15),v=Pt(e,"disabled",3,!1);var y=ps(),u=a(y),V=a(u),U=a(V);U.value=U.__value="delivered";var R=s(U);R.value=R.__value="ordered";var F=s(V,2),dt=s(u,2);{var E=m=>{var k=fs(),C=s(a(k),2);f(()=>C.disabled=v()),_e(C,i),n(m,k)};l(dt,m=>{r()==="ordered"&&m(E)})}f(()=>{V.disabled=v(),St(F,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),tr(V,r),n(_,y),Lt()}var ms=o('<div class="alert alert-error"><!> <span> </span></div>'),gs=o(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),bs=o('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),hs=o('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),xs=o(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),ys=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),ws=o('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),ks=o('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),Ss=o("<!> <!> <!>",1);function Ps(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=Ht({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),y=ht(Ht(new Set));be(()=>{D(y,new Set(e.products.map(E=>E.$id)),!0)});const u=L(()=>e.products.filter(E=>t(y).has(E.$id))),V=L(()=>t(u).length!==0),U=L(()=>{const E=P.dateRange;let m="";return E?.start&&E?.end&&(E.start===E.end?m=` - ${ye(E.start)}`:m=` - Du ${ye(E.start)} au ${ye(E.end)}`),`Achat groupé (${t(u).length} produit${t(u).length>1?"s":""})${m}`});async function R(){if(!t(V)||t(r))return;D(r,!0),D(i,null);const E=`FACTURE_${Date.now()}`,m=t(u).map(S=>S.$id);P.setSyncStatus(m,!0),Yt.backgroundOperation={isRunning:!0,name:`Achat groupé (${t(u).length} produits)`,progress:0};const k=[];for(const S of t(u)){const Y=(P.getProductModelById(S.$id)?.stats.missingQuantities||[]).filter(g=>g.q<0).map(g=>({...g,q:Math.abs(g.q)}));k.push({productId:S.$id,isSynced:S.isSynced,missingQuantities:Y})}const C={invoiceId:E,invoiceTotal:v.expense||void 0,store:v.store.trim()||void 0,notes:v.notes||`Achat groupé pour ${t(u).length} produits`,who:v.who.trim()||void 0,purchaseStatus:v.status||"delivered",purchaseDeliveryDate:v.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${k.length} produits...`),e.onClose();try{await Ia.track(Mr(P.currentMainId,k,C).then(S=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${S.success?"succès":"échec"}, ${S.totalProductsCreated} produits synchronisés, ${S.totalPurchasesCreated} achats créés, ${S.totalExpensesCreated} dépenses globales`),!S.success)throw new Error(S.error||"Erreur lors de la création de l'achat groupé");return P.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),e.onSuccess?.(),S}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(S){console.error("[GroupPurchaseModal] Erreur création achat groupé:",S),P.clearSyncStatus()}finally{D(r,!1),Yt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function F(E){const m=new Set(t(y));m.has(E)?m.delete(E):m.add(E),D(y,m,!0)}const dt=L(()=>e.products.map(E=>{const m=P.getProductModelById(E.$id);return{id:E.$id,label:E.productName,title:`${E.productName} - Manque: ${m?.stats.formattedMissingQuantities||"-"}`,badge:m?.stats.formattedMissingQuantities||"-"}}));Ie(_,{isOpen:!0,get onClose(){return e.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(E,m)=>{var k=Ss(),C=ct(k);Me(C,{get title(){return t(U)},showBackButton:!0,get onClose(){return e.onClose}});var S=s(C,2);$e(S,{children:(Y,g)=>{var b=xs(),T=a(b);{var tt=h=>{var A=ms(),Q=a(A);ma(Q,{class:"h-4 w-4"});var N=s(Q,2),q=a(N);f(()=>c(q,t(i))),n(h,A)};l(T,h=>{t(i)&&h(tt)})}var pt=s(T,2),yt=a(pt);ir(yt,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:(h,A)=>{var Q=gs();n(h,Q)},$$slots:{default:!0}});var nt=s(pt,2),W=s(a(nt),2),x=a(W),$=a(x);Ae($,{get suggestions(){return P.uniqueStores},get disabled(){return t(r)},get value(){return v.store},set value(h){v.store=h}});var bt=s(x,2),B=a(bt);na(B,{get suggestions(){return P.uniqueWho},get disabled(){return t(r)},get value(){return v.who},set value(h){v.who=h}});var rt=s(W,2);za(rt,{get disabled(){return t(r)},get value(){return v.expense},set value(h){v.expense=h}});var j=s(rt,2);mr(j,{get disabled(){return t(r)},get status(){return v.status},set status(h){v.status=h},get deliveryDate(){return v.deliveryDate},set deliveryDate(h){v.deliveryDate=h}});var lt=s(j,2);Ee(lt,{get disabled(){return t(r)},get value(){return v.notes},set value(h){v.notes=h}});var at=s(nt,2);{var ft=h=>{var A=bs(),Q=s(a(A),2),N=s(a(Q)),q=a(N),et=s(N,2),z=a(et),I=s(Q,2);Be(I,{get items(){return t(dt)},onToggleItem:F,size:"sm",color:"success"}),f((O,d)=>{c(q,O),c(z,d)},[()=>ye(P.dateRange.start),()=>ye(P.dateRange.end)]),n(h,A)},X=h=>{var A=hs();n(h,A)};l(at,h=>{t(dt).length>0?h(ft):h(X,!1)})}n(Y,b)}});var st=s(S,2);xa(st,{children:(Y,g)=>{var b=ks(),T=a(b);T.__click=function(...W){e.onClose?.apply(this,W)};var tt=s(T,2);tt.__click=R;var pt=a(tt);{var yt=W=>{var x=ys();n(W,x)},nt=W=>{var x=ws(),$=ct(x);Te($,{class:"h-4 w-4"});var bt=s($,2),B=s(a(bt)),rt=a(B);f(()=>c(rt,`${t(u).length??""} produit${t(u).length>1?"s":""}`)),n(W,x)};l(pt,W=>{t(r)?W(yt):W(nt,!1)})}f(()=>{T.disabled=t(r),tt.disabled=t(r)||!t(V)}),n(Y,b)}}),n(E,k)},$$slots:{default:!0}}),Lt()}Zt(["click"]);const Ms=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var Cs=o("<option> </option>"),qs=o('<fieldset class="fieldset"><div class="flex gap-2"><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité" required/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end" required><option disabled selected>-</option><!></select></label></div></fieldset>');function ya(_,e){Bt(e,!0);let r=Pt(e,"quantity",15),i=Pt(e,"unit",15),v=Pt(e,"disabled",3,!1);var y=qs(),u=a(y),V=a(u),U=a(V);Aa(U,{class:"h-4 w-4 opacity-50"});var R=s(U,2),F=s(V,2),dt=s(a(F),2),E=a(dt);E.value=E.__value="";var m=s(E);Wt(m,17,()=>Ms,Pe,(k,C)=>{let S=()=>t(C).value,st=()=>t(C).label;var Y=Cs(),g=a(Y),b={};f(()=>{c(g,st()),b!==(b=S())&&(Y.value=(Y.__value=S())??"")}),n(k,Y)}),f(()=>{R.disabled=v(),dt.disabled=v()}),_e(R,r),tr(dt,i),n(_,y),Lt()}var Ds=o('<div class="alert alert-error text-sm"><!> <span> </span></div>'),Ts=(_,e)=>e(!0),Is=o('<span class="loading loading-spinner"></span>'),$s=o('<span class="loading loading-spinner"></span>'),As=o('<form class="flex h-full flex-col space-y-4"><!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),Es=o("<!> <!>",1);function Os(_,e){Bt(e,!0);let r=Pt(e,"open",15,!1),i=ht(!1),v=ht(null),y=ht(!1),u=ht(Ht({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const V=L(()=>t(u).productName.trim().length>0&&t(u).productType.trim().length>0),U=L(()=>P.uniqueProductTypes.map(dt=>({id:dt,label:dt})));async function R(dt=!1){if(!(!t(V)||t(i))){D(i,!0),D(v,null),D(y,!1);try{if(!P.currentMainId)throw new Error("Aucun événement principal sélectionné");const E={productName:t(u).productName.trim(),productType:t(u).productType.trim(),store:t(u).store.trim()?{storeName:t(u).store.trim()}:void 0,who:t(u).who.trim()?[t(u).who.trim()]:void 0,pF:t(u).pF,pS:t(u).pS,quantity:t(u).quantity?{q:t(u).quantity,u:t(u).unit.trim()||"pièces"}:void 0};await Cr(E,P.currentMainId),D(y,!0),dt?(t(u).productName="",t(u).quantity=null,t(u).unit="",t(u).pF=!1,t(u).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),D(u,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(E){console.error("Error creating product:",E),D(v,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{D(i,!1)}}}function F(){r(!1),D(u,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),D(v,null)}be(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),Ie(_,{get isOpen(){return r()},onClose:F,children:(dt,E)=>{var m=Es(),k=ct(m);Me(k,{title:"Ajouter un produit",onClose:F});var C=s(k,2);$e(C,{children:(S,st)=>{var Y=As(),g=a(Y);{var b=p=>{var ut=Ds(),gt=a(ut);ma(gt,{size:18});var vt=s(gt,2),mt=a(vt);f(()=>c(mt,t(v))),n(p,ut)};l(g,p=>{t(v)&&p(b)})}var T=s(g,2),tt=a(T),pt=a(tt),yt=a(pt),nt=a(yt);Qr(nt,{class:"text-base-content/50 h-5 w-5"});var W=s(nt,2),x=s(pt,2);ya(x,{get disabled(){return t(i)},get quantity(){return t(u).quantity},set quantity(p){t(u).quantity=p},get unit(){return t(u).unit},set unit(p){t(u).unit=p}});var $=s(tt,2),bt=a($),B=a(bt),rt=a(B),j=s(B,2);$a(j,{get suggestions(){return t(U)},onSuggestionClick:p=>t(u).productType=p.label,get disabled(){return t(i)}});var lt=s($,2);Ae(lt,{get suggestions(){return P.uniqueStores},get disabled(){return t(i)},get value(){return t(u).store},set value(p){t(u).store=p}});var at=s(lt,2);na(at,{get suggestions(){return P.uniqueWho},get disabled(){return t(i)},get value(){return t(u).who},set value(p){t(u).who=p}});var ft=s(at,2),X=a(ft),h=a(X),A=a(h),Q=s(X,2),N=a(Q),q=a(N),et=s(ft,2),z=a(et);z.__click=F;var I=s(z,2),O=a(I);O.__click=[Ts,R];var d=a(O);{var G=p=>{var ut=Is();n(p,ut)},Z=p=>{lr(p,{size:18})};l(d,p=>{t(i)?p(G):p(Z,!1)})}var w=s(O,2),H=a(w);{var M=p=>{var ut=$s();n(p,ut)};l(H,p=>{t(i)&&p(M)})}f(()=>{T.disabled=t(i),W.disabled=t(i),rt.disabled=t(i),A.disabled=t(i),q.disabled=t(i),z.disabled=t(i),O.disabled=t(i)||!t(u).productName,w.disabled=t(i)||!t(u).productName}),Tt("submit",Y,p=>{p.preventDefault(),R(!1)}),_e(W,()=>t(u).productName,p=>t(u).productName=p),_e(rt,()=>t(u).productType,p=>t(u).productType=p),La(A,()=>t(u).pF,p=>t(u).pF=p),La(q,()=>t(u).pS,p=>t(u).pS=p),n(S,Y)}}),n(dt,m)},$$slots:{default:!0}}),Lt()}Zt(["click"]);var Re,Qe,Ve,Ue,We,Ge,He,Je,Xe,Ke,Ye,Ze,ta,ea,aa,ra;class Ns{constructor(e,r="recettes"){Kt(this,Re,ht(!1));Kt(this,Qe,ht(null));Kt(this,Ve,ht("recettes"));Kt(this,Ue,L(()=>P.getProductModelById(this.productId)));Kt(this,We,L(()=>this.productModel?.data??null));Kt(this,Ge,L(()=>this.product?.who??[]));Kt(this,He,L(()=>this.product?.stockParsed??null));Kt(this,Je,L(()=>this.product?.purchases??[]));Kt(this,Xe,L(()=>this.product?.byDate?qr(this.product.byDate):[]));Kt(this,Ke,ht(Ht({purchase:{quantity:null,unit:"",store:"",who:Yt.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));Kt(this,Ye,ht(Ht({overrideManagerEditMode:!1})));Kt(this,Ze,ht(null));Kt(this,ta,L(()=>this.editingPurchaseId?this.purchasesList.find(e=>e.$id===this.editingPurchaseId)??null:null));Kt(this,ea,ht(null));Kt(this,aa,L(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));Kt(this,ra,L(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));Pa(this,"formatQuantity",(e,r)=>fa(e,r));Pa(this,"formatDate",os);this.productId=e,this.currentTab=r,this.initForms()}get loading(){return t(Dt(this,Re))}set loading(e){D(Dt(this,Re),e,!0)}get error(){return t(Dt(this,Qe))}set error(e){D(Dt(this,Qe),e,!0)}get currentTab(){return t(Dt(this,Ve))}set currentTab(e){D(Dt(this,Ve),e,!0)}get productModel(){return t(Dt(this,Ue))}set productModel(e){D(Dt(this,Ue),e)}get product(){return t(Dt(this,We))}set product(e){D(Dt(this,We),e)}get whoList(){return t(Dt(this,Ge))}set whoList(e){D(Dt(this,Ge),e)}get stockParsed(){return t(Dt(this,He))}set stockParsed(e){D(Dt(this,He),e)}get purchasesList(){return t(Dt(this,Je))}set purchasesList(e){D(Dt(this,Je),e)}get recipes(){return t(Dt(this,Xe))}set recipes(e){D(Dt(this,Xe),e)}get forms(){return t(Dt(this,Ke))}set forms(e){D(Dt(this,Ke),e,!0)}get uiStates(){return t(Dt(this,Ye))}set uiStates(e){D(Dt(this,Ye),e,!0)}get editingPurchaseId(){return t(Dt(this,Ze))}set editingPurchaseId(e){D(Dt(this,Ze),e,!0)}get editingPurchaseData(){return t(Dt(this,ta))}set editingPurchaseData(e){D(Dt(this,ta),e)}get originalFormsSnapshot(){return t(Dt(this,ea))}set originalFormsSnapshot(e){D(Dt(this,ea),e,!0)}initForms(){const e=P.getProductModelById(this.productId);if(!e||!e.data)return;const r=e.stats.missingQuantities[0];if(r){const{value:i,unit:v}=je(Math.abs(r.q),r.u);this.forms.purchase.quantity=i,this.forms.purchase.unit=v}else this.forms.purchase.quantity=null,this.forms.purchase.unit=e.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=e.data.storeInfo?.storeName??"",this.forms.purchase.who=Yt.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=e.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=e.data.storeInfo?.storeName??"",this.forms.store.comment=e.data.storeInfo?.storeComment??null,this.forms.who=e.data.who?[...e.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return t(Dt(this,aa))}set hasChanges(e){D(Dt(this,aa),e)}get hasAnyChanges(){return t(Dt(this,ra))}set hasAnyChanges(e){D(Dt(this,ra),e)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(e){this.currentTab=e}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");if(!P.currentMainId)throw new Error("mainId non disponible");const{value:e,unit:r}=je(this.forms.purchase.quantity,this.forms.purchase.unit);this.product.isSynced||await Se(this.product.$id,{},dt=>P.getEnrichedProductById(dt));const i=this.forms.purchase.status||"delivered";let v=this.forms.purchase.deliveryDate||null;i==="delivered"&&!v&&(v=new Date().toISOString());const y=ze.normalize(e,r),u=y.quantity,V=y.unit;await Dr({products:[this.product.$id],mainId:P.currentMainId,unit:V,quantity:u,store:this.forms.purchase.store||null,who:this.forms.purchase.who||null,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:i,orderDate:this.forms.purchase.orderDate||null,deliveryDate:v,invoiceId:null,invoiceTotal:null});const U=this.product.missingQuantityArray[0];let R=null,F=this.product.totalNeededArray[0]?.u??"";if(U){const{value:dt,unit:E}=je(Math.abs(U.q),U.u);R=dt,F=E}this.forms.purchase={quantity:R,unit:F,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(e){this.editingPurchaseId=e.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(e){e.$id&&await this.withLoading(async()=>{const r=ze.normalize(e.quantity,e.unit),i=e.status||null;let v=e.deliveryDate||null;i==="delivered"&&!v&&(v=new Date().toISOString()),await rr(e.$id,{unit:r.unit,quantity:r.quantity,store:e.store||null,who:e.who||null,notes:e.notes||"",price:e.price||null,status:i,orderDate:e.orderDate||null,deliveryDate:v}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(e){const r=this.purchasesList.find(i=>i.$id===e);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await Tr(e)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const e=ze.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:e.quantity.toString(),unit:e.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};this.product.isSynced?await Ra(this.product.$id,JSON.stringify(r)):await Se(this.product.$id,{stockReel:JSON.stringify(r)},i=>P.getEnrichedProductById(i)),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{this.product.isSynced?await Ra(this.product.$id,null):await Se(this.product.$id,{stockReel:null},e=>P.getEnrichedProductById(e))},"Stock supprimé")}async setWho(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await Ir(this.product.$id,e):await Se(this.product.$id,{who:e},r=>P.getEnrichedProductById(r))},"Volontaires mis à jour")}async updateStore(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await $r(this.product.$id,e):await Se(this.product.$id,{store:JSON.stringify(e)},r=>P.getEnrichedProductById(r))},"Magasin mis à jour")}async setOverride(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await Ar(this.product.$id,e,!0):await Se(this.product.$id,{totalNeededOverride:JSON.stringify(e)},r=>P.getEnrichedProductById(r))},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await Er(this.product.$id,!0)},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const e={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};e.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(e.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};e.storeInfo=r}Object.keys(e).length>0&&(await Or(this.product.$id,e,r=>P.getEnrichedProductById(r)),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(e,r){this.loading=!0,this.error=null;try{const i=await e();return r&&this.showToast("success",r),i}catch(i){const v=i instanceof Error?i.message:"Une erreur est survenue";return this.error=v,this.showToast("error",v),console.error("[ProductModalState]",i),null}finally{this.loading=!1}}showToast(e,r){const i=new CustomEvent("toast",{detail:{type:e,message:r}});window.dispatchEvent(i)}}Re=new WeakMap,Qe=new WeakMap,Ve=new WeakMap,Ue=new WeakMap,We=new WeakMap,Ge=new WeakMap,He=new WeakMap,Je=new WeakMap,Xe=new WeakMap,Ke=new WeakMap,Ye=new WeakMap,Ze=new WeakMap,ta=new WeakMap,ea=new WeakMap,aa=new WeakMap,ra=new WeakMap;var js=o('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),zs=o('<div class="text-base-content/60 mt-1 text-xs"> </div>'),Fs=o('<div class="font-medium"> </div> <!>',1),Bs=o('<pre class="text-xs"> </pre>'),Ls=o('<span class="text-base-content/50 italic">Non défini</span>'),Rs=o('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),Qs=o('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function wa(_,e){Bt(e,!0);let r=Pt(e,"title",3,"Événement terminé"),i=Pt(e,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),v=Pt(e,"showData",3,!0),y=Pt(e,"data",3,null),u=Pt(e,"dataLabel",3,"");var V=Qs(),U=a(V),R=a(U);dr(R,{class:"text-warning h-5 w-5"});var F=s(R,2);Vr(F,{class:"text-warning/70 h-4 w-4"});var dt=s(F,2),E=a(dt),m=s(U,2),k=a(m),C=s(m,2);{var S=st=>{var Y=Rs(),g=a(Y);{var b=nt=>{var W=js(),x=a(W);f(()=>c(x,`${u()??""} :`)),n(nt,W)};l(g,nt=>{u()&&nt(b)})}var T=s(g,2),tt=a(T);{var pt=nt=>{var W=ae();f(()=>c(W,y())),n(nt,W)},yt=nt=>{var W=Ot(),x=ct(W);{var $=B=>{var rt=ae();f(j=>c(rt,j),[()=>y().join(", ")]),n(B,rt)},bt=B=>{var rt=Ot(),j=ct(rt);{var lt=ft=>{var X=Ot(),h=ct(X);{var A=N=>{var q=Fs(),et=ct(q),z=a(et),I=s(et,2);{var O=d=>{var G=zs(),Z=a(G);f(()=>c(Z,y().storeComment)),n(d,G)};l(I,d=>{y().storeComment&&d(O)})}f(()=>c(z,y().storeName)),n(N,q)},Q=N=>{var q=Bs(),et=a(q);f(z=>c(et,z),[()=>JSON.stringify(y(),null,2)]),n(N,q)};l(h,N=>{y().storeName?N(A):N(Q,!1)})}n(ft,X)},at=ft=>{var X=Ls();n(ft,X)};l(j,ft=>{typeof y()=="object"&&y()!==null?ft(lt):ft(at,!1)},!0)}n(B,rt)};l(x,B=>{Array.isArray(y())&&y().length>0?B($):B(bt,!1)},!0)}n(nt,W)};l(tt,nt=>{typeof y()=="string"||typeof y()=="number"?nt(pt):nt(yt,!1)})}n(st,Y)};l(C,st=>{v()&&y()&&st(S)})}f(()=>{c(E,r()),c(k,i())}),n(_,V),Lt()}function Vs(_,e,r){if(e().isPurchaseFormValid)if(e().editingPurchaseId){const i=e().editingPurchaseData;if(!i||!r(i))return;const v=e().forms.purchase.quantity??0,y=e().forms.purchase.unit,u=ze.normalize(v,y);i.quantity=u.quantity,i.unit=u.unit,i.price=e().forms.purchase.price,i.store=e().forms.purchase.store,i.who=e().forms.purchase.who,i.notes=e().forms.purchase.notes,i.status=e().forms.purchase.status,i.orderDate=e().forms.purchase.orderDate,i.deliveryDate=e().forms.purchase.deliveryDate,e().updateEditedPurchase(i),e().cancelEditPurchase()}else e().forms.purchase.status==="ordered"&&!e().forms.purchase.orderDate&&(e().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),e().addPurchase()}var Us=o('<button class="btn btn-ghost btn-sm">Annuler</button>'),Ws=o('<span class="loading loading-spinner loading-sm"></span>'),Gs=o('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-6"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Hs=o('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),Js=o("<th>Actions</th>"),Xs=(_,e,r)=>e(t(r)),Ks=(_,e,r)=>e(t(r).$id),Ys=o('<span class="loading loading-spinner loading-sm"></span>'),Zs=o('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),tn=o('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),en=o('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),an=(_,e,r)=>e(t(r).$id),rn=o('<span class="loading loading-spinner loading-xs"></span>'),sn=o('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),nn=o('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),on=o('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),ln=o('<div class="mt-2 text-sm opacity-70"> </div>'),dn=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),vn=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),cn=(_,e,r)=>e(t(r)),un=o('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),_n=o('<div class="card bg-base-100 border-neutral/40 border shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex flex-col gap-1"><div class="flex items-center gap-2 text-sm opacity-70"><!> <span class="text-xs font-medium"> </span></div> <div class="font-mono text-xl font-bold"> </div></div> <div> </div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-xs"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),fn=o('<div class="mt-4 space-y-3"></div>'),pn=o('<div class="space-y-4"><!></div> <!>',1);function mn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1);function v(b){return b.quantity!==null&&b.quantity!==0&&b.unit?.trim()!==""}function y(b){if(i())return;const{value:T,unit:tt}=je(b.quantity,b.unit);r().forms.purchase.quantity=T,r().forms.purchase.unit=tt,r().forms.purchase.price=b.price,r().forms.purchase.store=b.store||"",r().forms.purchase.who=b.who||"",r().forms.purchase.notes=b.notes||"",r().forms.purchase.status=b.status||null,r().forms.purchase.orderDate=b.orderDate||null,r().forms.purchase.deliveryDate=b.deliveryDate||null,r().startEditPurchase(b),setTimeout(()=>{const pt=document.querySelector("#purchase-form-card");pt?.scrollIntoView({behavior:"smooth",block:"center"}),pt?.querySelector('input[type="number"]')?.focus()},100)}function u(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function V(b){r().removePurchase(b)}function U(b){y(b)}let R=L(()=>r().editingPurchaseId!==null),F=L(()=>t(R)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),dt=L(()=>t(R)?"Enregistrer les modifications":"Ajouter l'achat");var E=pn(),m=ct(E),k=a(m);{var C=b=>{wa(b,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},S=b=>{var T=Gs(),tt=a(T),pt=a(tt),yt=a(pt),nt=s(pt,2),W=a(nt),x=a(W);ya(x,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(q){r().forms.purchase.quantity=q},get unit(){return r().forms.purchase.unit},set unit(q){r().forms.purchase.unit=q}});var $=s(x,2);za($,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(q){r().forms.purchase.price=q}});var bt=s($,2);Ae(bt,{get suggestions(){return P.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(q){r().forms.purchase.store=q}});var B=s(bt,2);na(B,{get suggestions(){return P.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(q){r().forms.purchase.who=q}});var rt=s(W,2),j=a(rt);Ee(j,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(q){r().forms.purchase.notes=q}});var lt=s(rt,2);mr(lt,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(q){r().forms.purchase.status=q},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(q){r().forms.purchase.deliveryDate=q}});var at=s(nt,2),ft=a(at);{var X=q=>{var et=Us();et.__click=u,n(q,et)};l(ft,q=>{t(R)&&q(X)})}var h=s(ft,2);h.__click=[Vs,r,v];var A=a(h);{var Q=q=>{var et=Ws();n(q,et)},N=q=>{var et=ae();f(()=>c(et,t(dt))),n(q,et)};l(A,q=>{r().loading?q(Q):q(N,!1)})}f(()=>{St(T,1,`card bg-base-200 ${t(R)?"ring-accent ring-2 ring-offset-2":""}`),c(yt,t(F)),h.disabled=r().loading||!r().isPurchaseFormValid}),n(b,T)};l(k,b=>{i()?b(C):b(S,!1)})}var st=s(m,2);{var Y=b=>{var T=Hs(),tt=a(T);Te(tt,{class:"mx-auto mb-2 h-12 w-12"}),n(b,T)},g=b=>{var T=Ot(),tt=ct(T);{var pt=nt=>{var W=en(),x=a(W),$=a(x),bt=a($),B=s(a(bt),8);{var rt=lt=>{var at=Js();n(lt,at)};l(B,lt=>{i()||lt(rt)})}var j=s($);Wt(j,21,()=>r().purchasesList,lt=>lt.$id,(lt,at)=>{var ft=tn(),X=a(ft),h=a(X),A=s(X),Q=a(A),N=s(A),q=a(N),et=s(N),z=a(et),I=a(z),O=s(et),d=a(O),G=s(O),Z=a(G),w=s(G),H=a(w),M=s(w),p=a(M),ut=s(M);{var gt=vt=>{var mt=Zs(),J=a(mt),ot=a(J);ot.__click=[Xs,U,at];var _t=a(ot);he(_t,{class:"h-4 w-4"});var wt=s(ot,2);wt.__click=[Ks,V,at];var kt=a(wt);{var Mt=Ct=>{var Ft=Ys();n(Ct,Ft)},Ut=Ct=>{ga(Ct,{class:"h-4 w-4"})};l(kt,Ct=>{r().loading?Ct(Mt):Ct(Ut,!1)})}f(()=>wt.disabled=r().loading),n(vt,mt)};l(ut,vt=>{i()||vt(gt)})}f((vt,mt,J,ot,_t)=>{c(h,vt),c(Q,t(at).store||"-"),c(q,t(at).who||"-"),St(z,1,`badge badge-sm ${mt??""}`),c(I,J),c(d,ot),c(Z,_t),c(H,t(at).price?`${t(at).price}€`:"-"),c(p,t(at).notes||"-")},[()=>fa(t(at).quantity,t(at).unit),()=>la(t(at).status).class,()=>la(t(at).status).text,()=>da(t(at).orderDate),()=>da(t(at).deliveryDate)]),n(lt,ft)}),n(nt,W)},yt=nt=>{var W=fn();Wt(W,21,()=>r().purchasesList,x=>x.$id,(x,$)=>{var bt=_n(),B=a(bt),rt=a(B),j=a(rt),lt=a(j),at=a(lt);Ur(at,{class:"h-3.5 w-3.5"});var ft=s(at,2),X=a(ft),h=s(lt,2),A=a(h),Q=s(j,2),N=a(Q),q=s(Q,2);{var et=J=>{var ot=sn();ot.__click=[an,V,$];var _t=a(ot);{var wt=Mt=>{var Ut=rn();n(Mt,Ut)},kt=Mt=>{Wr(Mt,{size:16})};l(_t,Mt=>{r().loading?Mt(wt):Mt(kt,!1)})}f(()=>ot.disabled=r().loading),n(J,ot)};l(q,J=>{i()||J(et)})}var z=s(rt,2),I=a(z);{var O=J=>{var ot=nn(),_t=a(ot);Le(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(Mt=>c(kt,`Commande: ${Mt??""}`),[()=>da(t($).orderDate)]),n(J,ot)};l(I,J=>{t($).orderDate&&J(O)})}var d=s(I,2);{var G=J=>{var ot=on(),_t=a(ot);Le(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(Mt=>c(kt,`Livraison: ${Mt??""}`),[()=>da(t($).deliveryDate)]),n(J,ot)};l(d,J=>{t($).deliveryDate&&J(G)})}var Z=s(z,2);{var w=J=>{var ot=ln(),_t=a(ot);f(()=>c(_t,t($).notes)),n(J,ot)};l(Z,J=>{t($).notes&&J(w)})}var H=s(Z,2),M=a(H);{var p=J=>{var ot=dn(),_t=a(ot);ue(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(()=>c(kt,t($).store)),n(J,ot)};l(M,J=>{t($).store&&J(p)})}var ut=s(M,2);{var gt=J=>{var ot=vn(),_t=a(ot);sa(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(()=>c(kt,t($).who)),n(J,ot)};l(ut,J=>{t($).who&&J(gt)})}var vt=s(H,2);{var mt=J=>{var ot=un(),_t=a(ot);_t.__click=[cn,U,$];var wt=a(_t);he(wt,{size:16,class:"mr-1"}),n(J,ot)};l(vt,J=>{i()||J(mt)})}f((J,ot,_t)=>{c(X,J),c(A,t($).price?`${t($).price} €`:"-"),St(Q,1,`badge badge-sm ${ot??""}`),c(N,_t)},[()=>fa(t($).quantity,t($).unit),()=>la(t($).status).class,()=>la(t($).status).text]),n(x,bt)}),n(nt,W)};l(tt,nt=>{Yt.isMobile?nt(yt,!1):nt(pt)},!0)}n(b,T)};l(st,b=>{r().purchasesList.length===0?b(Y):b(g,!1)})}n(_,E),Lt()}Zt(["click"]);async function gn(_,e,r){await e()?.setStock(),D(r,!1)}async function bn(_,e){await e()?.removeStock()}function hn(_,e,r){if(!e().stockParsed)return;const{value:i,unit:v}=je(e().stockParsed.quantity,e().stockParsed.unit);e().forms.stock.quantity=i,e().forms.stock.unit=v,e().forms.stock.notes=e().stockParsed.notes??"",e().forms.stock.dateTime=e().stockParsed.dateTime,D(r,!0)}function xn(_,e,r){D(e,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var yn=o(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),wn=o('<button class="btn btn-ghost btn-sm">Annuler</button>'),kn=(_,e)=>{e().forms.stock.quantity=null,e().forms.stock.notes=""},Sn=o('<span class="loading loading-spinner loading-xs"></span>'),Pn=o('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Mn=o('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),Cn=o('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),qn=o('<span class="loading loading-spinner loading-xs"></span>'),Dn=o('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),Tn=o('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),In=o('<div class="space-y-4"><!></div> <!>',1);function $n(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1),v=ht(!1);var y=In(),u=ct(y),V=a(u);{var U=m=>{wa(m,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},R=m=>{var k=Ot(),C=ct(k);{var S=st=>{var Y=Pn(),g=a(Y),b=a(g),T=a(b),tt=s(b,2),pt=a(tt);ir(pt,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(X,h)=>{var A=yn();n(X,A)},$$slots:{default:!0}});var yt=s(tt,2),nt=a(yt);ya(nt,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(X){r().forms.stock.quantity=X},get unit(){return r().forms.stock.unit},set unit(X){r().forms.stock.unit=X}});var W=s(yt,2),x=a(W);Ee(x,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(X){r().forms.stock.notes=X}});var $=s(W,2),bt=a($);{var B=X=>{var h=wn();h.__click=[xn,v,r],f(()=>h.disabled=r().loading),n(X,h)};l(bt,X=>{t(v)&&X(B)})}var rt=s(bt,2);rt.__click=[kn,r];var j=s(rt,2);j.__click=[gn,r,v];var lt=a(j);{var at=X=>{var h=Sn();n(X,h)},ft=X=>{var h=ae();f(()=>c(h,t(v)?"Enregistrer les modifications":"Déclarer le stock")),n(X,h)};l(lt,X=>{r().loading?X(at):X(ft,!1)})}f(X=>{St(Y,1,`card bg-base-200 ${t(v)?"ring-accent ring-2 ring-offset-2":""}`),c(T,X),St(rt,1,`btn btn-ghost btn-sm ${t(v)?"hidden":""}`),rt.disabled=r().loading,j.disabled=r().loading||!r().forms.stock.quantity},[()=>t(v)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),n(st,Y)};l(C,st=>{(!r().stockParsed||t(v))&&st(S)})}n(m,k)};l(V,m=>{i()?m(U):m(R,!1)})}var F=s(u,2);{var dt=m=>{var k=Mn(),C=a(k);vr(C,{class:"mx-auto mb-2 h-12 w-12"}),n(m,k)},E=m=>{var k=Ot(),C=ct(k);{var S=st=>{var Y=Tn(),g=a(Y),b=a(g),T=s(a(b),2),tt=a(T),pt=s(T,2),yt=s(a(pt),2),nt=a(yt),W=s(pt,2);{var x=B=>{var rt=Cn(),j=s(a(rt),2),lt=a(j);f(()=>c(lt,r().stockParsed.notes)),n(B,rt)};l(W,B=>{r().stockParsed.notes&&B(x)})}var $=s(b,2);{var bt=B=>{var rt=Dn(),j=a(rt);j.__click=[bn,r];var lt=a(j);{var at=A=>{var Q=qn();n(A,Q)},ft=A=>{var Q=ae("Supprimer le stock");n(A,Q)};l(lt,A=>{r().loading?A(at):A(ft,!1)})}var X=s(j,2);X.__click=[hn,r,v];var h=a(X);he(h,{class:"mr-1 h-4 w-4"}),f(()=>{j.disabled=r().loading,X.disabled=r().loading}),n(B,rt)};l($,B=>{i()||B(bt)})}f(B=>{c(tt,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),c(nt,B)},[()=>Fe(r().stockParsed.dateTime)]),n(st,Y)};l(C,st=>{t(v)||st(S)})}n(m,k)};l(F,m=>{r().stockParsed?m(E,!1):m(dt)})}n(_,y),Lt()}Zt(["click"]);var An=(_,e)=>{_.key==="Enter"&&(_.preventDefault(),e())},En=o('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),On=o('<div class="space-y-4"><!></div>');function Nn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1),v=ht("");const y=L(()=>{const k=P.uniqueWho,C=new Set([...k,...r().forms.who]);return Array.from(C).map(S=>({id:S,label:S,selected:r().forms.who.includes(S)}))});function u(k){const C=k.trim();C&&!r().forms.who.includes(C)&&(r().forms.who=[...r().forms.who,C])}function V(k){r().forms.who=r().forms.who.filter(C=>C!==k)}function U(k){r().forms.who.includes(k)?V(k):u(k)}function R(){t(v).trim()&&(u(t(v)),D(v,""))}var F=On(),dt=a(F);{var E=k=>{wa(k,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},m=k=>{var C=En(),S=a(C),st=s(a(S),4),Y=a(st),g=a(Y),b=a(g);sa(b,{class:"h-4 w-4 opacity-50"});var T=s(b,2);T.__keydown=[An,R];var tt=s(g,2);tt.__click=R;var pt=a(tt);cr(pt,{size:16});var yt=s(Y,2),nt=s(a(yt),2);Be(nt,{get items(){return t(y)},onToggleItem:U,size:"sm",color:"info"}),f(W=>{T.disabled=r().loading,tt.disabled=W},[()=>r().loading||!t(v).trim()]),_e(T,()=>t(v),W=>D(v,W)),n(k,C)};l(dt,k=>{i()?k(E):k(m,!1)})}n(_,F),Lt()}Zt(["keydown","click"]);var jn=(_,e)=>{e().forms.store.name="",e().forms.store.comment=""},zn=o(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),Fn=o('<div class="space-y-4"><!></div>');function Bn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1);const v=L(()=>r()?.hasChanges?.store||!1);async function y(){if(!t(v))return;const F={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(F)}var u=Fn(),V=a(u);{var U=F=>{{let dt=L(()=>r().product?.storeInfo);wa(F,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return t(dt)},dataLabel:"Magasin actuel"})}},R=F=>{var dt=zn(),E=a(dt),m=s(a(E),4),k=a(m),C=a(k);Ae(C,{get suggestions(){return P.uniqueStores},get disabled(){return r().loading},onkeydown:g=>{g.key==="Enter"&&y()},get value(){return r().forms.store.name},set value(g){r().forms.store.name=g}});var S=s(k,2);Ee(S,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(g){r().forms.store.comment=g}});var st=s(m,2),Y=a(st);Y.__click=[jn,r],f(()=>Y.disabled=r().loading),n(F,dt)};l(V,F=>{i()?F(U):F(R,!1)})}n(_,u),Lt()}Zt(["click"]);var Ln=o('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function Rn(_,e){Bt(e,!0);let r=Pt(e,"value",15);Pt(e,"disabled",3,!1);var i=Ln(),v=a(i);Gr(v,{size:20,class:"text-base-centent/70"});var y=s(v,2);_e(y,r),n(_,i),Lt()}async function Qn(_,e,r,i,v){if(!e())return;const{q:y,u}=sr(t(r),t(i)),V=e().product?.totalNeededOverrideParsed?.totalOverride,U=e().product?.totalNeededOverrideParsed?.comment||"";if(y!==V?.q||u!==V?.u||t(v)!==U){const F={totalOverride:{q:y,u},comment:t(v),totalComputedWhenOverride:e().product.totalNeededArray,platesNbWhenOverride:e().product.totalAssiettes,recipesNbWhenOverride:e().product.nbRecipes};await e().setOverride(F)}e().uiStates.overrideManagerEditMode=!1}async function Vn(_,e){e()&&(await e().removeOverride(),e().uiStates.overrideManagerEditMode=!1)}var Un=o(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),Wn=o('<span class="loading loading-spinner loading-sm"></span>'),Gn=o('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),Hn=(_,e)=>e().uiStates.overrideManagerEditMode=!0,Jn=o('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),Xn=o('<div class="chat-bubble relative text-sm"> <!></div>'),Kn=o('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),Yn=(_,e)=>e().uiStates.overrideManagerEditMode=!0,Zn=o('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),to=o('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/60 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/60 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function eo(_,e){Bt(e,!0);let r=Pt(e,"modalState",7);const i=L(()=>r().product?.totalNeededOverrideParsed),v=L(()=>r().product?.displayTotalOverride),y=L(()=>r().product?nr(r().product):null);let u=L(()=>r().uiStates.overrideManagerEditMode),V=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),U=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function R(){if(!t(V)||!t(U))return{quantity:0,unit:""};const{q:st,u:Y}=sr(t(V),t(U));return{quantity:Nr(st,Y),unit:Y}}let F=ht(Ht(R().quantity)),dt=ht(Ht(R().unit)),E=ht(Ht(r().product?.totalNeededOverrideParsed?.comment||""));be(()=>{if(t(u)){const st=R();D(F,st.quantity,!0),D(dt,st.unit,!0),D(E,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let m=L(()=>t(F)>0&&t(dt).trim()!=="");var k=Ot(),C=ct(k);{var S=st=>{var Y=to(),g=a(Y);{var b=at=>{var ft=Un(),X=a(ft);ur(X,{size:18});var h=s(X,2),A=s(a(h),2),Q=a(A),N=a(Q),q=s(a(N)),et=a(q),z=s(q,2),I=a(z),O=s(Q,2),d=a(O),G=s(a(d)),Z=a(G),w=s(G,2),H=a(w),M=s(O,2),p=a(M),ut=a(p);f((gt,vt)=>{c(et,`${t(y).details.oldPlates??""} couverts,
                  ${t(y).details.oldRecipes??""} recettes`),c(I,gt),c(Z,`${t(y).details.newPlates??""} couverts,
                  ${t(y).details.newRecipes??""} recettes`),c(H,vt),c(ut,`Votre override : ${t(v)??""}`)},[()=>Qa(t(y).details.oldComputed),()=>Qa(t(y).details.newComputed)]),n(at,ft)};l(g,at=>{t(y)?.hasMismatch&&t(y)?.details&&at(b)})}var T=s(g,2),tt=s(a(T),2),pt=a(tt),yt=a(pt),nt=s(yt);ba(nt,{class:"h-3 w-3"});var W=s(pt,2),x=a(W),$=s(x);Ea($,{class:"h-3 w-3"});var bt=s(W,2),B=a(bt),rt=s(T,2);{var j=at=>{var ft=Gn(),X=s(a(ft),2);ya(X,{get quantity(){return t(F)},set quantity(I){D(F,I,!0)},get unit(){return t(dt)},set unit(I){D(dt,I,!0)}});var h=s(X,2);Rn(h,{get value(){return t(E)},set value(I){D(E,I,!0)}});var A=s(h,2),Q=a(A);Q.__click=[Vn,r];var N=s(Q,2);N.__click=[Qn,r,F,dt,E];var q=a(N);{var et=I=>{var O=Wn();n(I,O)},z=I=>{var O=ae("✓");n(I,O)};l(q,I=>{r().loading?I(et):I(z,!1)})}f(()=>N.disabled=r().loading||!t(m)),Ta(1,ft,()=>er),n(at,ft)},lt=at=>{var ft=Ot(),X=ct(ft);{var h=Q=>{var N=Kn(),q=a(N),et=s(a(q),2);{var z=w=>{var H=Jn();H.__click=[Hn,r];var M=a(H);Hr(M,{size:16}),n(w,H)};l(et,w=>{e.isArchiveMode||w(z)})}var I=s(et,2);{var O=w=>{var H=Xn(),M=a(H),p=s(M);Jr(p,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),f(()=>c(M,`${t(i).comment??""} `)),n(w,H)};l(I,w=>{t(i).comment&&w(O)})}var d=s(q,2),G=a(d),Z=a(G);f(()=>c(Z,t(v))),n(Q,N)},A=Q=>{var N=Ot(),q=ct(N);{var et=z=>{var I=Zn(),O=a(I);O.__click=[Yn,r];var d=s(a(O));he(d,{size:16}),n(z,I)};l(q,z=>{e.isArchiveMode||z(et)},!0)}n(Q,N)};l(X,Q=>{t(v)&&t(i)?Q(h):Q(A,!1)})}n(at,ft)};l(rt,at=>{t(u)?at(j):at(lt,!1)})}f(()=>{c(yt,`${r().product.nbRecipes??""} `),c(x,`${r().product.totalAssiettes??""} `),c(B,r().product.displayTotalNeeded)}),n(st,Y)};l(C,st=>{r().product&&st(S)})}n(_,k),Lt()}Zt(["click"]);var ao=o('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),ro=o('<span class="text-base-content/70"> </span>'),so=o('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),no=o('<div class="mt-4 space-y-3"></div>'),oo=o('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function io(_,e){Bt(e,!0);const r=L(()=>e.modalState.recipes);function i(E,m){return!E||!m?"-":fa(E,m)}var v=oo(),y=ct(v);eo(y,{get modalState(){return e.modalState},get isArchiveMode(){return e.isArchiveMode}});var u=s(y,2),V=s(a(u),2),U=a(V);ba(U,{class:"h-5 w-5"});var R=s(V,2);{var F=E=>{var m=ao(),k=a(m);Aa(k,{class:"mx-auto mb-2 h-12 w-12"}),n(E,m)},dt=E=>{var m=no();Wt(m,21,()=>t(r),Pe,(k,C)=>{const S=L(()=>i(t(C).q,t(C).u)),st=L(()=>i(t(C).qEq,t(C).uEq));var Y=so(),g=a(Y),b=a(g),T=a(b),tt=a(T),pt=a(tt),yt=s(tt,2),nt=a(yt),W=s(nt);{var x=h=>{Oa(h,{class:"h-4 w-4 text-amber-500"})},$=h=>{var A=Ot(),Q=ct(A);{var N=et=>{Na(et,{class:"h-4 w-4 text-indigo-500"})},q=et=>{var z=Ot(),I=ct(z);{var O=d=>{ja(d,{class:"h-4 w-4 text-sky-500"})};l(I,d=>{De(t(C).dateTimeService)==="cloud"&&d(O)},!0)}n(et,z)};l(Q,et=>{De(t(C).dateTimeService)==="moon"?et(N):et(q,!1)},!0)}n(h,A)};l(W,h=>{De(t(C).dateTimeService)==="sun"?h(x):h($,!1)})}var bt=s(T,2),B=a(bt),rt=a(B);Ea(rt,{class:"h-3 w-3"});var j=s(rt),lt=s(B,2),at=a(lt),ft=s(lt,2);{var X=h=>{var A=ro(),Q=a(A);f(N=>c(Q,`(${N??""})`),[()=>i(t(C).q,t(C).u)]),n(h,A)};l(ft,h=>{t(S)!==t(st)&&h(X)})}f((h,A,Q)=>{c(pt,t(C).r),c(nt,`${h??""} - ${A??""} `),c(j,` ${(t(C).a||0)??""} c.`),c(at,Q)},[()=>ye(t(C).date),()=>Lr(t(C).date),()=>i(t(C).qEq,t(C).uEq)]),n(k,Y)}),n(E,m)};l(R,E=>{t(r).length===0?E(F):E(dt,!1)})}n(_,v),Lt()}function lo(_,e,r){t(e)?.saveAllChanges().then(()=>{t(e)?.resetForms(),r.onClose()})}var vo=o('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),co=(_,e)=>e("recettes"),uo=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),_o=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),fo=(_,e)=>e("magasins"),po=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),mo=(_,e)=>e("volontaires"),go=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),bo=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),ho=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),xo=(_,e)=>e("stock"),yo=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),wo=o('<span class="badge badge-sm badge-secondary ml-1">1</span>'),ko=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),So=(_,e)=>e("achats"),Po=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Mo=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Co=o('<div class="alert alert-error mb-4"><!> <span> </span></div>'),qo=o("<!> <div><!></div>",1),Do=o('<span class="loading loading-spinner loading-sm"></span>'),To=o("<!> Tout enregistrer",1),Io=o('<button class="btn btn-primary"><!></button>'),$o=o('<button class="btn btn-ghost"> </button> <!>',1),Ao=o('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Eo(_,e){Bt(e,!0);let r=Pt(e,"initialTab",3,"recettes"),i=ht(null);be(()=>{D(i,new Ns(e.productId,r()),!0)});let v=L(()=>P.isEventPassed),y=L(()=>t(i)===null||t(i).product===null);function u(R){t(i)?.setCurrentTab(R)}function V(){t(i)?.resetForms(),e.onClose()}let U=L(()=>t(i)?.hasAnyChanges??!1);{let R=L(()=>!!e.productId);Ie(_,{get isOpen(){return t(R)},onClose:V,get hasUnsavedChanges(){return t(U)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(F,dt)=>{var E=Ot(),m=ct(E);{var k=S=>{Me(S,{title:"Chargement...",showBackButton:!0,onClose:V})},C=S=>{var st=Ao(),Y=ct(st);{var g=w=>{var H=vo(),M=a(H);dr(M,{class:"h-4 w-4"}),n(w,H)};l(Y,w=>{t(v)&&w(g)})}var b=s(Y,2);{let w=L(()=>t(i)?.product?.productName||"Produit");Me(b,{get title(){return t(w)},showBackButton:!0,onClose:V})}var T=s(b,2),tt=a(T),pt=a(tt);pt.__click=[co,u];var yt=a(pt);ba(yt,{class:"mr-1 h-4 w-4"});var nt=s(yt,4);{var W=w=>{var H=uo(),M=a(H);f(()=>c(M,t(i).product.nbRecipes)),n(w,H)},x=w=>{var H=_o();n(w,H)};l(nt,w=>{t(i)?.product?.nbRecipes&&t(i).product.nbRecipes>0?w(W):w(x,!1)})}var $=s(pt,2);$.__click=[fo,u];var bt=a($);ue(bt,{class:"mr-1 h-4 w-4"});var B=s(bt,4);{var rt=w=>{var H=po();n(w,H)};l(B,w=>{t(i)?.hasChanges?.store&&w(rt)})}var j=s($,2);j.__click=[mo,u];var lt=a(j);ua(lt,{class:"mr-1 h-4 w-4"});var at=s(lt,4);{var ft=w=>{var H=go();n(w,H)},X=w=>{var H=Ot(),M=ct(H);{var p=gt=>{var vt=bo(),mt=a(vt);f(()=>c(mt,t(i).product.who.length)),n(gt,vt)},ut=gt=>{var vt=ho();n(gt,vt)};l(M,gt=>{t(i)?.product?.who&&t(i).product.who.length>0?gt(p):gt(ut,!1)},!0)}n(w,H)};l(at,w=>{t(i)?.hasChanges?.who?w(ft):w(X,!1)})}var h=s(j,2);h.__click=[xo,u];var A=a(h);vr(A,{class:"mr-1 h-4 w-4"});var Q=s(A,4);{var N=w=>{var H=yo();n(w,H)},q=w=>{var H=Ot(),M=ct(H);{var p=gt=>{var vt=wo();n(gt,vt)},ut=gt=>{var vt=ko();n(gt,vt)};l(M,gt=>{t(i)?.stockParsed?gt(p):gt(ut,!1)},!0)}n(w,H)};l(Q,w=>{t(i)?.hasChanges?.stock?w(N):w(q,!1)})}var et=s(h,2);et.__click=[So,u];var z=a(et);Te(z,{class:"mr-1 h-4 w-4"});var I=s(z,4);{var O=w=>{var H=Po(),M=a(H);f(()=>c(M,t(i).purchasesList.length)),n(w,H)},d=w=>{var H=Mo();n(w,H)};l(I,w=>{t(i)?.purchasesList&&t(i).purchasesList.length>0?w(O):w(d,!1)})}var G=s(T,2);$e(G,{children:(w,H)=>{var M=qo(),p=ct(M);{var ut=mt=>{var J=Co(),ot=a(J);ga(ot,{class:"h-4 w-4"});var _t=s(ot,2),wt=a(_t);f(()=>c(wt,`Erreur : ${t(i).error??""}`)),n(mt,J)};l(p,mt=>{t(i)?.error&&mt(ut)})}var gt=s(p,2),vt=a(gt);yr(vt,()=>t(i)?.currentTab,mt=>{var J=Ot(),ot=ct(J);{var _t=kt=>{io(kt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},wt=kt=>{var Mt=Ot(),Ut=ct(Mt);{var Ct=Nt=>{mn(Nt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},Ft=Nt=>{var oe=Ot(),re=ct(oe);{var le=te=>{$n(te,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},ie=te=>{var de=Ot(),fe=ct(de);{var jt=It=>{Nn(It,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},Et=It=>{var Gt=Ot(),Jt=ct(Gt);{var se=Xt=>{Bn(Xt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})};l(Jt,Xt=>{t(i)?.currentTab==="magasins"&&Xt(se)},!0)}n(It,Gt)};l(fe,It=>{t(i)?.currentTab==="volontaires"?It(jt):It(Et,!1)},!0)}n(te,de)};l(re,te=>{t(i)?.currentTab==="stock"?te(le):te(ie,!1)},!0)}n(Nt,oe)};l(Ut,Nt=>{t(i)?.currentTab==="achats"?Nt(Ct):Nt(Ft,!1)},!0)}n(kt,Mt)};l(ot,kt=>{t(i)?.currentTab==="recettes"?kt(_t):kt(wt,!1)})}n(mt,J)}),n(w,M)}});var Z=s(G,2);xa(Z,{children:(w,H)=>{var M=$o(),p=ct(M);p.__click=V;var ut=a(p),gt=s(p,2);{var vt=mt=>{var J=Io();J.__click=[lo,i,e];var ot=a(J);{var _t=kt=>{var Mt=Do();n(kt,Mt)},wt=kt=>{var Mt=To(),Ut=ct(Mt);ha(Ut,{class:"h-4 w-4"}),n(kt,Mt)};l(ot,kt=>{t(i).loading?kt(_t):kt(wt,!1)})}f(()=>J.disabled=t(i).loading),n(mt,J)};l(gt,mt=>{t(i)?.hasAnyChanges&&mt(vt)})}f(()=>c(ut,t(i)?.hasAnyChanges?"Annuler":"Fermer")),n(w,M)}}),f(()=>{St(pt,1,`tab ${t(i)?.currentTab==="recettes"?"tab-active":""}`),St($,1,`tab ${t(i)?.currentTab==="magasins"?"tab-active":""}`),St(j,1,`tab ${t(i)?.currentTab==="volontaires"?"tab-active":""}`),St(h,1,`tab ${t(i)?.currentTab==="stock"?"tab-active":""}`),St(et,1,`tab ${t(i)?.currentTab==="achats"?"tab-active":""}`)}),n(S,st)};l(m,S=>{t(y)?S(k):S(C,!1)})}n(F,E)},$$slots:{default:!0}})}Lt()}Zt(["click"]);var Oo=(_,e,r)=>e(r),No=o("<button><span> </span> <!></button>"),jo=o('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),zo=(_,e)=>e.dateStore.selectUpcoming(),Fo=(_,e)=>e.dateStore.selectAll(),Bo=o('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),Lo=o('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function Ro(_,e){Bt(e,!0);let r=L(()=>e.dateStore.start),i=L(()=>e.dateStore.end),v=ht(null);function y(m){t(r)&&new Date(m)<new Date(t(r))?e.dateStore.setRange(m,t(i)):t(i)&&new Date(m)>new Date(t(i))?e.dateStore.setRange(t(r),m):e.dateStore.setRange(m,m)}function u(m){return!t(r)||!t(i)?{start:null,end:null}:t(r)&&new Date(m)<new Date(t(r))?{start:m,end:t(i)}:t(i)&&new Date(m)>new Date(t(i))?{start:t(r),end:m}:{start:m,end:m}}function V(m){let k="";if(!t(r)||!t(i))return;const C=new Date(m)>=new Date(t(r))&&new Date(m)<=new Date(t(i)),S=new Date(m);S.setHours(S.getHours()+jr);const st=S<new Date;let Y=!1;if(t(v)){const g=u(t(v));g.start&&g.end&&(Y=new Date(m)>=new Date(g.start)&&new Date(m)<=new Date(g.end))}return st&&(k+=" opacity-70 italic"),C||(k+=" btn-dash"),Y&&!C&&(k+=" btn-soft"),k}var U=Lo(),R=ct(U);Wt(R,20,()=>e.dateStore.dates,m=>m,(m,k)=>{var C=No();C.__click=[Oo,y,k];var S=a(C),st=a(S),Y=s(S,2);{var g=T=>{Oa(T,{size:16})},b=T=>{var tt=Ot(),pt=ct(tt);{var yt=W=>{Na(W,{size:16})},nt=W=>{var x=Ot(),$=ct(x);{var bt=B=>{ja(B,{size:16})};l($,B=>{De(k)==="cloud"&&B(bt)},!0)}n(W,x)};l(pt,W=>{De(k)==="moon"?W(yt):W(nt,!1)},!0)}n(T,tt)};l(Y,T=>{De(k)==="sun"?T(g):T(b,!1)})}f((T,tt)=>{St(C,1,`btn btn-sm btn-secondary ${T??""}`),c(st,tt)},[()=>V(k),()=>Fe(k)]),Tt("mouseenter",C,()=>D(v,k,!0)),Tt("mouseleave",C,()=>D(v,null)),n(m,C)});var F=s(R,2);{var dt=m=>{var k=jo();n(m,k)},E=m=>{var k=Bo(),C=a(k);C.__click=[zo,e];var S=s(C,2);S.__click=[Fo,e],f(()=>{St(C,1,`join-item btn btn-sm ${e.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),St(S,1,`join-item btn btn-sm ${e.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),n(m,k)};l(F,m=>{e.dateStore.isEventPassed?m(dt):m(E,!1)})}n(_,U),Lt()}Zt(["click"]);var Qo=()=>P.clearFilters(),Vo=_=>P.setSearchQuery(_.currentTarget.value),Uo=()=>P.setSearchQuery(""),Wo=()=>P.setCompletionStatus("all"),Go=()=>P.setCompletionStatus("incomplete"),Ho=()=>P.setCompletionStatus("completed"),Jo=()=>P.setGroupBy("none"),Xo=()=>P.setGroupBy("store"),Ko=()=>P.setGroupBy("productType"),Yo=o(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),Zo=o("<!> <!>",1),ti=(_,e)=>P.toggleProductType(e),ei=o("<button><!> </button>"),ai=()=>P.setTemperatureFilter("all"),ri=()=>P.setTemperatureFilter("frais"),si=()=>P.setTemperatureFilter("not-frais"),ni=()=>P.setTemperatureFilter("surgele"),oi=()=>P.setTemperatureFilter("not-surgele"),ii=()=>P.clearTypeAndTemperatureFilters(),li=o('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),di=o('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),vi=o('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),ci=(_,e)=>P.toggleStore(e),ui=o("<button> </button>"),_i=()=>P.clearStoreFilters(),fi=o('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),pi=o('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),mi=(_,e)=>P.toggleWho(e),gi=o("<button> </button>"),bi=()=>P.clearWhoFilters(),hi=o('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),xi=o('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),yi=o('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <div class="flex flex-col"><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!> <!></div>',1);function wi(_,e){Bt(e,!0);const r=L(()=>P.filters),i=L(()=>P.uniqueStores),v=L(()=>P.uniqueWho),y=L(()=>P.uniqueProductTypes);var u=yi(),V=ct(u),U=a(V),R=a(U);Xr(R,{class:"h-5 w-5"});var F=s(U,2);F.__click=[Qo];var dt=a(F);ia(dt,{class:"h-4 w-4"});var E=s(V,2),m=a(E),k=s(a(m),2),C=a(k);Kr(C,{class:"h-4 w-4"});var S=s(C,2);S.__input=[Vo];var st=s(S,2);st.__click=[Uo];var Y=a(st);ga(Y,{class:"h-4 w-4"});var g=s(m,2),b=s(a(g),2),T=a(b);T.__click=[Wo];var tt=s(T,2);tt.__click=[Go];var pt=s(tt,2);pt.__click=[Ho];var yt=s(g,2),nt=s(a(yt),2),W=a(nt);W.__click=[Jo];var x=s(W,2);x.__click=[Xo];var $=s(x,2);$.__click=[Ko];var bt=s(yt,2);{var B=h=>{va(h,{legend:"Date incluses",bgClass:"bg-base-100",children:(A,Q)=>{var N=Zo(),q=ct(N);Ro(q,{get dateStore(){return P.dateStore}});var et=s(q,2);{var z=I=>{var O=Yo();Ta(3,O,()=>er),n(I,O)};l(et,I=>{P.hasPastDatesInRange&&I(z)})}n(A,N)},$$slots:{default:!0}})};l(bt,h=>{P.hasSingleDateEvent||h(B)})}var rt=s(bt,2);{var j=h=>{va(h,{legend:"Types & Température",get iconComponent(){return Yr},children:(A,Q)=>{var N=vi(),q=ct(N);Wt(q,20,()=>t(y),vt=>vt,(vt,mt)=>{const J=L(()=>Da(mt));var ot=ei();ot.__click=[ti,mt];var _t=a(ot);ca(_t,()=>t(J).icon,(kt,Mt)=>{Mt(kt,{class:"mr-1 h-5 w-5"})});var wt=s(_t);f(kt=>{St(ot,1,`btn btn-sm ${kt??""}`),c(wt,` ${t(J).displayName??""}`)},[()=>t(r).selectedProductTypes.length===0?"btn-soft btn-secondary":t(r).selectedProductTypes.includes(mt)?"btn-secondary":"btn-dash btn-secondary"]),n(vt,ot)});var et=s(q,2),z=a(et);z.__click=[ai];var I=s(z,2);I.__click=[ri];var O=a(I);Ca(O,{class:"h-4 w-4"});var d=s(I,2);d.__click=[si];var G=a(d);Ca(G,{class:"h-4 w-4"});var Z=s(d,2);Z.__click=[ni];var w=a(Z);qa(w,{class:"h-4 w-4"});var H=s(Z,2);H.__click=[oi];var M=a(H);qa(M,{class:"h-4 w-4"});var p=s(et,2);{var ut=vt=>{var mt=li();mt.__click=[ii];var J=a(mt);ia(J,{size:16}),n(vt,mt)},gt=vt=>{var mt=di();n(vt,mt)};l(p,vt=>{t(r).selectedProductTypes.length>0||t(r).selectedTemperatures.length>0||t(r).temperatureFilter!=="all"?vt(ut):vt(gt,!1)})}f(()=>{St(z,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),St(I,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),St(d,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),St(Z,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),St(H,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),Tt("mouseenter",z,()=>qt.msg="Ne pas filter en fonction des températures"),Tt("mouseleave",z,()=>qt.reset()),Tt("mouseenter",I,()=>qt.msg="Afficher les produits frais uniquement"),Tt("mouseleave",I,()=>qt.reset()),Tt("mouseenter",d,()=>qt.msg="Exclure les produits frais"),Tt("mouseleave",d,()=>qt.reset()),Tt("mouseenter",Z,()=>qt.msg="Afficher les produits surgelés uniquement"),Tt("mouseleave",Z,()=>qt.reset()),Tt("mouseenter",H,()=>qt.msg="Exclure les produits surgelé"),Tt("mouseleave",H,()=>qt.reset()),n(A,N)},$$slots:{default:!0}})};l(rt,h=>{t(y).length>0&&h(j)})}var lt=s(rt,2);{var at=h=>{va(h,{legend:"Magasins",get iconComponent(){return ue},children:(A,Q)=>{var N=pi(),q=a(N);Wt(q,16,()=>t(i),I=>I,(I,O)=>{var d=ui();d.__click=[ci,O];var G=a(d);f(Z=>{St(d,1,`btn btn-sm ${Z??""}`),c(G,O)},[()=>t(r).selectedStores.length===0?"btn-soft btn-secondary":t(r).selectedStores.includes(O)?"btn-secondary":"btn-dash btn-secondary"]),n(I,d)});var et=s(q,2);{var z=I=>{var O=fi();O.__click=[_i];var d=a(O);ia(d,{size:16}),n(I,O)};l(et,I=>{t(r).selectedStores.length>0&&I(z)})}n(A,N)},$$slots:{default:!0}})};l(lt,h=>{t(i).length>0&&h(at)})}var ft=s(lt,2);{var X=h=>{va(h,{legend:"Qui",get iconComponent(){return sa},children:(A,Q)=>{var N=xi(),q=a(N);Wt(q,16,()=>t(v),I=>I,(I,O)=>{var d=gi();d.__click=[mi,O];var G=a(d);f(Z=>{St(d,1,`btn btn-sm ${Z??""}`),c(G,O)},[()=>t(r).selectedWho.length===0?" btn-soft btn-secondary":t(r).selectedWho.includes(O)?" btn-secondary":"btn-dash btn-secondary"]),n(I,d)});var et=s(q,2);{var z=I=>{var O=hi();O.__click=[bi];var d=a(O);ia(d,{size:16}),n(I,O)};l(et,I=>{t(r).selectedWho.length>0&&I(z)})}n(A,N)},$$slots:{default:!0}})};l(ft,h=>{t(v).length>0&&h(X)})}f(()=>{F.disabled=!P.hasFilters,wr(S,t(r).searchQuery),st.disabled=!t(r).searchQuery,St(T,1,`btn flex-1 ${t(r).completionStatus==="all"&&"btn-primary"}`),St(tt,1,`btn flex-1 ${t(r).completionStatus==="incomplete"&&"btn-warning"}`),St(pt,1,`btn flex-1 ${t(r).completionStatus==="completed"&&"btn-success"}`),St(W,1,`btn flex-1 ${t(r).groupBy==="none"&&"btn-secondary"}`),St(x,1,`btn flex-1 ${t(r).groupBy==="store"&&"btn-secondary"}`),St($,1,`btn flex-1 ${t(r).groupBy==="productType"&&"btn-secondary"}`)}),n(_,u),Lt()}Zt(["click","input"]);var ki=o('<div class="tooltip text-xs font-normal"><!></div>');function Si(_,e){let r=Pt(e,"iconSize",3,24),i=e.icon||void 0;var v=ki(),y=a(v);{var u=V=>{i(V,{get size(){return r()},class:`align-top
`})};l(y,V=>{e.icon&&V(u)})}f(()=>pa(v,"data-tip",e.tip)),n(_,v)}var Pi=o('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function Ka(_,e){Bt(e,!0);let r=Pt(e,"recipes",19,()=>[]);const i=e.dateDisplayInfo.timeIcon==="sun"?Oa:e.dateDisplayInfo.timeIcon==="moon"?Na:e.dateDisplayInfo.timeIcon==="cloud"?ja:null;var v=Pi(),y=a(v),u=a(y),V=a(u),U=s(u,2);{var R=F=>{i(F,{class:"h-3 w-3"})};l(U,F=>{i&&F(R)})}f(F=>{pa(v,"data-tip",F),c(V,e.dateDisplayInfo.formattedDate)},[()=>r().map(F=>F.r).join(", ")]),n(_,v),Lt()}var Mi=ar("<title> </title>"),Ci=ar("<svg><!><use></use></svg>");function qi(_,e){let r=Pt(e,"size",3,24),i=Pt(e,"class",3,""),v=Za(e,["$$slots","$$events","$$legacy","name","size","title","class"]);var y=Ci();Ya(y,()=>({width:r(),height:r(),class:i(),"aria-hidden":e.title?void 0:"true",...v}));var u=a(y);{var V=R=>{var F=Mi(),dt=a(F);f(()=>c(dt,e.title)),n(R,F)};l(u,R=>{e.title&&R(V)})}var U=s(u);f(()=>pa(U,"href",`/icons/sprite.svg#${e.name??""}`)),n(_,y)}var Di=o('<div class="text-primary-content flex items-center gap-2"><!> </div>'),Ti=o('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),Ii=o('<div class="font-semibold">Sur toute la période</div>'),$i=o('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),Ai=o('le <span class="font-semibold"> </span>',1),Ei=o('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),Oi=o('<span class="font-semibold"> </span>'),Ni=o('le <span class="font-semibold"> </span>',1),ji=o('<div class="text-primary-content"><!></div>'),zi=(_,e,r)=>e.onOpenGroupEditModal("store",t(r).map(i=>i.data.$id),t(r).map(i=>i.data)),Fi=(_,e,r)=>e.onOpenGroupEditModal("who",t(r).map(i=>i.data.$id),t(r).map(i=>i.data)),Bi=(_,e,r)=>e.onOpenGroupPurchaseModal(t(r).map(i=>i.data)),Li=o(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),Ri=o('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),Qi=o('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),Vi=o('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),Ui=(_,e,r)=>e.onOpenModal(t(r).$id,"recettes"),Wi=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"recettes"),Gi=o('<div class="text-base-content/60 text-sm font-normal"> </div>'),Hi=o('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),Ji=o('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),Xi=o('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),Ki=o('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),Yi=o('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),Zi=(_,e,r)=>e.onOpenModal(t(r).$id,"magasins"),tl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"magasins"),el=o('<div class="ml-1"><!></div>'),al=o('<div class="ml-1"> </div> <!>',1),rl=o('<div class="ml-1 text-sm font-medium">?</div>'),sl=(_,e,r)=>e.onOpenModal(t(r).$id,"volontaires"),nl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"volontaires"),ol=o('<span class="text-base-content/50 text-xs"> </span>'),il=o('<div class="ml-1 flex gap-1"> <!></div>'),ll=o('<div class="ml-1 text-sm font-medium">?</div>'),dl=o('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),vl=o('<div class="flex items-center gap-1 text-sm"><!> </div>'),cl=o('<div class="flex items-center gap-1 text-sm"><!> </div>'),ul=o('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),_l=o('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),fl=(_,e,r)=>e.onOpenModal(t(r).$id,"recettes"),pl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"recettes"),ml=o('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),gl=o("<span> </span>"),bl=o('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),hl=(_,e,r,i)=>{_.stopPropagation(),e.onQuickValidation(t(r),t(i))},xl=o('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),yl=o(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle
                        des besoins: <!> <!></span></div>`),wl=(_,e,r)=>e.onOpenModal(t(r).$id,"achats"),kl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"achats"),Sl=o('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Pl=o('<span class="text-xs opacity-75"> </span>'),Ml=o('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Cl=o('<div class="text-base-content/50 text-xs italic">aucun</div>'),ql=o('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 relative flex flex-1 cursor-pointer flex-wrap items-start justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>'),Dl=o('<!> <div class="space-y-4 sm:space-y-2"></div>',1),Tl=o('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),Il=o('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),$l=o('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),Al=o('<span class="block text-[9pt] font-normal opacity-60"> </span>'),El=o('<div class="font-medium"> </div>'),Ol=o('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),Nl=o('<div class="font-medium"> </div>'),jl=o('<div class="text-[9pt] opacity-70"> </div>'),zl=o('<div class="flex gap-6"><!> <!></div>'),Fl=o('<span class="text-xs opacity-70"> </span>'),Bl=o('<div class="text-nowrap"> </div>'),Ll=o('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),Rl=o('<div class="text-nowrap"> </div>'),Ql=o('<div class="flex flex-col items-end gap-0.5"></div>'),Vl=o('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),Ul=o('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),Wl=o("<span>Aucune recette pour le moment</span>"),Gl=o("<span>Aucun produit trouvé avec les filtres actuels</span>"),Hl=o('<div class="py-8 text-center"><div class="alert alert-info"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Jl=o('<div></div> <div class="hidden w-full print:block"></div> <!>',1);function Xl(_,e){Bt(e,!0);const r={Package:Aa,MessageCircleQuestionMark:rs,ShoppingCart:Te,Clock:Ga,CircleCheck:as,CircleX:es,ClipboardCheck:ts,PackageCheck:fr,Check:ha};let i=Pt(e,"disabled",3,!1);const v=L(()=>P.groupedFilteredProducts),y=P.filters,u=ye(P.dateStore.start),V=ye(P.dateStore.end),U=L(()=>!P.dateStore.isEventPassed&&!P.dateStore.hasPastDatesInRange),R=L(()=>y.completionStatus==="completed"?"bg-emerald-800":y.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");var F=Jl(),dt=ct(F);Wt(dt,21,()=>Object.entries(t(v)),([C,S])=>C,(C,S)=>{var st=L(()=>_a(t(S),2));let Y=()=>t(st)[0];const b=L(()=>t(st)[1]);var T=Dl(),tt=ct(T);{var pt=nt=>{const W=L(()=>Da(Y()));var x=Vi(),$=a(x),bt=a($);{var B=A=>{var Q=Di(),N=a(Q);ue(N,{class:"size-4 md:size-5"});var q=s(N);f(()=>c(q,` ${Y()??""} (${t(b).length??""})`)),n(A,Q)},rt=A=>{var Q=Ot(),N=ct(Q);{var q=z=>{var I=Ti(),O=a(I);ca(O,()=>t(W).icon,(H,M)=>{M(H,{class:"size-4 md:size-5"})});var d=s(O,2),G=a(d),Z=s(d,2),w=a(Z);f(()=>{c(G,t(W).displayName),c(w,`(${t(b).length??""})`)}),n(z,I)},et=z=>{var I=ae();f(()=>c(I,`📦 ${Y()??""} (${t(b).length??""})`)),n(z,I)};l(N,z=>{y.groupBy==="productType"?z(q):z(et,!1)},!0)}n(A,Q)};l(bt,A=>{y.groupBy==="store"?A(B):A(rt,!1)})}var j=s($,2);{var lt=A=>{var Q=Ei(),N=a(Q);{var q=z=>{var I=Ii();n(z,I)},et=z=>{var I=Ot(),O=ct(I);{var d=Z=>{var w=$i(),H=s(ct(w)),M=a(H),p=s(H,2),ut=a(p);f((gt,vt)=>{c(M,gt),c(ut,vt)},[()=>qe(P.dateStore.start),()=>qe(P.dateStore.end)]),n(Z,w)},G=Z=>{var w=Ai(),H=s(ct(w)),M=a(H);f(p=>c(M,p),[()=>qe(P.dateStore.start)]),n(Z,w)};l(O,Z=>{P.dateStore.start!==P.dateStore.end?Z(d):Z(G,!1)},!0)}n(z,I)};l(N,z=>{P.dateStore.isFullRange&&P.dateStore.start!==P.dateStore.end?z(q):z(et,!1)})}n(A,Q)},at=A=>{var Q=ji(),N=a(Q);{var q=z=>{var I=Oi(),O=a(I);f((d,G)=>c(O,`${d??""} → ${G??""}`),[()=>qe(P.dateStore.start),()=>qe(P.dateStore.end)]),n(z,I)},et=z=>{var I=Ni(),O=s(ct(I)),d=a(O);f(G=>c(d,G),[()=>qe(P.dateStore.start,!0)]),n(z,I)};l(N,z=>{!P.dateStore.isFullRange&&P.dateStore.start!==P.dateStore.end?z(q):z(et,!1)})}n(A,Q)};l(j,A=>{Yt.isMobile?A(at,!1):A(lt)})}var ft=s(j,2);{var X=A=>{var Q=Ri(),N=a(Q);N.__click=[zi,e,b];var q=a(N);ue(q,{size:16});var et=s(q,4);he(et,{size:16});var z=s(N,2);z.__click=[Fi,e,b];var I=a(z);ua(I,{size:16});var O=s(I,4);he(O,{size:16});var d=s(z,2);{var G=Z=>{var w=Li();w.__click=[Bi,e,b];var H=a(w);Te(H,{size:16});var M=s(H,4);Ha(M,{size:16}),Tt("mouseenter",w,()=>qt.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),Tt("mouseleave",w,()=>qt.reset()),n(Z,w)};l(d,Z=>{t(b).some(w=>w.data.displayMissingQuantity!=="✅ Complet")&&Z(G)})}Tt("mouseenter",N,()=>qt.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),Tt("mouseleave",N,()=>qt.reset()),Tt("mouseenter",z,()=>qt.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),Tt("mouseleave",z,()=>qt.reset()),n(A,Q)},h=A=>{var Q=Ot(),N=ct(Q);{var q=et=>{var z=Qi(),I=a(z),O=a(I);Ga(O,{size:16}),n(et,z)};l(N,et=>{P.dateStore.hasPastDatesInRange&&et(q)},!0)}n(A,Q)};l(ft,A=>{t(U)?A(X):A(h,!1)})}f(()=>St(x,1,`${t(R)??""} @container sticky ${Yt.isMobile?"top-11":"top-16 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md @md:flex-nowrap print:shadow-none`)),n(nt,x)};l(tt,nt=>{Y()!==""&&nt(pt)})}var yt=s(tt,2);Wt(yt,21,()=>t(b),nt=>nt.data.$id,(nt,W)=>{const x=L(()=>t(W).data),$=L(()=>t(W).stats),bt=L(()=>Da(t(x).productType)),B=L(()=>is(t(x).purchases||[])),rt=L(()=>t(x).totalNeededOverrideParsed),j=L(()=>nr(t(x)));var lt=ql(),at=a(lt),ft=a(at),X=a(ft);X.__click=[Ui,e,x],X.__keydown=[Wi,e,x];var h=a(X),A=a(h);ca(A,()=>t(bt).icon,(K,it)=>{it(K,{class:"h-4 w-4"})});var Q=s(A),N=s(Q);{var q=K=>{var it=Gi(),xt=a(it);f(()=>c(xt,`Ancien: ${t(x).previousNames[0]??""}`)),n(K,it)};l(N,K=>{t(x).previousNames&&t(x).previousNames.length>0&&K(q)})}var et=s(N,2);{var z=K=>{var it=Hi(),xt=a(it);Wa(xt,{class:"text-warning h-4 w-4"}),n(K,it)};l(et,K=>{t(x).productHugoUuid||K(z)})}var I=s(h,2),O=a(I);{var d=K=>{var it=Ji(),xt=a(it);Ca(xt,{class:"text-success h-4 w-4"}),n(K,it)};l(O,K=>{t(x).pF&&K(d)})}var G=s(O,2);{var Z=K=>{var it=Xi(),xt=a(it);qa(xt,{class:"text-info h-4 w-4"}),n(K,it)};l(G,K=>{t(x).pS&&K(Z)})}var w=s(I,2);{var H=K=>{var it=Ki(),xt=a(it);_r(xt,{class:"h-4 w-4 animate-spin"}),n(K,it)};l(w,K=>{t(x).status==="isSyncing"&&K(H)})}var M=s(w,2);{var p=K=>{var it=Yi(),xt=a(it);Wt(xt,20,()=>t($).concernedDates,$t=>$t,($t,At)=>{const Qt=L(()=>t($).recipesByDate.get(At)||[]),zt=L(()=>t(W).data.dateDisplayInfo[At]||Va(At));Ka($t,{get dateDisplayInfo(){return t(zt)},get recipes(){return t(Qt)}})}),n(K,it)};l(M,K=>{!Yt.isMobile&&t($).concernedDates.length>0&&K(p)})}var ut=s(X,2);{var gt=K=>{var it=dl(),xt=a(it);xt.__click=[Zi,e,x],xt.__keydown=[tl,e,x];var $t=a(xt);ue($t,{size:18});var At=s($t,2);{var Qt=ee=>{var me=al(),oa=ct(me),ka=a(oa),Sa=s(oa,2);{var xe=ge=>{var ke=el(),Oe=a(ke);Si(Oe,{get tip(){return t(x).storeInfo.storeComment},get icon(){return ss},iconSize:14}),n(ge,ke)};l(Sa,ge=>{t(x).storeInfo?.storeComment&&ge(xe)})}f(()=>c(ka,t(x).storeInfo.storeName)),n(ee,me)},zt=ee=>{var me=rl();n(ee,me)};l(At,ee=>{t(x).storeInfo?.storeName?ee(Qt):ee(zt,!1)})}var Rt=s(xt,2);Rt.__click=[sl,e,x],Rt.__keydown=[nl,e,x];var Vt=a(Rt);ua(Vt,{size:18});var ne=s(Vt,2);{var pe=ee=>{var me=Ot(),oa=ct(me);{var ka=xe=>{var ge=il(),ke=a(ge),Oe=s(ke);{var Ne=ce=>{var Fa=ol(),gr=a(Fa);f(()=>c(gr,`+${t(x).who.length-2}`)),n(ce,Fa)};l(Oe,ce=>{t(x).who.length>2&&ce(Ne)})}f(ce=>c(ke,`${ce??""}... `),[()=>t(x).who.slice(0,2).map(ce=>ce.slice(0,5)).join(" | ")]),n(xe,ge)},Sa=xe=>{var ge=Ot(),ke=ct(ge);{var Oe=Ne=>{var ce=ae();f(()=>c(ce,t(x).who)),n(Ne,ce)};l(ke,Ne=>{t(x).who.length===1&&Ne(Oe)},!0)}n(xe,ge)};l(oa,xe=>{t(x).who.length>1?xe(ka):xe(Sa,!1)})}n(ee,me)},Ce=ee=>{var me=ll();n(ee,me)};l(ne,ee=>{t(x).who&&t(x).who.length?ee(pe):ee(Ce,!1)})}f(()=>{St(xt,1,`btn btn-soft btn-xs sm:btn-sm group relative ${t(x).storeInfo?.storeName?"btn-success":""}`),St(Rt,1,`btn btn-xs sm:btn-sm btn-soft group relative ${t(x).who&&t(x).who?.length>0?"btn-success":""}`)}),Tt("mouseenter",xt,()=>qt.msg="Définissez le magasin où acheter le produit"),Tt("mouseleave",xt,()=>qt.reset()),Tt("mouseenter",Rt,()=>qt.msg="Déclarez qui est responsable de l'achat de ce produit"),Tt("mouseleave",Rt,()=>qt.reset()),n(K,it)},vt=K=>{var it=ul(),xt=a(it);{var $t=zt=>{var Rt=vl(),Vt=a(Rt);ue(Vt,{size:16});var ne=s(Vt);f(()=>c(ne,` ${t(x).storeInfo.storeName??""}`)),n(zt,Rt)};l(xt,zt=>{t(x).storeInfo?.storeName&&zt($t)})}var At=s(xt,2);{var Qt=zt=>{var Rt=cl(),Vt=a(Rt);ua(Vt,{size:16});var ne=s(Vt);f(pe=>c(ne,` ${pe??""}`),[()=>t(x).who.join(", ")]),n(zt,Rt)};l(At,zt=>{t(x).who&&t(x).who.length>0&&zt(Qt)})}n(K,it)};l(ut,K=>{t(U)?K(gt):K(vt,!1)})}var mt=s(ft,2);{var J=K=>{var it=_l(),xt=a(it);Wt(xt,20,()=>t($).concernedDates,$t=>$t,($t,At)=>{const Qt=L(()=>t($).recipesByDate.get(At)||[]),zt=L(()=>t(W).data.dateDisplayInfo[At]||Va(At));Ka($t,{get dateDisplayInfo(){return t(zt)},get recipes(){return t(Qt)}})}),n(K,it)};l(mt,K=>{Yt.isMobile&&t($).concernedDates.length>0&&K(J)})}var ot=s(mt,2),_t=a(ot),wt=s(a(_t),2);wt.__click=[fl,e,x],wt.__keydown=[pl,e,x];var kt=a(wt),Mt=a(kt),Ut=a(Mt);{var Ct=K=>{var it=ml(),xt=a(it),$t=a(xt),At=s(xt,2);Wa(At,{class:"h-4 w-4"});var Qt=s(At);f(()=>{c($t,t($).formattedQuantities),c(Qt,` ${t(rt).totalOverride.q??""}
                          ${t(rt).totalOverride.u??""}`)}),n(K,it)},Ft=K=>{var it=gl(),xt=a(it);f(()=>c(xt,t($).formattedQuantities)),n(K,it)};l(Ut,K=>{t(rt)?.totalOverride?K(Ct):K(Ft,!1)})}var Nt=s(Mt,2);{var oe=K=>{var it=bl(),xt=a(it),$t=a(xt),At=s($t);ba(At,{class:"h-3 w-3"});var Qt=s(xt,2),zt=a(Qt),Rt=s(zt);Ea(Rt,{class:"h-3 w-3"}),f(()=>{c($t,`${t($).nbRecipes??""} `),c(zt,`${t($).totalAssiettes??""} `)}),n(K,it)};l(Nt,K=>{(t($).nbRecipes||t($).totalAssiettes)&&K(oe)})}var re=s(kt,2);{var le=K=>{var it=xl();it.__click=[hl,e,x,$];var xt=a(it),$t=s(a(xt)),At=s(xt,2),Qt=a(At);qi(Qt,{name:"add-to-cart",size:16}),f(()=>c($t,` ${t($).formattedMissingQuantities??""}`)),Tt("mouseenter",it,()=>qt.msg="Ajouter aux achats effectués"),Tt("mouseleave",it,()=>qt.reset()),n(K,it)},ie=K=>{var it=Ot(),xt=ct(it);{var $t=At=>{Ha(At,{size:24,class:"text-success ms-auto"})};l(xt,At=>{t(U)&&At($t)},!0)}n(K,it)};l(re,K=>{t(U)&&t($).hasMissing?K(le):K(ie,!1)})}var te=s(re,2);{var de=K=>{var it=yl(),xt=a(it);ur(xt,{size:18});var $t=s(xt,2),At=s(a($t));{var Qt=Vt=>{var ne=ae();f(()=>c(ne,`${t(j).details?.oldPlates??""}→${t(j).details?.newPlates??""} couverts`)),n(Vt,ne)};l(At,Vt=>{t(j).platesChanged&&Vt(Qt)})}var zt=s(At,2);{var Rt=Vt=>{var ne=ae();f(()=>c(ne,`${t(j).details?.oldRecipes??""}→${t(j).details?.newRecipes??""}
                          recettes`)),n(Vt,ne)};l(zt,Vt=>{t(j).recipesChanged&&Vt(Rt)})}n(K,it)};l(te,K=>{t(U)&&t(j)?.hasMismatch&&K(de)})}var fe=s(_t,2),jt=s(a(fe),2);jt.__click=[wl,e,x],jt.__keydown=[kl,e,x];var Et=a(jt);Te(Et,{class:"h-4 w-4 opacity-60"});var It=s(Et,2),Gt=s(It,2),Jt=a(Gt);{var se=K=>{var it=Sl(),xt=a(it),$t=a(xt);Zr($t,{class:"text-secondary h-4 w-4"});var At=s($t,2),Qt=a(At),zt=s(xt,2),Rt=a(zt);f(Vt=>{c(Qt,`${t(x).stockParsed.quantity??""}
                            ${t(x).stockParsed.unit??""}`),c(Rt,`stock: ${Vt??""}`)},[()=>Fe(t(x).stockParsed.dateTime)]),n(K,it)};l(Jt,K=>{t(x).stockParsed&&K(se)})}var Xt=s(Jt,2);Wt(Xt,17,()=>t(B),Pe,(K,it)=>{const xt=L(()=>r[t(it).icon]);var $t=Ml(),At=a($t),Qt=a(At);ca(Qt,()=>t(xt),(pe,Ce)=>{Ce(pe,{class:"h-4 w-4"})});var zt=s(Qt,2),Rt=a(zt),Vt=s(At,2);{var ne=pe=>{var Ce=Pl(),ee=a(Ce);f(()=>c(ee,`livré le: ${t(it).deliveryDate??""}`)),n(pe,Ce)};l(Vt,pe=>{t(it).deliveryDate&&pe(ne)})}f(()=>{St($t,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${t(it).badgeClass??""}`),c(Rt,`${t(it).quantity??""}
                            ${t(it).unit??""}`)}),n(K,$t)});var ve=s(Xt,2);{var we=K=>{var it=Cl();n(K,it)};l(ve,K=>{t(B).length===0&&!t(x)?.stockParsed&&K(we)})}f(()=>{St(lt,1,`card bg-base-100 ${(Yt.isMobile&&"border-base-300 border shadow")??""} ${t(x).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),c(Q,`${t(x).productName??""} `),St(Mt,1,`text-base font-bold ${t($).hasMissing&&t(U)?"text-error":"text-success"}`),St(It,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${t(U)?"group-hover:block":"hidden"} sm:hidden`)}),Tt("mouseenter",X,()=>qt.msg="Afficher les informations sur ce produit"),Tt("mouseleave",X,()=>qt.reset()),Tt("mouseenter",wt,()=>qt.msg="Afficher les informations sur ce produit"),Tt("mouseleave",wt,()=>qt.reset()),Tt("mouseenter",jt,()=>qt.msg="Déclarez des achats effectués"),Tt("mouseleave",jt,()=>qt.reset()),Ta(2,lt,()=>kr),n(nt,lt)}),n(C,T)});var E=s(dt,2);Wt(E,21,()=>Object.entries(t(v)),([C,S])=>C,(C,S)=>{var st=L(()=>_a(t(S),2));let Y=()=>t(st)[0],g=()=>t(st)[1];var b=Ul(),T=a(b);{var tt=B=>{var rt=Tl(),j=a(rt),lt=a(j),at=s(lt),ft=a(at),X=s(at,2),h=a(X);{var A=N=>{var q=ae("Toute la période");n(N,q)},Q=N=>{var q=Ot(),et=ct(q);{var z=O=>{var d=ae();f(()=>c(d,`du ${u??""} au ${V??""}`)),n(O,d)},I=O=>{var d=ae();f(()=>c(d,`le ${u??""}`)),n(O,d)};l(et,O=>{P.dateStore.start!==P.dateStore.end?O(z):O(I,!1)},!0)}n(N,q)};l(h,N=>{P.dateStore.isFullRange?N(A):N(Q,!1)})}f(()=>{c(lt,`${(Y()==="Non défini"?"Groupe inconnu":Y())??""} `),c(ft,`(${g().length??""} produits)`)}),n(B,rt)};l(T,B=>{Y()!==""&&B(tt)})}var pt=s(T,2),yt=a(pt),nt=a(yt),W=s(a(nt),3);{var x=B=>{var rt=Il();n(B,rt)},$=B=>{var rt=$l();n(B,rt)};l(W,B=>{y.groupBy==="store"?B(x):B($,!1)})}var bt=s(yt);Wt(bt,21,g,B=>B.data.$id,(B,rt)=>{const j=L(()=>t(rt).data),lt=L(()=>t(rt).stats);var at=Vl(),ft=s(a(at)),X=a(ft),h=s(X);{var A=M=>{var p=Al(),ut=a(p);f(()=>c(ut,`(Ancien: ${t(j).previousNames[0]??""})`)),n(M,p)};l(h,M=>{t(j).previousNames&&t(j).previousNames.length>0&&M(A)})}var Q=s(ft),N=a(Q);{var q=M=>{var p=ae();f(()=>c(p,`${t(j).totalNeededOverrideParsed.totalOverride.q??""}
                  ${t(j).totalNeededOverrideParsed.totalOverride.u??""}`)),n(M,p)},et=M=>{var p=ae();f(()=>c(p,t(lt).formattedQuantities)),n(M,p)};l(N,M=>{t(j).totalNeededOverrideParsed?.totalOverride?M(q):M(et,!1)})}var z=s(Q),I=a(z);{var O=M=>{var p=Ol(),ut=a(p);{var gt=J=>{var ot=El(),_t=a(ot);f(wt=>c(_t,wt),[()=>t(j).who.join(", ")]),n(J,ot)};l(ut,J=>{t(j).who?.length&&J(gt)})}var vt=s(ut,2),mt=a(vt);f(()=>c(mt,t(j).productType||"Autre")),n(M,p)},d=M=>{var p=zl(),ut=a(p);{var gt=J=>{var ot=Nl(),_t=a(ot);f(()=>c(_t,t(j).storeInfo.storeName)),n(J,ot)};l(ut,J=>{t(j).storeInfo?.storeName&&J(gt)})}var vt=s(ut,2);{var mt=J=>{var ot=jl(),_t=a(ot);f(wt=>c(_t,wt),[()=>t(j).who.join(", ")]),n(J,ot)};l(vt,J=>{t(j).who?.length&&J(mt)})}n(M,p)};l(I,M=>{y.groupBy==="store"?M(O):M(d,!1)})}var G=s(z),Z=a(G);{var w=M=>{var p=Ll(),ut=a(p),gt=a(ut),vt=s(gt);{var mt=_t=>{var wt=Fl(),kt=a(wt);f(Mt=>c(kt,`(${Mt??""})`),[()=>Fe(t(j).stockParsed.dateTime)]),n(_t,wt)};l(vt,_t=>{t(j).stockParsed?.dateTime&&_t(mt)})}var J=s(ut,2);{var ot=_t=>{var wt=Ot(),kt=ct(wt);Wt(kt,17,()=>t(j).purchases,Pe,(Mt,Ut)=>{var Ct=Bl(),Ft=a(Ct);f(()=>c(Ft,`${t(Ut).quantity??""} ${t(Ut).unit??""}`)),n(Mt,Ct)}),n(_t,wt)};l(J,_t=>{t(j).purchases?.length&&_t(ot)})}f(()=>c(gt,`📦 ${t(j).stockParsed.quantity??""} `)),n(M,p)},H=M=>{var p=Ot(),ut=ct(p);{var gt=vt=>{var mt=Ql();Wt(mt,21,()=>t(j).purchases,Pe,(J,ot)=>{var _t=Rl(),wt=a(_t);f(()=>c(wt,`${t(ot).quantity??""} ${t(ot).unit??""}`)),n(J,_t)}),n(vt,mt)};l(ut,vt=>{t(j).purchases?.length&&vt(gt)},!0)}n(M,p)};l(Z,M=>{t(j).stockParsed?M(w):M(H,!1)})}f(()=>c(X,`${t(j).productName??""} `)),n(B,at)}),n(C,b)});var m=s(E,2);{var k=C=>{var S=Hl(),st=a(S),Y=s(a(st),2);{var g=T=>{var tt=Wl();n(T,tt)},b=T=>{var tt=Gl();n(T,tt)};l(Y,T=>{e.currentEvent&&e.currentEvent.meals&&e.currentEvent.meals.length>0&&e.currentEvent.meals.every(tt=>!tt.recipes||tt.recipes.length===0)?T(g):T(b,!1)})}n(C,S)};l(m,C=>{Object.values(t(v)).flat().length===0&&C(k)})}f(()=>St(dt,1,`space-y-4 rounded-lg print:hidden ${i()?"opacity-50 pointer-events-none":""}`)),n(_,F),Lt()}Zt(["click","keydown"]);var Kl=o('<div class="alert alert-error"><!> <span> </span></div>'),Yl=(_,e)=>D(e,"empty"),Zl=(_,e)=>D(e,"all"),td=o('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),ed=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),ad=o("<!> ",1),rd=o('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),sd=o("<!> <!> <!>",1);function nd(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=ht(null),y=ht(Ht(e.products.length>0&&e.products[0].storeInfo?e.products[0].storeInfo.storeName:"")),u=ht(Ht(e.products.length>0&&e.products[0].storeInfo&&e.products[0].storeInfo.storeComment||"")),V=ht(Ht({})),U=ht("empty");be(()=>{const S={};e.products.forEach(st=>{e.productIds.includes(st.$id)&&(t(U)==="empty"?S[st.$id]=!st.storeInfo||!st.storeInfo.storeName:S[st.$id]=!0)}),D(V,S,!0)});const R=L(()=>e.products.map(S=>({id:S.$id,label:S.productName,title:S.productName,selected:t(V)[S.$id]}))),F=L(()=>t(R).filter(S=>S.selected)),dt=L(()=>`Attribuer un magasin (${t(F).length} produits sélectionnés)`),E=L(()=>t(F).length===0?!1:t(y).trim().length>0);async function m(){if(!t(E)||t(r))return;D(i,null),D(v,null);const S=t(F).map(g=>g.id),st=e.products.filter(g=>S.includes(g.$id));P.setSyncStatus(S,!0),Yt.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${S.length} produits)`,progress:0},e.onClose();const Y={storeName:t(y).trim(),storeComment:t(u).trim()};try{const g=await Ia.track(or(S,st,"store",Y).then(b=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${b.success?"succès":"échec"}, ${b.updatedCount} produits modifiés`),!b.success)throw new Error(b.error||"Erreur lors de la mise à jour");return b}),{loading:`Mise à jour du magasin pour ${S.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});e.onSuccess?.(g)}catch(g){console.error("[StoreEditModal] Erreur mise à jour:",g),P.clearSyncStatus()}finally{D(r,!1),Yt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function k(){t(r)||e.onClose()}function C(S){t(V)[S]=!t(V)[S]}Ie(_,{isOpen:!0,onClose:k,children:(S,st)=>{var Y=sd(),g=ct(Y);Me(g,{get title(){return t(dt)},onClose:k,children:(tt,pt)=>{ue(tt,{class:"text-secondary"})},$$slots:{default:!0}});var b=s(g,2);$e(b,{children:(tt,pt)=>{var yt=td(),nt=a(yt);{var W=h=>{var A=Kl(),Q=a(A);ma(Q,{class:"h-4 w-4"});var N=s(Q,2),q=a(N);f(()=>c(q,t(i))),n(h,A)};l(nt,h=>{t(i)&&h(W)})}var x=s(nt,2),$=a(x),bt=a($);Ae(bt,{get suggestions(){return P.uniqueStores},get disabled(){return t(r)},id:"store-name-input",get value(){return t(y)},set value(h){D(y,h,!0)}});var B=s($,2),rt=a(B);Ee(rt,{get disabled(){return t(r)},id:"store-comment-textarea",get value(){return t(u)},set value(h){D(u,h,!0)}});var j=s(x,2),lt=s(a(j),2),at=a(lt);at.__click=[Yl,U];var ft=s(at,2);ft.__click=[Zl,U];var X=s(lt,2);Be(X,{get items(){return t(R)},onToggleItem:C,size:"sm",color:"success"}),f(()=>{St(at,1,`tab ${t(U)==="empty"?"tab-active":""}`),St(ft,1,`tab ${t(U)==="all"?"tab-active":""}`)}),n(tt,yt)}});var T=s(b,2);xa(T,{children:(tt,pt)=>{var yt=rd(),nt=ct(yt);nt.__click=k;var W=s(nt,2);W.__click=m;var x=a(W);{var $=B=>{var rt=ed();n(B,rt)},bt=B=>{var rt=ad(),j=ct(rt);ha(j,{class:"h-4 w-4"});var lt=s(j);f(()=>c(lt,` Appliquer à ${t(F).length??""} produit(s)`)),n(B,rt)};l(x,B=>{t(r)?B($):B(bt,!1)})}f(()=>{nt.disabled=t(r),W.disabled=t(r)||!t(E)}),n(tt,yt)}}),n(S,Y)},$$slots:{default:!0}}),Lt()}Zt(["click"]);var od=o('<div class="alert alert-error"><!> <span> </span></div>'),id=(_,e)=>D(e,"empty"),ld=(_,e)=>D(e,"all"),dd=o(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),vd=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),cd=o("<!> ",1),ud=o('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),_d=o("<!> <!> <!>",1);function fd(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=ht(Ht([])),y=ht(""),u=ht("empty"),V=ht(Ht({}));be(()=>{const g={};e.products.forEach(b=>{e.productIds.includes(b.$id)&&(t(u)==="empty"?g[b.$id]=!b.who||b.who.length===0:g[b.$id]=!0)}),D(V,g,!0)});const U=L(()=>e.products.map(g=>({id:g.$id,label:g.productName,title:g.productName,selected:t(V)[g.$id]}))),R=L(()=>t(U).filter(g=>g.selected)),F=L(()=>{const g=new Set([...P.uniqueWho,...t(v)]);return Array.from(g).map(b=>({id:b,label:b,selected:t(v).includes(b)}))}),dt=L(()=>`Gérer les volontaires (${t(R).length} produit${t(R).length>1?"s":""})`),E=L(()=>t(R).length===0?!1:t(v).length>0);async function m(){if(!t(E)||t(r))return;D(i,null);const g=t(R).map(T=>T.id),b=e.products.filter(T=>g.includes(T.$id));P.setSyncStatus(g,!0),Yt.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${g.length} produits)`,progress:0},e.onClose();try{await Ia.track(or(g,b,"who",{names:t(v)}).then(T=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${T.success?"succès":"échec"}, ${T.updatedCount} produits modifiés`),!T.success)throw new Error(T.error||"Erreur lors de la mise à jour");return P.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),e.onSuccess?.(T),T}),{loading:`Mise à jour des mandatés pour ${g.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(T){console.error("[WhoEditModal] Erreur mise à jour:",T),P.clearSyncStatus()}finally{D(r,!1),Yt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function k(g){const b=g.trim();b&&!t(v).includes(b)&&D(v,[...t(v),b],!0)}function C(g){D(v,t(v).filter(b=>b!==g),!0)}function S(g){t(v).includes(g)?C(g):k(g)}function st(){t(y).trim()&&(k(t(y)),D(y,""))}function Y(g){t(V)[g]=!t(V)[g]}Ie(_,{isOpen:!0,get onClose(){return e.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(g,b)=>{var T=_d(),tt=ct(T);Me(tt,{get title(){return t(dt)},showBackButton:!0,get onClose(){return e.onClose}});var pt=s(tt,2);$e(pt,{children:(nt,W)=>{var x=dd(),$=a(x);{var bt=O=>{var d=od(),G=a(d);ma(G,{class:"h-4 w-4"});var Z=s(G,2),w=a(Z);f(()=>c(w,t(i))),n(O,d)};l($,O=>{t(i)&&O(bt)})}var B=s($,2),rt=s(a(B),2),j=a(rt),lt=a(j);na(lt,{get disabled(){return t(r)},onkeydown:O=>{O.key==="Enter"&&(O.preventDefault(),st())},get value(){return t(y)},set value(O){D(y,O,!0)}});var at=s(j,2);at.__click=st;var ft=a(at);cr(ft,{size:16});var X=s(rt,2),h=a(X),A=s(h,2);Be(A,{get items(){return t(F)},onToggleItem:S,size:"lg",color:"info"});var Q=s(B,2),N=a(Q),q=s(a(N),2),et=a(q);et.__click=[id,u];var z=s(et,2);z.__click=[ld,u];var I=s(N,2);Be(I,{get items(){return t(U)},onToggleItem:Y,size:"sm",color:"success"}),f(O=>{at.disabled=O,St(h,1,`text-base-content/70 mb-2 hidden text-sm ${(t(F).length&&"inline")??""}`),St(et,1,`btn btn-sm ${t(u)==="empty"&&"btn-secondary"}`),St(z,1,`btn btn-sm ${t(u)==="all"&&"btn-secondary"}`)},[()=>t(r)||!t(y).trim()]),n(nt,x)}});var yt=s(pt,2);xa(yt,{children:(nt,W)=>{var x=ud(),$=ct(x);$.__click=function(...lt){e.onClose?.apply(this,lt)};var bt=s($,2);bt.__click=m;var B=a(bt);{var rt=lt=>{var at=vd();n(lt,at)},j=lt=>{var at=cd(),ft=ct(at);ha(ft,{class:"h-4 w-4"});var X=s(ft);f(()=>c(X,` Appliquer à ${t(R).length??""} produit${t(R).length>1?"s":""}`)),n(lt,at)};l(B,lt=>{t(r)?lt(rt):lt(j,!1)})}f(()=>{$.disabled=t(r),bt.disabled=t(r)||!t(E)}),n(nt,x)}}),n(g,T)},$$slots:{default:!0}}),Lt()}Zt(["click"]);async function pd(_,e,r,i,v,y){if(!t(e).invoiceTotal||t(e).invoiceTotal<=0){D(r,"Le montant doit être supérieur à 0");return}D(i,!0),D(r,null);try{const u=P.currentMainId;if(!u)throw new Error("Aucun événement principal actif");t(v)?await rr(t(v),{price:t(e).invoiceTotal,invoiceTotal:t(e).invoiceTotal,store:t(e).store,notes:t(e).notes,who:t(e).who}):await zr(u,void 0,t(e).invoiceTotal,t(e).store,t(e).notes,t(e).who),y()}catch(u){console.error("Erreur sauvegarde dépense:",u),D(r,u.message,!0)}finally{D(i,!1)}}var md=o('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),gd=o('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),bd=(_,e)=>D(e,!0),hd=o('<button class="btn btn-primary btn-sm"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="mr-1 h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"></path></svg> Ajouter une dépense</button>'),xd=o('<span class="loading loading-spinner loading-xs"></span>'),yd=o('<div class="text-error mt-2 text-xs"> </div>'),wd=o('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),kd=(_,e)=>e("date"),Sd=(_,e)=>e("store"),Pd=(_,e)=>e("who"),Md=(_,e)=>e("amount"),Cd=o('<span class="text-base-content/70 italic"> </span>'),qd=o('<span class="text-base-content/50 ml-1 text-xs"> </span>'),Dd=o('<span class="font-medium"> </span> <!>',1),Td=(_,e,r)=>e(t(r)),Id=o('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),$d=o('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),Ad=o('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),Ed=(_,e,r)=>e(t(r)),Od=o('<div class="text-sm italic opacity-70"> </div>'),Nd=o('<div class="text-xs opacity-60"> </div>'),jd=o('<div class="text-sm font-medium"> </div> <!>',1),zd=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),Fd=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),Bd=o('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),Ld=o('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),Rd=o('<div class="space-y-3"><!> <!></div>'),Qd=o('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),Vd=o("<!> <!>",1);function Ud(_,e){Bt(e,!0);let r=Pt(e,"isOpen",15,!1),i=ht(!1),v=ht(null),y=ht(!1),u=ht(Ht({invoiceTotal:0,store:"",notes:"",who:""})),V=ht(null);be(()=>{if(r()&&!t(V)){const g=localStorage.getItem("appwrite-user-name");g&&(t(u).who=g)}});let U=ht("date"),R=ht("desc"),F=L(()=>P.financialStats),dt=L(()=>t(F).allPurchases),E=L(()=>{let g=[...t(dt)];return g.sort((b,T)=>{let tt,pt;switch(t(U)){case"date":tt=new Date(b.orderDate||b.$createdAt).getTime(),pt=new Date(T.orderDate||T.$createdAt).getTime();break;case"amount":tt=b.invoiceTotal||b.price||0,pt=T.invoiceTotal||T.price||0;break;case"store":tt=(b.store||"").toLowerCase(),pt=(T.store||"").toLowerCase();break;case"who":tt=(b.who||"").toLowerCase(),pt=(T.who||"").toLowerCase();break}return tt<pt?t(R)==="asc"?-1:1:tt>pt?t(R)==="asc"?1:-1:0}),g});function m(g){t(U)===g?D(R,t(R)==="asc"?"desc":"asc",!0):(D(U,g,!0),D(R,"desc"))}function k(){const g=localStorage.getItem("appwrite-user-name")||"";D(u,{invoiceTotal:0,store:"",notes:"",who:g},!0),D(V,null),D(y,!1)}function C(g){D(u,{invoiceTotal:g.invoiceTotal||g.price||0,store:g.store||"",notes:g.notes||"",who:g.who||""},!0),D(V,g.$id,!0),D(y,!0)}function S(){r(!1),k(),D(v,null)}function st(g){return g?new Date(g).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function Y(g){return(g||0).toFixed(2)+" €"}Ie(_,{get isOpen(){return r()},onClose:S,maxWidth:"lg",children:(g,b)=>{var T=Vd(),tt=ct(T);Me(tt,{title:"Gestion des Dépenses",onClose:S});var pt=s(tt,2);$e(pt,{children:(yt,nt)=>{var W=Qd(),x=a(W),$=a(x),bt=a($),B=s(a(bt),2),rt=a(B),j=s(B,2),lt=a(j),at=s($,2),ft=s(a(at),2);Wt(ft,21,()=>Object.entries(t(F).byStore).sort((d,G)=>G[1]-d[1]),Pe,(d,G)=>{var Z=L(()=>_a(t(G),2));let w=()=>t(Z)[0],H=()=>t(Z)[1];var M=md(),p=a(M),ut=a(p),gt=s(p,2),vt=a(gt);f(mt=>{c(ut,w()),c(vt,mt)},[()=>Y(H())]),n(d,M)});var X=s(at,2),h=s(a(X),2);Wt(h,21,()=>Object.entries(t(F).byWho).sort((d,G)=>G[1]-d[1]),Pe,(d,G)=>{var Z=L(()=>_a(t(G),2));let w=()=>t(Z)[0],H=()=>t(Z)[1];var M=gd(),p=a(M),ut=a(p),gt=s(p,2),vt=a(gt);f(mt=>{c(ut,w()),c(vt,mt)},[()=>Y(H())]),n(d,M)});var A=s(x,2),Q=s(a(A),2);{var N=d=>{var G=hd();G.__click=[bd,y],n(d,G)};l(Q,d=>{t(y)||d(N)})}var q=s(A,2);{var et=d=>{var G=wd(),Z=a(G),w=a(Z),H=a(w),M=s(w,2),p=a(M);za(p,{get disabled(){return t(i)},get value(){return t(u).invoiceTotal},set value(Ct){t(u).invoiceTotal=Ct}});var ut=s(p,2);Ae(ut,{get suggestions(){return P.uniqueStores},get disabled(){return t(i)},get value(){return t(u).store},set value(Ct){t(u).store=Ct}});var gt=s(ut,2);na(gt,{get suggestions(){return P.uniqueWho},get disabled(){return t(i)},get value(){return t(u).who},set value(Ct){t(u).who=Ct}});var vt=s(gt,2);Ee(vt,{get disabled(){return t(i)},get value(){return t(u).notes},set value(Ct){t(u).notes=Ct}});var mt=s(M,2),J=a(mt);J.__click=k;var ot=s(J,2);ot.__click=[pd,u,v,i,V,k];var _t=a(ot);{var wt=Ct=>{var Ft=xd();n(Ct,Ft)};l(_t,Ct=>{t(i)&&Ct(wt)})}var kt=s(_t),Mt=s(mt,2);{var Ut=Ct=>{var Ft=yd(),Nt=a(Ft);f(()=>c(Nt,t(v))),n(Ct,Ft)};l(Mt,Ct=>{t(v)&&Ct(Ut)})}f(()=>{c(H,t(V)?"Modifier la dépense":"Nouvelle Dépense"),ot.disabled=t(i),c(kt,` ${t(V)?"Enregistrer":"Ajouter"}`)}),n(d,G)};l(q,d=>{t(y)&&d(et)})}var z=s(q,2);{var I=d=>{var G=Ad(),Z=a(G),w=a(Z),H=a(w),M=a(H);M.__click=[kd,m];var p=a(M),ut=s(M,2);ut.__click=[Sd,m];var gt=a(ut),vt=s(ut);vt.__click=[Pd,m];var mt=a(vt),J=s(vt);J.__click=[Md,m];var ot=a(J),_t=s(J),wt=a(_t);ns(wt,{size:14});var kt=s(w),Mt=a(kt);Wt(Mt,17,()=>t(E),Ft=>Ft.$id,(Ft,Nt)=>{var oe=Id(),re=a(oe),le=a(re),ie=s(re),te=a(ie);{var de=K=>{var it=Cd(),xt=a(it);f(()=>c(xt,t(Nt).notes||"-")),n(K,it)},fe=K=>{var it=Dd(),xt=ct(it),$t=a(xt),At=s(xt,2);{var Qt=zt=>{var Rt=qd(),Vt=a(Rt);f(()=>c(Vt,`- ${t(Nt).notes??""}`)),n(zt,Rt)};l(At,zt=>{t(Nt).notes&&zt(Qt)})}f(()=>c($t,t(Nt)._productName||"Produit inconnu")),n(K,it)};l(te,K=>{t(Nt).status==="expense"?K(de):K(fe,!1)})}var jt=s(ie),Et=a(jt),It=s(jt),Gt=a(It),Jt=s(It),se=a(Jt),Xt=s(Jt),ve=a(Xt);ve.__click=[Td,C,Nt];var we=a(ve);he(we,{size:14}),f((K,it)=>{c(le,K),c(Et,t(Nt).store||"-"),c(Gt,t(Nt).who||"-"),c(se,it)},[()=>st(t(Nt).orderDate||t(Nt).$createdAt),()=>Y(t(Nt).invoiceTotal||t(Nt).price)]),n(Ft,oe)});var Ut=s(Mt);{var Ct=Ft=>{var Nt=$d();n(Ft,Nt)};l(Ut,Ft=>{t(E).length===0&&Ft(Ct)})}f(()=>{c(p,`Date ${t(U)==="date"?t(R)==="asc"?"↑":"↓":""}`),c(gt,`Magasin ${t(U)==="store"?t(R)==="asc"?"↑":"↓":""}`),c(mt,`Qui ${t(U)==="who"?t(R)==="asc"?"↑":"↓":""}`),c(ot,`Montant ${t(U)==="amount"?t(R)==="asc"?"↑":"↓":""}`)}),n(d,G)},O=d=>{var G=Rd(),Z=a(G);Wt(Z,17,()=>t(E),M=>M.$id,(M,p)=>{var ut=Bd(),gt=a(ut),vt=a(gt),mt=a(vt),J=a(mt),ot=a(J);Le(ot,{class:"h-3.5 w-3.5"});var _t=s(ot,2),wt=a(_t),kt=s(J,2),Mt=a(kt),Ut=s(mt,2);Ut.__click=[Ed,C,p];var Ct=a(Ut);he(Ct,{size:16});var Ft=s(vt,2),Nt=a(Ft);{var oe=jt=>{var Et=Od(),It=a(Et);f(()=>c(It,t(p).notes)),n(jt,Et)},re=jt=>{var Et=jd(),It=ct(Et),Gt=a(It),Jt=s(It,2);{var se=Xt=>{var ve=Nd(),we=a(ve);f(()=>c(we,t(p).notes)),n(Xt,ve)};l(Jt,Xt=>{t(p).notes&&Xt(se)})}f(()=>c(Gt,t(p)._productName||"Produit inconnu")),n(jt,Et)};l(Nt,jt=>{t(p).status==="expense"&&t(p).notes?jt(oe):jt(re,!1)})}var le=s(Ft,2),ie=a(le);{var te=jt=>{var Et=zd(),It=a(Et);ue(It,{class:"h-3 w-3"});var Gt=s(It,2),Jt=a(Gt);f(()=>c(Jt,t(p).store)),n(jt,Et)};l(ie,jt=>{t(p).store&&jt(te)})}var de=s(ie,2);{var fe=jt=>{var Et=Fd(),It=a(Et);sa(It,{class:"h-3 w-3"});var Gt=s(It,2),Jt=a(Gt);f(()=>c(Jt,t(p).who)),n(jt,Et)};l(de,jt=>{t(p).who&&jt(fe)})}f((jt,Et)=>{c(wt,jt),c(Mt,Et)},[()=>Fe(t(p).orderDate||t(p).$createdAt),()=>Y(t(p).invoiceTotal||t(p).price)]),n(M,ut)});var w=s(Z,2);{var H=M=>{var p=Ld(),ut=a(p);pr(ut,{class:"mx-auto mb-3 h-12 w-12"}),n(M,p)};l(w,M=>{t(E).length===0&&M(H)})}n(d,G)};l(z,d=>{Yt.isMobile?d(O,!1):d(I)})}f(d=>{c(rt,d),c(lt,`${t(dt).length??""} transactions`)},[()=>Y(t(F).totalGlobal)]),n(yt,W)}}),n(g,T)},$$slots:{default:!0}}),Lt()}Zt(["click"]);function Wd(_,e){D(e,!0)}var Gd=o('<div class="flex gap-2"><button class="btn btn-primary" title="Ajouter un produit manuellement"><!> Produit</button></div>'),Hd=o('<div class="flex min-h-96 items-center justify-center"><div class="flex flex-col items-center gap-4"><!> <p class="text-base-content/60 text-sm">Chargement des produits...</p></div></div>'),Jd=o("<!> ",1),Xd=o("<!> ",1),Kd=o('<div class="flex-grow py-4 print:hidden"><!></div>'),Yd=(_,e)=>D(e,!0),Zd=o('<div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><div class="text-primary text-3xl font-black"> </div> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-end gap-10"><div class="alert" id="info-past-event"></div> <div class="card card-xs sm:card:sm border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div></div></div> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow hover:bg-orange-700/10"><button class="card-body cursor-pointer" title="Ajouter une dépense générale"><div class="card-title text-orange-800"><!> Dépense</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <!></button></div></div></div> <!>',1),tv=o('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),ev=o('<div class="flex items-center justify-center"><!></div>'),av=o('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),rv=o("<!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function xv(_,e){Bt(e,!0);const r=d=>{var G=Gd(),Z=a(G);Z.__click=[Wd,E];var w=a(Z);lr(w,{class:"mr-1 h-4 w-4"}),n(d,G)},i="100";let v=ht(null),y=ht("recettes"),u=ht(!1),V=ht(!1),U=ht(Ht([])),R=ht(Ht([])),F=ht(!1),dt=ht(Ht([])),E=ht(!1),m=ht(!0);be(()=>{Fr()});let k=Ht(e.params?.id);const C=L(()=>k?Ua.getEventById(k):null),S=L(()=>t(C)?.name??""),st=L(()=>t(C)?.dateStart??null),Y=L(()=>t(C)?.dateEnd??null);Sr(async()=>{try{if(!k){console.error("[EventProductsPage] eventId est requis"),D(m,!1);return}const d=Ua.getEventById(k);if(!d){console.error(`[EventProductsPage] Événement ${k} introuvable`),D(m,!1);return}console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${d.name}`),await P.initialize(k)}catch(d){console.error("[EventProductsPage] Erreur lors de l'initialisation:",d)}finally{D(m,!1)}});function g(d,G="recettes"){D(y,G,!0),D(v,d,!0)}function b(){D(v,null)}function T(d,G,Z){D(U,G,!0),D(R,Z,!0),d==="who"?D(u,!0):D(V,!0)}function tt(d){(!d||d==="who")&&D(u,!1),(!d||d==="store")&&D(V,!1),D(U,[],!0),D(R,[],!0)}function pt(d){console.log(`[ProductsTable] Modification groupée réussie: ${d.updatedCount} produits`)}function yt(d){const G=d.filter(Z=>P.getProductModelById(Z.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${d.length} produits reçus → ${G.length} produits avec quantités manquantes`),D(dt,G,!0),D(F,!0)}function nt(){D(F,!1),D(dt,[],!0)}function W(){console.log("[ProductsTable] Achat groupé créé avec succès"),nt()}async function x(d,G){try{if(!P.currentMainId)throw new Error("mainId non disponible");const Z=G.missingQuantities||[];if(Z.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const w=Z.filter(M=>M.q<0).map(M=>({...M,q:Math.abs(M.q)})).map(M=>{const p=ze.normalize(M.q,M.u);return{q:p.quantity,u:p.unit}});let H=d.$id;d.isSynced||(console.log(`[ProductsTable] Produit ${d.$id} local, création pour validation rapide...`),H=(await Se(d.$id,{},p=>P.getEnrichedProductById(p))).$id,console.log(`[ProductsTable] Produit sync créé: ${H}`)),await Br(P.currentMainId,H,w,{store:d.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${d.productName}`)}catch(Z){console.error("[ProductsTable] Erreur validation rapide:",Z),alert("Erreur lors de la validation rapide: "+Z.message)}}let $=ht(!1);be(()=>{Xa.setConfig({eventId:k||void 0,actions:r})}),Pr(()=>{Xa.reset()});var bt=rv(),B=ct(bt);ds(B,{width:i,children:(d,G)=>{wi(d,{})},$$slots:{default:!0}});var rt=s(B,2),j=a(rt);{var lt=d=>{var G=Hd(),Z=a(G),w=a(Z);_r(w,{class:"text-primary h-12 w-12 animate-spin"}),n(d,G)},at=d=>{var G=Zd(),Z=ct(G),w=a(Z),H=a(w),M=a(H),p=s(H,2),ut=a(p);{var gt=Et=>{var It=Jd(),Gt=ct(It);Le(Gt,{class:"inline h-4 w-4"});var Jt=s(Gt);f((se,Xt)=>c(Jt,` ${se??""} au ${Xt??""}`),[()=>Ma(t(st)),()=>Ma(t(Y))]),n(Et,It)},vt=Et=>{var It=Ot(),Gt=ct(It);{var Jt=se=>{var Xt=Xd(),ve=ct(Xt);Le(ve,{class:"inline h-4 w-4"});var we=s(ve);f(K=>c(we,` ${K??""}`),[()=>Ma(t(st))]),n(se,Xt)};l(Gt,se=>{t(st)&&se(Jt)},!0)}n(Et,It)};l(ut,Et=>{t(st)&&t(Y)?Et(gt):Et(vt,!1)})}var mt=s(w,2);{var J=Et=>{var It=Kd(),Gt=a(It);ls(Gt,{get currentEvent(){return t(C)}}),n(Et,It)};l(mt,Et=>{t(C)&&Et(J)})}var ot=s(mt,2),_t=s(a(ot),2),wt=a(_t),kt=a(wt),Mt=a(kt);fr(Mt,{class:"text-orange-800 opacity-60"});var Ut=s(kt,2),Ct=a(Ut),Ft=a(Ct),Nt=a(Ft),oe=s(_t,2),re=a(oe);re.__click=[Yd,$];var le=a(re),ie=a(le);pr(ie,{class:"text-orange-800 opacity-60"});var te=s(le,2),de=a(te),fe=s(te,2);he(fe,{class:"text-base-content/60 absolute right-3 bottom-2 size-4"});var jt=s(Z,2);Xl(jt,{get currentEvent(){return t(C)},onOpenModal:g,onOpenGroupEditModal:T,onOpenGroupPurchaseModal:yt,onQuickValidation:x}),f(()=>{c(M,t(S)),c(Nt,P.completionStats.missing),c(de,`${P.financialStats.totalGlobal??""} €`)}),Tt("mouseenter",re,()=>qt.msg="Consulter ou modifie le détail des dépenses"),Tt("mouseleave",re,()=>qt.reset()),n(d,G)};l(j,d=>{t(m)?d(lt):d(at,!1)})}var ft=s(j,2);{let d=L(()=>t(v)||"");Eo(ft,{get productId(){return t(d)},get initialTab(){return t(y)},onClose:b})}var X=s(ft,2);{var h=d=>{fd(d,{get productIds(){return t(U)},get products(){return t(R)},onClose:()=>tt("who"),onSuccess:pt})};l(X,d=>{t(u)&&d(h)})}var A=s(X,2);{var Q=d=>{nd(d,{get productIds(){return t(U)},get products(){return t(R)},onClose:()=>tt("store"),onSuccess:pt})};l(A,d=>{t(V)&&d(Q)})}var N=s(A,2);{var q=d=>{Ps(d,{get products(){return t(dt)},onClose:nt,onSuccess:W})};l(N,d=>{t(F)&&d(q)})}var et=s(N,2);Os(et,{get open(){return t(E)},set open(d){D(E,d,!0)}});var z=s(et,2);Ud(z,{get isOpen(){return t($)},set isOpen(d){D($,d,!0)}});var I=s(z,2);{var O=d=>{var G=av(),Z=a(G),w=a(Z);{var H=p=>{var ut=tv(),gt=a(ut);Ja(gt,{class:"me-2 size-5"});var vt=s(gt),mt=s(vt);mt.__click=()=>qt.collapse();var J=a(mt);ga(J,{class:"h-4 w-4"}),f(()=>c(vt,` ${qt.msg??""} `)),n(p,ut)},M=p=>{var ut=ev();ut.__click=()=>qt.expand();var gt=a(ut);Ja(gt,{class:"size-6"}),n(p,ut)};l(w,p=>{qt.isExpanded?p(H):p(M,!1)})}f(()=>St(Z,1,`rounded-tr-box bg-blue-100 text-blue-800 ${qt.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),n(d,G)};l(I,d=>{Yt.isDesktop&&d(O)})}f(()=>St(rt,1,`space-y-6 pt-6 md:px-16 ${(Yt.isDesktop&&"ml-110 print:ml-0")??""} `)),n(_,bt),Lt()}Zt(["click"]);export{xv as default};
