var br=Object.defineProperty;var La=_=>{throw TypeError(_)};var hr=(_,e,r)=>e in _?br(_,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):_[e]=r;var Pa=(_,e,r)=>hr(_,typeof e!="symbol"?e+"":e,r),xr=(_,e,r)=>e.has(_)||La("Cannot "+r);var Dt=(_,e,r)=>(xr(_,e,"read from private field"),r?r.call(_):e.get(_)),Yt=(_,e,r)=>e.has(_)?La("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(_):e.set(_,r);import{at as ue,au as sa,av as yr,H as ma,a6 as De,aw as Ta,z as wr,P as Ia,ax as Za,b as kr,a5 as be,ay as Sr,p as Fe,X as pa,T as Pr,az as tr,Y as er,aA as Mr,a as ga,w as $a,$ as ar,ai as Cr,aB as qr,ap as Aa,aq as Ea,o as Oa,U as ca,v as ba,s as Dr,F as ia,S as Tr,aC as Ca,G as qa,y as Ir,aD as Ra,e as rr,aE as $r,aF as sr,aG as Ar,C as Er,h as Or,a4 as Qa,aH as Nr,aI as Va,aJ as zr,aK as jr,aL as nr,W as Ua}from"./icons.js";import{d as Bt,p as Pt,V as o,g as a,h as s,a as or,r as ir,a2 as l,W as f,_ as St,a9 as _e,b as n,c as Lt,m as t,u as L,Z as Zt,a4 as ha,aA as lr,Y as Ht,q as ht,a1 as he,v as D,k as ct,B as P,X as c,y as Kt,C as Na,aS as Fr,e as Wt,i as Pe,a8 as Tt,aB as Wa,aT as Br,aU as Lr,aV as ze,aW as Se,aE as je,aX as Rr,aY as dr,aZ as Qr,a_ as Ga,a$ as Vr,b0 as Ur,b1 as Wr,b2 as Gr,b3 as Hr,b4 as _a,aa as ae,j as Ot,b5 as vr,b6 as Jr,b7 as cr,b8 as Ha,a7 as za,b9 as Te,aL as Xr,ba as Yr,aC as Kr,ak as ua,bb as qt,f as ur,t as fa,bc as Ja,bd as _r,be as Zr,ag as ts,ah as es,aq as as,z as Xa,bf as rs}from"./appwrite.js";import{b as ye,g as Be,a as ss,D as qe}from"./date-helpers.js";import{B as Le}from"./BtnGroupCheck.js";import{S as ja,I as fr}from"./InfoCollapse.js";import{M as Ie,a as Me,b as $e,c as xa,s as mr,f as ns,n as Ya}from"./index.js";import{a as os,b as la,c as da,g as Da,d as is,f as Ma}from"./products-display.js";import{F as va}from"./Fieldset.js";import{E as ls}from"./EventStats.js";import{L as ds}from"./LeftPanel.js";import"./CheckboxBadge.js";import"./event-stats-helpers.js";var vs=o('<div><label class="input w-72"><!> <input/></label> <!></div>');function Ae(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"suggestions",19,()=>[]),v=Pt(e,"disabled",3,!1),y=Pt(e,"flexCol",3,!1),u=ir(e,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const U=L(()=>i().map(k=>({id:k,label:k,disabled:k===r()})));var W=vs(),R=a(W),F=a(R);ue(F,{class:"h-4 w-4 opacity-50"});var dt=s(F,2);or(dt,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:v(),...u}),void 0,void 0,void 0,!0);var E=s(R,2);{var p=k=>{ja(k,{get suggestions(){return t(U)},onSuggestionClick:C=>r(C.label),buttonSize:"btn-xs"})};l(E,k=>{i().length>0&&k(p)})}f(()=>St(W,1,`flex ${y()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),_e(dt,r),n(_,W),Lt()}var cs=o('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function na(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"suggestions",19,()=>[]),v=Pt(e,"disabled",3,!1),y=Pt(e,"flexCol",3,!1);const u=L(()=>i().map(p=>({id:p,label:p,disabled:p===r()})));var U=cs(),W=a(U),R=a(W);sa(R,{class:"h-4 w-4 opacity-50"});var F=s(R,2);F.__keydown=function(...p){e.onkeydown?.apply(this,p)};var dt=s(W,2);{var E=p=>{ja(p,{get suggestions(){return t(u)},onSuggestionClick:k=>r(k.label),buttonSize:"btn-xs"})};l(dt,p=>{i().length>0&&p(E)})}f(()=>{St(U,1,`flex ${y()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),F.disabled=v()}),_e(F,r),n(_,U),Lt()}Zt(["keydown"]);var us=o('<textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea>');function Ee(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"disabled",3,!1);var v=us();f(()=>{v.disabled=i(),ha(v,"id",e.id)}),_e(v,r),n(_,v),Lt()}var _s=o('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function Fa(_,e){Bt(e,!0);let r=Pt(e,"value",15),i=Pt(e,"disabled",3,!1);var v=_s(),y=a(v);yr(y,{class:"h-4 w-4 opacity-50"});var u=s(y,2);f(()=>u.disabled=i()),_e(u,r),n(_,v),Lt()}var fs=o('<label class="input"><span class="label">Date de livraison prévue</span> <input type="date"/></label>'),ms=o(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function pr(_,e){Bt(e,!0);let r=Pt(e,"status",15),i=Pt(e,"deliveryDate",15),v=Pt(e,"disabled",3,!1);var y=ms(),u=a(y),U=a(u),W=a(U);W.value=W.__value="delivered";var R=s(W);R.value=R.__value="ordered";var F=s(U,2),dt=s(u,2);{var E=p=>{var k=fs(),C=s(a(k),2);f(()=>C.disabled=v()),_e(C,i),n(p,k)};l(dt,p=>{r()==="ordered"&&p(E)})}f(()=>{U.disabled=v(),St(F,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),lr(U,r),n(_,y),Lt()}var ps=o('<div class="alert alert-error"><!> <span> </span></div>'),gs=o(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),bs=o('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),hs=o('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),xs=o(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),ys=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),ws=o('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),ks=o('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),Ss=o("<!> <!> <!>",1);function Ps(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=Ht({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),y=ht(Ht(new Set));he(()=>{D(y,new Set(e.products.map(E=>E.$id)),!0)});const u=L(()=>e.products.filter(E=>t(y).has(E.$id))),U=L(()=>t(u).length!==0),W=L(()=>{const E=P.dateRange;let p="";return E?.start&&E?.end&&(E.start===E.end?p=` - ${ye(E.start)}`:p=` - Du ${ye(E.start)} au ${ye(E.end)}`),`Achat groupé (${t(u).length} produit${t(u).length>1?"s":""})${p}`});async function R(){if(!t(U)||t(r))return;D(r,!0),D(i,null);const E=`FACTURE_${Date.now()}`,p=t(u).map(S=>S.$id);P.setSyncStatus(p,!0),Kt.backgroundOperation={isRunning:!0,name:`Achat groupé (${t(u).length} produits)`,progress:0};const k=[];for(const S of t(u)){const Z=(P.getProductModelById(S.$id)?.stats.missingQuantities||[]).filter(g=>g.q<0).map(g=>({...g,q:Math.abs(g.q)}));k.push({productId:S.$id,isSynced:S.isSynced,missingQuantities:Z})}const C={invoiceId:E,invoiceTotal:v.expense||void 0,store:v.store.trim()||void 0,notes:v.notes||`Achat groupé pour ${t(u).length} produits`,who:v.who.trim()||void 0,purchaseStatus:v.status||"delivered",purchaseDeliveryDate:v.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${k.length} produits...`),e.onClose();try{await Na.track(Fr(P.currentMainId,k,C).then(S=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${S.success?"succès":"échec"}, ${S.totalProductsCreated} produits synchronisés, ${S.totalPurchasesCreated} achats créés, ${S.totalExpensesCreated} dépenses globales`),!S.success)throw new Error(S.error||"Erreur lors de la création de l'achat groupé");return P.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),e.onSuccess?.(),S}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(S){console.error("[GroupPurchaseModal] Erreur création achat groupé:",S),P.clearSyncStatus()}finally{D(r,!1),Kt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function F(E){const p=new Set(t(y));p.has(E)?p.delete(E):p.add(E),D(y,p,!0)}const dt=L(()=>e.products.map(E=>{const p=P.getProductModelById(E.$id);return{id:E.$id,label:E.productName,title:`${E.productName} - Manque: ${p?.stats.formattedMissingQuantities||"-"}`,badge:p?.stats.formattedMissingQuantities||"-"}}));Ie(_,{isOpen:!0,get onClose(){return e.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(E,p)=>{var k=Ss(),C=ct(k);Me(C,{get title(){return t(W)},showBackButton:!0,get onClose(){return e.onClose}});var S=s(C,2);$e(S,{children:(Z,g)=>{var b=xs(),T=a(b);{var tt=h=>{var A=ps(),Q=a(A);ma(Q,{class:"h-4 w-4"});var N=s(Q,2),q=a(N);f(()=>c(q,t(i))),n(h,A)};l(T,h=>{t(i)&&h(tt)})}var mt=s(T,2),yt=a(mt);fr(yt,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:(h,A)=>{var Q=gs();n(h,Q)},$$slots:{default:!0}});var nt=s(mt,2),G=s(a(nt),2),x=a(G),$=a(x);Ae($,{get suggestions(){return P.uniqueStores},get disabled(){return t(r)},get value(){return v.store},set value(h){v.store=h}});var bt=s(x,2),B=a(bt);na(B,{get suggestions(){return P.uniqueWho},get disabled(){return t(r)},get value(){return v.who},set value(h){v.who=h}});var rt=s(G,2);Fa(rt,{get disabled(){return t(r)},get value(){return v.expense},set value(h){v.expense=h}});var z=s(rt,2);pr(z,{get disabled(){return t(r)},get status(){return v.status},set status(h){v.status=h},get deliveryDate(){return v.deliveryDate},set deliveryDate(h){v.deliveryDate=h}});var lt=s(z,2);Ee(lt,{get disabled(){return t(r)},get value(){return v.notes},set value(h){v.notes=h}});var at=s(nt,2);{var ft=h=>{var A=bs(),Q=s(a(A),2),N=s(a(Q)),q=a(N),et=s(N,2),j=a(et),I=s(Q,2);Le(I,{get items(){return t(dt)},onToggleItem:F,size:"sm",color:"success"}),f((O,d)=>{c(q,O),c(j,d)},[()=>ye(P.dateRange.start),()=>ye(P.dateRange.end)]),n(h,A)},X=h=>{var A=hs();n(h,A)};l(at,h=>{t(dt).length>0?h(ft):h(X,!1)})}n(Z,b)}});var st=s(S,2);xa(st,{children:(Z,g)=>{var b=ks(),T=a(b);T.__click=function(...G){e.onClose?.apply(this,G)};var tt=s(T,2);tt.__click=R;var mt=a(tt);{var yt=G=>{var x=ys();n(G,x)},nt=G=>{var x=ws(),$=ct(x);De($,{class:"h-4 w-4"});var bt=s($,2),B=s(a(bt)),rt=a(B);f(()=>c(rt,`${t(u).length??""} produit${t(u).length>1?"s":""}`)),n(G,x)};l(mt,G=>{t(r)?G(yt):G(nt,!1)})}f(()=>{T.disabled=t(r),tt.disabled=t(r)||!t(U)}),n(Z,b)}}),n(E,k)},$$slots:{default:!0}}),Lt()}Zt(["click"]);const Ms=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var Cs=o("<option> </option>"),qs=o('<fieldset class="fieldset"><div class="flex gap-2"><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité" required/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end" required><option disabled selected>-</option><!></select></label></div></fieldset>');function ya(_,e){Bt(e,!0);let r=Pt(e,"quantity",15),i=Pt(e,"unit",15),v=Pt(e,"disabled",3,!1);var y=qs(),u=a(y),U=a(u),W=a(U);Ta(W,{class:"h-4 w-4 opacity-50"});var R=s(W,2),F=s(U,2),dt=s(a(F),2),E=a(dt);E.value=E.__value="";var p=s(E);Wt(p,17,()=>Ms,Pe,(k,C)=>{let S=()=>t(C).value,st=()=>t(C).label;var Z=Cs(),g=a(Z),b={};f(()=>{c(g,st()),b!==(b=S())&&(Z.value=(Z.__value=S())??"")}),n(k,Z)}),f(()=>{R.disabled=v(),dt.disabled=v()}),_e(R,r),lr(dt,i),n(_,y),Lt()}var Ds=o('<div class="alert alert-error text-sm"><!> <span> </span></div>'),Ts=(_,e)=>e(!0),Is=o('<span class="loading loading-spinner"></span>'),$s=o('<span class="loading loading-spinner"></span>'),As=o('<form class="flex h-full flex-col space-y-4"><!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),Es=o("<!> <!>",1);function Os(_,e){Bt(e,!0);let r=Pt(e,"open",15,!1),i=ht(!1),v=ht(null),y=ht(!1),u=ht(Ht({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const U=L(()=>t(u).productName.trim().length>0&&t(u).productType.trim().length>0),W=L(()=>P.uniqueProductTypes.map(dt=>({id:dt,label:dt})));async function R(dt=!1){if(!(!t(U)||t(i))){D(i,!0),D(v,null),D(y,!1);try{if(!P.currentMainId)throw new Error("Aucun événement principal sélectionné");const E={productName:t(u).productName.trim(),productType:t(u).productType.trim(),store:t(u).store.trim()?{storeName:t(u).store.trim()}:void 0,who:t(u).who.trim()?[t(u).who.trim()]:void 0,pF:t(u).pF,pS:t(u).pS,quantity:t(u).quantity?{q:t(u).quantity,u:t(u).unit.trim()||"pièces"}:void 0};await Br(E,P.currentMainId),D(y,!0),dt?(t(u).productName="",t(u).quantity=null,t(u).unit="",t(u).pF=!1,t(u).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),D(u,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(E){console.error("Error creating product:",E),D(v,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{D(i,!1)}}}function F(){r(!1),D(u,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),D(v,null)}he(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),Ie(_,{get isOpen(){return r()},onClose:F,children:(dt,E)=>{var p=Es(),k=ct(p);Me(k,{title:"Ajouter un produit",onClose:F});var C=s(k,2);$e(C,{children:(S,st)=>{var Z=As(),g=a(Z);{var b=m=>{var ut=Ds(),gt=a(ut);ma(gt,{size:18});var vt=s(gt,2),pt=a(vt);f(()=>c(pt,t(v))),n(m,ut)};l(g,m=>{t(v)&&m(b)})}var T=s(g,2),tt=a(T),mt=a(tt),yt=a(mt),nt=a(yt);wr(nt,{class:"text-base-content/50 h-5 w-5"});var G=s(nt,2),x=s(mt,2);ya(x,{get disabled(){return t(i)},get quantity(){return t(u).quantity},set quantity(m){t(u).quantity=m},get unit(){return t(u).unit},set unit(m){t(u).unit=m}});var $=s(tt,2),bt=a($),B=a(bt),rt=a(B),z=s(B,2);ja(z,{get suggestions(){return t(W)},onSuggestionClick:m=>t(u).productType=m.label,get disabled(){return t(i)}});var lt=s($,2);Ae(lt,{get suggestions(){return P.uniqueStores},get disabled(){return t(i)},get value(){return t(u).store},set value(m){t(u).store=m}});var at=s(lt,2);na(at,{get suggestions(){return P.uniqueWho},get disabled(){return t(i)},get value(){return t(u).who},set value(m){t(u).who=m}});var ft=s(at,2),X=a(ft),h=a(X),A=a(h),Q=s(X,2),N=a(Q),q=a(N),et=s(ft,2),j=a(et);j.__click=F;var I=s(j,2),O=a(I);O.__click=[Ts,R];var d=a(O);{var V=m=>{var ut=Is();n(m,ut)},Y=m=>{Ia(m,{size:18})};l(d,m=>{t(i)?m(V):m(Y,!1)})}var w=s(O,2),H=a(w);{var M=m=>{var ut=$s();n(m,ut)};l(H,m=>{t(i)&&m(M)})}f(()=>{T.disabled=t(i),G.disabled=t(i),rt.disabled=t(i),A.disabled=t(i),q.disabled=t(i),j.disabled=t(i),O.disabled=t(i)||!t(u).productName,w.disabled=t(i)||!t(u).productName}),Tt("submit",Z,m=>{m.preventDefault(),R(!1)}),_e(G,()=>t(u).productName,m=>t(u).productName=m),_e(rt,()=>t(u).productType,m=>t(u).productType=m),Wa(A,()=>t(u).pF,m=>t(u).pF=m),Wa(q,()=>t(u).pS,m=>t(u).pS=m),n(S,Z)}}),n(dt,p)},$$slots:{default:!0}}),Lt()}Zt(["click"]);var Re,Qe,Ve,Ue,We,Ge,He,Je,Xe,Ye,Ke,Ze,ta,ea,aa,ra;class Ns{constructor(e,r="recettes"){Yt(this,Re,ht(!1));Yt(this,Qe,ht(null));Yt(this,Ve,ht("recettes"));Yt(this,Ue,L(()=>P.getProductModelById(this.productId)));Yt(this,We,L(()=>this.productModel?.data??null));Yt(this,Ge,L(()=>this.product?.who??[]));Yt(this,He,L(()=>this.product?.stockParsed??null));Yt(this,Je,L(()=>this.product?.purchases??[]));Yt(this,Xe,L(()=>this.product?.byDate?Lr(this.product.byDate):[]));Yt(this,Ye,ht(Ht({purchase:{quantity:null,unit:"",store:"",who:Kt.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));Yt(this,Ke,ht(Ht({overrideManagerEditMode:!1})));Yt(this,Ze,ht(null));Yt(this,ta,L(()=>this.editingPurchaseId?this.purchasesList.find(e=>e.$id===this.editingPurchaseId)??null:null));Yt(this,ea,ht(null));Yt(this,aa,L(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));Yt(this,ra,L(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));Pa(this,"formatQuantity",(e,r)=>_a(e,r));Pa(this,"formatDate",os);this.productId=e,this.currentTab=r,this.initForms()}get loading(){return t(Dt(this,Re))}set loading(e){D(Dt(this,Re),e,!0)}get error(){return t(Dt(this,Qe))}set error(e){D(Dt(this,Qe),e,!0)}get currentTab(){return t(Dt(this,Ve))}set currentTab(e){D(Dt(this,Ve),e,!0)}get productModel(){return t(Dt(this,Ue))}set productModel(e){D(Dt(this,Ue),e)}get product(){return t(Dt(this,We))}set product(e){D(Dt(this,We),e)}get whoList(){return t(Dt(this,Ge))}set whoList(e){D(Dt(this,Ge),e)}get stockParsed(){return t(Dt(this,He))}set stockParsed(e){D(Dt(this,He),e)}get purchasesList(){return t(Dt(this,Je))}set purchasesList(e){D(Dt(this,Je),e)}get recipes(){return t(Dt(this,Xe))}set recipes(e){D(Dt(this,Xe),e)}get forms(){return t(Dt(this,Ye))}set forms(e){D(Dt(this,Ye),e,!0)}get uiStates(){return t(Dt(this,Ke))}set uiStates(e){D(Dt(this,Ke),e,!0)}get editingPurchaseId(){return t(Dt(this,Ze))}set editingPurchaseId(e){D(Dt(this,Ze),e,!0)}get editingPurchaseData(){return t(Dt(this,ta))}set editingPurchaseData(e){D(Dt(this,ta),e)}get originalFormsSnapshot(){return t(Dt(this,ea))}set originalFormsSnapshot(e){D(Dt(this,ea),e,!0)}initForms(){const e=P.getProductModelById(this.productId);if(!e||!e.data)return;const r=e.stats.missingQuantities[0];if(r){const{value:i,unit:v}=ze(Math.abs(r.q),r.u);this.forms.purchase.quantity=i,this.forms.purchase.unit=v}else this.forms.purchase.quantity=null,this.forms.purchase.unit=e.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=e.data.storeInfo?.storeName??"",this.forms.purchase.who=Kt.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=e.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=e.data.storeInfo?.storeName??"",this.forms.store.comment=e.data.storeInfo?.storeComment??null,this.forms.who=e.data.who?[...e.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return t(Dt(this,aa))}set hasChanges(e){D(Dt(this,aa),e)}get hasAnyChanges(){return t(Dt(this,ra))}set hasAnyChanges(e){D(Dt(this,ra),e)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(e){this.currentTab=e}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");if(!P.currentMainId)throw new Error("mainId non disponible");const{value:e,unit:r}=ze(this.forms.purchase.quantity,this.forms.purchase.unit);this.product.isSynced||await Se(this.product.$id,{},dt=>P.getEnrichedProductById(dt));const i=this.forms.purchase.status||"delivered";let v=this.forms.purchase.deliveryDate||null;i==="delivered"&&!v&&(v=new Date().toISOString());const y=je.normalize(e,r),u=y.quantity,U=y.unit;await Rr({products:[this.product.$id],mainId:P.currentMainId,unit:U,quantity:u,store:this.forms.purchase.store||null,who:this.forms.purchase.who||null,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:i,orderDate:this.forms.purchase.orderDate||null,deliveryDate:v,invoiceId:null,invoiceTotal:null});const W=this.product.missingQuantityArray[0];let R=null,F=this.product.totalNeededArray[0]?.u??"";if(W){const{value:dt,unit:E}=ze(Math.abs(W.q),W.u);R=dt,F=E}this.forms.purchase={quantity:R,unit:F,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(e){this.editingPurchaseId=e.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(e){e.$id&&await this.withLoading(async()=>{const r=je.normalize(e.quantity,e.unit),i=e.status||null;let v=e.deliveryDate||null;i==="delivered"&&!v&&(v=new Date().toISOString()),await dr(e.$id,{unit:r.unit,quantity:r.quantity,store:e.store||null,who:e.who||null,notes:e.notes||"",price:e.price||null,status:i,orderDate:e.orderDate||null,deliveryDate:v}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(e){const r=this.purchasesList.find(i=>i.$id===e);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await Qr(e)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const e=je.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:e.quantity.toString(),unit:e.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};this.product.isSynced?await Ga(this.product.$id,JSON.stringify(r)):await Se(this.product.$id,{stockReel:JSON.stringify(r)},i=>P.getEnrichedProductById(i)),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{this.product.isSynced?await Ga(this.product.$id,null):await Se(this.product.$id,{stockReel:null},e=>P.getEnrichedProductById(e))},"Stock supprimé")}async setWho(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await Vr(this.product.$id,e):await Se(this.product.$id,{who:e},r=>P.getEnrichedProductById(r))},"Volontaires mis à jour")}async updateStore(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await Ur(this.product.$id,e):await Se(this.product.$id,{store:JSON.stringify(e)},r=>P.getEnrichedProductById(r))},"Magasin mis à jour")}async setOverride(e){this.product&&await this.withLoading(async()=>{this.product.isSynced?await Wr(this.product.$id,e,!0):await Se(this.product.$id,{totalNeededOverride:JSON.stringify(e)},r=>P.getEnrichedProductById(r))},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await Gr(this.product.$id,!0)},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const e={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};e.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(e.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};e.storeInfo=r}Object.keys(e).length>0&&(await Hr(this.product.$id,e,r=>P.getEnrichedProductById(r)),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(e,r){this.loading=!0,this.error=null;try{const i=await e();return r&&this.showToast("success",r),i}catch(i){const v=i instanceof Error?i.message:"Une erreur est survenue";return this.error=v,this.showToast("error",v),console.error("[ProductModalState]",i),null}finally{this.loading=!1}}showToast(e,r){const i=new CustomEvent("toast",{detail:{type:e,message:r}});window.dispatchEvent(i)}}Re=new WeakMap,Qe=new WeakMap,Ve=new WeakMap,Ue=new WeakMap,We=new WeakMap,Ge=new WeakMap,He=new WeakMap,Je=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,Ke=new WeakMap,Ze=new WeakMap,ta=new WeakMap,ea=new WeakMap,aa=new WeakMap,ra=new WeakMap;var zs=o('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),js=o('<div class="text-base-content/60 mt-1 text-xs"> </div>'),Fs=o('<div class="font-medium"> </div> <!>',1),Bs=o('<pre class="text-xs"> </pre>'),Ls=o('<span class="text-base-content/50 italic">Non défini</span>'),Rs=o('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),Qs=o('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function wa(_,e){Bt(e,!0);let r=Pt(e,"title",3,"Événement terminé"),i=Pt(e,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),v=Pt(e,"showData",3,!0),y=Pt(e,"data",3,null),u=Pt(e,"dataLabel",3,"");var U=Qs(),W=a(U),R=a(W);Za(R,{class:"text-warning h-5 w-5"});var F=s(R,2);kr(F,{class:"text-warning/70 h-4 w-4"});var dt=s(F,2),E=a(dt),p=s(W,2),k=a(p),C=s(p,2);{var S=st=>{var Z=Rs(),g=a(Z);{var b=nt=>{var G=zs(),x=a(G);f(()=>c(x,`${u()??""} :`)),n(nt,G)};l(g,nt=>{u()&&nt(b)})}var T=s(g,2),tt=a(T);{var mt=nt=>{var G=ae();f(()=>c(G,y())),n(nt,G)},yt=nt=>{var G=Ot(),x=ct(G);{var $=B=>{var rt=ae();f(z=>c(rt,z),[()=>y().join(", ")]),n(B,rt)},bt=B=>{var rt=Ot(),z=ct(rt);{var lt=ft=>{var X=Ot(),h=ct(X);{var A=N=>{var q=Fs(),et=ct(q),j=a(et),I=s(et,2);{var O=d=>{var V=js(),Y=a(V);f(()=>c(Y,y().storeComment)),n(d,V)};l(I,d=>{y().storeComment&&d(O)})}f(()=>c(j,y().storeName)),n(N,q)},Q=N=>{var q=Bs(),et=a(q);f(j=>c(et,j),[()=>JSON.stringify(y(),null,2)]),n(N,q)};l(h,N=>{y().storeName?N(A):N(Q,!1)})}n(ft,X)},at=ft=>{var X=Ls();n(ft,X)};l(z,ft=>{typeof y()=="object"&&y()!==null?ft(lt):ft(at,!1)},!0)}n(B,rt)};l(x,B=>{Array.isArray(y())&&y().length>0?B($):B(bt,!1)},!0)}n(nt,G)};l(tt,nt=>{typeof y()=="string"||typeof y()=="number"?nt(mt):nt(yt,!1)})}n(st,Z)};l(C,st=>{v()&&y()&&st(S)})}f(()=>{c(E,r()),c(k,i())}),n(_,U),Lt()}function Vs(_,e,r){if(e().isPurchaseFormValid)if(e().editingPurchaseId){const i=e().editingPurchaseData;if(!i||!r(i))return;const v=e().forms.purchase.quantity??0,y=e().forms.purchase.unit,u=je.normalize(v,y);i.quantity=u.quantity,i.unit=u.unit,i.price=e().forms.purchase.price,i.store=e().forms.purchase.store,i.who=e().forms.purchase.who,i.notes=e().forms.purchase.notes,i.status=e().forms.purchase.status,i.orderDate=e().forms.purchase.orderDate,i.deliveryDate=e().forms.purchase.deliveryDate,e().updateEditedPurchase(i),e().cancelEditPurchase()}else e().forms.purchase.status==="ordered"&&!e().forms.purchase.orderDate&&(e().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),e().addPurchase()}var Us=o('<button class="btn btn-ghost btn-sm">Annuler</button>'),Ws=o('<span class="loading loading-spinner loading-sm"></span>'),Gs=o('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-6"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Hs=o('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),Js=o("<th>Actions</th>"),Xs=(_,e,r)=>e(t(r)),Ys=(_,e,r)=>e(t(r).$id),Ks=o('<span class="loading loading-spinner loading-sm"></span>'),Zs=o('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),tn=o('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),en=o('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),an=(_,e,r)=>e(t(r).$id),rn=o('<span class="loading loading-spinner loading-xs"></span>'),sn=o('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),nn=o('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),on=o('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),ln=o('<div class="mt-2 text-sm opacity-70"> </div>'),dn=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),vn=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),cn=(_,e,r)=>e(t(r)),un=o('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),_n=o('<div class="card bg-base-100 border-neutral/40 border shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex flex-col gap-1"><div class="flex items-center gap-2 text-sm opacity-70"><!> <span class="text-xs font-medium"> </span></div> <div class="font-mono text-xl font-bold"> </div></div> <div> </div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-xs"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),fn=o('<div class="mt-4 space-y-3"></div>'),mn=o('<div class="space-y-4"><!></div> <!>',1);function pn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1);function v(b){return b.quantity!==null&&b.quantity!==0&&b.unit?.trim()!==""}function y(b){if(i())return;const{value:T,unit:tt}=ze(b.quantity,b.unit);r().forms.purchase.quantity=T,r().forms.purchase.unit=tt,r().forms.purchase.price=b.price,r().forms.purchase.store=b.store||"",r().forms.purchase.who=b.who||"",r().forms.purchase.notes=b.notes||"",r().forms.purchase.status=b.status||null,r().forms.purchase.orderDate=b.orderDate||null,r().forms.purchase.deliveryDate=b.deliveryDate||null,r().startEditPurchase(b),setTimeout(()=>{const mt=document.querySelector("#purchase-form-card");mt?.scrollIntoView({behavior:"smooth",block:"center"}),mt?.querySelector('input[type="number"]')?.focus()},100)}function u(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function U(b){r().removePurchase(b)}function W(b){y(b)}let R=L(()=>r().editingPurchaseId!==null),F=L(()=>t(R)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),dt=L(()=>t(R)?"Enregistrer les modifications":"Ajouter l'achat");var E=mn(),p=ct(E),k=a(p);{var C=b=>{wa(b,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},S=b=>{var T=Gs(),tt=a(T),mt=a(tt),yt=a(mt),nt=s(mt,2),G=a(nt),x=a(G);ya(x,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(q){r().forms.purchase.quantity=q},get unit(){return r().forms.purchase.unit},set unit(q){r().forms.purchase.unit=q}});var $=s(x,2);Fa($,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(q){r().forms.purchase.price=q}});var bt=s($,2);Ae(bt,{get suggestions(){return P.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(q){r().forms.purchase.store=q}});var B=s(bt,2);na(B,{get suggestions(){return P.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(q){r().forms.purchase.who=q}});var rt=s(G,2),z=a(rt);Ee(z,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(q){r().forms.purchase.notes=q}});var lt=s(rt,2);pr(lt,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(q){r().forms.purchase.status=q},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(q){r().forms.purchase.deliveryDate=q}});var at=s(nt,2),ft=a(at);{var X=q=>{var et=Us();et.__click=u,n(q,et)};l(ft,q=>{t(R)&&q(X)})}var h=s(ft,2);h.__click=[Vs,r,v];var A=a(h);{var Q=q=>{var et=Ws();n(q,et)},N=q=>{var et=ae();f(()=>c(et,t(dt))),n(q,et)};l(A,q=>{r().loading?q(Q):q(N,!1)})}f(()=>{St(T,1,`card bg-base-200 ${t(R)?"ring-accent ring-2 ring-offset-2":""}`),c(yt,t(F)),h.disabled=r().loading||!r().isPurchaseFormValid}),n(b,T)};l(k,b=>{i()?b(C):b(S,!1)})}var st=s(p,2);{var Z=b=>{var T=Hs(),tt=a(T);De(tt,{class:"mx-auto mb-2 h-12 w-12"}),n(b,T)},g=b=>{var T=Ot(),tt=ct(T);{var mt=nt=>{var G=en(),x=a(G),$=a(x),bt=a($),B=s(a(bt),8);{var rt=lt=>{var at=Js();n(lt,at)};l(B,lt=>{i()||lt(rt)})}var z=s($);Wt(z,21,()=>r().purchasesList,lt=>lt.$id,(lt,at)=>{var ft=tn(),X=a(ft),h=a(X),A=s(X),Q=a(A),N=s(A),q=a(N),et=s(N),j=a(et),I=a(j),O=s(et),d=a(O),V=s(O),Y=a(V),w=s(V),H=a(w),M=s(w),m=a(M),ut=s(M);{var gt=vt=>{var pt=Zs(),J=a(pt),ot=a(J);ot.__click=[Xs,W,at];var _t=a(ot);be(_t,{class:"h-4 w-4"});var wt=s(ot,2);wt.__click=[Ys,U,at];var kt=a(wt);{var Mt=Ct=>{var Ft=Ks();n(Ct,Ft)},Ut=Ct=>{pa(Ct,{class:"h-4 w-4"})};l(kt,Ct=>{r().loading?Ct(Mt):Ct(Ut,!1)})}f(()=>wt.disabled=r().loading),n(vt,pt)};l(ut,vt=>{i()||vt(gt)})}f((vt,pt,J,ot,_t)=>{c(h,vt),c(Q,t(at).store||"-"),c(q,t(at).who||"-"),St(j,1,`badge badge-sm ${pt??""}`),c(I,J),c(d,ot),c(Y,_t),c(H,t(at).price?`${t(at).price}€`:"-"),c(m,t(at).notes||"-")},[()=>_a(t(at).quantity,t(at).unit),()=>la(t(at).status).class,()=>la(t(at).status).text,()=>da(t(at).orderDate),()=>da(t(at).deliveryDate)]),n(lt,ft)}),n(nt,G)},yt=nt=>{var G=fn();Wt(G,21,()=>r().purchasesList,x=>x.$id,(x,$)=>{var bt=_n(),B=a(bt),rt=a(B),z=a(rt),lt=a(z),at=a(lt);Sr(at,{class:"h-3.5 w-3.5"});var ft=s(at,2),X=a(ft),h=s(lt,2),A=a(h),Q=s(z,2),N=a(Q),q=s(Q,2);{var et=J=>{var ot=sn();ot.__click=[an,U,$];var _t=a(ot);{var wt=Mt=>{var Ut=rn();n(Mt,Ut)},kt=Mt=>{Pr(Mt,{size:16})};l(_t,Mt=>{r().loading?Mt(wt):Mt(kt,!1)})}f(()=>ot.disabled=r().loading),n(J,ot)};l(q,J=>{i()||J(et)})}var j=s(rt,2),I=a(j);{var O=J=>{var ot=nn(),_t=a(ot);Fe(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(Mt=>c(kt,`Commande: ${Mt??""}`),[()=>da(t($).orderDate)]),n(J,ot)};l(I,J=>{t($).orderDate&&J(O)})}var d=s(I,2);{var V=J=>{var ot=on(),_t=a(ot);Fe(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(Mt=>c(kt,`Livraison: ${Mt??""}`),[()=>da(t($).deliveryDate)]),n(J,ot)};l(d,J=>{t($).deliveryDate&&J(V)})}var Y=s(j,2);{var w=J=>{var ot=ln(),_t=a(ot);f(()=>c(_t,t($).notes)),n(J,ot)};l(Y,J=>{t($).notes&&J(w)})}var H=s(Y,2),M=a(H);{var m=J=>{var ot=dn(),_t=a(ot);ue(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(()=>c(kt,t($).store)),n(J,ot)};l(M,J=>{t($).store&&J(m)})}var ut=s(M,2);{var gt=J=>{var ot=vn(),_t=a(ot);sa(_t,{class:"h-3 w-3"});var wt=s(_t,2),kt=a(wt);f(()=>c(kt,t($).who)),n(J,ot)};l(ut,J=>{t($).who&&J(gt)})}var vt=s(H,2);{var pt=J=>{var ot=un(),_t=a(ot);_t.__click=[cn,W,$];var wt=a(_t);be(wt,{size:16,class:"mr-1"}),n(J,ot)};l(vt,J=>{i()||J(pt)})}f((J,ot,_t)=>{c(X,J),c(A,t($).price?`${t($).price} €`:"-"),St(Q,1,`badge badge-sm ${ot??""}`),c(N,_t)},[()=>_a(t($).quantity,t($).unit),()=>la(t($).status).class,()=>la(t($).status).text]),n(x,bt)}),n(nt,G)};l(tt,nt=>{Kt.isMobile?nt(yt,!1):nt(mt)},!0)}n(b,T)};l(st,b=>{r().purchasesList.length===0?b(Z):b(g,!1)})}n(_,E),Lt()}Zt(["click"]);async function gn(_,e,r){await e()?.setStock(),D(r,!1)}async function bn(_,e){await e()?.removeStock()}function hn(_,e,r){if(!e().stockParsed)return;const{value:i,unit:v}=ze(e().stockParsed.quantity,e().stockParsed.unit);e().forms.stock.quantity=i,e().forms.stock.unit=v,e().forms.stock.notes=e().stockParsed.notes??"",e().forms.stock.dateTime=e().stockParsed.dateTime,D(r,!0)}function xn(_,e,r){D(e,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var yn=o(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),wn=o('<button class="btn btn-ghost btn-sm">Annuler</button>'),kn=(_,e)=>{e().forms.stock.quantity=null,e().forms.stock.notes=""},Sn=o('<span class="loading loading-spinner loading-xs"></span>'),Pn=o('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Mn=o('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),Cn=o('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),qn=o('<span class="loading loading-spinner loading-xs"></span>'),Dn=o('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),Tn=o('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),In=o('<div class="space-y-4"><!></div> <!>',1);function $n(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1),v=ht(!1);var y=In(),u=ct(y),U=a(u);{var W=p=>{wa(p,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},R=p=>{var k=Ot(),C=ct(k);{var S=st=>{var Z=Pn(),g=a(Z),b=a(g),T=a(b),tt=s(b,2),mt=a(tt);fr(mt,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(X,h)=>{var A=yn();n(X,A)},$$slots:{default:!0}});var yt=s(tt,2),nt=a(yt);ya(nt,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(X){r().forms.stock.quantity=X},get unit(){return r().forms.stock.unit},set unit(X){r().forms.stock.unit=X}});var G=s(yt,2),x=a(G);Ee(x,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(X){r().forms.stock.notes=X}});var $=s(G,2),bt=a($);{var B=X=>{var h=wn();h.__click=[xn,v,r],f(()=>h.disabled=r().loading),n(X,h)};l(bt,X=>{t(v)&&X(B)})}var rt=s(bt,2);rt.__click=[kn,r];var z=s(rt,2);z.__click=[gn,r,v];var lt=a(z);{var at=X=>{var h=Sn();n(X,h)},ft=X=>{var h=ae();f(()=>c(h,t(v)?"Enregistrer les modifications":"Déclarer le stock")),n(X,h)};l(lt,X=>{r().loading?X(at):X(ft,!1)})}f(X=>{St(Z,1,`card bg-base-200 ${t(v)?"ring-accent ring-2 ring-offset-2":""}`),c(T,X),St(rt,1,`btn btn-ghost btn-sm ${t(v)?"hidden":""}`),rt.disabled=r().loading,z.disabled=r().loading||!r().forms.stock.quantity},[()=>t(v)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),n(st,Z)};l(C,st=>{(!r().stockParsed||t(v))&&st(S)})}n(p,k)};l(U,p=>{i()?p(W):p(R,!1)})}var F=s(u,2);{var dt=p=>{var k=Mn(),C=a(k);tr(C,{class:"mx-auto mb-2 h-12 w-12"}),n(p,k)},E=p=>{var k=Ot(),C=ct(k);{var S=st=>{var Z=Tn(),g=a(Z),b=a(g),T=s(a(b),2),tt=a(T),mt=s(T,2),yt=s(a(mt),2),nt=a(yt),G=s(mt,2);{var x=B=>{var rt=Cn(),z=s(a(rt),2),lt=a(z);f(()=>c(lt,r().stockParsed.notes)),n(B,rt)};l(G,B=>{r().stockParsed.notes&&B(x)})}var $=s(b,2);{var bt=B=>{var rt=Dn(),z=a(rt);z.__click=[bn,r];var lt=a(z);{var at=A=>{var Q=qn();n(A,Q)},ft=A=>{var Q=ae("Supprimer le stock");n(A,Q)};l(lt,A=>{r().loading?A(at):A(ft,!1)})}var X=s(z,2);X.__click=[hn,r,v];var h=a(X);be(h,{class:"mr-1 h-4 w-4"}),f(()=>{z.disabled=r().loading,X.disabled=r().loading}),n(B,rt)};l($,B=>{i()||B(bt)})}f(B=>{c(tt,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),c(nt,B)},[()=>Be(r().stockParsed.dateTime)]),n(st,Z)};l(C,st=>{t(v)||st(S)})}n(p,k)};l(F,p=>{r().stockParsed?p(E,!1):p(dt)})}n(_,y),Lt()}Zt(["click"]);var An=(_,e)=>{_.key==="Enter"&&(_.preventDefault(),e())},En=o('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),On=o('<div class="space-y-4"><!></div>');function Nn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1),v=ht("");const y=L(()=>{const k=P.uniqueWho,C=new Set([...k,...r().forms.who]);return Array.from(C).map(S=>({id:S,label:S,selected:r().forms.who.includes(S)}))});function u(k){const C=k.trim();C&&!r().forms.who.includes(C)&&(r().forms.who=[...r().forms.who,C])}function U(k){r().forms.who=r().forms.who.filter(C=>C!==k)}function W(k){r().forms.who.includes(k)?U(k):u(k)}function R(){t(v).trim()&&(u(t(v)),D(v,""))}var F=On(),dt=a(F);{var E=k=>{wa(k,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},p=k=>{var C=En(),S=a(C),st=s(a(S),4),Z=a(st),g=a(Z),b=a(g);sa(b,{class:"h-4 w-4 opacity-50"});var T=s(b,2);T.__keydown=[An,R];var tt=s(g,2);tt.__click=R;var mt=a(tt);er(mt,{size:16});var yt=s(Z,2),nt=s(a(yt),2);Le(nt,{get items(){return t(y)},onToggleItem:W,size:"sm",color:"info"}),f(G=>{T.disabled=r().loading,tt.disabled=G},[()=>r().loading||!t(v).trim()]),_e(T,()=>t(v),G=>D(v,G)),n(k,C)};l(dt,k=>{i()?k(E):k(p,!1)})}n(_,F),Lt()}Zt(["keydown","click"]);var zn=(_,e)=>{e().forms.store.name="",e().forms.store.comment=""},jn=o(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),Fn=o('<div class="space-y-4"><!></div>');function Bn(_,e){Bt(e,!0);let r=Pt(e,"modalState",7),i=Pt(e,"isArchiveMode",3,!1);const v=L(()=>r()?.hasChanges?.store||!1);async function y(){if(!t(v))return;const F={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(F)}var u=Fn(),U=a(u);{var W=F=>{{let dt=L(()=>r().product?.storeInfo);wa(F,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return t(dt)},dataLabel:"Magasin actuel"})}},R=F=>{var dt=jn(),E=a(dt),p=s(a(E),4),k=a(p),C=a(k);Ae(C,{get suggestions(){return P.uniqueStores},get disabled(){return r().loading},onkeydown:g=>{g.key==="Enter"&&y()},get value(){return r().forms.store.name},set value(g){r().forms.store.name=g}});var S=s(k,2);Ee(S,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(g){r().forms.store.comment=g}});var st=s(p,2),Z=a(st);Z.__click=[zn,r],f(()=>Z.disabled=r().loading),n(F,dt)};l(U,F=>{i()?F(W):F(R,!1)})}n(_,u),Lt()}Zt(["click"]);var Ln=o('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function Rn(_,e){Bt(e,!0);let r=Pt(e,"value",15);Pt(e,"disabled",3,!1);var i=Ln(),v=a(i);Mr(v,{size:20,class:"text-base-centent/70"});var y=s(v,2);_e(y,r),n(_,i),Lt()}async function Qn(_,e,r,i,v){if(!e())return;const{q:y,u}=vr(t(r),t(i)),U=e().product?.totalNeededOverrideParsed?.totalOverride,W=e().product?.totalNeededOverrideParsed?.comment||"";if(y!==U?.q||u!==U?.u||t(v)!==W){const F={totalOverride:{q:y,u},comment:t(v),totalComputedWhenOverride:e().product.totalNeededArray,platesNbWhenOverride:e().product.totalAssiettes,recipesNbWhenOverride:e().product.nbRecipes};await e().setOverride(F)}e().uiStates.overrideManagerEditMode=!1}async function Vn(_,e){e()&&(await e().removeOverride(),e().uiStates.overrideManagerEditMode=!1)}var Un=o(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),Wn=o('<span class="loading loading-spinner loading-sm"></span>'),Gn=o('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),Hn=(_,e)=>e().uiStates.overrideManagerEditMode=!0,Jn=o('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),Xn=o('<div class="chat-bubble relative text-sm"> <!></div>'),Yn=o('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),Kn=(_,e)=>e().uiStates.overrideManagerEditMode=!0,Zn=o('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),to=o('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/60 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/60 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function eo(_,e){Bt(e,!0);let r=Pt(e,"modalState",7);const i=L(()=>r().product?.totalNeededOverrideParsed),v=L(()=>r().product?.displayTotalOverride),y=L(()=>r().product?cr(r().product):null);let u=L(()=>r().uiStates.overrideManagerEditMode),U=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),W=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function R(){if(!t(U)||!t(W))return{quantity:0,unit:""};const{q:st,u:Z}=vr(t(U),t(W));return{quantity:Jr(st,Z),unit:Z}}let F=ht(Ht(R().quantity)),dt=ht(Ht(R().unit)),E=ht(Ht(r().product?.totalNeededOverrideParsed?.comment||""));he(()=>{if(t(u)){const st=R();D(F,st.quantity,!0),D(dt,st.unit,!0),D(E,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let p=L(()=>t(F)>0&&t(dt).trim()!=="");var k=Ot(),C=ct(k);{var S=st=>{var Z=to(),g=a(Z);{var b=at=>{var ft=Un(),X=a(ft);ar(X,{size:18});var h=s(X,2),A=s(a(h),2),Q=a(A),N=a(Q),q=s(a(N)),et=a(q),j=s(q,2),I=a(j),O=s(Q,2),d=a(O),V=s(a(d)),Y=a(V),w=s(V,2),H=a(w),M=s(O,2),m=a(M),ut=a(m);f((gt,vt)=>{c(et,`${t(y).details.oldPlates??""} couverts,
                  ${t(y).details.oldRecipes??""} recettes`),c(I,gt),c(Y,`${t(y).details.newPlates??""} couverts,
                  ${t(y).details.newRecipes??""} recettes`),c(H,vt),c(ut,`Votre override : ${t(v)??""}`)},[()=>Ha(t(y).details.oldComputed),()=>Ha(t(y).details.newComputed)]),n(at,ft)};l(g,at=>{t(y)?.hasMismatch&&t(y)?.details&&at(b)})}var T=s(g,2),tt=s(a(T),2),mt=a(tt),yt=a(mt),nt=s(yt);ga(nt,{class:"h-3 w-3"});var G=s(mt,2),x=a(G),$=s(x);$a($,{class:"h-3 w-3"});var bt=s(G,2),B=a(bt),rt=s(T,2);{var z=at=>{var ft=Gn(),X=s(a(ft),2);ya(X,{get quantity(){return t(F)},set quantity(I){D(F,I,!0)},get unit(){return t(dt)},set unit(I){D(dt,I,!0)}});var h=s(X,2);Rn(h,{get value(){return t(E)},set value(I){D(E,I,!0)}});var A=s(h,2),Q=a(A);Q.__click=[Vn,r];var N=s(Q,2);N.__click=[Qn,r,F,dt,E];var q=a(N);{var et=I=>{var O=Wn();n(I,O)},j=I=>{var O=ae("✓");n(I,O)};l(q,I=>{r().loading?I(et):I(j,!1)})}f(()=>N.disabled=r().loading||!t(p)),za(1,ft,()=>mr),n(at,ft)},lt=at=>{var ft=Ot(),X=ct(ft);{var h=Q=>{var N=Yn(),q=a(N),et=s(a(q),2);{var j=w=>{var H=Jn();H.__click=[Hn,r];var M=a(H);Cr(M,{size:16}),n(w,H)};l(et,w=>{e.isArchiveMode||w(j)})}var I=s(et,2);{var O=w=>{var H=Xn(),M=a(H),m=s(M);qr(m,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),f(()=>c(M,`${t(i).comment??""} `)),n(w,H)};l(I,w=>{t(i).comment&&w(O)})}var d=s(q,2),V=a(d),Y=a(V);f(()=>c(Y,t(v))),n(Q,N)},A=Q=>{var N=Ot(),q=ct(N);{var et=j=>{var I=Zn(),O=a(I);O.__click=[Kn,r];var d=s(a(O));be(d,{size:16}),n(j,I)};l(q,j=>{e.isArchiveMode||j(et)},!0)}n(Q,N)};l(X,Q=>{t(v)&&t(i)?Q(h):Q(A,!1)})}n(at,ft)};l(rt,at=>{t(u)?at(z):at(lt,!1)})}f(()=>{c(yt,`${r().product.nbRecipes??""} `),c(x,`${r().product.totalAssiettes??""} `),c(B,r().product.displayTotalNeeded)}),n(st,Z)};l(C,st=>{r().product&&st(S)})}n(_,k),Lt()}Zt(["click"]);var ao=o('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),ro=o('<span class="text-base-content/70"> </span>'),so=o('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),no=o('<div class="mt-4 space-y-3"></div>'),oo=o('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function io(_,e){Bt(e,!0);const r=L(()=>e.modalState.recipes);function i(E,p){return!E||!p?"-":_a(E,p)}var v=oo(),y=ct(v);eo(y,{get modalState(){return e.modalState},get isArchiveMode(){return e.isArchiveMode}});var u=s(y,2),U=s(a(u),2),W=a(U);ga(W,{class:"h-5 w-5"});var R=s(U,2);{var F=E=>{var p=ao(),k=a(p);Ta(k,{class:"mx-auto mb-2 h-12 w-12"}),n(E,p)},dt=E=>{var p=no();Wt(p,21,()=>t(r),Pe,(k,C)=>{const S=L(()=>i(t(C).q,t(C).u)),st=L(()=>i(t(C).qEq,t(C).uEq));var Z=so(),g=a(Z),b=a(g),T=a(b),tt=a(T),mt=a(tt),yt=s(tt,2),nt=a(yt),G=s(nt);{var x=h=>{Aa(h,{class:"h-4 w-4 text-amber-500"})},$=h=>{var A=Ot(),Q=ct(A);{var N=et=>{Ea(et,{class:"h-4 w-4 text-indigo-500"})},q=et=>{var j=Ot(),I=ct(j);{var O=d=>{Oa(d,{class:"h-4 w-4 text-sky-500"})};l(I,d=>{Te(t(C).dateTimeService)==="cloud"&&d(O)},!0)}n(et,j)};l(Q,et=>{Te(t(C).dateTimeService)==="moon"?et(N):et(q,!1)},!0)}n(h,A)};l(G,h=>{Te(t(C).dateTimeService)==="sun"?h(x):h($,!1)})}var bt=s(T,2),B=a(bt),rt=a(B);$a(rt,{class:"h-3 w-3"});var z=s(rt),lt=s(B,2),at=a(lt),ft=s(lt,2);{var X=h=>{var A=ro(),Q=a(A);f(N=>c(Q,`(${N??""})`),[()=>i(t(C).q,t(C).u)]),n(h,A)};l(ft,h=>{t(S)!==t(st)&&h(X)})}f((h,A,Q)=>{c(mt,t(C).r),c(nt,`${h??""} - ${A??""} `),c(z,` ${(t(C).a||0)??""} c.`),c(at,Q)},[()=>ye(t(C).date),()=>ss(t(C).date),()=>i(t(C).qEq,t(C).uEq)]),n(k,Z)}),n(E,p)};l(R,E=>{t(r).length===0?E(F):E(dt,!1)})}n(_,v),Lt()}function lo(_,e,r){t(e)?.saveAllChanges().then(()=>{t(e)?.resetForms(),r.onClose()})}var vo=o('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),co=(_,e)=>e("recettes"),uo=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),_o=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),fo=(_,e)=>e("magasins"),mo=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),po=(_,e)=>e("volontaires"),go=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),bo=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),ho=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),xo=(_,e)=>e("stock"),yo=o('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),wo=o('<span class="badge badge-sm badge-secondary ml-1">1</span>'),ko=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),So=(_,e)=>e("achats"),Po=o('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Mo=o('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Co=o('<div class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),qo=o("<!> <div><!></div>",1),Do=o('<span class="loading loading-spinner loading-sm"></span>'),To=o("<!> Tout enregistrer",1),Io=o('<button class="btn btn-primary"><!></button>'),$o=o('<button class="btn btn-ghost"> </button> <!>',1),Ao=o('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Eo(_,e){Bt(e,!0);let r=Pt(e,"initialTab",3,"recettes"),i=ht(null);he(()=>{D(i,new Ns(e.productId,r()),!0)});let v=L(()=>P.isEventPassed),y=L(()=>t(i)===null||t(i).product===null);function u(R){t(i)?.setCurrentTab(R)}function U(){t(i)?.resetForms(),e.onClose()}let W=L(()=>t(i)?.hasAnyChanges??!1);{let R=L(()=>!!e.productId);Ie(_,{get isOpen(){return t(R)},onClose:U,get hasUnsavedChanges(){return t(W)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(F,dt)=>{var E=Ot(),p=ct(E);{var k=S=>{Me(S,{title:"Chargement...",showBackButton:!0,onClose:U})},C=S=>{var st=Ao(),Z=ct(st);{var g=w=>{var H=vo(),M=a(H);Za(M,{class:"h-4 w-4"}),n(w,H)};l(Z,w=>{t(v)&&w(g)})}var b=s(Z,2);{let w=L(()=>t(i)?.product?.productName||"Produit");Me(b,{get title(){return t(w)},showBackButton:!0,onClose:U})}var T=s(b,2),tt=a(T),mt=a(tt);mt.__click=[co,u];var yt=a(mt);ga(yt,{class:"mr-1 h-4 w-4"});var nt=s(yt,4);{var G=w=>{var H=uo(),M=a(H);f(()=>c(M,t(i).product.nbRecipes)),n(w,H)},x=w=>{var H=_o();n(w,H)};l(nt,w=>{t(i)?.product?.nbRecipes&&t(i).product.nbRecipes>0?w(G):w(x,!1)})}var $=s(mt,2);$.__click=[fo,u];var bt=a($);ue(bt,{class:"mr-1 h-4 w-4"});var B=s(bt,4);{var rt=w=>{var H=mo();n(w,H)};l(B,w=>{t(i)?.hasChanges?.store&&w(rt)})}var z=s($,2);z.__click=[po,u];var lt=a(z);ca(lt,{class:"mr-1 h-4 w-4"});var at=s(lt,4);{var ft=w=>{var H=go();n(w,H)},X=w=>{var H=Ot(),M=ct(H);{var m=gt=>{var vt=bo(),pt=a(vt);f(()=>c(pt,t(i).product.who.length)),n(gt,vt)},ut=gt=>{var vt=ho();n(gt,vt)};l(M,gt=>{t(i)?.product?.who&&t(i).product.who.length>0?gt(m):gt(ut,!1)},!0)}n(w,H)};l(at,w=>{t(i)?.hasChanges?.who?w(ft):w(X,!1)})}var h=s(z,2);h.__click=[xo,u];var A=a(h);tr(A,{class:"mr-1 h-4 w-4"});var Q=s(A,4);{var N=w=>{var H=yo();n(w,H)},q=w=>{var H=Ot(),M=ct(H);{var m=gt=>{var vt=wo();n(gt,vt)},ut=gt=>{var vt=ko();n(gt,vt)};l(M,gt=>{t(i)?.stockParsed?gt(m):gt(ut,!1)},!0)}n(w,H)};l(Q,w=>{t(i)?.hasChanges?.stock?w(N):w(q,!1)})}var et=s(h,2);et.__click=[So,u];var j=a(et);De(j,{class:"mr-1 h-4 w-4"});var I=s(j,4);{var O=w=>{var H=Po(),M=a(H);f(()=>c(M,t(i).purchasesList.length)),n(w,H)},d=w=>{var H=Mo();n(w,H)};l(I,w=>{t(i)?.purchasesList&&t(i).purchasesList.length>0?w(O):w(d,!1)})}var V=s(T,2);$e(V,{children:(w,H)=>{var M=qo(),m=ct(M);{var ut=pt=>{var J=Co(),ot=a(J);pa(ot,{class:"h-4 w-4"});var _t=s(ot,2),wt=a(_t);f(()=>c(wt,`Erreur : ${t(i).error??""}`)),n(pt,J)};l(m,pt=>{t(i)?.error&&pt(ut)})}var gt=s(m,2),vt=a(gt);Xr(vt,()=>t(i)?.currentTab,pt=>{var J=Ot(),ot=ct(J);{var _t=kt=>{io(kt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},wt=kt=>{var Mt=Ot(),Ut=ct(Mt);{var Ct=Nt=>{pn(Nt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},Ft=Nt=>{var oe=Ot(),re=ct(oe);{var le=te=>{$n(te,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},ie=te=>{var de=Ot(),fe=ct(de);{var zt=It=>{Nn(It,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})},Et=It=>{var Gt=Ot(),Jt=ct(Gt);{var se=Xt=>{Bn(Xt,{get modalState(){return t(i)},get isArchiveMode(){return t(v)}})};l(Jt,Xt=>{t(i)?.currentTab==="magasins"&&Xt(se)},!0)}n(It,Gt)};l(fe,It=>{t(i)?.currentTab==="volontaires"?It(zt):It(Et,!1)},!0)}n(te,de)};l(re,te=>{t(i)?.currentTab==="stock"?te(le):te(ie,!1)},!0)}n(Nt,oe)};l(Ut,Nt=>{t(i)?.currentTab==="achats"?Nt(Ct):Nt(Ft,!1)},!0)}n(kt,Mt)};l(ot,kt=>{t(i)?.currentTab==="recettes"?kt(_t):kt(wt,!1)})}n(pt,J)}),n(w,M)}});var Y=s(V,2);xa(Y,{children:(w,H)=>{var M=$o(),m=ct(M);m.__click=U;var ut=a(m),gt=s(m,2);{var vt=pt=>{var J=Io();J.__click=[lo,i,e];var ot=a(J);{var _t=kt=>{var Mt=Do();n(kt,Mt)},wt=kt=>{var Mt=To(),Ut=ct(Mt);ba(Ut,{class:"h-4 w-4"}),n(kt,Mt)};l(ot,kt=>{t(i).loading?kt(_t):kt(wt,!1)})}f(()=>J.disabled=t(i).loading),n(pt,J)};l(gt,pt=>{t(i)?.hasAnyChanges&&pt(vt)})}f(()=>c(ut,t(i)?.hasAnyChanges?"Annuler":"Fermer")),n(w,M)}}),f(()=>{St(mt,1,`tab ${t(i)?.currentTab==="recettes"?"tab-active":""}`),St($,1,`tab ${t(i)?.currentTab==="magasins"?"tab-active":""}`),St(z,1,`tab ${t(i)?.currentTab==="volontaires"?"tab-active":""}`),St(h,1,`tab ${t(i)?.currentTab==="stock"?"tab-active":""}`),St(et,1,`tab ${t(i)?.currentTab==="achats"?"tab-active":""}`)}),n(S,st)};l(p,S=>{t(y)?S(k):S(C,!1)})}n(F,E)},$$slots:{default:!0}})}Lt()}Zt(["click"]);var Oo=(_,e,r)=>e(r),No=o("<button><span> </span> <!></button>"),zo=o('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),jo=(_,e)=>e.dateStore.selectUpcoming(),Fo=(_,e)=>e.dateStore.selectAll(),Bo=o('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),Lo=o('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function Ro(_,e){Bt(e,!0);let r=L(()=>e.dateStore.start),i=L(()=>e.dateStore.end),v=ht(null);function y(p){t(r)&&new Date(p)<new Date(t(r))?e.dateStore.setRange(p,t(i)):t(i)&&new Date(p)>new Date(t(i))?e.dateStore.setRange(t(r),p):e.dateStore.setRange(p,p)}function u(p){return!t(r)||!t(i)?{start:null,end:null}:t(r)&&new Date(p)<new Date(t(r))?{start:p,end:t(i)}:t(i)&&new Date(p)>new Date(t(i))?{start:t(r),end:p}:{start:p,end:p}}function U(p){let k="";if(!t(r)||!t(i))return;const C=new Date(p)>=new Date(t(r))&&new Date(p)<=new Date(t(i)),S=new Date(p);S.setHours(S.getHours()+Yr);const st=S<new Date;let Z=!1;if(t(v)){const g=u(t(v));g.start&&g.end&&(Z=new Date(p)>=new Date(g.start)&&new Date(p)<=new Date(g.end))}return st&&(k+=" opacity-70 italic"),C||(k+=" btn-dash"),Z&&!C&&(k+=" btn-soft"),k}var W=Lo(),R=ct(W);Wt(R,20,()=>e.dateStore.dates,p=>p,(p,k)=>{var C=No();C.__click=[Oo,y,k];var S=a(C),st=a(S),Z=s(S,2);{var g=T=>{Aa(T,{size:16})},b=T=>{var tt=Ot(),mt=ct(tt);{var yt=G=>{Ea(G,{size:16})},nt=G=>{var x=Ot(),$=ct(x);{var bt=B=>{Oa(B,{size:16})};l($,B=>{Te(k)==="cloud"&&B(bt)},!0)}n(G,x)};l(mt,G=>{Te(k)==="moon"?G(yt):G(nt,!1)},!0)}n(T,tt)};l(Z,T=>{Te(k)==="sun"?T(g):T(b,!1)})}f((T,tt)=>{St(C,1,`btn btn-sm btn-secondary ${T??""}`),c(st,tt)},[()=>U(k),()=>Be(k)]),Tt("mouseenter",C,()=>D(v,k,!0)),Tt("mouseleave",C,()=>D(v,null)),n(p,C)});var F=s(R,2);{var dt=p=>{var k=zo();n(p,k)},E=p=>{var k=Bo(),C=a(k);C.__click=[jo,e];var S=s(C,2);S.__click=[Fo,e],f(()=>{St(C,1,`join-item btn btn-sm ${e.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),St(S,1,`join-item btn btn-sm ${e.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),n(p,k)};l(F,p=>{e.dateStore.isEventPassed?p(dt):p(E,!1)})}n(_,W),Lt()}Zt(["click"]);var Qo=()=>P.clearFilters(),Vo=_=>P.setSearchQuery(_.currentTarget.value),Uo=()=>P.setSearchQuery(""),Wo=()=>P.setCompletionStatus("all"),Go=()=>P.setCompletionStatus("incomplete"),Ho=()=>P.setCompletionStatus("completed"),Jo=()=>P.setGroupBy("none"),Xo=()=>P.setGroupBy("store"),Yo=()=>P.setGroupBy("productType"),Ko=o(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),Zo=o("<!> <!>",1),ti=(_,e)=>P.toggleProductType(e),ei=o("<button><!> </button>"),ai=()=>P.setTemperatureFilter("all"),ri=()=>P.setTemperatureFilter("frais"),si=()=>P.setTemperatureFilter("not-frais"),ni=()=>P.setTemperatureFilter("surgele"),oi=()=>P.setTemperatureFilter("not-surgele"),ii=()=>P.clearTypeAndTemperatureFilters(),li=o('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),di=o('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),vi=o('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),ci=(_,e)=>P.toggleStore(e),ui=o("<button> </button>"),_i=()=>P.clearStoreFilters(),fi=o('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),mi=o('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),pi=(_,e)=>P.toggleWho(e),gi=o("<button> </button>"),bi=()=>P.clearWhoFilters(),hi=o('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),xi=o('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),yi=o('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <div class="flex flex-col"><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!> <!></div>',1);function wi(_,e){Bt(e,!0);const r=L(()=>P.filters),i=L(()=>P.uniqueStores),v=L(()=>P.uniqueWho),y=L(()=>P.uniqueProductTypes);var u=yi(),U=ct(u),W=a(U),R=a(W);Dr(R,{class:"h-5 w-5"});var F=s(W,2);F.__click=[Qo];var dt=a(F);ia(dt,{class:"h-4 w-4"});var E=s(U,2),p=a(E),k=s(a(p),2),C=a(k);Tr(C,{class:"h-4 w-4"});var S=s(C,2);S.__input=[Vo];var st=s(S,2);st.__click=[Uo];var Z=a(st);pa(Z,{class:"h-4 w-4"});var g=s(p,2),b=s(a(g),2),T=a(b);T.__click=[Wo];var tt=s(T,2);tt.__click=[Go];var mt=s(tt,2);mt.__click=[Ho];var yt=s(g,2),nt=s(a(yt),2),G=a(nt);G.__click=[Jo];var x=s(G,2);x.__click=[Xo];var $=s(x,2);$.__click=[Yo];var bt=s(yt,2);{var B=h=>{va(h,{legend:"Date incluses",bgClass:"bg-base-100",children:(A,Q)=>{var N=Zo(),q=ct(N);Ro(q,{get dateStore(){return P.dateStore}});var et=s(q,2);{var j=I=>{var O=Ko();za(3,O,()=>mr),n(I,O)};l(et,I=>{P.hasPastDatesInRange&&I(j)})}n(A,N)},$$slots:{default:!0}})};l(bt,h=>{P.hasSingleDateEvent||h(B)})}var rt=s(bt,2);{var z=h=>{va(h,{legend:"Types & Température",get iconComponent(){return Ir},children:(A,Q)=>{var N=vi(),q=ct(N);Wt(q,20,()=>t(y),vt=>vt,(vt,pt)=>{const J=L(()=>Da(pt));var ot=ei();ot.__click=[ti,pt];var _t=a(ot);ua(_t,()=>t(J).icon,(kt,Mt)=>{Mt(kt,{class:"mr-1 h-5 w-5"})});var wt=s(_t);f(kt=>{St(ot,1,`btn btn-sm ${kt??""}`),c(wt,` ${t(J).displayName??""}`)},[()=>t(r).selectedProductTypes.length===0?"btn-soft btn-secondary":t(r).selectedProductTypes.includes(pt)?"btn-secondary":"btn-dash btn-secondary"]),n(vt,ot)});var et=s(q,2),j=a(et);j.__click=[ai];var I=s(j,2);I.__click=[ri];var O=a(I);Ca(O,{class:"h-4 w-4"});var d=s(I,2);d.__click=[si];var V=a(d);Ca(V,{class:"h-4 w-4"});var Y=s(d,2);Y.__click=[ni];var w=a(Y);qa(w,{class:"h-4 w-4"});var H=s(Y,2);H.__click=[oi];var M=a(H);qa(M,{class:"h-4 w-4"});var m=s(et,2);{var ut=vt=>{var pt=li();pt.__click=[ii];var J=a(pt);ia(J,{size:16}),n(vt,pt)},gt=vt=>{var pt=di();n(vt,pt)};l(m,vt=>{t(r).selectedProductTypes.length>0||t(r).selectedTemperatures.length>0||t(r).temperatureFilter!=="all"?vt(ut):vt(gt,!1)})}f(()=>{St(j,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),St(I,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),St(d,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),St(Y,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),St(H,1,`btn btn-sm flex-1 ${t(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),Tt("mouseenter",j,()=>qt.msg="Ne pas filter en fonction des températures"),Tt("mouseleave",j,()=>qt.reset()),Tt("mouseenter",I,()=>qt.msg="Afficher les produits frais uniquement"),Tt("mouseleave",I,()=>qt.reset()),Tt("mouseenter",d,()=>qt.msg="Exclure les produits frais"),Tt("mouseleave",d,()=>qt.reset()),Tt("mouseenter",Y,()=>qt.msg="Afficher les produits surgelés uniquement"),Tt("mouseleave",Y,()=>qt.reset()),Tt("mouseenter",H,()=>qt.msg="Exclure les produits surgelé"),Tt("mouseleave",H,()=>qt.reset()),n(A,N)},$$slots:{default:!0}})};l(rt,h=>{t(y).length>0&&h(z)})}var lt=s(rt,2);{var at=h=>{va(h,{legend:"Magasins",get iconComponent(){return ue},children:(A,Q)=>{var N=mi(),q=a(N);Wt(q,16,()=>t(i),I=>I,(I,O)=>{var d=ui();d.__click=[ci,O];var V=a(d);f(Y=>{St(d,1,`btn btn-sm ${Y??""}`),c(V,O)},[()=>t(r).selectedStores.length===0?"btn-soft btn-secondary":t(r).selectedStores.includes(O)?"btn-secondary":"btn-dash btn-secondary"]),n(I,d)});var et=s(q,2);{var j=I=>{var O=fi();O.__click=[_i];var d=a(O);ia(d,{size:16}),n(I,O)};l(et,I=>{t(r).selectedStores.length>0&&I(j)})}n(A,N)},$$slots:{default:!0}})};l(lt,h=>{t(i).length>0&&h(at)})}var ft=s(lt,2);{var X=h=>{va(h,{legend:"Qui",get iconComponent(){return sa},children:(A,Q)=>{var N=xi(),q=a(N);Wt(q,16,()=>t(v),I=>I,(I,O)=>{var d=gi();d.__click=[pi,O];var V=a(d);f(Y=>{St(d,1,`btn btn-sm ${Y??""}`),c(V,O)},[()=>t(r).selectedWho.length===0?" btn-soft btn-secondary":t(r).selectedWho.includes(O)?" btn-secondary":"btn-dash btn-secondary"]),n(I,d)});var et=s(q,2);{var j=I=>{var O=hi();O.__click=[bi];var d=a(O);ia(d,{size:16}),n(I,O)};l(et,I=>{t(r).selectedWho.length>0&&I(j)})}n(A,N)},$$slots:{default:!0}})};l(ft,h=>{t(v).length>0&&h(X)})}f(()=>{F.disabled=!P.hasFilters,Kr(S,t(r).searchQuery),st.disabled=!t(r).searchQuery,St(T,1,`btn flex-1 ${t(r).completionStatus==="all"&&"btn-primary"}`),St(tt,1,`btn flex-1 ${t(r).completionStatus==="incomplete"&&"btn-warning"}`),St(mt,1,`btn flex-1 ${t(r).completionStatus==="completed"&&"btn-success"}`),St(G,1,`btn flex-1 ${t(r).groupBy==="none"&&"btn-secondary"}`),St(x,1,`btn flex-1 ${t(r).groupBy==="store"&&"btn-secondary"}`),St($,1,`btn flex-1 ${t(r).groupBy==="productType"&&"btn-secondary"}`)}),n(_,u),Lt()}Zt(["click","input"]);var ki=o('<div class="tooltip text-xs font-normal"><!></div>');function Si(_,e){let r=Pt(e,"iconSize",3,24),i=e.icon||void 0;var v=ki(),y=a(v);{var u=U=>{i(U,{get size(){return r()},class:`align-top
`})};l(y,U=>{e.icon&&U(u)})}f(()=>ha(v,"data-tip",e.tip)),n(_,v)}var Pi=o('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function Ka(_,e){Bt(e,!0);let r=Pt(e,"recipes",19,()=>[]);const i=e.dateDisplayInfo.timeIcon==="sun"?Aa:e.dateDisplayInfo.timeIcon==="moon"?Ea:e.dateDisplayInfo.timeIcon==="cloud"?Oa:null;var v=Pi(),y=a(v),u=a(y),U=a(u),W=s(u,2);{var R=F=>{i(F,{class:"h-3 w-3"})};l(W,F=>{i&&F(R)})}f(F=>{ha(v,"data-tip",F),c(U,e.dateDisplayInfo.formattedDate)},[()=>r().map(F=>F.r).join(", ")]),n(_,v),Lt()}var Mi=ur("<title> </title>"),Ci=ur("<svg><!><use></use></svg>");function qi(_,e){let r=Pt(e,"size",3,24),i=Pt(e,"class",3,""),v=ir(e,["$$slots","$$events","$$legacy","name","size","title","class"]);var y=Ci();or(y,()=>({width:r(),height:r(),class:i(),"aria-hidden":e.title?void 0:"true",...v}));var u=a(y);{var U=R=>{var F=Mi(),dt=a(F);f(()=>c(dt,e.title)),n(R,F)};l(u,R=>{e.title&&R(U)})}var W=s(u);f(()=>ha(W,"href",`/icons/sprite.svg#${e.name??""}`)),n(_,y)}var Di=o('<div class="text-primary-content flex items-center gap-2"><!> </div>'),Ti=o('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),Ii=o('<div class="font-semibold">Sur toute la période</div>'),$i=o('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),Ai=o('le <span class="font-semibold"> </span>',1),Ei=o('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),Oi=o('<span class="font-semibold"> </span>'),Ni=o('le <span class="font-semibold"> </span>',1),zi=o('<div class="text-primary-content"><!></div>'),ji=(_,e,r)=>e.onOpenGroupEditModal("store",t(r).map(i=>i.data.$id),t(r).map(i=>i.data)),Fi=(_,e,r)=>e.onOpenGroupEditModal("who",t(r).map(i=>i.data.$id),t(r).map(i=>i.data)),Bi=(_,e,r)=>e.onOpenGroupPurchaseModal(t(r).map(i=>i.data)),Li=o(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),Ri=o('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),Qi=o('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),Vi=o('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),Ui=(_,e,r)=>e.onOpenModal(t(r).$id,"recettes"),Wi=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"recettes"),Gi=o('<div class="text-base-content/60 text-sm font-normal"> </div>'),Hi=o('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),Ji=o('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),Xi=o('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),Yi=o('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),Ki=o('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),Zi=(_,e,r)=>e.onOpenModal(t(r).$id,"magasins"),tl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"magasins"),el=o('<div class="ml-1"><!></div>'),al=o('<div class="ml-1"> </div> <!>',1),rl=o('<div class="ml-1 text-sm font-medium">?</div>'),sl=(_,e,r)=>e.onOpenModal(t(r).$id,"volontaires"),nl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"volontaires"),ol=o('<span class="text-base-content/50 text-xs"> </span>'),il=o('<div class="ml-1 flex gap-1"> <!></div>'),ll=o('<div class="ml-1 text-sm font-medium">?</div>'),dl=o('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),vl=o('<div class="flex items-center gap-1 text-sm"><!> </div>'),cl=o('<div class="flex items-center gap-1 text-sm"><!> </div>'),ul=o('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),_l=o('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),fl=(_,e,r)=>e.onOpenModal(t(r).$id,"recettes"),ml=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"recettes"),pl=o('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),gl=o("<span> </span>"),bl=o('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),hl=(_,e,r,i)=>{_.stopPropagation(),e.onQuickValidation(t(r),t(i))},xl=o('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),yl=o(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle
                        des besoins: <!> <!></span></div>`),wl=(_,e,r)=>e.onOpenModal(t(r).$id,"achats"),kl=(_,e,r)=>_.key==="Enter"&&e.onOpenModal(t(r).$id,"achats"),Sl=o('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Pl=o('<span class="text-xs opacity-75"> </span>'),Ml=o('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Cl=o('<div class="text-base-content/50 text-xs italic">aucun</div>'),ql=o('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 relative flex flex-1 cursor-pointer flex-wrap items-start justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>'),Dl=o('<!> <div class="space-y-4 sm:space-y-2"></div>',1),Tl=o('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),Il=o('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),$l=o('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),Al=o('<span class="block text-[9pt] font-normal opacity-60"> </span>'),El=o('<div class="font-medium"> </div>'),Ol=o('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),Nl=o('<div class="font-medium"> </div>'),zl=o('<div class="text-[9pt] opacity-70"> </div>'),jl=o('<div class="flex gap-6"><!> <!></div>'),Fl=o('<span class="text-xs opacity-70"> </span>'),Bl=o('<div class="text-nowrap"> </div>'),Ll=o('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),Rl=o('<div class="text-nowrap"> </div>'),Ql=o('<div class="flex flex-col items-end gap-0.5"></div>'),Vl=o('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),Ul=o('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),Wl=o("<span>Aucune recette pour le moment</span>"),Gl=o("<span>Aucun produit trouvé avec les filtres actuels</span>"),Hl=o('<div class="py-8 text-center"><div class="alert alert-info max-md:alert-vertical"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Jl=o('<div></div> <div class="hidden w-full print:block"></div> <!>',1);function Xl(_,e){Bt(e,!0);const r={Package:Ta,MessageCircleQuestionMark:Nr,ShoppingCart:De,Clock:Qa,CircleCheck:Or,CircleX:Er,ClipboardCheck:Ar,PackageCheck:sr,Check:ba};let i=Pt(e,"disabled",3,!1);const v=L(()=>P.groupedFilteredProducts),y=P.filters,u=ye(P.dateStore.start),U=ye(P.dateStore.end),W=L(()=>!P.dateStore.isEventPassed&&!P.dateStore.hasPastDatesInRange),R=L(()=>y.completionStatus==="completed"?"bg-emerald-800":y.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");var F=Jl(),dt=ct(F);Wt(dt,21,()=>Object.entries(t(v)),([C,S])=>C,(C,S)=>{var st=L(()=>fa(t(S),2));let Z=()=>t(st)[0];const b=L(()=>t(st)[1]);var T=Dl(),tt=ct(T);{var mt=nt=>{const G=L(()=>Da(Z()));var x=Vi(),$=a(x),bt=a($);{var B=A=>{var Q=Di(),N=a(Q);ue(N,{class:"size-4 md:size-5"});var q=s(N);f(()=>c(q,` ${Z()??""} (${t(b).length??""})`)),n(A,Q)},rt=A=>{var Q=Ot(),N=ct(Q);{var q=j=>{var I=Ti(),O=a(I);ua(O,()=>t(G).icon,(H,M)=>{M(H,{class:"size-4 md:size-5"})});var d=s(O,2),V=a(d),Y=s(d,2),w=a(Y);f(()=>{c(V,t(G).displayName),c(w,`(${t(b).length??""})`)}),n(j,I)},et=j=>{var I=ae();f(()=>c(I,`📦 ${Z()??""} (${t(b).length??""})`)),n(j,I)};l(N,j=>{y.groupBy==="productType"?j(q):j(et,!1)},!0)}n(A,Q)};l(bt,A=>{y.groupBy==="store"?A(B):A(rt,!1)})}var z=s($,2);{var lt=A=>{var Q=Ei(),N=a(Q);{var q=j=>{var I=Ii();n(j,I)},et=j=>{var I=Ot(),O=ct(I);{var d=Y=>{var w=$i(),H=s(ct(w)),M=a(H),m=s(H,2),ut=a(m);f((gt,vt)=>{c(M,gt),c(ut,vt)},[()=>qe(P.dateStore.start),()=>qe(P.dateStore.end)]),n(Y,w)},V=Y=>{var w=Ai(),H=s(ct(w)),M=a(H);f(m=>c(M,m),[()=>qe(P.dateStore.start)]),n(Y,w)};l(O,Y=>{P.dateStore.start!==P.dateStore.end?Y(d):Y(V,!1)},!0)}n(j,I)};l(N,j=>{P.dateStore.isFullRange&&P.dateStore.start!==P.dateStore.end?j(q):j(et,!1)})}n(A,Q)},at=A=>{var Q=zi(),N=a(Q);{var q=j=>{var I=Oi(),O=a(I);f((d,V)=>c(O,`${d??""} → ${V??""}`),[()=>qe(P.dateStore.start),()=>qe(P.dateStore.end)]),n(j,I)},et=j=>{var I=Ni(),O=s(ct(I)),d=a(O);f(V=>c(d,V),[()=>qe(P.dateStore.start,!0)]),n(j,I)};l(N,j=>{!P.dateStore.isFullRange&&P.dateStore.start!==P.dateStore.end?j(q):j(et,!1)})}n(A,Q)};l(z,A=>{Kt.isMobile?A(at,!1):A(lt)})}var ft=s(z,2);{var X=A=>{var Q=Ri(),N=a(Q);N.__click=[ji,e,b];var q=a(N);ue(q,{size:16});var et=s(q,4);be(et,{size:16});var j=s(N,2);j.__click=[Fi,e,b];var I=a(j);ca(I,{size:16});var O=s(I,4);be(O,{size:16});var d=s(j,2);{var V=Y=>{var w=Li();w.__click=[Bi,e,b];var H=a(w);De(H,{size:16});var M=s(H,4);Va(M,{size:16}),Tt("mouseenter",w,()=>qt.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),Tt("mouseleave",w,()=>qt.reset()),n(Y,w)};l(d,Y=>{t(b).some(w=>w.data.displayMissingQuantity!=="✅ Complet")&&Y(V)})}Tt("mouseenter",N,()=>qt.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),Tt("mouseleave",N,()=>qt.reset()),Tt("mouseenter",j,()=>qt.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),Tt("mouseleave",j,()=>qt.reset()),n(A,Q)},h=A=>{var Q=Ot(),N=ct(Q);{var q=et=>{var j=Qi(),I=a(j),O=a(I);Qa(O,{size:16}),n(et,j)};l(N,et=>{P.dateStore.hasPastDatesInRange&&et(q)},!0)}n(A,Q)};l(ft,A=>{t(W)?A(X):A(h,!1)})}f(()=>St(x,1,`${t(R)??""} @container sticky ${Kt.isMobile?"top-11":"top-16 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md @md:flex-nowrap print:shadow-none`)),n(nt,x)};l(tt,nt=>{Z()!==""&&nt(mt)})}var yt=s(tt,2);Wt(yt,21,()=>t(b),nt=>nt.data.$id,(nt,G)=>{const x=L(()=>t(G).data),$=L(()=>t(G).stats),bt=L(()=>Da(t(x).productType)),B=L(()=>is(t(x).purchases||[])),rt=L(()=>t(x).totalNeededOverrideParsed),z=L(()=>cr(t(x)));var lt=ql(),at=a(lt),ft=a(at),X=a(ft);X.__click=[Ui,e,x],X.__keydown=[Wi,e,x];var h=a(X),A=a(h);ua(A,()=>t(bt).icon,(K,it)=>{it(K,{class:"h-4 w-4"})});var Q=s(A),N=s(Q);{var q=K=>{var it=Gi(),xt=a(it);f(()=>c(xt,`Ancien: ${t(x).previousNames[0]??""}`)),n(K,it)};l(N,K=>{t(x).previousNames&&t(x).previousNames.length>0&&K(q)})}var et=s(N,2);{var j=K=>{var it=Hi(),xt=a(it);Ra(xt,{class:"text-warning h-4 w-4"}),n(K,it)};l(et,K=>{t(x).productHugoUuid||K(j)})}var I=s(h,2),O=a(I);{var d=K=>{var it=Ji(),xt=a(it);Ca(xt,{class:"text-success h-4 w-4"}),n(K,it)};l(O,K=>{t(x).pF&&K(d)})}var V=s(O,2);{var Y=K=>{var it=Xi(),xt=a(it);qa(xt,{class:"text-info h-4 w-4"}),n(K,it)};l(V,K=>{t(x).pS&&K(Y)})}var w=s(I,2);{var H=K=>{var it=Yi(),xt=a(it);rr(xt,{class:"h-4 w-4 animate-spin"}),n(K,it)};l(w,K=>{t(x).status==="isSyncing"&&K(H)})}var M=s(w,2);{var m=K=>{var it=Ki(),xt=a(it);Wt(xt,20,()=>t($).concernedDates,$t=>$t,($t,At)=>{const Qt=L(()=>t($).recipesByDate.get(At)||[]),jt=L(()=>t(G).data.dateDisplayInfo[At]||Ja(At));Ka($t,{get dateDisplayInfo(){return t(jt)},get recipes(){return t(Qt)}})}),n(K,it)};l(M,K=>{!Kt.isMobile&&t($).concernedDates.length>0&&K(m)})}var ut=s(X,2);{var gt=K=>{var it=dl(),xt=a(it);xt.__click=[Zi,e,x],xt.__keydown=[tl,e,x];var $t=a(xt);ue($t,{size:18});var At=s($t,2);{var Qt=ee=>{var pe=al(),oa=ct(pe),ka=a(oa),Sa=s(oa,2);{var xe=ge=>{var ke=el(),Oe=a(ke);Si(Oe,{get tip(){return t(x).storeInfo.storeComment},get icon(){return zr},iconSize:14}),n(ge,ke)};l(Sa,ge=>{t(x).storeInfo?.storeComment&&ge(xe)})}f(()=>c(ka,t(x).storeInfo.storeName)),n(ee,pe)},jt=ee=>{var pe=rl();n(ee,pe)};l(At,ee=>{t(x).storeInfo?.storeName?ee(Qt):ee(jt,!1)})}var Rt=s(xt,2);Rt.__click=[sl,e,x],Rt.__keydown=[nl,e,x];var Vt=a(Rt);ca(Vt,{size:18});var ne=s(Vt,2);{var me=ee=>{var pe=Ot(),oa=ct(pe);{var ka=xe=>{var ge=il(),ke=a(ge),Oe=s(ke);{var Ne=ce=>{var Ba=ol(),gr=a(Ba);f(()=>c(gr,`+${t(x).who.length-2}`)),n(ce,Ba)};l(Oe,ce=>{t(x).who.length>2&&ce(Ne)})}f(ce=>c(ke,`${ce??""}... `),[()=>t(x).who.slice(0,2).map(ce=>ce.slice(0,5)).join(" | ")]),n(xe,ge)},Sa=xe=>{var ge=Ot(),ke=ct(ge);{var Oe=Ne=>{var ce=ae();f(()=>c(ce,t(x).who)),n(Ne,ce)};l(ke,Ne=>{t(x).who.length===1&&Ne(Oe)},!0)}n(xe,ge)};l(oa,xe=>{t(x).who.length>1?xe(ka):xe(Sa,!1)})}n(ee,pe)},Ce=ee=>{var pe=ll();n(ee,pe)};l(ne,ee=>{t(x).who&&t(x).who.length?ee(me):ee(Ce,!1)})}f(()=>{St(xt,1,`btn btn-soft btn-xs sm:btn-sm group relative ${t(x).storeInfo?.storeName?"btn-success":""}`),St(Rt,1,`btn btn-xs sm:btn-sm btn-soft group relative ${t(x).who&&t(x).who?.length>0?"btn-success":""}`)}),Tt("mouseenter",xt,()=>qt.msg="Définissez le magasin où acheter le produit"),Tt("mouseleave",xt,()=>qt.reset()),Tt("mouseenter",Rt,()=>qt.msg="Déclarez qui est responsable de l'achat de ce produit"),Tt("mouseleave",Rt,()=>qt.reset()),n(K,it)},vt=K=>{var it=ul(),xt=a(it);{var $t=jt=>{var Rt=vl(),Vt=a(Rt);ue(Vt,{size:16});var ne=s(Vt);f(()=>c(ne,` ${t(x).storeInfo.storeName??""}`)),n(jt,Rt)};l(xt,jt=>{t(x).storeInfo?.storeName&&jt($t)})}var At=s(xt,2);{var Qt=jt=>{var Rt=cl(),Vt=a(Rt);ca(Vt,{size:16});var ne=s(Vt);f(me=>c(ne,` ${me??""}`),[()=>t(x).who.join(", ")]),n(jt,Rt)};l(At,jt=>{t(x).who&&t(x).who.length>0&&jt(Qt)})}n(K,it)};l(ut,K=>{t(W)?K(gt):K(vt,!1)})}var pt=s(ft,2);{var J=K=>{var it=_l(),xt=a(it);Wt(xt,20,()=>t($).concernedDates,$t=>$t,($t,At)=>{const Qt=L(()=>t($).recipesByDate.get(At)||[]),jt=L(()=>t(G).data.dateDisplayInfo[At]||Ja(At));Ka($t,{get dateDisplayInfo(){return t(jt)},get recipes(){return t(Qt)}})}),n(K,it)};l(pt,K=>{Kt.isMobile&&t($).concernedDates.length>0&&K(J)})}var ot=s(pt,2),_t=a(ot),wt=s(a(_t),2);wt.__click=[fl,e,x],wt.__keydown=[ml,e,x];var kt=a(wt),Mt=a(kt),Ut=a(Mt);{var Ct=K=>{var it=pl(),xt=a(it),$t=a(xt),At=s(xt,2);Ra(At,{class:"h-4 w-4"});var Qt=s(At);f(()=>{c($t,t($).formattedQuantities),c(Qt,` ${t(rt).totalOverride.q??""}
                          ${t(rt).totalOverride.u??""}`)}),n(K,it)},Ft=K=>{var it=gl(),xt=a(it);f(()=>c(xt,t($).formattedQuantities)),n(K,it)};l(Ut,K=>{t(rt)?.totalOverride?K(Ct):K(Ft,!1)})}var Nt=s(Mt,2);{var oe=K=>{var it=bl(),xt=a(it),$t=a(xt),At=s($t);ga(At,{class:"h-3 w-3"});var Qt=s(xt,2),jt=a(Qt),Rt=s(jt);$a(Rt,{class:"h-3 w-3"}),f(()=>{c($t,`${t($).nbRecipes??""} `),c(jt,`${t($).totalAssiettes??""} `)}),n(K,it)};l(Nt,K=>{(t($).nbRecipes||t($).totalAssiettes)&&K(oe)})}var re=s(kt,2);{var le=K=>{var it=xl();it.__click=[hl,e,x,$];var xt=a(it),$t=s(a(xt)),At=s(xt,2),Qt=a(At);qi(Qt,{name:"add-to-cart",size:16}),f(()=>c($t,` ${t($).formattedMissingQuantities??""}`)),Tt("mouseenter",it,()=>qt.msg="Ajouter aux achats effectués"),Tt("mouseleave",it,()=>qt.reset()),n(K,it)},ie=K=>{var it=Ot(),xt=ct(it);{var $t=At=>{Va(At,{size:24,class:"text-success ms-auto"})};l(xt,At=>{t(W)&&At($t)},!0)}n(K,it)};l(re,K=>{t(W)&&t($).hasMissing?K(le):K(ie,!1)})}var te=s(re,2);{var de=K=>{var it=yl(),xt=a(it);ar(xt,{size:18});var $t=s(xt,2),At=s(a($t));{var Qt=Vt=>{var ne=ae();f(()=>c(ne,`${t(z).details?.oldPlates??""}→${t(z).details?.newPlates??""} couverts`)),n(Vt,ne)};l(At,Vt=>{t(z).platesChanged&&Vt(Qt)})}var jt=s(At,2);{var Rt=Vt=>{var ne=ae();f(()=>c(ne,`${t(z).details?.oldRecipes??""}→${t(z).details?.newRecipes??""}
                          recettes`)),n(Vt,ne)};l(jt,Vt=>{t(z).recipesChanged&&Vt(Rt)})}n(K,it)};l(te,K=>{t(W)&&t(z)?.hasMismatch&&K(de)})}var fe=s(_t,2),zt=s(a(fe),2);zt.__click=[wl,e,x],zt.__keydown=[kl,e,x];var Et=a(zt);De(Et,{class:"h-4 w-4 opacity-60"});var It=s(Et,2),Gt=s(It,2),Jt=a(Gt);{var se=K=>{var it=Sl(),xt=a(it),$t=a(xt);$r($t,{class:"text-secondary h-4 w-4"});var At=s($t,2),Qt=a(At),jt=s(xt,2),Rt=a(jt);f(Vt=>{c(Qt,`${t(x).stockParsed.quantity??""}
                            ${t(x).stockParsed.unit??""}`),c(Rt,`stock: ${Vt??""}`)},[()=>Be(t(x).stockParsed.dateTime)]),n(K,it)};l(Jt,K=>{t(x).stockParsed&&K(se)})}var Xt=s(Jt,2);Wt(Xt,17,()=>t(B),Pe,(K,it)=>{const xt=L(()=>r[t(it).icon]);var $t=Ml(),At=a($t),Qt=a(At);ua(Qt,()=>t(xt),(me,Ce)=>{Ce(me,{class:"h-4 w-4"})});var jt=s(Qt,2),Rt=a(jt),Vt=s(At,2);{var ne=me=>{var Ce=Pl(),ee=a(Ce);f(()=>c(ee,`livré le: ${t(it).deliveryDate??""}`)),n(me,Ce)};l(Vt,me=>{t(it).deliveryDate&&me(ne)})}f(()=>{St($t,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${t(it).badgeClass??""}`),c(Rt,`${t(it).quantity??""}
                            ${t(it).unit??""}`)}),n(K,$t)});var ve=s(Xt,2);{var we=K=>{var it=Cl();n(K,it)};l(ve,K=>{t(B).length===0&&!t(x)?.stockParsed&&K(we)})}f(()=>{St(lt,1,`card bg-base-100 ${(Kt.isMobile&&"border-base-300 border shadow")??""} ${t(x).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),c(Q,`${t(x).productName??""} `),St(Mt,1,`text-base font-bold ${t($).hasMissing&&t(W)?"text-error":"text-success"}`),St(It,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${t(W)?"group-hover:block":"hidden"} sm:hidden`)}),Tt("mouseenter",X,()=>qt.msg="Afficher les informations sur ce produit"),Tt("mouseleave",X,()=>qt.reset()),Tt("mouseenter",wt,()=>qt.msg="Afficher les informations sur ce produit"),Tt("mouseleave",wt,()=>qt.reset()),Tt("mouseenter",zt,()=>qt.msg="Déclarez des achats effectués"),Tt("mouseleave",zt,()=>qt.reset()),za(2,lt,()=>ns),n(nt,lt)}),n(C,T)});var E=s(dt,2);Wt(E,21,()=>Object.entries(t(v)),([C,S])=>C,(C,S)=>{var st=L(()=>fa(t(S),2));let Z=()=>t(st)[0],g=()=>t(st)[1];var b=Ul(),T=a(b);{var tt=B=>{var rt=Tl(),z=a(rt),lt=a(z),at=s(lt),ft=a(at),X=s(at,2),h=a(X);{var A=N=>{var q=ae("Toute la période");n(N,q)},Q=N=>{var q=Ot(),et=ct(q);{var j=O=>{var d=ae();f(()=>c(d,`du ${u??""} au ${U??""}`)),n(O,d)},I=O=>{var d=ae();f(()=>c(d,`le ${u??""}`)),n(O,d)};l(et,O=>{P.dateStore.start!==P.dateStore.end?O(j):O(I,!1)},!0)}n(N,q)};l(h,N=>{P.dateStore.isFullRange?N(A):N(Q,!1)})}f(()=>{c(lt,`${(Z()==="Non défini"?"Groupe inconnu":Z())??""} `),c(ft,`(${g().length??""} produits)`)}),n(B,rt)};l(T,B=>{Z()!==""&&B(tt)})}var mt=s(T,2),yt=a(mt),nt=a(yt),G=s(a(nt),3);{var x=B=>{var rt=Il();n(B,rt)},$=B=>{var rt=$l();n(B,rt)};l(G,B=>{y.groupBy==="store"?B(x):B($,!1)})}var bt=s(yt);Wt(bt,21,g,B=>B.data.$id,(B,rt)=>{const z=L(()=>t(rt).data),lt=L(()=>t(rt).stats);var at=Vl(),ft=s(a(at)),X=a(ft),h=s(X);{var A=M=>{var m=Al(),ut=a(m);f(()=>c(ut,`(Ancien: ${t(z).previousNames[0]??""})`)),n(M,m)};l(h,M=>{t(z).previousNames&&t(z).previousNames.length>0&&M(A)})}var Q=s(ft),N=a(Q);{var q=M=>{var m=ae();f(()=>c(m,`${t(z).totalNeededOverrideParsed.totalOverride.q??""}
                  ${t(z).totalNeededOverrideParsed.totalOverride.u??""}`)),n(M,m)},et=M=>{var m=ae();f(()=>c(m,t(lt).formattedQuantities)),n(M,m)};l(N,M=>{t(z).totalNeededOverrideParsed?.totalOverride?M(q):M(et,!1)})}var j=s(Q),I=a(j);{var O=M=>{var m=Ol(),ut=a(m);{var gt=J=>{var ot=El(),_t=a(ot);f(wt=>c(_t,wt),[()=>t(z).who.join(", ")]),n(J,ot)};l(ut,J=>{t(z).who?.length&&J(gt)})}var vt=s(ut,2),pt=a(vt);f(()=>c(pt,t(z).productType||"Autre")),n(M,m)},d=M=>{var m=jl(),ut=a(m);{var gt=J=>{var ot=Nl(),_t=a(ot);f(()=>c(_t,t(z).storeInfo.storeName)),n(J,ot)};l(ut,J=>{t(z).storeInfo?.storeName&&J(gt)})}var vt=s(ut,2);{var pt=J=>{var ot=zl(),_t=a(ot);f(wt=>c(_t,wt),[()=>t(z).who.join(", ")]),n(J,ot)};l(vt,J=>{t(z).who?.length&&J(pt)})}n(M,m)};l(I,M=>{y.groupBy==="store"?M(O):M(d,!1)})}var V=s(j),Y=a(V);{var w=M=>{var m=Ll(),ut=a(m),gt=a(ut),vt=s(gt);{var pt=_t=>{var wt=Fl(),kt=a(wt);f(Mt=>c(kt,`(${Mt??""})`),[()=>Be(t(z).stockParsed.dateTime)]),n(_t,wt)};l(vt,_t=>{t(z).stockParsed?.dateTime&&_t(pt)})}var J=s(ut,2);{var ot=_t=>{var wt=Ot(),kt=ct(wt);Wt(kt,17,()=>t(z).purchases,Pe,(Mt,Ut)=>{var Ct=Bl(),Ft=a(Ct);f(()=>c(Ft,`${t(Ut).quantity??""} ${t(Ut).unit??""}`)),n(Mt,Ct)}),n(_t,wt)};l(J,_t=>{t(z).purchases?.length&&_t(ot)})}f(()=>c(gt,`📦 ${t(z).stockParsed.quantity??""} `)),n(M,m)},H=M=>{var m=Ot(),ut=ct(m);{var gt=vt=>{var pt=Ql();Wt(pt,21,()=>t(z).purchases,Pe,(J,ot)=>{var _t=Rl(),wt=a(_t);f(()=>c(wt,`${t(ot).quantity??""} ${t(ot).unit??""}`)),n(J,_t)}),n(vt,pt)};l(ut,vt=>{t(z).purchases?.length&&vt(gt)},!0)}n(M,m)};l(Y,M=>{t(z).stockParsed?M(w):M(H,!1)})}f(()=>c(X,`${t(z).productName??""} `)),n(B,at)}),n(C,b)});var p=s(E,2);{var k=C=>{var S=Hl(),st=a(S),Z=s(a(st),2);{var g=T=>{var tt=Wl();n(T,tt)},b=T=>{var tt=Gl();n(T,tt)};l(Z,T=>{e.currentEvent&&e.currentEvent.meals&&e.currentEvent.meals.length>0&&e.currentEvent.meals.every(tt=>!tt.recipes||tt.recipes.length===0)?T(g):T(b,!1)})}n(C,S)};l(p,C=>{Object.values(t(v)).flat().length===0&&C(k)})}f(()=>St(dt,1,`space-y-4 rounded-lg print:hidden ${i()?"pointer-events-none opacity-50":""}`)),n(_,F),Lt()}Zt(["click","keydown"]);var Yl=o('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Kl=(_,e)=>D(e,"empty"),Zl=(_,e)=>D(e,"all"),td=o('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),ed=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),ad=o("<!> ",1),rd=o('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),sd=o("<!> <!> <!>",1);function nd(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=ht(null),y=ht(Ht(e.products.length>0&&e.products[0].storeInfo?e.products[0].storeInfo.storeName:"")),u=ht(Ht(e.products.length>0&&e.products[0].storeInfo&&e.products[0].storeInfo.storeComment||"")),U=ht(Ht({})),W=ht("empty");he(()=>{const S={};e.products.forEach(st=>{e.productIds.includes(st.$id)&&(t(W)==="empty"?S[st.$id]=!st.storeInfo||!st.storeInfo.storeName:S[st.$id]=!0)}),D(U,S,!0)});const R=L(()=>e.products.map(S=>({id:S.$id,label:S.productName,title:S.productName,selected:t(U)[S.$id]}))),F=L(()=>t(R).filter(S=>S.selected)),dt=L(()=>`Attribuer un magasin (${t(F).length} produits sélectionnés)`),E=L(()=>t(F).length===0?!1:t(y).trim().length>0);async function p(){if(!t(E)||t(r))return;D(i,null),D(v,null);const S=t(F).map(g=>g.id),st=e.products.filter(g=>S.includes(g.$id));P.setSyncStatus(S,!0),Kt.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${S.length} produits)`,progress:0},e.onClose();const Z={storeName:t(y).trim(),storeComment:t(u).trim()};try{const g=await Na.track(_r(S,st,"store",Z).then(b=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${b.success?"succès":"échec"}, ${b.updatedCount} produits modifiés`),!b.success)throw new Error(b.error||"Erreur lors de la mise à jour");return b}),{loading:`Mise à jour du magasin pour ${S.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});e.onSuccess?.(g)}catch(g){console.error("[StoreEditModal] Erreur mise à jour:",g),P.clearSyncStatus()}finally{D(r,!1),Kt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function k(){t(r)||e.onClose()}function C(S){t(U)[S]=!t(U)[S]}Ie(_,{isOpen:!0,onClose:k,children:(S,st)=>{var Z=sd(),g=ct(Z);Me(g,{get title(){return t(dt)},onClose:k,children:(tt,mt)=>{ue(tt,{class:"text-secondary"})},$$slots:{default:!0}});var b=s(g,2);$e(b,{children:(tt,mt)=>{var yt=td(),nt=a(yt);{var G=h=>{var A=Yl(),Q=a(A);ma(Q,{class:"h-4 w-4"});var N=s(Q,2),q=a(N);f(()=>c(q,t(i))),n(h,A)};l(nt,h=>{t(i)&&h(G)})}var x=s(nt,2),$=a(x),bt=a($);Ae(bt,{get suggestions(){return P.uniqueStores},get disabled(){return t(r)},id:"store-name-input",get value(){return t(y)},set value(h){D(y,h,!0)}});var B=s($,2),rt=a(B);Ee(rt,{get disabled(){return t(r)},id:"store-comment-textarea",get value(){return t(u)},set value(h){D(u,h,!0)}});var z=s(x,2),lt=s(a(z),2),at=a(lt);at.__click=[Kl,W];var ft=s(at,2);ft.__click=[Zl,W];var X=s(lt,2);Le(X,{get items(){return t(R)},onToggleItem:C,size:"sm",color:"success"}),f(()=>{St(at,1,`tab ${t(W)==="empty"?"tab-active":""}`),St(ft,1,`tab ${t(W)==="all"?"tab-active":""}`)}),n(tt,yt)}});var T=s(b,2);xa(T,{children:(tt,mt)=>{var yt=rd(),nt=ct(yt);nt.__click=k;var G=s(nt,2);G.__click=p;var x=a(G);{var $=B=>{var rt=ed();n(B,rt)},bt=B=>{var rt=ad(),z=ct(rt);ba(z,{class:"h-4 w-4"});var lt=s(z);f(()=>c(lt,` Appliquer à ${t(F).length??""} produit(s)`)),n(B,rt)};l(x,B=>{t(r)?B($):B(bt,!1)})}f(()=>{nt.disabled=t(r),G.disabled=t(r)||!t(E)}),n(tt,yt)}}),n(S,Z)},$$slots:{default:!0}}),Lt()}Zt(["click"]);var od=o('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),id=(_,e)=>D(e,"empty"),ld=(_,e)=>D(e,"all"),dd=o(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),vd=o('<span class="loading loading-spinner loading-sm"></span> En cours...',1),cd=o("<!> ",1),ud=o('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),_d=o("<!> <!> <!>",1);function fd(_,e){Bt(e,!0);let r=ht(!1),i=ht(null),v=ht(Ht([])),y=ht(""),u=ht("empty"),U=ht(Ht({}));he(()=>{const g={};e.products.forEach(b=>{e.productIds.includes(b.$id)&&(t(u)==="empty"?g[b.$id]=!b.who||b.who.length===0:g[b.$id]=!0)}),D(U,g,!0)});const W=L(()=>e.products.map(g=>({id:g.$id,label:g.productName,title:g.productName,selected:t(U)[g.$id]}))),R=L(()=>t(W).filter(g=>g.selected)),F=L(()=>{const g=new Set([...P.uniqueWho,...t(v)]);return Array.from(g).map(b=>({id:b,label:b,selected:t(v).includes(b)}))}),dt=L(()=>`Gérer les volontaires (${t(R).length} produit${t(R).length>1?"s":""})`),E=L(()=>t(R).length===0?!1:t(v).length>0);async function p(){if(!t(E)||t(r))return;D(i,null);const g=t(R).map(T=>T.id),b=e.products.filter(T=>g.includes(T.$id));P.setSyncStatus(g,!0),Kt.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${g.length} produits)`,progress:0},e.onClose();try{await Na.track(_r(g,b,"who",{names:t(v)}).then(T=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${T.success?"succès":"échec"}, ${T.updatedCount} produits modifiés`),!T.success)throw new Error(T.error||"Erreur lors de la mise à jour");return P.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),e.onSuccess?.(T),T}),{loading:`Mise à jour des mandatés pour ${g.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(T){console.error("[WhoEditModal] Erreur mise à jour:",T),P.clearSyncStatus()}finally{D(r,!1),Kt.backgroundOperation={isRunning:!1,name:"",progress:0}}}function k(g){const b=g.trim();b&&!t(v).includes(b)&&D(v,[...t(v),b],!0)}function C(g){D(v,t(v).filter(b=>b!==g),!0)}function S(g){t(v).includes(g)?C(g):k(g)}function st(){t(y).trim()&&(k(t(y)),D(y,""))}function Z(g){t(U)[g]=!t(U)[g]}Ie(_,{isOpen:!0,get onClose(){return e.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(g,b)=>{var T=_d(),tt=ct(T);Me(tt,{get title(){return t(dt)},showBackButton:!0,get onClose(){return e.onClose}});var mt=s(tt,2);$e(mt,{children:(nt,G)=>{var x=dd(),$=a(x);{var bt=O=>{var d=od(),V=a(d);ma(V,{class:"h-4 w-4"});var Y=s(V,2),w=a(Y);f(()=>c(w,t(i))),n(O,d)};l($,O=>{t(i)&&O(bt)})}var B=s($,2),rt=s(a(B),2),z=a(rt),lt=a(z);na(lt,{get disabled(){return t(r)},onkeydown:O=>{O.key==="Enter"&&(O.preventDefault(),st())},get value(){return t(y)},set value(O){D(y,O,!0)}});var at=s(z,2);at.__click=st;var ft=a(at);er(ft,{size:16});var X=s(rt,2),h=a(X),A=s(h,2);Le(A,{get items(){return t(F)},onToggleItem:S,size:"lg",color:"info"});var Q=s(B,2),N=a(Q),q=s(a(N),2),et=a(q);et.__click=[id,u];var j=s(et,2);j.__click=[ld,u];var I=s(N,2);Le(I,{get items(){return t(W)},onToggleItem:Z,size:"sm",color:"success"}),f(O=>{at.disabled=O,St(h,1,`text-base-content/70 mb-2 hidden text-sm ${(t(F).length&&"inline")??""}`),St(et,1,`btn btn-sm ${t(u)==="empty"&&"btn-secondary"}`),St(j,1,`btn btn-sm ${t(u)==="all"&&"btn-secondary"}`)},[()=>t(r)||!t(y).trim()]),n(nt,x)}});var yt=s(mt,2);xa(yt,{children:(nt,G)=>{var x=ud(),$=ct(x);$.__click=function(...lt){e.onClose?.apply(this,lt)};var bt=s($,2);bt.__click=p;var B=a(bt);{var rt=lt=>{var at=vd();n(lt,at)},z=lt=>{var at=cd(),ft=ct(at);ba(ft,{class:"h-4 w-4"});var X=s(ft);f(()=>c(X,` Appliquer à ${t(R).length??""} produit${t(R).length>1?"s":""}`)),n(lt,at)};l(B,lt=>{t(r)?lt(rt):lt(z,!1)})}f(()=>{$.disabled=t(r),bt.disabled=t(r)||!t(E)}),n(nt,x)}}),n(g,T)},$$slots:{default:!0}}),Lt()}Zt(["click"]);async function md(_,e,r,i,v,y){if(!t(e).invoiceTotal||t(e).invoiceTotal<=0){D(r,"Le montant doit être supérieur à 0");return}D(i,!0),D(r,null);try{const u=P.currentMainId;if(!u)throw new Error("Aucun événement principal actif");t(v)?await dr(t(v),{price:t(e).invoiceTotal,invoiceTotal:t(e).invoiceTotal,store:t(e).store,notes:t(e).notes,who:t(e).who}):await Zr(u,void 0,t(e).invoiceTotal,t(e).store,t(e).notes,t(e).who),y()}catch(u){console.error("Erreur sauvegarde dépense:",u),D(r,u.message,!0)}finally{D(i,!1)}}var pd=o('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),gd=o('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),bd=(_,e)=>D(e,!0),hd=o('<button class="btn btn-primary btn-sm"><!> Ajouter une dépense</button>'),xd=o('<span class="loading loading-spinner loading-xs"></span>'),yd=o('<div class="text-error mt-2 text-xs"> </div>'),wd=o('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),kd=(_,e)=>e("date"),Sd=(_,e)=>e("store"),Pd=(_,e)=>e("who"),Md=(_,e)=>e("amount"),Cd=o('<span class="text-base-content/70 italic"> </span>'),qd=o('<span class="text-base-content/50 ml-1 text-xs"> </span>'),Dd=o('<span class="font-medium"> </span> <!>',1),Td=(_,e,r)=>e(t(r)),Id=o('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),$d=o('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),Ad=o('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),Ed=(_,e,r)=>e(t(r)),Od=o('<div class="text-sm italic opacity-70"> </div>'),Nd=o('<div class="text-xs opacity-60"> </div>'),zd=o('<div class="text-sm font-medium"> </div> <!>',1),jd=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),Fd=o('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),Bd=o('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),Ld=o('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),Rd=o('<div class="space-y-3"><!> <!></div>'),Qd=o('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),Vd=o("<!> <!>",1);function Ud(_,e){Bt(e,!0);let r=Pt(e,"isOpen",15,!1),i=ht(!1),v=ht(null),y=ht(!1),u=ht(Ht({invoiceTotal:0,store:"",notes:"",who:""})),U=ht(null);he(()=>{if(r()&&!t(U)){const g=localStorage.getItem("appwrite-user-name");g&&(t(u).who=g)}});let W=ht("date"),R=ht("desc"),F=L(()=>P.financialStats),dt=L(()=>t(F).allPurchases),E=L(()=>{let g=[...t(dt)];return g.sort((b,T)=>{let tt,mt;switch(t(W)){case"date":tt=new Date(b.orderDate||b.$createdAt).getTime(),mt=new Date(T.orderDate||T.$createdAt).getTime();break;case"amount":tt=b.invoiceTotal||b.price||0,mt=T.invoiceTotal||T.price||0;break;case"store":tt=(b.store||"").toLowerCase(),mt=(T.store||"").toLowerCase();break;case"who":tt=(b.who||"").toLowerCase(),mt=(T.who||"").toLowerCase();break}return tt<mt?t(R)==="asc"?-1:1:tt>mt?t(R)==="asc"?1:-1:0}),g});function p(g){t(W)===g?D(R,t(R)==="asc"?"desc":"asc",!0):(D(W,g,!0),D(R,"desc"))}function k(){const g=localStorage.getItem("appwrite-user-name")||"";D(u,{invoiceTotal:0,store:"",notes:"",who:g},!0),D(U,null),D(y,!1)}function C(g){D(u,{invoiceTotal:g.invoiceTotal||g.price||0,store:g.store||"",notes:g.notes||"",who:g.who||""},!0),D(U,g.$id,!0),D(y,!0)}function S(){r(!1),k(),D(v,null)}function st(g){return g?new Date(g).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function Z(g){return(g||0).toFixed(2)+" €"}Ie(_,{get isOpen(){return r()},onClose:S,maxWidth:"lg",children:(g,b)=>{var T=Vd(),tt=ct(T);Me(tt,{title:"Gestion des Dépenses",onClose:S});var mt=s(tt,2);$e(mt,{children:(yt,nt)=>{var G=Qd(),x=a(G),$=a(x),bt=a($),B=s(a(bt),2),rt=a(B),z=s(B,2),lt=a(z),at=s($,2),ft=s(a(at),2);Wt(ft,21,()=>Object.entries(t(F).byStore).sort((d,V)=>V[1]-d[1]),Pe,(d,V)=>{var Y=L(()=>fa(t(V),2));let w=()=>t(Y)[0],H=()=>t(Y)[1];var M=pd(),m=a(M),ut=a(m),gt=s(m,2),vt=a(gt);f(pt=>{c(ut,w()),c(vt,pt)},[()=>Z(H())]),n(d,M)});var X=s(at,2),h=s(a(X),2);Wt(h,21,()=>Object.entries(t(F).byWho).sort((d,V)=>V[1]-d[1]),Pe,(d,V)=>{var Y=L(()=>fa(t(V),2));let w=()=>t(Y)[0],H=()=>t(Y)[1];var M=gd(),m=a(M),ut=a(m),gt=s(m,2),vt=a(gt);f(pt=>{c(ut,w()),c(vt,pt)},[()=>Z(H())]),n(d,M)});var A=s(x,2),Q=s(a(A),2);{var N=d=>{var V=hd();V.__click=[bd,y];var Y=a(V);Ia(Y,{class:"mr-1 h-4 w-4"}),n(d,V)};l(Q,d=>{t(y)||d(N)})}var q=s(A,2);{var et=d=>{var V=wd(),Y=a(V),w=a(Y),H=a(w),M=s(w,2),m=a(M);Fa(m,{get disabled(){return t(i)},get value(){return t(u).invoiceTotal},set value(Ct){t(u).invoiceTotal=Ct}});var ut=s(m,2);Ae(ut,{get suggestions(){return P.uniqueStores},get disabled(){return t(i)},get value(){return t(u).store},set value(Ct){t(u).store=Ct}});var gt=s(ut,2);na(gt,{get suggestions(){return P.uniqueWho},get disabled(){return t(i)},get value(){return t(u).who},set value(Ct){t(u).who=Ct}});var vt=s(gt,2);Ee(vt,{get disabled(){return t(i)},get value(){return t(u).notes},set value(Ct){t(u).notes=Ct}});var pt=s(M,2),J=a(pt);J.__click=k;var ot=s(J,2);ot.__click=[md,u,v,i,U,k];var _t=a(ot);{var wt=Ct=>{var Ft=xd();n(Ct,Ft)};l(_t,Ct=>{t(i)&&Ct(wt)})}var kt=s(_t),Mt=s(pt,2);{var Ut=Ct=>{var Ft=yd(),Nt=a(Ft);f(()=>c(Nt,t(v))),n(Ct,Ft)};l(Mt,Ct=>{t(v)&&Ct(Ut)})}f(()=>{c(H,t(U)?"Modifier la dépense":"Nouvelle Dépense"),ot.disabled=t(i),c(kt,` ${t(U)?"Enregistrer":"Ajouter"}`)}),n(d,V)};l(q,d=>{t(y)&&d(et)})}var j=s(q,2);{var I=d=>{var V=Ad(),Y=a(V),w=a(Y),H=a(w),M=a(H);M.__click=[kd,p];var m=a(M),ut=s(M,2);ut.__click=[Sd,p];var gt=a(ut),vt=s(ut);vt.__click=[Pd,p];var pt=a(vt),J=s(vt);J.__click=[Md,p];var ot=a(J),_t=s(J),wt=a(_t);jr(wt,{size:14});var kt=s(w),Mt=a(kt);Wt(Mt,17,()=>t(E),Ft=>Ft.$id,(Ft,Nt)=>{var oe=Id(),re=a(oe),le=a(re),ie=s(re),te=a(ie);{var de=K=>{var it=Cd(),xt=a(it);f(()=>c(xt,t(Nt).notes||"-")),n(K,it)},fe=K=>{var it=Dd(),xt=ct(it),$t=a(xt),At=s(xt,2);{var Qt=jt=>{var Rt=qd(),Vt=a(Rt);f(()=>c(Vt,`- ${t(Nt).notes??""}`)),n(jt,Rt)};l(At,jt=>{t(Nt).notes&&jt(Qt)})}f(()=>c($t,t(Nt)._productName||"Produit inconnu")),n(K,it)};l(te,K=>{t(Nt).status==="expense"?K(de):K(fe,!1)})}var zt=s(ie),Et=a(zt),It=s(zt),Gt=a(It),Jt=s(It),se=a(Jt),Xt=s(Jt),ve=a(Xt);ve.__click=[Td,C,Nt];var we=a(ve);be(we,{size:14}),f((K,it)=>{c(le,K),c(Et,t(Nt).store||"-"),c(Gt,t(Nt).who||"-"),c(se,it)},[()=>st(t(Nt).orderDate||t(Nt).$createdAt),()=>Z(t(Nt).invoiceTotal||t(Nt).price)]),n(Ft,oe)});var Ut=s(Mt);{var Ct=Ft=>{var Nt=$d();n(Ft,Nt)};l(Ut,Ft=>{t(E).length===0&&Ft(Ct)})}f(()=>{c(m,`Date ${t(W)==="date"?t(R)==="asc"?"↑":"↓":""}`),c(gt,`Magasin ${t(W)==="store"?t(R)==="asc"?"↑":"↓":""}`),c(pt,`Qui ${t(W)==="who"?t(R)==="asc"?"↑":"↓":""}`),c(ot,`Montant ${t(W)==="amount"?t(R)==="asc"?"↑":"↓":""}`)}),n(d,V)},O=d=>{var V=Rd(),Y=a(V);Wt(Y,17,()=>t(E),M=>M.$id,(M,m)=>{var ut=Bd(),gt=a(ut),vt=a(gt),pt=a(vt),J=a(pt),ot=a(J);Fe(ot,{class:"h-3.5 w-3.5"});var _t=s(ot,2),wt=a(_t),kt=s(J,2),Mt=a(kt),Ut=s(pt,2);Ut.__click=[Ed,C,m];var Ct=a(Ut);be(Ct,{size:16});var Ft=s(vt,2),Nt=a(Ft);{var oe=zt=>{var Et=Od(),It=a(Et);f(()=>c(It,t(m).notes)),n(zt,Et)},re=zt=>{var Et=zd(),It=ct(Et),Gt=a(It),Jt=s(It,2);{var se=Xt=>{var ve=Nd(),we=a(ve);f(()=>c(we,t(m).notes)),n(Xt,ve)};l(Jt,Xt=>{t(m).notes&&Xt(se)})}f(()=>c(Gt,t(m)._productName||"Produit inconnu")),n(zt,Et)};l(Nt,zt=>{t(m).status==="expense"&&t(m).notes?zt(oe):zt(re,!1)})}var le=s(Ft,2),ie=a(le);{var te=zt=>{var Et=jd(),It=a(Et);ue(It,{class:"h-3 w-3"});var Gt=s(It,2),Jt=a(Gt);f(()=>c(Jt,t(m).store)),n(zt,Et)};l(ie,zt=>{t(m).store&&zt(te)})}var de=s(ie,2);{var fe=zt=>{var Et=Fd(),It=a(Et);sa(It,{class:"h-3 w-3"});var Gt=s(It,2),Jt=a(Gt);f(()=>c(Jt,t(m).who)),n(zt,Et)};l(de,zt=>{t(m).who&&zt(fe)})}f((zt,Et)=>{c(wt,zt),c(Mt,Et)},[()=>Be(t(m).orderDate||t(m).$createdAt),()=>Z(t(m).invoiceTotal||t(m).price)]),n(M,ut)});var w=s(Y,2);{var H=M=>{var m=Ld(),ut=a(m);nr(ut,{class:"mx-auto mb-3 h-12 w-12"}),n(M,m)};l(w,M=>{t(E).length===0&&M(H)})}n(d,V)};l(j,d=>{Kt.isMobile?d(O,!1):d(I)})}f(d=>{c(rt,d),c(lt,`${t(dt).length??""} transactions`)},[()=>Z(t(F).totalGlobal)]),n(yt,G)}}),n(g,T)},$$slots:{default:!0}}),Lt()}Zt(["click"]);function Wd(_,e){D(e,!0)}var Gd=o('<div class="flex gap-2"><button class="btn btn-primary" title="Ajouter un produit manuellement"><!> Produit</button></div>'),Hd=o('<div class="flex min-h-96 items-center justify-center"><div class="flex flex-col items-center gap-4"><!> <p class="text-base-content/60 text-sm">Chargement des produits...</p></div></div>'),Jd=o("<!> ",1),Xd=o("<!> ",1),Yd=o('<div class="flex-grow py-4 print:hidden"><!></div>'),Kd=(_,e)=>D(e,!0),Zd=o('<div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><div class="text-primary text-3xl font-black"> </div> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-end gap-10"><div class="alert" id="info-past-event"></div> <div class="card card-xs sm:card:sm border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div></div></div> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow hover:bg-orange-700/10"><button class="card-body cursor-pointer" title="Ajouter une dépense générale"><div class="card-title text-orange-800"><!> Dépense</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <!></button></div></div></div> <!>',1),tv=o('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),ev=o('<div class="flex items-center justify-center"><!></div>'),av=o('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),rv=o("<!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function gv(_,e){Bt(e,!0);const r=d=>{var V=Gd(),Y=a(V);Y.__click=[Wd,E];var w=a(Y);Ia(w,{class:"mr-1 h-4 w-4"}),n(d,V)},i="100";let v=ht(null),y=ht("recettes"),u=ht(!1),U=ht(!1),W=ht(Ht([])),R=ht(Ht([])),F=ht(!1),dt=ht(Ht([])),E=ht(!1),p=ht(!0);he(()=>{as()});let k=Ht(e.params?.id);const C=L(()=>k?Xa.getEventById(k):null),S=L(()=>t(C)?.name??""),st=L(()=>t(C)?.dateStart??null),Z=L(()=>t(C)?.dateEnd??null);ts(async()=>{try{if(!k){console.error("[EventProductsPage] eventId est requis"),D(p,!1);return}const d=Xa.getEventById(k);if(!d){console.error(`[EventProductsPage] Événement ${k} introuvable`),D(p,!1);return}console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${d.name}`),await P.initialize(k)}catch(d){console.error("[EventProductsPage] Erreur lors de l'initialisation:",d)}finally{D(p,!1)}});function g(d,V="recettes"){D(y,V,!0),D(v,d,!0)}function b(){D(v,null)}function T(d,V,Y){D(W,V,!0),D(R,Y,!0),d==="who"?D(u,!0):D(U,!0)}function tt(d){(!d||d==="who")&&D(u,!1),(!d||d==="store")&&D(U,!1),D(W,[],!0),D(R,[],!0)}function mt(d){console.log(`[ProductsTable] Modification groupée réussie: ${d.updatedCount} produits`)}function yt(d){const V=d.filter(Y=>P.getProductModelById(Y.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${d.length} produits reçus → ${V.length} produits avec quantités manquantes`),D(dt,V,!0),D(F,!0)}function nt(){D(F,!1),D(dt,[],!0)}function G(){console.log("[ProductsTable] Achat groupé créé avec succès"),nt()}async function x(d,V){try{if(!P.currentMainId)throw new Error("mainId non disponible");const Y=V.missingQuantities||[];if(Y.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const w=Y.filter(M=>M.q<0).map(M=>({...M,q:Math.abs(M.q)})).map(M=>{const m=je.normalize(M.q,M.u);return{q:m.quantity,u:m.unit}});let H=d.$id;d.isSynced||(console.log(`[ProductsTable] Produit ${d.$id} local, création pour validation rapide...`),H=(await Se(d.$id,{},m=>P.getEnrichedProductById(m))).$id,console.log(`[ProductsTable] Produit sync créé: ${H}`)),await rs(P.currentMainId,H,w,{store:d.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${d.productName}`)}catch(Y){console.error("[ProductsTable] Erreur validation rapide:",Y),alert("Erreur lors de la validation rapide: "+Y.message)}}let $=ht(!1);he(()=>{Ya.setConfig({eventId:k||void 0,actions:r})}),es(()=>{Ya.reset()});var bt=rv(),B=ct(bt);ds(B,{width:i,children:(d,V)=>{wi(d,{})},$$slots:{default:!0}});var rt=s(B,2),z=a(rt);{var lt=d=>{var V=Hd(),Y=a(V),w=a(Y);rr(w,{class:"text-primary h-12 w-12 animate-spin"}),n(d,V)},at=d=>{var V=Zd(),Y=ct(V),w=a(Y),H=a(w),M=a(H),m=s(H,2),ut=a(m);{var gt=Et=>{var It=Jd(),Gt=ct(It);Fe(Gt,{class:"inline h-4 w-4"});var Jt=s(Gt);f((se,Xt)=>c(Jt,` ${se??""} au ${Xt??""}`),[()=>Ma(t(st)),()=>Ma(t(Z))]),n(Et,It)},vt=Et=>{var It=Ot(),Gt=ct(It);{var Jt=se=>{var Xt=Xd(),ve=ct(Xt);Fe(ve,{class:"inline h-4 w-4"});var we=s(ve);f(K=>c(we,` ${K??""}`),[()=>Ma(t(st))]),n(se,Xt)};l(Gt,se=>{t(st)&&se(Jt)},!0)}n(Et,It)};l(ut,Et=>{t(st)&&t(Z)?Et(gt):Et(vt,!1)})}var pt=s(w,2);{var J=Et=>{var It=Yd(),Gt=a(It);ls(Gt,{get currentEvent(){return t(C)}}),n(Et,It)};l(pt,Et=>{t(C)&&Et(J)})}var ot=s(pt,2),_t=s(a(ot),2),wt=a(_t),kt=a(wt),Mt=a(kt);sr(Mt,{class:"text-orange-800 opacity-60"});var Ut=s(kt,2),Ct=a(Ut),Ft=a(Ct),Nt=a(Ft),oe=s(_t,2),re=a(oe);re.__click=[Kd,$];var le=a(re),ie=a(le);nr(ie,{class:"text-orange-800 opacity-60"});var te=s(le,2),de=a(te),fe=s(te,2);be(fe,{class:"text-base-content/60 absolute right-3 bottom-2 size-4"});var zt=s(Y,2);Xl(zt,{get currentEvent(){return t(C)},onOpenModal:g,onOpenGroupEditModal:T,onOpenGroupPurchaseModal:yt,onQuickValidation:x}),f(()=>{c(M,t(S)),c(Nt,P.completionStats.missing),c(de,`${P.financialStats.totalGlobal??""} €`)}),Tt("mouseenter",re,()=>qt.msg="Consulter ou modifie le détail des dépenses"),Tt("mouseleave",re,()=>qt.reset()),n(d,V)};l(z,d=>{t(p)?d(lt):d(at,!1)})}var ft=s(z,2);{let d=L(()=>t(v)||"");Eo(ft,{get productId(){return t(d)},get initialTab(){return t(y)},onClose:b})}var X=s(ft,2);{var h=d=>{fd(d,{get productIds(){return t(W)},get products(){return t(R)},onClose:()=>tt("who"),onSuccess:mt})};l(X,d=>{t(u)&&d(h)})}var A=s(X,2);{var Q=d=>{nd(d,{get productIds(){return t(W)},get products(){return t(R)},onClose:()=>tt("store"),onSuccess:mt})};l(A,d=>{t(U)&&d(Q)})}var N=s(A,2);{var q=d=>{Ps(d,{get products(){return t(dt)},onClose:nt,onSuccess:G})};l(N,d=>{t(F)&&d(q)})}var et=s(N,2);Os(et,{get open(){return t(E)},set open(d){D(E,d,!0)}});var j=s(et,2);Ud(j,{get isOpen(){return t($)},set isOpen(d){D($,d,!0)}});var I=s(j,2);{var O=d=>{var V=av(),Y=a(V),w=a(Y);{var H=m=>{var ut=tv(),gt=a(ut);Ua(gt,{class:"me-2 size-5"});var vt=s(gt),pt=s(vt);pt.__click=()=>qt.collapse();var J=a(pt);pa(J,{class:"h-4 w-4"}),f(()=>c(vt,` ${qt.msg??""} `)),n(m,ut)},M=m=>{var ut=ev();ut.__click=()=>qt.expand();var gt=a(ut);Ua(gt,{class:"size-6"}),n(m,ut)};l(w,m=>{qt.isExpanded?m(H):m(M,!1)})}f(()=>St(Y,1,`rounded-tr-box bg-blue-100 text-blue-800 ${qt.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),n(d,V)};l(I,d=>{Kt.isDesktop&&d(O)})}f(()=>St(rt,1,`space-y-6 pt-6 md:px-16 ${(Kt.isDesktop&&"ml-110 print:ml-0")??""} `)),n(_,bt),Lt()}Zt(["click"]);export{gv as default};
