import{P as re,r as ne}from"./icons.js";import{q as m,Y as le,a1 as E,ag as ie,V as T,a2 as V,g as s,h as d,W as M,a4 as j,m as e,b as y,c as oe,d as de,y as ce,C as w,a0 as z,u as c,v as i,A as ue,Z as ve}from"./appwrite.js";import{t as h,n as G}from"./index.js";import{M as me}from"./MarkdownEditorAdvanced.js";import{B as fe}from"./BtnGroupCheck.js";import"./tiptap-markdown.es.js";import"./CheckboxBadge.js";function pe(f,p){f.key==="Enter"&&(f.preventDefault(),p())}var ge=T('<span class="loading loading-spinner loading-sm"></span>'),be=T('<div class="flex items-center gap-2"><button class="btn btn-primary"><!> Créer</button></div>'),_e=T("<div><!></div>"),ye=T('<div class="mx-auto max-w-5xl p-4" role="region" tabindex="-1"><div class="space-y-4"><fieldset class="fieldset flex"><label class="input input-lg w-full"><span class="label">Nom</span> <input type="text" placeholder="Titre du document" maxlength="50" required/></label></fieldset> <fieldset class="fieldset"><!></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Tags</legend> <div class="flex flex-wrap items-center gap-x-6 gap-y-2"><!> <label class="input w-80"><input type="text" placeholder="Nouveau tag..." maxlength="30"/> <button class="btn btn-primary btn-sm"><!> Ajouter</button></label></div></fieldset></div></div>');function De(f,p){de(p,!0);const W=t=>{var n=be(),l=s(n);l.__click=N;var D=s(l);{var te=o=>{var se=ge();y(o,se)},ae=o=>{ne(o,{class:"h-4 w-4"})};V(D,o=>{e(r)?o(te):o(ae,!1)})}M(()=>l.disabled=!e(Z)||!e(P)||e(r)),y(t,n)};let g=c(()=>p.params.teamId),b=m(""),x=m(""),a=m(le([])),u=m(""),Y=!1,r=m(!1),v=c(()=>ue.myTeams.find(t=>t.$id===e(g))),A=c(()=>{const t=h.getTeamTags(e(g)),n=new Set([...t,...e(a)]);return Array.from(n).map(l=>({id:l,label:l,selected:e(a).includes(l)}))});const Z=c(()=>!e(r)),P=c(()=>e(b).trim().length>0&&e(v)!==void 0);E(()=>{if(!ce.userId){w.error("Vous devez être connecté"),z("/");return}if(!e(v)){w.error("Équipe introuvable"),z("/");return}h.isInitialized||h.initialize()});const $=c(()=>`Nouveau document - ${e(v)?.name} `);E(()=>{G.setConfig({title:e($),actions:W})}),ie(()=>{G.reset()});function K(){const t=e(u).trim().toLowerCase();t&&!e(a).includes(t)&&(i(a,[...e(a),t],!0),i(u,""))}function F(t){e(a).includes(t)?i(a,e(a).filter(n=>n!==t),!0):i(a,[...e(a),t],!0)}async function N(){if(!(!e(P)||e(r)||!e(v))){i(r,!0);try{const t=await h.createDocument({title:e(b).trim(),content:e(x),tags:e(a).length>0?e(a):null,isPublic:Y,teamName:e(v).name,status:"doc"},e(g));w.success("Document créé avec succès"),z(`/editdocument/${e(g)}/${t.$id}`)}catch(t){console.error("[CreateDocumentPage] Erreur création document:",t),w.error("Erreur lors de la création du document")}finally{i(r,!1)}}}function k(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),N())}E(()=>(window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)));var C=ye();C.__keydown=k;var H=s(C),q=s(H),J=s(q),B=d(s(J),2),I=d(q,2),O=s(I);me(O,{placeholder:"Commencez à rédiger votre document...",get value(){return e(x)},set value(t){i(x,t,!0)}});var Q=d(I,2),R=d(s(Q),2),L=s(R);{var U=t=>{var n=_e(),l=s(n);fe(l,{get items(){return e(A)},onToggleItem:D=>F(D),size:"md",showStats:!1}),y(t,n)};V(L,t=>{e(A).length>0&&t(U)})}var X=d(L,2),_=s(X);_.__keydown=[pe,K];var S=d(_,2);S.__click=K;var ee=s(S);re(ee,{class:"h-4 w-4"}),M(t=>{B.disabled=e(r),_.disabled=e(r),S.disabled=t},[()=>e(r)||!e(u).trim()]),j(B,()=>e(b),t=>i(b,t)),j(_,()=>e(u),t=>i(u,t)),y(f,C),oe()}ve(["click","keydown"]);export{De as default};
