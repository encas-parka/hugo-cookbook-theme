import{s as v,p as re,b as E,aa as ne,W as x,$ as M,A as s,B as d,X as V,a1 as $,g as e,v as y,w as ie,x as le,u as c,a as l,Z as oe}from"./vendor.js";import{t as w,n as j}from"./index.js";import{a as de,t as h,y as z,n as ce}from"./appwrite.js";import{M as ue}from"./MarkdownEditorAdvanced.js";import{B as me}from"./BtnGroupCheck.js";import{P as ve,r as fe}from"./icons.js";import"./editor.js";import"./markdown.js";import"./CheckboxBadge.js";function pe(f,p){f.key==="Enter"&&(f.preventDefault(),p())}var ge=x('<span class="loading loading-spinner loading-sm"></span>'),be=x('<div class="flex items-center gap-2"><button class="btn btn-primary"><!> Créer</button></div>'),_e=x("<div><!></div>"),ye=x('<div class="mx-auto max-w-5xl p-4" role="region" tabindex="-1"><div class="space-y-4"><fieldset class="fieldset flex"><label class="input input-lg w-full"><span class="label">Nom</span> <input type="text" placeholder="Titre du document" maxlength="50" required/></label></fieldset> <fieldset class="fieldset"><!></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Tags</legend> <div class="flex flex-wrap items-center gap-x-6 gap-y-2"><!> <label class="input w-80"><input type="text" placeholder="Nouveau tag..." maxlength="30"/> <button class="btn btn-primary btn-sm"><!> Ajouter</button></label></div></fieldset></div></div>');function ze(f,p){le(p,!0);const G=t=>{var n=be(),i=s(n);i.__click=K;var D=s(i);{var te=o=>{var se=ge();y(o,se)},ae=o=>{fe(o,{class:"h-4 w-4"})};M(D,o=>{e(r)?o(te):o(ae,!1)})}V(()=>i.disabled=!e(X)||!e(P)||e(r)),y(t,n)};let g=c(()=>p.params.teamId),b=v(""),T=v(""),a=v(re([])),u=v(""),W=!1,r=v(!1),m=c(()=>ce.myTeams.find(t=>t.$id===e(g))),A=c(()=>{const t=w.getTeamTags(e(g)),n=new Set([...t,...e(a)]);return Array.from(n).map(i=>({id:i,label:i,selected:e(a).includes(i)}))});const X=c(()=>!e(r)),P=c(()=>e(b).trim().length>0&&e(m)!==void 0);E(()=>{if(!de.userId){h.error("Vous devez être connecté"),z("/");return}if(!e(m)){h.error("Équipe introuvable"),z("/");return}w.isInitialized||w.initialize()});const Z=c(()=>`Nouveau document - ${e(m)?.name} `);E(()=>{j.setConfig({title:e(Z),actions:G})}),ne(()=>{j.reset()});function B(){const t=e(u).trim().toLowerCase();t&&!e(a).includes(t)&&(l(a,[...e(a),t],!0),l(u,""))}function F(t){e(a).includes(t)?l(a,e(a).filter(n=>n!==t),!0):l(a,[...e(a),t],!0)}async function K(){if(!(!e(P)||e(r)||!e(m))){l(r,!0);try{const t=await w.createDocument({title:e(b).trim(),content:e(T),tags:e(a).length>0?e(a):null,isPublic:W,teamName:e(m).name,status:"doc"},e(g));h.success("Document créé avec succès"),z(`/editdocument/${e(g)}/${t.$id}`)}catch(t){console.error("[CreateDocumentPage] Erreur création document:",t),h.error("Erreur lors de la création du document")}finally{l(r,!1)}}}function k(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),K())}E(()=>(window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)));var S=ye();S.__keydown=k;var H=s(S),N=s(H),J=s(N),I=d(s(J),2),L=d(N,2),O=s(L);ue(O,{placeholder:"Commencez à rédiger votre document...",get value(){return e(T)},set value(t){l(T,t,!0)}});var Q=d(L,2),R=d(s(Q),2),q=s(R);{var U=t=>{var n=_e(),i=s(n);me(i,{get items(){return e(A)},onToggleItem:D=>F(D),size:"md",showStats:!1}),y(t,n)};M(q,t=>{e(A).length>0&&t(U)})}var Y=d(q,2),_=s(Y);_.__keydown=[pe,B];var C=d(_,2);C.__click=B;var ee=s(C);ve(ee,{class:"h-4 w-4"}),V(t=>{I.disabled=e(r),_.disabled=e(r),C.disabled=t},[()=>e(r)||!e(u).trim()]),$(I,()=>e(b),t=>l(b,t)),$(_,()=>e(u),t=>l(u,t)),y(f,S),ie()}oe(["click","keydown"]);export{ze as default};
