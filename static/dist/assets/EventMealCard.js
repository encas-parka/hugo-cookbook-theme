import{P as Pt,S as Ot,f as Mt,g as Ue,U as zt,ao as At,ap as qt,aq as st,T as Ft,ah as it,u as Xe,X as It,t as Nt,ar as jt}from"./icons.js";import{Z as ct,d as vt,p as ae,q as V,Y as De,a1 as he,m as e,u as D,v as d,V as v,g as s,h as i,a2 as A,b as c,c as ut,aP as Lt,ao as nt,W as I,a7 as oe,a4 as Ee,a6 as Qe,e as Ye,_ as G,X as Q,a3 as Bt,aN as lt,aj as Gt,k as Vt,az as ot,aL as Wt}from"./appwrite.js";import{k as Zt}from"./keyboardNavigation.svelte.js";import{f as Ht}from"./products-display.js";import{e as Kt,a as dt,d as Xt}from"./date-helpers.js";function Qt(l,r,t,_){e(r)?t():_()}function Yt(l,r,t,_,o,b,u,k,E,R,p){if(l.key==="Escape"){l.preventDefault(),r();return}if(!e(t)||!e(_).length){l.key==="Enter"&&e(o).trim().length>1&&!e(b)&&(l.preventDefault(),u());return}l.key==="ArrowDown"?(l.preventDefault(),d(k,e(k)+1),E()):l.key==="ArrowUp"?(l.preventDefault(),d(k,e(k)-1),E()):l.key==="Enter"&&e(R)>=0&&(l.preventDefault(),p(e(_)[e(R)]))}var $t=(l,r,t)=>r(e(t)),Jt=v('<span class="text-base-content/70 text-xs font-normal"> </span>'),ea=v('<span class="badge badge-ghost badge-sm text-xs opacity-70">brouillon</span>'),ta=v('<button type="button" role="option"><div class="bg-base-200 rounded p-1"><!></div> <div class="flex min-w-0 flex-1 flex-wrap items-center gap-2"><span class="truncate text-sm font-medium"> </span> <!> <!></div></button>'),aa=v('<div id="recipes-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"></div>'),ra=v('<div class="mt-2"><div class="relative"><div class="input flex w-full items-center gap-2 pr-10"><!> <input type="text" placeholder="Rechercher une recette..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="recipes-list"/> <!></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div>'),sa=v('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center justify-between"><h4 class="flex items-center gap-2 font-bold"><!> Ajouter une recette</h4></div> <!></div></div>');function ia(l,r){vt(r,!0);let t=ae(r,"defaultPlates",3,4),_=ae(r,"autoFocus",3,!1),o=ae(r,"disabled",3,!1),b=V(""),u=V(void 0),k=V(De(t())),E=V(null),R=!1,p=V(0),q=V(!1),C=V(void 0),W=V(void 0),N=D(()=>e(q)&&!e(b).trim()?Qe.getAllRecipes():e(b).trim().length<2?[]:Qe.searchRecipes(e(b))),de=D(()=>e(N).length>0),T=D(()=>e(de)||e(q)),g=D(()=>e(N).length>0?e(p)===-1?0:e(p)%e(N).length:-1);he(()=>{if(e(T)){const m=H=>{e(C)&&!e(C).contains(H.target)&&re()};return document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}}});function P(){d(E,null),d(b,""),d(k,t()),d(p,0),d(q,!1)}function Y(){d(q,!0),d(b,""),d(p,0)}function re(){d(q,!1),d(b,""),d(p,0)}function $(m){d(E,m,!0);const H=m.typeR;d(u,e(u)?e(u):H,!0),r.onSelect(m,e(u),e(k)),P()}function Z(){if(e(g)>=0&&e(W)){const m=e(W).querySelector(`#recipe-${e(g)}`);m&&m.scrollIntoView({block:"nearest"})}}var j=sa(),ce=s(j),se=s(ce),L=s(se),ue=s(L);Pt(ue,{class:"text-primary h-4 w-4"});var xe=i(se,2);{var ye=m=>{var H=ra(),pe=s(H),_e=s(pe),we=s(_e);Ot(we,{class:"h-4 w-4 opacity-50"});var K=i(we,2);K.__keydown=[Yt,re,T,N,b,q,Y,p,Z,g,$],Lt(K,()=>Zt({shouldFocus:_(),onEmptySubmit:r.onEmptySubmit}));var Ce=i(K,2);A(Ce,O=>{});var J=i(_e,2);J.__click=[Qt,T,re,Y];var Te=s(J);{let O=D(()=>e(T)?"rotate-180":"");Mt(Te,{get class(){return`h-4 w-4 transition-transform ${e(O)??""}`}})}var Pe=i(J,2);{var Oe=O=>{var fe=aa();Ye(fe,23,()=>e(N),ie=>ie.$id,(ie,ne,ve)=>{var a=ta();a.__click=[$t,$,ne],a.disabled=R;var n=s(a),f=s(n);Ue(f,{class:"h-4 w-4 opacity-70"});var h=i(n,2),M=s(h),S=s(M),X=i(M,2);{var le=y=>{var z=Jt(),te=s(z);I(()=>Q(te,`(${e(ne).versionLabel??""})`)),c(y,z)};A(X,y=>{e(ne).versionLabel&&y(le)})}var B=i(X,2);{var ee=y=>{var z=ea();c(y,z)};A(B,y=>{e(ne).draft&&y(ee)})}I(()=>{oe(a,"id",`recipe-${e(ve)??""}`),G(a,1,`hover:bg-base-200 flex w-full items-center gap-2 px-4 py-3 text-left hover:cursor-pointer ${e(ve)===e(g)?"bg-base-200":""}`),oe(a,"aria-selected",e(ve)===e(g)),Q(S,e(ne).title)}),Bt("mouseenter",a,()=>d(p,e(ve),!0)),c(ie,a)}),nt(fe,ie=>d(W,ie),()=>e(W)),c(O,fe)};A(Pe,O=>{e(T)&&e(N).length>0&&O(Oe)})}nt(H,O=>d(C,O),()=>e(C)),I(()=>{K.disabled=o(),oe(K,"aria-expanded",e(T)),oe(K,"aria-activedescendant",e(T)?`recipe-${e(g)}`:void 0),J.disabled=o(),oe(J,"aria-label",e(T)?"Fermer le menu":"Ouvrir le menu")}),Ee(K,()=>e(b),O=>d(b,O)),c(m,H)};A(xe,m=>{e(E)||m(ye)})}c(l,j),ut()}ct(["keydown","click"]);function na(l){const r=l-1;return r*r*r+1}function la(l,{from:r,to:t},_={}){var{delay:o=0,duration:b=Z=>Math.sqrt(Z)*120,easing:u=na}=_,k=getComputedStyle(l),E=k.transform==="none"?"":k.transform,[R,p]=k.transformOrigin.split(" ").map(parseFloat);R/=l.clientWidth,p/=l.clientHeight;var q=oa(l),C=l.clientWidth/t.width/q,W=l.clientHeight/t.height/q,N=r.left+r.width*R,de=r.top+r.height*p,T=t.left+t.width*R,g=t.top+t.height*p,P=(N-T)*C,Y=(de-g)*W,re=r.width/t.width,$=r.height/t.height;return{delay:o,duration:typeof b=="function"?b(Math.sqrt(P*P+Y*Y)):b,easing:u,css:(Z,j)=>{var ce=j*P,se=j*Y,L=Z+j*re,ue=Z+j*$;return`transform: ${E} translate(${ce}px, ${se}px) scale(${L}, ${ue});`}}}function oa(l){if("currentCSSZoom"in l)return l.currentCSSZoom;for(var r=l,t=1;r!==null;)t*=+getComputedStyle(r).zoom,r=r.parentElement;return t}var da=(l,r,t)=>{(l.key==="Enter"||l.key===" ")&&!r()&&t()},ca=(l,r)=>{r(!1)},va=v(`<button class="btn btn-ghost text-primary" title="Terminer l'édition">valider</button> <button class="btn btn-ghost btn-square text-error" title="Supprimer"><!></button>`,1),ua=(l,r,t)=>{r(!0),t.onEditToggle&&t.onEditToggle()},pa=v('<button class="btn btn-ghost" title="Éditer"><!></button>'),_a=(l,r,t)=>r({newDate:e(t)}),fa=v('<p class="text-error mt-1 text-xs">Cette date/heure est déjà utilisée</p>'),ba=(l,r,t)=>r({newMoment:e(t)}),ma=v('<span class="text-error ms-2 text-sm font-normal">(Recette introuvable)</span>'),ga=(l,r,t,_)=>{r[t(e(_).recipeUuid)]=!1},ha=(l,r,t,_,o)=>{r[t(e(_).recipeUuid)]=!1,e(_).hasOwnPlatesNb=!1,e(_).plates=o().guests},xa=v('<div class="ring-base-300 flex items-center gap-1 rounded-xl p-1 ring-1"><div class="input w-28"><!> <input type="number" class="w-full text-center" min="1"/></div> <button class="btn btn-sm btn-circle me-1" title="Valider"><!></button> <button class="btn btn-sm btn-circle"><!></button></div>'),ya=(l,r,t,_)=>{const o=r(e(t).recipeUuid);_[o]=!0,e(t).hasOwnPlatesNb=!0},wa=v('<button title="Éditer les couverts"><span class="font-normal"> </span> <!></button>'),ka=(l,r,t)=>r(e(t).recipeUuid),Ra=v('<div><div class="flex flex-1 items-center gap-2"><div><!></div> <div class="min-w-56 flex-1"><div class="font-medium"> <!></div></div></div> <div class="me-10 flex items-center gap-2"><select class="select w-24"><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select> <!></div> <div class="ms-auto"><button class="btn btn-ghost btn-sm btn-square text-error" title="Retirer la recette"><!></button></div></div>'),Sa=v('<div class="mb-4 space-y-2"></div>'),Ua=v('<div class="mt-2 space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><fieldset><label><span class="label">Date</span> <input type="date" class="w-full"/></label> <!></fieldset> <label class="select"><span class="label">Moment</span> <select><option disabled selected>Choisir un moment</option><option>Matin</option><option>Midi</option><option>Soir</option></select></label> <div><label class="input"><span class="label"><!> Couverts</span> <input type="number" class="w-full" min="1"/></label> <p class="text-base-content/60 pl-2 text-xs">Peut etre modifié individuellement pour chaque recette</p></div></div> <div class="space-y-2"><div class="flex items-center justify-between"><h4 class="flex items-center gap-2 font-semibold"><!> Recettes</h4></div> <!> <!></div></div>'),Da=v('<div><!> <span> </span> <span class="badge badge-sm badge-outline font-normal"> <!></span></div>'),Ea=v('<div class="flex flex-wrap gap-2"></div>'),Ca=v('<p class="text-base-content/60 text-sm italic">Aucune recette</p>'),Ta=v('<div class="space-y-2"><!></div>'),Pa=v('<div role="button"><div class="card-body p-4"><div class="mb-2 flex items-start justify-between"><div class="flex flex-wrap items-center gap-2"><span> </span> <div><!> <div> </div></div> <div class="text-base-content/80 flex items-center gap-1 font-bold"><!> </div></div> <div class="flex gap-1"><!></div></div> <!></div></div>');function Ia(l,r){vt(r,!0);let t=ae(r,"meal",15),_=ae(r,"defaultGuests",3,100),o=ae(r,"isEditing",15,!1),b=ae(r,"allDates",19,()=>[]),u=ae(r,"disabled",3,!1);he(()=>{u()&&o()&&o(!1)});let k=!1;t().guests||t(t().guests=_(),!0),t().recipes||t(t().recipes=[],!0);let E=D(()=>dt(t().date||"")),R=V(De(Kt(t().date||""))),p=V(De(dt(t().date||""))),q=D(()=>e(p)?Xt(e(R),e(p)):""),C=D(()=>t().date?b().filter(n=>n===t().date).length>1:!1);function W({newDate:a="",newMoment:n=""}){t().date,(a||n)&&t(t().date=e(q),!0)}const N=D(()=>{const a=e(E)||"";return a==="matin"?At:a==="midi"?qt:a==="soir"?st:st}),de={entree:1,plat:2,dessert:3,autre:4};function T(a){return[...a].sort((n,f)=>{const h=de[n.typeR],M=de[f.typeR];return h-M})}he(()=>{const a=T(t().recipes);t().recipes.some((f,h)=>f.recipeUuid!==a[h]?.recipeUuid)&&lt(()=>{t(t().recipes=a,!0)})});let g=De({});function P(a){return`${t().id}-${a}`}he(()=>{t().recipes.forEach(a=>{const n=P(a.recipeUuid);g[n]===void 0&&(g[n]=!1)})}),he(()=>{const a=t().guests;t().recipes.forEach(n=>{!n.hasOwnPlatesNb&&!g[P(n.recipeUuid)]&&n.plates!==a&&lt(()=>{n.plates=a})})});function Y(a){if(t().recipes.some(h=>h.recipeUuid===a.$id))return;const f={recipeUuid:a.$id,plates:t().guests,typeR:a.typeR,hasOwnPlatesNb:!1};t(t().recipes=[...t().recipes,{...f}],!0)}function re(a){t(t().recipes=t().recipes.filter(n=>n.recipeUuid!==a),!0)}function $(a){return Qe.getRecipeIndexByUuid(a)}function Z(a){return a.split("_")[0]}function j(a){return!$(a)}function ce(){u()||o()&&r.onEditToggle||!o()&&r.onEditToggle&&r.onEditToggle()}function se(a,n=!1){return n?"badge-error":a==="entree"?"bg-lime-100 border-lime-200":a==="plat"?"bg-orange-100 border-orange-200":a==="dessert"?"bg-pink-100 border-pink-200":a==="autre"?"bg-purple-100 border-purple-200":"bg-base-200"}var L=Pa();L.__click=ce,L.__keydown=[da,o,ce];var ue=s(L),xe=s(ue),ye=s(xe),m=s(ye),H=s(m),pe=i(m,2),_e=s(pe);Gt(_e,()=>e(N),(a,n)=>{n(a,{size:16})});var we=i(_e,2),K=s(we),Ce=i(pe,2),J=s(Ce);zt(J,{class:"h-3 w-3"});var Te=i(J),Pe=i(ye,2),Oe=s(Pe);{var O=a=>{var n=va(),f=Vt(n);f.__click=[ca,o];var h=i(f,2);h.__click=function(...S){r.onDelete?.apply(this,S)};var M=s(h);Ft(M,{class:"h-4 w-4"}),I(()=>{f.disabled=u(),h.disabled=u()}),c(a,n)},fe=a=>{var n=pa();n.__click=[ua,o,r];var f=s(n);it(f,{class:"h-4 w-4"}),I(()=>n.disabled=u()),c(a,n)};A(Oe,a=>{o()?a(O):a(fe,!1)})}var ie=i(xe,2);{var ne=a=>{var n=Ua(),f=s(n),h=s(f),M=s(h),S=i(s(M),2);S.__change=[_a,W,R];var X=i(M,2);{var le=U=>{var ke=fa();c(U,ke)};A(X,U=>{e(C)&&U(le)})}var B=i(h,2),ee=i(s(B),2);ee.__change=[ba,W,p];var y=s(ee);y.value=y.__value="";var z=i(y);z.value=z.__value="matin";var te=i(z);te.value=te.__value="midi";var be=i(te);be.value=be.__value="soir";var Me=i(B,2),ze=s(Me),me=s(ze),Ae=s(me);Xe(Ae,{class:"text-base-content/50 me-1 h-4 w-4"});var qe=i(me,2),Fe=i(f,2),$e=s(Fe),pt=s($e),_t=s(pt);Ue(_t,{class:"h-4 w-4"});var Je=i($e,2);{var ft=U=>{var ke=Sa();Ye(ke,31,()=>t().recipes,Ie=>Ie.recipeUuid,(Ie,x,Oa)=>{const mt=D(()=>$(e(x).recipeUuid)),Ne=D(()=>j(e(x).recipeUuid));var Re=Ra(),et=s(Re),je=s(et),gt=s(je);Ue(gt,{class:"h-5 w-5"});var ht=i(je,2),xt=s(ht),tt=s(xt),yt=i(tt);{var wt=w=>{var F=ma();c(w,F)};A(yt,w=>{e(Ne)&&w(wt)})}var at=i(et,2),Le=s(at),Be=s(Le);Be.value=Be.__value="entree";var Ge=i(Be);Ge.value=Ge.__value="plat";var Ve=i(Ge);Ve.value=Ve.__value="dessert";var rt=i(Ve);rt.value=rt.__value="autre";var kt=i(Le,2);{var Rt=w=>{var F=xa(),ge=s(F),Se=s(ge);Xe(Se,{class:"h-4 w-4 opacity-50"});var Ze=i(Se,2),He=i(ge,2);He.__click=[ga,g,P,x];var Et=s(He);Nt(Et,{class:"text-success h-4 w-4"});var Ke=i(He,2);Ke.__click=[ha,g,P,x,t];var Ct=s(Ke);jt(Ct,{class:"text-secondary h-4 w-4"}),I(()=>oe(Ke,"title",`Revenir au nombre de couvert du repas (${t().guests??""})`)),Ee(Ze,()=>e(x).plates,Tt=>e(x).plates=Tt),c(w,F)},St=w=>{var F=wa();F.__click=[ya,P,x,g];var ge=s(F),Se=s(ge),Ze=i(ge,2);it(Ze,{size:14,class:"text-base-content/70  ms-1"}),I(()=>{G(F,1,`btn ${e(x).hasOwnPlatesNb?"btn-soft btn-warning":"btn-ghost"}`),Q(Se,`${e(x).plates??""}
                          pers.`)}),c(w,F)};A(kt,w=>{g[P(e(x).recipeUuid)]?w(Rt):w(St,!1)})}var Ut=i(at,2),We=s(Ut);We.__click=[ka,re,x];var Dt=s(We);It(Dt,{class:"h-4 w-4"}),I((w,F)=>{G(Re,1,`bg-base-200 flex flex-wrap items-center gap-3 rounded-lg p-3 ${(e(Ne)&&"border-error border-2")??""}`),G(je,1,`${w??""} rounded-md border-2 p-2`),Q(tt,`${F??""} `),We.disabled=u()},[()=>se(e(x).typeR,e(Ne)),()=>e(mt)?.title||Z(e(x).recipeUuid)]),ot(Le,()=>e(x).typeR,w=>e(x).typeR=w),Wt(Re,()=>la,()=>({duration:200})),c(Ie,Re)}),c(U,ke)};A(Je,U=>{t().recipes.length>=1&&U(ft)})}var bt=i(Je,2);ia(bt,{onSelect:Y,get defaultPlates(){return t().guests},autoFocus:k,get onEmptySubmit(){return r.onEmptySearchSubmit},get disabled(){return u()}}),I(()=>{G(M,1,`input ${e(C)?"input-error":""}`),G(ee,1,`w-full ${e(C)?"select-error":""}`)}),Ee(S,()=>e(R),U=>d(R,U)),ot(ee,()=>e(p),U=>d(p,U)),Ee(qe,()=>t().guests,U=>t(t().guests=U,!0)),c(a,n)},ve=a=>{var n=Ta(),f=s(n);{var h=S=>{var X=Ea();Ye(X,21,()=>t().recipes,le=>le.recipeUuid,(le,B)=>{const ee=D(()=>$(e(B).recipeUuid)),y=D(()=>j(e(B).recipeUuid));var z=Da(),te=s(z);Ue(te,{class:"h-4 w-4"});var be=i(te,2),Me=s(be),ze=i(be,2),me=s(ze),Ae=i(me);Xe(Ae,{size:12}),I((qe,Fe)=>{G(z,1,`badge badge-lg ${qe??""} h-auto gap-2 py-1 font-medium ${e(y)?"ring-error ring-1":""}`),Q(Me,Fe),Q(me,`${e(B).plates??""} `)},[()=>se(e(B).typeR,e(y)),()=>e(ee)?.title||Z(e(B).recipeUuid)]),c(le,z)}),c(S,X)},M=S=>{var X=Ca();c(S,X)};A(f,S=>{t().recipes.length>0?S(h):S(M,!1)})}c(a,n)};A(ie,a=>{o()?a(ne):a(ve,!1)})}I((a,n)=>{G(L,1,`card bg-base-100 border-base-200 border shadow-sm transition-all hover:shadow-md ${o()?"ring-accent/40 ring-2":""} ${o()||u()?"":"hover:ring-accent/60 cursor-pointer hover:ring-2"} ${u()?"opacity-75":""}`),oe(L,"tabindex",o()||u()?-1:0),G(m,1,`text-primary text-lg font-medium ${(e(C)&&"text-error")??""}`),Q(H,a),G(pe,1,`font-base flex items-center gap-1 ${(e(C)&&"text-error")??""}`),Q(K,n),Q(Te,` ${t().guests??""} pers.`)},[()=>t().date?Ht(t().date):"Date non définie",()=>e(E)?e(E).toUpperCase():"REPAS"]),c(l,L),ut()}ct(["click","keydown","change"]);export{Ia as E,la as f};
