import{P as At,S as zt,f as qt,i as Ee,U as Ft,ao as It,ap as Lt,aq as lt,T as Nt,ai as ot,w as $e,X as jt,v as Bt,ar as Gt}from"./icons.js";import{Z as pt,d as _t,p as te,q as I,Y as Te,a1 as ye,m as e,u as w,v as o,V as u,g as s,h as i,a2 as M,b as v,c as ft,aQ as Vt,ap as dt,W as L,a4 as le,a9 as Oe,a3 as Je,e as et,_ as W,X as K,a8 as Wt,aM as ct,ak as Zt,k as Ht,aA as vt,aN as Kt}from"./appwrite.js";import{k as Qt}from"./keyboardNavigation.svelte.js";import{C as Xt}from"./ConfirmModal.js";import{f as Yt}from"./products-display.js";import{e as $t,a as ut,d as Jt}from"./date-helpers.js";function ea(n,a,t,c){e(a)?t():c()}function ta(n,a,t,c,d,b,p,k,C,R,_){if(n.key==="Escape"){n.preventDefault(),a();return}if(!e(t)||!e(c).length){n.key==="Enter"&&e(d).trim().length>1&&!e(b)&&(n.preventDefault(),p());return}n.key==="ArrowDown"?(n.preventDefault(),o(k,e(k)+1),C()):n.key==="ArrowUp"?(n.preventDefault(),o(k,e(k)-1),C()):n.key==="Enter"&&e(R)>=0&&(n.preventDefault(),_(e(c)[e(R)]))}var aa=(n,a,t)=>a(e(t)),ra=u('<span class="text-base-content/70 text-xs font-normal"> </span>'),sa=u('<span class="badge badge-ghost badge-sm text-xs opacity-70">brouillon</span>'),ia=u('<button type="button" role="option"><div class="bg-base-200 rounded p-1"><!></div> <div class="flex min-w-0 flex-1 flex-wrap items-center gap-2"><span class="truncate text-sm font-medium"> </span> <!> <!></div></button>'),na=u('<div id="recipes-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"></div>'),la=u('<div class="mt-2"><div class="relative"><div class="input flex w-full items-center gap-2 pr-10"><!> <input type="text" placeholder="Rechercher une recette..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="recipes-list"/> <!></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div>'),oa=u('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center justify-between"><h6 class="flex items-center gap-2"><!> Ajouter une recette</h6></div> <!></div></div>');function da(n,a){_t(a,!0);let t=te(a,"defaultPlates",3,4),c=te(a,"autoFocus",3,!1),d=te(a,"disabled",3,!1),b=I(""),p=I(void 0),k=I(Te(t())),C=I(null),R=!1,_=I(0),A=I(!1),E=I(void 0),Z=I(void 0),N=w(()=>e(A)&&!e(b).trim()?Je.getAllRecipes():e(b).trim().length<2?[]:Je.searchRecipes(e(b))),oe=w(()=>e(N).length>0),T=w(()=>e(oe)||e(A)),g=w(()=>e(N).length>0?e(_)===-1?0:e(_)%e(N).length:-1);ye(()=>{if(e(T)){const h=B=>{e(E)&&!e(E).contains(B.target)&&ae()};return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}}});function O(){o(C,null),o(b,""),o(k,t()),o(_,0),o(A,!1)}function Q(){o(A,!0),o(b,""),o(_,0)}function ae(){o(A,!1),o(b,""),o(_,0)}function X(h){o(C,h,!0);const B=h.typeR;o(p,e(p)?e(p):B,!0),a.onSelect(h,e(p),e(k)),O()}function H(){if(e(g)>=0&&e(Z)){const h=e(Z).querySelector(`#recipe-${e(g)}`);h&&h.scrollIntoView({block:"nearest"})}}var j=oa(),Y=s(j),de=s(Y),ce=s(de),ve=s(ce);At(ve,{class:"text-primary h-4 w-4"});var $=i(de,2);{var we=h=>{var B=la(),be=s(B),ke=s(be),ue=s(ke);zt(ue,{class:"h-4 w-4 opacity-50"});var G=i(ue,2);G.__keydown=[ta,ae,T,N,b,A,Q,_,H,g,X],Vt(G,()=>Qt({shouldFocus:c(),onEmptySubmit:a.onEmptySubmit}));var Pe=i(G,2);M(Pe,P=>{});var re=i(ke,2);re.__click=[ea,T,ae,Q];var Me=s(re);{let P=w(()=>e(T)?"rotate-180":"");qt(Me,{get class(){return`h-4 w-4 transition-transform ${e(P)??""}`}})}var Re=i(re,2);{var Ae=P=>{var me=na();et(me,23,()=>e(N),se=>se.$id,(se,ie,pe)=>{var V=ia();V.__click=[aa,X,ie],V.disabled=R;var Se=s(V),ze=s(Se);Ee(ze,{class:"h-4 w-4 opacity-70"});var r=i(Se,2),l=s(r),f=s(l),m=i(l,2);{var z=S=>{var D=ra(),ee=s(D);L(()=>K(ee,`(${e(ie).versionLabel??""})`)),v(S,D)};M(m,S=>{e(ie).versionLabel&&S(z)})}var q=i(m,2);{var J=S=>{var D=sa();v(S,D)};M(q,S=>{e(ie).draft&&S(J)})}L(()=>{le(V,"id",`recipe-${e(pe)??""}`),W(V,1,`hover:bg-base-200 flex w-full items-center gap-2 px-4 py-3 text-left hover:cursor-pointer ${e(pe)===e(g)?"bg-base-200":""}`),le(V,"aria-selected",e(pe)===e(g)),K(f,e(ie).title)}),Wt("mouseenter",V,()=>o(_,e(pe),!0)),v(se,V)}),dt(me,se=>o(Z,se),()=>e(Z)),v(P,me)};M(Re,P=>{e(T)&&e(N).length>0&&P(Ae)})}dt(B,P=>o(E,P),()=>e(E)),L(()=>{G.disabled=d(),le(G,"aria-expanded",e(T)),le(G,"aria-activedescendant",e(T)?`recipe-${e(g)}`:void 0),re.disabled=d(),le(re,"aria-label",e(T)?"Fermer le menu":"Ouvrir le menu")}),Oe(G,()=>e(b),P=>o(b,P)),v(h,B)};M($,h=>{e(C)||h(we)})}v(n,j),ft()}pt(["keydown","click"]);function ca(n){const a=n-1;return a*a*a+1}function va(n,{from:a,to:t},c={}){var{delay:d=0,duration:b=H=>Math.sqrt(H)*120,easing:p=ca}=c,k=getComputedStyle(n),C=k.transform==="none"?"":k.transform,[R,_]=k.transformOrigin.split(" ").map(parseFloat);R/=n.clientWidth,_/=n.clientHeight;var A=ua(n),E=n.clientWidth/t.width/A,Z=n.clientHeight/t.height/A,N=a.left+a.width*R,oe=a.top+a.height*_,T=t.left+t.width*R,g=t.top+t.height*_,O=(N-T)*E,Q=(oe-g)*Z,ae=a.width/t.width,X=a.height/t.height;return{delay:d,duration:typeof b=="function"?b(Math.sqrt(O*O+Q*Q)):b,easing:p,css:(H,j)=>{var Y=j*O,de=j*Q,ce=H+j*ae,ve=H+j*X;return`transform: ${C} translate(${Y}px, ${de}px) scale(${ce}, ${ve});`}}}function ua(n){if("currentCSSZoom"in n)return n.currentCSSZoom;for(var a=n,t=1;a!==null;)t*=+getComputedStyle(a).zoom,a=a.parentElement;return t}function pa(n,a,t,c){a().recipes.length>0?o(t,!0):c.onDelete()}var _a=(n,a,t)=>{(n.key==="Enter"||n.key===" ")&&!a()&&t()},fa=(n,a)=>{a(!1)},ba=u(`<button class="btn btn-ghost text-primary" title="Terminer l'édition">valider</button> <button class="btn btn-ghost btn-square text-error" title="Supprimer"><!></button>`,1),ma=(n,a,t)=>{a(!0),t.onEditToggle&&t.onEditToggle()},ga=u('<button class="btn btn-ghost" title="Éditer"><!></button>'),ha=(n,a,t)=>a({newDate:e(t)}),xa=u('<p class="text-error mt-1 text-xs">Cette date/heure est déjà utilisée</p>'),ya=(n,a,t)=>a({newMoment:e(t)}),wa=u('<span class="text-error ms-2 text-sm font-normal">(Recette introuvable)</span>'),ka=(n,a,t,c)=>{a[t(e(c).recipeUuid)]=!1},Ra=(n,a,t,c,d)=>{a[t(e(c).recipeUuid)]=!1,e(c).hasOwnPlatesNb=!1,e(c).plates=d().guests},Sa=u('<div class="ring-base-300 flex items-center gap-1 rounded-xl p-1 ring-1"><div class="input w-28"><!> <input type="number" class="w-full text-center" min="1"/></div> <button class="btn btn-sm btn-circle me-1" title="Valider"><!></button> <button class="btn btn-sm btn-circle"><!></button></div>'),Da=(n,a,t,c)=>{const d=a(e(t).recipeUuid);c[d]=!0,e(t).hasOwnPlatesNb=!0},Ua=u('<button title="Éditer les couverts"><span class="font-normal"> </span> <!></button>'),Ca=(n,a,t)=>a(e(t).recipeUuid),Ea=u('<div><div class="flex flex-1 items-center gap-2"><div><!></div> <div class="min-w-56 flex-1"><div class="font-medium"> <!></div></div></div> <div class="me-10 flex items-center gap-2"><select class="select w-24"><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select> <!></div> <div class="ms-auto"><button class="btn btn-ghost btn-sm btn-square text-error" title="Retirer la recette"><!></button></div></div>'),Ta=u('<div class="mb-4 space-y-2"></div>'),Oa=u('<div class="mt-2 space-y-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><fieldset><label><span class="label">Date</span> <input type="date" class="w-full"/></label> <!></fieldset> <label class="select"><span class="label">Moment</span> <select><option disabled selected>Choisir un moment</option><option>Matin</option><option>Midi</option><option>Soir</option></select></label> <div><label class="input"><span class="label"><!> Couverts</span> <input type="number" class="w-full" min="1"/></label> <p class="text-base-content/60 pl-2 text-xs">Peut etre modifié individuellement pour chaque recette</p></div></div> <div class="space-y-2 py-4"><div class="flex items-center justify-between"><div class="text-base-content/70 flex items-center gap-2 font-medium"><!> Recettes</div></div> <!> <!></div></div>'),Pa=u('<div><!> <span> </span> <span class="badge badge-sm badge-outline font-normal"> <!></span></div>'),Ma=u('<div class="flex flex-wrap gap-2"></div>'),Aa=u('<p class="text-base-content/60 text-sm italic">Aucune recette</p>'),za=u('<div class="space-y-2"><!></div>'),qa=u('<div role="button"><div class="card-body p-4"><div class="mb-2 flex items-start justify-between"><div class="flex flex-wrap items-center gap-4"><span> </span> <div><!> <div> </div></div> <div class="text-base-content/80 flex items-center gap-1 font-semibold"><!> </div></div> <div class="flex gap-1"><!></div></div> <!></div> <!></div>');function Va(n,a){_t(a,!0);let t=te(a,"meal",15),c=te(a,"defaultGuests",3,100),d=te(a,"isEditing",15,!1),b=te(a,"allDates",19,()=>[]),p=te(a,"disabled",3,!1);ye(()=>{p()&&d()&&d(!1)});let k=!1;t().guests||t(t().guests=c(),!0),t().recipes||t(t().recipes=[],!0);let C=w(()=>ut(t().date||"")),R=I(Te($t(t().date||""))),_=I(Te(ut(t().date||""))),A=w(()=>e(_)?Jt(e(R),e(_)):""),E=w(()=>t().date?b().filter(l=>l===t().date).length>1:!1);function Z({newDate:r="",newMoment:l=""}){t().date,(r||l)&&t(t().date=e(A),!0)}const N=w(()=>{const r=e(C)||"";return r==="matin"?It:r==="midi"?Lt:r==="soir"?lt:lt}),oe={entree:1,plat:2,dessert:3,autre:4};function T(r){return[...r].sort((l,f)=>{const m=oe[l.typeR],z=oe[f.typeR];return m-z})}ye(()=>{const r=T(t().recipes);t().recipes.some((f,m)=>f.recipeUuid!==r[m]?.recipeUuid)&&ct(()=>{t(t().recipes=r,!0)})});let g=Te({});function O(r){return`${t().id}-${r}`}ye(()=>{t().recipes.forEach(r=>{const l=O(r.recipeUuid);g[l]===void 0&&(g[l]=!1)})}),ye(()=>{const r=t().guests;t().recipes.forEach(l=>{!l.hasOwnPlatesNb&&!g[O(l.recipeUuid)]&&l.plates!==r&&ct(()=>{l.plates=r})})});function Q(r){if(t().recipes.some(m=>m.recipeUuid===r.$id))return;const f={recipeUuid:r.$id,plates:t().guests,typeR:r.typeR,hasOwnPlatesNb:!1};t(t().recipes=[...t().recipes,{...f}],!0)}function ae(r){t(t().recipes=t().recipes.filter(l=>l.recipeUuid!==r),!0)}function X(r){return Je.getRecipeIndexByUuid(r)}function H(r){return r.split("_")[0]}function j(r){return!X(r)}let Y=I(!1);function de(){o(Y,!1),a.onDelete()}function ce(){p()||d()&&a.onEditToggle||!d()&&a.onEditToggle&&a.onEditToggle()}function ve(r,l=!1){return l?"badge-error":r==="entree"?"bg-lime-100 border-lime-200":r==="plat"?"bg-orange-100 border-orange-200":r==="dessert"?"bg-pink-100 border-pink-200":r==="autre"?"bg-purple-100 border-purple-200":"bg-base-200"}var $=qa();$.__click=ce,$.__keydown=[_a,d,ce];var we=s($),h=s(we),B=s(h),be=s(B),ke=s(be),ue=i(be,2),G=s(ue);Zt(G,()=>e(N),(r,l)=>{l(r,{size:16})});var Pe=i(G,2),re=s(Pe),Me=i(ue,2),Re=s(Me);Ft(Re,{class:"size-4 stroke-3"});var Ae=i(Re),P=i(B,2),me=s(P);{var se=r=>{var l=ba(),f=Ht(l);f.__click=[fa,d];var m=i(f,2);m.__click=[pa,t,Y,a];var z=s(m);Nt(z,{class:"h-4 w-4"}),L(()=>{f.disabled=p(),m.disabled=p()}),v(r,l)},ie=r=>{var l=ga();l.__click=[ma,d,a];var f=s(l);ot(f,{class:"h-4 w-4"}),L(()=>l.disabled=p()),v(r,l)};M(me,r=>{d()?r(se):r(ie,!1)})}var pe=i(h,2);{var V=r=>{var l=Oa(),f=s(l),m=s(f),z=s(m),q=i(s(z),2);q.__change=[ha,Z,R];var J=i(z,2);{var S=U=>{var De=xa();v(U,De)};M(J,U=>{e(E)&&U(S)})}var D=i(m,2),ee=i(s(D),2);ee.__change=[ya,Z,_];var _e=s(ee);_e.value=_e.__value="";var ne=i(_e);ne.value=ne.__value="matin";var fe=i(ne);fe.value=fe.__value="midi";var ge=i(fe);ge.value=ge.__value="soir";var qe=i(D,2),Fe=s(qe),he=s(Fe),Ie=s(he);$e(Ie,{class:"text-base-content/50 me-1 h-4 w-4"});var Le=i(he,2),Ne=i(f,2),tt=s(Ne),bt=s(tt),mt=s(bt);Ee(mt,{class:"size-5"});var at=i(tt,2);{var gt=U=>{var De=Ta();et(De,31,()=>t().recipes,je=>je.recipeUuid,(je,x,Fa)=>{const xt=w(()=>X(e(x).recipeUuid)),Be=w(()=>j(e(x).recipeUuid));var Ue=Ea(),rt=s(Ue),Ge=s(rt),yt=s(Ge);Ee(yt,{class:"h-5 w-5"});var wt=i(Ge,2),kt=s(wt),st=s(kt),Rt=i(st);{var St=y=>{var F=wa();v(y,F)};M(Rt,y=>{e(Be)&&y(St)})}var it=i(rt,2),Ve=s(it),We=s(Ve);We.value=We.__value="entree";var Ze=i(We);Ze.value=Ze.__value="plat";var He=i(Ze);He.value=He.__value="dessert";var nt=i(He);nt.value=nt.__value="autre";var Dt=i(Ve,2);{var Ut=y=>{var F=Sa(),xe=s(F),Ce=s(xe);$e(Ce,{class:"h-4 w-4 opacity-50"});var Qe=i(Ce,2),Xe=i(xe,2);Xe.__click=[ka,g,O,x];var Ot=s(Xe);Bt(Ot,{class:"text-success h-4 w-4"});var Ye=i(Xe,2);Ye.__click=[Ra,g,O,x,t];var Pt=s(Ye);Gt(Pt,{class:"text-secondary h-4 w-4"}),L(()=>le(Ye,"title",`Revenir au nombre de couvert du repas (${t().guests??""})`)),Oe(Qe,()=>e(x).plates,Mt=>e(x).plates=Mt),v(y,F)},Ct=y=>{var F=Ua();F.__click=[Da,O,x,g];var xe=s(F),Ce=s(xe),Qe=i(xe,2);ot(Qe,{size:14,class:"text-base-content/70  ms-1"}),L(()=>{W(F,1,`btn ${e(x).hasOwnPlatesNb?"btn-soft btn-warning":"btn-ghost"}`),K(Ce,`${e(x).plates??""}
                          pers.`)}),v(y,F)};M(Dt,y=>{g[O(e(x).recipeUuid)]?y(Ut):y(Ct,!1)})}var Et=i(it,2),Ke=s(Et);Ke.__click=[Ca,ae,x];var Tt=s(Ke);jt(Tt,{class:"h-4 w-4"}),L((y,F)=>{W(Ue,1,`bg-base-200 flex flex-wrap items-center gap-3 rounded-lg p-3 ${(e(Be)&&"border-error border-2")??""}`),W(Ge,1,`${y??""} rounded-md border-2 p-2`),K(st,`${F??""} `),Ke.disabled=p()},[()=>ve(e(x).typeR,e(Be)),()=>e(xt)?.title||H(e(x).recipeUuid)]),vt(Ve,()=>e(x).typeR,y=>e(x).typeR=y),Kt(Ue,()=>va,()=>({duration:200})),v(je,Ue)}),v(U,De)};M(at,U=>{t().recipes.length>=1&&U(gt)})}var ht=i(at,2);da(ht,{onSelect:Q,get defaultPlates(){return t().guests},autoFocus:k,get onEmptySubmit(){return a.onEmptySearchSubmit},get disabled(){return p()}}),L(()=>{W(z,1,`input ${e(E)?"input-error":""}`),W(ee,1,`w-full ${e(E)?"select-error":""}`)}),Oe(q,()=>e(R),U=>o(R,U)),vt(ee,()=>e(_),U=>o(_,U)),Oe(Le,()=>t().guests,U=>t(t().guests=U,!0)),v(r,l)},Se=r=>{var l=za(),f=s(l);{var m=q=>{var J=Ma();et(J,21,()=>t().recipes,S=>S.recipeUuid,(S,D)=>{const ee=w(()=>X(e(D).recipeUuid)),_e=w(()=>j(e(D).recipeUuid));var ne=Pa(),fe=s(ne);Ee(fe,{class:"h-4 w-4"});var ge=i(fe,2),qe=s(ge),Fe=i(ge,2),he=s(Fe),Ie=i(he);$e(Ie,{size:12}),L((Le,Ne)=>{W(ne,1,`badge badge-lg ${Le??""} h-auto gap-2 py-1 font-medium ${e(_e)?"ring-error ring-1":""}`),K(qe,Ne),K(he,`${e(D).plates??""} `)},[()=>ve(e(D).typeR,e(_e)),()=>e(ee)?.title||H(e(D).recipeUuid)]),v(S,ne)}),v(q,J)},z=q=>{var J=Aa();v(q,J)};M(f,q=>{t().recipes.length>0?q(m):q(z,!1)})}v(r,l)};M(pe,r=>{d()?r(V):r(Se,!1)})}var ze=i(we,2);{let r=w(()=>`Ce repas contient ${t().recipes.length} recette(s). Êtes-vous sûr de vouloir le supprimer ?`);Xt(ze,{get isOpen(){return e(Y)},title:"Supprimer le repas",get message(){return e(r)},variant:"danger",confirmLabel:"Supprimer",cancelLabel:"Annuler",onConfirm:de,onCancel:()=>o(Y,!1)})}L((r,l)=>{W($,1,`card bg-base-100 border-base-200 border shadow-sm transition-all hover:shadow-md ${d()?"ring-accent/40 ring-2":""} ${d()||p()?"":"hover:ring-accent/60 cursor-pointer hover:ring-2"} ${p()?"opacity-75":""}`),le($,"tabindex",d()||p()?-1:0),W(be,1,`text-primary text-lg font-medium ${(e(E)&&"text-error")??""}`),K(ke,r),W(ue,1,`font-base flex items-center gap-1 ${(e(E)&&"text-error")??""}`),K(re,l),K(Ae,` ${t().guests??""} pers.`)},[()=>t().date?Yt(t().date):"Date non définie",()=>e(C)?e(C).toUpperCase():"REPAS"]),v(n,$),ft()}pt(["click","keydown","change"]);export{Va as E,va as f};
