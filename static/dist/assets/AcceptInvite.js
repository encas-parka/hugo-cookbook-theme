import{a9 as $,b as ee,aa as ae,W as x,$ as M,v as c,w as te,x as se,a,s as _,Z as re,g as e,A as i,D,E as V,B as d,X as L,Y as ie,a1 as S}from"./vendor.js";import{L as ne,M as T,b as P,N as le,y as j}from"./appwrite.js";import{n as U}from"./index.js";import{D as oe}from"./icons.js";import"./editor.js";import"./markdown.js";async function ce(q,v,s,r){if(!e(v)||e(v).trim().length===0){alert("Veuillez saisir votre pseudo / nom.");return}if(e(s).length<8){alert("Le mot de passe doit faire au moins 8 caractÃ¨res.");return}a(r,!0);try{const{client:n,account:p}=await P();await p.updatePassword({password:e(s)}),e(v)&&await p.updateName({name:e(v)}),console.log("[AcceptInvite] Session crÃ©Ã©e, redirection..."),j("/dashboard")}catch(n){console.error("[AcceptInvite] Erreur finalisation:",n),alert("Erreur : "+n.message),a(r,!1)}}var de=x(`<span class="loading loading-spinner loading-lg text-primary mx-auto"></span> <p class="text-base-content/70 mt-4">VÃ©rification de l'invitation...</p>`,1),ve=()=>j("/"),pe=x(`<!> <h2 class="text-error text-xl font-bold">Oups !</h2> <p class="py-4"> </p> <button class="btn btn-ghost">Retour Ã  l'accueil</button>`,1),ue=x('<span class="loading loading-spinner loading-xs"></span>'),me=x(`<div class="mb-2 text-4xl">ðŸ‘‹</div> <h2 class="card-title justify-center text-2xl">Bienvenue !</h2> <p class="text-base-content/70 mb-6 text-sm">Votre invitation est validÃ©e. <br/> Veuillez dÃ©finir un mot de passe.</p> <label class="w-full text-left"><div class="label"><span class="label-text">Votre Pseudo / Nom</span> <span class="label-text-alt text-error">*</span></div> <input type="text" class="input w-full" required maxlength="25"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Nouveau mot de passe</span></div> <input type="password" placeholder="Minimum 8 caractÃ¨res" class="input w-full"/></label> <div class="card-actions mt-6"><button class="btn btn-primary w-full"><!> Terminer l'inscription</button></div>`,1),fe=x('<div class="bg-base-200 flex min-h-screen items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body text-center"><!></div></div></div>');function ye(q,v){se(v,!0);let s=_(!0),r=_("verifying"),n=_(""),p=_(""),w=_(""),m="",h="",y="";$(async()=>{if(ne(),m=T("userId")||"",h=T("eventId")||"",y=T("teamId")||"",!m||!h&&!y){a(r,"error"),a(n,"Lien d'invitation incomplet ou invalide."),a(s,!1);return}try{console.log("[AcceptInvite] Initialisation...",{userId:m,eventId:h,teamId:y});const{client:t,account:l}=await P(),{token:E}=await le(m,h,y);console.log("[AcceptInvite] Token reÃ§u, crÃ©ation session..."),await l.createSession({userId:m,secret:E});const f=await l.get();if(console.log("[AcceptInvite] ConnectÃ© en tant que :",f.name),a(w,f.name,!0),f.passwordUpdate){j("/dashboard");return}a(r,"set-password")}catch(t){console.error("[AcceptInvite] Erreur validation:",t),a(r,"error"),a(n,t.message||"Ce lien d'invitation est invalide.",!0)}finally{a(s,!1)}}),ee(()=>{U.setConfig({title:"Rejoindre l'Ã©quipe"})}),ae(()=>{U.reset()});var z=fe(),R=i(z),F=i(R),O=i(F);{var Q=t=>{var l=de();c(t,l)},W=t=>{var l=D(),E=V(l);{var f=u=>{var b=pe(),I=V(b);oe(I,{class:"text-error mb-2 size-7"});var A=d(I,4),g=i(A),k=d(A,2);k.__click=[ve],L(()=>ie(g,e(n))),c(u,b)},X=u=>{var b=D(),I=V(b);{var A=g=>{var k=me(),B=d(V(k),6),Y=d(i(B),2),C=d(B,2),Z=d(i(C),2),G=d(C,2),N=i(G);N.__click=[ce,w,p,s];var H=i(N);{var J=o=>{var K=ue();c(o,K)};M(H,o=>{e(s)&&o(J)})}L(()=>N.disabled=e(s)),S(Y,()=>e(w),o=>a(w,o)),S(Z,()=>e(p),o=>a(p,o)),c(g,k)};M(I,g=>{e(r)==="set-password"&&g(A)},!0)}c(u,b)};M(E,u=>{e(r)==="error"?u(f):u(X,!1)},!0)}c(t,l)};M(O,t=>{e(s)&&e(r)!=="set-password"?t(Q):t(W,!1)})}c(q,z),te()}re(["click"]);export{ye as default};
