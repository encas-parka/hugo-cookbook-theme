import{D as $}from"./icons.js";import{af as ee,a1 as ae,ag as te,V as x,a2 as V,b as c,c as se,d as re,aH as ne,aI as T,v as a,D as P,aJ as ie,q as _,a0 as z,Z as le,m as e,g as n,j as S,k as j,h as d,W as U,X as oe,a4 as B}from"./appwrite.js";import{n as L}from"./index.js";async function ce(C,v,s,r){if(!e(v)||e(v).trim().length===0){alert("Veuillez saisir votre pseudo / nom.");return}if(e(s).length<8){alert("Le mot de passe doit faire au moins 8 caractÃ¨res.");return}a(r,!0);try{const{client:i,account:p}=await P();await p.updatePassword({password:e(s)}),e(v)&&await p.updateName({name:e(v)}),console.log("[AcceptInvite] Session crÃ©Ã©e, redirection..."),z("/dashboard")}catch(i){console.error("[AcceptInvite] Erreur finalisation:",i),alert("Erreur : "+i.message),a(r,!1)}}var de=x(`<span class="loading loading-spinner loading-lg text-primary mx-auto"></span> <p class="text-base-content/70 mt-4">VÃ©rification de l'invitation...</p>`,1),ve=()=>z("/"),pe=x(`<!> <h2 class="text-error text-xl font-bold">Oups !</h2> <p class="py-4"> </p> <button class="btn btn-ghost">Retour Ã  l'accueil</button>`,1),ue=x('<span class="loading loading-spinner loading-xs"></span>'),fe=x(`<div class="mb-2 text-4xl">ðŸ‘‹</div> <h2 class="card-title justify-center text-2xl">Bienvenue !</h2> <p class="text-base-content/70 mb-6 text-sm">Votre invitation est validÃ©e. <br/> Veuillez dÃ©finir un mot de passe.</p> <label class="w-full text-left"><div class="label"><span class="label-text">Votre Pseudo / Nom</span> <span class="label-text-alt text-error">*</span></div> <input type="text" class="input w-full" required maxlength="25"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Nouveau mot de passe</span></div> <input type="password" placeholder="Minimum 8 caractÃ¨res" class="input w-full"/></label> <div class="card-actions mt-6"><button class="btn btn-primary w-full"><!> Terminer l'inscription</button></div>`,1),me=x('<div class="bg-base-200 flex min-h-screen items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body text-center"><!></div></div></div>');function xe(C,v){re(v,!0);let s=_(!0),r=_("verifying"),i=_(""),p=_(""),w=_(""),f="",h="",I="";ee(async()=>{if(ne(),f=T("userId")||"",h=T("eventId")||"",I=T("teamId")||"",!f||!h&&!I){a(r,"error"),a(i,"Lien d'invitation incomplet ou invalide."),a(s,!1);return}try{console.log("[AcceptInvite] Initialisation...",{userId:f,eventId:h,teamId:I});const{client:t,account:l}=await P(),{token:q}=await ie(f,h,I);console.log("[AcceptInvite] Token reÃ§u, crÃ©ation session..."),await l.createSession({userId:f,secret:q});const m=await l.get();if(console.log("[AcceptInvite] ConnectÃ© en tant que :",m.name),a(w,m.name,!0),m.passwordUpdate){z("/dashboard");return}a(r,"set-password")}catch(t){console.error("[AcceptInvite] Erreur validation:",t),a(r,"error"),a(i,t.message||"Ce lien d'invitation est invalide.",!0)}finally{a(s,!1)}}),ae(()=>{L.setConfig({title:"Rejoindre l'Ã©quipe"})}),te(()=>{L.reset()});var D=me(),R=n(D),F=n(R),H=n(F);{var J=t=>{var l=de();c(t,l)},O=t=>{var l=S(),q=j(l);{var m=u=>{var b=pe(),y=j(b);$(y,{class:"text-error mb-2 size-7"});var k=d(y,4),g=n(k),A=d(k,2);A.__click=[ve],U(()=>oe(g,e(i))),c(u,b)},Q=u=>{var b=S(),y=j(b);{var k=g=>{var A=fe(),E=d(j(A),6),W=d(n(E),2),N=d(E,2),X=d(n(N),2),Z=d(N,2),M=n(Z);M.__click=[ce,w,p,s];var G=n(M);{var K=o=>{var Y=ue();c(o,Y)};V(G,o=>{e(s)&&o(K)})}U(()=>M.disabled=e(s)),B(W,()=>e(w),o=>a(w,o)),B(X,()=>e(p),o=>a(p,o)),c(g,A)};V(y,g=>{e(r)==="set-password"&&g(k)},!0)}c(u,b)};V(q,u=>{e(r)==="error"?u(m):u(Q,!1)},!0)}c(t,l)};V(H,t=>{e(s)&&e(r)!=="set-password"?t(J):t(O,!1)})}c(C,D),se()}le(["click"]);export{xe as default};
