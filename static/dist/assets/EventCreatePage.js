import{ah as sa,t as ra,W as ia,P as ge,p as na}from"./icons.js";import{q as b,Y as _e,a1 as ee,V as v,g as t,a2 as j,W as U,a9 as be,m as e,b as c,c as la,d as da,u as F,A as H,aM as oa,h as n,v as l,C as ae,y as xe,z as ca,a0 as va,k as W,ax as he,Z as ua,aC as pa,X as O,j as ma,e as ye,_ as fa,az as ga,aD as _a,aB as ba,aN as xa}from"./appwrite.js";import{E as ha,f as ya}from"./EventMealCard.js";import{F as we}from"./Fieldset.js";import{n as De}from"./index.js";import"./keyboardNavigation.svelte.js";import"./ConfirmModal.js";import"./products-display.js";import"./date-helpers.js";async function wa(M,m,$){l(m,!0),await $()&&ae.success("Événement créé"),l(m,!1)}function Da(M,m){l(m,M.target.value,!0)}var Sa=v('<span class="loading loading-spinner loading-xs text-primary"></span>'),Ea=v('<div class="flex items-center gap-2"><button class="btn btn-accent"><!> <span class="font-bold">Créer</span></button></div>'),ka=(M,m)=>l(m,!1),Ma=(M,m)=>l(m,!1),$a=v('<p class="text-error mt-2 text-sm">Veuillez sélectionner un statut</p>'),Ta=v('<div class="space-y-3"><label class="flex cursor-pointer items-center gap-3"><input type="radio" class="radio radio-primary"/> <div class="flex-1"><div class="font-medium">Proposition</div> <div class="text-sm opacity-70">En attente de confirmation</div></div></label> <label class="flex cursor-pointer items-center gap-3"><input type="radio" class="radio radio-primary"/> <div class="flex-1"><div class="font-medium">Confirmé</div> <div class="text-sm opacity-70">Événement validé</div></div></label></div> <!>',1),Ca=v(`<div class="flex items-center justify-center py-20"><div class="flex flex-col items-center gap-4"><span class="loading loading-spinner loading-lg text-primary"></span> <p class="text-base-content/60">Création de l'événement...</p></div></div>`),Va=(M,m,$)=>m(e($).$id),ja=v('<label><input type="checkbox" class="checkbox checkbox-sm checkbox-secondary"/> <div class="flex flex-col"><span class="text-sm font-medium"> <span class="text-xs opacity-60"> </span></span> <div class="text-xs opacity-70"> </div></div></label>'),Ia=v(`<label class="cursor-pointer justify-center gap-4"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="ms-1">Envoyer un email de notification aux membres des équipes</span></label> <p class="text-base-content/60 mt-1 text-xs">Si désactivé, les membres auront accès à l'événement mais ne
                recevront pas d'email.</p>`,1),za=v(`<fieldset class="fieldset mb-6"><legend class="fieldset-legend">Minimum de participant·es</legend> <label class="input"><input type="number" min="1" max="100" placeholder="1"/></label> <p class="fieldset-label text-base-content/60">Combien faudrait-il être pour tout gérer ?</p></fieldset> <fieldset class="fieldset mb-4"><legend class="fieldset-legend">Sélectionnez les équipes à inviter à l'événement :</legend> <div class="flex flex-wrap gap-2"></div> <div class="text-base-content/70 alert alert-vertical mt-4 text-sm"><!> Une fois l'événement crée, il vous sera possible d'inviter des personnes
                individuellement, indépendamment des équipes.</div></fieldset> <!>`,1),Pa=v(`<p class="text-sm italic opacity-60">Vous ne faites partie d'aucune équipe.</p>`),Aa=v('<div class="text-base-content/60 bg-base-200 rounded-box border-base-200 flex flex-col items-center justify-center border-2 border-dashed py-12"><div class="bg-base-200 mb-4 rounded-full p-4"><!></div> <p class="font-medium">Aucun repas planifié</p> <p class="mt-1 text-sm">Commencez par ajouter un repas à votre événement</p></div>'),qa=v("<div><!></div>"),Na=v('<div class="space-y-4"></div>'),Fa=v('<div class="grid grid-cols-1 gap-6 lg:grid-cols-3"><div class="space-y-6 lg:col-span-1"><!></div> <div class="space-y-6 md:px-4 lg:col-span-2"><div class="mb-6 flex items-center justify-between"><h3> </h3> <button class="btn btn-primary btn-sm"><!> Ajouter un repas</button></div> <!> <div class="flex"><button class="btn btn-outline btn-primary btn-block mt-4"><!> Ajouter un repas</button></div></div></div>'),Ha=v(`<div class="bg-base-200 min-h-lvh space-y-10 px-2 pt-4 pb-20 md:px-30 md:pb-20"><div class="card bg-base-100"><div class="card-body"><div class="card-title mb-4"><!> Création d'un événement</div> <p>La création d'événement permet d'organiser des menus sur plusieurs
        jours, se répartir les taches (une fois l'événement crée), gérer une
        liste de courses générées à partir des ingrédients des recettes, générer
        des affiches de menus...</p></div></div> <div class="flex flex-col justify-between gap-6"><div class="min-w-80 flex-1 gap-2"><input type="text" class="input input-lg min-w-2/3 shadow-md" placeholder="Nom de l'événement"/></div> <div class="flex flex-wrap gap-x-10 gap-y-6"><div class="span-2 flex min-w-xs flex-1 flex-col"><textarea class="textarea shamd-sm w-full" placeholder="Décrivez l'événement..." maxlength="3000" rows="9"></textarea> <p class="label ms-auto me-2 text-end text-sm"> </p></div> <div class="align-start md:min-w-96"><!></div></div></div> <!></div>`);function Ga(M,m){da(m,!0);const $=[],te=a=>{var s=Ea(),r=t(s);r.__click=[wa,P,$e];var i=t(r);{var d=f=>{var w=Sa();c(f,w)},o=f=>{ra(f,{size:18,class:"mr-1"})};j(i,f=>{e(P)?f(d):f(o,!1)})}U(()=>r.disabled=e(P)||!e(Se)),c(a,s)};let u=b(_e([])),I=b(""),B=b(""),T=b(""),z=b(!1),P=b(!1),L=b(null);const y=F(()=>[...e(u)].sort((a,s)=>new Date(a.date).getTime()-new Date(s.date).getTime())),Se=F(()=>e(I).trim().length>0||e(u).length>0);let p=b(_e([])),X=b(!0);const Ee=F(()=>{const s=window.location.hash.split("?")[1];return s?new URLSearchParams(s).get("teamId"):null});ee(()=>{const a=e(Ee),s=H.myTeams;a&&s.some(r=>r.$id===a)&&oa(()=>{e(p).includes(a)||l(p,[a],!0)})});function ke(a){e(p).includes(a)?l(p,e(p).filter(s=>s!==a),!0):l(p,[...e(p),a],!0)}let se=b(1);ee(()=>{De.setConfig({actions:te})});function Me(){if(!e(I).trim())return{isValid:!1,errorMessage:"Veuillez renseigner le nom de l'événement"};if(e(u).length===0)return{isValid:!1,errorMessage:"Veuillez ajouter au moins un repas"};if(!e(T))return l(z,!0),{isValid:!1,errorMessage:"Veuillez sélectionner le statut de l'événement"};const s=e(u).map(r=>r.date).filter((r,i,d)=>d.indexOf(r)!==i);return s.length>0?{isValid:!1,errorMessage:`Certaines dates sont en double: ${s.map(i=>{try{return new Date(i).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return i}}).join(", ")}`}:(l(z,!1),{isValid:!0})}async function $e(){const a=Me();if(!a.isValid)return ae.error(a.errorMessage||"Erreur de validation"),!1;const s=[{id:xe.userId||"",name:xe.userName,status:"accepted",invitedAt:new Date().toISOString(),respondedAt:new Date().toISOString()}],r=Array.from(new Set(e(y).map(o=>o.date))).sort(),i=e(p).map(o=>H.getTeamById(o)?.name||"").filter(Boolean),d={name:e(I),description:e(B),status:e(T),allDates:r,dateStart:r.length>0?r[0]:"",dateEnd:r.length>0?r[r.length-1]:"",teams:i,teamsId:e(p),contributors:s,meals:e(y)};try{const o=await ca.createEventWithTeams(d,e(p),e(X));return va(`/dashboard/eventEdit/${o.$id}`),!0}catch(o){return console.error("Erreur sauvegarde:",o),ae.error("Erreur lors de la création"),!1}}function re(){const a=_a(6);let s;if(e(y).length===0){const i=new Date;i.setDate(i.getDate()+7),i.setHours(20,0,0,0),s=i.toISOString()}else{const i=e(y)[e(y).length-1],d=new Date(i.date);d.getHours()<14?d.setHours(20,0,0,0):(d.setDate(d.getDate()+1),d.setHours(12,0,0,0)),s=d.toISOString()}const r={id:a,date:s,guests:100,recipes:[]};l(u,[...e(u),r],!0),l(L,a,!0)}function Te(a){l(u,e(u).filter(s=>s.id!==a),!0)}function Ce(a){l(L,e(L)===a?null:a,!0)}ee(()=>()=>{De.reset()});var ie=Ha(),ne=t(ie),Ve=t(ne),je=t(Ve),Ie=t(je);sa(Ie,{});var le=n(ne,2),de=t(le),Y=t(de);Y.__input=[Da,I];var ze=n(de,2),oe=t(ze),ce=t(oe),Pe=n(ce,2),Ae=t(Pe),qe=n(oe,2),Ne=t(qe);we(Ne,{legend:"Statut de l'événement",children:(a,s)=>{var r=Ta(),i=W(r),d=t(i),o=t(d);o.__change=[ka,z],o.value=o.__value="proposition";var f=n(d,2),w=t(f);w.__change=[Ma,z],w.value=w.__value="confirmed";var R=n(i,2);{var Z=g=>{var G=$a();c(g,G)};j(R,g=>{e(z)&&g(Z)})}he($,[],o,()=>{"proposition";return e(T)},g=>l(T,g)),he($,[],w,()=>{"confirmed";return e(T)},g=>l(T,g)),c(a,r)},$$slots:{default:!0}});var Fe=n(le,2);{var He=a=>{var s=Ca();c(a,s)},Oe=a=>{var s=Fa(),r=t(s),i=t(r);we(i,{legend:"Équipes participantes",children:(D,C)=>{var S=ma(),x=W(S);{var A=E=>{var V=za(),k=W(V),K=n(t(k),2),Ue=t(K),ue=n(k,2),pe=n(t(ue),2);ye(pe,21,()=>H.myTeams,h=>h.$id,(h,_)=>{var q=ja(),N=t(q);N.__change=[Va,ke,_];var Q=n(N,2),me=t(Q),fe=t(me),Ge=n(fe),Je=t(Ge),Ke=n(me,2),Qe=t(Ke);U((ea,aa,ta)=>{fa(q,1,`bg-secondary/10 hover:bg-secondary/20 flex cursor-pointer items-center gap-3 rounded-lg px-4 py-2 ${ea??""}`),ga(N,aa),O(fe,`${e(_).name??""} `),O(Je,`(${e(_).total??""} membre${e(_).total>1?"s":""})`),O(Qe,ta)},[()=>e(p).includes(e(_).$id)&&"ring-secondary ring-2",()=>e(p).includes(e(_).$id),()=>H.getTeamMemberNames(e(_).$id).join(", ")]),c(h,q)});var We=n(pe,2),Xe=t(We);ia(Xe,{class:"size-4 shrink-0"});var Ye=n(ue,2);{var Ze=h=>{var _=Ia(),q=W(_),N=t(q);ba(N,()=>e(X),Q=>l(X,Q)),c(h,_)};j(Ye,h=>{e(p).length>0&&h(Ze)})}be(Ue,()=>e(se),h=>l(se,h)),c(E,V)},J=E=>{var V=Pa();c(E,V)};j(x,E=>{H.myTeams.length>0?E(A):E(J,!1)})}c(D,S)},$$slots:{default:!0}});var d=n(r,2),o=t(d),f=t(o),w=t(f),R=n(f,2);R.__click=re;var Z=t(R);ge(Z,{class:"mr-1 h-4 w-4"});var g=n(o,2);{var G=D=>{var C=Aa(),S=t(C),x=t(S);na(x,{class:"h-8 w-8 opacity-50"}),c(D,C)},Be=D=>{var C=Na();ye(C,29,()=>e(y),S=>S.id,(S,x)=>{var A=qa(),J=t(A);{let E=F(()=>e(L)===e(x).id),V=F(()=>e(u).map(k=>k.date));ha(J,{get isEditing(){return e(E)},onEditToggle:()=>Ce(e(x).id||""),onDelete:()=>Te(e(x).id||""),get allDates(){return e(V)},disabled:!1,get meal(){return e(u)[e(u).findIndex(k=>k.id===e(x).id)]},set meal(k){e(u)[e(u).findIndex(K=>K.id===e(x).id)]=k}})}xa(A,()=>ya,()=>({delay:100,duration:400})),c(S,A)}),c(D,C)};j(g,D=>{e(y).length===0?D(G):D(Be,!1)})}var Le=n(g,2),ve=t(Le);ve.__click=re;var Re=t(ve);ge(Re,{class:"mr-1 h-4 w-4"}),U(()=>O(w,`Repas & Menus (${e(y).length??""})`)),c(a,s)};j(Fe,a=>{e(P)?a(He):a(Oe,!1)})}U(()=>{pa(Y,e(I)),Y.disabled=e(P),O(Ae,`${e(B).length??""}/3000 caractères`)}),be(ce,()=>e(B),a=>l(B,a)),c(M,ie),la()}ua(["click","input","change"]);export{Ga as default};
