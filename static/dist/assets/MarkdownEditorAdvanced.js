import{b3 as ue,b4 as ve,b5 as be,b6 as _e,I as De,J as Ge,b7 as Je,b8 as Qe,K as We,N as Xe,al as Ze,O as Ye,Q as $e}from"./icons.js";import{p as he,ag as et,ah as tt,V as O,a2 as k,ap as nt,W as B,b as w,c as rt,d as at,m as n,q as T,v as y,ao as ge,h as l,g as a,_ as h,a4 as pe,Z as st,X as fe,u as ot,j as me,k as ke}from"./appwrite.js";import{N as we,t as it,m as Q,a as lt,b as dt,c as ct,n as ut,d as vt,e as bt,T as J,f as _t,E as ht,i as gt,M as pt}from"./tiptap-markdown.es.js";var ft=we.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Q(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var d;const v=(d=t.attrs)!=null&&d.level?parseInt(t.attrs.level,10):1,r="#".repeat(v);return t.content?`${r} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>it({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),mt=ft,kt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,wt=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,yt=lt.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",Q(this.options.HTMLAttributes,t),0]},renderMarkdown:(t,e)=>`==${e.renderChildren(t)}==`,parseMarkdown:(t,e)=>e.applyMark("highlight",e.parseInline(t.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:t=>t.indexOf("=="),tokenize(t,e,d){const r=/^(==)([^=]+)(==)/.exec(t);if(r){const i=r[2].trim(),o=d.inlineTokens(i);return{type:"highlight",raw:r[0],text:i,tokens:o}}}},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ct({find:kt,type:this.type})]},addPasteRules(){return[dt({find:wt,type:this.type})]}}),Mt=yt,Ht=we.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Q(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!vt(e,e.schema.nodes[this.name]))return!1;const{selection:d}=e,{$to:v}=d,r=t();return bt(d)?r.insertContentAt(v.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({state:i,tr:o,dispatch:M})=>{if(M){const{$to:c}=o.selection,g=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(J.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(_t.create(o.doc,c.pos)):o.setSelection(J.create(o.doc,c.pos));else{const H=i.schema.nodes[this.options.nextNodeType]||c.parent.type.contentMatch.defaultType,x=H?.create();x&&(o.insert(g,x),o.setSelection(J.create(o.doc,g+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[ut({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),xt=Ht;function Tt(t,e){n(e).chain().focus().setHorizontalRule().run()}var At=O('<label class="label"><span class="label-text font-medium"> </span></label>'),Lt=(t,e)=>y(e,!n(e)),Rt=(t,e)=>e(0),zt=(t,e)=>e(1),It=(t,e)=>e(2),St=(t,e)=>e(3),Nt=(t,e)=>n(e).chain().focus().toggleBold().run(),qt=(t,e)=>n(e).chain().focus().toggleItalic().run(),Ct=(t,e)=>n(e).chain().focus().toggleStrike().run(),Bt=(t,e)=>n(e).chain().focus().toggleHighlight().run(),Ot=(t,e)=>n(e).chain().focus().toggleBulletList().run(),Pt=(t,e)=>n(e).chain().focus().toggleOrderedList().run(),Et=(t,e)=>n(e).chain().focus().undo().run(),Kt=(t,e)=>n(e).chain().focus().redo().run(),Ft=O('<div class="border-base-200 bg-base-100 flex flex-wrap items-center gap-1 border-b p-1"><div><button type="button" tabindex="0" class="btn btn-ghost btn-sm gap-1" title="Titre"><!></button> <ul tabindex="-1" class="menu dropdown-content bg-base-100 rounded-box z-50 w-52 shadow-xl"><li><button type="button"><!> Paragraphe</button></li> <li><button type="button"><!> Titre 1</button></li> <li><button type="button"><!> Titre 2</button></li> <li><button type="button"><!> Titre 3</button></li></ul></div> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" title="Gras"><!></button> <button type="button" title="Italique"><!></button> <button type="button" title="Barré"><!></button> <button type="button" title="Surlignage"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" title="Liste à puces"><!></button> <button type="button" title="Liste ordonnée"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Ligne horizontale"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Annuler"><!></button> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Rétablir"><!></button></div>'),Ut=O('<div class="label"><span class="text-error"> </span></div>'),Vt=O('<div class="form-control w-full"><!> <div><!> <div></div></div> <!></div>');function Jt(t,e){at(e,!0);let d=he(e,"value",15);he(e,"placeholder",3,"Commencez à rédiger...");let v=T(null),r=T(null),i=T(0),o=T(!1),M=T(!1);const c=ot(()=>n(r)?(n(i),n(r).isActive("heading",{level:1})?1:n(r).isActive("heading",{level:2})?2:n(r).isActive("heading",{level:3})?3:n(r).isActive("heading",{level:4})?4:n(r).isActive("heading",{level:5})?5:n(r).isActive("heading",{level:6})?6:0):0);et(()=>{n(v)&&y(r,new ht({element:n(v),extensions:[gt.configure({codeBlock:!1,blockquote:!1,heading:!1}),mt.configure({levels:[1,2,3,4,5,6]}),Mt.configure({multicolor:!1}),xt,pt.configure({html:!1,tightLists:!0})],content:d(),editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none h-[80dvh] p-4 prose-li:marker:text-base-content/50 overflow-auto"}},onUpdate:({editor:s})=>{const u=s.storage.markdown.getMarkdown();d()!==u&&d(u)},onSelectionUpdate:()=>{ge(i)},onTransaction:()=>{ge(i)},onFocus:()=>y(o,!0),onBlur:()=>y(o,!1)}),!0)}),tt(()=>{n(r)&&n(r).destroy()});function g(s){s===0?n(r).chain().focus().setParagraph().run():n(r).chain().focus().setHeading({level:s}).run(),y(M,!1)}var H=Vt(),x=a(H);{var ye=s=>{var u=At(),p=a(u),f=a(p);B(()=>{pe(u,"for",e.id),fe(f,e.label)}),w(s,u)};k(x,s=>{e.label&&s(ye)})}var P=l(x,2);let W;var X=a(P);{var Me=s=>{var u=Ft(),p=a(u);let f;var E=a(p);E.__click=[Lt,M];var Te=a(E);{var Ae=b=>{ve(b,{class:"h-4 w-4"})},Le=b=>{var q=me(),U=ke(q);{var V=_=>{be(_,{class:"h-4 w-4"})},j=_=>{var C=me(),D=ke(C);{var G=m=>{_e(m,{class:"h-4 w-4"})},je=m=>{ue(m,{class:"h-4 w-4"})};k(D,m=>{n(c)===3?m(G):m(je,!1)},!0)}w(_,C)};k(U,_=>{n(c)===2?_(V):_(j,!1)},!0)}w(b,q)};k(Te,b=>{n(c)===1?b(Ae):b(Le,!1)})}var Re=l(E,2),Y=a(Re),$=a(Y);$.__click=[Rt,g];var ze=a($);ue(ze,{class:"h-4 w-4"});var ee=l(Y,2),te=a(ee);te.__click=[zt,g];var Ie=a(te);ve(Ie,{class:"h-4 w-4"});var ne=l(ee,2),re=a(ne);re.__click=[It,g];var Se=a(re);be(Se,{class:"h-4 w-4"});var Ne=l(ne,2),ae=a(Ne);ae.__click=[St,g];var qe=a(ae);_e(qe,{class:"h-4 w-4"});var A=l(p,4);let se;A.__click=[Nt,r];var Ce=a(A);De(Ce,{class:"h-4 w-4"});var L=l(A,2);let oe;L.__click=[qt,r];var Be=a(L);Ge(Be,{class:"h-4 w-4"});var R=l(L,2);let ie;R.__click=[Ct,r];var Oe=a(R);Je(Oe,{class:"h-4 w-4"});var z=l(R,2);let le;z.__click=[Bt,r];var Pe=a(z);Qe(Pe,{class:"h-4 w-4"});var I=l(z,4);let de;I.__click=[Ot,r];var Ee=a(I);We(Ee,{class:"h-4 w-4"});var S=l(I,2);let ce;S.__click=[Pt,r];var Ke=a(S);Xe(Ke,{class:"h-4 w-4"});var K=l(S,4);K.__click=[Tt,r];var Fe=a(K);Ze(Fe,{class:"h-4 w-4"});var N=l(K,4);N.__click=[Et,r];var Ue=a(N);Ye(Ue,{class:"h-4 w-4"});var F=l(N,2);F.__click=[Kt,r];var Ve=a(F);$e(Ve,{class:"h-4 w-4"}),B((b,q,U,V,j,_,C,D,G)=>{f=h(p,1,"dropdown",null,f,b),se=h(A,1,"btn btn-ghost btn-square btn-sm",null,se,q),oe=h(L,1,"btn btn-ghost btn-square btn-sm",null,oe,U),ie=h(R,1,"btn btn-ghost btn-square btn-sm",null,ie,V),le=h(z,1,"btn btn-ghost btn-square btn-sm",null,le,j),de=h(I,1,"btn btn-ghost btn-square btn-sm",null,de,_),ce=h(S,1,"btn btn-ghost btn-square btn-sm",null,ce,C),N.disabled=D,F.disabled=G},[()=>({"dropdown-open":n(M)}),()=>({"btn-active":n(i)>=0&&n(r).isActive("bold")}),()=>({"btn-active":n(i)>=0&&n(r).isActive("italic")}),()=>({"btn-active":n(i)>=0&&n(r).isActive("strike")}),()=>({"btn-active":n(i)>=0&&n(r).isActive("highlight")}),()=>({"btn-active":n(i)>=0&&n(r).isActive("bulletList")}),()=>({"btn-active":n(i)>=0&&n(r).isActive("orderedList")}),()=>!(n(i)>=0&&n(r).can().undo()),()=>!(n(i)>=0&&n(r).can().redo())]),w(s,u)};k(X,s=>{n(r)&&s(Me)})}var Z=l(X,2);nt(Z,s=>y(v,s),()=>n(v));var He=l(P,2);{var xe=s=>{var u=Ut(),p=a(u),f=a(p);B(()=>fe(f,e.error)),w(s,u)};k(He,s=>{e.error&&s(xe)})}B(s=>{W=h(P,1,"bg-base-100 overflow-hidden rounded-lg border-2 transition-all",null,W,s),pe(Z,"id",e.id)},[()=>({"border-primary":n(o),"border-error":e.error,"border-base-300":!n(o)&&!e.error})]),w(t,H),rt()}st(["click"]);export{Jt as M};
