import{F as we,b9 as Ce,ba as Ae,S as ke,X as De,o as Se,A as Te,p as Fe,E as ze,P as oe}from"./icons.js";import{d as H,p as te,V as c,h as _,g as r,j as Z,k as L,a2 as T,b as n,W as j,_ as ee,c as J,Z as U,e as G,i as ae,m as e,u as I,a4 as Ie,a7 as Be,am as se,aj as ce,X as Y,q as W,Y as Qe,a1 as ne,ag as Re,af as Pe,v as M,an as Le,a0 as ie,A as Oe,ao as je}from"./appwrite.js";import{n as de,t as N}from"./index.js";import{D as Ee}from"./DocCard.js";import{L as Me}from"./LeftPanel.js";import{F as ve}from"./Fieldset.js";import{C as ue}from"./CheckboxBadge.js";import"./date-helpers.js";var Ne=c('<div class="flex flex-wrap gap-2"></div>'),qe=c('<p class="text-base-content/60 text-sm">Aucun tag disponible</p>'),Xe=c('<div class="flex flex-wrap gap-2"></div>'),Ke=c('<p class="text-base-content/60 text-sm">Aucun statut disponible</p>'),Ve=c('<div><div class="mb-4 flex items-center justify-between"><h4 class="text-lg font-bold">Filtres</h4> <button class="btn btn-warning btn-sm"><!> Effacer</button></div> <!> <!></div>');function We(w,t){H(t,!0);let p=te(t,"filters",15),h=te(t,"disabled",3,!1);function b(v,i){const u=v.indexOf(i);u===-1?v.push(i):v.splice(u,1),p({...p()})}var d=Ve();let x;var C=r(d),B=_(r(C),2);B.__click=function(...v){t.onReset?.apply(this,v)};var Q=r(B);we(Q,{class:"h-4 w-4"});var A=_(C,2);ve(A,{legend:"Tags",get iconComponent(){return Ce},children:(v,i)=>{var u=Z(),f=L(u);{var P=a=>{var s=Ne();G(s,21,()=>t.availableTags,ae,(o,m)=>{{let F=I(()=>p().tags.includes(e(m)));ue(o,{get checked(){return e(F)},get label(){return e(m)},onchange:()=>b(p().tags,e(m)),get disabled(){return h()}})}}),n(a,s)},k=a=>{var s=qe();n(a,s)};T(f,a=>{t.availableTags.length>0?a(P):a(k,!1)})}n(v,u)},$$slots:{default:!0}});var R=_(A,2);ve(R,{legend:"Statut",get iconComponent(){return Ae},children:(v,i)=>{var u=Z(),f=L(u);{var P=a=>{var s=Xe();G(s,21,()=>t.availableStatus,ae,(o,m)=>{{let F=I(()=>p().status.includes(e(m)));ue(o,{get checked(){return e(F)},get label(){return e(m)},onchange:()=>b(p().status,e(m)),get disabled(){return h()}})}}),n(a,s)},k=a=>{var s=Ke();n(a,s)};T(f,a=>{t.availableStatus.length>0?a(P):a(k,!1)})}n(v,u)},$$slots:{default:!0}}),j(v=>{x=ee(d,1,"mt-16 space-y-4",null,x,v),B.disabled=h()},[()=>({"opacity-30":h()})]),n(w,d),J()}U(["click"]);function Ye(w,t){w.key==="Escape"&&t.onReset()}var Ze=c('<button class="btn join-item btn-ghost btn-lg" aria-label="Effacer la recherche"><!></button>'),Ge=c('<div class="input input-lg w-full"><!> <input type="text" class="join-item grow" aria-label="Rechercher"/> <!></div>');function He(w,t){H(t,!0);let p=te(t,"searchQuery",15),h=te(t,"placeholder",3,"Rechercher...");var b=Ge(),d=r(b);ke(d,{class:"text-base-content/50 join-item h-5 w-5"});var x=_(d,2);x.__keydown=[Ye,t];var C=_(x,2);{var B=Q=>{var A=Ze();A.__click=function(...v){t.onReset?.apply(this,v)};var R=r(A);De(R,{class:"h-5 w-5"}),n(Q,A)};T(C,Q=>{p().length>0&&Q(B)})}j(()=>Be(x,"placeholder",h())),Ie(x,p),n(w,b),J()}U(["keydown","click"]);var Je=(w,t)=>t("title"),Ue=(w,t)=>t("$createdAt"),$e=(w,t)=>t("$updatedAt"),et=c('<div class="bg-base-300 rounded-box flex flex-wrap items-center justify-between gap-6 px-6 py-6"><fieldset class="fieldset w-full"><legend class="legend label"><!> Trier par :</legend> <div class="btn-group"><button aria-label="Trier par titre">Titre</button> <button aria-label="Trier par date de création"><!> Date de création</button> <button aria-label="Trier par date de modification"><!> Date de modification</button></div></fieldset></div>');function tt(w,t){H(t,!0);const p=a=>t.sortBy!==a?"inactive":t.sortOrder,h=a=>{a==="title"?t.onSortChange("title",t.sortBy==="title"&&t.sortOrder==="asc"?"desc":"asc"):t.sortBy!==a?t.onSortChange(a,"desc"):t.sortOrder==="desc"?t.onSortChange(a,"asc"):t.onSortChange("title","asc")},b=a=>{const s=p(a),o="btn btn-sm btn-primary btn-outline gap-2";return s==="inactive"?`${o}`:s==="asc"?`${o} btn-active`:`${o} btn-active`},d=a=>{const s=p(a);return s==="inactive"?null:s==="asc"?Te:Fe};var x=et(),C=r(x),B=r(C),Q=r(B);Se(Q,{class:"inline size-4"});var A=_(B,2),R=r(A);R.__click=[Je,h];var v=_(R,2);v.__click=[Ue,h];var i=r(v);{var u=a=>{const s=I(()=>d("$createdAt"));var o=Z(),m=L(o);ce(m,()=>e(s),(F,D)=>{D(F,{size:16})}),n(a,o)};T(i,a=>{d("$createdAt")&&a(u)})}var f=_(v,2);f.__click=[$e,h];var P=r(f);{var k=a=>{const s=I(()=>d("$updatedAt"));var o=Z(),m=L(o);ce(m,()=>e(s),(F,D)=>{D(F,{size:16})}),n(a,o)};T(P,a=>{d("$updatedAt")&&a(k)})}j((a,s,o)=>{ee(R,1,a),ee(v,1,s),ee(f,1,o)},[()=>se(b("title")),()=>se(b("$createdAt")),()=>se(b("$updatedAt"))]),n(w,x),J()}U(["click"]);var at=c(`<span class="font-semibold"> </span> correspondent
        aux critères`,1),rt=c('<span class="font-semibold">1 document</span> correspond aux critères',1),st=c('<span class="text-warning">Aucun document</span> ne correspond aux critères...',1),nt=c('<legend class="legend text-base-content/70 ms-4"><!></legend>'),it=c('<div class="text-base-content/70 text-base"> </div>'),lt=c('<div><span class="text-base-content/60 italic">contient (dans le titre ou le contenu) :</span> <span class="font-bold"> </span></div>'),ot=c('<span class="badge badge-primary"> </span>'),ct=c('<span class="badge badge-secondary"> </span>'),dt=c('<div class="flex flex-wrap gap-2"><!> <!></div> <div class="mt-3 text-end"><button class="btn btn-warning btn-sm"><!> Effacer tous les filtres</button></div>',1),vt=c('<fieldset class="fieldset border-base-300 relative rounded-lg border-2"><!> <div class="p-4"><!> <!></div></fieldset>');function ut(w,t){H(t,!0);const p=I(()=>t.filters.tags.length>0||t.filters.status.length>0);function h(i){switch(i.toLowerCase()){case"draft":case"brouillon":return"Brouillon";case"published":case"publié":return"Publié";case"archived":case"archivé":return"Archivé";default:return i}}var b=vt(),d=r(b);{var x=i=>{var u=nt(),f=r(u);{var P=a=>{var s=at(),o=L(s),m=r(o);j(()=>Y(m,`${t.resultCount??""} documents`)),n(a,s)},k=a=>{var s=Z(),o=L(s);{var m=D=>{var q=rt();n(D,q)},F=D=>{var q=st();n(D,q)};T(o,D=>{t.resultCount===1?D(m):D(F,!1)},!0)}n(a,s)};T(f,a=>{t.resultCount>1?a(P):a(k,!1)})}n(i,u)};T(d,i=>{(e(p)||t.searchQuery.length>=2)&&i(x)})}var C=_(d,2),B=r(C);{var Q=i=>{var u=it(),f=r(u);j(()=>Y(f,`${t.resultCount??""} document${t.resultCount>1?"s":""}`)),n(i,u)};T(B,i=>{!e(p)&&t.searchQuery.length<2&&i(Q)})}var A=_(B,2);{var R=i=>{var u=lt(),f=_(r(u),2),P=r(f);j(()=>Y(P,t.searchQuery)),n(i,u)},v=i=>{var u=Z(),f=L(u);{var P=k=>{var a=dt(),s=L(a),o=r(s);G(o,17,()=>t.filters.tags,ae,(E,K)=>{var X=ot(),V=r(X);j(()=>Y(V,e(K))),n(E,X)});var m=_(o,2);G(m,17,()=>t.filters.status,ae,(E,K)=>{var X=ct(),V=r(X);j(re=>Y(V,re),[()=>h(e(K))]),n(E,X)});var F=_(s,2),D=r(F);D.__click=function(...E){t.onResetFilters?.apply(this,E)};var q=r(D);ze(q,{class:"h-4 w-4"}),n(k,a)};T(f,k=>{e(p)&&k(P)},!0)}n(i,u)};T(A,i=>{t.searchQuery.length>=2?i(R):i(v,!1)})}n(w,b),J()}U(["click"]);var gt=(w,t)=>ie(`/createdocument/${e(t)}/new`),ft=c('<button class="btn btn-primary"><!> Créer un document</button>'),_t=c('<div class="alert alert-error"><span> </span></div>'),bt=c('<div class="py-8 text-center"><span class="loading loading-spinner loading-md"></span></div>'),mt=c('<div class="py-12 text-center"><p class="text-base-content/60 text-lg">Aucun document ne correspond aux critères...</p></div>'),ht=(w,t)=>ie(`/createdocument/${e(t)}/new`),pt=c('<div class="py-12 text-center"><p class="text-base-content/60 mb-4 text-lg">Aucun document dans cette équipe</p> <button class="btn btn-primary"><!> Créer le premier document</button></div>'),xt=c('<div class="my-8 space-y-3"></div> <!> <!> <!>',1),yt=c('<!> <div class="p-4 lg:ml-100"><div class="mx-auto max-w-4xl"><div class="mb-10 space-y-6"><div class="mb-4"><!></div> <div class="mb-6"><!></div> <!></div> <!></div></div>',1);function zt(w,t){H(t,!0);const p=l=>{var g=ft();g.__click=[gt,h];var y=r(g);oe(y,{size:18}),n(l,g)};let h=I(()=>t.params.teamId),b=W(""),d=W(Qe({tags:[],status:[]})),x=W("$updatedAt"),C=W("desc"),B=20,Q=W(1),A=W(void 0),R=I(()=>Oe.myTeams.find(l=>l.$id===e(h)));const v=I(()=>N.isInitialized?N.getTeamDocuments(e(h)):[]),i=I(()=>N.getTeamTags(e(h))),u=I(()=>["draft","published","archived"]),f=I(()=>{if(e(b).length>=2){const l=e(b).toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");return e(v).filter(g=>{const y=g.title.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(l),z=g.content?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(l);return y||z})}return e(v).filter(l=>{const g=!e(d).tags.length||e(d).tags.some(z=>l.tags?.includes(z)),y=!e(d).status.length||e(d).status.includes(l.status);return g&&y})}),P=I(()=>[...e(f)].sort((g,y)=>{if(e(x)==="title")return e(C)==="asc"?g.title.localeCompare(y.title,"fr"):y.title.localeCompare(g.title,"fr");if(e(x)==="$createdAt"){const z=new Date(y.$createdAt||0).getTime()-new Date(g.$createdAt||0).getTime();return e(C)==="asc"?-z:z}else{const z=new Date(y.$updatedAt||0).getTime()-new Date(g.$updatedAt||0).getTime();return e(C)==="asc"?-z:z}})),k=I(()=>e(P).slice(0,e(Q)*B)),a=I(()=>e(b).length>=2);function s(){M(b,"")}function o(){M(d,{tags:[],status:[]},!0)}ne(()=>{if(!e(A))return;const l=new IntersectionObserver(g=>{g[0].isIntersecting&&e(k).length<e(f).length&&Le(Q)},{threshold:.1});return l.observe(e(A)),()=>l.disconnect()}),ne(()=>{e(f),e(x),e(C),M(Q,1)}),ne(()=>{e(R)&&de.setConfig({title:`Documents - ${e(R).name}`,actions:p})}),Re(()=>{de.reset()}),Pe(async()=>{N.isInitialized||await N.initialize(),e(R)||ie("/dashboard/teams")});var m=yt(),F=L(m);Me(F,{width:"100",children:(l,g)=>{We(l,{get availableTags(){return e(i)},get availableStatus(){return e(u)},get disabled(){return e(a)},onReset:o,get filters(){return e(d)},set filters(y){M(d,y,!0)}})},$$slots:{default:!0}});var D=_(F,2),q=r(D),E=r(q),K=r(E),X=r(K);He(X,{onReset:s,placeholder:"Rechercher dans les documents...",get searchQuery(){return e(b)},set searchQuery(l){M(b,l,!0)}});var V=_(K,2),re=r(V);ut(re,{get searchQuery(){return e(b)},get filters(){return e(d)},get resultCount(){return e(f).length},onResetFilters:o});var ge=_(V,2);tt(ge,{get sortBy(){return e(x)},get sortOrder(){return e(C)},onSortChange:(l,g)=>{M(x,l,!0),M(C,g,!0)}});var fe=_(E,2);{var _e=l=>{var g=_t(),y=r(g),z=r(y);j(()=>Y(z,`Erreur : ${N.error??""}`)),n(l,g)},be=l=>{var g=xt(),y=L(g);G(y,21,()=>e(k),S=>S.$id,(S,O)=>{Ee(S,{get doc(){return e(O)},get teamId(){return e(h)},get highlightedTags(){return e(d).tags},bgClass:"bg-base-100"})});var z=_(y,2);{var me=S=>{var O=bt();je(O,$=>M(A,$),()=>e(A)),n(S,O)};T(z,S=>{e(k).length<e(f).length&&S(me)})}var le=_(z,2);{var he=S=>{var O=mt();n(S,O)};T(le,S=>{e(f).length===0&&S(he)})}var pe=_(le,2);{var xe=S=>{var O=pt(),$=_(r(O),2);$.__click=[ht,h];var ye=r($);oe(ye,{size:18}),n(S,O)};T(pe,S=>{e(v).length===0&&!N.loading&&S(xe)})}n(l,g)};T(fe,l=>{N.error?l(_e):l(be,!1)})}n(w,m),J()}U(["click"]);export{zt as default};
