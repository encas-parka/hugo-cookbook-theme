import{F as Ae,bb as De,bc as Se,S as ke,X as Te,v as Fe,A as ze,l as Ie,u as Be,P as de}from"./icons.js";import{d as $,p as re,v as g,h as m,g as n,j as V,k as O,I,b as i,w as K,c as ee,B as te,e as Y,i as se,C as ae,m as e,u as R,K as E,o as r,R as Re,L as Pe,U as Qe,aa as ie,a6 as ve,x as J,y as G,z as Le,H as le,$ as Oe,Z as Ee,ab as je,A as H,a3 as U,E as oe,F as Me,P as Ne}from"./appwrite.js";import{n as ue}from"./index.js";import{D as Ke}from"./DocCard.js";import{L as qe}from"./LeftPanel.js";import{F as ge}from"./Fieldset.js";import{C as fe}from"./CheckboxBadge.js";import"./date-helpers.js";var He=g('<div class="flex flex-wrap gap-2"></div>'),Ue=g('<p class="text-base-content/60 text-sm">Aucun tag disponible</p>'),Xe=g('<div class="flex flex-wrap gap-2"></div>'),Ze=g('<p class="text-base-content/60 text-sm">Aucun statut disponible</p>'),Ge=g('<div><div class="mb-4 flex items-center justify-between"><h4 class="text-lg font-bold">Filtres</h4> <button class="btn btn-warning btn-sm"><!> Effacer</button></div> <!> <!></div>');function Je(j,a){$(a,!0);let w=re(a,"filters",15),x=re(a,"disabled",3,!1);function h(b,l){const o=b.indexOf(l);o===-1?b.push(l):b.splice(o,1),w({...w()})}var c=Ge();let A;var _=n(c),k=m(n(_),2);k.__click=function(...b){a.onReset?.apply(this,b)};var Q=n(k);Ae(Q,{class:"h-4 w-4"}),E(),r(k),r(_);var C=m(_,2);ge(C,{legend:"Tags",get iconComponent(){return De},children:(b,l)=>{var o=V(),f=O(o);{var P=t=>{var s=He();Y(s,21,()=>a.availableTags,se,(d,p)=>{{let F=R(()=>w().tags.includes(e(p)));fe(d,{get checked(){return e(F)},get label(){return e(p)},onchange:()=>h(w().tags,e(p)),get disabled(){return x()}})}}),r(s),i(t,s)},T=t=>{var s=Ue();i(t,s)};I(f,t=>{a.availableTags.length>0?t(P):t(T,!1)})}i(b,o)},$$slots:{default:!0}});var S=m(C,2);ge(S,{legend:"Statut",get iconComponent(){return Se},children:(b,l)=>{var o=V(),f=O(o);{var P=t=>{var s=Xe();Y(s,21,()=>a.availableStatus,se,(d,p)=>{{let F=R(()=>w().status.includes(e(p)));fe(d,{get checked(){return e(F)},get label(){return e(p)},onchange:()=>h(w().status,e(p)),get disabled(){return x()}})}}),r(s),i(t,s)},T=t=>{var s=Ze();i(t,s)};I(f,t=>{a.availableStatus.length>0?t(P):t(T,!1)})}i(b,o)},$$slots:{default:!0}}),r(c),K(()=>{A=ae(c,1,"mt-16 space-y-4",null,A,{"opacity-30":x()}),k.disabled=x()}),i(j,c),ee()}te(["click"]);var Ve=g('<button class="btn join-item btn-ghost btn-lg" aria-label="Effacer la recherche"><!></button>'),We=g('<div class="input input-lg w-full"><!> <input type="text" class="join-item grow" aria-label="Rechercher"/> <!></div>');function Ye(j,a){$(a,!0);let w=re(a,"searchQuery",15),x=re(a,"placeholder",3,"Rechercher...");function h(C){C.key==="Escape"&&a.onReset()}var c=We(),A=n(c);ke(A,{class:"text-base-content/50 join-item h-5 w-5"});var _=m(A,2);Qe(_),_.__keydown=h;var k=m(_,2);{var Q=C=>{var S=Ve();S.__click=function(...l){a.onReset?.apply(this,l)};var b=n(S);Te(b,{class:"h-5 w-5"}),r(S),i(C,S)};I(k,C=>{w().length>0&&C(Q)})}r(c),K(()=>Pe(_,"placeholder",x())),Re(_,w),i(j,c),ee()}te(["keydown","click"]);var $e=g('<div class="bg-base-300 rounded-box flex flex-wrap items-center justify-between gap-6 px-6 py-6"><fieldset class="fieldset w-full"><legend class="legend label"><!> Trier par :</legend> <div class="btn-group"><button aria-label="Trier par titre">Titre</button> <button aria-label="Trier par date de création"><!> Date de création</button> <button aria-label="Trier par date de modification"><!> Date de modification</button></div></fieldset></div>');function et(j,a){$(a,!0);const w=t=>a.sortBy!==t?"inactive":a.sortOrder,x=t=>{t==="title"?a.onSortChange("title",a.sortBy==="title"&&a.sortOrder==="asc"?"desc":"asc"):a.sortBy!==t?a.onSortChange(t,"desc"):a.sortOrder==="desc"?a.onSortChange(t,"asc"):a.onSortChange("title","asc")},h=t=>{const s=w(t),d="btn btn-sm btn-primary btn-outline gap-2";return s==="inactive"?`${d}`:s==="asc"?`${d} btn-active`:`${d} btn-active`},c=t=>{const s=w(t);return s==="inactive"?null:s==="asc"?ze:Ie};var A=$e(),_=n(A),k=n(_),Q=n(k);Fe(Q,{class:"inline size-4"}),E(),r(k);var C=m(k,2),S=n(C);S.__click=()=>x("title");var b=m(S,2);b.__click=()=>x("$createdAt");var l=n(b);{var o=t=>{const s=R(()=>c("$createdAt"));var d=V(),p=O(d);ve(p,()=>e(s),(F,D)=>{D(F,{size:16})}),i(t,d)};I(l,t=>{c("$createdAt")&&t(o)})}E(),r(b);var f=m(b,2);f.__click=()=>x("$updatedAt");var P=n(f);{var T=t=>{const s=R(()=>c("$updatedAt"));var d=V(),p=O(d);ve(p,()=>e(s),(F,D)=>{D(F,{size:16})}),i(t,d)};I(P,t=>{c("$updatedAt")&&t(T)})}E(),r(f),r(C),r(_),r(A),K((t,s,d)=>{ae(S,1,t),ae(b,1,s),ae(f,1,d)},[()=>ie(h("title")),()=>ie(h("$createdAt")),()=>ie(h("$updatedAt"))]),i(j,A),ee()}te(["click"]);var tt=g(`<span class="font-semibold"> </span> correspondent
        aux critères`,1),at=g('<span class="font-semibold">1 document</span> correspond aux critères',1),rt=g('<span class="text-warning">Aucun document</span> ne correspond aux critères...',1),st=g('<legend class="legend text-base-content/70 ms-4"><!></legend>'),nt=g('<div class="text-base-content/70 text-base"> </div>'),it=g('<div><span class="text-base-content/60 italic">contient (dans le titre ou le contenu) :</span> <span class="font-bold"> </span></div>'),lt=g('<span class="badge badge-primary"> </span>'),ot=g('<span class="badge badge-secondary"> </span>'),ct=g('<div class="flex flex-wrap gap-2"><!> <!></div> <div class="mt-3 text-end"><button class="btn btn-warning btn-sm"><!> Effacer tous les filtres</button></div>',1),dt=g('<fieldset class="fieldset border-base-300 relative rounded-lg border-2"><!> <div class="p-4"><!> <!></div></fieldset>');function vt(j,a){$(a,!0);const w=R(()=>a.filters.tags.length>0||a.filters.status.length>0);function x(l){switch(l.toLowerCase()){case"draft":case"brouillon":return"Brouillon";case"published":case"publié":return"Publié";case"archived":case"archivé":return"Archivé";default:return l}}var h=dt(),c=n(h);{var A=l=>{var o=st(),f=n(o);{var P=t=>{var s=tt(),d=O(s),p=n(d);r(d),E(),K(()=>J(p,`${a.resultCount??""} documents`)),i(t,s)},T=t=>{var s=V(),d=O(s);{var p=D=>{var q=at();E(),i(D,q)},F=D=>{var q=rt();E(),i(D,q)};I(d,D=>{a.resultCount===1?D(p):D(F,!1)},!0)}i(t,s)};I(f,t=>{a.resultCount>1?t(P):t(T,!1)})}r(o),i(l,o)};I(c,l=>{(e(w)||a.searchQuery.length>=2)&&l(A)})}var _=m(c,2),k=n(_);{var Q=l=>{var o=nt(),f=n(o);r(o),K(()=>J(f,`${a.resultCount??""} document${a.resultCount>1?"s":""}`)),i(l,o)};I(k,l=>{!e(w)&&a.searchQuery.length<2&&l(Q)})}var C=m(k,2);{var S=l=>{var o=it(),f=m(n(o),2),P=n(f,!0);r(f),r(o),K(()=>J(P,a.searchQuery)),i(l,o)},b=l=>{var o=V(),f=O(o);{var P=T=>{var t=ct(),s=O(t),d=n(s);Y(d,17,()=>a.filters.tags,se,(M,X)=>{var N=lt(),Z=n(N,!0);r(N),K(()=>J(Z,e(X))),i(M,N)});var p=m(d,2);Y(p,17,()=>a.filters.status,se,(M,X)=>{var N=ot(),Z=n(N,!0);r(N),K(ne=>J(Z,ne),[()=>x(e(X))]),i(M,N)}),r(s);var F=m(s,2),D=n(F);D.__click=function(...M){a.onResetFilters?.apply(this,M)};var q=n(D);Be(q,{class:"h-4 w-4"}),E(),r(D),r(F),i(T,t)};I(f,T=>{e(w)&&T(P)},!0)}i(l,o)};I(C,l=>{a.searchQuery.length>=2?l(S):l(b,!1)})}r(_),r(h),i(j,h),ee()}te(["click"]);var ut=g('<button class="btn btn-primary"><!> Créer un document</button>'),gt=g('<div class="alert alert-error"><span> </span></div>'),ft=g('<div class="py-8 text-center"><span class="loading loading-spinner loading-md"></span></div>'),bt=g('<div class="py-12 text-center"><p class="text-base-content/60 text-lg">Aucun document ne correspond aux critères...</p></div>'),_t=g('<div class="py-12 text-center"><p class="text-base-content/60 mb-4 text-lg">Aucun document dans cette équipe</p> <button class="btn btn-primary"><!> Créer le premier document</button></div>'),mt=g('<div class="my-8 space-y-3"></div> <!> <!> <!>',1),ht=g('<!> <div class="p-4 lg:ml-100"><div class="mx-auto max-w-4xl"><div class="mb-10 space-y-6"><div class="mb-4"><!></div> <div class="mb-6"><!></div> <!></div> <!></div></div>',1);function kt(j,a){$(a,!0);const w=v=>{var u=ut();u.__click=()=>oe(`/createdocument/${e(x)}/new`);var y=n(u);de(y,{size:18}),E(),r(u),i(v,u)};let x=R(()=>a.params.teamId),h=G(""),c=G(Le({tags:[],status:[]})),A=G("$updatedAt"),_=G("desc"),k=20,Q=G(1),C=G(void 0),S=R(()=>Me.myTeams.find(v=>v.$id===e(x)));const b=R(()=>U.isInitialized?U.getTeamDocuments(e(x)):[]),l=R(()=>U.getTeamTags(e(x))),o=R(()=>["draft","published","archived"]),f=R(()=>{if(e(h).length>=2){const v=e(h).toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");return e(b).filter(u=>{const y=u.title.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(v),B=u.content?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(v);return y||B})}return e(b).filter(v=>{const u=!e(c).tags.length||e(c).tags.some(B=>v.tags?.includes(B)),y=!e(c).status.length||e(c).status.includes(v.status);return u&&y})}),P=R(()=>[...e(f)].sort((u,y)=>{if(e(A)==="title")return e(_)==="asc"?u.title.localeCompare(y.title,"fr"):y.title.localeCompare(u.title,"fr");if(e(A)==="$createdAt"){const B=new Date(y.$createdAt||0).getTime()-new Date(u.$createdAt||0).getTime();return e(_)==="asc"?-B:B}else{const B=new Date(y.$updatedAt||0).getTime()-new Date(u.$updatedAt||0).getTime();return e(_)==="asc"?-B:B}})),T=R(()=>e(P).slice(0,e(Q)*k)),t=R(()=>e(h).length>=2);function s(){H(h,"")}function d(){H(c,{tags:[],status:[]},!0)}le(()=>{if(!e(C))return;const v=new IntersectionObserver(u=>{u[0].isIntersecting&&e(T).length<e(f).length&&je(Q)},{threshold:.1});return v.observe(e(C)),()=>v.disconnect()}),le(()=>{e(f),e(A),e(_),H(Q,1)}),le(()=>{e(S)&&ue.setConfig({title:`Documents - ${e(S).name}`,actions:w})}),Oe(()=>{ue.reset()}),Ee(async()=>{U.isInitialized||await U.initialize(),e(S)||oe("/dashboard/teams")});var p=ht(),F=O(p);qe(F,{width:"100",children:(v,u)=>{Je(v,{get availableTags(){return e(l)},get availableStatus(){return e(o)},get disabled(){return e(t)},onReset:d,get filters(){return e(c)},set filters(y){H(c,y,!0)}})},$$slots:{default:!0}});var D=m(F,2),q=n(D),M=n(q),X=n(M),N=n(X);Ye(N,{onReset:s,placeholder:"Rechercher dans les documents...",get searchQuery(){return e(h)},set searchQuery(v){H(h,v,!0)}}),r(X);var Z=m(X,2),ne=n(Z);vt(ne,{get searchQuery(){return e(h)},get filters(){return e(c)},get resultCount(){return e(f).length},onResetFilters:d}),r(Z);var be=m(Z,2);et(be,{get sortBy(){return e(A)},get sortOrder(){return e(_)},onSortChange:(v,u)=>{H(A,v,!0),H(_,u,!0)}}),r(M);var _e=m(M,2);{var me=v=>{var u=gt(),y=n(u),B=n(y);r(y),r(u),K(()=>J(B,`Erreur : ${U.error??""}`)),i(v,u)},he=v=>{var u=mt(),y=O(u);Y(y,21,()=>e(T),z=>z.$id,(z,L)=>{Ke(z,{get doc(){return e(L)},get teamId(){return e(x)},get highlightedTags(){return e(c).tags},bgClass:"bg-base-100"})}),r(y);var B=m(y,2);{var pe=z=>{var L=ft();Ne(L,W=>H(C,W),()=>e(C)),i(z,L)};I(B,z=>{e(T).length<e(f).length&&z(pe)})}var ce=m(B,2);{var xe=z=>{var L=bt();i(z,L)};I(ce,z=>{e(f).length===0&&z(xe)})}var ye=m(ce,2);{var we=z=>{var L=_t(),W=m(n(L),2);W.__click=()=>oe(`/createdocument/${e(x)}/new`);var Ce=n(W);de(Ce,{size:18}),E(),r(W),r(L),i(z,L)};I(ye,z=>{e(b).length===0&&!U.loading&&z(we)})}i(v,u)};I(_e,v=>{U.error?v(me):v(he,!1)})}r(q),r(D),i(j,p),ee()}te(["click"]);export{kt as default};
