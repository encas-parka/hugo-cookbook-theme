import{a1 as ge,e as B,$ as F,v as we,a2 as he}from"./icons.js";import{V as v,a2 as w,b as o,c as xe,d as ye,v as s,g as a,h as n,q as f,Z as ke,m as e,j as Le,k as h,W as V,X as K,a0 as J,a8 as Re,a9 as G,D as Pe,aa as je}from"./appwrite.js";function H(){J("/")}var Ve=v('<p class="text-base-content/70 mt-2">Entrez votre nouveau mot de passe</p>'),qe=v('<div class="flex flex-col items-center py-8"><!> <p class="text-base-content/70 mt-4">Vérification du lien...</p></div>'),ze=v('<div role="alert" class="alert alert-error max-md:alert-vertical mt-4"><!> <span> </span></div> <div class="card-actions mt-6 justify-center"><button class="btn btn-primary">Retour à la connexion</button></div>',1),Ce=v('<div role="alert" class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Ie=v('<div role="alert" class="alert alert-success max-md:alert-vertical mb-4"><!> <span> </span></div> <p class="text-base-content/70 text-center">Vous allez être redirigé...</p>',1),Me=v("<!> Réinitialisation en cours...",1),Ee=v(`<form class="space-y-4 svelte-ybl9gg"><fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Nouveau mot de passe</span></legend> <input id="new-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/> <p class="label text-base-content/50">Minimum 8 caractères</p></fieldset> <fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Confirmer le mot de passe</span></legend> <input id="confirm-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/></fieldset> <div class=" mt-6 svelte-ybl9gg"><button type="submit" class="btn btn-primary btn-block"><!></button></div></form> <div class="card-actions mt-4 justify-center"><button class="btn btn-ghost btn-sm"><!> Retour à l'acceuil</button></div>`,1),Ae=v("<!> <!>",1),De=v('<div class="bg-base-200 flex items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body"><div class="text-center"><div class="mb-4 flex justify-center"><div class="bg-primary/10 rounded-full p-4"><!></div></div> <h2 class="card-title justify-center text-2xl">Réinitialisation du mot de passe</h2> <!></div> <!></div></div></div>');function Ne(O,Q){ye(Q,!0);let p=f(!1),l=f(""),q=f(""),_=f(""),L=f(""),x=f(!1),z=f(!0);const N=new URLSearchParams(window.location.search),C=N.get("userId"),I=N.get("secret");async function Y(){if(!C||!I){s(l,"Lien de réinitialisation invalide ou manquant."),s(x,!1),s(z,!1);return}s(x,!0),s(z,!1)}Y();async function $(r){if(r.preventDefault(),!C||!I||!e(x)){s(l,"Lien de réinitialisation invalide.");return}if(!e(_)||!e(L)){s(l,"Veuillez remplir tous les champs");return}if(e(_)!==e(L)){s(l,"Les mots de passe ne correspondent pas.");return}if(e(_).length<8){s(l,"Le mot de passe doit contenir au moins 8 caractères.");return}s(p,!0),s(l,"");try{const{account:t}=await Pe();await t.updateRecovery({userId:C,secret:I,password:e(_)}),s(q,"Mot de passe réinitialisé avec succès !"),setTimeout(()=>{J("/dashboard")},3e3)}catch(t){console.error("Erreur réinitialisation:",t),t.response?.code===401||t.message?.includes("Invalid secret")?s(l,"Ce lien est invalide ou a expiré. Veuillez refaire une demande."):s(l,t.message||"Erreur lors de la réinitialisation",!0)}finally{s(p,!1)}}var S=De(),ee=a(S),ae=a(ee),U=a(ae),W=a(U),se=a(W),te=a(se);ge(te,{class:"text-primary h-8 w-8"});var re=n(W,4);{var ie=r=>{var t=Ve();o(r,t)};w(re,r=>{e(x)&&r(ie)})}var ne=n(U,2);{var le=r=>{var t=qe(),M=a(t);B(M,{class:"text-primary h-12 w-12 animate-spin"}),o(r,t)},oe=r=>{var t=Le(),M=h(t);{var de=b=>{var y=ze(),k=h(y),R=a(k);F(R,{class:"h-6 w-6 shrink-0"});var E=n(R,2),A=a(E),D=n(k,2),i=a(D);i.__click=[H],V(()=>K(A,e(l))),o(b,y)},ve=b=>{var y=Ae(),k=h(y);{var R=i=>{var c=Ce(),u=a(c);F(u,{class:"h-6 w-6 shrink-0"});var m=n(u,2),g=a(m);V(()=>K(g,e(l))),o(i,c)};w(k,i=>{e(l)&&i(R)})}var E=n(k,2);{var A=i=>{var c=Ie(),u=h(c),m=a(u);we(m,{class:"h-6 w-6 shrink-0"});var g=n(m,2),P=a(g);V(()=>K(P,e(q))),o(i,c)},D=i=>{var c=Ee(),u=h(c),m=a(u),g=n(a(m),2),P=n(m,2),X=n(a(P),2),ce=n(P,2),Z=a(ce),ue=a(Z);{var pe=d=>{var j=Me(),be=h(j);B(be,{class:"mr-2 h-4 w-4 animate-spin"}),o(d,j)},me=d=>{var j=je("Réinitialiser le mot de passe");o(d,j)};w(ue,d=>{e(p)?d(pe):d(me,!1)})}var fe=n(u,2),T=a(fe);T.__click=[H];var _e=a(T);he(_e,{class:"mr-1 h-4 w-4"}),V(()=>{g.disabled=e(p),X.disabled=e(p),Z.disabled=e(p),T.disabled=e(p)}),Re("submit",u,$),G(g,()=>e(_),d=>s(_,d)),G(X,()=>e(L),d=>s(L,d)),o(i,c)};w(E,i=>{e(q)?i(A):i(D,!1)})}o(b,y)};w(M,b=>{e(x)?b(ve,!1):b(de)},!0)}o(r,t)};w(ne,r=>{e(z)?r(le):r(oe,!1)})}o(O,S),xe()}ke(["click"]);export{Ne as default};
