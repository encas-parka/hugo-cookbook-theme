import{W as v,$ as w,v as o,w as ge,x as we,a as s,A as a,B as n,s as m,Z as he,g as e,D as ye,E as h,X as V,Y as Z,a0 as xe,a1 as X,a2 as ke}from"./vendor.js";import{y as H,b as Le}from"./appwrite.js";import{$ as Re,e as Y,Z as F,t as Pe,a0 as je}from"./icons.js";import"./editor.js";import"./markdown.js";function G(){H("/")}var Ve=v('<p class="text-base-content/70 mt-2">Entrez votre nouveau mot de passe</p>'),ze=v('<div class="flex flex-col items-center py-8"><!> <p class="text-base-content/70 mt-4">Vérification du lien...</p></div>'),Ce=v('<div role="alert" class="alert alert-error mt-4"><!> <span> </span></div> <div class="card-actions mt-6 justify-center"><button class="btn btn-primary">Retour à la connexion</button></div>',1),Ee=v('<div role="alert" class="alert alert-error mb-4"><!> <span> </span></div>'),Ie=v('<div role="alert" class="alert alert-success mb-4"><!> <span> </span></div> <p class="text-base-content/70 text-center">Vous allez être redirigé...</p>',1),Me=v("<!> Réinitialisation en cours...",1),qe=v(`<form class="space-y-4 svelte-ybl9gg"><fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Nouveau mot de passe</span></legend> <input id="new-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/> <p class="label text-base-content/50">Minimum 8 caractères</p></fieldset> <fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Confirmer le mot de passe</span></legend> <input id="confirm-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/></fieldset> <div class=" mt-6 svelte-ybl9gg"><button type="submit" class="btn btn-primary btn-block"><!></button></div></form> <div class="card-actions mt-4 justify-center"><button class="btn btn-ghost btn-sm"><!> Retour à l'acceuil</button></div>`,1),Ae=v("<!> <!>",1),De=v('<div class="bg-base-200 flex items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body"><div class="text-center"><div class="mb-4 flex justify-center"><div class="bg-primary/10 rounded-full p-4"><!></div></div> <h2 class="card-title justify-center text-2xl">Réinitialisation du mot de passe</h2> <!></div> <!></div></div></div>');function Se(J,O){we(O,!0);let p=m(!1),l=m(""),z=m(""),_=m(""),L=m(""),y=m(!1),C=m(!0);const B=new URLSearchParams(window.location.search),E=B.get("userId"),I=B.get("secret");async function Q(){if(!E||!I){s(l,"Lien de réinitialisation invalide ou manquant."),s(y,!1),s(C,!1);return}s(y,!0),s(C,!1)}Q();async function $(r){if(r.preventDefault(),!E||!I||!e(y)){s(l,"Lien de réinitialisation invalide.");return}if(!e(_)||!e(L)){s(l,"Veuillez remplir tous les champs");return}if(e(_)!==e(L)){s(l,"Les mots de passe ne correspondent pas.");return}if(e(_).length<8){s(l,"Le mot de passe doit contenir au moins 8 caractères.");return}s(p,!0),s(l,"");try{const{account:t}=await Le();await t.updateRecovery({userId:E,secret:I,password:e(_)}),s(z,"Mot de passe réinitialisé avec succès !"),setTimeout(()=>{H("/dashboard")},3e3)}catch(t){console.error("Erreur réinitialisation:",t),t.response?.code===401||t.message?.includes("Invalid secret")?s(l,"Ce lien est invalide ou a expiré. Veuillez refaire une demande."):s(l,t.message||"Erreur lors de la réinitialisation",!0)}finally{s(p,!1)}}var K=De(),ee=a(K),ae=a(ee),N=a(ae),S=a(N),se=a(S),te=a(se);Re(te,{class:"text-primary h-8 w-8"});var re=n(S,4);{var ie=r=>{var t=Ve();o(r,t)};w(re,r=>{e(y)&&r(ie)})}var ne=n(N,2);{var le=r=>{var t=ze(),M=a(t);Y(M,{class:"text-primary h-12 w-12 animate-spin"}),o(r,t)},oe=r=>{var t=ye(),M=h(t);{var de=b=>{var x=Ce(),k=h(x),R=a(k);F(R,{class:"h-6 w-6 shrink-0"});var q=n(R,2),A=a(q),D=n(k,2),i=a(D);i.__click=[G],V(()=>Z(A,e(l))),o(b,x)},ve=b=>{var x=Ae(),k=h(x);{var R=i=>{var c=Ee(),u=a(c);F(u,{class:"h-6 w-6 shrink-0"});var f=n(u,2),g=a(f);V(()=>Z(g,e(l))),o(i,c)};w(k,i=>{e(l)&&i(R)})}var q=n(k,2);{var A=i=>{var c=Ie(),u=h(c),f=a(u);Pe(f,{class:"h-6 w-6 shrink-0"});var g=n(f,2),P=a(g);V(()=>Z(P,e(z))),o(i,c)},D=i=>{var c=qe(),u=h(c),f=a(u),g=n(a(f),2),P=n(f,2),U=n(a(P),2),ce=n(P,2),W=a(ce),ue=a(W);{var pe=d=>{var j=Me(),be=h(j);Y(be,{class:"mr-2 h-4 w-4 animate-spin"}),o(d,j)},fe=d=>{var j=ke("Réinitialiser le mot de passe");o(d,j)};w(ue,d=>{e(p)?d(pe):d(fe,!1)})}var me=n(u,2),T=a(me);T.__click=[G];var _e=a(T);je(_e,{class:"mr-1 h-4 w-4"}),V(()=>{g.disabled=e(p),U.disabled=e(p),W.disabled=e(p),T.disabled=e(p)}),xe("submit",u,$),X(g,()=>e(_),d=>s(_,d)),X(U,()=>e(L),d=>s(L,d)),o(i,c)};w(q,i=>{e(z)?i(A):i(D,!1)})}o(b,x)};w(M,b=>{e(y)?b(ve,!1):b(de)},!0)}o(r,t)};w(ne,r=>{e(C)?r(le):r(oe,!1)})}o(J,K),ge()}he(["click"]);export{Se as default};
