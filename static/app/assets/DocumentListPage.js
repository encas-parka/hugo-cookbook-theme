import{d as ie,p as J,v as h,g as f,h as o,K as D,w as W,M as _e,T as he,b,c as oe,B as V,W as pe,o as i,a9 as te,C as U,j as le,k as se,ab as ce,e as ve,i as ye,m as e,u as T,G as P,x as ge,y as L,z as we,J as ae,ac as xe,A as N,Y as Te,X as De,a1 as z,E as re,P as Ae,D as Ce,F as ke,R as Se}from"./appwrite.js";import{n as de,a as ze}from"./index.js";import{D as Ie}from"./DocCard.js";import{S as Be,X as ne,v as Oe,A as Re,l as je,c as ue}from"./icons.js";import"./date-helpers.js";var Me=h('<button class="btn join-item btn-ghost btn-lg" aria-label="Effacer la recherche"><!></button>'),Ee=h('<div class="input input-lg w-full"><!> <input type="text" class="join-item grow" aria-label="Rechercher"/> <!></div>');function Fe(K,n){ie(n,!0);let I=J(n,"searchQuery",15),_=J(n,"placeholder",3,"Rechercher...");function w(m){m.key==="Escape"&&n.onReset()}var u=Ee(),p=o(u);Be(p,{class:"text-base-content/50 join-item h-5 w-5"});var v=f(p,2);pe(v),v.__keydown=w;var k=f(v,2);{var A=m=>{var y=Me();y.__click=function(...E){n.onReset?.apply(this,E)};var B=o(y);ne(B,{class:"h-5 w-5"}),i(y),b(m,y)};D(k,m=>{I().length>0&&m(A)})}i(u),W(()=>_e(v,"placeholder",_())),he(v,I),b(K,u),oe()}V(["keydown","click"]);var Qe=h('<button class="btn btn-ghost btn-xs"><!> Tout effacer</button>'),Le=h("<button> <!></button>"),Ne=h('<fieldset class="fieldset w-full sm:flex-1"><legend class="legend label flex items-center justify-between"><span>Filtrer par tags :</span> <!></legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),Pe=h('<div class="bg-base-300 rounded-box flex flex-wrap items-center justify-between gap-6 px-6 py-6"><fieldset class="fieldset w-full sm:flex-1"><legend class="legend label"><!> Trier par :</legend> <div class="flex flex-wrap gap-2"><button aria-label="Trier par noms">Nom</button> <button aria-label="Trier par date de création"><!> Date de création</button> <button aria-label="Trier par date de modification"><!> Date de modification</button></div></fieldset> <!></div>');function Ke(K,n){ie(n,!0);let I=J(n,"availableTags",19,()=>[]),_=J(n,"selectedTags",19,()=>[]),w=J(n,"disabled",3,!1);const u=r=>n.sortBy!==r?"inactive":n.sortOrder,p=r=>{r==="title"?n.onSortChange("title",n.sortBy==="title"&&n.sortOrder==="asc"?"desc":"asc"):n.sortBy!==r?n.onSortChange(r,"desc"):n.sortOrder==="desc"?n.onSortChange(r,"asc"):n.onSortChange("title","asc")},v=r=>{const l=u(r),c="btn btn-sm btn-primary btn-outline gap-2";return l==="inactive"?`${c}`:l==="asc"?`${c} btn-active`:`${c} btn-active`},k=r=>{const l=u(r);return l==="inactive"?null:l==="asc"?Re:je};var A=Pe(),m=o(A),y=o(m),B=o(y);Oe(B,{class:"inline size-4"}),P(),i(y);var E=f(y,2),C=o(E);C.__click=()=>p("title");var O=f(C,2);O.__click=()=>p("$createdAt");var X=o(O);{var Z=r=>{const l=T(()=>k("$createdAt"));var c=le(),R=se(c);ce(R,()=>e(l),(j,S)=>{S(j,{size:16})}),b(r,c)};D(X,r=>{k("$createdAt")&&r(Z)})}P(),i(O);var F=f(O,2);F.__click=()=>p("$updatedAt");var $=o(F);{var Q=r=>{const l=T(()=>k("$updatedAt"));var c=le(),R=se(c);ce(R,()=>e(l),(j,S)=>{S(j,{size:16})}),b(r,c)};D($,r=>{k("$updatedAt")&&r(Q)})}P(),i(F),i(E),i(m);var Y=f(m,2);{var q=r=>{var l=Ne(),c=o(l),R=f(o(c),2);{var j=a=>{var t=Qe();t.__click=()=>{_().forEach(d=>n.onTagToggle?.(d))};var s=o(t);ne(s,{class:"size-3"}),P(),i(t),W(()=>t.disabled=w()),b(a,t)};D(R,a=>{_().length>0&&a(j)})}i(c);var S=f(c,2);ve(S,21,I,ye,(a,t)=>{var s=Le();s.__click=()=>n.onTagToggle?.(e(t));var d=o(s),ee=f(d);{var H=M=>{ne(M,{class:"size-3"})};D(ee,M=>{_().includes(e(t))&&M(H)})}i(s),W(M=>{U(s,1,`badge ${M??""} gap-1 py-3`),s.disabled=w(),ge(d,`${e(t)??""} `)},[()=>_().includes(e(t))?"badge-primary cursor-pointer":"badge-outline hover:badge-primary cursor-pointer"]),b(a,s)}),i(S),i(l),b(r,l)};D(Y,r=>{I().length>0&&r(q)})}i(A),W((r,l,c)=>{U(C,1,r),U(O,1,l),U(F,1,c)},[()=>te(v("title")),()=>te(v("$createdAt")),()=>te(v("$updatedAt"))]),b(K,A),oe()}V(["click"]);V(["click"]);var Xe=h('<button class="btn btn-primary btn-sm"><!> Créer un document</button>'),qe=h('<div class="alert alert-error"><span> </span></div>'),Ge=h('<div class="py-8 text-center"><span class="loading loading-spinner loading-md"></span></div>'),Je=h('<div class="py-12 text-center"><p class="text-base-content/60 text-lg">Aucun document ne correspond aux critères...</p></div>'),We=h('<div class="py-12 text-center"><p class="text-base-content/60 mb-4 text-lg">Aucun document dans cette équipe</p> <button class="btn btn-primary"><!> Créer le premier document</button></div>'),Ye=h('<div class="my-8 space-y-3"></div> <!> <!> <!>',1),He=h('<div class="p-4"><div class="mx-auto max-w-4xl"><div class="mb-10 space-y-6"><div class="mb-4"><!></div>  <!></div> <!></div></div>');function tt(K,n){ie(n,!0);const I=a=>{var t=Xe();t.__click=()=>re(`/createdocument/${e(_)}/new`);var s=o(t);ue(s,{size:18}),P(),i(t),b(a,t)};let _=T(()=>Ce.params.teamId),w=L(""),u=L(we({tags:[]})),p=L("$updatedAt"),v=L("desc"),k=20,A=L(1),m=L(void 0),y=T(()=>ke.myTeams.find(a=>a.$id===e(_)));const B=T(()=>z.isInitialized?z.getTeamDocuments(e(_)):[]),E=T(()=>z.getTeamTags(e(_))),C=T(()=>{if(e(w).length>=2){const a=e(w).toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");return e(B).filter(t=>{const s=t.title.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(a),d=t.content?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(a);return s||d})}return e(B).filter(a=>!e(u).tags.length||e(u).tags.some(s=>a.tags?.includes(s)))}),O=T(()=>[...e(C)].sort((t,s)=>{if(e(p)==="title")return e(v)==="asc"?t.title.localeCompare(s.title,"fr"):s.title.localeCompare(t.title,"fr");if(e(p)==="$createdAt"){const d=new Date(s.$createdAt||0).getTime()-new Date(t.$createdAt||0).getTime();return e(v)==="asc"?-d:d}else{const d=new Date(s.$updatedAt||0).getTime()-new Date(t.$updatedAt||0).getTime();return e(v)==="asc"?-d:d}})),X=T(()=>e(O).slice(0,e(A)*k)),Z=T(()=>e(w).length>=2);function F(){N(w,"")}function $(a){e(u).tags.includes(a)?e(u).tags=e(u).tags.filter(t=>t!==a):e(u).tags=[...e(u).tags,a]}ae(()=>{if(!e(m))return;const a=new IntersectionObserver(t=>{t[0].isIntersecting&&e(X).length<e(C).length&&xe(A)},{threshold:.1});return a.observe(e(m)),()=>a.disconnect()}),ae(()=>{e(C),e(p),e(v),N(A,1)}),ae(()=>{e(y)&&de.setConfig({title:`Documents - ${e(y).name}`,actions:I})}),Te(()=>{de.reset()}),De(async()=>{z.isInitialized||await z.initialize(),e(y)||re("/dashboard/teams")});var Q=He(),Y=o(Q),q=o(Y),r=o(q),l=o(r);Fe(l,{onReset:F,placeholder:"Rechercher dans les documents...",get searchQuery(){return e(w)},set searchQuery(a){N(w,a,!0)}}),i(r);var c=f(r,2);Ke(c,{get sortBy(){return e(p)},get sortOrder(){return e(v)},get availableTags(){return e(E)},get selectedTags(){return e(u).tags},onTagToggle:$,get disabled(){return e(Z)},onSortChange:(a,t)=>{N(p,a,!0),N(v,t,!0)}}),i(q);var R=f(q,2);{var j=a=>{var t=qe(),s=o(t),d=o(s);i(s),i(t),W(()=>ge(d,`Erreur : ${z.error??""}`)),b(a,t)},S=a=>{var t=Ye(),s=se(t);ve(s,21,()=>e(X),g=>g.$id,(g,x)=>{Ie(g,{get doc(){return e(x)},get teamId(){return e(_)},get highlightedTags(){return e(u).tags},bgClass:"bg-base-100"})}),i(s);var d=f(s,2);{var ee=g=>{var x=Ge();Se(x,G=>N(m,G),()=>e(m)),b(g,x)};D(d,g=>{e(X).length<e(C).length&&g(ee)})}var H=f(d,2);{var M=g=>{var x=Je();b(g,x)};D(H,g=>{e(C).length===0&&g(M)})}var fe=f(H,2);{var be=g=>{var x=We(),G=f(o(x),2);G.__click=()=>re(`/createdocument/${e(_)}/new`);var me=o(G);ue(me,{size:18}),P(),i(G),i(x),b(g,x)};D(fe,g=>{e(B).length===0&&!z.loading&&g(be)})}b(a,t)};D(R,a=>{z.error?a(j):a(S,!1)})}i(Y),i(Q),Ae(3,Q,()=>ze),b(K,Q),oe()}V(["click"]);export{tt as default};
