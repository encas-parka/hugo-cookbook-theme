import{S as _e,X as ne,v as he,A as pe,l as ye,P as le}from"./icons.js";import{p as X,v as h,h as f,I as D,w as Z,R as we,b,c as ie,d as oe,g as o,B as W,L as xe,U as Te,o as i,aa as te,C as V,j as ce,k as se,a6 as de,m as e,u as T,e as ve,x as ge,i as De,K as Q,y as M,z as Ae,H as ae,$ as Ce,Z as ke,ab as Se,A as P,a3 as z,E as re,F as ze,P as Ie}from"./appwrite.js";import{n as ue}from"./index.js";import{D as Be}from"./DocCard.js";import"./date-helpers.js";var Oe=h('<button class="btn join-item btn-ghost btn-lg" aria-label="Effacer la recherche"><!></button>'),Re=h('<div class="input input-lg w-full"><!> <input type="text" class="join-item grow" aria-label="Rechercher"/> <!></div>');function je(N,s){oe(s,!0);let I=X(s,"searchQuery",15),_=X(s,"placeholder",3,"Rechercher...");function w(m){m.key==="Escape"&&s.onReset()}var u=Re(),p=o(u);_e(p,{class:"text-base-content/50 join-item h-5 w-5"});var v=f(p,2);Te(v),v.__keydown=w;var k=f(v,2);{var A=m=>{var y=Oe();y.__click=function(...F){s.onReset?.apply(this,F)};var B=o(y);ne(B,{class:"h-5 w-5"}),i(y),b(m,y)};D(k,m=>{I().length>0&&m(A)})}i(u),Z(()=>xe(v,"placeholder",_())),we(v,I),b(N,u),ie()}W(["keydown","click"]);var Ee=h('<button class="btn btn-ghost btn-xs"><!> Tout effacer</button>'),Fe=h("<button> <!></button>"),Le=h('<fieldset class="fieldset w-full sm:flex-1"><legend class="legend label flex items-center justify-between"><span>Filtrer par tags :</span> <!></legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),Me=h('<div class="bg-base-300 rounded-box flex flex-wrap items-center justify-between gap-6 px-6 py-6"><fieldset class="fieldset w-full sm:flex-1"><legend class="legend label"><!> Trier par :</legend> <div class="btn-group"><button aria-label="Trier par noms">Nom</button> <button aria-label="Trier par date de création"><!> Date de création</button> <button aria-label="Trier par date de modification"><!> Date de modification</button></div></fieldset> <!></div>');function Pe(N,s){oe(s,!0);let I=X(s,"availableTags",19,()=>[]),_=X(s,"selectedTags",19,()=>[]),w=X(s,"disabled",3,!1);const u=r=>s.sortBy!==r?"inactive":s.sortOrder,p=r=>{r==="title"?s.onSortChange("title",s.sortBy==="title"&&s.sortOrder==="asc"?"desc":"asc"):s.sortBy!==r?s.onSortChange(r,"desc"):s.sortOrder==="desc"?s.onSortChange(r,"asc"):s.onSortChange("title","asc")},v=r=>{const l=u(r),c="btn btn-sm btn-primary btn-outline gap-2";return l==="inactive"?`${c}`:l==="asc"?`${c} btn-active`:`${c} btn-active`},k=r=>{const l=u(r);return l==="inactive"?null:l==="asc"?pe:ye};var A=Me(),m=o(A),y=o(m),B=o(y);he(B,{class:"inline size-4"}),Q(),i(y);var F=f(y,2),C=o(F);C.__click=()=>p("title");var O=f(C,2);O.__click=()=>p("$createdAt");var K=o(O);{var Y=r=>{const l=T(()=>k("$createdAt"));var c=ce(),R=se(c);de(R,()=>e(l),(j,S)=>{S(j,{size:16})}),b(r,c)};D(K,r=>{k("$createdAt")&&r(Y)})}Q(),i(O);var L=f(O,2);L.__click=()=>p("$updatedAt");var $=o(L);{var q=r=>{const l=T(()=>k("$updatedAt"));var c=ce(),R=se(c);de(R,()=>e(l),(j,S)=>{S(j,{size:16})}),b(r,c)};D($,r=>{k("$updatedAt")&&r(q)})}Q(),i(L),i(F),i(m);var G=f(m,2);{var H=r=>{var l=Le(),c=o(l),R=f(o(c),2);{var j=a=>{var t=Ee();t.__click=()=>{_().forEach(d=>s.onTagToggle?.(d))};var n=o(t);ne(n,{class:"size-3"}),Q(),i(t),Z(()=>t.disabled=w()),b(a,t)};D(R,a=>{_().length>0&&a(j)})}i(c);var S=f(c,2);ve(S,21,I,De,(a,t)=>{var n=Fe();n.__click=()=>s.onTagToggle?.(e(t));var d=o(n),ee=f(d);{var J=E=>{ne(E,{class:"size-3"})};D(ee,E=>{_().includes(e(t))&&E(J)})}i(n),Z(E=>{V(n,1,`badge ${E??""} gap-1 py-3`),n.disabled=w(),ge(d,`${e(t)??""} `)},[()=>_().includes(e(t))?"badge-primary cursor-pointer":"badge-outline hover:badge-primary cursor-pointer"]),b(a,n)}),i(S),i(l),b(r,l)};D(G,r=>{I().length>0&&r(H)})}i(A),Z((r,l,c)=>{V(C,1,r),V(O,1,l),V(L,1,c)},[()=>te(v("title")),()=>te(v("$createdAt")),()=>te(v("$updatedAt"))]),b(N,A),ie()}W(["click"]);W(["click"]);var Qe=h('<button class="btn btn-primary"><!> Créer un document</button>'),Ne=h('<div class="alert alert-error"><span> </span></div>'),Ke=h('<div class="py-8 text-center"><span class="loading loading-spinner loading-md"></span></div>'),qe=h('<div class="py-12 text-center"><p class="text-base-content/60 text-lg">Aucun document ne correspond aux critères...</p></div>'),He=h('<div class="py-12 text-center"><p class="text-base-content/60 mb-4 text-lg">Aucun document dans cette équipe</p> <button class="btn btn-primary"><!> Créer le premier document</button></div>'),Ue=h('<div class="my-8 space-y-3"></div> <!> <!> <!>',1),Xe=h('<div class="p-4"><div class="mx-auto max-w-4xl"><div class="mb-10 space-y-6"><div class="mb-4"><!></div>  <!></div> <!></div></div>');function Ye(N,s){oe(s,!0);const I=a=>{var t=Qe();t.__click=()=>re(`/createdocument/${e(_)}/new`);var n=o(t);le(n,{size:18}),Q(),i(t),b(a,t)};let _=T(()=>s.params.teamId),w=M(""),u=M(Ae({tags:[]})),p=M("$updatedAt"),v=M("desc"),k=20,A=M(1),m=M(void 0),y=T(()=>ze.myTeams.find(a=>a.$id===e(_)));const B=T(()=>z.isInitialized?z.getTeamDocuments(e(_)):[]),F=T(()=>z.getTeamTags(e(_))),C=T(()=>{if(e(w).length>=2){const a=e(w).toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");return e(B).filter(t=>{const n=t.title.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(a),d=t.content?.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").includes(a);return n||d})}return e(B).filter(a=>!e(u).tags.length||e(u).tags.some(n=>a.tags?.includes(n)))}),O=T(()=>[...e(C)].sort((t,n)=>{if(e(p)==="title")return e(v)==="asc"?t.title.localeCompare(n.title,"fr"):n.title.localeCompare(t.title,"fr");if(e(p)==="$createdAt"){const d=new Date(n.$createdAt||0).getTime()-new Date(t.$createdAt||0).getTime();return e(v)==="asc"?-d:d}else{const d=new Date(n.$updatedAt||0).getTime()-new Date(t.$updatedAt||0).getTime();return e(v)==="asc"?-d:d}})),K=T(()=>e(O).slice(0,e(A)*k)),Y=T(()=>e(w).length>=2);function L(){P(w,"")}function $(a){e(u).tags.includes(a)?e(u).tags=e(u).tags.filter(t=>t!==a):e(u).tags=[...e(u).tags,a]}ae(()=>{if(!e(m))return;const a=new IntersectionObserver(t=>{t[0].isIntersecting&&e(K).length<e(C).length&&Se(A)},{threshold:.1});return a.observe(e(m)),()=>a.disconnect()}),ae(()=>{e(C),e(p),e(v),P(A,1)}),ae(()=>{e(y)&&ue.setConfig({title:`Documents - ${e(y).name}`,actions:I})}),Ce(()=>{ue.reset()}),ke(async()=>{z.isInitialized||await z.initialize(),e(y)||re("/dashboard/teams")});var q=Xe(),G=o(q),H=o(G),r=o(H),l=o(r);je(l,{onReset:L,placeholder:"Rechercher dans les documents...",get searchQuery(){return e(w)},set searchQuery(a){P(w,a,!0)}}),i(r);var c=f(r,2);Pe(c,{get sortBy(){return e(p)},get sortOrder(){return e(v)},get availableTags(){return e(F)},get selectedTags(){return e(u).tags},onTagToggle:$,get disabled(){return e(Y)},onSortChange:(a,t)=>{P(p,a,!0),P(v,t,!0)}}),i(H);var R=f(H,2);{var j=a=>{var t=Ne(),n=o(t),d=o(n);i(n),i(t),Z(()=>ge(d,`Erreur : ${z.error??""}`)),b(a,t)},S=a=>{var t=Ue(),n=se(t);ve(n,21,()=>e(K),g=>g.$id,(g,x)=>{Be(g,{get doc(){return e(x)},get teamId(){return e(_)},get highlightedTags(){return e(u).tags},bgClass:"bg-base-100"})}),i(n);var d=f(n,2);{var ee=g=>{var x=Ke();Ie(x,U=>P(m,U),()=>e(m)),b(g,x)};D(d,g=>{e(K).length<e(C).length&&g(ee)})}var J=f(d,2);{var E=g=>{var x=qe();b(g,x)};D(J,g=>{e(C).length===0&&g(E)})}var fe=f(J,2);{var be=g=>{var x=He(),U=f(o(x),2);U.__click=()=>re(`/createdocument/${e(_)}/new`);var me=o(U);le(me,{size:18}),Q(),i(U),i(x),b(g,x)};D(fe,g=>{e(B).length===0&&!z.loading&&g(be)})}b(a,t)};D(R,a=>{z.error?a(j):a(S,!1)})}i(G),i(q),b(N,q),ie()}W(["click"]);export{Ye as default};
