import{B as yt,d as wt,p as se,y as L,z as Be,J as Te,m as e,u as k,A as d,v as p,h as s,G as Ke,o as r,g as n,K as I,b as u,c as kt,W as We,aI as Nt,R as _t,w as q,M as ue,T as He,N as nt,e as lt,C as B,x as X,S as Lt,ai as bt,ab as qt,k as jt,ag as mt,an as Gt}from"./appwrite.js";import{k as Bt}from"./keyboardNavigation.svelte.js";import{c as Kt,S as Wt,g as Ht,k as Ve,U as Vt,aM as Zt,aN as Jt,aO as gt,ak as Qt,aI as ht,a7 as it,X as Xt,G as $t,aP as Yt}from"./icons.js";import{C as ea}from"./ConfirmModal.js";import{f as ta}from"./products-display.js";import{e as aa,b as xt,d as ra}from"./date-helpers.js";import{a as sa}from"./index2.js";function ia(y,{from:l,to:t},ye={}){var{delay:b=0,duration:x=G=>Math.sqrt(G)*120,easing:m=sa}=ye,$=getComputedStyle(y),K=$.transform==="none"?"":$.transform,[j,v]=$.transformOrigin.split(" ").map(parseFloat);j/=y.clientWidth,v/=y.clientHeight;var z=na(y),E=y.clientWidth/t.width/z,W=y.clientHeight/t.height/z,A=l.left+l.width*j,pe=l.top+l.height*v,T=t.left+t.width*j,g=t.top+t.height*v,O=(A-T)*E,Y=(pe-g)*W,ie=l.width/t.width,ne=l.height/t.height;return{delay:b,duration:typeof x=="function"?x(Math.sqrt(O*O+Y*Y)):x,easing:m,css:(G,H)=>{var V=H*O,le=H*Y,fe=G+H*ie,ee=G+H*ne;return`transform: ${K} translate(${V}px, ${le}px) scale(${fe}, ${ee});`}}}function na(y){if("currentCSSZoom"in y)return y.currentCSSZoom;for(var l=y,t=1;l!==null;)t*=+getComputedStyle(l).zoom,l=l.parentElement;return t}var la=p('<span class="text-base-content/70 text-xs font-normal"> </span>'),oa=p('<span class="badge badge-ghost badge-sm text-xs opacity-70">brouillon</span>'),da=p('<button type="button" role="option"><div class="bg-base-200 rounded p-1"><!></div> <div class="flex min-w-0 flex-1 flex-wrap items-center gap-2"><span class="truncate text-sm font-medium"> </span> <!> <!></div></button>'),ca=p('<div id="recipes-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"></div>'),va=p('<div class="mt-2"><div class="relative"><div class="input flex w-full items-center gap-2 pr-10"><!> <input type="text" placeholder="Rechercher une recette..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="recipes-list"/> <!></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div>'),ua=p('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center justify-between"><h6 class="flex items-center gap-2"><!> Ajouter une recette</h6></div> <!></div></div>');function pa(y,l){wt(l,!0);let t=se(l,"defaultPlates",3,4),ye=se(l,"autoFocus",3,!1),b=se(l,"disabled",3,!1),x=L(""),m=L(void 0),$=L(Be(t())),K=L(null),j=!1,v=L(0),z=L(!1),E=L(void 0),W=L(void 0),A=k(()=>e(z)&&!e(x).trim()?nt.getAllRecipes():e(x).trim().length<2?[]:nt.searchRecipes(e(x))),pe=k(()=>e(A).length>0),T=k(()=>e(pe)||e(z)),g=k(()=>e(A).length>0?e(v)===-1?0:e(v)%e(A).length:-1);Te(()=>{if(e(T)){const o=S=>{e(E)&&!e(E).contains(S.target)&&ie()};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}}});function O(){d(K,null),d(x,""),d($,t()),d(v,0),d(z,!1)}function Y(){d(z,!0),d(x,""),d(v,0)}function ie(){d(z,!1),d(x,""),d(v,0)}function ne(){e(T)?ie():Y()}function G(o){d(K,o,!0);const S=o.typeR;d(m,e(m)?e(m):S,!0),l.onSelect(o,e(m),e($)),O()}function H(o){if(o.key==="Escape"){o.preventDefault(),ie();return}if(!e(T)||!e(A).length){o.key==="Enter"&&e(x).trim().length>1&&!e(z)&&(o.preventDefault(),Y());return}o.key==="ArrowDown"?(o.preventDefault(),d(v,e(v)+1),V()):o.key==="ArrowUp"?(o.preventDefault(),d(v,e(v)-1),V()):o.key==="Enter"&&e(g)>=0&&(o.preventDefault(),G(e(A)[e(g)]))}function V(){if(e(g)>=0&&e(W)){const o=e(W).querySelector(`#recipe-${e(g)}`);o&&o.scrollIntoView({block:"nearest"})}}var le=ua(),fe=s(le),ee=s(fe),we=s(ee),Z=s(we);Kt(Z,{class:"text-primary h-4 w-4"}),Ke(),r(we),r(ee);var ke=n(ee,2);{var Se=o=>{var S=va(),Oe=s(S),te=s(Oe),Re=s(te);Wt(Re,{class:"h-4 w-4 opacity-50"});var F=n(Re,2);We(F),F.__keydown=H,Nt(F,()=>Bt({shouldFocus:ye(),onEmptySubmit:l.onEmptySubmit}));var Ze=n(F,2);I(Ze,M=>{}),r(te);var J=n(te,2);J.__click=ne;var Me=s(J);{let M=k(()=>e(T)?"rotate-180":"");Ht(Me,{get class(){return`h-4 w-4 transition-transform ${e(M)??""}`}})}r(J);var Je=n(J,2);{var Pe=M=>{var _e=ca();lt(_e,23,()=>e(A),oe=>oe.$id,(oe,de,be)=>{var N=da();N.__click=()=>G(e(de)),N.disabled=j;var De=s(N),a=s(De);Ve(a,{class:"h-4 w-4 opacity-70"}),r(De);var i=n(De,2),c=s(i),f=s(c,!0);r(c);var R=n(c,2);{var P=h=>{var D=la(),ae=s(D);r(D),q(()=>X(ae,`(${e(de).versionLabel??""})`)),u(h,D)};I(R,h=>{e(de).versionLabel&&h(P)})}var Q=n(R,2);{var ce=h=>{var D=oa();u(h,D)};I(Q,h=>{e(de).draft&&h(ce)})}r(i),r(N),q(()=>{ue(N,"id",`recipe-${e(be)??""}`),B(N,1,`hover:bg-base-200 flex w-full items-center gap-2 px-4 py-3 text-left hover:cursor-pointer ${e(be)===e(g)?"bg-base-200":""}`),ue(N,"aria-selected",e(be)===e(g)),X(f,e(de).title)}),Lt("mouseenter",N,()=>d(v,e(be),!0)),u(oe,N)}),r(_e),_t(_e,oe=>d(W,oe),()=>e(W)),u(M,_e)};I(Je,M=>{e(T)&&e(A).length>0&&M(Pe)})}r(Oe),r(S),_t(S,M=>d(E,M),()=>e(E)),q(()=>{F.disabled=b(),ue(F,"aria-expanded",e(T)),ue(F,"aria-activedescendant",e(T)?`recipe-${e(g)}`:void 0),J.disabled=b(),ue(J,"aria-label",e(T)?"Fermer le menu":"Ouvrir le menu")}),He(F,()=>e(x),M=>d(x,M)),u(o,S)};I(ke,o=>{e(K)||o(Se)})}r(fe),r(le),u(y,le),kt()}yt(["keydown","click"]);var fa=p(`<button class="btn btn-ghost text-primary" title="Terminer l'édition">valider</button> <button class="btn btn-ghost btn-square text-error" title="Supprimer"><!></button>`,1),_a=p('<button class="btn btn-ghost" title="Éditer"><!></button>'),ba=p('<p class="text-error mt-1 text-xs">Cette date/heure est déjà utilisée</p>'),ma=p('<span class="text-error ms-2 text-sm font-normal">(Recette introuvable)</span>'),ga=p('<div class="ring-base-300 flex items-center gap-1 rounded-xl p-1 ring-1"><div class="input w-28"><!> <input type="number" class="w-full text-center" min="1"/></div> <button class="btn btn-sm btn-circle me-1" title="Valider"><!></button> <button class="btn btn-sm btn-circle"><!></button></div>'),ha=p('<button title="Éditer les couverts"><span class="font-normal"> </span> <!></button>'),xa=p('<div><div class="flex flex-1 items-center gap-2"><div><!></div> <div class="min-w-56 flex-1"><div class="font-medium"> <!></div></div></div> <div class="me-10 flex items-center gap-2"><select class="select w-24"><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select> <!></div> <div class="ms-auto"><button class="btn btn-ghost btn-sm btn-square text-error" title="Retirer la recette"><!></button></div></div>'),ya=p('<div class="mb-4 space-y-2"></div>'),wa=p('<div class="mt-2 flex flex-wrap space-y-4"><div class="flex flex-wrap gap-4"><fieldset><label><span class="label">Date</span> <input type="date" class="w-full"/></label> <!></fieldset> <label class="select"><span class="label">Moment</span> <select><option disabled selected>Choisir un moment</option><option>Matin</option><option>Midi</option><option>Soir</option></select></label> <div><label class="input"><span class="label"><!> Couverts</span> <input type="number" class="w-full" min="1"/></label> <p class="text-base-content/60 pl-2 text-xs">Peut etre modifié individuellement pour chaque recette</p></div></div> <div class="w-full space-y-2 py-4"><div class="flex items-center justify-between"><div class="text-base-content/70 flex items-center gap-2 font-medium"><!> Recettes</div></div> <!> <!></div></div>'),ka=p('<div><!> <span> </span> <span class="badge badge-sm badge-outline font-normal"> <!></span></div>'),Sa=p('<div class="flex flex-wrap gap-2"></div>'),Ra=p('<p class="text-base-content/60 text-sm italic">Aucune recette</p>'),Da=p('<div class="space-y-2"><!></div>'),Ca=p('<div role="button"><div class="card-body p-4"><div class="mb-2 flex items-start justify-between"><div class="flex flex-wrap items-center gap-4"><span> </span> <div><!> <div> </div></div> <div class="text-base-content/80 flex items-center gap-1 font-semibold"><!> </div></div> <div class="flex gap-1"><!></div></div> <!></div> <!></div>');function Aa(y,l){wt(l,!0);let t=se(l,"meal",15),ye=se(l,"defaultGuests",3,100),b=se(l,"isEditing",15,!1),x=se(l,"allDates",19,()=>[]),m=se(l,"disabled",3,!1);Te(()=>{m()&&b()&&b(!1)});let $=!1;t().guests||t(t().guests=ye(),!0),t().recipes||t(t().recipes=[],!0);let K=k(()=>xt(t().date||"")),j=L(Be(aa(t().date||""))),v=L(Be(xt(t().date||""))),z=k(()=>e(v)?ra(e(j),e(v)):""),E=k(()=>t().date?x().filter(i=>i===t().date).length>1:!1);function W({newDate:a="",newMoment:i=""}){t().date,(a||i)&&t(t().date=e(z),!0)}const A=k(()=>{const a=e(K)||"";return a==="matin"?Zt:a==="midi"?Jt:a==="soir"?gt:gt}),pe={entree:1,plat:2,dessert:3,autre:4};function T(a){return[...a].sort((i,c)=>{const f=pe[i.typeR],R=pe[c.typeR];return f-R})}Te(()=>{const a=T(t().recipes);t().recipes.some((c,f)=>c.recipeUuid!==a[f]?.recipeUuid)&&bt(()=>{t(t().recipes=a,!0)})});let g=Be({});function O(a){return`${t().id}-${a}`}Te(()=>{t().recipes.forEach(a=>{const i=O(a.recipeUuid);g[i]===void 0&&(g[i]=!1)})}),Te(()=>{const a=t().guests;t().recipes.forEach(i=>{!i.hasOwnPlatesNb&&!g[O(i.recipeUuid)]&&i.plates!==a&&bt(()=>{i.plates=a})})});function Y(a){if(t().recipes.some(f=>f.recipeUuid===a.$id))return;const c={recipeUuid:a.$id,plates:t().guests,typeR:a.typeR,hasOwnPlatesNb:!1};t(t().recipes=[...t().recipes,{...c}],!0)}function ie(a){t(t().recipes=t().recipes.filter(i=>i.recipeUuid!==a),!0)}function ne(a){return nt.getRecipeIndexByUuid(a)}function G(a){return a.split("_")[0]}function H(a){return!ne(a)}let V=L(!1);function le(){t().recipes.length>0?d(V,!0):l.onDelete()}function fe(){d(V,!1),l.onDelete()}function ee(){m()||b()&&l.onEditToggle||!b()&&l.onEditToggle&&l.onEditToggle()}function we(a,i=!1){return i?"badge-error":a==="entree"?"bg-lime-100 border-lime-200":a==="plat"?"bg-orange-100 border-orange-200":a==="dessert"?"bg-pink-100 border-pink-200":a==="autre"?"bg-purple-100 border-purple-200":"bg-base-200"}var Z=Ca();Z.__click=ee,Z.__keydown=a=>{(a.key==="Enter"||a.key===" ")&&!b()&&ee()};var ke=s(Z),Se=s(ke),o=s(Se),S=s(o),Oe=s(S,!0);r(S);var te=n(S,2),Re=s(te);qt(Re,()=>e(A),(a,i)=>{i(a,{size:16})});var F=n(Re,2),Ze=s(F,!0);r(F),r(te);var J=n(te,2),Me=s(J);Vt(Me,{class:"size-4 stroke-3"});var Je=n(Me);r(J),r(o);var Pe=n(o,2),M=s(Pe);{var _e=a=>{var i=fa(),c=jt(i);c.__click=()=>{b(!1)};var f=n(c,2);f.__click=le;var R=s(f);Qt(R,{class:"h-4 w-4"}),r(f),q(()=>{c.disabled=m(),f.disabled=m()}),u(a,i)},oe=a=>{var i=_a();i.__click=()=>{b(!0),l.onEditToggle&&l.onEditToggle()};var c=s(i);ht(c,{class:"h-4 w-4"}),r(i),q(()=>i.disabled=m()),u(a,i)};I(M,a=>{b()?a(_e):a(oe,!1)})}r(Pe),r(Se);var de=n(Se,2);{var be=a=>{var i=wa(),c=s(i),f=s(c),R=s(f),P=n(s(R),2);We(P),P.__change=()=>W({newDate:e(j)}),r(R);var Q=n(R,2);{var ce=C=>{var Ue=ba();u(C,Ue)};I(Q,C=>{e(E)&&C(ce)})}r(f);var h=n(f,2),D=n(s(h),2);D.__change=()=>W({newMoment:e(v)});var ae=s(D);ae.value=ae.__value="";var re=n(ae);re.value=re.__value="matin";var me=n(re);me.value=me.__value="midi";var ge=n(me);ge.value=ge.__value="soir",r(D),r(h);var Ie=n(h,2),Ce=s(Ie),he=s(Ce),Qe=s(he);it(Qe,{class:"text-base-content/50 me-1 h-4 w-4"}),Ke(),r(he);var ze=n(he,2);We(ze),r(Ce),Ke(2),r(Ie),r(c);var Ae=n(c,2),Xe=s(Ae),ot=s(Xe),St=s(ot);Ve(St,{class:"size-5"}),Ke(),r(ot),r(Xe);var dt=n(Xe,2);{var Rt=C=>{var Ue=ya();lt(Ue,31,()=>t().recipes,$e=>$e.recipeUuid,($e,_,Ua)=>{const Ct=k(()=>ne(e(_).recipeUuid)),Ye=k(()=>H(e(_).recipeUuid));var Ee=xa(),et=s(Ee),Fe=s(et),Ut=s(Fe);Ve(Ut,{class:"h-5 w-5"}),r(Fe);var ct=n(Fe,2),vt=s(ct),ut=s(vt),Et=n(ut);{var Tt=w=>{var U=ma();u(w,U)};I(Et,w=>{e(Ye)&&w(Tt)})}r(vt),r(ct),r(et);var tt=n(et,2),Ne=s(tt),at=s(Ne);at.value=at.__value="entree";var rt=n(at);rt.value=rt.__value="plat";var st=n(rt);st.value=st.__value="dessert";var pt=n(st);pt.value=pt.__value="autre",r(Ne);var Ot=n(Ne,2);{var Mt=w=>{var U=ga(),ve=s(U),qe=s(ve);it(qe,{class:"h-4 w-4 opacity-50"});var je=n(qe,2);We(je),r(ve);var xe=n(ve,2);xe.__click=()=>{g[O(e(_).recipeUuid)]=!1};var zt=s(xe);$t(zt,{class:"text-success h-4 w-4"}),r(xe);var Ge=n(xe,2);Ge.__click=()=>{g[O(e(_).recipeUuid)]=!1,e(_).hasOwnPlatesNb=!1,e(_).plates=t().guests};var At=s(Ge);Yt(At,{class:"text-secondary h-4 w-4"}),r(Ge),r(U),q(()=>ue(Ge,"title",`Revenir au nombre de couvert du repas (${t().guests??""})`)),He(je,()=>e(_).plates,Ft=>e(_).plates=Ft),u(w,U)},Pt=w=>{var U=ha();U.__click=()=>{const xe=O(e(_).recipeUuid);g[xe]=!0,e(_).hasOwnPlatesNb=!0};var ve=s(U),qe=s(ve);r(ve);var je=n(ve,2);ht(je,{size:14,class:"text-base-content/70  ms-1"}),r(U),q(()=>{B(U,1,`btn ${e(_).hasOwnPlatesNb?"btn-soft btn-warning":"btn-ghost"}`),X(qe,`${e(_).plates??""}
                          pers.`)}),u(w,U)};I(Ot,w=>{g[O(e(_).recipeUuid)]?w(Mt):w(Pt,!1)})}r(tt);var ft=n(tt,2),Le=s(ft);Le.__click=()=>ie(e(_).recipeUuid);var It=s(Le);Xt(It,{class:"h-4 w-4"}),r(Le),r(ft),r(Ee),q((w,U)=>{B(Ee,1,`bg-base-200 flex flex-wrap items-center gap-3 rounded-lg p-3 ${(e(Ye)&&"border-error border-2")??""}`),B(Fe,1,`${w??""} rounded-md border-2 p-2`),X(ut,`${U??""} `),Le.disabled=m()},[()=>we(e(_).typeR,e(Ye)),()=>e(Ct)?.title||G(e(_).recipeUuid)]),mt(Ne,()=>e(_).typeR,w=>e(_).typeR=w),Gt(Ee,()=>ia,()=>({duration:200})),u($e,Ee)}),r(Ue),u(C,Ue)};I(dt,C=>{t().recipes.length>=1&&C(Rt)})}var Dt=n(dt,2);pa(Dt,{onSelect:Y,get defaultPlates(){return t().guests},autoFocus:$,get onEmptySubmit(){return l.onEmptySearchSubmit},get disabled(){return m()}}),r(Ae),r(i),q(()=>{B(R,1,`input ${e(E)?"input-error":""}`),B(D,1,`w-full ${e(E)?"select-error":""}`)}),He(P,()=>e(j),C=>d(j,C)),mt(D,()=>e(v),C=>d(v,C)),He(ze,()=>t().guests,C=>t(t().guests=C,!0)),u(a,i)},N=a=>{var i=Da(),c=s(i);{var f=P=>{var Q=Sa();lt(Q,21,()=>t().recipes,ce=>ce.recipeUuid,(ce,h)=>{const D=k(()=>ne(e(h).recipeUuid)),ae=k(()=>H(e(h).recipeUuid));var re=ka(),me=s(re);Ve(me,{class:"h-4 w-4"});var ge=n(me,2),Ie=s(ge,!0);r(ge);var Ce=n(ge,2),he=s(Ce),Qe=n(he);it(Qe,{size:12}),r(Ce),r(re),q((ze,Ae)=>{B(re,1,`badge badge-lg ${ze??""} h-auto gap-2 py-1 font-medium ${e(ae)?"ring-error ring-1":""}`),X(Ie,Ae),X(he,`${e(h).plates??""} `)},[()=>we(e(h).typeR,e(ae)),()=>e(D)?.title||G(e(h).recipeUuid)]),u(ce,re)}),r(Q),u(P,Q)},R=P=>{var Q=Ra();u(P,Q)};I(c,P=>{t().recipes.length>0?P(f):P(R,!1)})}r(i),u(a,i)};I(de,a=>{b()?a(be):a(N,!1)})}r(ke);var De=n(ke,2);{let a=k(()=>`Ce repas contient ${t().recipes.length} recette(s). Êtes-vous sûr de vouloir le supprimer ?`);ea(De,{get isOpen(){return e(V)},title:"Supprimer le repas",get message(){return e(a)},variant:"danger",confirmLabel:"Supprimer",cancelLabel:"Annuler",onConfirm:fe,onCancel:()=>d(V,!1)})}r(Z),q((a,i)=>{B(Z,1,`card bg-base-100 border-base-200 border shadow-sm transition-all hover:shadow-md ${b()?"ring-accent/40 ring-2":""} ${b()||m()?"":"hover:ring-accent/60 cursor-pointer hover:ring-2"} ${m()?"opacity-75":""}`),ue(Z,"tabindex",b()||m()?-1:0),B(S,1,`text-primary text-lg font-medium ${(e(E)&&"text-error")??""}`),X(Oe,a),B(te,1,`font-base flex items-center gap-1 ${(e(E)&&"text-error")??""}`),X(Ze,i),X(Je,` ${t().guests??""} pers.`)},[()=>t().date?ta(t().date):"Date non définie",()=>e(K)?e(K).toUpperCase():"REPAS"]),u(y,Z),kt()}yt(["click","keydown","change"]);export{Aa as E,ia as f};
