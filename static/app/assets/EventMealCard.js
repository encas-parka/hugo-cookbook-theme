import{P as Lt,S as qt,f as jt,k as Ge,U as Nt,aq as Bt,ar as Gt,as as _t,T as Ht,aj as bt,D as it,X as Kt,z as Qt,at as Vt}from"./icons.js";import{B as yt,d as wt,p as se,y as q,z as He,H as Te,m as e,u as k,A as d,v as p,g as s,h as n,I as M,b as u,c as kt,aE as Wt,P as mt,w as j,L as ue,R as Ke,J as nt,K as Qe,o as r,U as Ve,e as lt,C as G,x as X,Q as Zt,ay as gt,a6 as Jt,k as Xt,al as ht,az as $t}from"./appwrite.js";import{k as Yt}from"./keyboardNavigation.svelte.js";import{C as ea}from"./ConfirmModal.js";import{f as ta}from"./products-display.js";import{e as aa,a as xt,d as ra}from"./date-helpers.js";import{d as sa}from"./index.js";var ia=p('<span class="text-base-content/70 text-xs font-normal"> </span>'),na=p('<span class="badge badge-ghost badge-sm text-xs opacity-70">brouillon</span>'),la=p('<button type="button" role="option"><div class="bg-base-200 rounded p-1"><!></div> <div class="flex min-w-0 flex-1 flex-wrap items-center gap-2"><span class="truncate text-sm font-medium"> </span> <!> <!></div></button>'),oa=p('<div id="recipes-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"></div>'),da=p('<div class="mt-2"><div class="relative"><div class="input flex w-full items-center gap-2 pr-10"><!> <input type="text" placeholder="Rechercher une recette..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="recipes-list"/> <!></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div>'),ca=p('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center justify-between"><h6 class="flex items-center gap-2"><!> Ajouter une recette</h6></div> <!></div></div>');function va(y,l){wt(l,!0);let t=se(l,"defaultPlates",3,4),ye=se(l,"autoFocus",3,!1),b=se(l,"disabled",3,!1),x=q(""),m=q(void 0),$=q(He(t())),H=q(null),N=!1,v=q(0),I=q(!1),E=q(void 0),K=q(void 0),A=k(()=>e(I)&&!e(x).trim()?nt.getAllRecipes():e(x).trim().length<2?[]:nt.searchRecipes(e(x))),pe=k(()=>e(A).length>0),T=k(()=>e(pe)||e(I)),g=k(()=>e(A).length>0?e(v)===-1?0:e(v)%e(A).length:-1);Te(()=>{if(e(T)){const o=R=>{e(E)&&!e(E).contains(R.target)&&ie()};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}}});function O(){d(H,null),d(x,""),d($,t()),d(v,0),d(I,!1)}function Y(){d(I,!0),d(x,""),d(v,0)}function ie(){d(I,!1),d(x,""),d(v,0)}function ne(){e(T)?ie():Y()}function B(o){d(H,o,!0);const R=o.typeR;d(m,e(m)?e(m):R,!0),l.onSelect(o,e(m),e($)),O()}function Q(o){if(o.key==="Escape"){o.preventDefault(),ie();return}if(!e(T)||!e(A).length){o.key==="Enter"&&e(x).trim().length>1&&!e(I)&&(o.preventDefault(),Y());return}o.key==="ArrowDown"?(o.preventDefault(),d(v,e(v)+1),V()):o.key==="ArrowUp"?(o.preventDefault(),d(v,e(v)-1),V()):o.key==="Enter"&&e(g)>=0&&(o.preventDefault(),B(e(A)[e(g)]))}function V(){if(e(g)>=0&&e(K)){const o=e(K).querySelector(`#recipe-${e(g)}`);o&&o.scrollIntoView({block:"nearest"})}}var le=ca(),fe=s(le),ee=s(fe),we=s(ee),W=s(we);Lt(W,{class:"text-primary h-4 w-4"}),Qe(),r(we),r(ee);var ke=n(ee,2);{var Re=o=>{var R=da(),Oe=s(R),te=s(Oe),Se=s(te);qt(Se,{class:"h-4 w-4 opacity-50"});var F=n(Se,2);Ve(F),F.__keydown=Q,Wt(F,()=>Yt({shouldFocus:ye(),onEmptySubmit:l.onEmptySubmit}));var We=n(F,2);M(We,P=>{}),r(te);var Z=n(te,2);Z.__click=ne;var Pe=s(Z);{let P=k(()=>e(T)?"rotate-180":"");jt(Pe,{get class(){return`h-4 w-4 transition-transform ${e(P)??""}`}})}r(Z);var Ze=n(Z,2);{var ze=P=>{var _e=oa();lt(_e,23,()=>e(A),oe=>oe.$id,(oe,de,be)=>{var L=la();L.__click=()=>B(e(de)),L.disabled=N;var De=s(L),a=s(De);Ge(a,{class:"h-4 w-4 opacity-70"}),r(De);var i=n(De,2),c=s(i),f=s(c,!0);r(c);var S=n(c,2);{var z=h=>{var D=ia(),ae=s(D);r(D),j(()=>X(ae,`(${e(de).versionLabel??""})`)),u(h,D)};M(S,h=>{e(de).versionLabel&&h(z)})}var J=n(S,2);{var ce=h=>{var D=na();u(h,D)};M(J,h=>{e(de).draft&&h(ce)})}r(i),r(L),j(()=>{ue(L,"id",`recipe-${e(be)??""}`),G(L,1,`hover:bg-base-200 flex w-full items-center gap-2 px-4 py-3 text-left hover:cursor-pointer ${e(be)===e(g)?"bg-base-200":""}`),ue(L,"aria-selected",e(be)===e(g)),X(f,e(de).title)}),Zt("mouseenter",L,()=>d(v,e(be),!0)),u(oe,L)}),r(_e),mt(_e,oe=>d(K,oe),()=>e(K)),u(P,_e)};M(Ze,P=>{e(T)&&e(A).length>0&&P(ze)})}r(Oe),r(R),mt(R,P=>d(E,P),()=>e(E)),j(()=>{F.disabled=b(),ue(F,"aria-expanded",e(T)),ue(F,"aria-activedescendant",e(T)?`recipe-${e(g)}`:void 0),Z.disabled=b(),ue(Z,"aria-label",e(T)?"Fermer le menu":"Ouvrir le menu")}),Ke(F,()=>e(x),P=>d(x,P)),u(o,R)};M(ke,o=>{e(H)||o(Re)})}r(fe),r(le),u(y,le),kt()}yt(["keydown","click"]);function ua(y,{from:l,to:t},ye={}){var{delay:b=0,duration:x=B=>Math.sqrt(B)*120,easing:m=sa}=ye,$=getComputedStyle(y),H=$.transform==="none"?"":$.transform,[N,v]=$.transformOrigin.split(" ").map(parseFloat);N/=y.clientWidth,v/=y.clientHeight;var I=pa(y),E=y.clientWidth/t.width/I,K=y.clientHeight/t.height/I,A=l.left+l.width*N,pe=l.top+l.height*v,T=t.left+t.width*N,g=t.top+t.height*v,O=(A-T)*E,Y=(pe-g)*K,ie=l.width/t.width,ne=l.height/t.height;return{delay:b,duration:typeof x=="function"?x(Math.sqrt(O*O+Y*Y)):x,easing:m,css:(B,Q)=>{var V=Q*O,le=Q*Y,fe=B+Q*ie,ee=B+Q*ne;return`transform: ${H} translate(${V}px, ${le}px) scale(${fe}, ${ee});`}}}function pa(y){if("currentCSSZoom"in y)return y.currentCSSZoom;for(var l=y,t=1;l!==null;)t*=+getComputedStyle(l).zoom,l=l.parentElement;return t}var fa=p(`<button class="btn btn-ghost text-primary" title="Terminer l'édition">valider</button> <button class="btn btn-ghost btn-square text-error" title="Supprimer"><!></button>`,1),_a=p('<button class="btn btn-ghost" title="Éditer"><!></button>'),ba=p('<p class="text-error mt-1 text-xs">Cette date/heure est déjà utilisée</p>'),ma=p('<span class="text-error ms-2 text-sm font-normal">(Recette introuvable)</span>'),ga=p('<div class="ring-base-300 flex items-center gap-1 rounded-xl p-1 ring-1"><div class="input w-28"><!> <input type="number" class="w-full text-center" min="1"/></div> <button class="btn btn-sm btn-circle me-1" title="Valider"><!></button> <button class="btn btn-sm btn-circle"><!></button></div>'),ha=p('<button title="Éditer les couverts"><span class="font-normal"> </span> <!></button>'),xa=p('<div><div class="flex flex-1 items-center gap-2"><div><!></div> <div class="min-w-56 flex-1"><div class="font-medium"> <!></div></div></div> <div class="me-10 flex items-center gap-2"><select class="select w-24"><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select> <!></div> <div class="ms-auto"><button class="btn btn-ghost btn-sm btn-square text-error" title="Retirer la recette"><!></button></div></div>'),ya=p('<div class="mb-4 space-y-2"></div>'),wa=p('<div class="mt-2 flex flex-wrap space-y-4"><div class="flex flex-wrap gap-4"><fieldset><label><span class="label">Date</span> <input type="date" class="w-full"/></label> <!></fieldset> <label class="select"><span class="label">Moment</span> <select><option disabled selected>Choisir un moment</option><option>Matin</option><option>Midi</option><option>Soir</option></select></label> <div><label class="input"><span class="label"><!> Couverts</span> <input type="number" class="w-full" min="1"/></label> <p class="text-base-content/60 pl-2 text-xs">Peut etre modifié individuellement pour chaque recette</p></div></div> <div class="w-full space-y-2 py-4"><div class="flex items-center justify-between"><div class="text-base-content/70 flex items-center gap-2 font-medium"><!> Recettes</div></div> <!> <!></div></div>'),ka=p('<div><!> <span> </span> <span class="badge badge-sm badge-outline font-normal"> <!></span></div>'),Ra=p('<div class="flex flex-wrap gap-2"></div>'),Sa=p('<p class="text-base-content/60 text-sm italic">Aucune recette</p>'),Da=p('<div class="space-y-2"><!></div>'),Ua=p('<div role="button"><div class="card-body p-4"><div class="mb-2 flex items-start justify-between"><div class="flex flex-wrap items-center gap-4"><span> </span> <div><!> <div> </div></div> <div class="text-base-content/80 flex items-center gap-1 font-semibold"><!> </div></div> <div class="flex gap-1"><!></div></div> <!></div> <!></div>');function Aa(y,l){wt(l,!0);let t=se(l,"meal",15),ye=se(l,"defaultGuests",3,100),b=se(l,"isEditing",15,!1),x=se(l,"allDates",19,()=>[]),m=se(l,"disabled",3,!1);Te(()=>{m()&&b()&&b(!1)});let $=!1;t().guests||t(t().guests=ye(),!0),t().recipes||t(t().recipes=[],!0);let H=k(()=>xt(t().date||"")),N=q(He(aa(t().date||""))),v=q(He(xt(t().date||""))),I=k(()=>e(v)?ra(e(N),e(v)):""),E=k(()=>t().date?x().filter(i=>i===t().date).length>1:!1);function K({newDate:a="",newMoment:i=""}){t().date,(a||i)&&t(t().date=e(I),!0)}const A=k(()=>{const a=e(H)||"";return a==="matin"?Bt:a==="midi"?Gt:a==="soir"?_t:_t}),pe={entree:1,plat:2,dessert:3,autre:4};function T(a){return[...a].sort((i,c)=>{const f=pe[i.typeR],S=pe[c.typeR];return f-S})}Te(()=>{const a=T(t().recipes);t().recipes.some((c,f)=>c.recipeUuid!==a[f]?.recipeUuid)&&gt(()=>{t(t().recipes=a,!0)})});let g=He({});function O(a){return`${t().id}-${a}`}Te(()=>{t().recipes.forEach(a=>{const i=O(a.recipeUuid);g[i]===void 0&&(g[i]=!1)})}),Te(()=>{const a=t().guests;t().recipes.forEach(i=>{!i.hasOwnPlatesNb&&!g[O(i.recipeUuid)]&&i.plates!==a&&gt(()=>{i.plates=a})})});function Y(a){if(t().recipes.some(f=>f.recipeUuid===a.$id))return;const c={recipeUuid:a.$id,plates:t().guests,typeR:a.typeR,hasOwnPlatesNb:!1};t(t().recipes=[...t().recipes,{...c}],!0)}function ie(a){t(t().recipes=t().recipes.filter(i=>i.recipeUuid!==a),!0)}function ne(a){return nt.getRecipeIndexByUuid(a)}function B(a){return a.split("_")[0]}function Q(a){return!ne(a)}let V=q(!1);function le(){t().recipes.length>0?d(V,!0):l.onDelete()}function fe(){d(V,!1),l.onDelete()}function ee(){m()||b()&&l.onEditToggle||!b()&&l.onEditToggle&&l.onEditToggle()}function we(a,i=!1){return i?"badge-error":a==="entree"?"bg-lime-100 border-lime-200":a==="plat"?"bg-orange-100 border-orange-200":a==="dessert"?"bg-pink-100 border-pink-200":a==="autre"?"bg-purple-100 border-purple-200":"bg-base-200"}var W=Ua();W.__click=ee,W.__keydown=a=>{(a.key==="Enter"||a.key===" ")&&!b()&&ee()};var ke=s(W),Re=s(ke),o=s(Re),R=s(o),Oe=s(R,!0);r(R);var te=n(R,2),Se=s(te);Jt(Se,()=>e(A),(a,i)=>{i(a,{size:16})});var F=n(Se,2),We=s(F,!0);r(F),r(te);var Z=n(te,2),Pe=s(Z);Nt(Pe,{class:"size-4 stroke-3"});var Ze=n(Pe);r(Z),r(o);var ze=n(o,2),P=s(ze);{var _e=a=>{var i=fa(),c=Xt(i);c.__click=()=>{b(!1)};var f=n(c,2);f.__click=le;var S=s(f);Ht(S,{class:"h-4 w-4"}),r(f),j(()=>{c.disabled=m(),f.disabled=m()}),u(a,i)},oe=a=>{var i=_a();i.__click=()=>{b(!0),l.onEditToggle&&l.onEditToggle()};var c=s(i);bt(c,{class:"h-4 w-4"}),r(i),j(()=>i.disabled=m()),u(a,i)};M(P,a=>{b()?a(_e):a(oe,!1)})}r(ze),r(Re);var de=n(Re,2);{var be=a=>{var i=wa(),c=s(i),f=s(c),S=s(f),z=n(s(S),2);Ve(z),z.__change=()=>K({newDate:e(N)}),r(S);var J=n(S,2);{var ce=U=>{var Ce=ba();u(U,Ce)};M(J,U=>{e(E)&&U(ce)})}r(f);var h=n(f,2),D=n(s(h),2);D.__change=()=>K({newMoment:e(v)});var ae=s(D);ae.value=ae.__value="";var re=n(ae);re.value=re.__value="matin";var me=n(re);me.value=me.__value="midi";var ge=n(me);ge.value=ge.__value="soir",r(D),r(h);var Me=n(h,2),Ue=s(Me),he=s(Ue),Je=s(he);it(Je,{class:"text-base-content/50 me-1 h-4 w-4"}),Qe(),r(he);var Ie=n(he,2);Ve(Ie),r(Ue),Qe(2),r(Me),r(c);var Ae=n(c,2),Xe=s(Ae),ot=s(Xe),Rt=s(ot);Ge(Rt,{class:"size-5"}),Qe(),r(ot),r(Xe);var dt=n(Xe,2);{var St=U=>{var Ce=ya();lt(Ce,31,()=>t().recipes,$e=>$e.recipeUuid,($e,_,Ca)=>{const Ut=k(()=>ne(e(_).recipeUuid)),Ye=k(()=>Q(e(_).recipeUuid));var Ee=xa(),et=s(Ee),Fe=s(et),Ct=s(Fe);Ge(Ct,{class:"h-5 w-5"}),r(Fe);var ct=n(Fe,2),vt=s(ct),ut=s(vt),Et=n(ut);{var Tt=w=>{var C=ma();u(w,C)};M(Et,w=>{e(Ye)&&w(Tt)})}r(vt),r(ct),r(et);var tt=n(et,2),Le=s(tt),at=s(Le);at.value=at.__value="entree";var rt=n(at);rt.value=rt.__value="plat";var st=n(rt);st.value=st.__value="dessert";var pt=n(st);pt.value=pt.__value="autre",r(Le);var Ot=n(Le,2);{var Pt=w=>{var C=ga(),ve=s(C),je=s(ve);it(je,{class:"h-4 w-4 opacity-50"});var Ne=n(je,2);Ve(Ne),r(ve);var xe=n(ve,2);xe.__click=()=>{g[O(e(_).recipeUuid)]=!1};var It=s(xe);Qt(It,{class:"text-success h-4 w-4"}),r(xe);var Be=n(xe,2);Be.__click=()=>{g[O(e(_).recipeUuid)]=!1,e(_).hasOwnPlatesNb=!1,e(_).plates=t().guests};var At=s(Be);Vt(At,{class:"text-secondary h-4 w-4"}),r(Be),r(C),j(()=>ue(Be,"title",`Revenir au nombre de couvert du repas (${t().guests??""})`)),Ke(Ne,()=>e(_).plates,Ft=>e(_).plates=Ft),u(w,C)},zt=w=>{var C=ha();C.__click=()=>{const xe=O(e(_).recipeUuid);g[xe]=!0,e(_).hasOwnPlatesNb=!0};var ve=s(C),je=s(ve);r(ve);var Ne=n(ve,2);bt(Ne,{size:14,class:"text-base-content/70  ms-1"}),r(C),j(()=>{G(C,1,`btn ${e(_).hasOwnPlatesNb?"btn-soft btn-warning":"btn-ghost"}`),X(je,`${e(_).plates??""}
                          pers.`)}),u(w,C)};M(Ot,w=>{g[O(e(_).recipeUuid)]?w(Pt):w(zt,!1)})}r(tt);var ft=n(tt,2),qe=s(ft);qe.__click=()=>ie(e(_).recipeUuid);var Mt=s(qe);Kt(Mt,{class:"h-4 w-4"}),r(qe),r(ft),r(Ee),j((w,C)=>{G(Ee,1,`bg-base-200 flex flex-wrap items-center gap-3 rounded-lg p-3 ${(e(Ye)&&"border-error border-2")??""}`),G(Fe,1,`${w??""} rounded-md border-2 p-2`),X(ut,`${C??""} `),qe.disabled=m()},[()=>we(e(_).typeR,e(Ye)),()=>e(Ut)?.title||B(e(_).recipeUuid)]),ht(Le,()=>e(_).typeR,w=>e(_).typeR=w),$t(Ee,()=>ua,()=>({duration:200})),u($e,Ee)}),r(Ce),u(U,Ce)};M(dt,U=>{t().recipes.length>=1&&U(St)})}var Dt=n(dt,2);va(Dt,{onSelect:Y,get defaultPlates(){return t().guests},autoFocus:$,get onEmptySubmit(){return l.onEmptySearchSubmit},get disabled(){return m()}}),r(Ae),r(i),j(()=>{G(S,1,`input ${e(E)?"input-error":""}`),G(D,1,`w-full ${e(E)?"select-error":""}`)}),Ke(z,()=>e(N),U=>d(N,U)),ht(D,()=>e(v),U=>d(v,U)),Ke(Ie,()=>t().guests,U=>t(t().guests=U,!0)),u(a,i)},L=a=>{var i=Da(),c=s(i);{var f=z=>{var J=Ra();lt(J,21,()=>t().recipes,ce=>ce.recipeUuid,(ce,h)=>{const D=k(()=>ne(e(h).recipeUuid)),ae=k(()=>Q(e(h).recipeUuid));var re=ka(),me=s(re);Ge(me,{class:"h-4 w-4"});var ge=n(me,2),Me=s(ge,!0);r(ge);var Ue=n(ge,2),he=s(Ue),Je=n(he);it(Je,{size:12}),r(Ue),r(re),j((Ie,Ae)=>{G(re,1,`badge badge-lg ${Ie??""} h-auto gap-2 py-1 font-medium ${e(ae)?"ring-error ring-1":""}`),X(Me,Ae),X(he,`${e(h).plates??""} `)},[()=>we(e(h).typeR,e(ae)),()=>e(D)?.title||B(e(h).recipeUuid)]),u(ce,re)}),r(J),u(z,J)},S=z=>{var J=Sa();u(z,J)};M(c,z=>{t().recipes.length>0?z(f):z(S,!1)})}r(i),u(a,i)};M(de,a=>{b()?a(be):a(L,!1)})}r(ke);var De=n(ke,2);{let a=k(()=>`Ce repas contient ${t().recipes.length} recette(s). Êtes-vous sûr de vouloir le supprimer ?`);ea(De,{get isOpen(){return e(V)},title:"Supprimer le repas",get message(){return e(a)},variant:"danger",confirmLabel:"Supprimer",cancelLabel:"Annuler",onConfirm:fe,onCancel:()=>d(V,!1)})}r(W),j((a,i)=>{G(W,1,`card bg-base-100 border-base-200 border shadow-sm transition-all hover:shadow-md ${b()?"ring-accent/40 ring-2":""} ${b()||m()?"":"hover:ring-accent/60 cursor-pointer hover:ring-2"} ${m()?"opacity-75":""}`),ue(W,"tabindex",b()||m()?-1:0),G(R,1,`text-primary text-lg font-medium ${(e(E)&&"text-error")??""}`),X(Oe,a),G(te,1,`font-base flex items-center gap-1 ${(e(E)&&"text-error")??""}`),X(We,i),X(Ze,` ${t().guests??""} pers.`)},[()=>t().date?ta(t().date):"Date non définie",()=>e(H)?e(H).toUpperCase():"REPAS"]),u(y,W),kt()}yt(["click","keydown","change"]);export{Aa as E,ua as f};
