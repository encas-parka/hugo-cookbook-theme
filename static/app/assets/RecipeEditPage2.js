import{B as Xe,d as Ye,p as Le,z as rt,J as Je,m as e,u as Re,y as Q,A as v,v as c,K as x,h as a,g as r,R as xt,w as h,C as re,M as je,S as at,T as Fe,b as d,c as Ze,ac as _t,x as T,e as Ge,i as yt,o as t,W as xe,j as dt,k as ye,O as Oe,G as me,az as tt,am as It,ah as ht,al as Ta,af as Da,ad as Ma,ak as ja,ab as Fa,P as pa,t as Na,aA as fa,X as Ba,Y as Oa,ag as Ua,I as bt,F as $t,U as Ha,a8 as Qa,aB as Va,N as Ga,aC as Wa,aD as Ka}from"./appwrite.js";import{g as _a,G as Ja,c as ct,X as ba,a8 as Xa,T as Rt,ak as Ya,B as da,a7 as ma,J as ga,k as Za,al as $a,r as er,W as tr,am as ar,an as rr,ao as sr,S as ir,ai as ha,ap as nr,aq as lr,ar as or,as as dr,aj as cr,at as ur,au as vr,a0 as pr,b as fr,U as _r,a2 as br,M as mr,av as gr}from"./icons.js";import{r as Me}from"./RecipeDataStore.svelte.js";import{M as zt,b as Pt,c as Tt,d as Dt,s as hr,a as xr}from"./index.js";import{g as ca}from"./products-display.js";import{E as yr,i as wr,M as kr}from"./tiptap-markdown.es.js";import{F as Er}from"./Fieldset.js";import{B as Cr}from"./BtnGroupCheck.js";var qr=c('<legend class="fieldset-legend"> </legend>'),Ar=c('<button type="button" role="option"><span> </span> <!></button>'),Lr=c('<div class="text-base-content/50 px-4 py-2 text-sm">Aucune option disponible</div>'),Sr=c('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium"> </span></button></div>'),Ir=c('<div id="options-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!> <!></div>'),Rr=c('<div class="badge badge-lg badge-primary gap-2"><span> </span> <button type="button" class="btn btn-ghost btn-sm hover:bg-primary-focus h-4 min-h-0 w-4 p-0"><!></button></div>'),zr=c('<div class="mt-2 flex flex-wrap gap-2"></div>'),Pr=c('<div class="fieldset-label"><span class="fieldset-label-text-alt opacity-70"> </span></div>'),Tr=c('<fieldset class="fieldset w-full"><!> <div class="relative"><div id="multi-select"><input type="text" class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="options-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div> <!> <!></fieldset>');function ua(l,s){Ye(s,!0);let o=Le(s,"options",19,()=>[]),i=Le(s,"selected",31,()=>rt([])),n=Le(s,"placeholder",3,"Sélectionnez des options..."),f=Le(s,"disabled",3,!1),_=Le(s,"closeOnSelect",3,!1),q=Le(s,"createLabel",3,"Créer..."),I=Q(""),B=Q(!1),O=Q(0),ne=Q(void 0),A=Q(void 0),Z=Re(()=>e(I).length>0?o().filter(b=>b.toLowerCase().includes(e(I).toLowerCase())):o());Je(()=>{e(Z).length>0&&e(O)>=e(Z).length&&v(O,0)});function ue(b){return i().includes(b)}function le(b){ue(b)?g(b):R(b)}function R(b){i().includes(b)||(i([...i(),b]),s.onChange?.(i())),v(I,""),v(O,0),_()?D():e(A)?.focus()}function g(b){i(i().filter(U=>U!==b)),s.onChange?.(i())}function y(){if(i().length>0&&e(I)===""){const b=i()[i().length-1];g(b)}}function z(){f()||(v(B,!0),v(O,0))}function D(){v(B,!1),v(I,""),v(O,0)}function J(){e(B)?D():z()}function N(b){if(!f())switch(b.key){case"ArrowDown":b.preventDefault(),e(B)?e(O)<e(Z).length-1&&_t(O):z();break;case"ArrowUp":b.preventDefault(),e(B)&&e(O)>0&&_t(O,-1);break;case"Enter":b.preventDefault(),e(B)&&e(Z).length>0?le(e(Z)[e(O)]):e(B)||z();break;case"Escape":b.preventDefault(),D(),e(A)?.blur();break;case"Backspace":e(I)===""&&i().length>0&&(b.preventDefault(),y());break;case"Tab":e(B)&&D();break}}function X(b){e(ne)&&!e(ne).contains(b.target)&&D()}Je(()=>{if(e(B))return document.addEventListener("mousedown",X),()=>{document.removeEventListener("mousedown",X)}});var Y=Tr(),M=a(Y);{var j=b=>{var U=qr(),L=a(U,!0);t(U),h(()=>T(L,s.label)),d(b,U)};x(M,b=>{s.label&&b(j)})}var $=r(M,2),ie=a($),w=a(ie);xe(w),w.__keydown=N,xt(w,b=>v(A,b),()=>e(A)),t(ie);var m=r(ie,2);m.__click=J;var k=a(m);{let b=Re(()=>e(B)?"rotate-180":"");_a(k,{get class(){return`h-4 w-4 transition-transform ${e(b)??""}`}})}t(m);var u=r(m,2);{var E=b=>{var U=Ir(),L=a(U);{var H=V=>{var F=dt(),se=ye(F);Ge(se,17,()=>e(Z),yt,(Se,Ae,we,W)=>{const Ue=Re(()=>ue(e(Ae)));var he=Ar();je(he,"id",`option-${we}`),he.__click=()=>le(e(Ae));var Pe=a(he),Ne=a(Pe,!0);t(Pe);var Te=r(Pe,2);{var ke=Ce=>{Ja(Ce,{class:"text-success h-4 w-4"})};x(Te,Ce=>{e(Ue)&&Ce(ke)})}t(he),h(()=>{re(he,1,`hover:bg-base-200 flex w-full items-center justify-between gap-2 px-4 py-2 text-left hover:cursor-pointer ${we===e(O)?"bg-base-200":""} ${e(Ue)?"bg-success/20":""}`),je(he,"aria-selected",e(Ue)),T(Ne,e(Ae))}),at("mouseenter",he,()=>v(O,we,!0)),d(Se,he)}),d(V,F)},ee=V=>{var F=Lr();d(V,F)};x(L,V=>{e(Z).length>0?V(H):V(ee,!1)})}var ce=r(L,2);{var fe=V=>{var F=Sr(),se=a(F);se.__click=()=>{s.onCreateNew(),D()};var Se=a(se);ct(Se,{class:"h-4 w-4"});var Ae=r(Se,2),we=a(Ae,!0);t(Ae),t(se),t(F),h(()=>T(we,q())),d(V,F)};x(ce,V=>{s.onCreateNew&&V(fe)})}t(U),d(b,U)};x(u,b=>{e(B)&&b(E)})}t($);var G=r($,2);{var oe=b=>{var U=zr();Ge(U,21,i,yt,(L,H)=>{var ee=Rr(),ce=a(ee),fe=a(ce,!0);t(ce);var V=r(ce,2);V.__click=()=>g(e(H));var F=a(V);ba(F,{class:"h-3 w-3"}),t(V),t(ee),h(()=>{T(fe,e(H)),V.disabled=f(),je(V,"aria-label",`Supprimer ${e(H)??""}`)}),d(L,ee)}),t(U),d(b,U)};x(G,b=>{i().length>0&&b(oe)})}var de=r(G,2);{var ae=b=>{var U=Pr(),L=a(U),H=a(L,!0);t(L),t(U),h(()=>T(H,s.helpText)),d(b,U)};x(de,b=>{s.helpText&&b(ae)})}t(Y),xt(Y,b=>v(ne,b),()=>e(ne)),h(()=>{re(ie,1,`input flex w-full items-center gap-2 pr-10 ${f()?"input-disabled":""}`),je(w,"placeholder",n()),w.disabled=f(),je(w,"aria-expanded",e(B)),je(w,"aria-activedescendant",e(B)?`option-${e(O)}`:void 0),m.disabled=f(),je(m,"aria-label",e(B)?"Fermer le menu":"Ouvrir le menu")}),at("focus",w,z),Fe(w,()=>e(I),b=>v(I,b)),d(l,Y),Ze()}Xe(["keydown","click"]);var Dr=c('<div class="alert alert-error max-md:alert-vertical text-sm"><!> <span> </span></div>'),Mr=c('<p class="text-error text-xs"> </p>'),jr=c('<form class="flex flex-col space-y-6"><!> <fieldset class="space-y-4"><div class="fieldset"><legend class="fieldset-legend">Nom du matériel</legend> <label><!> <input id="materiel-name-input" type="text" placeholder="Ex: Robot Mixeur" required aria-required="true" minlength="2" maxlength="50"/></label> <!> <p class="text-base-content/60 text-xs italic">2 à 50 caractères. Ex: "Four", "Robot Mixeur", "Gastro 1/1 (10cm)"</p></div></fieldset></form>'),Fr=c('<span class="loading loading-spinner"></span>'),Nr=c('<button type="button" class="btn btn-ghost">Annuler</button> <button type="submit" class="btn btn-primary"><!> Créer</button>',1),Br=c("<!> <!> <!>",1);function Or(l,s){Ye(s,!0);let o=Le(s,"open",15,!1),i=Q(rt({name:""})),n=Q(!1),f=Q(!1),_=Q(null),q=Q(rt({}));function I(){const A={},Z=e(i).name.trim();return Z?Z.length<2?A.name="Le nom doit contenir au moins 2 caractères":Z.length>50&&(A.name="Le nom ne peut pas dépasser 50 caractères"):A.name="Le nom est requis",A}async function B(){if(!e(n)&&(v(f,!0),v(q,I(),!0),!(Object.keys(e(q)).length>0))){v(n,!0),v(_,null);try{const A=e(i).name.trim();await Me.addMateriel(A),Oe.success(`Matériel "${A}" créé avec succès`),s.onMaterielCreated&&s.onMaterielCreated(A),O(),o(!1)}catch(A){v(_,A instanceof Error?A.message:"Erreur lors de la création",!0),Oe.error(e(_))}finally{v(n,!1)}}}function O(){v(i,{name:""},!0),v(f,!1),v(_,null),v(q,{},!0)}function ne(){o(!1),O()}Je(()=>{o()&&setTimeout(()=>{document.getElementById("materiel-name-input")?.focus()},50)}),zt(l,{get isOpen(){return o()},onClose:ne,children:(A,Z)=>{var ue=Br(),le=ye(ue);Pt(le,{title:"Ajouter du matériel",onClose:ne});var R=r(le,2);Tt(R,{children:(y,z)=>{var D=jr(),J=a(D);{var N=m=>{var k=Dr(),u=a(k);Rt(u,{size:18});var E=r(u,2),G=a(E,!0);t(E),t(k),h(()=>T(G,e(_))),d(m,k)};x(J,m=>{e(_)&&m(N)})}var X=r(J,2),Y=a(X),M=r(a(Y),2),j=a(M);Xa(j,{class:"text-base-content/50 h-5 w-5"});var $=r(j,2);xe($),t(M);var ie=r(M,2);{var w=m=>{var k=Mr(),u=a(k,!0);t(k),h(()=>T(u,e(q).name)),d(m,k)};x(ie,m=>{e(f)&&e(q).name&&m(w)})}me(2),t(Y),t(X),t(D),h(()=>{X.disabled=e(n),re(M,1,`input input-lg w-full ${e(f)&&e(q).name?"input-error":""}`)}),at("submit",D,m=>{m.preventDefault(),B()}),Fe($,()=>e(i).name,m=>e(i).name=m),d(y,D)}});var g=r(R,2);Dt(g,{children:(y,z)=>{var D=Nr(),J=ye(D);J.__click=ne;var N=r(J,2);N.__click=B;var X=a(N);{var Y=j=>{var $=Fr();d(j,$)},M=j=>{ct(j,{size:18})};x(X,j=>{e(n)?j(Y):j(M,!1)})}me(),t(N),h(()=>{J.disabled=e(n),N.disabled=e(n)}),d(y,D)}}),d(A,ue)},$$slots:{default:!0}}),Ze()}Xe(["click"]);var Ur=c('<div class="alert alert-error max-md:alert-vertical text-sm"><!> <span> </span></div>'),Hr=c('<p class="text-error text-xs"> </p>'),Qr=c(`<form class="flex flex-col space-y-6"><!> <fieldset class="space-y-4"><div class="fieldset"><legend class="fieldset-legend required">Nom de la catégorie</legend> <label><!> <input id="category-name-input" type="text" placeholder="Ex: Bouchées salées" required aria-required="true" minlength="2" maxlength="50"/></label> <!> <p class="text-base-content/60 text-xs italic">2 à 50 caractères. Ex: "Bouchées salées", "Plat en Sauce", "Tarte
            (salée)"</p></div></fieldset></form>`),Vr=c('<span class="loading loading-spinner"></span>'),Gr=c('<button type="button" class="btn btn-ghost">Annuler</button> <button type="submit" class="btn btn-primary"><!> Créer</button>',1),Wr=c("<!> <!> <!>",1);function Kr(l,s){Ye(s,!0);let o=Le(s,"open",15,!1),i=Q(rt({name:""})),n=Q(!1),f=Q(!1),_=Q(null),q=Q(rt({}));function I(){const A={},Z=e(i).name.trim();return Z?Z.length<2?A.name="Le nom doit contenir au moins 2 caractères":Z.length>50&&(A.name="Le nom ne peut pas dépasser 50 caractères"):A.name="Le nom est requis",A}async function B(){if(!e(n)&&(v(f,!0),v(q,I(),!0),!(Object.keys(e(q)).length>0))){v(n,!0),v(_,null);try{const A=e(i).name.trim();await Me.addCategory(A),Oe.success(`Catégorie "${A}" créée avec succès`),s.onCategoryCreated&&s.onCategoryCreated(A),O(),o(!1)}catch(A){v(_,A instanceof Error?A.message:"Erreur lors de la création",!0),Oe.error(e(_))}finally{v(n,!1)}}}function O(){v(i,{name:""},!0),v(f,!1),v(_,null),v(q,{},!0)}function ne(){o(!1),O()}Je(()=>{o()&&setTimeout(()=>{document.getElementById("category-name-input")?.focus()},50)}),zt(l,{get isOpen(){return o()},onClose:ne,children:(A,Z)=>{var ue=Wr(),le=ye(ue);Pt(le,{title:"Ajouter une catégorie",onClose:ne});var R=r(le,2);Tt(R,{children:(y,z)=>{var D=Qr(),J=a(D);{var N=m=>{var k=Ur(),u=a(k);Rt(u,{size:18});var E=r(u,2),G=a(E,!0);t(E),t(k),h(()=>T(G,e(_))),d(m,k)};x(J,m=>{e(_)&&m(N)})}var X=r(J,2),Y=a(X),M=r(a(Y),2),j=a(M);Ya(j,{class:"text-base-content/50 h-5 w-5"});var $=r(j,2);xe($),t(M);var ie=r(M,2);{var w=m=>{var k=Hr(),u=a(k,!0);t(k),h(()=>T(u,e(q).name)),d(m,k)};x(ie,m=>{e(f)&&e(q).name&&m(w)})}me(2),t(Y),t(X),t(D),h(()=>{X.disabled=e(n),re(M,1,`input input-lg w-full ${e(f)&&e(q).name?"input-error":""}`)}),at("submit",D,m=>{m.preventDefault(),B()}),Fe($,()=>e(i).name,m=>e(i).name=m),d(y,D)}});var g=r(R,2);Dt(g,{children:(y,z)=>{var D=Gr(),J=ye(D);J.__click=ne;var N=r(J,2);N.__click=B;var X=a(N);{var Y=j=>{var $=Vr();d(j,$)},M=j=>{ct(j,{size:18})};x(X,j=>{e(n)?j(Y):j(M,!1)})}me(),t(N),h(()=>{J.disabled=e(n),N.disabled=e(n)}),d(y,D)}}),d(A,ue)},$$slots:{default:!0}}),Ze()}Xe(["click"]);var Jr=c('<span class="text-error"> </span>'),Xr=c('<span class="text-error text-wrap"> </span>'),Yr=c('<fieldset class="fieldset min-w-1/5"><legend class="fieldset-legend">Version</legend> <label class="input input-lg w-full"><span class="badge badge-ghost font-mono"> </span> <span class="px-1 opacity-40">-</span> <input type="text" placeholder="username" maxlength="20" class="grow font-mono text-sm"/></label> <p class="fieldset-label truncate" title="ex: &quot;économique&quot;, &quot;sans fromages&quot;, &quot;plus rapide&quot;...">ex: "économique", "sans fromages", "plus rapide"...</p> <!></fieldset>'),Zr=c('<span class="badge badge-secondary badge-lg h-full"> </span>'),$r=c('<span class="text-error"> </span>'),es=c('<span class="text-error"> </span>'),ts=c('<span class="text-error"> </span>'),as=c('<div class="fieldset-label"><span class="text-error"> </span></div>'),rs=c('<div class="fieldset-label"><span class="text-error"> </span></div>'),ss=c('<div class="fieldset-label"><span class="text-error"> </span></div>'),is=c('<label class="flex cursor-pointer items-center gap-1"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="text-sm"> </span></label>'),ns=c('<div class="fieldset-label"><span class="text-error"> </span></div>'),ls=c('<div class="lg:col-span-1"><!></div>'),os=c('<div class="fieldset-label"><span class="text-error"> </span></div>'),ds=c('<p class="text-warning/70">Une recette non testée est forcément conservée en brouillon.</p>'),cs=c(`<div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Informations générales</h2> <div class="flex flex-col gap-4"><div class="flex flex-col gap-x-10 gap-y-2"><div class="flex flex-wrap items-start gap-x-10"><fieldset class="fieldset min-w-3/5 flex-1"><legend class="fieldset-legend required">Titre de la recette</legend> <label><!> <input id="recipe-title" type="text" placeholder="Ex: Houmous maison" maxlength="80" aria-describedby="title-help" aria-required="true"/></label> <div class="fieldset-label" id="title-help"><!> <span class="fieldset-label ms-auto italic"> </span></div></fieldset> <!></div> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description</legend> <input type="text" name="description" id="description" maxlength="200" placeholder="Brève description de la recette"/> <span class="fieldset-label"><span class="ms-auto italic"> </span> <!></span></fieldset></div> <div class="flex flex-wrap justify-between gap-10"><div class="flex flex-wrap gap-x-10 gap-y-2"><fieldset class="fieldset"><legend class="fieldset-legend required">Nombre de couverts</legend> <label><!> <input id="recipe-plate" type="number" min="1" max="80000" aria-describedby="plate-help" aria-required="true"/></label> <div class="fieldset-label" id="plate-help"><span class="italic">Quantités indiquées pour combien ?</span> <!></div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description des quantités</legend> <label><!> <input id="recipe-quantite-desc" type="text" placeholder="Ex: '24 parts par gastro'; '2 beignets/personne' ..." maxlength="100"/></label> <div class="fieldset-label"><!> <span class="ms-auto italic"> </span></div></fieldset></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset sm:w-auto"><legend class="fieldset-legend required">Type de recette</legend> <label><!> <select id="recipe-type" aria-describedby="type-help"><option disabled selected>Sélectionner un type</option><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select></label> <!></fieldset> <div class="flex-1 sm:max-w-md"><!></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend required"><!> <span>Température de service</span></legend> <label><select id="recipe-servehot"><option disabled selected>--</option><option>Chaud</option><option>Froid</option></select></label> <!></fieldset> <fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend required"><!> <span>Nécessite une cuisson</span></legend> <label><select id="recipe-cuisson"><option disabled selected>--</option><option>Oui</option><option>Non</option></select></label> <!></fieldset></div> <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"><fieldset class="fieldset"><legend class="fieldset-legend">Saisons</legend> <div class="flex flex-wrap gap-2"></div> <div class="fieldset-label italic">Si certains ingrédients ne se trouvent qu'à certaines saisons...</div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Spécialité</legend> <label><!> <input id="recipe-region" type="text" placeholder="Ex: Basque, Italien" maxlength="50"/></label> <!></fieldset> <!></div> <div id="recipe-check-fieldset"><div class="flex w-full flex-wrap gap-x-6 gap-y-2"><div class="required">Avez-vous testé la recette pour le nombre de couverts indiqué ?</div> <div class="flex gap-4"><label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Oui</span></label> <label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Non</span></label></div></div> <!> <label class="flex w-full cursor-pointer gap-3"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm mt-1"/> <div class="flex flex-col"><p class="text-sm font-medium">Brouillon</p> <p class="opacity-70">Les brouillons sont visibles uniquement pour les utilisateur·ices
              inscrite, mais peuvent tout de même être ajoutés à vos événements.
              Le status "brouillon" vous permettra de retrouver facilement les
              recettes que vous n'avez pas finalisé.</p> <!></div></label></div></div></div></div> <!> <!>`,1);function yi(l,s){Ye(s,!0);const o=[];let i=Le(s,"recipe",15),n=Q(!1),f=Q(!1);function _(){v(n,!0)}function q(p){i().materiel||i(i().materiel=[],!0),i(i().materiel=[...i().materiel,p],!0)}function I(){v(f,!0)}function B(p){i().categories||i(i().categories=[],!0),i(i().categories=[...i().categories,p],!0)}var O=cs(),ne=ye(O),A=a(ne),Z=a(A),ue=a(Z);da(ue,{class:"h-5 w-5"}),me(),t(Z);var le=r(Z,2),R=a(le),g=a(R),y=a(g),z=r(a(y),2),D=a(z);da(D,{class:"h-4 w-4 opacity-50"});var J=r(D,2);xe(J),t(z);var N=r(z,2),X=a(N);{var Y=p=>{var C=Jr(),te=a(C,!0);t(C),h(()=>T(te,s.validationErrors.title)),d(p,C)};x(X,p=>{s.validationErrors.title&&p(Y)})}var M=r(X,2),j=a(M);t(M),t(N),t(y);var $=r(y,2);{var ie=p=>{var C=dt(),te=ye(C);{var be=He=>{const Ke=Re(()=>i().versionLabel.match(/^v(\d+)/)?parseInt(i().versionLabel.match(/^v(\d+)/)[1]):null);var ft=dt(),Gt=ye(ft);{var Ia=Wt=>{var Kt=Yr(),Jt=r(a(Kt),2),Xt=a(Jt),Ra=a(Xt);t(Xt);var Yt=r(Xt,4);xe(Yt),Yt.__input=ot=>{let Zt=ot.target.value.toLowerCase().trim();i(i().versionLabel=`v${e(Ke)} - ${Zt}`,!0)},t(Jt);var za=r(Jt,4);{var Pa=ot=>{var St=Xr(),Zt=a(St,!0);t(St),h(()=>T(Zt,s.validationErrors.versionLabel)),d(ot,St)};x(za,ot=>{s.validationErrors.versionLabel&&ot(Pa)})}t(Kt),h(ot=>{T(Ra,`v${e(Ke)??""}`),Ma(Yt,ot)},[()=>i().versionLabel.replace(/^v\d+\s*-\s*/,"")]),d(Wt,Kt)};x(Gt,Wt=>{e(Ke)&&Wt(Ia)})}d(He,ft)};x(te,He=>{i().versionLabel&&He(be)})}d(p,C)},w=p=>{var C=dt(),te=ye(C);{var be=He=>{var Ke=Zr(),ft=a(Ke,!0);t(Ke),h(()=>T(ft,i().versionLabel)),d(He,Ke)};x(te,He=>{i().versionLabel&&He(be)},!0)}d(p,C)};x($,p=>{s.canEdit?p(ie):p(w,!1)})}t(g);var m=r(g,2),k=r(a(m),2);xe(k);var u=r(k,2),E=a(u),G=a(E);t(E);var oe=r(E,2);{var de=p=>{var C=$r(),te=a(C,!0);t(C),h(()=>T(te,s.validationErrors.description)),d(p,C)};x(oe,p=>{s.validationErrors.description&&p(de)})}t(u),t(m),t(R);var ae=r(R,2),b=a(ae),U=a(b),L=r(a(U),2),H=a(L);ma(H,{class:"h-4 w-4 opacity-50"});var ee=r(H,2);xe(ee),t(L);var ce=r(L,2),fe=r(a(ce),2);{var V=p=>{var C=es(),te=a(C,!0);t(C),h(()=>T(te,s.validationErrors.plate)),d(p,C)};x(fe,p=>{s.validationErrors.plate&&p(V)})}t(ce),t(U);var F=r(U,2),se=r(a(F),2),Se=a(se);ga(Se,{class:"h-4 w-4 opacity-50"});var Ae=r(Se,2);xe(Ae),t(se);var we=r(se,2),W=a(we);{var Ue=p=>{var C=ts(),te=a(C,!0);t(C),h(()=>T(te,s.validationErrors.quantite_desc)),d(p,C)};x(W,p=>{s.validationErrors.quantite_desc&&p(Ue)})}var he=r(W,2),Pe=a(he);t(he),t(we),t(F),t(b),t(ae);var Ne=r(ae,2),Te=a(Ne),ke=r(a(Te),2),Ce=a(ke);Za(Ce,{class:"h-4 w-4 opacity-50"});var qe=r(Ce,2),ze=a(qe);ze.value=ze.__value="";var De=r(ze),ge={},Ee=r(De),_e={},ve=r(Ee),S={},P=r(ve),K={};t(qe),t(ke);var pe=r(ke,2);{var Ie=p=>{var C=as(),te=a(C),be=a(te,!0);t(te),t(C),h(()=>T(be,s.validationErrors.typeR)),d(p,C)};x(pe,p=>{s.validationErrors.typeR&&p(Ie)})}t(Te);var We=r(Te,2),Qe=a(We);{var Ve=p=>{{let C=Re(()=>!s.canEdit);ua(p,{get options(){return s.recipeInfo.categories},label:"Sous-Catégories",placeholder:"Rechercher une catégorie...",get disabled(){return e(C)},closeOnSelect:!0,onCreateNew:I,createLabel:"Créer une catégorie...",get selected(){return i().categories},set selected(te){i(i().categories=te,!0)}})}};x(Qe,p=>{s.recipeInfo&&s.recipeInfo.categories&&i().categories&&p(Ve)})}t(We),t(Ne);var st=r(Ne,2),it=a(st),nt=a(it),mt=a(nt);$a(mt,{class:"h-4 w-4"}),me(2),t(nt);var $e=r(nt,2),et=a($e),lt=a(et);lt.value=lt.__value="";var ut=r(lt);ut.value=ut.__value=!0;var wt=r(ut);wt.value=wt.__value=!1,t(et),t($e);var Mt=r($e,2);{var kt=p=>{var C=rs(),te=a(C),be=a(te,!0);t(te),t(C),h(()=>T(be,s.validationErrors.serveHot)),d(p,C)};x(Mt,p=>{s.validationErrors.serveHot&&p(kt)})}t(it);var vt=r(it,2),Be=a(vt),gt=a(Be);er(gt,{class:"h-4 w-4"}),me(2),t(Be);var pt=r(Be,2),Et=a(pt),jt=a(Et);jt.value=jt.__value="";var Ft=r(jt);Ft.value=Ft.__value=!0;var ea=r(Ft);ea.value=ea.__value=!1,t(Et),t(pt);var xa=r(pt,2);{var ya=p=>{var C=ss(),te=a(C),be=a(te,!0);t(te),t(C),h(()=>T(be,s.validationErrors.cuisson)),d(p,C)};x(xa,p=>{s.validationErrors.cuisson&&p(ya)})}t(vt),t(st);var Nt=r(st,2),Bt=a(Nt),ta=r(a(Bt),2);Ge(ta,20,()=>[{value:"printemps",label:"Printemps"},{value:"ete",label:"Été"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}],p=>p.value,(p,C)=>{var te=is(),be=a(te);xe(be);var He,Ke=r(be,2),ft=a(Ke,!0);t(Ke),t(te),h(()=>{be.disabled=!s.canEdit,He!==(He=C.value)&&(be.value=(be.__value=C.value)??""),T(ft,C.label)}),Da(o,[],be,()=>(C.value,i().saison),Gt=>i(i().saison=Gt,!0)),d(p,te)}),t(ta),me(2),t(Bt);var Ot=r(Bt,2),Ct=r(a(Ot),2),aa=a(Ct);tr(aa,{class:"h-4 w-4 opacity-50"});var Ut=r(aa,2);xe(Ut),t(Ct);var wa=r(Ct,2);{var ka=p=>{var C=ns(),te=a(C),be=a(te,!0);t(te),t(C),h(()=>T(be,s.validationErrors.region)),d(p,C)};x(wa,p=>{s.validationErrors.region&&p(ka)})}t(Ot);var Ea=r(Ot,2);{var Ca=p=>{var C=ls(),te=a(C);{let be=Re(()=>!s.canEdit);ua(te,{get options(){return s.recipeInfo.materiel},label:"Matériel nécessaire",placeholder:"Rechercher du matériel...",get disabled(){return e(be)},closeOnSelect:!0,onCreateNew:_,createLabel:"Créer ...",get selected(){return i().materiel},set selected(He){i(i().materiel=He,!0)}})}t(C),d(p,C)};x(Ea,p=>{s.recipeInfo&&s.recipeInfo.materiel&&p(Ca)})}t(Nt);var Ht=r(Nt,2),Qt=a(Ht),ra=r(a(Qt),2),Vt=a(ra),qt=a(Vt);xe(qt),qt.__change=()=>i()&&i(i().check=!0,!0),me(2),t(Vt);var sa=r(Vt,2),At=a(sa);xe(At),At.__change=()=>i()&&i(i().check=!1,!0),me(2),t(sa),t(ra),t(Qt);var ia=r(Qt,2);{var qa=p=>{var C=os(),te=a(C),be=a(te,!0);t(te),t(C),h(()=>T(be,s.validationErrors.check)),d(p,C)};x(ia,p=>{s.validationErrors.check&&p(qa)})}var na=r(ia,2),Lt=a(na);xe(Lt);var la=r(Lt,2),Aa=r(a(la),4);{var La=p=>{var C=ds();d(p,C)};x(Aa,p=>{i().check!==!0&&p(La)})}t(la),t(na),t(Ht),t(le),t(A),t(ne);var oa=r(ne,2);Or(oa,{onMaterielCreated:q,get open(){return e(n)},set open(p){v(n,p,!0)}});var Sa=r(oa,2);Kr(Sa,{onCategoryCreated:B,get open(){return e(f)},set open(p){v(f,p,!0)}}),h(()=>{re(z,1,`input input-lg w-full ${s.validationErrors.title?"input-error":""}`),J.disabled=!s.canEdit,T(j,`${(i().title?.length||0)??""}/80 caractères`),k.disabled=!s.canEdit,re(k,1,`input w-full ${s.validationErrors.description?"input-error":""}`),T(G,`${(i().description?.length||0)??""}/200 caractères`),re(L,1,`input ${s.validationErrors.plate?"input-error":""}`),ee.disabled=!s.canEdit,re(se,1,`input w-full min-w-lg ${s.validationErrors.quantite_desc?"input-error":""}`),Ae.disabled=!s.canEdit,T(Pe,`${(i().quantite_desc?.length||0)??""}/100 caractères`),re(ke,1,`select ${s.validationErrors.typeR?"select-error":""}`),qe.disabled=!s.canEdit,ge!==(ge=tt.ENTREE)&&(De.value=(De.__value=tt.ENTREE)??""),_e!==(_e=tt.PLAT)&&(Ee.value=(Ee.__value=tt.PLAT)??""),S!==(S=tt.DESSERT)&&(ve.value=(ve.__value=tt.DESSERT)??""),K!==(K=tt.AUTRE)&&(P.value=(P.__value=tt.AUTRE)??""),re($e,1,`select w-full ${s.validationErrors.serveHot?"select-error":""}`),et.disabled=!s.canEdit,re(pt,1,`select w-full ${s.validationErrors.cuisson?"select-error":""}`),Et.disabled=!s.canEdit,re(Ct,1,`input ${s.validationErrors.region?"input-error":""}`),Ut.disabled=!s.canEdit,re(Ht,1,` my-4 flex w-full flex-wrap space-y-6 rounded-xl border p-4 ${s.validationErrors.check?"border-error":"border-base-300"}`),It(qt,i()?.check===!0),qt.disabled=!s.canEdit,It(At,i()?.check===!1),At.disabled=!s.canEdit,Lt.disabled=!s.canEdit||i().check!==!0}),Fe(J,()=>i().title,p=>i(i().title=p,!0)),Fe(k,()=>i().description,p=>i(i().description=p,!0)),Fe(ee,()=>i().plate,p=>i(i().plate=p,!0)),Fe(Ae,()=>i().quantite_desc,p=>i(i().quantite_desc=p,!0)),ht(qe,()=>i().typeR,p=>i(i().typeR=p,!0)),ht(et,()=>i().serveHot,p=>i(i().serveHot=p,!0)),ht(Et,()=>i().cuisson,p=>i(i().cuisson=p,!0)),Fe(Ut,()=>i().region,p=>i(i().region=p,!0)),Ta(Lt,()=>i().draft,p=>i(i().draft=p,!0)),d(l,O),Ze()}Xe(["input","change"]);var us=c('<div class="alert alert-error max-md:alert-vertical text-sm"><!> <span> </span></div>'),vs=c('<p class="text-error text-xs"> </p>'),ps=c("<option> </option>"),fs=c('<p class="text-error text-xs"> </p>'),_s=c('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="text-sm"> </span></label>'),bs=c('<p class="text-error text-xs"> </p>'),ms=c('<p class="text-error text-xs"> </p>'),gs=c('<p class="text-error text-xs"> </p>'),hs=c('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="label-text"> </span></label>'),xs=c(`<form class="flex flex-col space-y-6"><!> <fieldset class="space-y-4"><div class="fieldset"><legend class="fieldset-legend required">Nom</legend> <label><!> <input id="ingredient-name-input" type="text" placeholder="Nom de l'ingrédient" required aria-required="true" minlength="2" maxlength="60"/></label> <!></div> <div class="fieldset"><legend class="fieldset-legend required">Type</legend> <select required aria-required="true"><option>Sélectionner un type...</option><!></select> <!></div> <div class="fieldset"><legend class="fieldset-legend required">Allergènes</legend> <p class="text-base-content/60 mb-2 text-xs">Précisez les allergènes présents dans l'ingrédient et/ou la nature
            de l'ingrédients (ou cochez "Aucun"). Sert notamment à la
            classification des recettes comme végétarienne, sans-gluten, etc.)</p> <div class="flex flex-wrap gap-2"></div> <!></div> <div class="grid gap-4 md:grid-cols-2"><div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span class="required">frais ?</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Fruits et légumes frais, ou ingrédients qui se conservent au frigo</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div> <div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span class="required">Produit surgelé ?</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Ingrédients qui se conservent au congélateur</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div></div> <div class="fieldset"><legend class="fieldset-legend">Saisons (optionnel)</legend> <p class="text-base-content/60 mb-2 text-xs">Si l'ingrédient se trouve surtout à certaines saisons</p> <div class="flex flex-wrap gap-2"></div></div></fieldset></form>`),ys=c('<span class="loading loading-spinner"></span>'),ws=c(`<button type="button" class="btn btn-ghost">Annuler</button> <button type="submit" class="btn btn-primary"><!> Créer l'ingrédient</button>`,1),ks=c("<!> <!> <!>",1);function Es(l,s){Ye(s,!0);let o=Le(s,"open",15,!1),i=Le(s,"initialName",3,""),n=Q(rt({name:i(),type:"",allergens:[],pF:null,pS:!1,saisons:[]})),f=Q(!1),_=Q(!1),q=Q(null),I=Q(rt({}));const B=[{value:"frais",label:"Produits Frais (beurre, fromage, yahourt..."},{value:"legumes",label:"Fruits et Légumes (frais, concerves, surgelés, etc."},{value:"lof",label:"LOF : Laits, oeuf, farines, huiles..."},{value:"sucres",label:"Sucrés (jus, sirop, confiture ...)"},{value:"epices",label:"Assaisonnements (épices, herbes, sauces...)"},{value:"sec",label:"Sec (riz, pâtes, lentilles...)"},{value:"animaux",label:"Viandes et Poissons"},{value:"autres",label:"Autres"}],O=["Aucun","Produit laitier","Gluten","Crustacé","Oeuf","Poisson","Viande","Porc","Arachides","Soja","Fruits à coque","Céleri","Moutarde","Sésame","Sulfites","Lupin","Mollusque","Alcool","Vérifier emballage"],ne=[{value:"printemps",label:"Printemps"},{value:"ete",label:"Eté"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}];function A(){const g={};return e(n).name.trim()||(g.name="Le nom est requis"),e(n).type.trim()||(g.type="Le type est requis"),e(n).allergens.length===0&&(g.allergens="Cochez 'Aucun' si l'ingrédient ne contient aucun allergène"),e(n).pF===null&&(g.pF="Indiquez si c'est un produit frais"),e(n).pS===null&&(g.pS="Indiquez si c'est un produit surgelé"),g}function Z(g){g==="Aucun"?e(n).allergens=["Aucun"]:(e(n).allergens=e(n).allergens.filter(y=>y!=="Aucun"),e(n).allergens.includes(g)?e(n).allergens=e(n).allergens.filter(y=>y!==g):e(n).allergens.push(g))}async function ue(){if(!e(f)&&(v(_,!0),v(I,A(),!0),!(Object.keys(e(I)).length>0))){v(f,!0),v(q,null);try{const g={name:e(n).name.trim(),type:e(n).type,allergens:e(n).allergens.includes("Aucun")?[]:e(n).allergens,pF:e(n).pF===!0,pS:e(n).pS===!0,saisons:e(n).saisons.length>0?e(n).saisons:void 0},y=await Me.addIngredient(g);Oe.success(`Ingrédient "${y.n}" créé avec succès`),s.onIngredientCreated&&s.onIngredientCreated(y),le(),o(!1)}catch(g){v(q,g instanceof Error?g.message:"Erreur lors de la création",!0),Oe.error(e(q))}finally{v(f,!1)}}}function le(){v(n,{name:"",type:"",allergens:[],pF:null,pS:null,saisons:[]},!0),v(_,!1),v(q,null),v(I,{},!0)}function R(){o(!1),le()}Je(()=>{o()&&(le(),i()&&(e(n).name=i()),setTimeout(()=>{document.getElementById("ingredient-name-input")?.focus()},50))}),zt(l,{get isOpen(){return o()},onClose:R,children:(g,y)=>{var z=ks(),D=ye(z);Pt(D,{title:"Créer un nouvel ingrédient",onClose:R});var J=r(D,2);Tt(J,{children:(X,Y)=>{var M=xs(),j=a(M);{var $=S=>{var P=us(),K=a(P);Rt(K,{size:18});var pe=r(K,2),Ie=a(pe,!0);t(pe),t(P),h(()=>T(Ie,e(q))),d(S,P)};x(j,S=>{e(q)&&S($)})}var ie=r(j,2),w=a(ie),m=r(a(w),2),k=a(m);ar(k,{class:"text-base-content/50 h-5 w-5"});var u=r(k,2);xe(u),t(m);var E=r(m,2);{var G=S=>{var P=vs(),K=a(P,!0);t(P),h(()=>T(K,e(I).name)),d(S,P)};x(E,S=>{e(_)&&e(I).name&&S(G)})}t(w);var oe=r(w,2),de=r(a(oe),2),ae=a(de);ae.value=ae.__value="";var b=r(ae);Ge(b,17,()=>B,S=>S.value,(S,P)=>{var K=ps(),pe=a(K,!0);t(K);var Ie={};h(()=>{T(pe,e(P).label),Ie!==(Ie=e(P).value)&&(K.value=(K.__value=e(P).value)??"")}),d(S,K)}),t(de);var U=r(de,2);{var L=S=>{var P=fs(),K=a(P,!0);t(P),h(()=>T(K,e(I).type)),d(S,P)};x(U,S=>{e(_)&&e(I).type&&S(L)})}t(oe);var H=r(oe,2),ee=r(a(H),4);Ge(ee,20,()=>O,S=>S,(S,P)=>{var K=_s(),pe=a(K);xe(pe),pe.__change=()=>Z(P);var Ie=r(pe,2),We=a(Ie,!0);t(Ie),t(K),h((Qe,Ve)=>{re(K,1,`label border-base-300 cursor-pointer gap-2 rounded-lg border px-3 py-1 ${Qe??""} ${e(_)&&e(I).allergens&&!e(n).allergens.length?"border-error":""}`),It(pe,Ve),T(We,P)},[()=>e(n).allergens.includes(P)?"bg-primary/20 border-primary":"bg-base-200",()=>e(n).allergens.includes(P)]),d(S,K)}),t(ee);var ce=r(ee,2);{var fe=S=>{var P=bs(),K=a(P,!0);t(P),h(()=>T(K,e(I).allergens)),d(S,P)};x(ce,S=>{e(_)&&e(I).allergens&&S(fe)})}t(H);var V=r(H,2),F=a(V),se=a(F),Se=a(se),Ae=a(Se);rr(Ae,{size:16,class:"opacity-50"}),me(2),t(Se),t(se);var we=r(se,4),W=a(we);W.__click=()=>e(n).pF=!0;var Ue=r(W,2);Ue.__click=()=>e(n).pF=!1,t(we);var he=r(we,2);{var Pe=S=>{var P=ms(),K=a(P,!0);t(P),h(()=>T(K,e(I).pF)),d(S,P)};x(he,S=>{e(_)&&e(I).pF&&S(Pe)})}t(F);var Ne=r(F,2),Te=a(Ne),ke=a(Te),Ce=a(ke);sr(Ce,{size:16,class:"opacity-50"}),me(2),t(ke),t(Te);var qe=r(Te,4),ze=a(qe);ze.__click=()=>e(n).pS=!0;var De=r(ze,2);De.__click=()=>e(n).pS=!1,t(qe);var ge=r(qe,2);{var Ee=S=>{var P=gs(),K=a(P,!0);t(P),h(()=>T(K,e(I).pS)),d(S,P)};x(ge,S=>{e(_)&&e(I).pS&&S(Ee)})}t(Ne),t(V);var _e=r(V,2),ve=r(a(_e),4);Ge(ve,21,()=>ne,S=>S.value,(S,P)=>{var K=hs(),pe=a(K);xe(pe),pe.__change=Qe=>{Qe.currentTarget.checked?e(n).saisons=[...e(n).saisons,e(P).value]:e(n).saisons=e(n).saisons.filter(Ve=>Ve!==e(P).value)};var Ie=r(pe,2),We=a(Ie,!0);t(Ie),t(K),h((Qe,Ve)=>{re(K,1,`label border-base-300 cursor-pointer gap-2 rounded-lg px-3 py-1 ${Qe??""}`),It(pe,Ve),T(We,e(P).label)},[()=>e(n).saisons.includes(e(P).value)?"bg-success/20 border-success":"bg-base-200",()=>e(n).saisons.includes(e(P).value)]),d(S,K)}),t(ve),t(_e),t(ie),t(M),h(()=>{ie.disabled=e(f),re(m,1,`input w-full ${e(_)&&e(I).name?"input-error":""}`),re(de,1,`select select-bordered w-full ${e(_)&&e(I).type?"select-error":""}`),re(we,1,`join w-full ${e(_)&&e(I).pF?"join-error":""}`),re(W,1,`btn join-item flex-1 ${e(n).pF===!0?"btn-success":""}`),re(Ue,1,`btn join-item flex-1 ${e(n).pF===!1?"btn-error":""}`),re(qe,1,`join w-full ${e(_)&&e(I).pS?"join-error":""}`),re(ze,1,`btn join-item flex-1 ${e(n).pS===!0?"btn-info":""}`),re(De,1,`btn join-item flex-1 ${e(n).pS===!1?"btn-error":""}`)}),at("submit",M,S=>{S.preventDefault(),ue()}),Fe(u,()=>e(n).name,S=>e(n).name=S),ht(de,()=>e(n).type,S=>e(n).type=S),d(X,M)}});var N=r(J,2);Dt(N,{children:(X,Y)=>{var M=ws(),j=ye(M);j.__click=R;var $=r(j,2);$.__click=ue;var ie=a($);{var w=k=>{var u=ys();d(k,u)},m=k=>{ct(k,{size:18})};x(ie,k=>{e(f)?k(w):k(m,!1)})}me(),t($),h(()=>{j.disabled=e(f),$.disabled=e(f)}),d(X,M)}}),d(g,z)},$$slots:{default:!0}}),Ze()}Xe(["change","click"]);var Cs=c('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body p-4"><div class="flex items-center gap-3"><div class="loading loading-spinner loading-sm"></div> <span class="text-sm">Chargement des ingrédients...</span></div></div></div>'),qs=c('<div class="card bg-error/10 border-error/20 border shadow-sm"><div class="card-body p-4"><div class="text-error flex items-center gap-3"><!> <span class="text-sm"> </span></div></div></div>'),As=c('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span> <span class="text-base-content/50 text-xs"> </span></button></div>'),Ls=c('<div class="text-base-content/50 px-4 py-2 text-sm">Aucun ingrédient trouvé</div> <!>',1),Ss=c('<button type="button" role="option"><div class="flex-1"><span class="truncate text-sm font-medium"> </span></div></button>'),Is=c('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span></button></div>'),Rs=c("<!> <!>",1),zs=c('<div id="ingredients-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!></div>'),Ps=c('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center gap-2 font-bold"><!> Ajouter un ingrédient</div> <div class="mt-2"><div class="relative"><div><!> <input type="text" placeholder="Rechercher un ingrédient..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="ingredients-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div></div></div>'),Ts=c('<div class="text-base-content/60 text-xs italic"> </div>'),Ds=c('<div class="card bg-base-100 border-base-200 border shadow-sm"><div class="card-body p-3"><div class="flex items-start justify-between gap-3"><div class="flex-1 space-y-2"><div class="flex flex-wrap gap-2"><div class="item-start flex min-w-1/2 flex-1 justify-between"><div class="text-base font-medium"> </div> <button class="btn btn-ghost btn-sm btn-square text-error" title="Supprimer cet ingrédient"><!></button></div> <div class="flex flex-wrap gap-2"><label class="input input-sm w-44"><span class="label text-base-content/80">Quantité</span> <div class="flex items-center gap-1"><input type="number" class="text-center" min="0" step="0.1" placeholder="0"/></div></label> <label class="select select-sm w-44"><span class="label text-base-content/80">unité</span> <select class="text-center"><option>Kg</option><option>gr.</option><option>unité</option><option>l.</option><option>ml</option><option>c. à soupe</option><option>c. à café</option><option>pincées</option><option>tête·s</option><option>gousse·s</option><option>bottes</option><option>au goût</option></select></label></div> <!></div> <label class="input input-sm w-full"><span class="label">Note</span> <input type="text" placeholder="Ex: coupées en dés; pour la sauce..." maxlength="100"/></label></div></div></div></div>'),Ms=c('<div class="card bg-base-300 border-base-300 border shadow-sm"><div class="card-body p-2"><div class="card-title text-secondary/80 flex items-center gap-2 px-4 text-sm font-semibold"><!> <span class="badge badge-xs badge-primary badge-soft"> </span></div> <div class="space-y-3"></div></div></div>'),js=c('<div class="space-y-4" id="recipe-ingredients-editor"><!> <!></div> <!>',1);function Fs(l,s){Ye(s,!0);let o=Le(s,"ingredients",15),i=Le(s,"disabled",3,!1),n=Q(""),f=Q(-1),_=Q(!1),q=Q(!1),I=Q(void 0),B=Q(void 0),O=Q(!1),ne=Q(""),A=Re(()=>()=>e(q)||e(n).length===0?Me.ingredients:Me.searchIngredients(e(n))),Z=Re(()=>()=>{const u={};return o().forEach(E=>{const G=E.type||"autres";u[G]||(u[G]=[]),u[G].push(E)}),Object.keys(u).forEach(E=>{u[E].sort((G,oe)=>G.name.localeCompare(oe.name,"fr",{sensitivity:"base"}))}),u});Je(()=>{!Me.isInitialized&&!Me.loading&&Me.initialize().catch(u=>{console.error("[RecipeIngredientsEditor] Erreur lors de l'initialisation du recipeDataStore:",u)})}),Je(()=>{const u=e(A)();u.length>0&&e(f)===-1?v(f,0):u.length===0&&v(f,-1)}),Je(()=>{const u=e(A)();u.length>0&&e(f)>=u.length&&v(f,0)}),Je(()=>{if(e(_)){const u=E=>{e(I)&&!e(I).contains(E.target)&&(v(_,!1),v(n,""))};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}}});function ue(u){const E=Me.getIngredientByUuid(u);if(!E)return;const G={uuid:ja(),name:E.n,originalQuantity:0,originalUnit:"gr.",normalizedQuantity:0,normalizedUnit:"gr.",comment:"",allergens:E.a||[],type:E.t||""};o([...o(),G]),v(n,""),v(q,!1),v(_,!1),v(f,-1),e(B)?.focus();const oe=ca(G.type).displayName;Oe.success(`Ingredient ajouté dans ${oe}`)}function le(u=!1){!i()&&!Me.loading&&!Me.error&&(v(q,u,!0),v(_,!0),v(f,0))}function R(){v(_,!1),v(n,""),v(q,!1),v(f,-1)}function g(){e(_)?R():le(!0)}function y(u){o(o().filter(E=>E.uuid!==u))}function z(u){if(!i())switch(u.key){case"ArrowDown":u.preventDefault();const E=e(A)();e(_)?e(f)<E.length-1&&_t(f):le(!0);break;case"ArrowUp":u.preventDefault(),e(_)&&e(f)>0&&_t(f,-1);break;case"Enter":u.preventDefault();const G=e(A)();e(_)&&G.length>0?ue(G[e(f)].u):e(_)||le(!0);break;case"Escape":u.preventDefault(),R(),e(B)?.blur();break;case"Tab":e(_)&&R();break}}function D(u){if(!u.originalQuantity||u.originalQuantity<=0)return"";const E=fa.normalize(u.originalQuantity,u.originalUnit||"",u.name);return E.hasConversion?`≈ ${E.quantity} ${E.unit}`:""}function J(u){}function N(){v(ne,e(n).trim(),!0),v(O,!0),R()}function X(u){ue(u.u)}var Y=js(),M=ye(Y),j=a(M);{var $=u=>{var E=Cs();d(u,E)},ie=u=>{var E=dt(),G=ye(E);{var oe=ae=>{var b=qs(),U=a(b),L=a(U),H=a(L);Rt(H,{class:"h-4 w-4"});var ee=r(H,2),ce=a(ee);t(ee),t(L),t(U),t(b),h(()=>T(ce,`Erreur lors du chargement: ${Me.error??""}`)),d(ae,b)},de=ae=>{var b=Ps(),U=a(b),L=a(U),H=a(L);ct(H,{class:"text-primary h-4 w-4"}),me(),t(L);var ee=r(L,2),ce=a(ee),fe=a(ce),V=a(fe);ir(V,{class:"h-4 w-4 opacity-50"});var F=r(V,2);xe(F),F.__input=()=>{!e(_)&&e(n).length>0&&le(!1)},F.__keydown=z,xt(F,W=>v(B,W),()=>e(B)),t(fe);var se=r(fe,2);se.__click=g;var Se=a(se);{let W=Re(()=>e(_)?"rotate-180":"");_a(Se,{get class(){return`h-4 w-4 transition-transform ${e(W)??""}`}})}t(se);var Ae=r(se,2);{var we=W=>{const Ue=Re(()=>e(A)());var he=zs(),Pe=a(he);{var Ne=ke=>{var Ce=Ls(),qe=r(ye(Ce),2);{var ze=De=>{var ge=As(),Ee=a(ge);Ee.__click=()=>N();var _e=a(Ee);ct(_e,{class:"h-4 w-4"});var ve=r(_e,4),S=a(ve);t(ve),t(Ee),t(ge),h(()=>{Ee.disabled=i(),T(S,`"${e(n)??""}"`)}),d(De,ge)};x(qe,De=>{e(n).trim().length>0&&De(ze)})}d(ke,Ce)},Te=ke=>{var Ce=Rs(),qe=ye(Ce);Ge(qe,19,()=>e(Ue),ge=>ge.u,(ge,Ee,_e)=>{var ve=Ss();ve.__click=()=>ue(e(Ee).u);var S=a(ve),P=a(S),K=a(P,!0);t(P),t(S),t(ve),h(()=>{je(ve,"id",`ingredient-${e(_e)??""}`),re(ve,1,`hover:bg-base-200 flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer ${e(_e)===e(f)?"bg-base-200":""}`),je(ve,"aria-selected",e(_e)===e(f)),ve.disabled=i(),T(K,e(Ee).n)}),at("mouseenter",ve,()=>v(f,e(_e),!0)),d(ge,ve)});var ze=r(qe,2);{var De=ge=>{var Ee=Is(),_e=a(Ee);_e.__click=()=>N();var ve=a(_e);ct(ve,{class:"h-4 w-4"}),me(2),t(_e),t(Ee),h(()=>_e.disabled=i()),d(ge,Ee)};x(ze,ge=>{e(n).trim().length>0&&ge(De)})}d(ke,Ce)};x(Pe,ke=>{e(Ue).length===0?ke(Ne):ke(Te,!1)})}t(he),d(W,he)};x(Ae,W=>{e(_)&&W(we)})}t(ce),t(ee),xt(ee,W=>v(I,W),()=>e(I)),t(U),t(b),h(()=>{re(fe,1,`input flex w-full items-center gap-2 pr-10 ${i()?"input-disabled":""}`),F.disabled=i(),je(F,"aria-expanded",e(_)),je(F,"aria-activedescendant",e(_)?`ingredient-${e(f)}`:void 0),se.disabled=i(),je(se,"aria-label",e(_)?"Fermer le menu":"Ouvrir le menu")}),Fe(F,()=>e(n),W=>v(n,W)),d(ae,b)};x(G,ae=>{Me.error?ae(oe):ae(de,!1)},!0)}d(u,E)};x(j,u=>{Me.loading?u($):u(ie,!1)})}var w=r(j,2);{var m=u=>{var E=dt(),G=ye(E);Ge(G,17,()=>Object.entries(e(Z)()),([oe,de])=>oe,(oe,de)=>{var ae=Re(()=>Na(e(de),2));let b=()=>e(ae)[0],U=()=>e(ae)[1];const L=Re(()=>ca(b())),H=Re(()=>e(L).icon);var ee=Ms(),ce=a(ee),fe=a(ce),V=a(fe);Fa(V,()=>e(H),(we,W)=>{W(we,{class:"h-4 w-4"})});var F=r(V),se=r(F),Se=a(se,!0);t(se),t(fe);var Ae=r(fe,2);Ge(Ae,21,U,yt,(we,W,Ue)=>{const he=Re(()=>D(e(W)));var Pe=Ds(),Ne=a(Pe),Te=a(Ne),ke=a(Te),Ce=a(ke),qe=a(Ce),ze=a(qe),De=a(ze,!0);t(ze);var ge=r(ze,2);ge.__click=()=>y(e(W).uuid);var Ee=a(ge);ha(Ee,{class:"h-4 w-4"}),t(ge),t(qe);var _e=r(qe,2),ve=a(_e),S=r(a(ve),2),P=a(S);xe(P),t(S),t(ve);var K=r(ve,2),pe=r(a(K),2);pe.__change=()=>{e(W).originalUnit==="au goût"&&(e(W).originalQuantity=1)};var Ie=a(pe);Ie.value=Ie.__value="kg";var We=r(Ie);We.value=We.__value="gr.";var Qe=r(We);Qe.value=Qe.__value="unité";var Ve=r(Qe);Ve.value=Ve.__value="l.";var st=r(Ve);st.value=st.__value="ml";var it=r(st);it.value=it.__value="c. à soupe";var nt=r(it);nt.value=nt.__value="c. à café";var mt=r(nt);mt.value=mt.__value="pincées";var $e=r(mt);$e.value=$e.__value="tête·s";var et=r($e);et.value=et.__value="gousse·s";var lt=r(et);lt.value=lt.__value="bottes";var ut=r(lt);ut.value=ut.__value="au goût",t(pe),t(K),t(_e);var wt=r(_e,2);{var Mt=Be=>{var gt=Ts(),pt=a(gt,!0);t(gt),h(()=>T(pt,e(he))),d(Be,gt)};x(wt,Be=>{e(he)&&Be(Mt)})}t(Ce);var kt=r(Ce,2),vt=r(a(kt),2);xe(vt),t(kt),t(ke),t(Te),t(Ne),t(Pe),h(()=>{T(De,e(W).name),ge.disabled=i(),P.disabled=e(W).originalUnit==="au goût",pe.disabled=i(),vt.disabled=i()}),at("blur",P,()=>(e(W),void 0)),Fe(P,()=>e(W).originalQuantity,Be=>e(W).originalQuantity=Be),at("blur",pe,()=>(e(W),void 0)),ht(pe,()=>e(W).originalUnit,Be=>e(W).originalUnit=Be),Fe(vt,()=>e(W).comment,Be=>e(W).comment=Be),pa(3,Pe,()=>hr),d(we,Pe)}),t(Ae),t(ce),t(ee),h(()=>{T(F,` ${e(L).displayName??""} `),T(Se,U().length)}),d(oe,ee)}),d(u,E)};x(w,u=>{o().length>0&&u(m)})}t(M);var k=r(M,2);Es(k,{get initialName(){return e(ne)},onIngredientCreated:X,get open(){return e(O)},set open(u){v(O,u,!0)}}),d(l,Y),Ze()}Xe(["input","keydown","click","change"]);var Ns=c('<label class="label"><span class="label-text font-medium"> </span></label>'),Bs=c('<div class="border-base-200 bg-base-200 flex flex-wrap items-center gap-1 border-b p-1"><button type="button" title="Gras"><!></button> <button type="button" title="Italique"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" title="Liste à puces"><!></button> <button type="button" title="Liste ordonnée"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Annuler"><!></button> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Rétablir"><!></button></div>'),Os=c('<div class="label"><span class="text-error"> </span></div>'),Us=c('<div class=" w-full"><!> <div><!> <div class="max-h-[calc(100vh-200px)] min-h-96 overflow-auto"></div></div> <!></div>');function va(l,s){Ye(s,!0);let o=Le(s,"value",15);Le(s,"placeholder",3,"Commencez à rédiger...");let i=Q(null),n=Q(null),f=Q(0),_=Q(!1);Ba(()=>{e(i)&&v(n,new yr({element:e(i),extensions:[wr.configure({codeBlock:!1,blockquote:!1}),kr.configure({html:!1,tightLists:!0})],content:o(),editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[150px] p-4"}},onUpdate:({editor:g})=>{const y=g.storage.markdown.getMarkdown();o()!==y&&o(y)},onSelectionUpdate:()=>{_t(f)},onTransaction:()=>{_t(f)},onFocus:()=>v(_,!0),onBlur:()=>v(_,!1)}),!0)}),Oa(()=>{e(n)&&e(n).destroy()});var q=Us(),I=a(q);{var B=g=>{var y=Ns(),z=a(y),D=a(z,!0);t(z),t(y),h(()=>{je(y,"for",s.id),T(D,s.label)}),d(g,y)};x(I,g=>{s.label&&g(B)})}var O=r(I,2);let ne;var A=a(O);{var Z=g=>{var y=Bs(),z=a(y);let D;z.__click=()=>e(n).chain().focus().toggleBold().run();var J=a(z);nr(J,{class:"h-4 w-4"}),t(z);var N=r(z,2);let X;N.__click=()=>e(n).chain().focus().toggleItalic().run();var Y=a(N);lr(Y,{class:"h-4 w-4"}),t(N);var M=r(N,4);let j;M.__click=()=>e(n).chain().focus().toggleBulletList().run();var $=a(M);or($,{class:"h-4 w-4"}),t(M);var ie=r(M,2);let w;ie.__click=()=>e(n).chain().focus().toggleOrderedList().run();var m=a(ie);dr(m,{class:"h-4 w-4"}),t(ie);var k=r(ie,4);k.__click=()=>e(n).chain().focus().undo().run();var u=a(k);cr(u,{class:"h-4 w-4"}),t(k);var E=r(k,2);E.__click=()=>e(n).chain().focus().redo().run();var G=a(E);ur(G,{class:"h-4 w-4"}),t(E),t(y),h((oe,de,ae,b,U,L)=>{D=re(z,1,"btn btn-ghost btn-square btn-sm",null,D,oe),X=re(N,1,"btn btn-ghost btn-square btn-sm",null,X,de),j=re(M,1,"btn btn-ghost btn-square btn-sm",null,j,ae),w=re(ie,1,"btn btn-ghost btn-square btn-sm",null,w,b),k.disabled=U,E.disabled=L},[()=>({"btn-active":e(f)>=0&&e(n).isActive("bold")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("italic")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("bulletList")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("orderedList")}),()=>!(e(f)>=0&&e(n).can().undo()),()=>!(e(f)>=0&&e(n).can().redo())]),d(g,y)};x(A,g=>{e(n)&&g(Z)})}var ue=r(A,2);xt(ue,g=>v(i,g),()=>e(i)),t(O);var le=r(O,2);{var R=g=>{var y=Os(),z=a(y),D=a(z,!0);t(z),t(y),h(()=>T(D,s.error)),d(g,y)};x(le,g=>{s.error&&g(R)})}t(q),h(()=>{ne=re(O,1,"bg-base-100 overflow-hidden rounded-lg border-2 transition-all",null,ne,{"border-primary":e(_),"border-error":s.error,"border-base-300":!e(_)&&!s.error}),je(ue,"id",s.id)}),d(l,q),Ze()}Xe(["click"]);var Hs=c('<div class="alert alert-error mt-4"><span class="text-sm"> </span></div>'),Qs=c('<p class="py-2 text-sm italic opacity-50">Aucune astuce ajoutée</p>'),Vs=c('<span class="text-error text-xs"> </span>'),Gs=c("<span></span>"),Ws=c(`<div class="flex flex-col gap-1"><div class="flex items-start gap-2"><div class="flex-1"><textarea placeholder="Ex: Ajouter un filet d'huile d'olive au moment de servir" maxlength="250"></textarea></div> <button type="button" class="btn btn-square btn-sm text-error" title="Supprimer l'astuce"><!></button></div> <div class="flex justify-between px-1"><!> <span> </span></div></div>`),Ks=c('<div class="space-y-3"></div>'),Js=c(`<div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><div class="card-body"><h2 class="card-title mb-4"><!> Ingrédients</h2> <!> <!></div></div> <div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Préparation</h2> <div class="space-y-6"><div class="max-h-dvh"><!></div> <div><div class="max-h-dvh"><!></div> <p class="text-end text-xs italic opacity-60">La préparation à l'avance sera mise en évidence au dessus des autres
            étapes.</p></div></div> <div class="divider"></div> <div class="space-y-4"><div class="flex items-center justify-between"><h3 class="flex items-center gap-2 font-semibold"><!> Astuces et conseils</h3> <button type="button" class="btn btn-outline btn-primary btn-sm">+ Ajouter une astuce</button></div> <!></div></div></div></div>`);function wi(l,s){Ye(s,!0);let o=Le(s,"recipe",15);var i=Js(),n=a(i),f=a(n),_=a(f),q=a(_);ma(q,{class:"h-5 w-4"}),me(),t(_);var I=r(_,2);{let w=Re(()=>!s.canEdit);Fs(I,{get disabled(){return e(w)},get ingredients(){return o().ingredients},set ingredients(m){o(o().ingredients=m,!0)}})}var B=r(I,2);{var O=w=>{var m=Hs(),k=a(m),u=a(k,!0);t(k),t(m),h(()=>T(u,s.validationErrors.ingredients)),d(w,m)};x(B,w=>{s.validationErrors.ingredients&&o().ingredients.length===0&&w(O)})}t(f),t(n);var ne=r(n,2),A=a(ne),Z=a(A),ue=a(Z);ga(ue,{class:"h-5 w-4"}),me(),t(Z);var le=r(Z,2),R=a(le),g=a(R);va(g,{id:"recipe-preparation",label:"Instructions de préparation",get error(){return s.validationErrors.preparation},placeholder:"Décrivez les étapes de préparation...",get value(){return o().preparation},set value(w){o(o().preparation=w,!0)}}),t(R);var y=r(R,2),z=a(y),D=a(z);va(D,{id:"recipe-preparation24h",label:"Préparation à l'avance (optionnel)",get error(){return s.validationErrors.preparation24h},placeholder:"Étapes à réaliser avant le jour j...",get value(){return o().preparation24h},set value(w){o(o().preparation24h=w,!0)}}),t(z),me(2),t(y),t(le);var J=r(le,4),N=a(J),X=a(N),Y=a(X);vr(Y,{class:"text-warning h-4 w-4"}),me(),t(X);var M=r(X,2);M.__click=()=>{o(o().astuces=[...o().astuces,{astuce:""}],!0)},t(N);var j=r(N,2);{var $=w=>{var m=Qs();d(w,m)},ie=w=>{var m=Ks();Ge(m,21,()=>o().astuces,yt,(k,u,E)=>{var G=Ws(),oe=a(G),de=a(oe),ae=a(de);Ua(ae),t(de);var b=r(de,2);b.__click=()=>{o(o().astuces=o().astuces.filter((F,se)=>se!==E),!0)};var U=a(b);ha(U,{size:14}),t(b),t(oe);var L=r(oe,2),H=a(L);{var ee=F=>{var se=Vs(),Se=a(se,!0);t(se),h(()=>T(Se,s.validationErrors.astuces[E])),d(F,se)},ce=F=>{var se=Gs();d(F,se)};x(H,F=>{s.validationErrors.astuces?.[E]?F(ee):F(ce,!1)})}var fe=r(H,2),V=a(fe);t(fe),t(L),t(G),h(()=>{ae.disabled=!s.canEdit,re(ae,1,`textarea textarea-bordered h-20 w-full text-sm ${s.validationErrors.astuces?.[E]?"textarea-error":""}`),b.disabled=!s.canEdit,re(fe,1,`text-xs ${e(u).astuce.length>250?"text-error font-bold":"opacity-50"}`),T(V,`${e(u).astuce.length??""} / 250`)}),Fe(ae,()=>e(u).astuce,F=>e(u).astuce=F),d(k,G)}),t(m),d(w,m)};x(j,w=>{o().astuces.length===0?w($):w(ie,!1)})}t(J),t(A),t(ne),t(i),h(()=>{re(n,1,`card bg-base-100 shadow-xl ${s.validationErrors.ingredients?"ring-error ring-2":""}`),M.disabled=!s.canEdit}),d(l,i),Ze()}Xe(["click"]);var Xs=c('<button class="btn btn-circle btn-xs btn-error btn-ghost ms-2" title="Retirer les droits"><!></button>'),Ys=c('<div class="badge badge-lg badge-soft gap-2 p-4"><span> </span> <!></div>'),Zs=c('<button class="btn btn-primary btn-sm btn-outline ms-4" title="Gérer les collaborateurs"><!> Ajouter des contributeur·ices</button>'),$s=c(`<div class="space-y-4"><div class="alert alert-info alert-soft border-info/20 max-md:alert-vertical text-xs"><!> <span>Par défaut, seul l'auteur·ice peut modifier la recette. Les autres
        utilisateur·ices peuvent la consulter ou la dupliquer pour créer leur
        propre version. Ajoutez des collaborateur·ices ici pour leur donner
        explicitement le droit de modifier cette version originale.</span></div> <div class="flex flex-wrap gap-2"><div class="badge badge-lg badge-soft badge-info gap-2 p-4"><!> <span> </span> <div class="badge badge-xs">Auteur</div></div> <!> <!></div></div>`),ei=c('<span class="loading loading-spinner loading-xs"></span>'),ti=c('<p class="text-error mt-2 flex items-center gap-1 text-xs"><!> </p>'),ai=c('<p class="text-xs opacity-60">Sélectionnez des membres de vos équipes pour les ajouter :</p> <div class="max-h-48 overflow-y-auto pr-2"><!></div>',1),ri=c(`<p class="py-4 text-center text-sm italic opacity-40">Vous n'avez pas encore d'équipe créée.</p>`),si=c('<p class="py-4 text-center text-sm italic opacity-40">Tous les membres de vos équipes sont déjà ajoutés.</p>'),ii=c('<div class="space-y-6"><fieldset class="fieldset"><legend class="fieldset-legend">Ajouter par email</legend> <div class="flex gap-2"><label class="input input-bordered flex grow items-center gap-2"><!> <input type="email" class="grow" placeholder="utilisateur@email.com"/></label> <button class="btn btn-primary"><!></button></div> <!></fieldset> <div class="divider text-xs font-bold tracking-widest uppercase opacity-50">Ou via vos équipes</div> <div class="space-y-4"><!></div></div>'),ni=c('<button class="btn btn-block btn-primary">Terminer</button>'),li=c("<!> <!> <!>",1),oi=c("<!> <!>",1);function ki(l,s){Ye(s,!0);let o=Le(s,"permissionWrite",15),i=Q(!1),n=Q(""),f=Q(!1),_=Q(null),q=rt({});Je(()=>{s.createdBy===bt.userId&&(q[s.createdBy]=bt.userName||"Propriétaire");for(const R of $t.teams)if(R.members)for(const g of R.members)g.name&&!q[g.id]&&(q[g.id]=g.name)});let I=Re(()=>{const R=[];for(const g of $t.teams)if(g.members)for(const y of g.members)y.id!==s.createdBy&&(R.some(z=>z.id===y.id)||R.push({id:y.id,label:y.name,selected:!1}));return R});async function B(){if(!e(n))return;const R=e(n).trim();v(f,!0),v(_,null);try{const{checkUserEmails:g}=await Qa(async()=>{const{checkUserEmails:D}=await import("./appwrite.js").then(J=>J.b8);return{checkUserEmails:D}},[]),z=(await g([R]))[R];z?o()?.includes(z.id)?v(_,"Cet utilisateur a déjà les droits d'écriture."):(o([...o()||[],z.id]),q[z.id]=z.name||R,v(n,""),Oe.success(`Permission d'édition ajouté pour ${z.name||R}`)):v(_,"Utilisateur introuvable. Seuls les utilisateur·ices inscrit sur enka-cookbook peuvent être ajouté·es. Vous pouvez invitez des personnes depuis votre dashboard")}catch(g){console.error("Erreur check email:",g),v(_,"Erreur lors de la vérification de l'email.")}finally{v(f,!1)}}function O(R){o()?.includes(R)?o((o()||[]).filter(g=>g!==R)):o([...o()||[],R])}function ne(R){R!==s.createdBy&&o((o()||[]).filter(g=>g!==R))}function A(){v(i,!1),v(n,""),v(_,null)}var Z=oi(),ue=ye(Z);Er(ue,{get iconComponent(){return _r},legend:"Permissions",children:(R,g)=>{var y=$s(),z=a(y),D=a(z);pr(D,{size:16}),me(2),t(z);var J=r(z,2),N=a(J),X=a(N);fr(X,{size:14});var Y=r(X,2),M=a(Y,!0);t(Y),me(2),t(N);var j=r(N,2);Ge(j,17,()=>(o()||[]).filter(w=>s.createdBy!==void 0&&w!==s.createdBy),yt,(w,m)=>{var k=Ys(),u=a(k),E=a(u,!0);t(u);var G=r(u,2);{var oe=de=>{var ae=Xs();ae.__click=()=>ne(e(m));var b=a(ae);ba(b,{size:16}),t(ae),d(de,ae)};x(G,de=>{s.canEdit&&de(oe)})}t(k),h(()=>T(E,q[e(m)]||e(m))),pa(3,k,()=>xr,()=>({duration:200})),d(w,k)});var $=r(j,2);{var ie=w=>{var m=Zs();m.__click=()=>v(i,!0);var k=a(m);br(k,{size:18}),me(),t(m),d(w,m)};x($,w=>{s.canEdit&&w(ie)})}t(J),t(y),h(()=>T(M,s.createdBy&&q[s.createdBy]||"Propriétaire")),d(R,y)},$$slots:{default:!0}});var le=r(ue,2);zt(le,{get isOpen(){return e(i)},onClose:A,children:(R,g)=>{var y=li(),z=ye(y);Pt(z,{title:"Gérer les collaborateurs",onClose:A});var D=r(z,2);Tt(D,{children:(N,X)=>{var Y=ii(),M=a(Y),j=r(a(M),2),$=a(j),ie=a($);mr(ie,{class:"opacity-40",size:18});var w=r(ie,2);xe(w),w.__keydown=L=>L.key==="Enter"&&B(),t($);var m=r($,2);m.__click=B;var k=a(m);{var u=L=>{var H=ei();d(L,H)},E=L=>{var H=Ha("Ajouter");d(L,H)};x(k,L=>{e(f)?L(u):L(E,!1)})}t(m),t(j);var G=r(j,2);{var oe=L=>{var H=ti(),ee=a(H);gr(ee,{size:14});var ce=r(ee);t(H),h(()=>T(ce,` ${e(_)??""}`)),d(L,H)};x(G,L=>{e(_)&&L(oe)})}t(M);var de=r(M,4),ae=a(de);{var b=L=>{var H=ai(),ee=r(ye(H),2),ce=a(ee);Cr(ce,{get items(){return e(I)},onToggleItem:O,size:"sm"}),t(ee),d(L,H)},U=L=>{var H=dt(),ee=ye(H);{var ce=V=>{var F=ri();d(V,F)},fe=V=>{var F=si();d(V,F)};x(ee,V=>{$t.teams.length===0?V(ce):V(fe,!1)},!0)}d(L,H)};x(ae,L=>{e(I).length>0?L(b):L(U,!1)})}t(de),t(Y),h(()=>m.disabled=e(f)||!e(n)),Fe(w,()=>e(n),L=>v(n,L)),d(N,Y)}});var J=r(D,2);Dt(J,{children:(N,X)=>{var Y=ni();Y.__click=A,d(N,Y)}}),d(R,y)},$$slots:{default:!0}}),d(l,Z),Ze()}Xe(["click","keydown"]);const di=["title","description","plate","preparation","preparation24h","cuisson","serveHot","typeR","categories","regime","saison","ingredients","quantite_desc","auteur","astuces","prepAlt","check","draft","permissionWrite","materiel","region","rootRecipeId","versionLabel","manuallyAddedVariants","variantsToRemove"];function Ei(){return{title:"",plate:100,ingredients:[],preparation:"",materiel:[],preparation24h:"",astuces:[],categories:[],saison:[],typeR:"",cuisson:"",serveHot:"",regime:[],description:"",quantite_desc:"",region:"",prepAlt:[],check:null,draft:!0,lockedBy:null,auteur:null,publishedAt:null,createdBy:bt.userId||"",permissionWrite:[bt.userId||""],teams:null,status:Va.PUBLIC,rootRecipeId:null,versionLabel:null,manuallyAddedVariants:[],variantsToRemove:[]}}function Ci(l,s={}){return{...l,...s,categories:l.categories||[],saison:l.saison||[],ingredients:l.ingredients??[],astuces:l.astuces??[],prepAlt:l.prepAlt||[],materiel:l.materiel||[],regime:l.regime||[],check:l.check??null}}function qi(l){const s={};return di.forEach(o=>{s[o]=l[o]}),JSON.stringify(s)}function Ai(l){return{title:l.title,plate:l.plate,preparation:l.preparation,cuisson:l.cuisson===""?!1:l.cuisson,serveHot:l.serveHot===""?!0:l.serveHot,check:l.check??!1,typeR:l.typeR,permissionWrite:l.permissionWrite&&l.permissionWrite.length>0?l.permissionWrite:[bt.userId],draft:l.draft??!0,categories:l.categories||[],regime:l.regime||[],saison:l.saison||[],materiel:l.materiel||[],quantite_desc:l.quantite_desc||null,description:l.description||null,region:l.region||null,auteur:l.auteur||null,preparation24h:l.preparation24h||null,teams:l.teams||null,status:l.status||"private",ingredients:[],astuces:null,prepAlt:null,lockedBy:null,publishedAt:null,rootRecipeId:l.rootRecipeId||null,versionLabel:l.versionLabel||null}}function Li(l,s,o){const i={...s,ingredients:l.ingredients,id:o.id,createdAt:o.createdAt,updatedAt:o.updatedAt,createdBy:o.createdBy};return delete i.$id,delete i.$createdAt,delete i.$updatedAt,i}function ci(l){if(!l.originalQuantity||l.originalQuantity<=0)return{...l,normalizedQuantity:0,normalizedUnit:l.originalUnit||"gr."};const s=fa.normalize(l.originalQuantity,l.originalUnit||"",l.name);return{...l,normalizedQuantity:s.quantity,normalizedUnit:s.unit}}function ui(l){return l.map(s=>ci(s))}function vi(l){const s=new Wa;let o=!1;l.forEach(f=>{f.allergens&&f.allergens.length>0&&f.allergens.forEach(_=>s.add(_)),f.type==="animaux"&&(o=!0)});const i=Array.from(s);(i.includes("Viande")||i.includes("Poisson")||i.includes("Crustacé")||i.includes("Mollusque")||i.includes("Porc"))&&(o=!0);const n=[];return!o&&!i.includes("Produit laitier")&&!i.includes("Oeuf")?n.push("vegan"):o||n.push("vegetarien"),i.includes("Gluten")||n.push("sans-gluten"),i.includes("Produit laitier")||n.push("sans-lactose"),{regimes:n}}function Si(l,s){if(!l)return!1;s.value={};let o=!1;if(!l.title?.trim())s.value.title="Le titre est obligatoire",o=!0;else if(l.title.length>100)s.value.title="Le titre ne peut pas dépasser 100 caractères",o=!0;else if(!/^[a-zA-Z0-9\s\-àâäéèêëïîôùûüçÀÂÄÉÈÊËÏÎÔÙÛÜÇ]+$/.test(l.title.trim()))s.value.title="Le titre ne peut contenir que des lettres, chiffres, espaces et tirets",o=!0;else{const n=l.title.trim().toLowerCase(),f=l.versionLabel?.trim().toLowerCase()||"";Ga.recipesIndex.find(q=>{const I=q.title.trim().toLowerCase()===n,B=q.versionLabel?.trim().toLowerCase()||"";return I&&f===B&&q.$id!==l.$id})&&(s.value.title=l.versionLabel?"Une recette avec ce nom et cette version existe déjà":"Une recette porte déjà ce nom (sans version)",o=!0)}if(l.versionLabel&&(/^[a-zA-Z0-9\s\-]+$/.test(l.versionLabel.trim())||(s.value.versionLabel="La version ne peut contenir que des caractères alphanumériques, des espaces et des tirets",o=!0)),l.typeR||(s.value.typeR="Le type de recette est obligatoire",o=!0),(l.cuisson===null||l.cuisson===void 0)&&(s.value.cuisson="Veuillez spécifier si une cuisson est nécessaire",o=!0),(l.serveHot===null||l.serveHot===void 0)&&(s.value.serveHot="Veuillez spécifier la température de service",o=!0),!l.plate||l.plate<1?(s.value.plate="Le nombre de couverts doit être d'au moins 1",o=!0):l.plate>1e4&&(s.value.plate="Le nombre de couverts ne peut pas dépasser 10 000",o=!0),l.quantite_desc&&l.quantite_desc.length>100&&(s.value.quantite_desc="La description des quantités ne peut pas dépasser 100 caractères",o=!0),l.description&&l.description.length>200&&(s.value.description="La description ne peut pas dépasser 200 caractères",o=!0),l.region&&l.region.length>50&&(s.value.region="La spécialité ne peut pas dépasser 50 caractères",o=!0),(!l.ingredients||l.ingredients.length===0)&&(s.value.ingredients="Au moins un ingrédient est requis",o=!0),l.preparation?.trim()?l.preparation.length>15e3&&(s.value.preparation="La préparation ne peut pas dépasser 15 000 caractères",o=!0):(s.value.preparation="La préparation est obligatoire",o=!0),l.preparation24h&&l.preparation24h.length>15e3&&(s.value.preparation24h="La préparation 24h ne peut pas dépasser 15 000 caractères",o=!0),(l.check===null||l.check===void 0)&&(s.value.check="Veuillez indiquer si la recette a été testée",o=!0),l.astuces&&l.astuces.length>0){const n=[];l.astuces.forEach((f,_)=>{f.astuce.length>250&&(n[_]="Maximum 250 caractères",o=!0)}),n.length>0&&(s.value.astuces=n)}o&&(Oe.error("Veuillez corriger les champs invalides",{autoCloseDelay:5e3}),setTimeout(()=>{const n=Object.keys(s.value)[0],_={title:"recipe-title",typeR:"recipe-type",cuisson:"recipe-cuisson",serveHot:"recipe-servehot",plate:"recipe-plate",quantite_desc:"recipe-quantite-desc",description:"description",region:"recipe-region",check:"recipe-check-fieldset",ingredients:"recipe-ingredients-editor",preparation:"recipe-preparation",preparation24h:"recipe-preparation24h"}[n];if(_){const q=document.getElementById(_);q&&(q.scrollIntoView({behavior:"smooth",block:"center"}),(q.tagName==="INPUT"||q.tagName==="SELECT"||q.tagName==="TEXTAREA")&&q.focus())}},100)),l.title=l.title.trim().charAt(0).toUpperCase()+l.title.trim().slice(1).toLowerCase(),l.ingredients=ui(l.ingredients);const{regimes:i}=vi(l.ingredients);return l.regime=i,!o}async function Ii(l,s){const o=Oe.loading("Suppression de la recette...");try{await Ka(l,bt.userId||""),s&&await s(),Oe.update(o,{state:"success",message:"Recette supprimée avec succès"})}catch(i){throw console.error("Erreur suppression:",i),Oe.update(o,{state:"error",message:"Erreur lors de la suppression"}),i}finally{setTimeout(()=>Oe.dismiss(o),3e3)}}export{yi as R,qi as a,wi as b,Ei as c,ki as d,vi as e,Ii as f,Ai as n,Li as p,Ci as t,Si as v};
