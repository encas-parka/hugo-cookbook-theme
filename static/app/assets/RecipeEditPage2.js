import{B as at,d as rt,p as De,z as It,J as Xe,m as e,u as Ee,y as ae,A as b,v as p,K as E,h as a,g as r,R as yt,w as q,C as V,M as Te,S as vt,T as Qe,b as d,c as st,ac as ut,x as R,e as Ge,i as wt,o as t,W as he,j as tt,k as Se,az as Je,am as Rt,ah as xt,al as qa,G as xe,af as Aa,ad as Sa,O as Ke,ak as La,ab as Ia,P as aa,t as Ra,aA as ra,X as Ca,Y as za,ag as Pa,I as pt,F as Qt,U as Ta,a8 as Da,aB as ja,N as Fa,aC as Ba,aD as Oa,ax as Ua}from"./appwrite.js";import{g as sa,G as Ma,X as ia,B as Zt,a7 as la,J as na,k as Na,am as Ha,r as Qa,W as Va,an as Ga,ao as Wa,ap as Ka,T as oa,c as Lt,S as Ja,ak as da,aq as Xa,ar as Ya,as as Za,at as $a,al as er,au as tr,av as ar,a0 as rr,b as sr,U as ir,a2 as lr,M as nr,aw as or}from"./icons.js";import{r as He}from"./RecipeDataStore.svelte.js";import{g as $t}from"./products-display.js";import{M as ca,b as va,c as ua,d as pa,s as dr,a as cr}from"./index.js";import{E as vr,i as ur,M as pr}from"./tiptap-markdown.es.js";import{F as fr}from"./Fieldset.js";import{B as _r}from"./BtnGroupCheck.js";var br=p('<legend class="fieldset-legend"> </legend>'),gr=p('<button type="button" role="option"><span> </span> <!></button>'),mr=p('<div class="text-base-content/50 px-4 py-2 text-sm">Aucune option disponible</div>'),hr=p('<div id="options-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!></div>'),xr=p('<div class="badge badge-lg badge-primary gap-2"><span> </span> <button type="button" class="btn btn-ghost btn-sm hover:bg-primary-focus h-4 min-h-0 w-4 p-0"><!></button></div>'),yr=p('<div class="mt-2 flex flex-wrap gap-2"></div>'),wr=p('<div class="fieldset-label"><span class="fieldset-label-text-alt opacity-70"> </span></div>'),kr=p('<fieldset class="fieldset w-full"><!> <div class="relative"><div id="multi-select"><input type="text" class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="options-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div> <!> <!></fieldset>');function ea(l,s){rt(s,!0);let o=De(s,"options",19,()=>[]),i=De(s,"selected",31,()=>It([])),n=De(s,"placeholder",3,"Sélectionnez des options..."),f=De(s,"disabled",3,!1),_=De(s,"closeOnSelect",3,!1),L=ae(""),h=ae(!1),M=ae(0),le=ae(void 0),pe=ae(void 0),G=Ee(()=>e(L).length>0?o().filter(v=>v.toLowerCase().includes(e(L).toLowerCase())):o());Xe(()=>{e(G).length>0&&e(M)>=e(G).length&&b(M,0)});function me(v){return i().includes(v)}function fe(v){me(v)?I(v):_e(v)}function _e(v){i().includes(v)||(i([...i(),v]),s.onChange?.(i())),b(L,""),b(M,0),_()?C():e(pe)?.focus()}function I(v){i(i().filter(P=>P!==v)),s.onChange?.(i())}function g(){if(i().length>0&&e(L)===""){const v=i()[i().length-1];I(v)}}function A(){f()||(b(h,!0),b(M,0))}function C(){b(h,!1),b(L,""),b(M,0)}function ne(){e(h)?C():A()}function ge(v){if(!f())switch(v.key){case"ArrowDown":v.preventDefault(),e(h)?e(M)<e(G).length-1&&ut(M):A();break;case"ArrowUp":v.preventDefault(),e(h)&&e(M)>0&&ut(M,-1);break;case"Enter":v.preventDefault(),e(h)&&e(G).length>0?fe(e(G)[e(M)]):e(h)||A();break;case"Escape":v.preventDefault(),C(),e(pe)?.blur();break;case"Backspace":e(L)===""&&i().length>0&&(v.preventDefault(),g());break;case"Tab":e(h)&&C();break}}function Y(v){e(le)&&!e(le).contains(v.target)&&C()}Xe(()=>{if(e(h))return document.addEventListener("mousedown",Y),()=>{document.removeEventListener("mousedown",Y)}});var re=kr(),Z=a(re);{var Q=v=>{var P=br(),X=a(P,!0);t(P),q(()=>R(X,s.label)),d(v,P)};E(Z,v=>{s.label&&v(Q)})}var W=r(Z,2),se=a(W),N=a(se);he(N),N.__keydown=ge,yt(N,v=>b(pe,v),()=>e(pe)),t(se);var S=r(se,2);S.__click=ne;var z=a(S);{let v=Ee(()=>e(h)?"rotate-180":"");sa(z,{get class(){return`h-4 w-4 transition-transform ${e(v)??""}`}})}t(S);var F=r(S,2);{var c=v=>{var P=hr(),X=a(P);{var y=T=>{var $=tt(),ee=Se($);Ge(ee,17,()=>e(G),wt,(oe,O,te,je)=>{const Le=Ee(()=>me(e(O)));var de=gr();Te(de,"id",`option-${te}`),de.__click=()=>fe(e(O));var D=a(de),Fe=a(D,!0);t(D);var Ie=r(D,2);{var Re=Ce=>{Ma(Ce,{class:"text-success h-4 w-4"})};E(Ie,Ce=>{e(Le)&&Ce(Re)})}t(de),q(()=>{V(de,1,`hover:bg-base-200 flex w-full items-center justify-between gap-2 px-4 py-2 text-left hover:cursor-pointer ${te===e(M)?"bg-base-200":""} ${e(Le)?"bg-success/20":""}`),Te(de,"aria-selected",e(Le)),R(Fe,e(O))}),vt("mouseenter",de,()=>b(M,te,!0)),d(oe,de)}),d(T,$)},B=T=>{var $=mr();d(T,$)};E(X,T=>{e(G).length>0?T(y):T(B,!1)})}t(P),d(v,P)};E(F,v=>{e(h)&&v(c)})}t(W);var x=r(W,2);{var H=v=>{var P=yr();Ge(P,21,i,wt,(X,y)=>{var B=xr(),T=a(B),$=a(T,!0);t(T);var ee=r(T,2);ee.__click=()=>I(e(y));var oe=a(ee);ia(oe,{class:"h-3 w-3"}),t(ee),t(B),q(()=>{R($,e(y)),ee.disabled=f(),Te(ee,"aria-label",`Supprimer ${e(y)??""}`)}),d(X,B)}),t(P),d(v,P)};E(x,v=>{i().length>0&&v(H)})}var K=r(x,2);{var J=v=>{var P=wr(),X=a(P),y=a(X,!0);t(X),t(P),q(()=>R(y,s.helpText)),d(v,P)};E(K,v=>{s.helpText&&v(J)})}t(re),yt(re,v=>b(le,v),()=>e(le)),q(()=>{V(se,1,`input flex w-full items-center gap-2 pr-10 ${f()?"input-disabled":""}`),Te(N,"placeholder",n()),N.disabled=f(),Te(N,"aria-expanded",e(h)),Te(N,"aria-activedescendant",e(h)?`option-${e(M)}`:void 0),S.disabled=f(),Te(S,"aria-label",e(h)?"Fermer le menu":"Ouvrir le menu")}),vt("focus",N,A),Qe(N,()=>e(L),v=>b(L,v)),d(l,re),st()}at(["keydown","click"]);var Er=p('<span class="text-error"> </span>'),qr=p('<span class="text-error text-wrap"> </span>'),Ar=p('<fieldset class="fieldset min-w-1/5"><legend class="fieldset-legend">Version</legend> <label class="input input-lg w-full"><span class="badge badge-ghost font-mono"> </span> <span class="px-1 opacity-40">-</span> <input type="text" placeholder="username" maxlength="20" class="grow font-mono text-sm"/></label> <p class="fieldset-label truncate" title="ex: &quot;économique&quot;, &quot;sans fromages&quot;, &quot;plus rapide&quot;...">ex: "économique", "sans fromages", "plus rapide"...</p> <!></fieldset>'),Sr=p('<span class="badge badge-secondary badge-lg h-full"> </span>'),Lr=p('<span class="text-error"> </span>'),Ir=p('<span class="text-error"> </span>'),Rr=p('<span class="text-error"> </span>'),Cr=p('<div class="fieldset-label"><span class="text-error"> </span></div>'),zr=p('<div class="fieldset-label"><span class="text-error"> </span></div>'),Pr=p('<div class="fieldset-label"><span class="text-error"> </span></div>'),Tr=p('<label class="flex cursor-pointer items-center gap-1"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="text-sm"> </span></label>'),Dr=p('<div class="fieldset-label"><span class="text-error"> </span></div>'),jr=p('<div class="lg:col-span-1"><!></div>'),Fr=p('<div class="fieldset-label"><span class="text-error"> </span></div>'),Br=p('<p class="text-warning/70">Une recette non testée est forcément conservée en brouillon.</p>'),Or=p(`<div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Informations générales</h2> <div class="flex flex-col gap-4"><div class="flex flex-col gap-x-10 gap-y-2"><div class="flex flex-wrap items-start gap-x-10"><fieldset class="fieldset min-w-3/5 flex-1"><legend class="fieldset-legend required">Titre de la recette</legend> <label><!> <input id="recipe-title" type="text" placeholder="Ex: Houmous maison" maxlength="80" aria-describedby="title-help" aria-required="true"/></label> <div class="fieldset-label" id="title-help"><!> <span class="fieldset-label ms-auto italic"> </span></div></fieldset> <!></div> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description</legend> <input type="text" name="description" id="description" maxlength="200" placeholder="Brève description de la recette"/> <span class="fieldset-label"><span class="ms-auto italic"> </span> <!></span></fieldset></div> <div class="flex flex-wrap justify-between gap-10"><div class="flex flex-wrap gap-x-10 gap-y-2"><fieldset class="fieldset"><legend class="fieldset-legend required">Nombre de couverts</legend> <label><!> <input id="recipe-plate" type="number" min="1" max="80000" aria-describedby="plate-help" aria-required="true"/></label> <div class="fieldset-label" id="plate-help"><span class="italic">Quantités indiquées pour combien ?</span> <!></div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Description des quantités</legend> <label><!> <input id="recipe-quantite-desc" type="text" placeholder="Ex: '24 parts par gastro'; '2 beignets/personne' ..." maxlength="100"/></label> <div class="fieldset-label"><!> <span class="ms-auto italic"> </span></div></fieldset></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset sm:w-auto"><legend class="fieldset-legend required">Type de recette</legend> <label><!> <select id="recipe-type" aria-describedby="type-help"><option disabled selected>Sélectionner un type</option><option>Entrée</option><option>Plat</option><option>Dessert</option><option>Autre</option></select></label> <!></fieldset> <div class="flex-1 sm:max-w-md"><!></div></div> <div class="flex flex-col gap-x-10 gap-y-2 sm:flex-row sm:items-start"><fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend required"><!> <span>Température de service</span></legend> <label><select id="recipe-servehot"><option disabled selected>--</option><option>Chaud</option><option>Froid</option></select></label> <!></fieldset> <fieldset class="fieldset flex-1 sm:max-w-xs"><legend class="fieldset-legend required"><!> <span>Nécessite une cuisson</span></legend> <label><select id="recipe-cuisson"><option disabled selected>--</option><option>Oui</option><option>Non</option></select></label> <!></fieldset></div> <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"><fieldset class="fieldset"><legend class="fieldset-legend">Saisons</legend> <div class="flex flex-wrap gap-2"></div> <div class="fieldset-label italic">Si certains ingrédients ne se trouvent qu'à certaines saisons...</div></fieldset> <fieldset class="fieldset flex-1"><legend class="fieldset-legend">Spécialité</legend> <label><!> <input id="recipe-region" type="text" placeholder="Ex: Basque, Italien" maxlength="50"/></label> <!></fieldset> <!></div> <div id="recipe-check-fieldset"><div class="flex w-full flex-wrap gap-x-6 gap-y-2"><div class="required">Avez-vous testé la recette pour le nombre de couverts indiqué ?</div> <div class="flex gap-4"><label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Oui</span></label> <label class="flex cursor-pointer items-center gap-2"><input type="radio" name="check" class="radio radio-primary radio-sm"/> <span class="text-sm">Non</span></label></div></div> <!> <label class="flex w-full cursor-pointer gap-3"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm mt-1"/> <div class="flex flex-col"><p class="text-sm font-medium">Brouillon</p> <p class="opacity-70">Les brouillons sont visibles uniquement pour les utilisateur·ices
              inscrite, mais peuvent tout de même être ajoutés à vos événements.
              Le status "brouillon" vous permettra de retrouver facilement les
              recettes que vous n'avez pas finalisé.</p> <!></div></label></div></div></div></div>`);function Xs(l,s){rt(s,!0);const o=[];let i=De(s,"recipe",15);var n=Or(),f=a(n),_=a(f),L=a(_);Zt(L,{class:"h-5 w-5"}),xe(),t(_);var h=r(_,2),M=a(h),le=a(M),pe=a(le),G=r(a(pe),2),me=a(G);Zt(me,{class:"h-4 w-4 opacity-50"});var fe=r(me,2);he(fe),t(G);var _e=r(G,2),I=a(_e);{var g=u=>{var m=Er(),U=a(m,!0);t(m),q(()=>R(U,s.validationErrors.title)),d(u,m)};E(I,u=>{s.validationErrors.title&&u(g)})}var A=r(I,2),C=a(A);t(A),t(_e),t(pe);var ne=r(pe,2);{var ge=u=>{var m=tt(),U=Se(m);{var ue=Ne=>{const We=Ee(()=>i().versionLabel.match(/^v(\d+)/)?parseInt(i().versionLabel.match(/^v(\d+)/)[1]):null);var ct=tt(),Ft=Se(ct);{var ya=Bt=>{var Ot=Ar(),Ut=r(a(Ot),2),Mt=a(Ut),wa=a(Mt);t(Mt);var Nt=r(Mt,4);he(Nt),Nt.__input=et=>{let Ht=et.target.value.toLowerCase().trim();i(i().versionLabel=`v${e(We)} - ${Ht}`,!0)},t(Ut);var ka=r(Ut,4);{var Ea=et=>{var St=qr(),Ht=a(St,!0);t(St),q(()=>R(Ht,s.validationErrors.versionLabel)),d(et,St)};E(ka,et=>{s.validationErrors.versionLabel&&et(Ea)})}t(Ot),q(et=>{R(wa,`v${e(We)??""}`),Sa(Nt,et)},[()=>i().versionLabel.replace(/^v\d+\s*-\s*/,"")]),d(Bt,Ot)};E(Ft,Bt=>{e(We)&&Bt(ya)})}d(Ne,ct)};E(U,Ne=>{i().versionLabel&&Ne(ue)})}d(u,m)},Y=u=>{var m=tt(),U=Se(m);{var ue=Ne=>{var We=Sr(),ct=a(We,!0);t(We),q(()=>R(ct,i().versionLabel)),d(Ne,We)};E(U,Ne=>{i().versionLabel&&Ne(ue)},!0)}d(u,m)};E(ne,u=>{s.canEdit?u(ge):u(Y,!1)})}t(le);var re=r(le,2),Z=r(a(re),2);he(Z);var Q=r(Z,2),W=a(Q),se=a(W);t(W);var N=r(W,2);{var S=u=>{var m=Lr(),U=a(m,!0);t(m),q(()=>R(U,s.validationErrors.description)),d(u,m)};E(N,u=>{s.validationErrors.description&&u(S)})}t(Q),t(re),t(M);var z=r(M,2),F=a(z),c=a(F),x=r(a(c),2),H=a(x);la(H,{class:"h-4 w-4 opacity-50"});var K=r(H,2);he(K),t(x);var J=r(x,2),v=r(a(J),2);{var P=u=>{var m=Ir(),U=a(m,!0);t(m),q(()=>R(U,s.validationErrors.plate)),d(u,m)};E(v,u=>{s.validationErrors.plate&&u(P)})}t(J),t(c);var X=r(c,2),y=r(a(X),2),B=a(y);na(B,{class:"h-4 w-4 opacity-50"});var T=r(B,2);he(T),t(y);var $=r(y,2),ee=a($);{var oe=u=>{var m=Rr(),U=a(m,!0);t(m),q(()=>R(U,s.validationErrors.quantite_desc)),d(u,m)};E(ee,u=>{s.validationErrors.quantite_desc&&u(oe)})}var O=r(ee,2),te=a(O);t(O),t($),t(X),t(F),t(z);var je=r(z,2),Le=a(je),de=r(a(Le),2),D=a(de);Na(D,{class:"h-4 w-4 opacity-50"});var Fe=r(D,2),Ie=a(Fe);Ie.value=Ie.__value="";var Re=r(Ie),Ce={},Ue=r(Re),qe={},Ae=r(Ue),we={},ze=r(Ae),Be={};t(Fe),t(de);var be=r(de,2);{var ye=u=>{var m=Cr(),U=a(m),ue=a(U,!0);t(U),t(m),q(()=>R(ue,s.validationErrors.typeR)),d(u,m)};E(be,u=>{s.validationErrors.typeR&&u(ye)})}t(Le);var ve=r(Le,2),ce=a(ve);{var w=u=>{{let m=Ee(()=>!s.canEdit);ea(u,{get options(){return s.recipeInfo.categories},label:"Sous-Catégories",placeholder:"Rechercher une catégorie...",get disabled(){return e(m)},closeOnSelect:!0,get selected(){return i().categories},set selected(U){i(i().categories=U,!0)}})}};E(ce,u=>{s.recipeInfo&&s.recipeInfo.categories&&i().categories&&u(w)})}t(ve),t(je);var k=r(je,2),j=a(k),ie=a(j),ke=a(ie);Ha(ke,{class:"h-4 w-4"}),xe(2),t(ie);var Me=r(ie,2),Pe=a(Me),Oe=a(Pe);Oe.value=Oe.__value="";var Ye=r(Oe);Ye.value=Ye.__value=!0;var it=r(Ye);it.value=it.__value=!1,t(Pe),t(Me);var ft=r(Me,2);{var _t=u=>{var m=zr(),U=a(m),ue=a(U,!0);t(U),t(m),q(()=>R(ue,s.validationErrors.serveHot)),d(u,m)};E(ft,u=>{s.validationErrors.serveHot&&u(_t)})}t(j);var lt=r(j,2),Ze=a(lt),bt=a(Ze);Qa(bt,{class:"h-4 w-4"}),xe(2),t(Ze);var $e=r(Ze,2),nt=a($e),gt=a(nt);gt.value=gt.__value="";var ot=r(gt);ot.value=ot.__value=!0;var dt=r(ot);dt.value=dt.__value=!1,t(nt),t($e);var Ve=r($e,2);{var mt=u=>{var m=Pr(),U=a(m),ue=a(U,!0);t(U),t(m),q(()=>R(ue,s.validationErrors.cuisson)),d(u,m)};E(Ve,u=>{s.validationErrors.cuisson&&u(mt)})}t(lt),t(k);var ht=r(k,2),Ct=a(ht),Vt=r(a(Ct),2);Ge(Vt,20,()=>[{value:"printemps",label:"Printemps"},{value:"ete",label:"Été"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}],u=>u.value,(u,m)=>{var U=Tr(),ue=a(U);he(ue);var Ne,We=r(ue,2),ct=a(We,!0);t(We),t(U),q(()=>{ue.disabled=!s.canEdit,Ne!==(Ne=m.value)&&(ue.value=(ue.__value=m.value)??""),R(ct,m.label)}),Aa(o,[],ue,()=>(m.value,i().saison),Ft=>i(i().saison=Ft,!0)),d(u,U)}),t(Vt),xe(2),t(Ct);var zt=r(Ct,2),kt=r(a(zt),2),Gt=a(kt);Va(Gt,{class:"h-4 w-4 opacity-50"});var Pt=r(Gt,2);he(Pt),t(kt);var fa=r(kt,2);{var _a=u=>{var m=Dr(),U=a(m),ue=a(U,!0);t(U),t(m),q(()=>R(ue,s.validationErrors.region)),d(u,m)};E(fa,u=>{s.validationErrors.region&&u(_a)})}t(zt);var ba=r(zt,2);{var ga=u=>{var m=jr(),U=a(m);{let ue=Ee(()=>!s.canEdit);ea(U,{get options(){return s.recipeInfo.materiel},label:"Matériel nécessaire",placeholder:"Rechercher du matériel...",get disabled(){return e(ue)},closeOnSelect:!0,get selected(){return i().materiel},set selected(Ne){i(i().materiel=Ne,!0)}})}t(m),d(u,m)};E(ba,u=>{i().materiel&&s.recipeInfo&&s.recipeInfo.materiel&&u(ga)})}t(ht);var Tt=r(ht,2),Dt=a(Tt),Wt=r(a(Dt),2),jt=a(Wt),Et=a(jt);he(Et),Et.__change=()=>i()&&i(i().check=!0,!0),xe(2),t(jt);var Kt=r(jt,2),qt=a(Kt);he(qt),qt.__change=()=>i()&&i(i().check=!1,!0),xe(2),t(Kt),t(Wt),t(Dt);var Jt=r(Dt,2);{var ma=u=>{var m=Fr(),U=a(m),ue=a(U,!0);t(U),t(m),q(()=>R(ue,s.validationErrors.check)),d(u,m)};E(Jt,u=>{s.validationErrors.check&&u(ma)})}var Xt=r(Jt,2),At=a(Xt);he(At);var Yt=r(At,2),ha=r(a(Yt),4);{var xa=u=>{var m=Br();d(u,m)};E(ha,u=>{i().check!==!0&&u(xa)})}t(Yt),t(Xt),t(Tt),t(h),t(f),t(n),q(()=>{V(G,1,`input input-lg w-full ${s.validationErrors.title?"input-error":""}`),fe.disabled=!s.canEdit,R(C,`${(i().title?.length||0)??""}/80 caractères`),Z.disabled=!s.canEdit,V(Z,1,`input w-full ${s.validationErrors.description?"input-error":""}`),R(se,`${(i().description?.length||0)??""}/200 caractères`),V(x,1,`input ${s.validationErrors.plate?"input-error":""}`),K.disabled=!s.canEdit,V(y,1,`input w-full min-w-lg ${s.validationErrors.quantite_desc?"input-error":""}`),T.disabled=!s.canEdit,R(te,`${(i().quantite_desc?.length||0)??""}/100 caractères`),V(de,1,`select ${s.validationErrors.typeR?"select-error":""}`),Fe.disabled=!s.canEdit,Ce!==(Ce=Je.ENTREE)&&(Re.value=(Re.__value=Je.ENTREE)??""),qe!==(qe=Je.PLAT)&&(Ue.value=(Ue.__value=Je.PLAT)??""),we!==(we=Je.DESSERT)&&(Ae.value=(Ae.__value=Je.DESSERT)??""),Be!==(Be=Je.AUTRE)&&(ze.value=(ze.__value=Je.AUTRE)??""),V(Me,1,`select w-full ${s.validationErrors.serveHot?"select-error":""}`),Pe.disabled=!s.canEdit,V($e,1,`select w-full ${s.validationErrors.cuisson?"select-error":""}`),nt.disabled=!s.canEdit,V(kt,1,`input ${s.validationErrors.region?"input-error":""}`),Pt.disabled=!s.canEdit,V(Tt,1,` my-4 flex w-full flex-wrap space-y-6 rounded-xl border p-4 ${s.validationErrors.check?"border-error":"border-base-300"}`),Rt(Et,i()?.check===!0),Et.disabled=!s.canEdit,Rt(qt,i()?.check===!1),qt.disabled=!s.canEdit,At.disabled=!s.canEdit||i().check!==!0}),Qe(fe,()=>i().title,u=>i(i().title=u,!0)),Qe(Z,()=>i().description,u=>i(i().description=u,!0)),Qe(K,()=>i().plate,u=>i(i().plate=u,!0)),Qe(T,()=>i().quantite_desc,u=>i(i().quantite_desc=u,!0)),xt(Fe,()=>i().typeR,u=>i(i().typeR=u,!0)),xt(Pe,()=>i().serveHot,u=>i(i().serveHot=u,!0)),xt(nt,()=>i().cuisson,u=>i(i().cuisson=u,!0)),Qe(Pt,()=>i().region,u=>i(i().region=u,!0)),qa(At,()=>i().draft,u=>i(i().draft=u,!0)),d(l,n),st()}at(["input","change"]);var Ur=p('<div class="alert alert-error max-md:alert-vertical text-sm"><!> <span> </span></div>'),Mr=p('<p class="text-error text-xs"> </p>'),Nr=p("<option> </option>"),Hr=p('<p class="text-error text-xs"> </p>'),Qr=p('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="text-sm"> </span></label>'),Vr=p('<p class="text-error text-xs"> </p>'),Gr=p('<p class="text-error text-xs"> </p>'),Wr=p('<p class="text-error text-xs"> </p>'),Kr=p('<label><input type="checkbox" class="checkbox checkbox-sm bg-base-100"/> <span class="label-text"> </span></label>'),Jr=p(`<form class="flex flex-col space-y-6"><!> <fieldset class="space-y-4"><div class="fieldset"><legend class="fieldset-legend required">Nom</legend> <label><!> <input id="ingredient-name-input" type="text" placeholder="Nom de l'ingrédient" required aria-required="true" minlength="2" maxlength="60"/></label> <!></div> <div class="fieldset"><legend class="fieldset-legend required">Type</legend> <select required aria-required="true"><option>Sélectionner un type...</option><!></select> <!></div> <div class="fieldset"><legend class="fieldset-legend required">Allergènes</legend> <p class="text-base-content/60 mb-2 text-xs">Précisez les allergènes présents dans l'ingrédient et/ou la nature
            de l'ingrédients (ou cochez "Aucun"). Sert notamment à la
            classification des recettes comme végétarienne, sans-gluten, etc.)</p> <div class="flex flex-wrap gap-2"></div> <!></div> <div class="grid gap-4 md:grid-cols-2"><div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span class="required">frais ?</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Fruits et légumes frais, ou ingrédients qui se conservent au frigo</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div> <div class="fieldset"><legend class="fieldset-legend"><div class="flex items-center gap-2"><!> <span class="required">Produit surgelé ?</span></div></legend> <p class="text-base-content/60 mb-2 text-xs">Ingrédients qui se conservent au congélateur</p> <div><button type="button">Oui</button> <button type="button">Non</button></div> <!></div></div> <div class="fieldset"><legend class="fieldset-legend">Saisons (optionnel)</legend> <p class="text-base-content/60 mb-2 text-xs">Si l'ingrédient se trouve surtout à certaines saisons</p> <div class="flex flex-wrap gap-2"></div></div></fieldset></form>`),Xr=p('<span class="loading loading-spinner"></span>'),Yr=p(`<button type="button" class="btn btn-ghost">Annuler</button> <button type="submit" class="btn btn-primary"><!> Créer l'ingrédient</button>`,1),Zr=p("<!> <!> <!>",1);function $r(l,s){rt(s,!0);let o=De(s,"open",15,!1),i=De(s,"initialName",3,""),n=ae(It({name:i(),type:"",allergens:[],pF:null,pS:!1,saisons:[]})),f=ae(!1),_=ae(!1),L=ae(null),h=ae(It({}));const M=[{value:"frais",label:"Produits Frais (beurre, fromage, yahourt..."},{value:"legumes",label:"Fruits et Légumes (frais, concerves, surgelés, etc."},{value:"lof",label:"LOF : Laits, oeuf, farines, huiles..."},{value:"sucres",label:"Sucrés (jus, sirop, confiture ...)"},{value:"epices",label:"Assaisonnements (épices, herbes, sauces...)"},{value:"sec",label:"Sec (riz, pâtes, lentilles...)"},{value:"animaux",label:"Viandes et Poissons"},{value:"autres",label:"Autres"}],le=["Aucun","Produit laitier","Gluten","Crustacé","Oeuf","Poisson","Viande","Porc","Arachides","Soja","Fruits à coque","Céleri","Moutarde","Sésame","Sulfites","Lupin","Mollusque","Alcool","Vérifier emballage"],pe=[{value:"printemps",label:"Printemps"},{value:"ete",label:"Eté"},{value:"automne",label:"Automne"},{value:"hiver",label:"Hiver"}];function G(){const g={};return e(n).name.trim()||(g.name="Le nom est requis"),e(n).type.trim()||(g.type="Le type est requis"),e(n).allergens.length===0&&(g.allergens="Cochez 'Aucun' si l'ingrédient ne contient aucun allergène"),e(n).pF===null&&(g.pF="Indiquez si c'est un produit frais"),e(n).pS===null&&(g.pS="Indiquez si c'est un produit surgelé"),g}function me(g){g==="Aucun"?e(n).allergens=["Aucun"]:(e(n).allergens=e(n).allergens.filter(A=>A!=="Aucun"),e(n).allergens.includes(g)?e(n).allergens=e(n).allergens.filter(A=>A!==g):e(n).allergens.push(g))}async function fe(){if(!e(f)&&(b(_,!0),b(h,G(),!0),!(Object.keys(e(h)).length>0))){b(f,!0),b(L,null);try{const g={name:e(n).name.trim(),type:e(n).type,allergens:e(n).allergens.includes("Aucun")?[]:e(n).allergens,pF:e(n).pF===!0,pS:e(n).pS===!0,saisons:e(n).saisons.length>0?e(n).saisons:void 0},A=await He.addIngredient(g);Ke.success(`Ingrédient "${A.n}" créé avec succès`),s.onIngredientCreated&&s.onIngredientCreated(A),_e(),o(!1)}catch(g){b(L,g instanceof Error?g.message:"Erreur lors de la création",!0),Ke.error(e(L))}finally{b(f,!1)}}}function _e(){b(n,{name:"",type:"",allergens:[],pF:null,pS:null,saisons:[]},!0),b(_,!1),b(L,null),b(h,{},!0)}function I(){o(!1),_e()}Xe(()=>{o()&&(_e(),i()&&(e(n).name=i()),setTimeout(()=>{document.getElementById("ingredient-name-input")?.focus()},50))}),ca(l,{get isOpen(){return o()},onClose:I,children:(g,A)=>{var C=Zr(),ne=Se(C);va(ne,{title:"Créer un nouvel ingrédient",onClose:I});var ge=r(ne,2);ua(ge,{children:(re,Z)=>{var Q=Jr(),W=a(Q);{var se=w=>{var k=Ur(),j=a(k);oa(j,{size:18});var ie=r(j,2),ke=a(ie,!0);t(ie),t(k),q(()=>R(ke,e(L))),d(w,k)};E(W,w=>{e(L)&&w(se)})}var N=r(W,2),S=a(N),z=r(a(S),2),F=a(z);Ga(F,{class:"text-base-content/50 h-5 w-5"});var c=r(F,2);he(c),t(z);var x=r(z,2);{var H=w=>{var k=Mr(),j=a(k,!0);t(k),q(()=>R(j,e(h).name)),d(w,k)};E(x,w=>{e(_)&&e(h).name&&w(H)})}t(S);var K=r(S,2),J=r(a(K),2),v=a(J);v.value=v.__value="";var P=r(v);Ge(P,17,()=>M,w=>w.value,(w,k)=>{var j=Nr(),ie=a(j,!0);t(j);var ke={};q(()=>{R(ie,e(k).label),ke!==(ke=e(k).value)&&(j.value=(j.__value=e(k).value)??"")}),d(w,j)}),t(J);var X=r(J,2);{var y=w=>{var k=Hr(),j=a(k,!0);t(k),q(()=>R(j,e(h).type)),d(w,k)};E(X,w=>{e(_)&&e(h).type&&w(y)})}t(K);var B=r(K,2),T=r(a(B),4);Ge(T,20,()=>le,w=>w,(w,k)=>{var j=Qr(),ie=a(j);he(ie),ie.__change=()=>me(k);var ke=r(ie,2),Me=a(ke,!0);t(ke),t(j),q((Pe,Oe)=>{V(j,1,`label border-base-300 cursor-pointer gap-2 rounded-lg border px-3 py-1 ${Pe??""} ${e(_)&&e(h).allergens&&!e(n).allergens.length?"border-error":""}`),Rt(ie,Oe),R(Me,k)},[()=>e(n).allergens.includes(k)?"bg-primary/20 border-primary":"bg-base-200",()=>e(n).allergens.includes(k)]),d(w,j)}),t(T);var $=r(T,2);{var ee=w=>{var k=Vr(),j=a(k,!0);t(k),q(()=>R(j,e(h).allergens)),d(w,k)};E($,w=>{e(_)&&e(h).allergens&&w(ee)})}t(B);var oe=r(B,2),O=a(oe),te=a(O),je=a(te),Le=a(je);Wa(Le,{size:16,class:"opacity-50"}),xe(2),t(je),t(te);var de=r(te,4),D=a(de);D.__click=()=>e(n).pF=!0;var Fe=r(D,2);Fe.__click=()=>e(n).pF=!1,t(de);var Ie=r(de,2);{var Re=w=>{var k=Gr(),j=a(k,!0);t(k),q(()=>R(j,e(h).pF)),d(w,k)};E(Ie,w=>{e(_)&&e(h).pF&&w(Re)})}t(O);var Ce=r(O,2),Ue=a(Ce),qe=a(Ue),Ae=a(qe);Ka(Ae,{size:16,class:"opacity-50"}),xe(2),t(qe),t(Ue);var we=r(Ue,4),ze=a(we);ze.__click=()=>e(n).pS=!0;var Be=r(ze,2);Be.__click=()=>e(n).pS=!1,t(we);var be=r(we,2);{var ye=w=>{var k=Wr(),j=a(k,!0);t(k),q(()=>R(j,e(h).pS)),d(w,k)};E(be,w=>{e(_)&&e(h).pS&&w(ye)})}t(Ce),t(oe);var ve=r(oe,2),ce=r(a(ve),4);Ge(ce,21,()=>pe,w=>w.value,(w,k)=>{var j=Kr(),ie=a(j);he(ie),ie.__change=Pe=>{Pe.currentTarget.checked?e(n).saisons=[...e(n).saisons,e(k).value]:e(n).saisons=e(n).saisons.filter(Oe=>Oe!==e(k).value)};var ke=r(ie,2),Me=a(ke,!0);t(ke),t(j),q((Pe,Oe)=>{V(j,1,`label border-base-300 cursor-pointer gap-2 rounded-lg px-3 py-1 ${Pe??""}`),Rt(ie,Oe),R(Me,e(k).label)},[()=>e(n).saisons.includes(e(k).value)?"bg-success/20 border-success":"bg-base-200",()=>e(n).saisons.includes(e(k).value)]),d(w,j)}),t(ce),t(ve),t(N),t(Q),q(()=>{N.disabled=e(f),V(z,1,`input w-full ${e(_)&&e(h).name?"input-error":""}`),V(J,1,`select select-bordered w-full ${e(_)&&e(h).type?"select-error":""}`),V(de,1,`join w-full ${e(_)&&e(h).pF?"join-error":""}`),V(D,1,`btn join-item flex-1 ${e(n).pF===!0?"btn-success":""}`),V(Fe,1,`btn join-item flex-1 ${e(n).pF===!1?"btn-error":""}`),V(we,1,`join w-full ${e(_)&&e(h).pS?"join-error":""}`),V(ze,1,`btn join-item flex-1 ${e(n).pS===!0?"btn-info":""}`),V(Be,1,`btn join-item flex-1 ${e(n).pS===!1?"btn-error":""}`)}),vt("submit",Q,w=>{w.preventDefault(),fe()}),Qe(c,()=>e(n).name,w=>e(n).name=w),xt(J,()=>e(n).type,w=>e(n).type=w),d(re,Q)}});var Y=r(ge,2);pa(Y,{children:(re,Z)=>{var Q=Yr(),W=Se(Q);W.__click=I;var se=r(W,2);se.__click=fe;var N=a(se);{var S=F=>{var c=Xr();d(F,c)},z=F=>{Lt(F,{size:18})};E(N,F=>{e(f)?F(S):F(z,!1)})}xe(),t(se),q(()=>{W.disabled=e(f),se.disabled=e(f)}),d(re,Q)}}),d(g,C)},$$slots:{default:!0}}),st()}at(["change","click"]);var es=p('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body p-4"><div class="flex items-center gap-3"><div class="loading loading-spinner loading-sm"></div> <span class="text-sm">Chargement des ingrédients...</span></div></div></div>'),ts=p('<div class="card bg-error/10 border-error/20 border shadow-sm"><div class="card-body p-4"><div class="text-error flex items-center gap-3"><!> <span class="text-sm"> </span></div></div></div>'),as=p('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span> <span class="text-base-content/50 text-xs"> </span></button></div>'),rs=p('<div class="text-base-content/50 px-4 py-2 text-sm">Aucun ingrédient trouvé</div> <!>',1),ss=p('<button type="button" role="option"><div class="flex-1"><span class="truncate text-sm font-medium"> </span></div></button>'),is=p('<div class="border-base-300 mt-1 border-t pt-1"><button type="button" class="hover:bg-primary/20 text-primary flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer"><!> <span class="text-sm font-medium">Créer un nouvel ingrédient...</span></button></div>'),ls=p("<!> <!>",1),ns=p('<div id="ingredients-list" class="border-base-300 bg-base-100 absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-lg border shadow-lg" role="listbox"><!></div>'),os=p('<div class="card bg-base-100 border-base-300 border shadow-sm"><div class="card-body gap-3 p-3"><div class="flex items-center gap-2 font-bold"><!> Ajouter un ingrédient</div> <div class="mt-2"><div class="relative"><div><!> <input type="text" placeholder="Rechercher un ingrédient..." class="w-full bg-transparent outline-none" autocomplete="off" role="combobox" aria-controls="ingredients-list"/></div> <button type="button" class="btn btn-ghost btn-sm absolute top-1/2 right-1 -translate-y-1/2"><!></button> <!></div></div></div></div>'),ds=p('<div class="text-base-content/60 text-xs italic"> </div>'),cs=p('<div class="card bg-base-100 border-base-200 border shadow-sm"><div class="card-body p-3"><div class="flex items-start justify-between gap-3"><div class="flex-1 space-y-2"><div class="flex flex-wrap gap-2"><div class="item-start flex min-w-1/2 flex-1 justify-between"><div class="text-base font-medium"> </div> <button class="btn btn-ghost btn-sm btn-square text-error" title="Supprimer cet ingrédient"><!></button></div> <div class="flex flex-wrap gap-2"><label class="input input-sm w-44"><span class="label text-base-content/80">Quantité</span> <div class="flex items-center gap-1"><input type="number" class="text-center" min="0" step="0.1" placeholder="0"/></div></label> <label class="select select-sm w-44"><span class="label text-base-content/80">unité</span> <select class="text-center"><option>Kg</option><option>gr.</option><option>unité</option><option>l.</option><option>ml</option><option>c. à soupe</option><option>c. à café</option><option>pincées</option><option>tête·s</option><option>gousse·s</option><option>bottes</option><option>au goût</option></select></label></div> <!></div> <label class="input input-sm w-full"><span class="label">Note</span> <input type="text" placeholder="Ex: coupées en dés; pour la sauce..." maxlength="100"/></label></div></div></div></div>'),vs=p('<div class="card bg-base-300 border-base-300 border shadow-sm"><div class="card-body p-2"><div class="card-title text-secondary/80 flex items-center gap-2 px-4 text-sm font-semibold"><!> <span class="badge badge-xs badge-primary badge-soft"> </span></div> <div class="space-y-3"></div></div></div>'),us=p('<div class="space-y-4" id="recipe-ingredients-editor"><!> <!></div> <!>',1);function ps(l,s){rt(s,!0);let o=De(s,"ingredients",15),i=De(s,"disabled",3,!1),n=ae(""),f=ae(-1),_=ae(!1),L=ae(!1),h=ae(void 0),M=ae(void 0),le=ae(!1),pe=ae(""),G=Ee(()=>()=>e(L)||e(n).length===0?He.ingredients:He.searchIngredients(e(n))),me=Ee(()=>()=>{const c={};return o().forEach(x=>{const H=x.type||"autres";c[H]||(c[H]=[]),c[H].push(x)}),Object.keys(c).forEach(x=>{c[x].sort((H,K)=>H.name.localeCompare(K.name,"fr",{sensitivity:"base"}))}),c});Xe(()=>{!He.isInitialized&&!He.loading&&He.initialize().catch(c=>{console.error("[RecipeIngredientsEditor] Erreur lors de l'initialisation du recipeDataStore:",c)})}),Xe(()=>{const c=e(G)();c.length>0&&e(f)===-1?b(f,0):c.length===0&&b(f,-1)}),Xe(()=>{const c=e(G)();c.length>0&&e(f)>=c.length&&b(f,0)}),Xe(()=>{if(e(_)){const c=x=>{e(h)&&!e(h).contains(x.target)&&(b(_,!1),b(n,""))};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}}});function fe(c){const x=He.getIngredientByUuid(c);if(!x)return;const H={uuid:La(),name:x.n,originalQuantity:0,originalUnit:"gr.",normalizedQuantity:0,normalizedUnit:"gr.",comment:"",allergens:x.a||[],type:x.t||""};o([...o(),H]),b(n,""),b(L,!1),b(_,!1),b(f,-1),e(M)?.focus();const K=$t(H.type).displayName;Ke.success(`Ingredient ajouté dans ${K}`)}function _e(c=!1){!i()&&!He.loading&&!He.error&&(b(L,c,!0),b(_,!0),b(f,0))}function I(){b(_,!1),b(n,""),b(L,!1),b(f,-1)}function g(){e(_)?I():_e(!0)}function A(c){o(o().filter(x=>x.uuid!==c))}function C(c){if(!i())switch(c.key){case"ArrowDown":c.preventDefault();const x=e(G)();e(_)?e(f)<x.length-1&&ut(f):_e(!0);break;case"ArrowUp":c.preventDefault(),e(_)&&e(f)>0&&ut(f,-1);break;case"Enter":c.preventDefault();const H=e(G)();e(_)&&H.length>0?fe(H[e(f)].u):e(_)||_e(!0);break;case"Escape":c.preventDefault(),I(),e(M)?.blur();break;case"Tab":e(_)&&I();break}}function ne(c){if(!c.originalQuantity||c.originalQuantity<=0)return"";const x=ra.normalize(c.originalQuantity,c.originalUnit||"",c.name);return x.hasConversion?`≈ ${x.quantity} ${x.unit}`:""}function ge(c){}function Y(){b(pe,e(n).trim(),!0),b(le,!0),I()}function re(c){fe(c.u)}var Z=us(),Q=Se(Z),W=a(Q);{var se=c=>{var x=es();d(c,x)},N=c=>{var x=tt(),H=Se(x);{var K=v=>{var P=ts(),X=a(P),y=a(X),B=a(y);oa(B,{class:"h-4 w-4"});var T=r(B,2),$=a(T);t(T),t(y),t(X),t(P),q(()=>R($,`Erreur lors du chargement: ${He.error??""}`)),d(v,P)},J=v=>{var P=os(),X=a(P),y=a(X),B=a(y);Lt(B,{class:"text-primary h-4 w-4"}),xe(),t(y);var T=r(y,2),$=a(T),ee=a($),oe=a(ee);Ja(oe,{class:"h-4 w-4 opacity-50"});var O=r(oe,2);he(O),O.__input=()=>{!e(_)&&e(n).length>0&&_e(!1)},O.__keydown=C,yt(O,D=>b(M,D),()=>e(M)),t(ee);var te=r(ee,2);te.__click=g;var je=a(te);{let D=Ee(()=>e(_)?"rotate-180":"");sa(je,{get class(){return`h-4 w-4 transition-transform ${e(D)??""}`}})}t(te);var Le=r(te,2);{var de=D=>{const Fe=Ee(()=>e(G)());var Ie=ns(),Re=a(Ie);{var Ce=qe=>{var Ae=rs(),we=r(Se(Ae),2);{var ze=Be=>{var be=as(),ye=a(be);ye.__click=()=>Y();var ve=a(ye);Lt(ve,{class:"h-4 w-4"});var ce=r(ve,4),w=a(ce);t(ce),t(ye),t(be),q(()=>{ye.disabled=i(),R(w,`"${e(n)??""}"`)}),d(Be,be)};E(we,Be=>{e(n).trim().length>0&&Be(ze)})}d(qe,Ae)},Ue=qe=>{var Ae=ls(),we=Se(Ae);Ge(we,19,()=>e(Fe),be=>be.u,(be,ye,ve)=>{var ce=ss();ce.__click=()=>fe(e(ye).u);var w=a(ce),k=a(w),j=a(k,!0);t(k),t(w),t(ce),q(()=>{Te(ce,"id",`ingredient-${e(ve)??""}`),V(ce,1,`hover:bg-base-200 flex w-full items-center gap-3 px-4 py-3 text-left hover:cursor-pointer ${e(ve)===e(f)?"bg-base-200":""}`),Te(ce,"aria-selected",e(ve)===e(f)),ce.disabled=i(),R(j,e(ye).n)}),vt("mouseenter",ce,()=>b(f,e(ve),!0)),d(be,ce)});var ze=r(we,2);{var Be=be=>{var ye=is(),ve=a(ye);ve.__click=()=>Y();var ce=a(ve);Lt(ce,{class:"h-4 w-4"}),xe(2),t(ve),t(ye),q(()=>ve.disabled=i()),d(be,ye)};E(ze,be=>{e(n).trim().length>0&&be(Be)})}d(qe,Ae)};E(Re,qe=>{e(Fe).length===0?qe(Ce):qe(Ue,!1)})}t(Ie),d(D,Ie)};E(Le,D=>{e(_)&&D(de)})}t($),t(T),yt(T,D=>b(h,D),()=>e(h)),t(X),t(P),q(()=>{V(ee,1,`input flex w-full items-center gap-2 pr-10 ${i()?"input-disabled":""}`),O.disabled=i(),Te(O,"aria-expanded",e(_)),Te(O,"aria-activedescendant",e(_)?`ingredient-${e(f)}`:void 0),te.disabled=i(),Te(te,"aria-label",e(_)?"Fermer le menu":"Ouvrir le menu")}),Qe(O,()=>e(n),D=>b(n,D)),d(v,P)};E(H,v=>{He.error?v(K):v(J,!1)},!0)}d(c,x)};E(W,c=>{He.loading?c(se):c(N,!1)})}var S=r(W,2);{var z=c=>{var x=tt(),H=Se(x);Ge(H,17,()=>Object.entries(e(me)()),([K,J])=>K,(K,J)=>{var v=Ee(()=>Ra(e(J),2));let P=()=>e(v)[0],X=()=>e(v)[1];const y=Ee(()=>$t(P())),B=Ee(()=>e(y).icon);var T=vs(),$=a(T),ee=a($),oe=a(ee);Ia(oe,()=>e(B),(de,D)=>{D(de,{class:"h-4 w-4"})});var O=r(oe),te=r(O),je=a(te,!0);t(te),t(ee);var Le=r(ee,2);Ge(Le,21,X,wt,(de,D,Fe)=>{const Ie=Ee(()=>ne(e(D)));var Re=cs(),Ce=a(Re),Ue=a(Ce),qe=a(Ue),Ae=a(qe),we=a(Ae),ze=a(we),Be=a(ze,!0);t(ze);var be=r(ze,2);be.__click=()=>A(e(D).uuid);var ye=a(be);da(ye,{class:"h-4 w-4"}),t(be),t(we);var ve=r(we,2),ce=a(ve),w=r(a(ce),2),k=a(w);he(k),t(w),t(ce);var j=r(ce,2),ie=r(a(j),2);ie.__change=()=>{e(D).originalUnit==="au goût"&&(e(D).originalQuantity=1)};var ke=a(ie);ke.value=ke.__value="kg";var Me=r(ke);Me.value=Me.__value="gr.";var Pe=r(Me);Pe.value=Pe.__value="unité";var Oe=r(Pe);Oe.value=Oe.__value="l.";var Ye=r(Oe);Ye.value=Ye.__value="ml";var it=r(Ye);it.value=it.__value="c. à soupe";var ft=r(it);ft.value=ft.__value="c. à café";var _t=r(ft);_t.value=_t.__value="pincées";var lt=r(_t);lt.value=lt.__value="tête·s";var Ze=r(lt);Ze.value=Ze.__value="gousse·s";var bt=r(Ze);bt.value=bt.__value="bottes";var $e=r(bt);$e.value=$e.__value="au goût",t(ie),t(j),t(ve);var nt=r(ve,2);{var gt=Ve=>{var mt=ds(),ht=a(mt,!0);t(mt),q(()=>R(ht,e(Ie))),d(Ve,mt)};E(nt,Ve=>{e(Ie)&&Ve(gt)})}t(Ae);var ot=r(Ae,2),dt=r(a(ot),2);he(dt),t(ot),t(qe),t(Ue),t(Ce),t(Re),q(()=>{R(Be,e(D).name),be.disabled=i(),k.disabled=e(D).originalUnit==="au goût",ie.disabled=i(),dt.disabled=i()}),vt("blur",k,()=>(e(D),void 0)),Qe(k,()=>e(D).originalQuantity,Ve=>e(D).originalQuantity=Ve),vt("blur",ie,()=>(e(D),void 0)),xt(ie,()=>e(D).originalUnit,Ve=>e(D).originalUnit=Ve),Qe(dt,()=>e(D).comment,Ve=>e(D).comment=Ve),aa(3,Re,()=>dr),d(de,Re)}),t(Le),t($),t(T),q(()=>{R(O,` ${e(y).displayName??""} `),R(je,X().length)}),d(K,T)}),d(c,x)};E(S,c=>{o().length>0&&c(z)})}t(Q);var F=r(Q,2);$r(F,{get initialName(){return e(pe)},onIngredientCreated:re,get open(){return e(le)},set open(c){b(le,c,!0)}}),d(l,Z),st()}at(["input","keydown","click","change"]);var fs=p('<label class="label"><span class="label-text font-medium"> </span></label>'),_s=p('<div class="border-base-200 bg-base-200 flex flex-wrap items-center gap-1 border-b p-1"><button type="button" title="Gras"><!></button> <button type="button" title="Italique"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" title="Liste à puces"><!></button> <button type="button" title="Liste ordonnée"><!></button> <div class="divider divider-horizontal mx-0 h-6"></div> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Annuler"><!></button> <button type="button" class="btn btn-ghost btn-square btn-sm" title="Rétablir"><!></button></div>'),bs=p('<div class="label"><span class="text-error"> </span></div>'),gs=p('<div class=" w-full"><!> <div><!> <div class="max-h-[calc(100vh-200px)] min-h-96 overflow-auto"></div></div> <!></div>');function ta(l,s){rt(s,!0);let o=De(s,"value",15);De(s,"placeholder",3,"Commencez à rédiger...");let i=ae(null),n=ae(null),f=ae(0),_=ae(!1);Ca(()=>{e(i)&&b(n,new vr({element:e(i),extensions:[ur.configure({codeBlock:!1,blockquote:!1}),pr.configure({html:!1,tightLists:!0})],content:o(),editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[150px] p-4"}},onUpdate:({editor:g})=>{const A=g.storage.markdown.getMarkdown();o()!==A&&o(A)},onSelectionUpdate:()=>{ut(f)},onTransaction:()=>{ut(f)},onFocus:()=>b(_,!0),onBlur:()=>b(_,!1)}),!0)}),za(()=>{e(n)&&e(n).destroy()});var L=gs(),h=a(L);{var M=g=>{var A=fs(),C=a(A),ne=a(C,!0);t(C),t(A),q(()=>{Te(A,"for",s.id),R(ne,s.label)}),d(g,A)};E(h,g=>{s.label&&g(M)})}var le=r(h,2);let pe;var G=a(le);{var me=g=>{var A=_s(),C=a(A);let ne;C.__click=()=>e(n).chain().focus().toggleBold().run();var ge=a(C);Xa(ge,{class:"h-4 w-4"}),t(C);var Y=r(C,2);let re;Y.__click=()=>e(n).chain().focus().toggleItalic().run();var Z=a(Y);Ya(Z,{class:"h-4 w-4"}),t(Y);var Q=r(Y,4);let W;Q.__click=()=>e(n).chain().focus().toggleBulletList().run();var se=a(Q);Za(se,{class:"h-4 w-4"}),t(Q);var N=r(Q,2);let S;N.__click=()=>e(n).chain().focus().toggleOrderedList().run();var z=a(N);$a(z,{class:"h-4 w-4"}),t(N);var F=r(N,4);F.__click=()=>e(n).chain().focus().undo().run();var c=a(F);er(c,{class:"h-4 w-4"}),t(F);var x=r(F,2);x.__click=()=>e(n).chain().focus().redo().run();var H=a(x);tr(H,{class:"h-4 w-4"}),t(x),t(A),q((K,J,v,P,X,y)=>{ne=V(C,1,"btn btn-ghost btn-square btn-sm",null,ne,K),re=V(Y,1,"btn btn-ghost btn-square btn-sm",null,re,J),W=V(Q,1,"btn btn-ghost btn-square btn-sm",null,W,v),S=V(N,1,"btn btn-ghost btn-square btn-sm",null,S,P),F.disabled=X,x.disabled=y},[()=>({"btn-active":e(f)>=0&&e(n).isActive("bold")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("italic")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("bulletList")}),()=>({"btn-active":e(f)>=0&&e(n).isActive("orderedList")}),()=>!(e(f)>=0&&e(n).can().undo()),()=>!(e(f)>=0&&e(n).can().redo())]),d(g,A)};E(G,g=>{e(n)&&g(me)})}var fe=r(G,2);yt(fe,g=>b(i,g),()=>e(i)),t(le);var _e=r(le,2);{var I=g=>{var A=bs(),C=a(A),ne=a(C,!0);t(C),t(A),q(()=>R(ne,s.error)),d(g,A)};E(_e,g=>{s.error&&g(I)})}t(L),q(()=>{pe=V(le,1,"bg-base-100 overflow-hidden rounded-lg border-2 transition-all",null,pe,{"border-primary":e(_),"border-error":s.error,"border-base-300":!e(_)&&!s.error}),Te(fe,"id",s.id)}),d(l,L),st()}at(["click"]);var ms=p('<div class="alert alert-error mt-4"><span class="text-sm"> </span></div>'),hs=p('<p class="py-2 text-sm italic opacity-50">Aucune astuce ajoutée</p>'),xs=p('<span class="text-error text-xs"> </span>'),ys=p("<span></span>"),ws=p(`<div class="flex flex-col gap-1"><div class="flex items-start gap-2"><div class="flex-1"><textarea placeholder="Ex: Ajouter un filet d'huile d'olive au moment de servir" maxlength="250"></textarea></div> <button type="button" class="btn btn-square btn-sm text-error" title="Supprimer l'astuce"><!></button></div> <div class="flex justify-between px-1"><!> <span> </span></div></div>`),ks=p('<div class="space-y-3"></div>'),Es=p(`<div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><div class="card-body"><h2 class="card-title mb-4"><!> Ingrédients</h2> <!> <!></div></div> <div class="card bg-base-100 shadow-xl"><div class="card-body"><h2 class="card-title mb-4"><!> Préparation</h2> <div class="space-y-6"><div class="max-h-dvh"><!></div> <div><div class="max-h-dvh"><!></div> <p class="text-end text-xs italic opacity-60">La préparation à l'avance sera mise en évidence au dessus des autres
            étapes.</p></div></div> <div class="divider"></div> <div class="space-y-4"><div class="flex items-center justify-between"><h3 class="flex items-center gap-2 font-semibold"><!> Astuces et conseils</h3> <button type="button" class="btn btn-outline btn-primary btn-sm">+ Ajouter une astuce</button></div> <!></div></div></div></div>`);function Ys(l,s){rt(s,!0);let o=De(s,"recipe",15);var i=Es(),n=a(i),f=a(n),_=a(f),L=a(_);la(L,{class:"h-5 w-4"}),xe(),t(_);var h=r(_,2);{let S=Ee(()=>!s.canEdit);ps(h,{get disabled(){return e(S)},get ingredients(){return o().ingredients},set ingredients(z){o(o().ingredients=z,!0)}})}var M=r(h,2);{var le=S=>{var z=ms(),F=a(z),c=a(F,!0);t(F),t(z),q(()=>R(c,s.validationErrors.ingredients)),d(S,z)};E(M,S=>{s.validationErrors.ingredients&&o().ingredients.length===0&&S(le)})}t(f),t(n);var pe=r(n,2),G=a(pe),me=a(G),fe=a(me);na(fe,{class:"h-5 w-4"}),xe(),t(me);var _e=r(me,2),I=a(_e),g=a(I);ta(g,{id:"recipe-preparation",label:"Instructions de préparation",get error(){return s.validationErrors.preparation},placeholder:"Décrivez les étapes de préparation...",get value(){return o().preparation},set value(S){o(o().preparation=S,!0)}}),t(I);var A=r(I,2),C=a(A),ne=a(C);ta(ne,{id:"recipe-preparation24h",label:"Préparation à l'avance (optionnel)",get error(){return s.validationErrors.preparation24h},placeholder:"Étapes à réaliser avant le jour j...",get value(){return o().preparation24h},set value(S){o(o().preparation24h=S,!0)}}),t(C),xe(2),t(A),t(_e);var ge=r(_e,4),Y=a(ge),re=a(Y),Z=a(re);ar(Z,{class:"text-warning h-4 w-4"}),xe(),t(re);var Q=r(re,2);Q.__click=()=>{o(o().astuces=[...o().astuces,{astuce:""}],!0)},t(Y);var W=r(Y,2);{var se=S=>{var z=hs();d(S,z)},N=S=>{var z=ks();Ge(z,21,()=>o().astuces,wt,(F,c,x)=>{var H=ws(),K=a(H),J=a(K),v=a(J);Pa(v),t(J);var P=r(J,2);P.__click=()=>{o(o().astuces=o().astuces.filter((O,te)=>te!==x),!0)};var X=a(P);da(X,{size:14}),t(P),t(K);var y=r(K,2),B=a(y);{var T=O=>{var te=xs(),je=a(te,!0);t(te),q(()=>R(je,s.validationErrors.astuces[x])),d(O,te)},$=O=>{var te=ys();d(O,te)};E(B,O=>{s.validationErrors.astuces?.[x]?O(T):O($,!1)})}var ee=r(B,2),oe=a(ee);t(ee),t(y),t(H),q(()=>{v.disabled=!s.canEdit,V(v,1,`textarea textarea-bordered h-20 w-full text-sm ${s.validationErrors.astuces?.[x]?"textarea-error":""}`),P.disabled=!s.canEdit,V(ee,1,`text-xs ${e(c).astuce.length>250?"text-error font-bold":"opacity-50"}`),R(oe,`${e(c).astuce.length??""} / 250`)}),Qe(v,()=>e(c).astuce,O=>e(c).astuce=O),d(F,H)}),t(z),d(S,z)};E(W,S=>{o().astuces.length===0?S(se):S(N,!1)})}t(ge),t(G),t(pe),t(i),q(()=>{V(n,1,`card bg-base-100 shadow-xl ${s.validationErrors.ingredients?"ring-error ring-2":""}`),Q.disabled=!s.canEdit}),d(l,i),st()}at(["click"]);var qs=p('<button class="btn btn-circle btn-xs btn-error btn-ghost ms-2" title="Retirer les droits"><!></button>'),As=p('<div class="badge badge-lg badge-soft gap-2 p-4"><span> </span> <!></div>'),Ss=p('<button class="btn btn-primary btn-sm btn-outline ms-4" title="Gérer les collaborateurs"><!> Ajouter des contributeur·ices</button>'),Ls=p(`<div class="space-y-4"><div class="alert alert-info alert-soft border-info/20 max-md:alert-vertical text-xs"><!> <span>Par défaut, seul l'auteur·ice peut modifier la recette. Les autres
        utilisateur·ices peuvent la consulter ou la dupliquer pour créer leur
        propre version. Ajoutez des collaborateur·ices ici pour leur donner
        explicitement le droit de modifier cette version originale.</span></div> <div class="flex flex-wrap gap-2"><div class="badge badge-lg badge-soft badge-info gap-2 p-4"><!> <span> </span> <div class="badge badge-xs">Auteur</div></div> <!> <!></div></div>`),Is=p('<span class="loading loading-spinner loading-xs"></span>'),Rs=p('<p class="text-error mt-2 flex items-center gap-1 text-xs"><!> </p>'),Cs=p('<p class="text-xs opacity-60">Sélectionnez des membres de vos équipes pour les ajouter :</p> <div class="max-h-48 overflow-y-auto pr-2"><!></div>',1),zs=p(`<p class="py-4 text-center text-sm italic opacity-40">Vous n'avez pas encore d'équipe créée.</p>`),Ps=p('<p class="py-4 text-center text-sm italic opacity-40">Tous les membres de vos équipes sont déjà ajoutés.</p>'),Ts=p('<div class="space-y-6"><fieldset class="fieldset"><legend class="fieldset-legend">Ajouter par email</legend> <div class="flex gap-2"><label class="input input-bordered flex grow items-center gap-2"><!> <input type="email" class="grow" placeholder="utilisateur@email.com"/></label> <button class="btn btn-primary"><!></button></div> <!></fieldset> <div class="divider text-xs font-bold tracking-widest uppercase opacity-50">Ou via vos équipes</div> <div class="space-y-4"><!></div></div>'),Ds=p('<button class="btn btn-block btn-primary">Terminer</button>'),js=p("<!> <!> <!>",1),Fs=p("<!> <!>",1);function Zs(l,s){rt(s,!0);let o=De(s,"permissionWrite",15),i=ae(!1),n=ae(""),f=ae(!1),_=ae(null),L=It({});Xe(()=>{s.createdBy===pt.userId&&(L[s.createdBy]=pt.userName||"Propriétaire");for(const I of Qt.teams)if(I.members)for(const g of I.members)g.name&&!L[g.id]&&(L[g.id]=g.name)});let h=Ee(()=>{const I=[];for(const g of Qt.teams)if(g.members)for(const A of g.members)A.id!==s.createdBy&&(I.some(C=>C.id===A.id)||I.push({id:A.id,label:A.name,selected:!1}));return I});async function M(){if(!e(n))return;const I=e(n).trim();b(f,!0),b(_,null);try{const{checkUserEmails:g}=await Da(async()=>{const{checkUserEmails:ne}=await import("./appwrite.js").then(ge=>ge.b8);return{checkUserEmails:ne}},[]),C=(await g([I]))[I];C?o()?.includes(C.id)?b(_,"Cet utilisateur a déjà les droits d'écriture."):(o([...o()||[],C.id]),L[C.id]=C.name||I,b(n,""),Ke.success(`Permission d'édition ajouté pour ${C.name||I}`)):b(_,"Utilisateur introuvable. Seuls les utilisateur·ices inscrit sur enka-cookbook peuvent être ajouté·es. Vous pouvez invitez des personnes depuis votre dashboard")}catch(g){console.error("Erreur check email:",g),b(_,"Erreur lors de la vérification de l'email.")}finally{b(f,!1)}}function le(I){o()?.includes(I)?o((o()||[]).filter(g=>g!==I)):o([...o()||[],I])}function pe(I){I!==s.createdBy&&o((o()||[]).filter(g=>g!==I))}function G(){b(i,!1),b(n,""),b(_,null)}var me=Fs(),fe=Se(me);fr(fe,{get iconComponent(){return ir},legend:"Permissions",children:(I,g)=>{var A=Ls(),C=a(A),ne=a(C);rr(ne,{size:16}),xe(2),t(C);var ge=r(C,2),Y=a(ge),re=a(Y);sr(re,{size:14});var Z=r(re,2),Q=a(Z,!0);t(Z),xe(2),t(Y);var W=r(Y,2);Ge(W,17,()=>(o()||[]).filter(S=>s.createdBy!==void 0&&S!==s.createdBy),wt,(S,z)=>{var F=As(),c=a(F),x=a(c,!0);t(c);var H=r(c,2);{var K=J=>{var v=qs();v.__click=()=>pe(e(z));var P=a(v);ia(P,{size:16}),t(v),d(J,v)};E(H,J=>{s.canEdit&&J(K)})}t(F),q(()=>R(x,L[e(z)]||e(z))),aa(3,F,()=>cr,()=>({duration:200})),d(S,F)});var se=r(W,2);{var N=S=>{var z=Ss();z.__click=()=>b(i,!0);var F=a(z);lr(F,{size:18}),xe(),t(z),d(S,z)};E(se,S=>{s.canEdit&&S(N)})}t(ge),t(A),q(()=>R(Q,s.createdBy&&L[s.createdBy]||"Propriétaire")),d(I,A)},$$slots:{default:!0}});var _e=r(fe,2);ca(_e,{get isOpen(){return e(i)},onClose:G,children:(I,g)=>{var A=js(),C=Se(A);va(C,{title:"Gérer les collaborateurs",onClose:G});var ne=r(C,2);ua(ne,{children:(Y,re)=>{var Z=Ts(),Q=a(Z),W=r(a(Q),2),se=a(W),N=a(se);nr(N,{class:"opacity-40",size:18});var S=r(N,2);he(S),S.__keydown=y=>y.key==="Enter"&&M(),t(se);var z=r(se,2);z.__click=M;var F=a(z);{var c=y=>{var B=Is();d(y,B)},x=y=>{var B=Ta("Ajouter");d(y,B)};E(F,y=>{e(f)?y(c):y(x,!1)})}t(z),t(W);var H=r(W,2);{var K=y=>{var B=Rs(),T=a(B);or(T,{size:14});var $=r(T);t(B),q(()=>R($,` ${e(_)??""}`)),d(y,B)};E(H,y=>{e(_)&&y(K)})}t(Q);var J=r(Q,4),v=a(J);{var P=y=>{var B=Cs(),T=r(Se(B),2),$=a(T);_r($,{get items(){return e(h)},onToggleItem:le,size:"sm"}),t(T),d(y,B)},X=y=>{var B=tt(),T=Se(B);{var $=oe=>{var O=zs();d(oe,O)},ee=oe=>{var O=Ps();d(oe,O)};E(T,oe=>{Qt.teams.length===0?oe($):oe(ee,!1)},!0)}d(y,B)};E(v,y=>{e(h).length>0?y(P):y(X,!1)})}t(J),t(Z),q(()=>z.disabled=e(f)||!e(n)),Qe(S,()=>e(n),y=>b(n,y)),d(Y,Z)}});var ge=r(ne,2);pa(ge,{children:(Y,re)=>{var Z=Ds();Z.__click=G,d(Y,Z)}}),d(I,A)},$$slots:{default:!0}}),d(l,me),st()}at(["click","keydown"]);const Bs=["title","description","plate","preparation","preparation24h","cuisson","serveHot","typeR","categories","regime","saison","ingredients","quantite_desc","auteur","astuces","prepAlt","check","draft","permissionWrite","materiel","region","rootRecipeId","versionLabel","manuallyAddedVariants","variantsToRemove"];function $s(){return{title:"",plate:100,ingredients:[],preparation:"",materiel:[],preparation24h:"",astuces:[],categories:[],saison:[],typeR:"",cuisson:"",serveHot:"",regime:[],description:"",quantite_desc:"",region:"",prepAlt:[],check:null,draft:!0,lockedBy:null,auteur:null,publishedAt:null,createdBy:pt.userId||"",permissionWrite:[pt.userId||""],teams:null,status:ja.PUBLIC,rootRecipeId:null,versionLabel:null,manuallyAddedVariants:[],variantsToRemove:[]}}function ei(l,s={}){return{...l,...s,categories:l.categories||[],saison:l.saison||[],ingredients:l.ingredients??[],astuces:l.astuces??[],prepAlt:l.prepAlt||[],materiel:l.materiel||[],regime:l.regime||[],check:l.check??null}}function ti(l){const s={};return Bs.forEach(o=>{s[o]=l[o]}),JSON.stringify(s)}function ai(l){return{title:l.title,plate:l.plate,preparation:l.preparation,cuisson:l.cuisson===""?!1:l.cuisson,serveHot:l.serveHot===""?!0:l.serveHot,check:l.check??!1,typeR:l.typeR,permissionWrite:l.permissionWrite&&l.permissionWrite.length>0?l.permissionWrite:[pt.userId],draft:l.draft??!0,categories:l.categories||[],regime:l.regime||[],saison:l.saison||[],materiel:l.materiel||[],quantite_desc:l.quantite_desc||null,description:l.description||null,region:l.region||null,auteur:l.auteur||null,preparation24h:l.preparation24h||null,teams:l.teams||null,status:l.status||"private",ingredients:[],astuces:null,prepAlt:null,lockedBy:null,publishedAt:null,rootRecipeId:l.rootRecipeId||null,versionLabel:l.versionLabel||null}}function ri(l,s,o){const i={...s,ingredients:l.ingredients,id:o.id,createdAt:o.createdAt,updatedAt:o.updatedAt,createdBy:o.createdBy};return delete i.$id,delete i.$createdAt,delete i.$updatedAt,i}function Os(l){if(!l.originalQuantity||l.originalQuantity<=0)return{...l,normalizedQuantity:0,normalizedUnit:l.originalUnit||"gr."};const s=ra.normalize(l.originalQuantity,l.originalUnit||"",l.name);return{...l,normalizedQuantity:s.quantity,normalizedUnit:s.unit}}function Us(l){return l.map(s=>Os(s))}function Ms(l){const s=new Ba;let o=!1;l.forEach(f=>{f.allergens&&f.allergens.length>0&&f.allergens.forEach(_=>s.add(_)),f.type==="animaux"&&(o=!0)});const i=Array.from(s);(i.includes("Viande")||i.includes("Poisson")||i.includes("Crustacé")||i.includes("Mollusque")||i.includes("Porc"))&&(o=!0);const n=[];return!o&&!i.includes("Produit laitier")&&!i.includes("Oeuf")?n.push("vegan"):o||n.push("vegetarien"),i.includes("Gluten")||n.push("sans-gluten"),i.includes("Produit laitier")||n.push("sans-lactose"),{regimes:n}}function si(l,s){if(!l)return!1;s.value={};let o=!1;if(!l.title?.trim())s.value.title="Le titre est obligatoire",o=!0;else if(l.title.length>100)s.value.title="Le titre ne peut pas dépasser 100 caractères",o=!0;else if(!/^[a-zA-Z0-9\s\-àâäéèêëïîôùûüçÀÂÄÉÈÊËÏÎÔÙÛÜÇ]+$/.test(l.title.trim()))s.value.title="Le titre ne peut contenir que des lettres, chiffres, espaces et tirets",o=!0;else{const n=l.title.trim().toLowerCase(),f=l.versionLabel?.trim().toLowerCase()||"";Fa.recipesIndex.find(L=>{const h=L.title.trim().toLowerCase()===n,M=L.versionLabel?.trim().toLowerCase()||"";return h&&f===M&&L.$id!==l.$id})&&(s.value.title=l.versionLabel?"Une recette avec ce nom et cette version existe déjà":"Une recette porte déjà ce nom (sans version)",o=!0)}if(l.versionLabel&&(/^[a-zA-Z0-9\s\-]+$/.test(l.versionLabel.trim())||(s.value.versionLabel="La version ne peut contenir que des caractères alphanumériques, des espaces et des tirets",o=!0)),l.typeR||(s.value.typeR="Le type de recette est obligatoire",o=!0),(l.cuisson===null||l.cuisson===void 0)&&(s.value.cuisson="Veuillez spécifier si une cuisson est nécessaire",o=!0),(l.serveHot===null||l.serveHot===void 0)&&(s.value.serveHot="Veuillez spécifier la température de service",o=!0),!l.plate||l.plate<1?(s.value.plate="Le nombre de couverts doit être d'au moins 1",o=!0):l.plate>1e4&&(s.value.plate="Le nombre de couverts ne peut pas dépasser 10 000",o=!0),l.quantite_desc&&l.quantite_desc.length>100&&(s.value.quantite_desc="La description des quantités ne peut pas dépasser 100 caractères",o=!0),l.description&&l.description.length>200&&(s.value.description="La description ne peut pas dépasser 200 caractères",o=!0),l.region&&l.region.length>50&&(s.value.region="La spécialité ne peut pas dépasser 50 caractères",o=!0),(!l.ingredients||l.ingredients.length===0)&&(s.value.ingredients="Au moins un ingrédient est requis",o=!0),l.preparation?.trim()?l.preparation.length>15e3&&(s.value.preparation="La préparation ne peut pas dépasser 15 000 caractères",o=!0):(s.value.preparation="La préparation est obligatoire",o=!0),l.preparation24h&&l.preparation24h.length>15e3&&(s.value.preparation24h="La préparation 24h ne peut pas dépasser 15 000 caractères",o=!0),(l.check===null||l.check===void 0)&&(s.value.check="Veuillez indiquer si la recette a été testée",o=!0),l.astuces&&l.astuces.length>0){const n=[];l.astuces.forEach((f,_)=>{f.astuce.length>250&&(n[_]="Maximum 250 caractères",o=!0)}),n.length>0&&(s.value.astuces=n)}o&&(Ke.error("Veuillez corriger les champs invalides",{autoCloseDelay:5e3}),setTimeout(()=>{const n=Object.keys(s.value)[0],_={title:"recipe-title",typeR:"recipe-type",cuisson:"recipe-cuisson",serveHot:"recipe-servehot",plate:"recipe-plate",quantite_desc:"recipe-quantite-desc",description:"description",region:"recipe-region",check:"recipe-check-fieldset",ingredients:"recipe-ingredients-editor",preparation:"recipe-preparation",preparation24h:"recipe-preparation24h"}[n];if(_){const L=document.getElementById(_);L&&(L.scrollIntoView({behavior:"smooth",block:"center"}),(L.tagName==="INPUT"||L.tagName==="SELECT"||L.tagName==="TEXTAREA")&&L.focus())}},100)),l.title=l.title.trim().charAt(0).toUpperCase()+l.title.trim().slice(1).toLowerCase(),l.ingredients=Us(l.ingredients);const{regimes:i}=Ms(l.ingredients);return l.regime=i,!o}async function ii(l,s){const o=Ke.loading("Suppression de la recette...");try{await Oa(l);try{await Ua("delete_recipe",l,pt.userId||"",{},!0)}catch(i){console.warn("Sync GitHub échouée lors de la suppression:",i)}s&&await s(),Ke.update(o,{state:"success",message:"Recette supprimée avec succès"})}catch(i){throw console.error("Erreur suppression:",i),Ke.update(o,{state:"error",message:"Erreur lors de la suppression"}),i}finally{setTimeout(()=>Ke.dismiss(o),3e3)}}export{Xs as R,ti as a,Ys as b,$s as c,Zs as d,Ms as e,ii as f,ai as n,ri as p,ei as t,si as v};
