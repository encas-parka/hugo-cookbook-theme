const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage.js","assets/index.js","assets/icons.js","assets/index.css","assets/index2.js","assets/legacy.js","assets/EmailVerificationAlert.js","assets/HomePage.css","assets/VerifyEmailPage.js","assets/RecipesListPage.js","assets/Fieldset.js","assets/AutocompleteInput.js","assets/keyboardNavigation.svelte.js","assets/BadgeList.js","assets/CheckboxBadge.js","assets/RecipeRegimeBadges.js","assets/LeftPanel.js","assets/RecipeDataStore.svelte.js","assets/RecipeDetailPage.js","assets/RecipePreparation.js","assets/products-display.js","assets/SvelteMarkdown.js","assets/SvelteMarkdown.css","assets/RecipeMetadata.js","assets/AcceptInvite.js","assets/ResetPassword.js","assets/ResetPassword.css","assets/DashboardPage.js","assets/date-helpers.js","assets/CreateTeamModal.js","assets/ConfirmModal.js","assets/InfoCollapse.js","assets/EventCard.js","assets/event-stats-helpers.js","assets/DocCard.js","assets/TeamsManagement.js","assets/EventCreatePage.js","assets/EventMealCard.js","assets/MaterielPage.js","assets/LoansPage.js","assets/BtnGroupCheck.js","assets/LoanReturnPage.js","assets/RecipeCreatePage.js","assets/RecipeEditPage2.js","assets/tiptap-markdown.es.js","assets/RecipeEditPage.css","assets/UnsavedChangesGuard.js","assets/RecipeEditPage.js","assets/EventListPage.js","assets/CreateDocumentPage.js","assets/MarkdownEditorAdvanced.js","assets/MarkdownEditorAdvanced.css","assets/CreateDocumentPage.css","assets/EditDocumentPage.js","assets/EditDocumentPage.css","assets/DocumentListPage.js","assets/EventEditPage.js","assets/EventInvitationAlert.js","assets/EventStats.js","assets/EventRecipesPage.js","assets/EventRecipesPage.css","assets/EventProductsPage.js","assets/EventProductsPage.css","assets/EventPosterPage.js","assets/NotFoundPage.js"])))=>i.map(i=>d[i]);
var Ud=Object.defineProperty;var Od=Object.getPrototypeOf;var Bd=Reflect.get;var ec=t=>{throw TypeError(t)};var xd=(t,e,r)=>e in t?Ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var C=(t,e,r)=>xd(t,typeof e!="symbol"?e+"":e,r),ji=(t,e,r)=>e.has(t)||ec("Cannot "+r);var i=(t,e,r)=>(ji(t,e,"read from private field"),r?r.call(t):e.get(t)),y=(t,e,r)=>e.has(t)?ec("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),_=(t,e,r,s)=>(ji(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),b=(t,e,r)=>(ji(t,e,"access private method"),r);var tc=(t,e,r)=>Bd(Od(t),r,e);var _i=Array.isArray,Hd=Array.prototype.indexOf,Ri=Array.from,Vd=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,fl=Object.getOwnPropertyDescriptors,hl=Object.prototype,Wd=Array.prototype,Pi=Object.getPrototypeOf,rc=Object.isExtensible;function Es(t){return typeof t=="function"}const cn=()=>{};function Gd(t){return t()}function Ki(t){for(var e=0;e<t.length;e++)t[e]()}function pl(){var t,e,r=new Promise((s,n)=>{t=s,e=n});return{promise:r,resolve:t,reject:e}}function Bg(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const r=[];for(const s of t)if(r.push(s),r.length===e)break;return r}const $e=2,Za=4,ha=8,go=1<<24,Vt=16,fr=32,xr=64,yo=128,dt=512,Le=1024,Xe=2048,hr=4096,nt=8192,cr=16384,pa=32768,Ot=65536,sc=1<<17,ml=1<<18,hs=1<<19,gl=1<<20,or=1<<25,ds=32768,Yi=1<<21,wo=1<<22,Nr=1<<23,Ut=Symbol("$state"),yl=Symbol("legacy props"),Qd=Symbol(""),_s=new class extends Error{constructor(){super(...arguments);C(this,"name","StaleReactionError");C(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},Jd=1,Di=3,en=8;function wl(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Kd(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Yd(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Xd(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Zd(t){throw new Error("https://svelte.dev/e/effect_orphan")}function zd(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Fd(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function ef(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function tf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function rf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function sf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const nf=1,af=2,vl=4,of=8,cf=16,lf=1,uf=2,df=4,ff=8,hf=16,pf=1,mf=2,gf=4,yf=1,wf=2,vf="[",Mi="[!",vo="]",ma={},_e=Symbol(),bf="http://www.w3.org/1999/xhtml",Ef="http://www.w3.org/2000/svg",Sf="@attach";function ga(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function If(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Af(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let k=!1;function St(t){k=t}let X;function Pe(t){if(t===null)throw ga(),ma;return X=t}function Bt(){return Pe(Wt(X))}function _f(t){if(k){if(Wt(X)!==null)throw ga(),ma;X=t}}function Rf(t=1){if(k){for(var e=t,r=X;e--;)r=Wt(r);X=r}}function za(t=!0){for(var e=0,r=X;;){if(r.nodeType===en){var s=r.data;if(s===vo){if(e===0)return r;e-=1}else(s===vf||s===Mi)&&(e+=1)}var n=Wt(r);t&&r.remove(),r=n}}function bl(t){if(!t||t.nodeType!==en)throw ga(),ma;return t.data}function El(t){return t===this.v}function Pf(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Sl(t){return!Pf(t,this.v)}let tn=!1;function Hg(){tn=!0}const Df=[];function Ss(t,e=!1,r=!1){return Ua(t,new Map,"",Df,null,r)}function Ua(t,e,r,s,n=null,a=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(_i(t)){var c=Array(t.length);e.set(t,c),n!==null&&e.set(n,c);for(var l=0;l<t.length;l+=1){var u=t[l];l in t&&(c[l]=Ua(u,e,r,s,null,a))}return c}if(Pi(t)===hl){c={},e.set(t,c),n!==null&&e.set(n,c);for(var d in t)c[d]=Ua(t[d],e,r,s,null,a);return c}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!a)return Ua(t.toJSON(),e,r,s,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let ye=null;function Ys(t){ye=t}function bo(t,e=!1,r){ye={p:ye,i:!1,c:null,e:null,s:t,x:null,l:tn&&!e?{s:null,u:null,$:[]}:null}}function Eo(t){var e=ye,r=e.e;if(r!==null){e.e=null;for(var s of r)Jl(s)}return t!==void 0&&(e.x=t),e.i=!0,ye=e.p,t??{}}function rn(){return!tn||ye!==null&&ye.l===null}let Gr=[];function Il(){var t=Gr;Gr=[],Ki(t)}function At(t){if(Gr.length===0&&!wn){var e=Gr;queueMicrotask(()=>{e===Gr&&Il()})}Gr.push(t)}function Mf(){for(;Gr.length>0;)Il()}function Al(t){var e=Z;if(e===null)return Y.f|=Nr,t;if((e.f&pa)===0){if((e.f&yo)===0)throw t;e.b.error(t)}else Xs(t,e)}function Xs(t,e){for(;e!==null;){if((e.f&yo)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const $f=-7169;function Me(t,e){t.f=t.f&$f|e}function So(t){(t.f&dt)!==0||t.deps===null?Me(t,Le):Me(t,hr)}function _l(t){if(t!==null)for(const e of t)(e.f&$e)===0||(e.f&ds)===0||(e.f^=ds,_l(e.deps))}function Rl(t,e,r){(t.f&Xe)!==0?e.add(t):(t.f&hr)!==0&&r.add(t),_l(t.deps),Me(t,Le)}const Ma=new Set;let ee=null,yn=null,vt=null,ct=[],$i=null,Xi=!1,wn=!1;var Rs,Ps,Kr,Yr,An,Ds,Ms,pt,Zi,zi,Pl,Dl;const ui=class ui{constructor(){y(this,pt);C(this,"committed",!1);C(this,"current",new Map);C(this,"previous",new Map);y(this,Rs,new Set);y(this,Ps,new Set);y(this,Kr,0);y(this,Yr,0);y(this,An,null);y(this,Ds,new Set);y(this,Ms,new Set);C(this,"skipped_effects",new Set);C(this,"is_fork",!1)}is_deferred(){return this.is_fork||i(this,Yr)>0}process(e){ct=[],yn=null,this.apply();var r=[],s=[];for(const n of e)b(this,pt,Zi).call(this,n,r,s);this.is_fork||b(this,pt,Pl).call(this),this.is_deferred()?(b(this,pt,zi).call(this,s),b(this,pt,zi).call(this,r)):(yn=this,ee=null,nc(s),nc(r),yn=null,i(this,An)?.resolve()),vt=null}capture(e,r){r!==_e&&!this.previous.has(e)&&this.previous.set(e,r),(e.f&Nr)===0&&(this.current.set(e,e.v),vt?.set(e,e.v))}activate(){ee=this,this.apply()}deactivate(){ee===this&&(ee=null,vt=null)}flush(){if(this.activate(),ct.length>0){if(Ml(),ee!==null&&ee!==this)return}else i(this,Kr)===0&&this.process([]);this.deactivate()}discard(){for(const e of i(this,Ps))e(this);i(this,Ps).clear()}increment(e){_(this,Kr,i(this,Kr)+1),e&&_(this,Yr,i(this,Yr)+1)}decrement(e){_(this,Kr,i(this,Kr)-1),e&&_(this,Yr,i(this,Yr)-1),this.revive()}revive(){for(const e of i(this,Ds))i(this,Ms).delete(e),Me(e,Xe),ur(e);for(const e of i(this,Ms))Me(e,hr),ur(e);this.flush()}oncommit(e){i(this,Rs).add(e)}ondiscard(e){i(this,Ps).add(e)}settled(){return(i(this,An)??_(this,An,pl())).promise}static ensure(){if(ee===null){const e=ee=new ui;Ma.add(ee),wn||ui.enqueue(()=>{ee===e&&e.flush()})}return ee}static enqueue(e){At(e)}apply(){}};Rs=new WeakMap,Ps=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,An=new WeakMap,Ds=new WeakMap,Ms=new WeakMap,pt=new WeakSet,Zi=function(e,r,s){e.f^=Le;for(var n=e.first,a=null;n!==null;){var o=n.f,c=(o&(fr|xr))!==0,l=c&&(o&Le)!==0,u=l||(o&nt)!==0||this.skipped_effects.has(n);if(!u&&n.fn!==null){c?n.f^=Le:a!==null&&(o&(Za|ha|go))!==0?a.b.defer_effect(n):(o&Za)!==0?r.push(n):Ea(n)&&((o&Vt)!==0&&i(this,Ds).add(n),En(n));var d=n.first;if(d!==null){n=d;continue}}var h=n.parent;for(n=n.next;n===null&&h!==null;)h===a&&(a=null),n=h.next,h=h.parent}},zi=function(e){for(var r=0;r<e.length;r+=1)Rl(e[r],i(this,Ds),i(this,Ms))},Pl=function(){if(i(this,Yr)===0){for(const e of i(this,Rs))e();i(this,Rs).clear()}i(this,Kr)===0&&b(this,pt,Dl).call(this)},Dl=function(){var n;if(Ma.size>1){this.previous.clear();var e=vt,r=!0;for(const a of Ma){if(a===this){r=!1;continue}const o=[];for(const[l,u]of this.current){if(a.current.has(l))if(r&&u!==a.current.get(l))a.current.set(l,u);else continue;o.push(l)}if(o.length===0)continue;const c=[...a.current.keys()].filter(l=>!this.current.has(l));if(c.length>0){var s=ct;ct=[];const l=new Set,u=new Map;for(const d of o)$l(d,c,l,u);if(ct.length>0){ee=a,a.apply();for(const d of ct)b(n=a,pt,Zi).call(n,d,[],[]);a.deactivate()}ct=s}}ee=null,vt=e}this.committed=!0,Ma.delete(this)};let qt=ui;function kf(t){var e=wn;wn=!0;try{for(var r;;){if(Mf(),ct.length===0&&(ee?.flush(),ct.length===0))return $i=null,r;Ml()}}finally{wn=e}}function Ml(){var t=us;Xi=!0;var e=null;try{var r=0;for(ei(!0);ct.length>0;){var s=qt.ensure();if(r++>1e3){var n,a;Cf()}s.process(ct),Lr.clear()}}finally{Xi=!1,ei(t),$i=null}}function Cf(){try{zd()}catch(t){Xs(t,$i)}}let Kt=null;function nc(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var s=t[r++];if((s.f&(cr|nt))===0&&Ea(s)&&(Kt=new Set,En(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?Fl(s):s.fn=null),Kt?.size>0)){Lr.clear();for(const n of Kt){if((n.f&(cr|nt))!==0)continue;const a=[n];let o=n.parent;for(;o!==null;)Kt.has(o)&&(Kt.delete(o),a.push(o)),o=o.parent;for(let c=a.length-1;c>=0;c--){const l=a[c];(l.f&(cr|nt))===0&&En(l)}}Kt.clear()}}Kt=null}}function $l(t,e,r,s){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const n of t.reactions){const a=n.f;(a&$e)!==0?$l(n,e,r,s):(a&(wo|Vt))!==0&&(a&Xe)===0&&kl(n,e,s)&&(Me(n,Xe),ur(n))}}function kl(t,e,r){const s=r.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const n of t.deps){if(e.includes(n))return!0;if((n.f&$e)!==0&&kl(n,e,r))return r.set(n,!0),!0}return r.set(t,!1),!1}function ur(t){for(var e=$i=t;e.parent!==null;){e=e.parent;var r=e.f;if(Xi&&e===Z&&(r&Vt)!==0&&(r&ml)===0)return;if((r&(xr|fr))!==0){if((r&Le)===0)return;e.f^=Le}}ct.push(e)}function Io(t){let e=0,r=dr(0),s;return()=>{Ro()&&(f(r),ba(()=>(e===0&&(s=pr(()=>t(()=>Re(r)))),e+=1,()=>{At(()=>{e-=1,e===0&&(s?.(),s=void 0,Re(r))})})))}}var Tf=Ot|hs|yo;function Nf(t,e,r){new Lf(t,e,r)}var ze,_n,Rt,Xr,Pt,ot,Oe,Dt,Xt,wr,Zr,Zt,zr,$s,ks,vr,di,be,Cl,Tl,Fi,Oa,Ba,eo;class Lf{constructor(e,r,s){y(this,be);C(this,"parent");C(this,"is_pending",!1);y(this,ze);y(this,_n,k?X:null);y(this,Rt);y(this,Xr);y(this,Pt);y(this,ot,null);y(this,Oe,null);y(this,Dt,null);y(this,Xt,null);y(this,wr,null);y(this,Zr,0);y(this,Zt,0);y(this,zr,!1);y(this,$s,new Set);y(this,ks,new Set);y(this,vr,null);y(this,di,Io(()=>(_(this,vr,dr(i(this,Zr))),()=>{_(this,vr,null)})));_(this,ze,e),_(this,Rt,r),_(this,Xr,s),this.parent=Z.b,this.is_pending=!!i(this,Rt).pending,_(this,Pt,ps(()=>{if(Z.b=this,k){const a=i(this,_n);Bt(),a.nodeType===en&&a.data===Mi?b(this,be,Tl).call(this):(b(this,be,Cl).call(this),i(this,Zt)===0&&(this.is_pending=!1))}else{var n=b(this,be,Fi).call(this);try{_(this,ot,Ge(()=>s(n)))}catch(a){this.error(a)}i(this,Zt)>0?b(this,be,Ba).call(this):this.is_pending=!1}return()=>{i(this,wr)?.remove()}},Tf)),k&&_(this,ze,X)}defer_effect(e){Rl(e,i(this,$s),i(this,ks))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!i(this,Rt).pending}update_pending_count(e){b(this,be,eo).call(this,e),_(this,Zr,i(this,Zr)+e),i(this,vr)&&Zs(i(this,vr),i(this,Zr))}get_effect_pending(){return i(this,di).call(this),f(i(this,vr))}error(e){var r=i(this,Rt).onerror;let s=i(this,Rt).failed;if(i(this,zr)||!r&&!s)throw e;i(this,ot)&&(De(i(this,ot)),_(this,ot,null)),i(this,Oe)&&(De(i(this,Oe)),_(this,Oe,null)),i(this,Dt)&&(De(i(this,Dt)),_(this,Dt,null)),k&&(Pe(i(this,_n)),Rf(),Pe(za()));var n=!1,a=!1;const o=()=>{if(n){Af();return}n=!0,a&&sf(),qt.ensure(),_(this,Zr,0),i(this,Dt)!==null&&ls(i(this,Dt),()=>{_(this,Dt,null)}),this.is_pending=this.has_pending_snippet(),_(this,ot,b(this,be,Oa).call(this,()=>(_(this,zr,!1),Ge(()=>i(this,Xr).call(this,i(this,ze)))))),i(this,Zt)>0?b(this,be,Ba).call(this):this.is_pending=!1};var c=Y;try{Ke(null),a=!0,r?.(e,o),a=!1}catch(l){Xs(l,i(this,Pt)&&i(this,Pt).parent)}finally{Ke(c)}s&&At(()=>{_(this,Dt,b(this,be,Oa).call(this,()=>{qt.ensure(),_(this,zr,!0);try{return Ge(()=>{s(i(this,ze),()=>e,()=>o)})}catch(l){return Xs(l,i(this,Pt).parent),null}finally{_(this,zr,!1)}}))})}}ze=new WeakMap,_n=new WeakMap,Rt=new WeakMap,Xr=new WeakMap,Pt=new WeakMap,ot=new WeakMap,Oe=new WeakMap,Dt=new WeakMap,Xt=new WeakMap,wr=new WeakMap,Zr=new WeakMap,Zt=new WeakMap,zr=new WeakMap,$s=new WeakMap,ks=new WeakMap,vr=new WeakMap,di=new WeakMap,be=new WeakSet,Cl=function(){try{_(this,ot,Ge(()=>i(this,Xr).call(this,i(this,ze))))}catch(e){this.error(e)}},Tl=function(){const e=i(this,Rt).pending;e&&(_(this,Oe,Ge(()=>e(i(this,ze)))),qt.enqueue(()=>{var r=b(this,be,Fi).call(this);_(this,ot,b(this,be,Oa).call(this,()=>(qt.ensure(),Ge(()=>i(this,Xr).call(this,r))))),i(this,Zt)>0?b(this,be,Ba).call(this):(ls(i(this,Oe),()=>{_(this,Oe,null)}),this.is_pending=!1)}))},Fi=function(){var e=i(this,ze);return this.is_pending&&(_(this,wr,Ue()),i(this,ze).before(i(this,wr)),e=i(this,wr)),e},Oa=function(e){var r=Z,s=Y,n=ye;xt(i(this,Pt)),Ke(i(this,Pt)),Ys(i(this,Pt).ctx);try{return e()}catch(a){return Al(a),null}finally{xt(r),Ke(s),Ys(n)}},Ba=function(){const e=i(this,Rt).pending;i(this,ot)!==null&&(_(this,Xt,document.createDocumentFragment()),i(this,Xt).append(i(this,wr)),ru(i(this,ot),i(this,Xt))),i(this,Oe)===null&&_(this,Oe,Ge(()=>e(i(this,ze))))},eo=function(e){var r;if(!this.has_pending_snippet()){this.parent&&b(r=this.parent,be,eo).call(r,e);return}if(_(this,Zt,i(this,Zt)+e),i(this,Zt)===0){this.is_pending=!1;for(const s of i(this,$s))Me(s,Xe),ur(s);for(const s of i(this,ks))Me(s,hr),ur(s);i(this,$s).clear(),i(this,ks).clear(),i(this,Oe)&&ls(i(this,Oe),()=>{_(this,Oe,null)}),i(this,Xt)&&(i(this,ze).before(i(this,Xt)),_(this,Xt,null))}};function Nl(t,e,r,s){const n=rn()?ya:Ao;if(r.length===0&&t.length===0){s(e.map(n));return}var a=ee,o=Z,c=jf();function l(){Promise.all(r.map(u=>qf(u))).then(u=>{c();try{s([...e.map(n),...u])}catch(d){(o.f&cr)===0&&Xs(d,o)}a?.deactivate(),Fa()}).catch(u=>{Xs(u,o)})}t.length>0?Promise.all(t).then(()=>{c();try{return l()}finally{a?.deactivate(),Fa()}}):l()}function jf(){var t=Z,e=Y,r=ye,s=ee;return function(a=!0){xt(t),Ke(e),Ys(r),a&&s?.activate()}}function Fa(){xt(null),Ke(null),Ys(null)}function ya(t){var e=$e|Xe,r=Y!==null&&(Y.f&$e)!==0?Y:null;return Z!==null&&(Z.f|=hs),{ctx:ye,deps:null,effects:null,equals:El,f:e,fn:t,reactions:null,rv:0,v:_e,wv:0,parent:r??Z,ac:null}}function qf(t,e,r){let s=Z;s===null&&Kd();var n=s.b,a=void 0,o=dr(_e),c=!Y,l=new Map;return Jf(()=>{var u=pl();a=u.promise;try{Promise.resolve(t()).then(u.resolve,u.reject).then(()=>{d===ee&&d.committed&&d.deactivate(),Fa()})}catch(g){u.reject(g),Fa()}var d=ee;if(c){var h=n.is_rendered();n.update_pending_count(1),d.increment(h),l.get(d)?.reject(_s),l.delete(d),l.set(d,u)}const p=(g,w=void 0)=>{if(d.activate(),w)w!==_s&&(o.f|=Nr,Zs(o,w));else{(o.f&Nr)!==0&&(o.f^=Nr),Zs(o,g);for(const[A,E]of l){if(l.delete(A),A===d)break;E.reject(_s)}}c&&(n.update_pending_count(-1),d.decrement(h))};u.promise.then(p,g=>p(null,g||"unknown"))}),wa(()=>{for(const u of l.values())u.reject(_s)}),new Promise(u=>{function d(h){function p(){h===a?u(o):d(a)}h.then(p,p)}d(a)})}function z(t){const e=ya(t);return su(e),e}function Ao(t){const e=ya(t);return e.equals=Sl,e}function Ll(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)De(e[r])}}function Uf(t){for(var e=t.parent;e!==null;){if((e.f&$e)===0)return(e.f&cr)===0?e:null;e=e.parent}return null}function _o(t){var e,r=Z;xt(Uf(t));try{t.f&=~ds,Ll(t),e=ou(t)}finally{xt(r)}return e}function jl(t){var e=_o(t);if(!t.equals(e)&&(t.wv=au(),(!ee?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Me(t,Le);return}Ur||(vt!==null?(Ro()||ee?.is_fork)&&vt.set(t,e):So(t))}let to=new Set;const Lr=new Map;let ql=!1;function dr(t,e){var r={f:0,v:t,reactions:null,equals:El,rv:0,wv:0};return r}function P(t,e){const r=dr(t);return su(r),r}function Of(t,e=!1,r=!0){var n;const s=dr(t);return e||(s.equals=Sl),tn&&r&&ye!==null&&ye.l!==null&&((n=ye.l).s??(n.s=[])).push(s),s}function m(t,e,r=!1){Y!==null&&(!bt||(Y.f&sc)!==0)&&rn()&&(Y.f&($e|Vt|wo|sc))!==0&&!lr?.includes(t)&&rf();let s=r?ge(e):e;return Zs(t,s)}function Zs(t,e){if(!t.equals(e)){var r=t.v;Ur?Lr.set(t,e):Lr.set(t,r),t.v=e;var s=qt.ensure();if(s.capture(t,r),(t.f&$e)!==0){const n=t;(t.f&Xe)!==0&&_o(n),So(n)}t.wv=au(),Ul(t,Xe),rn()&&Z!==null&&(Z.f&Le)!==0&&(Z.f&(fr|xr))===0&&(it===null?Xf([t]):it.push(t)),!s.is_fork&&to.size>0&&!ql&&Bf()}return e}function Bf(){ql=!1;var t=us;ei(!0);const e=Array.from(to);try{for(const r of e)(r.f&Le)!==0&&Me(r,hr),Ea(r)&&En(r)}finally{ei(t)}to.clear()}function Vg(t,e=1){var r=f(t),s=e===1?r++:r--;return m(t,r),s}function Re(t){m(t,t.v+1)}function Ul(t,e){var r=t.reactions;if(r!==null)for(var s=rn(),n=r.length,a=0;a<n;a++){var o=r[a],c=o.f;if(!(!s&&o===Z)){var l=(c&Xe)===0;if(l&&Me(o,e),(c&$e)!==0){var u=o;vt?.delete(u),(c&ds)===0&&(c&dt&&(o.f|=ds),Ul(u,hr))}else l&&((c&Vt)!==0&&Kt!==null&&Kt.add(o),ur(o))}}}function ge(t){if(typeof t!="object"||t===null||Ut in t)return t;const e=Pi(t);if(e!==hl&&e!==Wd)return t;var r=new Map,s=_i(t),n=P(0),a=It,o=c=>{if(It===a)return c();var l=Y,u=It;Ke(null),uc(a);var d=c();return Ke(l),uc(u),d};return s&&r.set("length",P(t.length)),new Proxy(t,{defineProperty(c,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&ef();var d=r.get(l);return d===void 0?d=o(()=>{var h=P(u.value);return r.set(l,h),h}):m(d,u.value,!0),!0},deleteProperty(c,l){var u=r.get(l);if(u===void 0){if(l in c){const d=o(()=>P(_e));r.set(l,d),Re(n)}}else m(u,_e),Re(n);return!0},get(c,l,u){if(l===Ut)return t;var d=r.get(l),h=l in c;if(d===void 0&&(!h||Tr(c,l)?.writable)&&(d=o(()=>{var g=ge(h?c[l]:_e),w=P(g);return w}),r.set(l,d)),d!==void 0){var p=f(d);return p===_e?void 0:p}return Reflect.get(c,l,u)},getOwnPropertyDescriptor(c,l){var u=Reflect.getOwnPropertyDescriptor(c,l);if(u&&"value"in u){var d=r.get(l);d&&(u.value=f(d))}else if(u===void 0){var h=r.get(l),p=h?.v;if(h!==void 0&&p!==_e)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return u},has(c,l){if(l===Ut)return!0;var u=r.get(l),d=u!==void 0&&u.v!==_e||Reflect.has(c,l);if(u!==void 0||Z!==null&&(!d||Tr(c,l)?.writable)){u===void 0&&(u=o(()=>{var p=d?ge(c[l]):_e,g=P(p);return g}),r.set(l,u));var h=f(u);if(h===_e)return!1}return d},set(c,l,u,d){var h=r.get(l),p=l in c;if(s&&l==="length")for(var g=u;g<h.v;g+=1){var w=r.get(g+"");w!==void 0?m(w,_e):g in c&&(w=o(()=>P(_e)),r.set(g+"",w))}if(h===void 0)(!p||Tr(c,l)?.writable)&&(h=o(()=>P(void 0)),m(h,ge(u)),r.set(l,h));else{p=h.v!==_e;var A=o(()=>ge(u));m(h,A)}var E=Reflect.getOwnPropertyDescriptor(c,l);if(E?.set&&E.set.call(d,u),!p){if(s&&typeof l=="string"){var I=r.get("length"),$=Number(l);Number.isInteger($)&&$>=I.v&&m(I,$+1)}Re(n)}return!0},ownKeys(c){f(n);var l=Reflect.ownKeys(c).filter(h=>{var p=r.get(h);return p===void 0||p.v!==_e});for(var[u,d]of r)d.v!==_e&&!(u in c)&&l.push(u);return l},setPrototypeOf(){tf()}})}function ac(t){try{if(t!==null&&typeof t=="object"&&Ut in t)return t[Ut]}catch{}return t}function Ol(t,e){return Object.is(ac(t),ac(e))}var ic,Bl,xl,Hl;function xf(){if(ic===void 0){ic=window,Bl=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;xl=Tr(e,"firstChild").get,Hl=Tr(e,"nextSibling").get,rc(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),rc(r)&&(r.__t=void 0)}}function Ue(t=""){return document.createTextNode(t)}function Je(t){return xl.call(t)}function Wt(t){return Hl.call(t)}function Wg(t,e){if(!k)return Je(t);var r=Je(X);if(r===null)r=X.appendChild(Ue());else if(e&&r.nodeType!==Di){var s=Ue();return r?.before(s),Pe(s),s}return Pe(r),r}function oc(t,e=!1){if(!k){var r=Je(t);return r instanceof Comment&&r.data===""?Wt(r):r}if(e&&X?.nodeType!==Di){var s=Ue();return X?.before(s),Pe(s),s}return X}function Gg(t,e=1,r=!1){let s=k?X:t;for(var n;e--;)n=s,s=Wt(s);if(!k)return s;if(r&&s?.nodeType!==Di){var a=Ue();return s===null?n?.after(a):s.before(a),Pe(a),a}return Pe(s),s}function Vl(t){t.textContent=""}function Wl(){return!1}function Hf(t=""){return document.createComment(t)}function Vf(t,e){if(e){const r=document.body;t.autofocus=!0,At(()=>{document.activeElement===r&&t.focus()})}}function Qg(t){k&&Je(t)!==null&&Vl(t)}let cc=!1;function Gl(){cc||(cc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function sn(t){var e=Y,r=Z;Ke(null),xt(null);try{return t()}finally{Ke(e),xt(r)}}function ki(t,e,r,s=r){t.addEventListener(e,()=>sn(r));const n=t.__on_r;n?t.__on_r=()=>{n(),s(!0)}:t.__on_r=()=>s(!0),Gl()}function Ql(t){Z===null&&(Y===null&&Zd(),Xd()),Ur&&Yd()}function Wf(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function mt(t,e,r){var s=Z;s!==null&&(s.f&nt)!==0&&(t|=nt);var n={ctx:ye,deps:null,nodes:null,f:t|Xe|dt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{En(n),n.f|=pa}catch(c){throw De(n),c}else e!==null&&ur(n);var a=n;if(r&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&hs)===0&&(a=a.first,(t&Vt)!==0&&(t&Ot)!==0&&a!==null&&(a.f|=Ot)),a!==null&&(a.parent=s,s!==null&&Wf(a,s),Y!==null&&(Y.f&$e)!==0&&(t&xr)===0)){var o=Y;(o.effects??(o.effects=[])).push(a)}return n}function Ro(){return Y!==null&&!bt}function wa(t){const e=mt(ha,null,!1);return Me(e,Le),e.teardown=t,e}function qr(t){Ql();var e=Z.f,r=!Y&&(e&fr)!==0&&(e&pa)===0;if(r){var s=ye;(s.e??(s.e=[])).push(t)}else return Jl(t)}function Jl(t){return mt(Za|gl,t,!1)}function Gf(t){return Ql(),mt(ha|gl,t,!0)}function Kl(t){qt.ensure();const e=mt(xr|hs,t,!0);return()=>{De(e)}}function Qf(t){qt.ensure();const e=mt(xr|hs,t,!0);return(r={})=>new Promise(s=>{r.outro?ls(e,()=>{De(e),s(void 0)}):(De(e),s(void 0))})}function va(t){return mt(Za,t,!1)}function Jf(t){return mt(wo|hs,t,!0)}function ba(t,e=0){return mt(ha|e,t,!0)}function Kf(t,e=[],r=[],s=[]){Nl(s,e,r,n=>{mt(ha,()=>t(...n.map(f)),!0)})}function ps(t,e=0){var r=mt(Vt|e,t,!0);return r}function Yl(t,e=0){var r=mt(go|e,t,!0);return r}function Ge(t){return mt(fr|hs,t,!0)}function Xl(t){var e=t.teardown;if(e!==null){const r=Ur,s=Y;lc(!0),Ke(null);try{e.call(null)}finally{lc(r),Ke(s)}}}function Zl(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const n=r.ac;n!==null&&sn(()=>{n.abort(_s)});var s=r.next;(r.f&xr)!==0?r.parent=null:De(r,e),r=s}}function Yf(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&fr)===0&&De(e),e=r}}function De(t,e=!0){var r=!1;(e||(t.f&ml)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(zl(t.nodes.start,t.nodes.end),r=!0),Zl(t,e&&!r),ti(t,0),Me(t,cr);var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)a.stop();Xl(t);var n=t.parent;n!==null&&n.first!==null&&Fl(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function zl(t,e){for(;t!==null;){var r=t===e?null:Wt(t);t.remove(),t=r}}function Fl(t){var e=t.parent,r=t.prev,s=t.next;r!==null&&(r.next=s),s!==null&&(s.prev=r),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=r))}function ls(t,e,r=!0){var s=[];eu(t,s,!0);var n=()=>{r&&De(t),e&&e()},a=s.length;if(a>0){var o=()=>--a||n();for(var c of s)c.out(o)}else n()}function eu(t,e,r){if((t.f&nt)===0){t.f^=nt;var s=t.nodes&&t.nodes.t;if(s!==null)for(const c of s)(c.is_global||r)&&e.push(c);for(var n=t.first;n!==null;){var a=n.next,o=(n.f&Ot)!==0||(n.f&fr)!==0&&(t.f&Vt)!==0;eu(n,e,o?r:!1),n=a}}}function Po(t){tu(t,!0)}function tu(t,e){if((t.f&nt)!==0){t.f^=nt,(t.f&Le)===0&&(Me(t,Xe),ur(t));for(var r=t.first;r!==null;){var s=r.next,n=(r.f&Ot)!==0||(r.f&fr)!==0;tu(r,n?e:!1),r=s}var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)(o.is_global||e)&&o.in()}}function ru(t,e){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end;r!==null;){var n=r===s?null:Wt(r);e.append(r),r=n}}let us=!1;function ei(t){us=t}let Ur=!1;function lc(t){Ur=t}let Y=null,bt=!1;function Ke(t){Y=t}let Z=null;function xt(t){Z=t}let lr=null;function su(t){Y!==null&&(lr===null?lr=[t]:lr.push(t))}let We=null,Ze=0,it=null;function Xf(t){it=t}let nu=1,Qr=0,It=Qr;function uc(t){It=t}function au(){return++nu}function Ea(t){var e=t.f;if((e&Xe)!==0)return!0;if(e&$e&&(t.f&=~ds),(e&hr)!==0){for(var r=t.deps,s=r.length,n=0;n<s;n++){var a=r[n];if(Ea(a)&&jl(a),a.wv>t.wv)return!0}(e&dt)!==0&&vt===null&&Me(t,Le)}return!1}function iu(t,e,r=!0){var s=t.reactions;if(s!==null&&!lr?.includes(t))for(var n=0;n<s.length;n++){var a=s[n];(a.f&$e)!==0?iu(a,e,!1):e===a&&(r?Me(a,Xe):(a.f&Le)!==0&&Me(a,hr),ur(a))}}function ou(t){var w;var e=We,r=Ze,s=it,n=Y,a=lr,o=ye,c=bt,l=It,u=t.f;We=null,Ze=0,it=null,Y=(u&(fr|xr))===0?t:null,lr=null,Ys(t.ctx),bt=!1,It=++Qr,t.ac!==null&&(sn(()=>{t.ac.abort(_s)}),t.ac=null);try{t.f|=Yi;var d=t.fn,h=d(),p=t.deps;if(We!==null){var g;if(ti(t,Ze),p!==null&&Ze>0)for(p.length=Ze+We.length,g=0;g<We.length;g++)p[Ze+g]=We[g];else t.deps=p=We;if(Ro()&&(t.f&dt)!==0)for(g=Ze;g<p.length;g++)((w=p[g]).reactions??(w.reactions=[])).push(t)}else p!==null&&Ze<p.length&&(ti(t,Ze),p.length=Ze);if(rn()&&it!==null&&!bt&&p!==null&&(t.f&($e|hr|Xe))===0)for(g=0;g<it.length;g++)iu(it[g],t);if(n!==null&&n!==t){if(Qr++,n.deps!==null)for(let A=0;A<r;A+=1)n.deps[A].rv=Qr;if(e!==null)for(const A of e)A.rv=Qr;it!==null&&(s===null?s=it:s.push(...it))}return(t.f&Nr)!==0&&(t.f^=Nr),h}catch(A){return Al(A)}finally{t.f^=Yi,We=e,Ze=r,it=s,Y=n,lr=a,Ys(o),bt=c,It=l}}function Zf(t,e){let r=e.reactions;if(r!==null){var s=Hd.call(r,t);if(s!==-1){var n=r.length-1;n===0?r=e.reactions=null:(r[s]=r[n],r.pop())}}if(r===null&&(e.f&$e)!==0&&(We===null||!We.includes(e))){var a=e;(a.f&dt)!==0&&(a.f^=dt,a.f&=~ds),So(a),Ll(a),ti(a,0)}}function ti(t,e){var r=t.deps;if(r!==null)for(var s=e;s<r.length;s++)Zf(t,r[s])}function En(t){var e=t.f;if((e&cr)===0){Me(t,Le);var r=Z,s=us;Z=t,us=!0;try{(e&(Vt|go))!==0?Yf(t):Zl(t),Xl(t);var n=ou(t);t.teardown=typeof n=="function"?n:null,t.wv=nu;var a}finally{us=s,Z=r}}}async function zf(){await Promise.resolve(),kf()}function f(t){var e=t.f,r=(e&$e)!==0;if(Y!==null&&!bt){var s=Z!==null&&(Z.f&cr)!==0;if(!s&&!lr?.includes(t)){var n=Y.deps;if((Y.f&Yi)!==0)t.rv<Qr&&(t.rv=Qr,We===null&&n!==null&&n[Ze]===t?Ze++:We===null?We=[t]:We.push(t));else{(Y.deps??(Y.deps=[])).push(t);var a=t.reactions;a===null?t.reactions=[Y]:a.includes(Y)||a.push(Y)}}}if(Ur&&Lr.has(t))return Lr.get(t);if(r){var o=t;if(Ur){var c=o.v;return((o.f&Le)===0&&o.reactions!==null||lu(o))&&(c=_o(o)),Lr.set(o,c),c}var l=(o.f&dt)===0&&!bt&&Y!==null&&(us||(Y.f&dt)!==0),u=o.deps===null;Ea(o)&&(l&&(o.f|=dt),jl(o)),l&&!u&&cu(o)}if(vt?.has(t))return vt.get(t);if((t.f&Nr)!==0)throw t.v;return t.v}function cu(t){if(t.deps!==null){t.f|=dt;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&$e)!==0&&(e.f&dt)===0&&cu(e)}}function lu(t){if(t.v===_e)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Lr.has(e)||(e.f&$e)!==0&&lu(e))return!0;return!1}function pr(t){var e=bt;try{return bt=!0,t()}finally{bt=e}}function Ff(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ut in t)ro(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Ut in r&&ro(r)}}}function ro(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let s in t)try{ro(t[s],e)}catch{}const r=Pi(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const s=fl(r);for(let n in s){const a=s[n].get;if(a)try{a.call(t)}catch{}}}}}function eh(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const th=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function rh(t){return th.includes(t)}const sh={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function nh(t){return t=t.toLowerCase(),sh[t]??t}const ah=["touchstart","touchmove"];function ih(t){return ah.includes(t)}const oh=["textarea","script","style","title"];function ch(t){return oh.includes(t)}const uu=new Set,so=new Set;function Jg(t){if(!k)return;t.removeAttribute("onload"),t.removeAttribute("onerror");const e=t.__e;e!==void 0&&(t.__e=void 0,queueMicrotask(()=>{t.isConnected&&t.dispatchEvent(e)}))}function Do(t,e,r,s={}){function n(a){if(s.capture||fn.call(e,a),!a.cancelBubble)return sn(()=>r?.call(this,a))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?At(()=>{e.addEventListener(t,n,s)}):e.addEventListener(t,n,s),n}function zs(t,e,r,s={}){var n=Do(e,t,r,s);return()=>{t.removeEventListener(e,n,s)}}function Kg(t,e,r,s,n){var a={capture:s,passive:n},o=Do(t,e,r,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&wa(()=>{e.removeEventListener(t,o,a)})}function lh(t){for(var e=0;e<t.length;e++)uu.add(t[e]);for(var r of so)r(t)}let dc=null;function fn(t){var e=this,r=e.ownerDocument,s=t.type,n=t.composedPath?.()||[],a=n[0]||t.target;dc=t;var o=0,c=dc===t&&t.__root;if(c){var l=n.indexOf(c);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var u=n.indexOf(e);if(u===-1)return;l<=u&&(o=l)}if(a=n[o]||t.target,a!==e){Vd(t,"currentTarget",{configurable:!0,get(){return a||r}});var d=Y,h=Z;Ke(null),xt(null);try{for(var p,g=[];a!==null;){var w=a.assignedSlot||a.parentNode||a.host||null;try{var A=a["__"+s];A!=null&&(!a.disabled||t.target===a)&&A.call(a,t)}catch(E){p?g.push(E):p=E}if(t.cancelBubble||w===e||w===null)break;a=w}if(p){for(let E of g)queueMicrotask(()=>{throw E});throw p}}finally{t.__root=e,delete t.currentTarget,Ke(d),xt(h)}}}function Mo(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function at(t,e){var r=Z;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function Yg(t,e){var r=(e&yf)!==0,s=(e&wf)!==0,n,a=!t.startsWith("<!>");return()=>{if(k)return at(X,null),X;n===void 0&&(n=Mo(a?t:"<!>"+t),r||(n=Je(n)));var o=s||Bl?document.importNode(n,!0):n.cloneNode(!0);if(r){var c=Je(o),l=o.lastChild;at(c,l)}else at(o,o);return o}}function uh(t,e,r="svg"){var s=!t.startsWith("<!>"),n=`<${r}>${s?t:"<!>"+t}</${r}>`,a;return()=>{if(k)return at(X,null),X;if(!a){var o=Mo(n),c=Je(o);a=Je(c)}var l=a.cloneNode(!0);return at(l,l),l}}function Xg(t,e){return uh(t,e,"svg")}function Zg(t=""){if(!k){var e=Ue(t+"");return at(e,e),e}var r=X;return r.nodeType!==Di&&(r.before(r=Ue()),Pe(r)),at(r,r),r}function fc(){if(k)return at(X,null),X;var t=document.createDocumentFragment(),e=document.createComment(""),r=Ue();return t.append(e,r),at(e,r),t}function hc(t,e){if(k){var r=Z;((r.f&pa)===0||r.nodes.end===null)&&(r.nodes.end=X),Bt();return}t!==null&&t.before(e)}let ri=!0;function $a(t){ri=t}function zg(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=r,t.nodeValue=r+"")}function Fg(t,e){return dh(t,e)}const ws=new Map;function dh(t,{target:e,anchor:r,props:s={},events:n,context:a,intro:o=!0}){xf();var c=new Set,l=h=>{for(var p=0;p<h.length;p++){var g=h[p];if(!c.has(g)){c.add(g);var w=ih(g);e.addEventListener(g,fn,{passive:w});var A=ws.get(g);A===void 0?(document.addEventListener(g,fn,{passive:w}),ws.set(g,1)):ws.set(g,A+1)}}};l(Ri(uu)),so.add(l);var u=void 0,d=Qf(()=>{var h=r??e.appendChild(Ue());return Nf(h,{pending:()=>{}},p=>{if(a){bo({});var g=ye;g.c=a}if(n&&(s.$$events=n),k&&at(p,null),ri=o,u=t(p,s)||{},ri=!0,k&&(Z.nodes.end=X,X===null||X.nodeType!==en||X.data!==vo))throw ga(),ma;a&&Eo()}),()=>{for(var p of c){e.removeEventListener(p,fn);var g=ws.get(p);--g===0?(document.removeEventListener(p,fn),ws.delete(p)):ws.set(p,g)}so.delete(l),h!==r&&h.parentNode?.removeChild(h)}});return fh.set(u,d),u}let fh=new WeakMap;var yt,Mt,Fe,Fr,Rn,Pn,fi;class Sa{constructor(e,r=!0){C(this,"anchor");y(this,yt,new Map);y(this,Mt,new Map);y(this,Fe,new Map);y(this,Fr,new Set);y(this,Rn,!0);y(this,Pn,()=>{var e=ee;if(i(this,yt).has(e)){var r=i(this,yt).get(e),s=i(this,Mt).get(r);if(s)Po(s),i(this,Fr).delete(r);else{var n=i(this,Fe).get(r);n&&(i(this,Mt).set(r,n.effect),i(this,Fe).delete(r),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),s=n.effect)}for(const[a,o]of i(this,yt)){if(i(this,yt).delete(a),a===e)break;const c=i(this,Fe).get(o);c&&(De(c.effect),i(this,Fe).delete(o))}for(const[a,o]of i(this,Mt)){if(a===r||i(this,Fr).has(a))continue;const c=()=>{if(Array.from(i(this,yt).values()).includes(a)){var u=document.createDocumentFragment();ru(o,u),u.append(Ue()),i(this,Fe).set(a,{effect:o,fragment:u})}else De(o);i(this,Fr).delete(a),i(this,Mt).delete(a)};i(this,Rn)||!s?(i(this,Fr).add(a),ls(o,c,!1)):c()}}});y(this,fi,e=>{i(this,yt).delete(e);const r=Array.from(i(this,yt).values());for(const[s,n]of i(this,Fe))r.includes(s)||(De(n.effect),i(this,Fe).delete(s))});this.anchor=e,_(this,Rn,r)}ensure(e,r){var s=ee,n=Wl();if(r&&!i(this,Mt).has(e)&&!i(this,Fe).has(e))if(n){var a=document.createDocumentFragment(),o=Ue();a.append(o),i(this,Fe).set(e,{effect:Ge(()=>r(o)),fragment:a})}else i(this,Mt).set(e,Ge(()=>r(this.anchor)));if(i(this,yt).set(s,e),n){for(const[c,l]of i(this,Mt))c===e?s.skipped_effects.delete(l):s.skipped_effects.add(l);for(const[c,l]of i(this,Fe))c===e?s.skipped_effects.delete(l.effect):s.skipped_effects.add(l.effect);s.oncommit(i(this,Pn)),s.ondiscard(i(this,fi))}else k&&(this.anchor=X),i(this,Pn).call(this)}}yt=new WeakMap,Mt=new WeakMap,Fe=new WeakMap,Fr=new WeakMap,Rn=new WeakMap,Pn=new WeakMap,fi=new WeakMap;function hh(t,e,r=!1){k&&Bt();var s=new Sa(t),n=r?Ot:0;function a(o,c){if(k){const u=bl(t)===Mi;if(o===u){var l=za();Pe(l),s.anchor=l,St(!1),s.ensure(o,c),St(!0);return}}s.ensure(o,c)}ps(()=>{var o=!1;e((c,l=!0)=>{o=!0,a(l,c)}),o||a(!1,null)},n)}function ey(t,e,r){k&&Bt();var s=new Sa(t),n=!rn();ps(()=>{var a=e();n&&a!==null&&typeof a=="object"&&(a={}),s.ensure(a,r)})}function ty(t,e){return e}function ph(t,e,r){for(var s=[],n=e.length,a,o=e.length,c=0;c<n;c++){let h=e[c];ls(h,()=>{if(a){if(a.pending.delete(h),a.done.add(h),a.pending.size===0){var p=t.outrogroups;no(Ri(a.done)),p.delete(a),p.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=s.length===0&&r!==null;if(l){var u=r,d=u.parentNode;Vl(d),d.append(u),t.items.clear()}no(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(a)}function no(t,e=!0){for(var r=0;r<t.length;r++)De(t[r],e)}var pc;function ry(t,e,r,s,n,a=null){var o=t,c=new Map,l=(e&vl)!==0;if(l){var u=t;o=k?Pe(Je(u)):u.appendChild(Ue())}k&&Bt();var d=null,h=Ao(()=>{var I=r();return _i(I)?I:I==null?[]:Ri(I)}),p,g=!0;function w(){E.fallback=d,mh(E,p,o,e,s),d!==null&&(p.length===0?(d.f&or)===0?Po(d):(d.f^=or,hn(d,null,o)):ls(d,()=>{d=null}))}var A=ps(()=>{p=f(h);var I=p.length;let $=!1;if(k){var H=bl(o)===Mi;H!==(I===0)&&(o=za(),Pe(o),St(!1),$=!0)}for(var B=new Set,G=ee,N=Wl(),U=0;U<I;U+=1){k&&X.nodeType===en&&X.data===vo&&(o=X,$=!0,St(!1));var F=p[U],se=s(F,U),V=g?null:c.get(se);V?(V.v&&Zs(V.v,F),V.i&&Zs(V.i,U),N&&G.skipped_effects.delete(V.e)):(V=gh(c,g?o:pc??(pc=Ue()),F,se,U,n,e,r),g||(V.e.f|=or),c.set(se,V)),B.add(se)}if(I===0&&a&&!d&&(g?d=Ge(()=>a(o)):(d=Ge(()=>a(pc??(pc=Ue()))),d.f|=or)),k&&I>0&&Pe(za()),!g)if(N){for(const[an,on]of c)B.has(an)||G.skipped_effects.add(on.e);G.oncommit(w),G.ondiscard(()=>{})}else w();$&&St(!0),f(h)}),E={effect:A,items:c,outrogroups:null,fallback:d};g=!1,k&&(o=X)}function mh(t,e,r,s,n){var a=(s&of)!==0,o=e.length,c=t.items,l=t.effect.first,u,d=null,h,p=[],g=[],w,A,E,I;if(a)for(I=0;I<o;I+=1)w=e[I],A=n(w,I),E=c.get(A).e,(E.f&or)===0&&(E.nodes?.a?.measure(),(h??(h=new Set)).add(E));for(I=0;I<o;I+=1){if(w=e[I],A=n(w,I),E=c.get(A).e,t.outrogroups!==null)for(const V of t.outrogroups)V.pending.delete(E),V.done.delete(E);if((E.f&or)!==0)if(E.f^=or,E===l)hn(E,null,r);else{var $=d?d.next:l;E===t.effect.last&&(t.effect.last=E.prev),E.prev&&(E.prev.next=E.next),E.next&&(E.next.prev=E.prev),mr(t,d,E),mr(t,E,$),hn(E,$,r),d=E,p=[],g=[],l=d.next;continue}if((E.f&nt)!==0&&(Po(E),a&&(E.nodes?.a?.unfix(),(h??(h=new Set)).delete(E))),E!==l){if(u!==void 0&&u.has(E)){if(p.length<g.length){var H=g[0],B;d=H.prev;var G=p[0],N=p[p.length-1];for(B=0;B<p.length;B+=1)hn(p[B],H,r);for(B=0;B<g.length;B+=1)u.delete(g[B]);mr(t,G.prev,N.next),mr(t,d,G),mr(t,N,H),l=H,d=N,I-=1,p=[],g=[]}else u.delete(E),hn(E,l,r),mr(t,E.prev,E.next),mr(t,E,d===null?t.effect.first:d.next),mr(t,d,E),d=E;continue}for(p=[],g=[];l!==null&&l!==E;)(u??(u=new Set)).add(l),g.push(l),l=l.next;if(l===null)continue}(E.f&or)===0&&p.push(E),d=E,l=E.next}if(t.outrogroups!==null){for(const V of t.outrogroups)V.pending.size===0&&(no(Ri(V.done)),t.outrogroups?.delete(V));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||u!==void 0){var U=[];if(u!==void 0)for(E of u)(E.f&nt)===0&&U.push(E);for(;l!==null;)(l.f&nt)===0&&l!==t.fallback&&U.push(l),l=l.next;var F=U.length;if(F>0){var se=(s&vl)!==0&&o===0?r:null;if(a){for(I=0;I<F;I+=1)U[I].nodes?.a?.measure();for(I=0;I<F;I+=1)U[I].nodes?.a?.fix()}ph(t,U,se)}}a&&At(()=>{if(h!==void 0)for(E of h)E.nodes?.a?.apply()})}function gh(t,e,r,s,n,a,o,c){var l=(o&nf)!==0?(o&cf)===0?Of(r,!1,!1):dr(r):null,u=(o&af)!==0?dr(n):null;return{v:l,i:u,e:Ge(()=>(a(e,l??r,u??n,c),()=>{t.delete(s)}))}}function hn(t,e,r){if(t.nodes)for(var s=t.nodes.start,n=t.nodes.end,a=e&&(e.f&or)===0?e.nodes.start:r;s!==null;){var o=Wt(s);if(a.before(s),s===n)return;s=o}}function mr(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function sy(t,e,r=!1,s=!1,n=!1){var a=t,o="";Kf(()=>{var c=Z;if(o===(o=e()??"")){k&&Bt();return}if(c.nodes!==null&&(zl(c.nodes.start,c.nodes.end),c.nodes=null),o!==""){if(k){X.data;for(var l=Bt(),u=l;l!==null&&(l.nodeType!==en||l.data!=="");)u=l,l=Wt(l);if(l===null)throw ga(),ma;at(X,u),a=Pe(l);return}var d=o+"";r?d=`<svg>${d}</svg>`:s&&(d=`<math>${d}</math>`);var h=Mo(d);if((r||s)&&(h=Je(h)),at(Je(h),h.lastChild),r||s)for(;Je(h);)a.before(Je(h));else a.before(h)}})}function ny(t,e,...r){var s=new Sa(t);ps(()=>{const n=e()??null;s.ensure(n,n&&(a=>n(a,...r)))},Ot)}function yh(t,e,r){k&&Bt();var s=new Sa(t);ps(()=>{var n=e()??null;s.ensure(n,n&&(a=>r(a,n)))},Ot)}const wh=()=>performance.now(),ir={tick:t=>requestAnimationFrame(t),now:()=>wh(),tasks:new Set};function du(){const t=ir.now();ir.tasks.forEach(e=>{e.c(t)||(ir.tasks.delete(e),e.f())}),ir.tasks.size!==0&&ir.tick(du)}function vh(t){let e;return ir.tasks.size===0&&ir.tick(du),{promise:new Promise(r=>{ir.tasks.add(e={c:t,f:r})}),abort(){ir.tasks.delete(e)}}}function ka(t,e){sn(()=>{t.dispatchEvent(new CustomEvent(e))})}function bh(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function mc(t){const e={},r=t.split(";");for(const s of r){const[n,a]=s.split(":");if(!n||a===void 0)break;const o=bh(n.trim());e[o]=a.trim()}return e}const Eh=t=>t;let fu=null;function gc(t){fu=t}function ay(t,e,r){var s=fu??Z,n=s.nodes,a,o,c,l=null;n.a??(n.a={element:t,measure(){a=this.element.getBoundingClientRect()},apply(){if(c?.abort(),o=this.element.getBoundingClientRect(),a.left!==o.left||a.right!==o.right||a.top!==o.top||a.bottom!==o.bottom){const u=e()(this.element,{from:a,to:o},r?.());c=si(this.element,u,void 0,1,()=>{c?.abort(),c=void 0})}},fix(){if(!t.getAnimations().length){var{position:u,width:d,height:h}=getComputedStyle(t);if(u!=="absolute"&&u!=="fixed"){var p=t.style;l={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=d,p.height=h;var g=t.getBoundingClientRect();if(a.left!==g.left||a.top!==g.top){var w=`translate(${a.left-g.left}px, ${a.top-g.top}px)`;p.transform=p.transform?`${p.transform} ${w}`:w}}}},unfix(){if(l){var u=t.style;u.position=l.position,u.width=l.width,u.height=l.height,u.transform=l.transform}}}),n.a.element=t}function iy(t,e,r,s){var H;var n=(t&pf)!==0,a=(t&mf)!==0,o=n&&a,c=(t&gf)!==0,l=o?"both":n?"in":"out",u,d=e.inert,h=e.style.overflow,p,g;function w(){return sn(()=>u??(u=r()(e,s?.()??{},{direction:l})))}var A={is_global:c,in(){if(e.inert=d,!n){g?.abort(),g?.reset?.();return}a||p?.abort(),ka(e,"introstart"),p=si(e,w(),g,1,()=>{ka(e,"introend"),p?.abort(),p=u=void 0,e.style.overflow=h})},out(B){if(!a){B?.(),u=void 0;return}e.inert=!0,ka(e,"outrostart"),g=si(e,w(),p,0,()=>{ka(e,"outroend"),B?.()})},stop:()=>{p?.abort(),g?.abort()}},E=Z;if(((H=E.nodes).t??(H.t=[])).push(A),n&&ri){var I=c;if(!I){for(var $=E.parent;$&&($.f&Ot)!==0;)for(;($=$.parent)&&($.f&Vt)===0;);I=!$||($.f&pa)!==0}I&&va(()=>{pr(()=>A.in())})}}function si(t,e,r,s,n){var a=s===1;if(Es(e)){var o,c=!1;return At(()=>{if(!c){var E=e({direction:a?"in":"out"});o=si(t,E,r,s,n)}}),{abort:()=>{c=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(r?.deactivate(),!e?.duration)return n(),{abort:cn,deactivate:cn,reset:cn,t:()=>s};const{delay:l=0,css:u,tick:d,easing:h=Eh}=e;var p=[];if(a&&r===void 0&&(d&&d(0,1),u)){var g=mc(u(0,1));p.push(g,g)}var w=()=>1-s,A=t.animate(p,{duration:l,fill:"forwards"});return A.onfinish=()=>{A.cancel();var E=r?.t()??1-s;r?.abort();var I=s-E,$=e.duration*Math.abs(I),H=[];if($>0){var B=!1;if(u)for(var G=Math.ceil($/16.666666666666668),N=0;N<=G;N+=1){var U=E+I*h(N/G),F=mc(u(U,1-U));H.push(F),B||(B=F.overflow==="hidden")}B&&(t.style.overflow="hidden"),w=()=>{var se=A.currentTime;return E+I*h(se/$)},d&&vh(()=>{if(A.playState!=="running")return!1;var se=w();return d(se,1-se),!0})}A=t.animate(H,{duration:$,fill:"forwards"}),A.onfinish=()=>{w=()=>s,d?.(s,1-s),n()}},{abort:()=>{A&&(A.cancel(),A.effect=null,A.onfinish=cn)},deactivate:()=>{n=cn},reset:()=>{s===0&&d?.(1,0)},t:()=>w()}}function oy(t,e,r,s,n,a){let o=k;k&&Bt();var c=null;k&&X.nodeType===Jd&&(c=X,Bt());var l=k?X:t,u=Z,d=new Sa(l,!1);ps(()=>{const h=e()||null;var p=Ef;if(h===null){d.ensure(null,null),$a(!0);return}return d.ensure(h,g=>{if(h){if(c=k?c:document.createElementNS(p,h),at(c,c),s){k&&ch(h)&&c.append(document.createComment(""));var w=k?Je(c):c.appendChild(Ue());k&&(w===null?St(!1):Pe(w)),gc(u),s(c,w),gc(null)}Z.nodes.end=c,g.before(c)}k&&Pe(g)}),$a(!0),()=>{h&&$a(!1)}},Ot),wa(()=>{$a(!0)}),o&&(St(!0),Pe(l))}function Sh(t,e){var r=void 0,s;Yl(()=>{r!==(r=e())&&(s&&(De(s),s=null),r&&(s=Ge(()=>{va(()=>r(t))})))})}function hu(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=hu(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Ih(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=hu(t))&&(s&&(s+=" "),s+=e);return s}function Ah(t){return typeof t=="object"?Ih(t):t??""}const yc=[...` 	
\r\fÂ \v\uFEFF`];function _h(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var n in r)if(r[n])s=s?s+" "+n:n;else if(s.length)for(var a=n.length,o=0;(o=s.indexOf(n,o))>=0;){var c=o+a;(o===0||yc.includes(s[o-1]))&&(c===s.length||yc.includes(s[c]))?s=(o===0?"":s.substring(0,o))+s.substring(c+1):o=c}}return s===""?null:s}function wc(t,e=!1){var r=e?" !important;":";",s="";for(var n in t){var a=t[n];a!=null&&a!==""&&(s+=" "+n+": "+a+r)}return s}function qi(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Rh(t,e){if(e){var r="",s,n;if(Array.isArray(e)?(s=e[0],n=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,o=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(qi)),n&&l.push(...Object.keys(n).map(qi));var u=0,d=-1;const A=t.length;for(var h=0;h<A;h++){var p=t[h];if(c?p==="/"&&t[h-1]==="*"&&(c=!1):a?a===p&&(a=!1):p==="/"&&t[h+1]==="*"?c=!0:p==='"'||p==="'"?a=p:p==="("?o++:p===")"&&o--,!c&&a===!1&&o===0){if(p===":"&&d===-1)d=h;else if(p===";"||h===A-1){if(d!==-1){var g=qi(t.substring(u,d).trim());if(!l.includes(g)){p!==";"&&h++;var w=t.substring(u,h).trim();r+=" "+w+";"}}u=h+1,d=-1}}}}return s&&(r+=wc(s)),n&&(r+=wc(n,!0)),r=r.trim(),r===""?null:r}return t==null?null:String(t)}function Ph(t,e,r,s,n,a){var o=t.__className;if(k||o!==r||o===void 0){var c=_h(r,s,a);(!k||c!==t.getAttribute("class"))&&(c==null?t.removeAttribute("class"):e?t.className=c:t.setAttribute("class",c)),t.__className=r}else if(a&&n!==a)for(var l in a){var u=!!a[l];(n==null||u!==!!n[l])&&t.classList.toggle(l,u)}return a}function Ui(t,e={},r,s){for(var n in r){var a=r[n];e[n]!==a&&(r[n]==null?t.style.removeProperty(n):t.style.setProperty(n,a,s))}}function Dh(t,e,r,s){var n=t.__style;if(k||n!==e){var a=Rh(e,s);(!k||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=e}else s&&(Array.isArray(s)?(Ui(t,r?.[0],s[0]),Ui(t,r?.[1],s[1],"important")):Ui(t,r,s));return s}function ni(t,e,r=!1){if(t.multiple){if(e==null)return;if(!_i(e))return If();for(var s of t.options)s.selected=e.includes(vn(s));return}for(s of t.options){var n=vn(s);if(Ol(n,e)){s.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function pu(t){var e=new MutationObserver(()=>{ni(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),wa(()=>{e.disconnect()})}function cy(t,e,r=e){var s=new WeakSet,n=!0;ki(t,"change",a=>{var o=a?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(o),vn);else{var l=t.querySelector(o)??t.querySelector("option:not([disabled])");c=l&&vn(l)}r(c),ee!==null&&s.add(ee)}),va(()=>{var a=e();if(t===document.activeElement){var o=yn??ee;if(s.has(o))return}if(ni(t,a,n),n&&a===void 0){var c=t.querySelector(":checked");c!==null&&(a=vn(c),r(a))}t.__value=a,n=!1}),pu(t)}function vn(t){return"__value"in t?t.__value:t.value}const ln=Symbol("class"),un=Symbol("style"),mu=Symbol("is custom element"),gu=Symbol("is html");function Mh(t){if(k){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var s=t.value;ai(t,"value",null),t.value=s}if(t.hasAttribute("checked")){var n=t.checked;ai(t,"checked",null),t.checked=n}}};t.__on_r=r,At(r),Gl()}}function ly(t,e){var r=Ci(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function uy(t,e){var r=Ci(t);r.checked!==(r.checked=e??void 0)&&(t.checked=e)}function $h(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function ai(t,e,r,s){var n=Ci(t);k&&(n[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(t[Qd]=r),r==null?t.removeAttribute(e):typeof r!="string"&&yu(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function kh(t,e,r,s,n=!1,a=!1){if(k&&n&&t.tagName==="INPUT"){var o=t,c=o.type==="checkbox"?"defaultChecked":"defaultValue";c in r||Mh(o)}var l=Ci(t),u=l[mu],d=!l[gu];let h=k&&u;h&&St(!1);var p=e||{},g=t.tagName==="OPTION";for(var w in e)w in r||(r[w]=null);r.class?r.class=Ah(r.class):r[ln]&&(r.class=null),r[un]&&(r.style??(r.style=null));var A=yu(t);for(const N in r){let U=r[N];if(g&&N==="value"&&U==null){t.value=t.__value="",p[N]=U;continue}if(N==="class"){var E=t.namespaceURI==="http://www.w3.org/1999/xhtml";Ph(t,E,U,s,e?.[ln],r[ln]),p[N]=U,p[ln]=r[ln];continue}if(N==="style"){Dh(t,U,e?.[un],r[un]),p[N]=U,p[un]=r[un];continue}var I=p[N];if(!(U===I&&!(U===void 0&&t.hasAttribute(N)))){p[N]=U;var $=N[0]+N[1];if($!=="$$")if($==="on"){const F={},se="$$"+N;let V=N.slice(2);var H=rh(V);if(eh(V)&&(V=V.slice(0,-7),F.capture=!0),!H&&I){if(U!=null)continue;t.removeEventListener(V,p[se],F),p[se]=null}if(U!=null)if(H)t[`__${V}`]=U,lh([V]);else{let an=function(on){p[N].call(this,on)};p[se]=Do(V,t,an,F)}else H&&(t[`__${V}`]=void 0)}else if(N==="style")ai(t,N,U);else if(N==="autofocus")Vf(t,!!U);else if(!u&&(N==="__value"||N==="value"&&U!=null))t.value=t.__value=U;else if(N==="selected"&&g)$h(t,U);else{var B=N;d||(B=nh(B));var G=B==="defaultValue"||B==="defaultChecked";if(U==null&&!u&&!G)if(l[N]=null,B==="value"||B==="checked"){let F=t;const se=e===void 0;if(B==="value"){let V=F.defaultValue;F.removeAttribute(B),F.defaultValue=V,F.value=F.__value=se?V:null}else{let V=F.defaultChecked;F.removeAttribute(B),F.defaultChecked=V,F.checked=se?V:!1}}else t.removeAttribute(N);else G||A.includes(B)&&(u||typeof U!="string")?(t[B]=U,B in l&&(l[B]=_e)):typeof U!="function"&&ai(t,B,U)}}}return h&&St(!0),p}function dy(t,e,r=[],s=[],n=[],a,o=!1,c=!1){Nl(n,r,s,l=>{var u=void 0,d={},h=t.nodeName==="SELECT",p=!1;if(Yl(()=>{var w=e(...l.map(f)),A=kh(t,u,w,a,o,c);p&&h&&"value"in w&&ni(t,w.value);for(let I of Object.getOwnPropertySymbols(d))w[I]||De(d[I]);for(let I of Object.getOwnPropertySymbols(w)){var E=w[I];I.description===Sf&&(!u||E!==u[I])&&(d[I]&&De(d[I]),d[I]=Ge(()=>Sh(t,()=>E))),A[I]=E}u=A}),h){var g=t;va(()=>{ni(g,u.value,!0),pu(g)})}p=!0})}function Ci(t){return t.__attributes??(t.__attributes={[mu]:t.nodeName.includes("-"),[gu]:t.namespaceURI===bf})}var vc=new Map;function yu(t){var e=t.getAttribute("is")||t.nodeName,r=vc.get(e);if(r)return r;vc.set(e,r=[]);for(var s,n=t,a=Element.prototype;a!==n;){s=fl(n);for(var o in s)s[o].set&&r.push(o);n=Pi(n)}return r}let Oi=null;function Ch(){if(Oi===null){var t=document.createElement("select");t.innerHTML="<option><span>t</span></option>",Oi=t.firstChild?.firstChild?.nodeType===1}return Oi}function fy(t,e){var r=k;Ch()||(St(!1),t.textContent="",t.append(Hf("")));try{e()}finally{r&&(k?_f(t):(St(!0),Pe(t)))}}function hy(t,e,r=e){var s=new WeakSet;ki(t,"input",async n=>{var a=n?t.defaultValue:t.value;if(a=xi(t)?Hi(a):a,r(a),ee!==null&&s.add(ee),await zf(),a!==(a=e())){var o=t.selectionStart,c=t.selectionEnd,l=t.value.length;if(t.value=a??"",c!==null){var u=t.value.length;o===c&&c===l&&u>l?(t.selectionStart=u,t.selectionEnd=u):(t.selectionStart=o,t.selectionEnd=Math.min(c,u))}}}),(k&&t.defaultValue!==t.value||pr(e)==null&&t.value)&&(r(xi(t)?Hi(t.value):t.value),ee!==null&&s.add(ee)),ba(()=>{var n=e();if(t===document.activeElement){var a=yn??ee;if(s.has(a))return}xi(t)&&n===Hi(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}const Bi=new Set;function py(t,e,r,s,n=s){var a=r.getAttribute("type")==="checkbox",o=t;let c=!1;if(e!==null)for(var l of e)o=o[l]??(o[l]=[]);o.push(r),ki(r,"change",()=>{var u=r.__value;a&&(u=bc(o,u,r.checked)),n(u)},()=>n(a?[]:null)),ba(()=>{var u=s();if(k&&r.defaultChecked!==r.checked){c=!0;return}a?(u=u||[],r.checked=u.includes(r.__value)):r.checked=Ol(r.__value,u)}),wa(()=>{var u=o.indexOf(r);u!==-1&&o.splice(u,1)}),Bi.has(o)||(Bi.add(o),At(()=>{o.sort((u,d)=>u.compareDocumentPosition(d)===4?-1:1),Bi.delete(o)})),At(()=>{if(c){var u;if(a)u=bc(o,u,r.checked);else{var d=o.find(h=>h.checked);u=d?.__value}n(u)}})}function my(t,e,r=e){ki(t,"change",s=>{var n=s?t.defaultChecked:t.checked;r(n)}),(k&&t.defaultChecked!==t.checked||pr(e)==null)&&r(t.checked),ba(()=>{var s=e();t.checked=!!s})}function bc(t,e,r){for(var s=new Set,n=0;n<t.length;n+=1)t[n].checked&&s.add(t[n].__value);return r||s.delete(e),Array.from(s)}function xi(t){var e=t.type;return e==="number"||e==="range"}function Hi(t){return t===""?null:+t}function Ec(t,e){return t===e||t?.[Ut]===e}function gy(t={},e,r,s){return va(()=>{var n,a;return ba(()=>{n=a,a=s?.()||[],pr(()=>{t!==r(...a)&&(e(t,...a),n&&Ec(r(...n),t)&&e(null,...n))})}),()=>{At(()=>{a&&Ec(r(...a),t)&&e(null,...a)})}}),t}function yy(t=!1){const e=ye,r=e.l.u;if(!r)return;let s=()=>Ff(e.s);if(t){let n=0,a={};const o=ya(()=>{let c=!1;const l=e.s;for(const u in l)l[u]!==a[u]&&(a[u]=l[u],c=!0);return c&&n++,n});s=()=>f(o)}r.b.length&&Gf(()=>{Sc(e,s),Ki(r.b)}),qr(()=>{const n=pr(()=>r.m.map(Gd));return()=>{for(const a of n)typeof a=="function"&&a()}}),r.a.length&&qr(()=>{Sc(e,s),Ki(r.a)})}function Sc(t,e){if(t.l.s)for(const r of t.l.s)f(r);e()}let Ca=!1;function Th(t){var e=Ca;try{return Ca=!1,[t(),Ca]}finally{Ca=e}}const Nh={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function wy(t,e,r){return new Proxy({props:t,exclude:e},Nh)}const Lh={get(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Es(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(t,e,r){let s=t.props.length;for(;s--;){let n=t.props[s];Es(n)&&(n=n());const a=Tr(n,e);if(a&&a.set)return a.set(r),!0}return!1},getOwnPropertyDescriptor(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Es(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const n=Tr(s,e);return n&&!n.configurable&&(n.configurable=!0),n}}},has(t,e){if(e===Ut||e===yl)return!1;for(let r of t.props)if(Es(r)&&(r=r()),r!=null&&e in r)return!0;return!1},ownKeys(t){const e=[];for(let r of t.props)if(Es(r)&&(r=r()),!!r){for(const s in r)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(r))e.includes(s)||e.push(s)}return e}};function vy(...t){return new Proxy({props:t},Lh)}function by(t,e,r,s){var n=!tn||(r&uf)!==0,a=(r&ff)!==0,o=(r&hf)!==0,c=s,l=!0,u=()=>(l&&(l=!1,c=o?pr(s):s),c),d;if(a){var h=Ut in t||yl in t;d=Tr(t,e)?.set??(h&&e in t?H=>t[e]=H:void 0)}var p,g=!1;a?[p,g]=Th(()=>t[e]):p=t[e],p===void 0&&s!==void 0&&(p=u(),d&&(n&&Fd(),d(p)));var w;if(n?w=()=>{var H=t[e];return H===void 0?u():(l=!0,H)}:w=()=>{var H=t[e];return H!==void 0&&(c=void 0),H===void 0?c:H},n&&(r&df)===0)return w;if(d){var A=t.$$legacy;return(function(H,B){return arguments.length>0?((!n||!B||A||g)&&d(B?w():H),H):w()})}var E=!1,I=((r&lf)!==0?ya:Ao)(()=>(E=!1,w()));a&&f(I);var $=Z;return(function(H,B){if(arguments.length>0){const G=B?f(I):n&&a?ge(H):H;return m(I,G),E=!0,c!==void 0&&(c=G),H}return Ur&&E||($.f&cr)!==0?I.v:f(I)})}function jh(t){ye===null&&wl(),tn&&ye.l!==null?qh(ye).m.push(t):qr(()=>{const e=pr(t);if(typeof e=="function")return e})}function Ey(t){ye===null&&wl(),jh(()=>()=>pr(t))}function qh(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Uh="5";var dl;typeof window<"u"&&((dl=window.__svelte??(window.__svelte={})).v??(dl.v=new Set)).add(Uh);const Oh="modulepreload",Bh=function(t){return"/app/"+t},Ic={},J=function(e,r,s){let n=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");n=l(r.map(u=>{if(u=Bh(u),u in Ic)return;Ic[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Oh,d||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((g,w)=>{p.addEventListener("load",g),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})};var xh=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Hh=["difference","intersection","symmetricDifference","union"],Ac=!1,Cs,wt,br,hi,Fs,wu,vu;const pi=class pi extends Set{constructor(r){super();y(this,Fs);y(this,Cs,new Map);y(this,wt,P(0));y(this,br,P(0));y(this,hi,It||-1);if(r){for(var s of r)super.add(s);i(this,br).v=super.size}Ac||b(this,Fs,vu).call(this)}has(r){var s=super.has(r),n=i(this,Cs),a=n.get(r);if(a===void 0){if(!s)return f(i(this,wt)),!1;a=b(this,Fs,wu).call(this,!0),n.set(r,a)}return f(a),s}add(r){return super.has(r)||(super.add(r),m(i(this,br),super.size),Re(i(this,wt))),this}delete(r){var s=super.delete(r),n=i(this,Cs),a=n.get(r);return a!==void 0&&(n.delete(r),m(a,!1)),s&&(m(i(this,br),super.size),Re(i(this,wt))),s}clear(){if(super.size!==0){super.clear();var r=i(this,Cs);for(var s of r.values())m(s,!1);r.clear(),m(i(this,br),0),Re(i(this,wt))}}keys(){return this.values()}values(){return f(i(this,wt)),super.values()}entries(){return f(i(this,wt)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return f(i(this,br))}};Cs=new WeakMap,wt=new WeakMap,br=new WeakMap,hi=new WeakMap,Fs=new WeakSet,wu=function(r){return It===i(this,hi)?P(r):dr(r)},vu=function(){Ac=!0;var r=pi.prototype,s=Set.prototype;for(const n of xh)r[n]=function(...a){return f(i(this,wt)),s[n].apply(this,a)};for(const n of Hh)r[n]=function(...a){f(i(this,wt));var o=s[n].apply(this,a);return new pi(o)}};let _c=pi;var $t,kt,zt,mi,Et,pn,xa;const xo=class xo extends Map{constructor(r){super();y(this,Et);y(this,$t,new Map);y(this,kt,P(0));y(this,zt,P(0));y(this,mi,It||-1);if(r){for(var[s,n]of r)super.set(s,n);i(this,zt).v=super.size}}has(r){var s=i(this,$t),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=b(this,Et,pn).call(this,0),s.set(r,n);else return f(i(this,kt)),!1}return f(n),!0}forEach(r,s){b(this,Et,xa).call(this),super.forEach(r,s)}get(r){var s=i(this,$t),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=b(this,Et,pn).call(this,0),s.set(r,n);else{f(i(this,kt));return}}return f(n),super.get(r)}set(r,s){var n=i(this,$t),a=n.get(r),o=super.get(r),c=super.set(r,s),l=i(this,kt);if(a===void 0)a=b(this,Et,pn).call(this,0),n.set(r,a),m(i(this,zt),super.size),Re(l);else if(o!==s){Re(a);var u=l.reactions===null?null:new Set(l.reactions),d=u===null||!a.reactions?.every(h=>u.has(h));d&&Re(l)}return c}delete(r){var s=i(this,$t),n=s.get(r),a=super.delete(r);return n!==void 0&&(s.delete(r),m(i(this,zt),super.size),m(n,-1),Re(i(this,kt))),a}clear(){if(super.size!==0){super.clear();var r=i(this,$t);m(i(this,zt),0);for(var s of r.values())m(s,-1);Re(i(this,kt)),r.clear()}}keys(){return f(i(this,kt)),super.keys()}values(){return b(this,Et,xa).call(this),super.values()}entries(){return b(this,Et,xa).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(i(this,zt)),super.size}};$t=new WeakMap,kt=new WeakMap,zt=new WeakMap,mi=new WeakMap,Et=new WeakSet,pn=function(r){return It===i(this,mi)?P(r):dr(r)},xa=function(){f(i(this,kt));var r=i(this,$t);if(i(this,zt).v!==r.size){for(var s of tc(xo.prototype,this,"keys").call(this))if(!r.has(s)){var n=b(this,Et,pn).call(this,0);r.set(s,n)}}for([,n]of i(this,$t))f(n)};let ft=xo;const Vh=Symbol();var ke,Dn,Ft,es,mn;class Wh extends URLSearchParams{constructor(){super(...arguments);y(this,es);y(this,ke,P(0));y(this,Dn,Qh());y(this,Ft,!1)}[Vh](r){if(!i(this,Ft)){_(this,Ft,!0);for(const s of[...super.keys()])super.delete(s);for(const[s,n]of r)super.append(s,n);Re(i(this,ke)),_(this,Ft,!1)}}append(r,s){super.append(r,s),b(this,es,mn).call(this),Re(i(this,ke))}delete(r,s){var n=super.has(r,s);super.delete(r,s),n&&(b(this,es,mn).call(this),Re(i(this,ke)))}get(r){return f(i(this,ke)),super.get(r)}getAll(r){return f(i(this,ke)),super.getAll(r)}has(r,s){return f(i(this,ke)),super.has(r,s)}keys(){return f(i(this,ke)),super.keys()}set(r,s){var n=super.getAll(r).join("");super.set(r,s),n!==super.getAll(r).join("")&&(b(this,es,mn).call(this),Re(i(this,ke)))}sort(){super.sort(),b(this,es,mn).call(this),Re(i(this,ke))}toString(){return f(i(this,ke)),super.toString()}values(){return f(i(this,ke)),super.values()}entries(){return f(i(this,ke)),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(i(this,ke)),super.size}}ke=new WeakMap,Dn=new WeakMap,Ft=new WeakMap,es=new WeakSet,mn=function(){if(!i(this,Dn)||i(this,Ft))return;_(this,Ft,!0);const r=this.toString();i(this,Dn).search=r&&`?${r}`,_(this,Ft,!1)};let Gh=null;function Qh(){return Gh}var Mn,$n;class bu{constructor(e,r){y(this,Mn);y(this,$n);_(this,Mn,e),_(this,$n,Io(r))}get current(){return i(this,$n).call(this),i(this,Mn).call(this)}}Mn=new WeakMap,$n=new WeakMap;const Jh=/\(.+\)/,Kh=new Set(["all","print","screen","and","or","not","only"]);class Rc extends bu{constructor(e,r){let s=Jh.test(e)||e.split(/[\s,]+/).some(a=>Kh.has(a.trim()))?e:`(${e})`;const n=window.matchMedia(s);super(()=>n.matches,a=>zs(n,"change",a))}}const Eu=typeof window<"u"?window:void 0;function Yh(t){let e=t.activeElement;for(;e?.shadowRoot;){const r=e.shadowRoot.activeElement;if(r===e)break;e=r}return e}var Ts,kn;class Xh{constructor(e={}){y(this,Ts);y(this,kn);const{window:r=Eu,document:s=r?.document}=e;r!==void 0&&(_(this,Ts,s),_(this,kn,Io(n=>{const a=zs(r,"focusin",n),o=zs(r,"focusout",n);return()=>{a(),o()}})))}get current(){var e;return(e=i(this,kn))==null||e.call(this),i(this,Ts)?Yh(i(this,Ts)):null}}Ts=new WeakMap,kn=new WeakMap;new Xh;function Su(t){return typeof t=="function"}function Iu(t,e){if(Su(t)){const s=t();return s===void 0?e:s}return t===void 0?e:t}function Zh(t,e){let r=P(null);const s=z(()=>Iu(e,250));function n(...a){if(f(r))f(r).timeout&&clearTimeout(f(r).timeout);else{let o,c;const l=new Promise((u,d)=>{o=u,c=d});m(r,{timeout:null,runner:null,promise:l,resolve:o,reject:c},!0)}return f(r).runner=async()=>{if(!f(r))return;const o=f(r);m(r,null);try{o.resolve(await t.apply(this,a))}catch(c){o.reject(c)}},f(r).timeout=setTimeout(f(r).runner,f(s)),f(r).promise}return n.cancel=async()=>{(!f(r)||f(r).timeout===null)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||f(r).timeout===null)||(clearTimeout(f(r).timeout),f(r).reject("Cancelled"),m(r,null))},n.runScheduledNow=async()=>{(!f(r)||!f(r).timeout)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||!f(r).timeout)||(clearTimeout(f(r).timeout),f(r).timeout=null,await f(r).runner?.())},Object.defineProperty(n,"pending",{enumerable:!0,get(){return!!f(r)?.timeout}}),n}function zh(t){return Su(t)?t():t}function Sy(t,e,r={}){const{root:s,rootMargin:n="0px",threshold:a=.1,immediate:o=!0,window:c=Eu,once:l=!1}=r;let u=P(ge(o)),d;const h=z(()=>{const g=Iu(t);return new Set(g?Array.isArray(g)?g:[g]:[])}),p=Kl(()=>{qr(()=>{if(!f(h).size||!f(u)||!c)return;const g=(w,A)=>{w.forEach(E=>{const I=Array.isArray(a)?a.some(H=>E.intersectionRatio>=H):E.intersectionRatio>=a,$=E.isIntersecting&&I;if(e([E],A),l&&$)return m(u,!1),()=>{A?.disconnect()}})};d=new c.IntersectionObserver(g,{rootMargin:n,root:zh(s),threshold:a});for(const w of f(h))d.observe(w);return()=>{d?.disconnect()}})});return qr(()=>p),{get isActive(){return f(u)},stop:p,pause(){m(u,!1)},resume(){m(u,!0)}}}function Au(t,e){switch(e){case"kg":case"l.":return Math.round(t*100)/100;case"gr.":case"ml":return Math.round(t);default:return Math.round(t*10)/10}}function ut(t){return t?.length?t.map(e=>Jr(e.q,e.u)).join(" et "):"-"}function Fh(t,e){const r=typeof t=="number"?t:parseFloat(t);if(isNaN(r))return{value:0,unit:e};let s=e,n=r;return(e==="gr."||e==="ml")&&r>=1e3?(n=r/1e3,s=e==="gr."?"kg":"l."):(e==="kg"||e==="l.")&&r<1&&r>0&&(n=r*1e3,s=e==="kg"?"gr.":"ml"),{value:Au(n,s),unit:s}}function Jr(t,e){const{value:r,unit:s}=Fh(t,e);let n;return s==="kg"||s==="l."?n=r.toFixed(2).replace(/\.?0+$/,""):n=r.toString(),`${n} ${s}`}function Iy(t,e,r){if(e==="au goÃ»t")return{quantity:t,unit:e,formatted:`${t} ${e}`,formattedNumber:`${t}`};const s=t*r,{q:n,u:a}=ep(s,e),o=Au(n,a);let c=`${o}`;return(a==="kg"||a==="l.")&&(c=o.toFixed(2).replace(/\.?0+$/,"")),{quantity:o,unit:a,formatted:`${c} ${a}`,formattedNumber:c}}function ep(t,e){const r=e.toLowerCase().trim();return(r==="gr."||r==="ml")&&t>=1e3?{q:t/1e3,u:r==="gr."?"kg":"l."}:(r==="kg"||r==="l.")&&t<1&&t>0?{q:t*1e3,u:r==="kg"?"gr.":"ml"}:{q:t,u:e}}function ao(t){if(!t?.length)return[];const e=new Map;return t.forEach(({q:r,u:s})=>{if(typeof r=="number"&&!isNaN(r)){const n=e.get(s)||0;e.set(s,n+r)}}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function tp(t,e){const r=new Map,s=new Map;t.forEach(({q:o,u:c})=>{r.set(c,(r.get(c)||0)+o)}),e.forEach(({q:o,u:c})=>{s.set(c,(s.get(c)||0)+o)});const n=[],a=new Set([...r.keys(),...s.keys()]);for(const o of a){const c=r.get(o)||0,l=s.get(o)||0,u=c-l;Math.abs(u)>.001&&n.push({q:u,u:o})}return n}function kr(t){if(!t?.trim())return null;try{return JSON.parse(t)}catch(e){return console.warn("[ProductsStore] Erreur parsing JSON:",e),null}}function $o(t){return t?.length?t.filter(e=>e.quantity!=null&&e.unit).map(e=>({q:typeof e.quantity=="number"?e.quantity:parseFloat(e.quantity),u:e.unit})).filter(e=>!isNaN(e.q)):[]}function ko(t){if(!t?.length)return[];const e=new Map;return t.forEach(r=>{if(!r.q||!r.u||typeof r.q!="number"||isNaN(r.q))return;const s=e.get(r.u)||0;e.set(r.u,s+r.q)}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function Ti(t,e){if(!t?.length)return{numeric:[],display:"â Complet"};if(!e?.length){const c=t.map(l=>Jr(l.q,l.u)).join(" et ");return{numeric:t,display:c}}const r=new Map,s=new Map;t.forEach(c=>{const l=parseFloat(c.q);isNaN(l)||r.set(c.u,(r.get(c.u)||0)+l)}),e.forEach(c=>{s.set(c.u,(s.get(c.u)||0)+c.q)});const n=[],a=[];r.forEach((c,l)=>{const u=s.get(l)||0,d=c-u;d>0&&(n.push({q:d,u:l}),a.push(Jr(d,l)))});const o=a.length>0?a.join(" et "):"â Complet";return{numeric:n,display:o}}function rp(t){return t?Object.values(t).some(e=>e.recipes?.some(r=>r.q!==void 0||r.u!==void 0)):!1}function Ay(t){if(!t)return[];const e=[];return Object.entries(t).forEach(([r,s])=>{s.recipes?.forEach(n=>{e.push({...n,date:r,dateTimeService:r})})}),e}function Pc(t){if(!t?.length)return"ÃquilibrÃ©";const e=t.filter(s=>s.q>0),r=t.filter(s=>s.q<0);if(e.length>0&&r.length>0){const s=e.map(a=>Jr(a.q,a.u)).join(" et "),n=r.map(a=>Jr(Math.abs(a.q),a.u)).join(" et ");return`${s} disponibles, ${n} manquant${r.length>1?"s":""}`}else return e.length>0?e.map(s=>"+"+Jr(s.q,s.u)).join(" et ")+" disponibles":r.length>0?r.map(s=>Jr(Math.abs(s.q),s.u)).join(" et ")+` manquant${r.length>1?"s":""}`:"ÃquilibrÃ©"}function sp(t,e){if(e.searchQuery.trim()){const s=e.searchQuery.toLowerCase();if(!t.productName.toLowerCase().includes(s))return!1}if(e.selectedStores.length>0&&(!t.storeInfo?.storeName||!e.selectedStores.includes(t.storeInfo.storeName))||e.selectedWho.length>0&&(!t.who||!t.who.some(s=>e.selectedWho.includes(s)))||e.selectedProductTypes.length>0&&(!t.productType||!e.selectedProductTypes.includes(t.productType)))return!1;const r=e.temperatureFilter;if(r&&r!=="all")switch(r){case"frais":if(!t.pF)return!1;break;case"not-frais":if(t.pF)return!1;break;case"surgele":if(!t.pS)return!1;break;case"not-surgele":if(t.pS)return!1;break}return!0}function _u(t){return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function np(t,e,r=.01){if(!t?.length&&!e?.length)return!0;if(!t?.length||!e?.length)return!1;const s=new Map(t.map(c=>[c.u,c.q])),n=new Map(e.map(c=>[c.u,c.q])),a=Array.from(s.keys()).sort(),o=Array.from(n.keys()).sort();if(a.length!==o.length||!a.every((c,l)=>c===o[l]))return!1;for(const[c,l]of s){const u=n.get(c);if(u===void 0)return!1;const d=Math.abs(l-u),h=Math.max(l,u),p=Math.max(h*r,1);if(d>p)return!1}return!0}function _y(t){const e=t.totalNeededOverrideParsed;if(!e)return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};if(!(e.totalComputedWhenOverride!==void 0&&e.platesNbWhenOverride!==void 0&&e.recipesNbWhenOverride!==void 0))return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};const s=e.totalComputedWhenOverride,n=t.totalNeededArray,a=e.platesNbWhenOverride,o=t.totalAssiettes,c=e.recipesNbWhenOverride,l=t.nbRecipes,u=!np(s,n),d=a!==o,h=c!==l,p=u||d||h;return{hasMismatch:p,computedChanged:u,platesChanged:d,recipesChanged:h,details:p?{oldComputed:s,newComputed:n,oldPlates:a,newPlates:o,oldRecipes:c,newRecipes:l}:void 0}}function Dc(t){return{...t,products:t.products?.map(e=>typeof e=="string"?e:e.$id)||[],mainId:t.mainId}}class Co{static normalize(e,r,s=""){const n=r.toLowerCase(),a=s.toLowerCase(),o=n.includes("caf"),c=n.includes("soupe"),l=n.includes("pinc"),u=n.includes("gousse"),d=n.includes("tÃªte"),h=n.includes("unit")||n==="piÃ¨ce"||n==="piece",p=a.includes("sucre"),g=a.includes("sel"),w=a.includes("farine"),A=a.includes("crÃ¨me Ã©paisse")||a.includes("creme epaisse"),E=a==="ail",I=a.includes("oignon"),$=a==="tomate",H=a==="poireau",B=a.includes("aubergine"),G=a==="courgette",N=a==="Ã©chalote"||a==="echalote",U=a==="orange"&&!a.includes("jus"),F=a.includes("citron")&&!a.includes("jus"),se=a==="concombre",V=a==="levure chimique",an=a==="carotte",on=a==="betterave rouge",Ho=a.includes("semoule"),Vo=a.includes("poivre"),Wo=a.includes("cacao"),Go=a.includes("sucre glace"),Qo=a.includes("maizena")||a.includes("maÃ¯zena"),Jo=a.includes("bicarbonate"),Ko=a.includes("curcuma"),Yo=a.includes("cumin"),Xo=a.includes("curry"),Zo=a.includes("muscade"),zo=a.includes("paprika"),Fo=a.includes("miel");let Qt=e,ys=r,_t=!1,Hr="",W="";if(o){_t=!0;let L="cafe_default";W="ml",p?(L="cafe_sucre",W="gr."):g?(L="cafe_sel",W="gr."):w?(L="cafe_farine",W="gr."):Ho?(L="cafe_semoule",W="gr."):Vo?(L="cafe_poivre",W="gr."):Wo?(L="cafe_cacao",W="gr."):Go?(L="cafe_sucre_glace",W="gr."):Qo?(L="cafe_maizena",W="gr."):Jo?(L="cafe_bicarbonate",W="gr."):Ko?(L="cafe_curcuma",W="gr."):Yo?(L="cafe_cumin",W="gr."):Xo?(L="cafe_curry",W="gr."):Zo?(L="cafe_muscade",W="gr."):zo?(L="cafe_paprika",W="gr."):Fo?(L="cafe_miel",W="gr."):A&&(L="cafe_creme_epaisse",W="ml"),Qt=e*this.CONVERSION_RULES[L],Hr=`1 c. Ã  cafÃ© = ${this.CONVERSION_RULES[L]} ${W}`}else if(c){_t=!0;let L="soupe_default";W="ml",p?(L="soupe_sucre",W="gr."):g?(L="soupe_sel",W="gr."):w?(L="soupe_farine",W="gr."):Ho?(L="soupe_semoule",W="gr."):Vo?(L="soupe_poivre",W="gr."):Wo?(L="soupe_cacao",W="gr."):Go?(L="soupe_sucre_glace",W="gr."):Qo?(L="soupe_maizena",W="gr."):A?(L="soupe_creme_epaisse",W="ml"):Jo?(L="soupe_bicarbonate",W="gr."):Ko?(L="soupe_curcuma",W="gr."):Yo?(L="soupe_cumin",W="gr."):Xo?(L="soupe_curry",W="gr."):Zo?(L="soupe_muscade",W="gr."):zo?(L="soupe_paprika",W="gr."):Fo&&(L="soupe_miel",W="gr."),Qt=e*this.CONVERSION_RULES[L],Hr=`1 c. Ã  soupe = ${this.CONVERSION_RULES[L]} ${W}`}else if(l)_t=!0,W="gr.",Qt=e*this.CONVERSION_RULES.pincee,Hr="1 pincÃ©e = 0.4 gr.";else if(u&&E)_t=!0,W="gr.",Qt=e*this.CONVERSION_RULES.gousse_ail,Hr="1 gousse = 6.5 gr.";else if(d&&E)_t=!0,W="gr.",Qt=e*this.CONVERSION_RULES.tete_ail,Hr="1 tÃªte = 80 gr.";else if(h){_t=!0,W="gr.";let L="";I?L="unite_oignon":E?L="unite_ail":$?L="unite_tomate":H?L="unite_poireau":B?L="unite_aubergine":G?L="unite_courgette":N?L="unite_eshalote":U?L="unite_orange":F?L="unite_citron":se?L="unite_concombre":V?L="unite_levure_chimique":an?L="unite_carotte":on?L="unite_betterave_rouge":_t=!1,_t&&(Qt=e*this.CONVERSION_RULES[L],Hr=`1 unitÃ© = ${this.CONVERSION_RULES[L]} gr.`)}return _t?ys=W:n==="kg"?(Qt=e*1e3,ys="gr."):n==="l."?(Qt=e*1e3,ys="ml"):n==="gr."?ys="gr.":n==="ml"&&(ys="ml"),{quantity:Qt,unit:ys,originalUnit:r,ruleUsed:Hr,hasConversion:_t}}}C(Co,"CONVERSION_RULES",{cafe_sucre:5,cafe_sel:5,cafe_farine:3,cafe_semoule:4,cafe_poivre:2.5,cafe_cacao:2.5,cafe_sucre_glace:3,cafe_maizena:3,cafe_bicarbonate:5,cafe_curcuma:2,cafe_cumin:2,cafe_curry:2,cafe_muscade:2,cafe_paprika:2,cafe_miel:10,cafe_creme_epaisse:5,cafe_default:5,soupe_sucre:15,soupe_sel:15,soupe_farine:10,soupe_semoule:12,soupe_poivre:8,soupe_cacao:8,soupe_sucre_glace:9,soupe_maizena:10,soupe_creme_epaisse:15,soupe_bicarbonate:15,soupe_curcuma:6,soupe_cumin:6,soupe_curry:6,soupe_muscade:7,soupe_paprika:6,soupe_miel:30,soupe_default:15,pincee:.4,gousse_ail:6.5,tete_ail:80,unite_oignon:120,unite_ail:6.5,unite_tomate:120,unite_poireau:150,unite_aubergine:250,unite_courgette:200,unite_eshalote:30,unite_orange:200,unite_citron:100,unite_concombre:200,unite_levure_chimique:11,unite_carotte:125,unite_betterave_rouge:250});const Ru=2;function ap(t){const r=new Date(t).getHours();return r>=11&&r<=13?"sun":r>=19&&r<=21?"moon":r>=7&&r<=9?"cloud":null}function ip(t){return{formattedDate:new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),timeIcon:ap(t)}}function op(t){const e={};for(const r of t)e[r]=ip(r);return e}function cp(t,e,r){const s=!t.productHugoUuid,n=t.byDate&&Object.keys(t.byDate).length>0,a=s&&(t.totalNeededArray&&t.totalNeededArray.length>0||t.totalNeededOverrideParsed);if(!n&&!a)return{requiredQuantities:[],requiredQuantitiesFormatted:"-",stockBalance:[],availableStockQuantities:[],missingStockQuantities:[],availableStockFormatted:"-",missingStockFormatted:"-",hasAvailableStock:!1,hasMissingStock:!1,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map};if(s&&!n){const G=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray||[],N=G.length>0?ut(G):"-",U=Mc(t,e,r,G),F=U.filter(V=>V.q>0),se=U.filter(V=>V.q<0);return{requiredQuantities:G,requiredQuantitiesFormatted:N,stockBalance:U,availableStockQuantities:F,missingStockQuantities:se,availableStockFormatted:Pc(U),missingStockFormatted:ut(se.map(V=>({q:Math.abs(V.q),u:V.u}))),hasAvailableStock:F.length>0,hasMissingStock:se.length>0,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map}}const o=e,c=r,l=[],u=new Map,d=new Map;let h=0,p=0;for(const[G,N]of Object.entries(t.byDate))G>=o&&G<=c&&(l.push(G),h+=N.totalAssiettes||0,N.recipes?.length&&(u.set(G,N.recipes),p+=N.recipes.length),N.totalConsolidated&&N.totalConsolidated.forEach(({q:U,u:F})=>{d.set(F,(d.get(F)||0)+U)}));const g=Array.from(d.entries()).map(([G,N])=>({q:N,u:G})),w=g.length>0?ut(g):"-",A=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:g,E=Mc(t,e,r,A),I=E.filter(G=>G.q>0),$=new Date().toISOString().split("T")[0],B=r<$?[]:E.filter(G=>G.q<0);return{requiredQuantities:g,requiredQuantitiesFormatted:w,stockBalance:E,availableStockQuantities:I,missingStockQuantities:B,availableStockFormatted:Pc(E),missingStockFormatted:ut(B.map(G=>({q:Math.abs(G.q),u:G.u}))),hasAvailableStock:I.length>0,hasMissingStock:B.length>0,totalRecipesInRange:p,totalPortionsInRange:h,datesInSelectedRange:l,recipesByDate:u}}function Mc(t,e,r,s){let n=[],a="";t.stockParsed?.dateTime&&t.stockParsed.dateTime<=e&&(n=[{q:parseFloat(t.stockParsed.quantity),u:t.stockParsed.unit}],a=t.stockParsed.dateTime);const o=[];if(t.purchases)for(const u of t.purchases)lp(u,e,r,a)&&o.push({q:u.quantity,u:u.unit});const c=[...n,...o],l=ao(c);return tp(l,s)}function lp(t,e,r,s=""){if(t.status==="cancelled")return!1;const n=t.deliveryDate||t.$createdAt;if(!n)return!1;const a=new Date(r);return a.setHours(a.getHours()+Ru),!(a<new Date||n>a.toISOString()||s&&t.$createdAt<s)}class up{constructor(){C(this,"dbName","recipes-cache");C(this,"db",null);C(this,"version",5);C(this,"RECIPES_INDEX_STORE","recipes-index");C(this,"RECIPES_DETAILS_STORE","recipes-details");C(this,"METADATA_STORE","metadata");C(this,"BUILD_TIMESTAMP_KEY","buildTimestamp");C(this,"LAST_APPWRITE_SYNC_KEY","lastAppwriteSync");C(this,"RECIPES_COUNT_KEY","recipesCount")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.RECIPES_INDEX_STORE)||(d.createObjectStore(this.RECIPES_INDEX_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-index' crÃ©Ã©")),d.objectStoreNames.contains(this.RECIPES_DETAILS_STORE)||(d.createObjectStore(this.RECIPES_DETAILS_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-details' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[RecipesIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.RECIPES_INDEX_STORE),n=r.objectStoreNames.contains(this.RECIPES_DETAILS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[RecipesIDBCache] Base corrompue dÃ©tectÃ©e (index=${s}, details=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[RecipesIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[RecipesIDBCache] Base ouverte: ${this.dbName}`)}async loadRecipesIndex(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_INDEX_STORE,"readonly").objectStore(this.RECIPES_INDEX_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} recettes (index) chargÃ©es`),e(o)},a.onerror=()=>r(a.error)})}async saveRecipesIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_INDEX_STORE,"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[RecipesIDBCache] ${e.size} recettes (index) sauvegardÃ©es`),r()},n.onerror=()=>s(n.error)})}async loadRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).get(e);o.onsuccess=()=>{const c=o.result;c&&console.log(`[RecipesIDBCache] DÃ©tails de ${e} chargÃ©s depuis le cache`),r(c||null)},o.onerror=()=>s(o.error)})}async saveRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).put(e);o.onsuccess=()=>{console.log(`[RecipesIDBCache] DÃ©tails de ${e.$id} sauvegardÃ©s`),r()},o.onerror=()=>s(o.error)})}async loadAllRecipeDetails(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} dÃ©tails de recettes chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE),o=new Map;let c=0;const l=e.length;for(const u of e){const d=a.get(u);d.onsuccess=()=>{const h=d.result;h&&o.set(u,h),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk`),r(o))},d.onerror=()=>{console.warn(`[RecipesIDBCache] Erreur chargement ${u} en bulk:`,d.error),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk (avec erreurs)`),r(o))}}l===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  charger en bulk"),r(o))})}async saveRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite"),a=n.objectStore(this.RECIPES_DETAILS_STORE);let o=0;const c=e.size;e.forEach(l=>{const u=a.put(l);u.onsuccess=()=>{o++,o===c&&(console.log(`[RecipesIDBCache] ${c} recettes sauvegardÃ©es en bulk`),r())},u.onerror=()=>{console.error(`[RecipesIDBCache] Erreur sauvegarde ${l.$id} en bulk:`,u.error),s(u.error)}}),c===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  sauvegarder en bulk"),r()),n.onerror=()=>s(n.error)})}async deleteRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteRecipeFromIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE],"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE),o=n.objectStore(this.RECIPES_DETAILS_STORE);a.delete(e),o.delete(e),n.oncomplete=()=>{console.log(`[RecipesIDBCache] Recette ${e} supprimÃ©e de l'index et des dÃ©tails`),r()},n.onerror=()=>s(n.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={buildTimestamp:null,lastAppwriteSync:null,recipesCount:0,cacheVersion:1};o.forEach(l=>{l.key===this.RECIPES_COUNT_KEY?c.recipesCount=l.value:l.key===this.BUILD_TIMESTAMP_KEY?c.buildTimestamp=l.value:l.key===this.LAST_APPWRITE_SYNC_KEY&&(c.lastAppwriteSync=l.value)}),console.log(`[RecipesIDBCache] Metadata chargÃ©es: count=${c.recipesCount}, build=${c.buildTimestamp}, sync=${c.lastAppwriteSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.BUILD_TIMESTAMP_KEY,value:e.buildTimestamp}),a.put({key:this.LAST_APPWRITE_SYNC_KEY,value:e.lastAppwriteSync}),a.put({key:this.RECIPES_COUNT_KEY,value:e.recipesCount}),n.oncomplete=()=>{console.log("[RecipesIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.RECIPES_INDEX_STORE).clear(),s.objectStore(this.RECIPES_DETAILS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[RecipesIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[RecipesIDBCache] Connexion fermÃ©e"))}}async function dp(){const t=new up;return await t.open(),t}function Ry(t){return t.map(e=>JSON.stringify(e))}function Ha(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{return JSON.parse(e)}catch(r){return console.warn("[ingredientUtils] Failed to parse ingredient:",e,r),null}}).filter(e=>e!==null)}const $c={"BouchÃ©es salÃ©es":"sandwich",Boisson:"cup-soda",Cake:"cake-slice","CrÃ¨mes dessert":"fast-food-pudding",Friture:"fryer",Gateau:"cake-slice",Pain:"bread","Plat au Four":"oven","Plat en Sauce":"pot",Salade:"lettuce",Sauce:"sauce",Snacking:"hamburger",Soupe:"soup","Tarte (salÃ©e)":"pizza","Tarte (sucrÃ©e)":"pie",Tartinade:"tartinade"},fp={entree:"salad",plat:"dish",dessert:"fast-food-pudding"};function Py(t,e){const r=Array.isArray(e)?e[0]:e;if(r&&$c[r])return{label:r,iconId:$c[r]};const s=hp(t),n=fp[t]||"no-cat";return{label:s,iconId:n}}function hp(t){switch(t){case"entree":return"EntrÃ©e";case"plat":return"Plat";case"dessert":return"Dessert";default:return t}}function Vi(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{const r=JSON.parse(e);if(r&&typeof r.astuce=="string")return r;if(typeof e=="string")return{astuce:e}}catch(r){console.warn("[recipeUtils] Failed to parse astuce:",e,r)}return null}).filter(e=>e!==null)}function Dy(t){return!t||!Array.isArray(t)||t.length===0?null:t.map(e=>JSON.stringify(typeof e=="string"?{astuce:e}:e))}function pp(t){if(!t||typeof t!="object"||Array.isArray(t))throw new Error(`Format d'ingrÃ©dient invalide: ${JSON.stringify(t)}`);return{uuid:t.uuid||"",name:t.name||"",originalQuantity:t.originalQuantity||0,originalUnit:t.originalUnit||"",normalizedQuantity:t.normalizedQuantity||0,normalizedUnit:t.normalizedUnit||"",comment:t.comment||"",allergens:Array.isArray(t.allergens)?t.allergens:[],type:t.type||"",pF:t.pF??!1,pS:t.pS??!1}}function kc(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{try{e.push(pp(r))}catch(s){console.warn("[parseRecipeData] IngrÃ©dient invalide ignorÃ©:",s)}}),{...t,$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||"",ingredients:e}}function mp(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es d'index de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{typeof r=="string"?e.push(r):r&&typeof r.name=="string"&&e.push(r.name)}),{title:t.title||"",typeR:t.typeR||"",categories:Array.isArray(t.categories)?t.categories:[],regime:t.regime||null,draft:t.draft??!1,materiel:Array.isArray(t.materiel)?t.materiel:[],region:t.region||"",serveHot:t.serveHot??!1,cuisson:t.cuisson??!1,check:t.check??!1,saison:Array.isArray(t.saison)?t.saison:[],permissionWrite:Array.isArray(t.permissionWrite)?t.permissionWrite:[],lockedBy:t.lockedBy||null,plate:t.plate??100,ingredients:e,auteur:t.auteur||"",createdBy:t.createdBy||"",$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||""}}function Ta(t){let e=[];return t.ingredients&&(e=Ha(t.ingredients).map(s=>s.name)),{title:t.title,typeR:t.typeR,categories:t.categories,regime:t.regime,draft:t.draft||!1,saison:t.saison,ingredients:e,materiel:t.materiel,region:t.region||null,serveHot:t.serveHot,cuisson:t.cuisson,check:t.check,auteur:t.auteur||t.createdBy,permissionWrite:t.permissionWrite,lockedBy:t.lockedBy||null,$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,createdBy:t.createdBy,plate:t.plate,rootRecipeId:t.rootRecipeId||null,versionLabel:t.versionLabel||null}}function Wi(t,e,r,s){function n(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function c(d){try{u(s.next(d))}catch(h){o(h)}}function l(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):n(d.value).then(c,l)}u((s=s.apply(t,[])).next())})}function gp(t,e,r,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?s:r==="a"?s.call(t):s?s.value:e.get(t)}class S{constructor(e,r,s){this.method=e,this.attribute=r,s!==void 0&&(Array.isArray(s)?this.values=s:this.values=[s])}toString(){return JSON.stringify({method:this.method,attribute:this.attribute,values:this.values})}}S.equal=(t,e)=>new S("equal",t,e).toString();S.notEqual=(t,e)=>new S("notEqual",t,e).toString();S.lessThan=(t,e)=>new S("lessThan",t,e).toString();S.lessThanEqual=(t,e)=>new S("lessThanEqual",t,e).toString();S.greaterThan=(t,e)=>new S("greaterThan",t,e).toString();S.greaterThanEqual=(t,e)=>new S("greaterThanEqual",t,e).toString();S.isNull=t=>new S("isNull",t).toString();S.isNotNull=t=>new S("isNotNull",t).toString();S.between=(t,e,r)=>new S("between",t,[e,r]).toString();S.startsWith=(t,e)=>new S("startsWith",t,e).toString();S.endsWith=(t,e)=>new S("endsWith",t,e).toString();S.select=t=>new S("select",void 0,t).toString();S.search=(t,e)=>new S("search",t,e).toString();S.orderDesc=t=>new S("orderDesc",t).toString();S.orderAsc=t=>new S("orderAsc",t).toString();S.orderRandom=()=>new S("orderRandom").toString();S.cursorAfter=t=>new S("cursorAfter",void 0,t).toString();S.cursorBefore=t=>new S("cursorBefore",void 0,t).toString();S.limit=t=>new S("limit",void 0,t).toString();S.offset=t=>new S("offset",void 0,t).toString();S.contains=(t,e)=>new S("contains",t,e).toString();S.notContains=(t,e)=>new S("notContains",t,e).toString();S.notSearch=(t,e)=>new S("notSearch",t,e).toString();S.notBetween=(t,e,r)=>new S("notBetween",t,[e,r]).toString();S.notStartsWith=(t,e)=>new S("notStartsWith",t,e).toString();S.notEndsWith=(t,e)=>new S("notEndsWith",t,e).toString();S.createdBefore=t=>S.lessThan("$createdAt",t);S.createdAfter=t=>S.greaterThan("$createdAt",t);S.createdBetween=(t,e)=>S.between("$createdAt",t,e);S.updatedBefore=t=>S.lessThan("$updatedAt",t);S.updatedAfter=t=>S.greaterThan("$updatedAt",t);S.updatedBetween=(t,e)=>S.between("$updatedAt",t,e);S.or=t=>new S("or",void 0,t.map(e=>JSON.parse(e))).toString();S.and=t=>new S("and",void 0,t.map(e=>JSON.parse(e))).toString();S.distanceEqual=(t,e,r,s=!0)=>new S("distanceEqual",t,[[e,r,s]]).toString();S.distanceNotEqual=(t,e,r,s=!0)=>new S("distanceNotEqual",t,[[e,r,s]]).toString();S.distanceGreaterThan=(t,e,r,s=!0)=>new S("distanceGreaterThan",t,[[e,r,s]]).toString();S.distanceLessThan=(t,e,r,s=!0)=>new S("distanceLessThan",t,[[e,r,s]]).toString();S.intersects=(t,e)=>new S("intersects",t,[e]).toString();S.notIntersects=(t,e)=>new S("notIntersects",t,[e]).toString();S.crosses=(t,e)=>new S("crosses",t,[e]).toString();S.notCrosses=(t,e)=>new S("notCrosses",t,[e]).toString();S.overlaps=(t,e)=>new S("overlaps",t,[e]).toString();S.notOverlaps=(t,e)=>new S("notOverlaps",t,[e]).toString();S.touches=(t,e)=>new S("touches",t,[e]).toString();S.notTouches=(t,e)=>new S("notTouches",t,[e]).toString();class v extends Error{constructor(e,r=0,s="",n=""){super(e),this.name="AppwriteException",this.message=e,this.code=r,this.type=s,this.response=n}}class Yt{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.5.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var e;(e=this.realtime.socket)===null||e===void 0||e.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var e,r,s;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(e=this.realtime.socket)===null||e===void 0||e.close();return}const n=new URLSearchParams;this.config.project&&n.set("project",this.config.project),this.realtime.channels.forEach(o=>{n.append("channels[]",o)});const a=this.config.endpointRealtime+"/realtime?"+n.toString();(a!==this.realtime.url||!this.realtime.socket||((r=this.realtime.socket)===null||r===void 0?void 0:r.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((s=this.realtime.socket)===null||s===void 0?void 0:s.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=a,this.realtime.socket=new WebSocket(a),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",o=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",o=>{var c,l,u;if(!this.realtime.reconnect||((l=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||l===void 0?void 0:l.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,o.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:e=>{var r,s;try{const n=JSON.parse(e.data);switch(this.realtime.lastMessage=n,n.type){case"connected":let a=this.config.session;if(!a){const l=JSON.parse((r=window.localStorage.getItem("cookieFallback"))!==null&&r!==void 0?r:"{}");a=l?.[`a_session_${this.config.project}`]}const o=n.data;a&&!o.user&&((s=this.realtime.socket)===null||s===void 0||s.send(JSON.stringify({type:"authentication",data:{session:a}})));break;case"event":let c=n.data;if(c?.channels){if(!c.channels.some(u=>this.realtime.channels.has(u)))return;this.realtime.subscriptions.forEach(u=>{c.channels.some(d=>u.channels.includes(d))&&setTimeout(()=>u.callback(c))})}break;case"pong":break;case"error":throw n.data;default:break}}catch(n){console.error(n)}},cleanUp:e=>{this.realtime.channels.forEach(r=>{e.includes(r)&&(Array.from(this.realtime.subscriptions).some(([n,a])=>a.channels.includes(r))||this.realtime.channels.delete(r))})}}}setEndpoint(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new v("Invalid endpoint URL: "+e);return this.config.endpoint=e,this.config.endpointRealtime=e.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){if(!e.startsWith("ws://")&&!e.startsWith("wss://"))throw new v("Invalid realtime endpoint URL: "+e);return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}setSession(e){return this.headers["X-Appwrite-Session"]=e,this.config.session=e,this}setDevKey(e){return this.headers["X-Appwrite-Dev-Key"]=e,this.config.devkey=e,this}subscribe(e,r){let s=typeof e=="string"?[e]:e;s.forEach(a=>this.realtime.channels.add(a));const n=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(n,{channels:s,callback:r}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(n),this.realtime.cleanUp(s),this.realtime.connect()}}prepareRequest(e,r,s={},n={}){if(e=e.toUpperCase(),s=Object.assign({},this.headers,s),typeof window<"u"&&window.localStorage){const o=window.localStorage.getItem("cookieFallback");o&&(s["X-Fallback-Cookies"]=o)}let a={method:e,headers:s};if(s["X-Appwrite-Dev-Key"]===void 0&&(a.credentials="include"),e==="GET")for(const[o,c]of Object.entries(Yt.flatten(n)))r.searchParams.append(o,c);else switch(s["content-type"]){case"application/json":a.body=JSON.stringify(n);break;case"multipart/form-data":const o=new FormData;for(const[c,l]of Object.entries(n))if(l instanceof File)o.append(c,l,l.name);else if(Array.isArray(l))for(const u of l)o.append(`${c}[]`,u);else o.append(c,l);a.body=o,delete s["content-type"];break}return{uri:r.toString(),options:a}}chunkedUpload(e,r,s={},n={},a){var o;return Wi(this,void 0,void 0,function*(){const[c,l]=(o=Object.entries(n).find(([h,p])=>p instanceof File))!==null&&o!==void 0?o:[];if(!l||!c)throw new Error("File not found in payload");if(l.size<=Yt.CHUNK_SIZE)return yield this.call(e,r,s,n);let u=0,d=null;for(;u<l.size;){let h=u+Yt.CHUNK_SIZE;h>=l.size&&(h=l.size),s["content-range"]=`bytes ${u}-${h-1}/${l.size}`;const p=l.slice(u,h);let g=Object.assign({},n);g[c]=new File([p],l.name),d=yield this.call(e,r,s,g),a&&typeof a=="function"&&a({$id:d.$id,progress:Math.round(h/l.size*100),sizeUploaded:h,chunksTotal:Math.ceil(l.size/Yt.CHUNK_SIZE),chunksUploaded:Math.ceil(h/Yt.CHUNK_SIZE)}),d&&d.$id&&(s["x-appwrite-id"]=d.$id),u=h}return d})}ping(){return Wi(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(e,r,s={},n={},a="json"){var o,c;return Wi(this,void 0,void 0,function*(){const{uri:l,options:u}=this.prepareRequest(e,r,s,n);let d=null;const h=yield fetch(l,u);if(h.type==="opaque")throw new v(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const p=h.headers.get("x-appwrite-warning");if(p&&p.split(";").forEach(w=>console.warn("Warning: "+w)),!((o=h.headers.get("content-type"))===null||o===void 0)&&o.includes("application/json")?d=yield h.json():a==="arrayBuffer"?d=yield h.arrayBuffer():d={message:yield h.text()},400<=h.status){let w="";throw!((c=h.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||a==="arrayBuffer"?w=JSON.stringify(d):w=d?.message,new v(d?.message,h.status,d?.type,w)}const g=h.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&g&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",g)),d})}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),Yt.flatten(a,o)):s[o]=a}return s}}Yt.CHUNK_SIZE=1024*1024*5;class Sn{constructor(e){this.client=e}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),Sn.flatten(a,o)):s[o]=a}return s}}Sn.CHUNK_SIZE=5*1024*1024;class yp{constructor(e){this.client=e}get(){const e="/account",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],password:r[1],name:r[2]};const n=s.userId,a=s.email,o=s.password,c=s.name;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "email"');if(typeof o>"u")throw new v('Missing required parameter: "password"');const l="/account",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.password=o),typeof c<"u"&&(u.name=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}updateEmail(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new v('Missing required parameter: "email"');if(typeof a>"u")throw new v('Missing required parameter: "password"');const o="/account/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}listIdentities(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/identities",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}deleteIdentity(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={identityId:e};const s=r.identityId;if(typeof s>"u")throw new v('Missing required parameter: "identityId"');const n="/account/identities/{identityId}".replace("{identityId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createJWT(){const e="/account/jwts",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}listLogs(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/logs",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMFA(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={mfa:e};const s=r.mfa;if(typeof s>"u")throw new v('Missing required parameter: "mfa"');const n="/account/mfa",a={};typeof s<"u"&&(a.mfa=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new v('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new v('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new v('Missing required parameter: "type"');if(typeof a>"u")throw new v('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new v('Missing required parameter: "type"');if(typeof a>"u")throw new v('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deleteMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new v('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}deleteMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new v('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createMfaChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new v('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new v('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new v('Missing required parameter: "challengeId"');if(typeof a>"u")throw new v('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new v('Missing required parameter: "challengeId"');if(typeof a>"u")throw new v('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}listMfaFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}listMFAFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}createMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updateMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateName(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={name:e};const s=r.name;if(typeof s>"u")throw new v('Missing required parameter: "name"');const n="/account/name",a={};typeof s<"u"&&(a.name=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}updatePassword(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={password:e,oldPassword:r[0]};const n=s.password,a=s.oldPassword;if(typeof n>"u")throw new v('Missing required parameter: "password"');const o="/account/password",c={};typeof n<"u"&&(c.password=n),typeof a<"u"&&(c.oldPassword=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}updatePhone(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={phone:e,password:r[0]};const n=s.phone,a=s.password;if(typeof n>"u")throw new v('Missing required parameter: "phone"');if(typeof a>"u")throw new v('Missing required parameter: "password"');const o="/account/phone",c={};typeof n<"u"&&(c.phone=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}getPrefs(){const e="/account/prefs",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}updatePrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"prefs"in e?r=e||{}:r={prefs:e};const s=r.prefs;if(typeof s>"u")throw new v('Missing required parameter: "prefs"');const n="/account/prefs",a={};typeof s<"u"&&(a.prefs=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,url:r[0]};const n=s.email,a=s.url;if(typeof n>"u")throw new v('Missing required parameter: "email"');if(typeof a>"u")throw new v('Missing required parameter: "url"');const o="/account/recovery",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.url=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0],password:r[1]};const n=s.userId,a=s.secret,o=s.password;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');if(typeof o>"u")throw new v('Missing required parameter: "password"');const c="/account/recovery",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.secret=a),typeof o<"u"&&(l.password=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("put",u,d,l)}listSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}deleteSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("delete",s,n,r)}createAnonymousSession(){const e="/account/sessions/anonymous",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createEmailPasswordSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new v('Missing required parameter: "email"');if(typeof a>"u")throw new v('Missing required parameter: "password"');const o="/account/sessions/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateMagicURLSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/sessions/magic-url",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createOAuth2Session(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new v('Missing required parameter: "provider"');const l="/account/sessions/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(Sn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}updatePhoneSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/sessions/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/sessions/token",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}getSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new v('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new v('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}deleteSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new v('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}updateStatus(){const e="/account/status",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}createPushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0],providerId:r[1]};const n=s.targetId,a=s.identifier,o=s.providerId;if(typeof n>"u")throw new v('Missing required parameter: "targetId"');if(typeof a>"u")throw new v('Missing required parameter: "identifier"');const c="/account/targets/push",l={};typeof n<"u"&&(l.targetId=n),typeof a<"u"&&(l.identifier=a),typeof o<"u"&&(l.providerId=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}updatePushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0]};const n=s.targetId,a=s.identifier;if(typeof n>"u")throw new v('Missing required parameter: "targetId"');if(typeof a>"u")throw new v('Missing required parameter: "identifier"');const o="/account/targets/{targetId}/push".replace("{targetId}",n),c={};typeof a<"u"&&(c.identifier=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deletePushTarget(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={targetId:e};const s=r.targetId;if(typeof s>"u")throw new v('Missing required parameter: "targetId"');const n="/account/targets/{targetId}/push".replace("{targetId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createEmailToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],phrase:r[1]};const n=s.userId,a=s.email,o=s.phrase;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "email"');const c="/account/tokens/email",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.email=a),typeof o<"u"&&(l.phrase=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}createMagicURLToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],url:r[1],phrase:r[2]};const n=s.userId,a=s.email,o=s.url,c=s.phrase;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "email"');const l="/account/tokens/magic-url",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.url=o),typeof c<"u"&&(u.phrase=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}createOAuth2Token(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new v('Missing required parameter: "provider"');const l="/account/tokens/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(Sn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}createPhoneToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,phone:r[0]};const n=s.userId,a=s.phone;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "phone"');const o="/account/tokens/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.phone=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}createEmailVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new v('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new v('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateEmailVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createPhoneVerification(){const e="/account/verifications/phone",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updatePhoneVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "userId"');if(typeof a>"u")throw new v('Missing required parameter: "secret"');const o="/account/verifications/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}class wp{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/databases/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/databases/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new v('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new v('Missing required parameter: "transactionId"');const c="/databases/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new v('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new v('Missing required parameter: "transactionId"');const o="/databases/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listDocuments(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.collectionId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');const u="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');if(typeof c>"u")throw new v('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),h={};typeof o<"u"&&(h.documentId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("post",p,g,h)}getDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');const u="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');if(typeof c>"u")throw new v('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("put",p,g,h)}updateDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("patch",p,g,h)}deleteDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');const l="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');if(typeof c>"u")throw new v('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/decrement".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}incrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "collectionId"');if(typeof o>"u")throw new v('Missing required parameter: "documentId"');if(typeof c>"u")throw new v('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/increment".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}}class vp{constructor(e){this.client=e}listExecutions(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,queries:r[0],total:r[1]};const n=s.functionId,a=s.queries,o=s.total;if(typeof n>"u")throw new v('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",n),l={};typeof a<"u"&&(l.queries=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}createExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,body:r[0],async:r[1],xpath:r[2],method:r[3],headers:r[4],scheduledAt:r[5]};const n=s.functionId,a=s.body,o=s.async,c=s.xpath,l=s.method,u=s.headers,d=s.scheduledAt;if(typeof n>"u")throw new v('Missing required parameter: "functionId"');const h="/functions/{functionId}/executions".replace("{functionId}",n),p={};typeof a<"u"&&(p.body=a),typeof o<"u"&&(p.async=o),typeof c<"u"&&(p.path=c),typeof l<"u"&&(p.method=l),typeof u<"u"&&(p.headers=u),typeof d<"u"&&(p.scheduledAt=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("post",g,w,p)}getExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,executionId:r[0]};const n=s.functionId,a=s.executionId;if(typeof n>"u")throw new v('Missing required parameter: "functionId"');if(typeof a>"u")throw new v('Missing required parameter: "executionId"');const o="/functions/{functionId}/executions/{executionId}".replace("{functionId}",n).replace("{executionId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}}class bp{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new v('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new v('Missing required parameter: "transactionId"');const c="/tablesdb/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new v('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new v('Missing required parameter: "transactionId"');const o="/tablesdb/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listRows(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.tableId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');if(typeof c>"u")throw new v('Missing required parameter: "data"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),h={};typeof o<"u"&&(h.rowId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("post",p,g,h)}getRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("put",p,g,h)}updateRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("patch",p,g,h)}deleteRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');const l="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');if(typeof c>"u")throw new v('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/decrement".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}incrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new v('Missing required parameter: "databaseId"');if(typeof a>"u")throw new v('Missing required parameter: "tableId"');if(typeof o>"u")throw new v('Missing required parameter: "rowId"');if(typeof c>"u")throw new v('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/increment".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}}class Ep{constructor(e){this.client=e}list(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,search:r[0],total:r[1]};const n=s.queries,a=s.search,o=s.total,c="/teams",l={};typeof n<"u"&&(l.queries=n),typeof a<"u"&&(l.search=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0],roles:r[1]};const n=s.teamId,a=s.name,o=s.roles;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "name"');const c="/teams",l={};typeof n<"u"&&(l.teamId=n),typeof a<"u"&&(l.name=a),typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}get(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new v('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateName(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0]};const n=s.teamId,a=s.name;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "name"');const o="/teams/{teamId}".replace("{teamId}",n),c={};typeof a<"u"&&(c.name=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}delete(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new v('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}listMemberships(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,queries:r[0],search:r[1],total:r[2]};const n=s.teamId,a=s.queries,o=s.search,c=s.total;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');const l="/teams/{teamId}/memberships".replace("{teamId}",n),u={};typeof a<"u"&&(u.queries=a),typeof o<"u"&&(u.search=o),typeof c<"u"&&(u.total=c);const d=new URL(this.client.config.endpoint+l),h={};return this.client.call("get",d,h,u)}createMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,roles:r[0],email:r[1],userId:r[2],phone:r[3],url:r[4],name:r[5]};const n=s.teamId,a=s.roles,o=s.email,c=s.userId,l=s.phone,u=s.url,d=s.name;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "roles"');const h="/teams/{teamId}/memberships".replace("{teamId}",n),p={};typeof o<"u"&&(p.email=o),typeof c<"u"&&(p.userId=c),typeof l<"u"&&(p.phone=l),typeof a<"u"&&(p.roles=a),typeof u<"u"&&(p.url=u),typeof d<"u"&&(p.name=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("post",g,w,p)}getMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],roles:r[1]};const n=s.teamId,a=s.membershipId,o=s.roles;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "membershipId"');if(typeof o>"u")throw new v('Missing required parameter: "roles"');const c="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),l={};typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("delete",l,u,c)}updateMembershipStatus(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],userId:r[1],secret:r[2]};const n=s.teamId,a=s.membershipId,o=s.userId,c=s.secret;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "membershipId"');if(typeof o>"u")throw new v('Missing required parameter: "userId"');if(typeof c>"u")throw new v('Missing required parameter: "secret"');const l="/teams/{teamId}/memberships/{membershipId}/status".replace("{teamId}",n).replace("{membershipId}",a),u={};typeof o<"u"&&(u.userId=o),typeof c<"u"&&(u.secret=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("patch",d,h,u)}getPrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new v('Missing required parameter: "teamId"');const n="/teams/{teamId}/prefs".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updatePrefs(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,prefs:r[0]};const n=s.teamId,a=s.prefs;if(typeof n>"u")throw new v('Missing required parameter: "teamId"');if(typeof a>"u")throw new v('Missing required parameter: "prefs"');const o="/teams/{teamId}/prefs".replace("{teamId}",n),c={};typeof a<"u"&&(c.prefs=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}var Cc;(function(t){t[t.NORMAL_CLOSURE=1e3]="NORMAL_CLOSURE",t[t.POLICY_VIOLATION=1008]="POLICY_VIOLATION",t[t.UNKNOWN_ERROR=-1]="UNKNOWN_ERROR"})(Cc||(Cc={}));class te{}te.read=t=>`read("${t}")`;te.write=t=>`write("${t}")`;te.create=t=>`create("${t}")`;te.update=t=>`update("${t}")`;te.delete=t=>`delete("${t}")`;class ie{static any(){return"any"}static user(e,r=""){return r===""?`user:${e}`:`user:${e}/${r}`}static users(e=""){return e===""?"users":`users/${e}`}static guests(){return"guests"}static team(e,r=""){return r===""?`team:${e}`:`team:${e}/${r}`}static member(e){return`member:${e}`}static label(e){return`label:${e}`}}var Pu,Du;class ht{static custom(e){return e}static unique(e=7){const r=gp(ht,Pu,"m",Du).call(ht);let s="";for(let n=0;n<e;n++){const a=Math.floor(Math.random()*16).toString(16);s+=a}return r+s}}Pu=ht,Du=function(){const e=new Date,r=Math.floor(e.getTime()/1e3),s=e.getMilliseconds();return r.toString(16)+s.toString(16).padStart(5,"0")};var Tc;(function(t){t.Equal="equal",t.NotEqual="notEqual",t.GreaterThan="greaterThan",t.GreaterThanEqual="greaterThanEqual",t.LessThan="lessThan",t.LessThanEqual="lessThanEqual",t.Contains="contains",t.IsNull="isNull",t.IsNotNull="isNotNull"})(Tc||(Tc={}));var Nc;(function(t){t.Totp="totp"})(Nc||(Nc={}));var Lc;(function(t){t.Email="email",t.Phone="phone",t.Totp="totp",t.Recoverycode="recoverycode"})(Lc||(Lc={}));var jc;(function(t){t.Amazon="amazon",t.Apple="apple",t.Auth0="auth0",t.Authentik="authentik",t.Autodesk="autodesk",t.Bitbucket="bitbucket",t.Bitly="bitly",t.Box="box",t.Dailymotion="dailymotion",t.Discord="discord",t.Disqus="disqus",t.Dropbox="dropbox",t.Etsy="etsy",t.Facebook="facebook",t.Figma="figma",t.Github="github",t.Gitlab="gitlab",t.Google="google",t.Linkedin="linkedin",t.Microsoft="microsoft",t.Notion="notion",t.Oidc="oidc",t.Okta="okta",t.Paypal="paypal",t.PaypalSandbox="paypalSandbox",t.Podio="podio",t.Salesforce="salesforce",t.Slack="slack",t.Spotify="spotify",t.Stripe="stripe",t.Tradeshift="tradeshift",t.TradeshiftBox="tradeshiftBox",t.Twitch="twitch",t.Wordpress="wordpress",t.Yahoo="yahoo",t.Yammer="yammer",t.Yandex="yandex",t.Zoho="zoho",t.Zoom="zoom",t.Mock="mock"})(jc||(jc={}));var qc;(function(t){t.AvantBrowser="aa",t.AndroidWebViewBeta="an",t.GoogleChrome="ch",t.GoogleChromeIOS="ci",t.GoogleChromeMobile="cm",t.Chromium="cr",t.MozillaFirefox="ff",t.Safari="sf",t.MobileSafari="mf",t.MicrosoftEdge="ps",t.MicrosoftEdgeIOS="oi",t.OperaMini="om",t.Opera="op",t.OperaNext="on"})(qc||(qc={}));var Uc;(function(t){t.AmericanExpress="amex",t.Argencard="argencard",t.Cabal="cabal",t.Cencosud="cencosud",t.DinersClub="diners",t.Discover="discover",t.Elo="elo",t.Hipercard="hipercard",t.JCB="jcb",t.Mastercard="mastercard",t.Naranja="naranja",t.TarjetaShopping="targeta-shopping",t.UnionPay="unionpay",t.Visa="visa",t.MIR="mir",t.Maestro="maestro",t.Rupay="rupay"})(Uc||(Uc={}));var Oc;(function(t){t.Afghanistan="af",t.Angola="ao",t.Albania="al",t.Andorra="ad",t.UnitedArabEmirates="ae",t.Argentina="ar",t.Armenia="am",t.AntiguaAndBarbuda="ag",t.Australia="au",t.Austria="at",t.Azerbaijan="az",t.Burundi="bi",t.Belgium="be",t.Benin="bj",t.BurkinaFaso="bf",t.Bangladesh="bd",t.Bulgaria="bg",t.Bahrain="bh",t.Bahamas="bs",t.BosniaAndHerzegovina="ba",t.Belarus="by",t.Belize="bz",t.Bolivia="bo",t.Brazil="br",t.Barbados="bb",t.BruneiDarussalam="bn",t.Bhutan="bt",t.Botswana="bw",t.CentralAfricanRepublic="cf",t.Canada="ca",t.Switzerland="ch",t.Chile="cl",t.China="cn",t.CoteDIvoire="ci",t.Cameroon="cm",t.DemocraticRepublicOfTheCongo="cd",t.RepublicOfTheCongo="cg",t.Colombia="co",t.Comoros="km",t.CapeVerde="cv",t.CostaRica="cr",t.Cuba="cu",t.Cyprus="cy",t.CzechRepublic="cz",t.Germany="de",t.Djibouti="dj",t.Dominica="dm",t.Denmark="dk",t.DominicanRepublic="do",t.Algeria="dz",t.Ecuador="ec",t.Egypt="eg",t.Eritrea="er",t.Spain="es",t.Estonia="ee",t.Ethiopia="et",t.Finland="fi",t.Fiji="fj",t.France="fr",t.MicronesiaFederatedStatesOf="fm",t.Gabon="ga",t.UnitedKingdom="gb",t.Georgia="ge",t.Ghana="gh",t.Guinea="gn",t.Gambia="gm",t.GuineaBissau="gw",t.EquatorialGuinea="gq",t.Greece="gr",t.Grenada="gd",t.Guatemala="gt",t.Guyana="gy",t.Honduras="hn",t.Croatia="hr",t.Haiti="ht",t.Hungary="hu",t.Indonesia="id",t.India="in",t.Ireland="ie",t.IranIslamicRepublicOf="ir",t.Iraq="iq",t.Iceland="is",t.Israel="il",t.Italy="it",t.Jamaica="jm",t.Jordan="jo",t.Japan="jp",t.Kazakhstan="kz",t.Kenya="ke",t.Kyrgyzstan="kg",t.Cambodia="kh",t.Kiribati="ki",t.SaintKittsAndNevis="kn",t.SouthKorea="kr",t.Kuwait="kw",t.LaoPeopleSDemocraticRepublic="la",t.Lebanon="lb",t.Liberia="lr",t.Libya="ly",t.SaintLucia="lc",t.Liechtenstein="li",t.SriLanka="lk",t.Lesotho="ls",t.Lithuania="lt",t.Luxembourg="lu",t.Latvia="lv",t.Morocco="ma",t.Monaco="mc",t.Moldova="md",t.Madagascar="mg",t.Maldives="mv",t.Mexico="mx",t.MarshallIslands="mh",t.NorthMacedonia="mk",t.Mali="ml",t.Malta="mt",t.Myanmar="mm",t.Montenegro="me",t.Mongolia="mn",t.Mozambique="mz",t.Mauritania="mr",t.Mauritius="mu",t.Malawi="mw",t.Malaysia="my",t.Namibia="na",t.Niger="ne",t.Nigeria="ng",t.Nicaragua="ni",t.Netherlands="nl",t.Norway="no",t.Nepal="np",t.Nauru="nr",t.NewZealand="nz",t.Oman="om",t.Pakistan="pk",t.Panama="pa",t.Peru="pe",t.Philippines="ph",t.Palau="pw",t.PapuaNewGuinea="pg",t.Poland="pl",t.FrenchPolynesia="pf",t.NorthKorea="kp",t.Portugal="pt",t.Paraguay="py",t.Qatar="qa",t.Romania="ro",t.Russia="ru",t.Rwanda="rw",t.SaudiArabia="sa",t.Sudan="sd",t.Senegal="sn",t.Singapore="sg",t.SolomonIslands="sb",t.SierraLeone="sl",t.ElSalvador="sv",t.SanMarino="sm",t.Somalia="so",t.Serbia="rs",t.SouthSudan="ss",t.SaoTomeAndPrincipe="st",t.Suriname="sr",t.Slovakia="sk",t.Slovenia="si",t.Sweden="se",t.Eswatini="sz",t.Seychelles="sc",t.Syria="sy",t.Chad="td",t.Togo="tg",t.Thailand="th",t.Tajikistan="tj",t.Turkmenistan="tm",t.TimorLeste="tl",t.Tonga="to",t.TrinidadAndTobago="tt",t.Tunisia="tn",t.Turkey="tr",t.Tuvalu="tv",t.Tanzania="tz",t.Uganda="ug",t.Ukraine="ua",t.Uruguay="uy",t.UnitedStates="us",t.Uzbekistan="uz",t.VaticanCity="va",t.SaintVincentAndTheGrenadines="vc",t.Venezuela="ve",t.Vietnam="vn",t.Vanuatu="vu",t.Samoa="ws",t.Yemen="ye",t.SouthAfrica="za",t.Zambia="zm",t.Zimbabwe="zw"})(Oc||(Oc={}));var Bc;(function(t){t.Light="light",t.Dark="dark"})(Bc||(Bc={}));var xc;(function(t){t.AfricaAbidjan="africa/abidjan",t.AfricaAccra="africa/accra",t.AfricaAddisAbaba="africa/addis_ababa",t.AfricaAlgiers="africa/algiers",t.AfricaAsmara="africa/asmara",t.AfricaBamako="africa/bamako",t.AfricaBangui="africa/bangui",t.AfricaBanjul="africa/banjul",t.AfricaBissau="africa/bissau",t.AfricaBlantyre="africa/blantyre",t.AfricaBrazzaville="africa/brazzaville",t.AfricaBujumbura="africa/bujumbura",t.AfricaCairo="africa/cairo",t.AfricaCasablanca="africa/casablanca",t.AfricaCeuta="africa/ceuta",t.AfricaConakry="africa/conakry",t.AfricaDakar="africa/dakar",t.AfricaDarEsSalaam="africa/dar_es_salaam",t.AfricaDjibouti="africa/djibouti",t.AfricaDouala="africa/douala",t.AfricaElAaiun="africa/el_aaiun",t.AfricaFreetown="africa/freetown",t.AfricaGaborone="africa/gaborone",t.AfricaHarare="africa/harare",t.AfricaJohannesburg="africa/johannesburg",t.AfricaJuba="africa/juba",t.AfricaKampala="africa/kampala",t.AfricaKhartoum="africa/khartoum",t.AfricaKigali="africa/kigali",t.AfricaKinshasa="africa/kinshasa",t.AfricaLagos="africa/lagos",t.AfricaLibreville="africa/libreville",t.AfricaLome="africa/lome",t.AfricaLuanda="africa/luanda",t.AfricaLubumbashi="africa/lubumbashi",t.AfricaLusaka="africa/lusaka",t.AfricaMalabo="africa/malabo",t.AfricaMaputo="africa/maputo",t.AfricaMaseru="africa/maseru",t.AfricaMbabane="africa/mbabane",t.AfricaMogadishu="africa/mogadishu",t.AfricaMonrovia="africa/monrovia",t.AfricaNairobi="africa/nairobi",t.AfricaNdjamena="africa/ndjamena",t.AfricaNiamey="africa/niamey",t.AfricaNouakchott="africa/nouakchott",t.AfricaOuagadougou="africa/ouagadougou",t.AfricaPortonovo="africa/porto-novo",t.AfricaSaoTome="africa/sao_tome",t.AfricaTripoli="africa/tripoli",t.AfricaTunis="africa/tunis",t.AfricaWindhoek="africa/windhoek",t.AmericaAdak="america/adak",t.AmericaAnchorage="america/anchorage",t.AmericaAnguilla="america/anguilla",t.AmericaAntigua="america/antigua",t.AmericaAraguaina="america/araguaina",t.AmericaArgentinaBuenosAires="america/argentina/buenos_aires",t.AmericaArgentinaCatamarca="america/argentina/catamarca",t.AmericaArgentinaCordoba="america/argentina/cordoba",t.AmericaArgentinaJujuy="america/argentina/jujuy",t.AmericaArgentinaLaRioja="america/argentina/la_rioja",t.AmericaArgentinaMendoza="america/argentina/mendoza",t.AmericaArgentinaRioGallegos="america/argentina/rio_gallegos",t.AmericaArgentinaSalta="america/argentina/salta",t.AmericaArgentinaSanJuan="america/argentina/san_juan",t.AmericaArgentinaSanLuis="america/argentina/san_luis",t.AmericaArgentinaTucuman="america/argentina/tucuman",t.AmericaArgentinaUshuaia="america/argentina/ushuaia",t.AmericaAruba="america/aruba",t.AmericaAsuncion="america/asuncion",t.AmericaAtikokan="america/atikokan",t.AmericaBahia="america/bahia",t.AmericaBahiaBanderas="america/bahia_banderas",t.AmericaBarbados="america/barbados",t.AmericaBelem="america/belem",t.AmericaBelize="america/belize",t.AmericaBlancsablon="america/blanc-sablon",t.AmericaBoaVista="america/boa_vista",t.AmericaBogota="america/bogota",t.AmericaBoise="america/boise",t.AmericaCambridgeBay="america/cambridge_bay",t.AmericaCampoGrande="america/campo_grande",t.AmericaCancun="america/cancun",t.AmericaCaracas="america/caracas",t.AmericaCayenne="america/cayenne",t.AmericaCayman="america/cayman",t.AmericaChicago="america/chicago",t.AmericaChihuahua="america/chihuahua",t.AmericaCiudadJuarez="america/ciudad_juarez",t.AmericaCostaRica="america/costa_rica",t.AmericaCoyhaique="america/coyhaique",t.AmericaCreston="america/creston",t.AmericaCuiaba="america/cuiaba",t.AmericaCuracao="america/curacao",t.AmericaDanmarkshavn="america/danmarkshavn",t.AmericaDawson="america/dawson",t.AmericaDawsonCreek="america/dawson_creek",t.AmericaDenver="america/denver",t.AmericaDetroit="america/detroit",t.AmericaDominica="america/dominica",t.AmericaEdmonton="america/edmonton",t.AmericaEirunepe="america/eirunepe",t.AmericaElSalvador="america/el_salvador",t.AmericaFortNelson="america/fort_nelson",t.AmericaFortaleza="america/fortaleza",t.AmericaGlaceBay="america/glace_bay",t.AmericaGooseBay="america/goose_bay",t.AmericaGrandTurk="america/grand_turk",t.AmericaGrenada="america/grenada",t.AmericaGuadeloupe="america/guadeloupe",t.AmericaGuatemala="america/guatemala",t.AmericaGuayaquil="america/guayaquil",t.AmericaGuyana="america/guyana",t.AmericaHalifax="america/halifax",t.AmericaHavana="america/havana",t.AmericaHermosillo="america/hermosillo",t.AmericaIndianaIndianapolis="america/indiana/indianapolis",t.AmericaIndianaKnox="america/indiana/knox",t.AmericaIndianaMarengo="america/indiana/marengo",t.AmericaIndianaPetersburg="america/indiana/petersburg",t.AmericaIndianaTellCity="america/indiana/tell_city",t.AmericaIndianaVevay="america/indiana/vevay",t.AmericaIndianaVincennes="america/indiana/vincennes",t.AmericaIndianaWinamac="america/indiana/winamac",t.AmericaInuvik="america/inuvik",t.AmericaIqaluit="america/iqaluit",t.AmericaJamaica="america/jamaica",t.AmericaJuneau="america/juneau",t.AmericaKentuckyLouisville="america/kentucky/louisville",t.AmericaKentuckyMonticello="america/kentucky/monticello",t.AmericaKralendijk="america/kralendijk",t.AmericaLaPaz="america/la_paz",t.AmericaLima="america/lima",t.AmericaLosAngeles="america/los_angeles",t.AmericaLowerPrinces="america/lower_princes",t.AmericaMaceio="america/maceio",t.AmericaManagua="america/managua",t.AmericaManaus="america/manaus",t.AmericaMarigot="america/marigot",t.AmericaMartinique="america/martinique",t.AmericaMatamoros="america/matamoros",t.AmericaMazatlan="america/mazatlan",t.AmericaMenominee="america/menominee",t.AmericaMerida="america/merida",t.AmericaMetlakatla="america/metlakatla",t.AmericaMexicoCity="america/mexico_city",t.AmericaMiquelon="america/miquelon",t.AmericaMoncton="america/moncton",t.AmericaMonterrey="america/monterrey",t.AmericaMontevideo="america/montevideo",t.AmericaMontserrat="america/montserrat",t.AmericaNassau="america/nassau",t.AmericaNewYork="america/new_york",t.AmericaNome="america/nome",t.AmericaNoronha="america/noronha",t.AmericaNorthDakotaBeulah="america/north_dakota/beulah",t.AmericaNorthDakotaCenter="america/north_dakota/center",t.AmericaNorthDakotaNewSalem="america/north_dakota/new_salem",t.AmericaNuuk="america/nuuk",t.AmericaOjinaga="america/ojinaga",t.AmericaPanama="america/panama",t.AmericaParamaribo="america/paramaribo",t.AmericaPhoenix="america/phoenix",t.AmericaPortauprince="america/port-au-prince",t.AmericaPortOfSpain="america/port_of_spain",t.AmericaPortoVelho="america/porto_velho",t.AmericaPuertoRico="america/puerto_rico",t.AmericaPuntaArenas="america/punta_arenas",t.AmericaRankinInlet="america/rankin_inlet",t.AmericaRecife="america/recife",t.AmericaRegina="america/regina",t.AmericaResolute="america/resolute",t.AmericaRioBranco="america/rio_branco",t.AmericaSantarem="america/santarem",t.AmericaSantiago="america/santiago",t.AmericaSantoDomingo="america/santo_domingo",t.AmericaSaoPaulo="america/sao_paulo",t.AmericaScoresbysund="america/scoresbysund",t.AmericaSitka="america/sitka",t.AmericaStBarthelemy="america/st_barthelemy",t.AmericaStJohns="america/st_johns",t.AmericaStKitts="america/st_kitts",t.AmericaStLucia="america/st_lucia",t.AmericaStThomas="america/st_thomas",t.AmericaStVincent="america/st_vincent",t.AmericaSwiftCurrent="america/swift_current",t.AmericaTegucigalpa="america/tegucigalpa",t.AmericaThule="america/thule",t.AmericaTijuana="america/tijuana",t.AmericaToronto="america/toronto",t.AmericaTortola="america/tortola",t.AmericaVancouver="america/vancouver",t.AmericaWhitehorse="america/whitehorse",t.AmericaWinnipeg="america/winnipeg",t.AmericaYakutat="america/yakutat",t.AntarcticaCasey="antarctica/casey",t.AntarcticaDavis="antarctica/davis",t.AntarcticaDumontdurville="antarctica/dumontdurville",t.AntarcticaMacquarie="antarctica/macquarie",t.AntarcticaMawson="antarctica/mawson",t.AntarcticaMcmurdo="antarctica/mcmurdo",t.AntarcticaPalmer="antarctica/palmer",t.AntarcticaRothera="antarctica/rothera",t.AntarcticaSyowa="antarctica/syowa",t.AntarcticaTroll="antarctica/troll",t.AntarcticaVostok="antarctica/vostok",t.ArcticLongyearbyen="arctic/longyearbyen",t.AsiaAden="asia/aden",t.AsiaAlmaty="asia/almaty",t.AsiaAmman="asia/amman",t.AsiaAnadyr="asia/anadyr",t.AsiaAqtau="asia/aqtau",t.AsiaAqtobe="asia/aqtobe",t.AsiaAshgabat="asia/ashgabat",t.AsiaAtyrau="asia/atyrau",t.AsiaBaghdad="asia/baghdad",t.AsiaBahrain="asia/bahrain",t.AsiaBaku="asia/baku",t.AsiaBangkok="asia/bangkok",t.AsiaBarnaul="asia/barnaul",t.AsiaBeirut="asia/beirut",t.AsiaBishkek="asia/bishkek",t.AsiaBrunei="asia/brunei",t.AsiaChita="asia/chita",t.AsiaColombo="asia/colombo",t.AsiaDamascus="asia/damascus",t.AsiaDhaka="asia/dhaka",t.AsiaDili="asia/dili",t.AsiaDubai="asia/dubai",t.AsiaDushanbe="asia/dushanbe",t.AsiaFamagusta="asia/famagusta",t.AsiaGaza="asia/gaza",t.AsiaHebron="asia/hebron",t.AsiaHoChiMinh="asia/ho_chi_minh",t.AsiaHongKong="asia/hong_kong",t.AsiaHovd="asia/hovd",t.AsiaIrkutsk="asia/irkutsk",t.AsiaJakarta="asia/jakarta",t.AsiaJayapura="asia/jayapura",t.AsiaJerusalem="asia/jerusalem",t.AsiaKabul="asia/kabul",t.AsiaKamchatka="asia/kamchatka",t.AsiaKarachi="asia/karachi",t.AsiaKathmandu="asia/kathmandu",t.AsiaKhandyga="asia/khandyga",t.AsiaKolkata="asia/kolkata",t.AsiaKrasnoyarsk="asia/krasnoyarsk",t.AsiaKualaLumpur="asia/kuala_lumpur",t.AsiaKuching="asia/kuching",t.AsiaKuwait="asia/kuwait",t.AsiaMacau="asia/macau",t.AsiaMagadan="asia/magadan",t.AsiaMakassar="asia/makassar",t.AsiaManila="asia/manila",t.AsiaMuscat="asia/muscat",t.AsiaNicosia="asia/nicosia",t.AsiaNovokuznetsk="asia/novokuznetsk",t.AsiaNovosibirsk="asia/novosibirsk",t.AsiaOmsk="asia/omsk",t.AsiaOral="asia/oral",t.AsiaPhnomPenh="asia/phnom_penh",t.AsiaPontianak="asia/pontianak",t.AsiaPyongyang="asia/pyongyang",t.AsiaQatar="asia/qatar",t.AsiaQostanay="asia/qostanay",t.AsiaQyzylorda="asia/qyzylorda",t.AsiaRiyadh="asia/riyadh",t.AsiaSakhalin="asia/sakhalin",t.AsiaSamarkand="asia/samarkand",t.AsiaSeoul="asia/seoul",t.AsiaShanghai="asia/shanghai",t.AsiaSingapore="asia/singapore",t.AsiaSrednekolymsk="asia/srednekolymsk",t.AsiaTaipei="asia/taipei",t.AsiaTashkent="asia/tashkent",t.AsiaTbilisi="asia/tbilisi",t.AsiaTehran="asia/tehran",t.AsiaThimphu="asia/thimphu",t.AsiaTokyo="asia/tokyo",t.AsiaTomsk="asia/tomsk",t.AsiaUlaanbaatar="asia/ulaanbaatar",t.AsiaUrumqi="asia/urumqi",t.AsiaUstnera="asia/ust-nera",t.AsiaVientiane="asia/vientiane",t.AsiaVladivostok="asia/vladivostok",t.AsiaYakutsk="asia/yakutsk",t.AsiaYangon="asia/yangon",t.AsiaYekaterinburg="asia/yekaterinburg",t.AsiaYerevan="asia/yerevan",t.AtlanticAzores="atlantic/azores",t.AtlanticBermuda="atlantic/bermuda",t.AtlanticCanary="atlantic/canary",t.AtlanticCapeVerde="atlantic/cape_verde",t.AtlanticFaroe="atlantic/faroe",t.AtlanticMadeira="atlantic/madeira",t.AtlanticReykjavik="atlantic/reykjavik",t.AtlanticSouthGeorgia="atlantic/south_georgia",t.AtlanticStHelena="atlantic/st_helena",t.AtlanticStanley="atlantic/stanley",t.AustraliaAdelaide="australia/adelaide",t.AustraliaBrisbane="australia/brisbane",t.AustraliaBrokenHill="australia/broken_hill",t.AustraliaDarwin="australia/darwin",t.AustraliaEucla="australia/eucla",t.AustraliaHobart="australia/hobart",t.AustraliaLindeman="australia/lindeman",t.AustraliaLordHowe="australia/lord_howe",t.AustraliaMelbourne="australia/melbourne",t.AustraliaPerth="australia/perth",t.AustraliaSydney="australia/sydney",t.EuropeAmsterdam="europe/amsterdam",t.EuropeAndorra="europe/andorra",t.EuropeAstrakhan="europe/astrakhan",t.EuropeAthens="europe/athens",t.EuropeBelgrade="europe/belgrade",t.EuropeBerlin="europe/berlin",t.EuropeBratislava="europe/bratislava",t.EuropeBrussels="europe/brussels",t.EuropeBucharest="europe/bucharest",t.EuropeBudapest="europe/budapest",t.EuropeBusingen="europe/busingen",t.EuropeChisinau="europe/chisinau",t.EuropeCopenhagen="europe/copenhagen",t.EuropeDublin="europe/dublin",t.EuropeGibraltar="europe/gibraltar",t.EuropeGuernsey="europe/guernsey",t.EuropeHelsinki="europe/helsinki",t.EuropeIsleOfMan="europe/isle_of_man",t.EuropeIstanbul="europe/istanbul",t.EuropeJersey="europe/jersey",t.EuropeKaliningrad="europe/kaliningrad",t.EuropeKirov="europe/kirov",t.EuropeKyiv="europe/kyiv",t.EuropeLisbon="europe/lisbon",t.EuropeLjubljana="europe/ljubljana",t.EuropeLondon="europe/london",t.EuropeLuxembourg="europe/luxembourg",t.EuropeMadrid="europe/madrid",t.EuropeMalta="europe/malta",t.EuropeMariehamn="europe/mariehamn",t.EuropeMinsk="europe/minsk",t.EuropeMonaco="europe/monaco",t.EuropeMoscow="europe/moscow",t.EuropeOslo="europe/oslo",t.EuropeParis="europe/paris",t.EuropePodgorica="europe/podgorica",t.EuropePrague="europe/prague",t.EuropeRiga="europe/riga",t.EuropeRome="europe/rome",t.EuropeSamara="europe/samara",t.EuropeSanMarino="europe/san_marino",t.EuropeSarajevo="europe/sarajevo",t.EuropeSaratov="europe/saratov",t.EuropeSimferopol="europe/simferopol",t.EuropeSkopje="europe/skopje",t.EuropeSofia="europe/sofia",t.EuropeStockholm="europe/stockholm",t.EuropeTallinn="europe/tallinn",t.EuropeTirane="europe/tirane",t.EuropeUlyanovsk="europe/ulyanovsk",t.EuropeVaduz="europe/vaduz",t.EuropeVatican="europe/vatican",t.EuropeVienna="europe/vienna",t.EuropeVilnius="europe/vilnius",t.EuropeVolgograd="europe/volgograd",t.EuropeWarsaw="europe/warsaw",t.EuropeZagreb="europe/zagreb",t.EuropeZurich="europe/zurich",t.IndianAntananarivo="indian/antananarivo",t.IndianChagos="indian/chagos",t.IndianChristmas="indian/christmas",t.IndianCocos="indian/cocos",t.IndianComoro="indian/comoro",t.IndianKerguelen="indian/kerguelen",t.IndianMahe="indian/mahe",t.IndianMaldives="indian/maldives",t.IndianMauritius="indian/mauritius",t.IndianMayotte="indian/mayotte",t.IndianReunion="indian/reunion",t.PacificApia="pacific/apia",t.PacificAuckland="pacific/auckland",t.PacificBougainville="pacific/bougainville",t.PacificChatham="pacific/chatham",t.PacificChuuk="pacific/chuuk",t.PacificEaster="pacific/easter",t.PacificEfate="pacific/efate",t.PacificFakaofo="pacific/fakaofo",t.PacificFiji="pacific/fiji",t.PacificFunafuti="pacific/funafuti",t.PacificGalapagos="pacific/galapagos",t.PacificGambier="pacific/gambier",t.PacificGuadalcanal="pacific/guadalcanal",t.PacificGuam="pacific/guam",t.PacificHonolulu="pacific/honolulu",t.PacificKanton="pacific/kanton",t.PacificKiritimati="pacific/kiritimati",t.PacificKosrae="pacific/kosrae",t.PacificKwajalein="pacific/kwajalein",t.PacificMajuro="pacific/majuro",t.PacificMarquesas="pacific/marquesas",t.PacificMidway="pacific/midway",t.PacificNauru="pacific/nauru",t.PacificNiue="pacific/niue",t.PacificNorfolk="pacific/norfolk",t.PacificNoumea="pacific/noumea",t.PacificPagoPago="pacific/pago_pago",t.PacificPalau="pacific/palau",t.PacificPitcairn="pacific/pitcairn",t.PacificPohnpei="pacific/pohnpei",t.PacificPortMoresby="pacific/port_moresby",t.PacificRarotonga="pacific/rarotonga",t.PacificSaipan="pacific/saipan",t.PacificTahiti="pacific/tahiti",t.PacificTarawa="pacific/tarawa",t.PacificTongatapu="pacific/tongatapu",t.PacificWake="pacific/wake",t.PacificWallis="pacific/wallis",t.Utc="utc"})(xc||(xc={}));var Hc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(Hc||(Hc={}));var In;(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.DELETE="DELETE",t.OPTIONS="OPTIONS",t.HEAD="HEAD"})(In||(In={}));var Vc;(function(t){t.Center="center",t.Topleft="top-left",t.Top="top",t.Topright="top-right",t.Left="left",t.Right="right",t.Bottomleft="bottom-left",t.Bottom="bottom",t.Bottomright="bottom-right"})(Vc||(Vc={}));var Wc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(Wc||(Wc={}));var Gc;(function(t){t.Http="http",t.Schedule="schedule",t.Event="event"})(Gc||(Gc={}));var Qc;(function(t){t.Waiting="waiting",t.Processing="processing",t.Completed="completed",t.Failed="failed",t.Scheduled="scheduled"})(Qc||(Qc={}));const rt={endpoint:"https://aw.oupla.net/v1",projectId:"696b7acb0037bde79e3f",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3",usersTeamsManager:"692cb2cd000cbb24549c",enkaData:"68f00487000c624533a3"},collections:{events:"main",ingredients:"ingredients",main:"main",purchases:"purchases",products:"products",kteams:"kteams",locks:"locks",user_notifications:"user_notifications",materiel_loan:"materiel_loan",teamdocs:"teamdocs"}};let Cr=null;async function D(){if(Cr)return Cr;console.log("[appwrite] Initialisation des instances Appwrite...");const t=new Yt().setEndpoint(rt.endpoint).setProject(rt.projectId),e=new yp(t),r=new wp(t),s=new bp(t),n=new vp(t),a=new Ep(t);return Cr={client:t,account:e,databases:r,tables:s,functions:n,teams:a,config:rt},console.log("[appwrite] Instances initialisÃ©es avec succÃ¨s"),Cr}function Mu(){console.log("[appwrite] Cache rÃ©initialisÃ©"),Cr=null}function ms(){return{APPWRITE_ENDPOINT:rt.endpoint,APPWRITE_PROJECT_ID:rt.projectId,APPWRITE_DATABASE_ID:rt.databaseId,APPWRITE_FUNCTION_ID:rt.functions.batchUpdate,ACCESS_REQUEST_FUNCTION_ID:rt.functions.accessRequest,MANAGE_RECIPE_FUNCTION_ID:rt.functions.enkaData,APPWRITE_CONFIG:rt}}async function Sp(t,e){Cr||(console.log("[appwrite] Subscribe appelÃ© avant initialisation, initialisation forcÃ©e..."),await D());const r=Array.isArray(t)?t:[t];return console.log("[appwrite] Subscribe aux channels:",r),Cr.client.subscribe(t,n=>{n.event==="client.connected"&&console.log("[appwrite] â WebSocket connectÃ© avec succÃ¨s"),e(n)})}function Ip(){return Cr!==null}function lt(){return rt.databaseId}function yr(t){return rt.collections[t]}function $u(t){return rt.functions[t]}const My=Object.freeze(Object.defineProperty({__proto__:null,clearAppwriteCache:Mu,getAppwriteConfig:ms,getAppwriteInstances:D,getCollectionId:yr,getDatabaseId:lt,getFunctionId:$u,isInitialized:Ip,subscribe:Sp},Symbol.toStringTag,{value:"Module"}));let Ap=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");function _p(t,e){const r=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),s=e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"";let n;if(s){const a=r.slice(0,16),o=s.slice(0,5);n=`${a}-${o}`}else n=r.slice(0,22);return`${n}_${Ap(12).toLowerCase()}`}const Rp=new bu(()=>window.scrollY,t=>zs(window,"scroll",t)),Pp={loading:0,success:2e3,info:3e3,warning:5e3,error:5e3},Dp=2;var fe,fs,ku,io;class Mp{constructor(){y(this,fs);y(this,fe,P(ge([])));C(this,"MAX_TOASTS",3)}get toasts(){return[...f(i(this,fe))].sort((e,r)=>r.timestamp-e.timestamp)}create(e){const r=e.id||crypto.randomUUID(),s={id:r,state:e.state,message:e.message,timestamp:Date.now(),source:e.source||"user",position:e.position,timeoutId:void 0,autoCloseDelay:e.autoCloseDelay,details:e.details,actions:e.actions||[]};return b(this,fs,ku).call(this,s),r}update(e,r){const s=f(i(this,fe)).findIndex(a=>a.id===e);if(s===-1)return;const n=f(i(this,fe))[s];n.timeoutId&&clearTimeout(n.timeoutId),n.loadingTimeoutId&&clearTimeout(n.loadingTimeoutId),f(i(this,fe))[s]={...n,state:r.state||n.state,message:r.message||n.message,source:r.source||n.source,position:r.position||n.position,actions:r.actions||n.actions,autoCloseDelay:r.autoCloseDelay!==void 0?r.autoCloseDelay:n.autoCloseDelay,loadingTimeoutId:void 0},b(this,fs,io).call(this,f(i(this,fe))[s])}async track(e,r){const s=this.create({id:r.id,state:"loading",message:r.loading,source:"user",position:r.position});try{const n=await e;return this.update(s,{state:"success",message:r.success||"OpÃ©ration rÃ©ussie",autoCloseDelay:r.successDelay}),n}catch(n){throw this.update(s,{state:"error",message:r.error||"Erreur lors de l'opÃ©ration",autoCloseDelay:r.errorDelay}),n}}dismiss(e){const r=f(i(this,fe)).findIndex(n=>n.id===e);if(r===-1)return;const s=f(i(this,fe))[r];s.timeoutId&&clearTimeout(s.timeoutId),s.loadingTimeoutId&&clearTimeout(s.loadingTimeoutId),f(i(this,fe)).splice(r,1)}dismissAll(){f(i(this,fe)).forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.loadingTimeoutId&&clearTimeout(e.loadingTimeoutId)}),m(i(this,fe),[],!0)}success(e,r){return this.create({state:"success",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}error(e,r){return this.create({state:"error",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}warning(e,r){return this.create({state:"warning",message:e,source:r?.source||"system",details:r?.details,actions:r?.actions,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}info(e,r){return this.create({state:"info",message:e,source:r?.source||"system",details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}loading(e,r){const n=r?.autoCloseDelay??3e4,a=this.create({state:"loading",message:e,details:r?.details,autoCloseDelay:n,position:r?.position}),o=setTimeout(()=>{this.update(a,{state:"warning",message:"Ãchec, temps expirÃ©",autoCloseDelay:2e3})},n-2e3),c=f(i(this,fe)).findIndex(l=>l.id===a);return c!==-1&&(f(i(this,fe))[c].loadingTimeoutId=o),a}}fe=new WeakMap,fs=new WeakSet,ku=function(e){const r=f(i(this,fe)).findIndex(s=>s.source===e.source);if(r>=0){const s=f(i(this,fe))[r];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,fe))[r]=e}else if(f(i(this,fe)).length<this.MAX_TOASTS)f(i(this,fe)).push(e);else{const s=f(i(this,fe))[0];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,fe)).shift(),f(i(this,fe)).push(e)}b(this,fs,io).call(this,e)},io=function(e){e.timeoutId&&clearTimeout(e.timeoutId);let r;if(e.autoCloseDelay!==void 0)r=e.autoCloseDelay===0?void 0:e.autoCloseDelay;else{const s=Pp[e.state];e.source==="realtime-other"&&s>0?r=s*Dp:r=s===0?void 0:s}r!==void 0&&(e.timeoutId=setTimeout(()=>{this.dismiss(e.id)},r))};const Qe=new Mp;async function $p(){const{teams:t}=await D();return await t.list()}async function kp(t){const{teams:e}=await D();return await e.get({teamId:t})}async function Cp(t){const{teams:e}=await D();return await e.create({teamId:ht.unique(),name:t})}async function Tp(t,e){const{teams:r}=await D();return await r.updateName({teamId:t,name:e})}async function Np(t){const{teams:e}=await D();await e.delete({teamId:t})}async function Lp(t){const{teams:e}=await D();return await e.listMemberships({teamId:t})}async function jp(t,e){const{teams:r}=await D();await r.deleteMembership({teamId:t,membershipId:e})}async function qp(t,e,r){const{functions:s}=await D(),n=$u("usersTeamsManager"),a={action:"native-invite",teamId:t,emails:e,message:r},o=await s.createExecution({functionId:n,body:JSON.stringify(a)});if(o.status!=="completed")throw new Error(`Erreur lors de l'invitation : ${o.errors}`);return JSON.parse(o.responseBody)}async function Jc(t,e){const{teams:r}=await D();return await r.updatePrefs({teamId:t,prefs:e})}var Ct,ts,er,gi,Cu;class Up{constructor(){y(this,gi);y(this,Ct,[]);y(this,ts,null);y(this,er,!1)}register(e,r){i(this,er)&&console.warn("[RealtimeManager] Enregistrement aprÃ¨s initialisation. Utilisez registerDynamic() pour les inscriptions dynamiques."),i(this,Ct).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels enregistrÃ©s:",e)}registerDynamic(e,r){return i(this,Ct).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels dynamiques enregistrÃ©s:",e),i(this,er)&&b(this,gi,Cu).call(this,e,r),()=>{const s=i(this,Ct).findIndex(n=>n.channels===e&&n.callback===r);s!==-1&&(i(this,Ct).splice(s,1),console.log("[RealtimeManager] Channels dynamiques dÃ©senregistrÃ©s:",e))}}async initialize(){if(i(this,er))return;const e=[...new Set(i(this,Ct).flatMap(r=>r.channels))];if(e.length===0){console.log("[RealtimeManager] Aucun channel Ã  souscrire."),_(this,er,!0);return}try{console.log(`[RealtimeManager] Initialisation de la connexion unique avec ${e.length} channels...`);const{client:r}=await D();_(this,ts,r.subscribe(e,s=>{for(const n of i(this,Ct))s.channels.some(o=>n.channels.includes(o))&&n.callback(s)})),_(this,er,!0),console.log("[RealtimeManager] â Connexion Realtime Ã©tablie.")}catch(r){throw console.error("[RealtimeManager] Erreur lors de l'initialisation:",r),r}}destroy(){i(this,ts)&&(i(this,ts).call(this),_(this,ts,null)),_(this,Ct,[]),_(this,er,!1),console.log("[RealtimeManager] Connexion Realtime fermÃ©e.")}}Ct=new WeakMap,ts=new WeakMap,er=new WeakMap,gi=new WeakSet,Cu=async function(e,r){try{console.log(`[RealtimeManager] Ajout de ${e.length} channels Ã  la connexion existante...`);const{client:s}=await D();s.subscribe(e,n=>{r(n)}),console.log("[RealtimeManager] â Channels dynamiques ajoutÃ©s:",e)}catch(s){console.error("[RealtimeManager] Erreur lors de l'ajout de channels dynamiques:",s)}};const Ht=new Up;var Be,Er,rs,tr,Ns,Cn,jr,Va,Tu;class Op{constructor(){y(this,jr);y(this,Be,new ft);y(this,Er,P(!1));y(this,rs,P(null));y(this,tr,P(!1));y(this,Ns,!1);y(this,Cn,z(()=>Array.from(i(this,Be).values())))}get loading(){return f(i(this,Er))}get error(){return f(i(this,rs))}get isInitialized(){return f(i(this,tr))}get count(){return i(this,Be).size}get teams(){return f(i(this,Cn))}isUserInAnyTeam(e){return Array.from(i(this,Be).values()).some(r=>r.members?.some(s=>s.id===e))}get myTeams(){return T.userId?f(i(this,Cn)):[]}async loadCache(){if(!f(i(this,tr))){if(!T.userId){m(i(this,tr),!0);return}m(i(this,tr),!0),console.log("[NativeTeamsStore] Cache chargÃ© : 0 Ã©quipes (pas de cache)")}}async syncFromRemote(){m(i(this,Er),!0),m(i(this,rs),null);try{if(!T.userId)return;await b(this,jr,Va).call(this),console.log(`[NativeTeamsStore] Sync terminÃ© : ${i(this,Be).size} Ã©quipes`)}catch(e){throw m(i(this,rs),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[NativeTeamsStore] SyncFromRemote error:",e),e}finally{m(i(this,Er),!1)}}async setupRealtime(){if(T.userId){if(i(this,Ns)){console.log("[NativeTeamsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await b(this,jr,Tu).call(this),_(this,Ns,!0),console.log("[NativeTeamsStore] Realtime configurÃ©")}catch(e){throw m(i(this,rs),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[NativeTeamsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async hardReset(){console.log("[NativeTeamsStore] Hard reset..."),i(this,Be).clear(),m(i(this,tr),!1),await this.initialize(),console.log("[NativeTeamsStore] Hard reset terminÃ©")}getTeamById(e){return i(this,Be).get(e)}getTeamMemberNames(e){const r=i(this,Be).get(e);return!r||!r.members?[]:r.members.map(s=>s.name?s.name:s.userEmail?s.userEmail.split("@")[0]:"Inconnu").filter(Boolean)}async fetchTeam(e){try{const r=await kp(e),s=await Lp(e),n={$id:r.$id,name:r.name,total:r.total,$createdAt:r.$createdAt,$updatedAt:r.$updatedAt,prefs:r.prefs,members:s.memberships.map(a=>({$id:a.$id,id:a.userId,name:a.userName,userEmail:a.userEmail,roles:a.roles,joinedAt:a.joined,confirmed:a.confirm}))};return i(this,Be).set(e,n),n}catch(r){return console.error(`[NativeTeamsStore] Error fetching team ${e}:`,r),null}}async createTeam(e,r){const s=await Cp(e);r&&Object.keys(r).length>0&&await Jc(s.$id,r);const n=await this.fetchTeam(s.$id);if(!n)throw new Error("Erreur aprÃ¨s crÃ©ation d'Ã©quipe");return n}async updateTeam(e,r,s){r&&await Tp(e,r),s&&Object.keys(s).length>0&&await Jc(e,s),await this.fetchTeam(e)}async deleteTeam(e){await Np(e),i(this,Be).delete(e)}async inviteTeamMember(e,r,s){await qp(e,r,s),await this.fetchTeam(e)}async removeMember(e,r){await jp(e,r),await this.fetchTeam(e)}async reload(){m(i(this,Er),!0);try{i(this,Be).clear(),await b(this,jr,Va).call(this)}finally{m(i(this,Er),!1)}}destroy(){i(this,Be).clear(),m(i(this,tr),!1),_(this,Ns,!1)}}Be=new WeakMap,Er=new WeakMap,rs=new WeakMap,tr=new WeakMap,Ns=new WeakMap,Cn=new WeakMap,jr=new WeakSet,Va=async function(){const e=await $p();for(const r of e.teams)await this.fetchTeam(r.$id)},Tu=async function(){Ht.register(["teams","memberships"],async e=>{console.log("[NativeTeamsStore] â¡ï¸ Realtime RECEIVED:",e.events),await b(this,jr,Va).call(this)})};const gt=new Op,Nu="demo-rassemblement-festif";function ae(t){return t===Nu}const Bp={name:"Rassemblement festif",description:"Exemple d'Ã©vÃ©nement sur plusieurs jours, avec plein de recettes...",durationDays:5,meals:[{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"houmous-pois-chiche_dw7yaqdlvjg9",plates:50,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"banoffee-vegan-et-sans_2h83u0xlel3u",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:0,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"falafel_n9qzdiwbz4dp",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tourte-betterave-lenti_c54ri2ggbvt2",plates:30,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"cheesecake-vegan-citro_lmvlf0ryne1v",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:0,time:"19:30"},{recipes:[{recipeUuid:"houmous-de-betterave-a_7c1hbo8nci50",plates:280,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"risotto-sarrasin-torre_0ay8dp7smyrw",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"blanquette-de-soja-tex_1oq9igtwzpr2",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"panna-cotta-vegan-vani_kytwplnialyp",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:1,time:"12:00"},{recipes:[{recipeUuid:"taboule-libanais-quino_0zgww2rc17i3",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"curry-veg_xnkksxn0t76q",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"escalope-de-seitan_ly3x5wxnq3ve",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"abricots-poches-vervei_izz7yef86m3j",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:1,time:"19:30"},{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:200,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"loubia_5m8okqsbqk66",plates:200,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_do1dg0nokwpd",plates:25,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"lassi-vegan-a-la-mangu_szk3bdykgyra",plates:200,typeR:"dessert",hasOwnPlatesNb:!0}],guests:200,dayOffset:2,time:"12:00"},{recipes:[{recipeUuid:"tartinade-de-pois-cass_tgpoyg0cm317",plates:280,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"champignons-frits-et-s_j71g5m5afdob",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"steak-vegetarien-champ_g288g77vujzb",plates:45,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tarte-au-citron-vegane_mw6a5i2da5hf",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:2,time:"19:30"},{recipes:[{recipeUuid:"soupe-froide-de-courge_nm0vvoqx6bbh",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"couscous-dautomne-vege_tntsav2ghe2f",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"jambalaya-vegan_jai01fvdixw5",plates:30,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-de-riz-libanaise_k00sjxzgi6ql",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:3,time:"12:00"},{recipes:[{recipeUuid:"gaspacho_cf5hqia64o1j",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_fzejp2oz5xj2",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"bahn-mi-a-la-proteine-_go4i0y6buluy",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"fondant-au-chocolat-ve_0vedt76modbc",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:3,time:"19:30"},{recipes:[{recipeUuid:"tartinade-de-haricot-r_w8ympby8n43o",plates:300,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"risotto-torrefie-de-sa_slsqvoqaqra7",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"proteines-de-soja-mari_ggo9802gtbxq",plates:50,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"salami-au-chocolat-veg_gp22v4hamxcv",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"aubergines-grillees-ca_3y287nb3wv9b",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-vegan-au-sureau_lds9ghlhjlwn",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"20:00"}]};async function Gt(t,e={}){const{maxAttempts:r=3,timeout:s=1e4,context:n="Operation",successMessage:a,errorMessage:o,retryDelay:c=1e3,silent:l=!1}=e;let u=null;for(let d=1;d<=r;d++)try{console.log(`[${n}] Tentative ${d}/${r}`);const h=await Promise.race([t(),xp(s)]);return d>1&&console.log(`[${n}] â SuccÃ¨s aprÃ¨s ${d} tentatives`),a&&!l&&Qe.success(a),h}catch(h){if(u=h instanceof Error?h:new Error(String(h)),console.error(`[${n}] â Tentative ${d}/${r} Ã©chouÃ©e:`,u.message),d===r)throw console.error(`[${n}] â Ãchec aprÃ¨s ${r} tentatives`),o&&!l&&Qe.error(o),u;const p=c*d;console.log(`[${n}] Nouvelle tentative dans ${p}ms...`),await Hp(p)}throw u||new Error(`${n}: Ãchec inconnu`)}function xp(t){return new Promise((e,r)=>{setTimeout(()=>{r(new Error(`Timeout aprÃ¨s ${t}ms`))},t)})}function Hp(t){return new Promise(e=>setTimeout(e,t))}function Ia(t,e={}){const{fallback:r=null,context:s="JSON.parse"}=e;try{return JSON.parse(t)}catch(n){return console.error(`[${s}] â JSON invalide:`,n instanceof Error?n.message:n),r}}function To(t,e={}){const{context:r="JSON.parseArray",itemFallback:s}=e;return!t||!Array.isArray(t)?(console.warn(`[${r}] Tableau vide ou invalide`),[]):t.map((n,a)=>{const o=Ia(n,{context:`${r}[${a}]`,fallback:void 0});return o===void 0&&s?s(n,a):o}).filter(n=>n!==null)}const{APPWRITE_CONFIG:Or}=ms(),nn="main";async function Kc(t,e=null){return Gt(async()=>{const{tables:r}=await D(),s=[S.orderDesc("dateStart")];return e&&s.push(S.greaterThanEqual("dateEnd",e)),{events:(await r.listRows({databaseId:Or.databaseId,tableId:nn,queries:s})).rows}},{context:"AppwriteEvents.listEvents",timeout:2e4,errorMessage:"Erreur lors du chargement des Ã©vÃ©nements"})}async function Vp(t){try{return await Gt(async()=>{const{tables:e}=await D();return await e.getRow({databaseId:Or.databaseId,tableId:nn,rowId:t})},{context:"AppwriteEvents.getEvent",timeout:1e4,errorMessage:"Erreur lors du chargement de l'Ã©vÃ©nement"})}catch(e){if(e.code===404)return null;throw e}}async function Wp(t,e){return Gt(async()=>{const{tables:r}=await D(),s=ht.unique(),n=await r.createRow({databaseId:Or.databaseId,tableId:nn,rowId:s,data:{name:t.name,dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(o=>JSON.stringify(o)):[],createdBy:e,teams:t.teams??[],contributors:t.contributors?t.contributors.map(o=>JSON.stringify(o)):[],todos:t.todos?t.todos.map(o=>JSON.stringify(o)):[]}});console.log(`[appwrite-events] Event created: ${s}`);const{functions:a}=await D();return await a.createExecution({functionId:Or.functions.usersTeamsManager,body:JSON.stringify({action:"add-label-to-user",mainId:s,userId:e}),async:!1}),console.log(`[appwrite-events] Label ${s} attribuÃ© au crÃ©ateur ${e}`),n},{context:"AppwriteEvents.createEvent",timeout:15e3,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function Gp(t,e,r=[],s=!0){return Gt(async()=>{const{functions:n}=await D(),a={name:t.name,description:t.description||"",dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(u=>JSON.stringify(u)):[],createdBy:e,teams:t.teams||[],teamsId:t.teamsId||[],contributors:t.contributors?t.contributors.map(u=>JSON.stringify(u)):[],todos:t.todos?t.todos.map(u=>JSON.stringify(u)):[],status:t.status||"proposition"};console.log(`[appwrite-events] CrÃ©ation Ã©vÃ©nement avec ${r.length} team(s)`);const o=await n.createExecution({functionId:Or.functions.usersTeamsManager,body:JSON.stringify({action:"create-event-with-teams",eventData:a,creatorId:e,teamIds:r,sendEmailToExistingMembers:s}),async:!1}),c=JSON.parse(o.responseBody);if(!c.success)throw new Error(c.error||"Erreur lors de la crÃ©ation");return console.log(`[appwrite-events] ÃvÃ©nement crÃ©Ã© avec teams: ${c.eventId}`),c.event},{context:"AppwriteEvents.createEventWithTeams",timeout:3e4,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function Yc(t,e){return Gt(async()=>{const{tables:r}=await D(),s={...e};e.meals&&(s.meals=e.meals.map(a=>JSON.stringify(a))),e.contributors&&(s.contributors=Array.isArray(e.contributors)?e.contributors.map(a=>JSON.stringify(a)):[]),e.todos&&(s.todos=e.todos.map(a=>JSON.stringify(a))),e.allDates&&(s.allDates=e.allDates);const n=await r.updateRow({databaseId:Or.databaseId,tableId:nn,rowId:t,data:s});return console.log(`[appwrite-events] Event updated: ${t}`),n},{context:"AppwriteEvents.updateEvent",timeout:1e4,successMessage:"ÃvÃ©nement mis Ã  jour",errorMessage:"Erreur lors de la mise Ã  jour"})}async function Qp(t){return Gt(async()=>{const{tables:e,functions:r}=await D();await e.deleteRow({databaseId:Or.databaseId,tableId:nn,rowId:t}),console.log(`[appwrite-events] Event deleted: ${t}`),await r.createExecution({functionId:Or.functions.usersTeamsManager,body:JSON.stringify({action:"delete-event-label",mainId:t}),async:!0}),console.log(`[appwrite-events] Label deletion initiated for event: ${t}`)},{context:"AppwriteEvents.deleteEvent",timeout:1e4,successMessage:"ÃvÃ©nement supprimÃ©",errorMessage:"Erreur lors de la suppression"})}function Jp(t){return To(t,{context:"parseEventMeals",itemFallback:(e,r)=>(console.warn(`[parseEventMeals] Meal ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,name:"Repas inconnu",date:new Date().toISOString(),guests:1,recipes:[]})})}function Kp(t){return To(t,{context:"parseEventContributors",itemFallback:(e,r)=>(console.warn(`[parseEventContributors] Contributor ${r} invalide, utilisation d'un fallback`,e),{id:typeof e=="string"?e:`unknown-${r}`,status:"accepted",invitedAt:new Date().toISOString()})})}function Yp(t){return To(t,{context:"parseEventTodos",itemFallback:(e,r)=>(console.warn(`[parseEventTodos] Todo ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,taskName:"TÃ¢che invalide",taskDescription:null,dueDate:null,priority:null,status:null,taskOn:null,requiredPeopleNb:1,assignedTo:null})})}class Xp{constructor(){C(this,"dbName","events-cache");C(this,"db",null);C(this,"version",2);C(this,"EVENTS_STORE","events");C(this,"METADATA_STORE","metadata");C(this,"POSTER_CONFIGS_STORE","poster-configs");C(this,"LAST_SYNC_KEY","lastSync")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.EVENTS_STORE)||(d.createObjectStore(this.EVENTS_STORE,{keyPath:"$id"}),console.log("[EventsIDBCache] Object store 'events' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[EventsIDBCache] Object store 'metadata' crÃ©Ã©")),d.objectStoreNames.contains(this.POSTER_CONFIGS_STORE)||(d.createObjectStore(this.POSTER_CONFIGS_STORE,{keyPath:"eventId"}),console.log("[EventsIDBCache] Object store 'poster-configs' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.EVENTS_STORE),n=r.objectStoreNames.contains(this.METADATA_STORE),a=r.objectStoreNames.contains(this.POSTER_CONFIGS_STORE);(!s||!n||!a)&&(console.warn(`[EventsIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (events=${s}, metadata=${n}, posters=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[EventsIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[EventsIDBCache] Base ouverte: ${this.dbName}`)}async loadEvents(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.EVENTS_STORE,"readonly").objectStore(this.EVENTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[EventsIDBCache] ${o.size} Ã©vÃ©nements chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveEvents(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.EVENTS_STORE,"readwrite"),a=n.objectStore(this.EVENTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[EventsIDBCache] ${e.size} Ã©vÃ©nements sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).put(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).delete(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadPosterConfig(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE),o=a.get(e);o.onsuccess=()=>{const c=o.result;if(!c){r(null);return}if(c.config&&!c.current){console.log(`[EventsIDBCache] Migration config affiche V1 -> V2 pour ${e}`);const l={current:c.config,versions:[]};a.put({eventId:e,...l,updatedAt:new Date().toISOString()}),r(l)}else c.current?r({current:c.current,versions:c.versions}):r(null)},o.onerror=()=>s(o.error)})}async savePosterConfig(e,r){if(!this.db)throw new Error("DB non ouverte");return new Promise((s,n)=>{const c=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE).put({eventId:e,...r,updatedAt:new Date().toISOString()});c.onsuccess=()=>{console.log(`[EventsIDBCache] Config affiche (container) pour ${e} sauvegardÃ©e`),s()},c.onerror=()=>n(c.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY&&(c.lastSync=l.value)}),console.log(`[EventsIDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite");n.objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e.lastSync}),n.oncomplete=()=>{console.log("[EventsIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.EVENTS_STORE,this.METADATA_STORE,this.POSTER_CONFIGS_STORE],"readwrite");s.objectStore(this.EVENTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.objectStore(this.POSTER_CONFIGS_STORE).clear(),s.oncomplete=()=>{console.log("[EventsIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[EventsIDBCache] Connexion fermÃ©e"))}}async function Xc(){const t=new Xp;return await t.open(),t}const Na=[Bp];function Zp(t=0){const e=new Date,r=new Date(e);r.setDate(e.getDate()+7+t);const n=(5-r.getDay()+7)%7;return r.setDate(r.getDate()+n),r.setHours(0,0,0,0),r}function Zc(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),r}function zp(t){const e=new Set;return t.forEach(r=>{const s=r.date.split("T")[0];e.add(s)}),Array.from(e).sort()}async function Fp(t,e){const[r,s]=e.time.split(":"),n=new Date(t);n.setHours(parseInt(r),parseInt(s),0,0);const o=(await Promise.all(e.recipes.map(async c=>{if(!await li.getRecipeByUuid(c.recipeUuid))return console.error(`[DemoEvents] Recipe not found: ${c.recipeUuid}. Skipping.`),null;const u=c.hasOwnPlatesNb??!1,d={recipeUuid:c.recipeUuid,plates:c.plates,typeR:c.typeR};return u&&(d.hasOwnPlatesNb=u),d}))).filter(c=>c!==null);if(o.length===0)throw new Error(`No valid recipes found for meal at day ${e.dayOffset}, ${e.time}`);return{id:crypto.randomUUID(),date:n.toISOString(),guests:e.guests,recipes:o}}async function em(t,e=0){console.log(`[DemoEvents] Generating event: ${t.name}`);const r=Zp(e),s=Zc(r,t.durationDays-1);s.setHours(23,59,59,999),console.log(`[DemoEvents] Event dates: ${r.toISOString()} â ${s.toISOString()}`);const n=[];for(const u of t.meals){const d=Zc(r,u.dayOffset);try{const h=await Fp(d,u);n.push(h)}catch(h){console.error("[DemoEvents] Error generating meal:",h)}}n.sort((u,d)=>new Date(u.date).getTime()-new Date(d.date).getTime()),console.log(`[DemoEvents] Generated ${n.length} meals`);const a=zp(n);console.log(`[DemoEvents] Event covers ${a.length} days: ${a.join(", ")}`);const o=Nu,c={id:"guest",name:"Visiteur",email:"guest@demo.local",status:"accepted",invitedAt:new Date().toISOString(),respondedAt:new Date().toISOString()},l={$id:o,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],name:t.name,description:t.description,status:"proposition",dateStart:r.toISOString(),dateEnd:s.toISOString(),allDates:a,meals:n,contributors:[c],todos:[],teams:[],teamsId:[],createdBy:"demo-system",isActive:!0,originalDataHash:null,error:null,minContrib:1,$sequence:0,$tableId:"",$databaseId:""};return console.log(`[DemoEvents] Event generated: ${o}`),rm(l),l}async function tm(){console.log(`[DemoEvents] Generating ${Na.length} demo events`);const t=[],e=30;for(let r=0;r<Na.length;r++){const s=Na[r],n=r*e;try{const a=await em(s,n);t.push(a)}catch(a){console.error(`[DemoEvents] Error generating event "${s.name}":`,a)}}return console.log(`[DemoEvents] Generated ${t.length}/${Na.length} events successfully`),t}function rm(t){console.log(`[DemoEvents] Validating event: ${t.$id}`);const e=[];t.status!=="proposition"&&e.push(`Event status should be "proposition", got: ${t.status}`);const r=new Set(t.meals.map(o=>o.date.split("T")[0])),s=new Set(t.allDates||[]),n=Array.from(r).filter(o=>!s.has(o));n.length>0&&e.push(`Dates missing in allDates: ${n.join(", ")}`);const a=Array.from(s).filter(o=>!r.has(o));if(a.length>0&&e.push(`Extra dates in allDates (no meals): ${a.join(", ")}`),!t.dateStart||!t.dateEnd)e.push("Event dateStart and dateEnd must be defined");else{const o=new Date(t.dateStart).getTime(),c=new Date(t.dateEnd).getTime();for(const l of t.meals){const u=new Date(l.date).getTime();(u<o||u>c)&&e.push(`Meal "${l.id}" date (${l.date}) is outside event range (${t.dateStart} â ${t.dateEnd})`)}}for(const o of t.meals)(!o.recipes||o.recipes.length===0)&&e.push(`Meal "${o.id}" has no recipes`);if(e.length>0)throw new Error(`Demo event validation failed:
  - ${e.join(`
  - `)}`);console.log(`[DemoEvents] â Validation passed for event: ${t.$id}`)}var R,Ae,xe,Tt,M,He,Ls,js,yi,Tn,Sr,qs,K,Wa,gr,Lu,ju,qu,Uu,Ou,Bu,xu,Hu,Vu,Wu,Gu,Qu,Ju;class sm{constructor(){y(this,K);y(this,R,new ft);y(this,Ae,P(!1));y(this,xe,P(null));y(this,Tt,P(!1));y(this,M,null);y(this,He,null);y(this,Ls,[]);y(this,js,null);y(this,yi,z(()=>{const e=new Date;return e.setHours(0,0,0,0),Array.from(i(this,R).values()).filter(r=>!r.dateStart||!r.dateEnd?!1:new Date(r.dateEnd)>=e).sort((r,s)=>{const n=new Date(r.dateStart),a=new Date(s.dateStart);return n.getTime()-a.getTime()})}));y(this,Tn,z(()=>{const e=new Date;return Array.from(i(this,R).values()).filter(r=>!r.dateStart||!r.dateEnd?!1:new Date(r.dateEnd)<e).sort((r,s)=>{const n=new Date(r.dateStart);return new Date(s.dateStart).getTime()-n.getTime()})}));y(this,Sr,null);y(this,qs,!1)}get loading(){return f(i(this,Ae))}get error(){return f(i(this,xe))}get isInitialized(){return f(i(this,Tt))}get events(){return Array.from(i(this,R).values())}get count(){return i(this,R).size}get currentEvents(){return f(i(this,yi))}get pastEvents(){return f(i(this,Tn))}get pastEventsCount(){return f(i(this,Tn)).length}async loadCache(){if(f(i(this,Tt))){console.log("[EventsStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[EventsStore] Chargement du cache..."),m(i(this,Ae),!0),m(i(this,xe),null);try{if(!T.isAuthenticated)throw new Error("Utilisateur non connectÃ©");_(this,He,T.userId),_(this,Ls,T.userTeams),_(this,M,await Xc());const e=await i(this,M).loadEvents();if(e.size>0){console.log(`[EventsStore] ${e.size} Ã©vÃ©nements chargÃ©s depuis le cache`),i(this,R).clear();for(const[r,s]of e)i(this,R).set(r,s)}m(i(this,Tt),!0),console.log(`[EventsStore] Cache chargÃ©: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw m(i(this,xe),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Ae),!1)}}async syncFromRemote(){if(!i(this,M)){console.warn("[EventsStore] Impossible de sync : cache non initialisÃ©");return}if(ae(i(this,js))){console.log("[EventsStore] Mode dÃ©mo: skip syncFromRemote");return}console.log("[EventsStore] Synchronisation depuis Appwrite..."),m(i(this,Ae),!0);try{await b(this,K,Wa).call(this),await i(this,M).saveEvents(i(this,R)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log(`[EventsStore] Synchronisation terminÃ©e: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw m(i(this,xe),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Ae),!1)}}async setupRealtime(){if(!i(this,M)){console.warn("[EventsStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,qs)){console.log("[EventsStore] Realtime dÃ©jÃ  configurÃ©");return}console.log("[EventsStore] Configuration du realtime..."),await b(this,K,Ju).call(this),_(this,qs,!0)}async initialize(){if(f(i(this,Tt))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}return i(this,Sr)?(console.log("[EventsStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,Sr)):(console.log("[EventsStore] Initialisation complÃ¨te..."),m(i(this,Ae),!0),m(i(this,xe),null),_(this,Sr,(async()=>{try{await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),console.log(`[EventsStore] Initialisation complÃ©tÃ©e: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw m(i(this,xe),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Ae),!1),_(this,Sr,null)}})()),i(this,Sr))}async initializeForPublic(){if(f(i(this,Tt))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}console.log("[EventsStore] Initialisation mode public..."),m(i(this,Ae),!0),m(i(this,xe),null);try{_(this,M,await Xc()),await this.loadDemoEvents(),m(i(this,Tt),!0),_(this,He,"guest"),_(this,Ls,[]),console.log("[EventsStore] Mode public initialisÃ© : events dÃ©mo chargÃ©s")}catch(e){throw console.error("[EventsStore] Erreur init mode public:",e),e}finally{m(i(this,Ae),!1)}}async loadDemoEvents(){console.log("[EventsStore] Loading demo events...");try{const e=await tm();console.log(`[EventsStore] Generated ${e.length} demo events`),e.forEach(r=>{i(this,R).set(r.$id,r)}),i(this,M)&&(await i(this,M).saveEvents(i(this,R)),console.log("[EventsStore] Demo events persisted to IDB")),console.log(`[EventsStore] Total events in store: ${i(this,R).size}`)}catch(e){throw console.error("[EventsStore] Error loading demo events:",e),e}}getEventById(e){return i(this,R).get(e)||null}async fetchEvent(e){try{const r=await Vp(e);if(r){const s=b(this,K,gr).call(this,r);return i(this,R).set(e,s),s}return null}catch(r){return console.error(`[EventsStore] Erreur lors du fetch de ${e}:`,r),null}}getEventsByDateRange(e,r){return this.events.filter(s=>s.dateStart&&s.dateEnd&&s.dateStart>=e&&s.dateEnd<=r)}canEditEvent(e){if(!i(this,He))return!1;const r=i(this,R).get(e);return r?!!(r.createdBy===i(this,He)||r.teams?.some(s=>i(this,Ls).includes(s))||r.contributors&&r.contributors.some(s=>s.id===i(this,He)&&s.status==="accepted")):!1}canUserEditEvent(e,r,s){const n=i(this,R).get(e);return n?n.status==="local"?!0:r?!!(n.createdBy===r||n.teams?.length&&s?.length&&n.teams.some(a=>s.includes(a))||n.contributors&&n.contributors.some(a=>a.id===r&&a.status==="accepted")):!1:!1}async createEvent(e){if(!T.userId)throw new Error("Utilisateur non connectÃ©");const r=await Wp(e,T.userId),s=b(this,K,gr).call(this,r);return i(this,R).set(r.$id,s),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã©: ${r.$id}`),s}async createEventWithTeams(e,r=[],s=!0){if(!T.userId)throw new Error("Utilisateur non connectÃ©");const n=await Gp(e,T.userId,r,s),a=b(this,K,gr).call(this,n);return i(this,R).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã© avec ${r.length} team(s): ${n.$id}`),a}async updateEvent(e,r){if(ae(e))return await b(this,K,Lu).call(this,e,r);const s=await Yc(e,r),n=b(this,K,gr).call(this,s);return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] ÃvÃ©nement mis Ã  jour: ${e}`),n}async updateEventStatus(e,r){if(ae(e)){await b(this,K,ju).call(this,e,r);return}try{await Yc(e,{status:r});const s=i(this,R).get(e);s&&(s.status=r),console.log(`[EventsStore] Statut mis Ã  jour: ${e} -> ${r}`)}catch(s){throw console.error(`[EventsStore] Erreur mise Ã  jour statut ${e}:`,s),s}}async deleteEvent(e){await Qp(e),i(this,R).delete(e),i(this,M)&&await i(this,M).deleteEvent(e),console.log(`[EventsStore] ÃvÃ©nement supprimÃ©: ${e}`)}getContributors(e){const r=i(this,R).get(e);return r?r.contributors:[]}getContributorStatus(e){const r=i(this,R).get(e);if(!r)return"";const s=r.contributors.filter(n=>n.id===i(this,He));return s.length>0?s[0].status:""}async removeContributor(e,r){try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{removeUserFromEvent:n}=await J(async()=>{const{removeUserFromEvent:o}=await Promise.resolve().then(()=>Ji);return{removeUserFromEvent:o}},void 0);await n(e,r);const a=s.contributors.filter(o=>o.id!==r&&o.email!==r);return s.contributors.length===a.length?s:await this.updateEvent(e,{contributors:a})}catch(s){throw console.error("[EventsStore] Erreur suppression contributeur:",s),s}}async inviteParticipants(e,r){try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{teamIds:n=[],emails:a=[],userIds:o=[],sendEmailToExistingMembers:c=!0}=r;if(n.length===0&&a.length===0&&o.length===0)return console.log("[EventsStore] Aucun participant Ã  inviter"),s;const{inviteParticipantsToEvent:l}=await J(async()=>{const{inviteParticipantsToEvent:p}=await Promise.resolve().then(()=>Ji);return{inviteParticipantsToEvent:p}},void 0),u=await l(e,s.name,{teamIds:n,emails:a,userIds:o,sendEmailToExistingMembers:c});console.log(`[EventsStore] Invitation result: ${u.processed} traitÃ©s`);const d=n.length>0?2e3:500;await new Promise(p=>setTimeout(p,d));const h=await this.fetchEvent(e);if(!h)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return h}catch(s){throw console.error("[EventsStore] Erreur invitation participants:",s),s}}async removeTeam(e,r){try{const{removeTeamFromEvent:s}=await J(async()=>{const{removeTeamFromEvent:a}=await Promise.resolve().then(()=>Ji);return{removeTeamFromEvent:a}},void 0);await s(e,r),await new Promise(a=>setTimeout(a,1e3));const n=await this.fetchEvent(e);if(!n)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return console.log(`[EventsStore] Team ${r} retirÃ©e de l'Ã©vÃ©nement ${e}`),n}catch(s){throw console.error("[EventsStore] Erreur retrait team:",s),s}}async updateContributorStatus(e,r,s){if(ae(e))return await b(this,K,Qu).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(c=>c.id===r||c.email===r);if(o===-1)throw new Error("Contributeur introuvable");return a[o]={...a[o],status:s,respondedAt:new Date().toISOString()},await this.updateEvent(e,{contributors:a})}catch(n){throw console.error("[EventsStore] Erreur maj statut:",n),n}}getMeals(e){const r=i(this,R).get(e);return r?r.meals:[]}async addMeal(e,r){if(ae(e))return await b(this,K,qu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals,r];return await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur ajout meal:",s),s}}async updateMeal(e,r,s){if(ae(e))return await b(this,K,Uu).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");return a[r]=s,await this.updateEvent(e,{meals:a})}catch(n){throw console.error("[EventsStore] Erreur maj meal:",n),n}}async deleteMeal(e,r){if(ae(e))return await b(this,K,Ou).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");return n.splice(r,1),await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur suppression meal:",s),s}}getTodos(e){const r=i(this,R).get(e);return r?r.todos:[]}async addTodo(e,r){if(ae(e))return await b(this,K,Bu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todo:",s),s}}async addTodos(e,r){if(ae(e))return await b(this,K,xu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,...r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todos:",s),s}}async updateTodoStatus(e,r,s){if(ae(e)){await b(this,K,Wu).call(this,e,r,s);return}try{const n=i(this,R).get(e);n&&(n.todos=n.todos.map(c=>c.id===r?{...c,status:s,updatedAt:new Date().toISOString()}:c));const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"update_todo_status",data:{eventId:e,todoId:r,status:s}}),!1,"/",In.POST)}catch(n){throw console.error("[EventsStore] Erreur updateTodoStatus:",n),n}}async toggleTodoAssignment(e,r){if(ae(e)){await b(this,K,Gu).call(this,e,r);return}try{const s=T.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const n=i(this,R).get(e);if(n){const c=n.todos.find(l=>l.id===r);if(c){let l=[];Array.isArray(c.assignedTo)?l=[...c.assignedTo]:c.assignedTo&&(l=[c.assignedTo]),l.includes(s)?l=l.filter(u=>u!==s):l.push(s),n.todos=n.todos.map(u=>u.id===r?{...u,assignedTo:l.length>0?l:null,updatedAt:new Date().toISOString()}:u)}}const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"toggle_todo_assignment",data:{eventId:e,todoId:r}}),!1,"/",In.POST)}catch(s){throw console.error("[EventsStore] Erreur toggleTodoAssignment:",s),s}}async updateTodo(e,r,s){if(ae(e))return await b(this,K,Hu).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(o=>o.id===r?{...o,...s,updatedAt:new Date().toISOString()}:o);return await this.updateEvent(e,{todos:a})}catch(n){throw console.error("[EventsStore] Erreur maj todo:",n),n}}async deleteTodo(e,r){if(ae(e))return await b(this,K,Vu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(a=>a.id!==r);return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur suppression todo:",s),s}}async loadAllPastEvents(){try{if(console.log("[EventsStore] Chargement de TOUS les Ã©vÃ©nements..."),!i(this,He)){console.warn("[EventsStore] userId non dÃ©fini");return}m(i(this,Ae),!0);const{events:e}=await Kc(i(this,He),null);e.forEach(r=>{i(this,R).set(r.$id,b(this,K,gr).call(this,r))}),console.log(`[EventsStore] ${e.length} Ã©vÃ©nements chargÃ©s (sans filtre de date, total: ${i(this,R).size})`)}catch(e){throw console.error("[EventsStore] Erreur lors du chargement:",e),e}finally{m(i(this,Ae),!1)}}calculateScaleFactor(e,r){return e/r}async loadPosterConfig(e){return i(this,M)?await i(this,M).loadPosterConfig(e):null}async savePosterConfig(e,r){if(!i(this,M))return;const n=await i(this,M).loadPosterConfig(e)||{versions:[]};n.current=r,await i(this,M).savePosterConfig(e,n)}async createPosterVersion(e,r,s){if(!i(this,M))return;const a=await i(this,M).loadPosterConfig(e)||{current:r,versions:[]};if(a.versions||(a.versions=[]),a.versions.length>=3)throw new Error("Limite de 3 versions atteinte");const o={id:crypto.randomUUID(),name:s,config:JSON.parse(JSON.stringify(r)),createdAt:new Date().toISOString()};return a.versions.push(o),a.current=r,await i(this,M).savePosterConfig(e,a),o}async deletePosterVersion(e,r){if(!i(this,M))return;const s=await i(this,M).loadPosterConfig(e);!s||!s.versions||(s.versions=s.versions.filter(n=>n.id!==r),await i(this,M).savePosterConfig(e,s))}async reload(){console.log("[EventsStore] Rechargement..."),m(i(this,Ae),!0),m(i(this,xe),null);try{i(this,R).clear(),await b(this,K,Wa).call(this),console.log("[EventsStore] Rechargement complÃ©tÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw m(i(this,xe),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Ae),!1)}}async hardReset(){console.log("[EventsStore] ð HARD RESET - Vidage complet..."),m(i(this,Ae),!0),m(i(this,xe),null);try{i(this,R).clear(),i(this,M)&&(await i(this,M).clear(),console.log("[EventsStore] Cache IDB vidÃ©")),await b(this,K,Wa).call(this),i(this,M)&&(await i(this,M).saveEvents(i(this,R)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log("[EventsStore] Cache IDB recrÃ©Ã©")),console.log("[EventsStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,xe),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Ae),!1)}}destroy(){i(this,M)&&(i(this,M).close(),_(this,M,null)),i(this,R).clear(),m(i(this,Tt),!1),_(this,qs,!1),console.log("[EventsStore] Ressources nettoyÃ©es")}}R=new WeakMap,Ae=new WeakMap,xe=new WeakMap,Tt=new WeakMap,M=new WeakMap,He=new WeakMap,Ls=new WeakMap,js=new WeakMap,yi=new WeakMap,Tn=new WeakMap,Sr=new WeakMap,qs=new WeakMap,K=new WeakSet,Wa=async function(e=null){if(ae(i(this,js))){console.log("[EventsStore] Mode dÃ©mo: skip loadEvents from Appwrite");return}try{if(console.log("[EventsStore] Chargement des Ã©vÃ©nements..."),!i(this,He)){console.warn("[EventsStore] userId non dÃ©fini, impossible de charger les Ã©vÃ©nements");return}if(!e){const s=new Date;s.setHours(0,0,0,0);const n=new Date(s);n.setDate(n.getDate()-15),e=n.toISOString()}const{events:r}=await Kc(i(this,He),e);r.forEach(s=>{i(this,R).set(s.$id,b(this,K,gr).call(this,s))}),console.log(`[EventsStore] ${r.length} Ã©vÃ©nements chargÃ©s (filtrÃ©s pour userId: ${i(this,He)}, date >= ${e})`)}catch(r){throw console.error("[EventsStore] Erreur lors du chargement:",r),r}},gr=function(e){return{...e,status:e.status,teams:e.teams||void 0,teamsId:e.teamsId||void 0,meals:Jp(e.meals),contributors:Kp(e.contributors),todos:Yp(e.todos)}},Lu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,...r,$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Event mis Ã  jour: ${e}`),n},ju=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");s.status=r,s.$updatedAt=new Date().toISOString(),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] Mode local: Status mis Ã  jour: ${e} -> ${r}`)},qu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,meals:[...s.meals,r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Meal ajoutÃ© Ã  ${e}`),n},Uu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");a[r]=s;const o={...n,meals:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Meal mis Ã  jour dans ${e}`),o},Ou=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");n.splice(r,1);const a={...s,meals:n,$updatedAt:new Date().toISOString()};return i(this,R).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Meal supprimÃ© de ${e}`),a},Bu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo ajoutÃ© Ã  ${e}`),n},xu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,...r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: ${r.length} todos ajoutÃ©s Ã  ${e}`),n},Hu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(c=>c.id===r?{...c,...s,updatedAt:new Date().toISOString()}:c),o={...n,todos:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Todo mis Ã  jour dans ${e}`),o},Vu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(o=>o.id!==r),a={...s,todos:n,$updatedAt:new Date().toISOString()};return i(this,R).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Todo supprimÃ© de ${e}`),a},Wu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");n.todos=n.todos.map(a=>a.id===r?{...a,status:s,updatedAt:new Date().toISOString()}:a),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo status mis Ã  jour: ${r} -> ${s}`)},Gu=async function(e,r){const s=T.userId||"guest",n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.find(c=>c.id===r);if(!a)throw new Error("Todo introuvable");let o=[];Array.isArray(a.assignedTo)?o=[...a.assignedTo]:a.assignedTo&&(o=[a.assignedTo]),o.includes(s)?o=o.filter(c=>c!==s):o.push(s),n.todos=n.todos.map(c=>c.id===r?{...c,assignedTo:o.length>0?o:null,updatedAt:new Date().toISOString()}:c),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo assignment toggled: ${r} par ${s}`)},Qu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(l=>l.id===r||l.email===r);if(o===-1)throw new Error("Contributeur introuvable");a[o]={...a[o],status:s,respondedAt:new Date().toISOString()};const c={...n,contributors:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,c),i(this,M)&&await i(this,M).saveEvent(c),console.log(`[EventsStore] Mode local: Contributor status mis Ã  jour: ${r} -> ${s}`),c},Ju=async function(){if(ae(i(this,js))){console.log("[EventsStore] Mode dÃ©mo: skip realtime setup");return}try{console.log("[EventsStore] Activation du Realtime...");const e=lt();Ht.register([`databases.${e}.collections.${nn}.documents`],async r=>{const s=r.events.some(a=>a.includes(".create"))?"create":r.events.some(a=>a.includes(".delete"))?"delete":"update",n=r.payload;if(console.log(`[EventsStore] â¡ï¸ Realtime RECEIVED: ${s} pour ${n.$id}`,{name:n.name,updatedAt:n.$updatedAt}),s==="create"||s==="update"){const a=b(this,K,gr).call(this,n);i(this,R).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a)}else s==="delete"&&(i(this,R).delete(n.$id),i(this,M)&&await i(this,M).deleteEvent(n.$id))}),console.log("[EventsStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[EventsStore] Erreur lors de la configuration du realtime:",e)}};const Ye=new sm,Aa=ms(),_a="materiel";async function zc(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel] Error listing materiels:",e),e}}async function nm(t,e){try{const{tables:r}=await D(),s=ht.unique();let n;try{n=typeof t.owner=="string"?JSON.parse(t.owner):t.owner}catch(c){throw console.error("[appwrite-materiel] Error parsing owner:",t.owner,c),new Error("Invalid owner format")}const a=[te.read(ie.user(e)),te.update(ie.user(e))];n.teamId?a.push(te.read(ie.team(n.teamId)),te.update(ie.team(n.teamId))):n.userId&&a.push(te.read(ie.user(n.userId)),te.update(ie.user(n.userId)));const o=await r.createRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:s,data:{name:t.name,description:t.description||null,type:t.type||null,quantity:t.quantity,status:t.status||"ok",location:t.location||null,shareableWith:t.shareableWith||null,owner:t.owner},permissions:a});return console.log(`[appwrite-materiel] Materiel created: ${s}`),o}catch(r){throw console.error("[appwrite-materiel] Error creating materiel:",r),r}}async function La(t,e){try{const{tables:r}=await D(),s=await r.updateRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:t,data:e});return console.log(`[appwrite-materiel] Materiel updated: ${t}`),s}catch(r){throw console.error(`[appwrite-materiel] Error updating materiel ${t}:`,r),r}}async function am(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:t}),console.log(`[appwrite-materiel] Materiel deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel] Error deleting materiel ${t}:`,e),e}}function im(){return[`databases.${Aa.APPWRITE_CONFIG.databaseId}.collections.${_a}.documents`]}const Ra=ms(),Pa="materiel_loan";async function Fc(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel-loan] Error listing loans:",e),e}}async function om(t,e){try{const{tables:r}=await D(),s=ht.unique(),n=[te.read(ie.user(e)),te.update(ie.user(e)),te.read(ie.team(t.ownerId)),te.update(ie.team(t.ownerId))],a=await r.createRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:s,data:{startDate:t.startDate,endDate:t.endDate,responsibleId:t.responsibleId,responsibleName:t.responsibleName,ownerId:t.ownerId,ownerName:t.ownerName,materiels:t.materiels.map(o=>JSON.stringify(o)),notes:t.notes||null,status:t.status||"asked",completedAt:null,returnedAt:null,returnNotes:null},permissions:n});return console.log(`[appwrite-materiel-loan] Loan created: ${s}`),a}catch(r){throw console.error("[appwrite-materiel-loan] Error creating loan:",r),r}}async function cm(t,e){try{const{tables:r}=await D(),s={};e.startDate!==void 0&&(s.startDate=e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate),e.materiels!==void 0&&(s.materiels=e.materiels.map(a=>JSON.stringify(a))),e.status!==void 0&&(s.status=e.status),e.notes!==void 0&&(s.notes=e.notes),e.returnedAt!==void 0&&(s.returnedAt=e.returnedAt),e.returnNotes!==void 0&&(s.returnNotes=e.returnNotes);const n=await r.updateRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:t,data:s});return console.log(`[appwrite-materiel-loan] Loan updated: ${t}`),n}catch(r){throw console.error(`[appwrite-materiel-loan] Error updating loan ${t}:`,r),r}}async function lm(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:t}),console.log(`[appwrite-materiel-loan] Loan deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel-loan] Error deleting loan ${t}:`,e),e}}function um(){return[`databases.${Ra.APPWRITE_CONFIG.databaseId}.collections.${Pa}.documents`]}class dm{constructor(){C(this,"dbName","materiel-cache");C(this,"db",null);C(this,"version",1);C(this,"MATERIELS_STORE","materiels");C(this,"LOANS_STORE","loans");C(this,"METADATA_STORE","metadata");C(this,"LAST_SYNC_MATERIEL_KEY","lastSyncMateriel");C(this,"LAST_SYNC_LOANS_KEY","lastSyncLoans")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.MATERIELS_STORE)||(d.createObjectStore(this.MATERIELS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'materiels' crÃ©Ã©")),d.objectStoreNames.contains(this.LOANS_STORE)||(d.createObjectStore(this.LOANS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'loans' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[MaterielIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.MATERIELS_STORE),n=r.objectStoreNames.contains(this.LOANS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[MaterielIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (materiels=${s}, loans=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[MaterielIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[MaterielIDBCache] Base ouverte: ${this.dbName}`)}async loadMateriels(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.MATERIELS_STORE,"readonly").objectStore(this.MATERIELS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} matÃ©riels chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveMateriels(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.MATERIELS_STORE,"readwrite"),a=n.objectStore(this.MATERIELS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} matÃ©riels sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadLoans(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.LOANS_STORE,"readonly").objectStore(this.LOANS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} emprunts chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveLoans(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.LOANS_STORE,"readwrite"),a=n.objectStore(this.LOANS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} emprunts sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSyncMateriel:null,lastSyncLoans:null};o.forEach(l=>{l.key===this.LAST_SYNC_MATERIEL_KEY&&(c.lastSyncMateriel=l.value),l.key===this.LAST_SYNC_LOANS_KEY&&(c.lastSyncLoans=l.value)}),console.log(`[MaterielIDBCache] Metadata chargÃ©es: lastSyncMateriel=${c.lastSyncMateriel}, lastSyncLoans=${c.lastSyncLoans}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_MATERIEL_KEY,value:e.lastSyncMateriel}),a.put({key:this.LAST_SYNC_LOANS_KEY,value:e.lastSyncLoans}),n.oncomplete=()=>{console.log("[MaterielIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.MATERIELS_STORE,this.LOANS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.MATERIELS_STORE).clear(),s.objectStore(this.LOANS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[MaterielIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[MaterielIDBCache] Connexion fermÃ©e"))}}async function fm(){const t=new dm;return await t.open(),t}function No(t){const e={electronic:{label:"Ãlectronique",badgeClass:"badge-warning",textColor:"text-warning",bgColor:"bg-warning/10"},manual:{label:"Manuel",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},tools:{label:"Outils",badgeClass:"badge-secondary",textColor:"text-secondary",bgColor:"bg-secondary/10"},dish:{label:"Vaisselle",badgeClass:"badge-primary",textColor:"text-primary",bgColor:"bg-primary/10"},cooking:{label:"Cuisine",badgeClass:"badge-success",textColor:"text-success",bgColor:"bg-success/10"},gaz:{label:"Gaz",badgeClass:"badge-error",textColor:"text-error",bgColor:"bg-error/10"},hygiene:{label:"HygiÃ¨ne",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},other:{label:"Autre",badgeClass:"badge-neutral",textColor:"text-neutral",bgColor:"bg-neutral/10"}};return e[t||"other"]||e.other}function $y(t){return No(t).badgeClass}function ky(t){return No(t).textColor}function Cy(t){return No(t).bgColor}function Ty(t){return{ok:"OK",lost:"Perdu",torepair:"Ã rÃ©parer"}[t||"ok"]||t||"OK"}const el={userName:"",userId:"",teamName:"",teamId:""};function hm(t){if(!t)return el;try{return typeof t=="string"?JSON.parse(t):t}catch(e){return console.error("[materiel.utils] Error parsing owner from Appwrite:",t,e),el}}function Lo(t){if(!t)return[];try{return Array.isArray(t)?t.map(e=>{try{return JSON.parse(e)}catch{return console.warn("[materiel.utils] Failed to parse loan item string:",e),null}}).filter(e=>e!==null):typeof t=="string"?JSON.parse(t):[]}catch(e){return console.error("[materiel.utils] Error parsing loan items from Appwrite:",t,e),[]}}function pm(t){return Lo(t)}function dn(t){return{...t,materielItems:pm(t.materiels)}}function Ku(t,e,r=new Date){const s=hm(t.owner),n=[];let a=0;e.forEach(u=>{const h=Lo(u.materiels).filter(I=>I.materielId===t.$id);if(h.length===0)return;const p=new Date(u.startDate),g=new Date(u.endDate),w=p<=r&&g>=r,A=p>r,E=["accepted","asked"].includes(u.status);(w||A)&&E&&h.forEach(I=>{n.push({loanId:u.$id,responsibleName:u.responsibleName||"",startDate:u.startDate,endDate:u.endDate,quantity:I.quantity,status:u.status})}),w&&E&&h.forEach(I=>{a+=I.quantity})});const c=n.some(u=>{const d=new Date(u.startDate),h=new Date(u.endDate);return d<=r&&h>=r})?"loan":t.status,l=t.quantity-a;return{...t,status:c,ownerData:s,loanDetails:n,availableQuantity:l,totalLoanedQuantity:a,isAvailable:l>0,isFullyLoaned:l===0}}function mm(t,e){const r={...t};return Ku(r,e)}function gm(t){return["asked","accepted"].includes(t.status)}function ym(t,e,r,s){return t<=s&&e>=r}function wm(t,e,r,s){let n=0;return e.forEach(a=>{if(!gm(a))return;const o=new Date(a.startDate),c=new Date(a.endDate);if(!ym(o,c,r,s))return;const u=Lo(a.materiels).filter(d=>d.materielId===t);n+=u.reduce((d,h)=>d+h.quantity,0)}),n}var pe,we,ne,me,he,ss,Nn,Us,Nt,Lt,wi,rr,vi,bi,Ei,Ln,oe,Yu,Xu,Zu,zu,Fu,ed,Is,As;class vm{constructor(){y(this,oe);y(this,pe,new ft);y(this,we,new ft);y(this,ne,null);y(this,me,P(!1));y(this,he,P(null));y(this,ss,P(!1));y(this,Nn,P(!1));y(this,Us,!1);y(this,Nt,P(null));y(this,Lt,P(null));y(this,wi,null);y(this,rr,z(()=>Array.from(i(this,pe).values())));y(this,vi,z(()=>Array.from(i(this,we).values())));y(this,bi,z(()=>{if(!T.userId)return[];const e=gt.myTeams.map(r=>r.$id);return f(i(this,rr)).filter(r=>r.ownerData?.teamId&&e.includes(r.ownerData.teamId))}));y(this,Ei,z(()=>{if(!T.userId)return[];const e=gt.myTeams.map(r=>r.$id);return f(i(this,rr)).filter(r=>r.shareableWith?.some(n=>e.includes(n))&&!(r.ownerData?.teamId&&e.includes(r.ownerData.teamId)))}));y(this,Ln,z(()=>f(i(this,rr)).filter(e=>e.isAvailable)))}get loading(){return f(i(this,me))}get error(){return f(i(this,he))}get isInitialized(){return f(i(this,ss))}get isRealtimeActive(){return f(i(this,Nn))}get count(){return i(this,pe).size}get materiels(){return f(i(this,rr))}get loans(){return f(i(this,vi))}get teamMateriels(){return f(i(this,bi))}get shareableMateriels(){return f(i(this,Ei))}get availableMateriels(){return f(i(this,Ln))}getAvailableMaterielsByOwner(e){return f(i(this,Ln)).filter(r=>r.ownerData?.teamId===e&&r.status!=="lost"&&r.status!=="torepair")}getMaterielsByOwner(e){return f(i(this,rr)).filter(r=>r.ownerData?.teamId===e)}getAvailableMaterielsForPeriod(e,r,s){const n=new Date(r),a=new Date(s),o=Array.from(i(this,we).values());return f(i(this,rr)).filter(c=>c.ownerData?.teamId===e).filter(c=>c.status!=="lost"&&c.status!=="torepair").map(c=>{const l=wm(c.$id,o,n,a),u=c.quantity-l;return{...c,availableForPeriod:u}}).filter(c=>c.availableForPeriod>0)}async loadCache(){if(!f(i(this,ss))){m(i(this,me),!0),m(i(this,he),null);try{if(!T.userId){m(i(this,ss),!0);return}_(this,ne,await fm()),await b(this,oe,Yu).call(this),m(i(this,ss),!0),console.log(`[MaterielStore] Cache chargÃ© : ${i(this,pe).size} matÃ©riels, ${i(this,we).size} emprunts`)}catch(e){throw m(i(this,he),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[MaterielStore] LoadCache error:",e),e}finally{m(i(this,me),!1)}}}async syncFromRemote(){m(i(this,me),!0),m(i(this,he),null);try{if(!T.userId)return;await b(this,oe,Xu).call(this),console.log(`[MaterielStore] Sync terminÃ© : ${i(this,pe).size} matÃ©riels, ${i(this,we).size} emprunts`)}catch(e){throw m(i(this,he),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[MaterielStore] SyncFromRemote error:",e),e}finally{m(i(this,me),!1)}}async setupRealtime(){if(T.userId){if(i(this,Us)){console.log("[MaterielStore] Realtime dÃ©jÃ  configurÃ©");return}try{await b(this,oe,zu).call(this),m(i(this,Nn),!0),_(this,Us,!0),console.log("[MaterielStore] Realtime configurÃ©")}catch(e){throw m(i(this,he),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[MaterielStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}getMaterielById(e){return i(this,pe).get(e)}getLoanById(e){return i(this,we).get(e)}async createMateriel(e){m(i(this,me),!0),m(i(this,he),null);try{if(!T.userId)throw new Error("Utilisateur non connectÃ©");const r=await nm(e,T.userId),s=b(this,oe,Is).call(this,r);return i(this,pe).set(r.$id,s),i(this,ne)?.upsertMateriel(s),s}catch(r){throw m(i(this,he),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{m(i(this,me),!1)}}async updateMateriel(e,r){m(i(this,me),!0),m(i(this,he),null);try{const s=await La(e,r),n=b(this,oe,Is).call(this,s);i(this,pe).set(s.$id,n),i(this,ne)?.upsertMateriel(n)}catch(s){throw m(i(this,he),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{m(i(this,me),!1)}}async deleteMateriel(e){m(i(this,me),!0),m(i(this,he),null);try{await am(e),i(this,pe).delete(e),i(this,ne)?.deleteMateriel(e)}catch(r){throw m(i(this,he),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{m(i(this,me),!1)}}async createLoan(e){m(i(this,me),!0),m(i(this,he),null);try{if(!T.userId)throw new Error("Utilisateur non connectÃ©");const r=await om(e,T.userId);return dn(r)}catch(r){throw m(i(this,he),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{m(i(this,me),!1)}}async updateLoan(e,r){m(i(this,me),!0),m(i(this,he),null);try{await cm(e,r)}catch(s){throw m(i(this,he),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{m(i(this,me),!1)}}async acceptLoan(e){await this.updateLoan(e,{status:"accepted"})}async refuseLoan(e){await this.updateLoan(e,{status:"refused"})}async cancelLoan(e){await this.updateLoan(e,{status:"canceled"})}async completeLoanWithReturn(e,r){for(const s of r.materiels){const n=s.lostQuantity||0,a=s.brokenQuantity||0;n+a>=s.quantity?await La(s.materielId,{status:"lost"}):a>0?await La(s.materielId,{status:"torepair"}):await La(s.materielId,{status:"ok"})}await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString(),returnNotes:r.returnNotes,materiels:r.materiels})}async completeLoan(e){await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString()})}async deleteLoan(e){m(i(this,me),!0),m(i(this,he),null);try{const r=i(this,we).get(e);r&&b(this,oe,As).call(this,r),await lm(e)}catch(r){throw m(i(this,he),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{m(i(this,me),!1)}}async hardReset(){console.log("[MaterielStore] ð HARD RESET - Vidage complet..."),m(i(this,me),!0),m(i(this,he),null);try{if(i(this,pe).clear(),i(this,we).clear(),i(this,ne)&&(await i(this,ne).clear(),console.log("[MaterielStore] Cache IDB vidÃ©")),await b(this,oe,Zu).call(this),i(this,ne)){for(const[,e]of i(this,pe))await i(this,ne).upsertMateriel(e);for(const[,e]of i(this,we))await i(this,ne).upsertLoan(e);await i(this,ne).saveMetadata({lastSyncMateriel:f(i(this,Nt)),lastSyncLoans:f(i(this,Lt))}),console.log("[MaterielStore] Cache IDB recrÃ©Ã©")}console.log("[MaterielStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,he),r,!0),console.error("[MaterielStore] Erreur hard reset:",e),e}finally{m(i(this,me),!1)}}destroy(){var e;(e=i(this,wi))==null||e.call(this),i(this,pe).clear(),i(this,we).clear(),_(this,ne,null),_(this,Us,!1)}}pe=new WeakMap,we=new WeakMap,ne=new WeakMap,me=new WeakMap,he=new WeakMap,ss=new WeakMap,Nn=new WeakMap,Us=new WeakMap,Nt=new WeakMap,Lt=new WeakMap,wi=new WeakMap,rr=new WeakMap,vi=new WeakMap,bi=new WeakMap,Ei=new WeakMap,Ln=new WeakMap,oe=new WeakSet,Yu=async function(){if(i(this,ne))try{(await i(this,ne).loadMateriels()).forEach(n=>{i(this,pe).set(n.$id,n)}),(await i(this,ne).loadLoans()).forEach(n=>{const a=dn(n);i(this,we).set(n.$id,a)});const s=await i(this,ne).loadMetadata();m(i(this,Nt),s.lastSyncMateriel,!0),m(i(this,Lt),s.lastSyncLoans,!0),console.log(`[MaterielStore] ${i(this,pe).size} matÃ©riels et ${i(this,we).size} emprunts chargÃ©s du cache IDB`)}catch(e){console.warn("[MaterielStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Xu=async function(){try{const e=f(i(this,Nt))?[S.greaterThan("$updatedAt",f(i(this,Nt)))]:[],r=await zc(e);for(const a of r){const o=b(this,oe,Is).call(this,a);i(this,pe).set(a.$id,o),i(this,ne)?.upsertMateriel(o)}m(i(this,Nt),new Date().toISOString(),!0);const s=f(i(this,Lt))?[S.greaterThan("$updatedAt",f(i(this,Lt))),S.limit(100)]:[],n=await Fc(s);for(const a of n){const o=dn(a);i(this,we).set(a.$id,o),i(this,ne)?.upsertLoan(a),b(this,oe,As).call(this,o)}m(i(this,Lt),new Date().toISOString(),!0),await i(this,ne)?.saveMetadata({lastSyncMateriel:f(i(this,Nt)),lastSyncLoans:f(i(this,Lt))}),console.log("[MaterielStore] Sync terminÃ©")}catch(e){throw console.error("[MaterielStore] Erreur sync:",e),e}},Zu=async function(){try{console.log("[MaterielStore] Chargement complet depuis Appwrite...");const e=await zc([S.limit(1e3)]);for(const n of e){const a=b(this,oe,Is).call(this,n);i(this,pe).set(n.$id,a)}const r=await Fc([S.limit(1e3)]),s=[];for(const n of r){const a=dn(n);i(this,we).set(n.$id,a),s.push(a)}for(const n of s)b(this,oe,As).call(this,n);m(i(this,Nt),new Date().toISOString(),!0),m(i(this,Lt),new Date().toISOString(),!0),console.log(`[MaterielStore] ${e.length} matÃ©riels et ${r.length} emprunts chargÃ©s`)}catch(e){throw console.error("[MaterielStore] Erreur chargement complet:",e),e}},zu=async function(){Ht.register(im(),async e=>{await b(this,oe,Fu).call(this,e)}),Ht.register(um(),async e=>{await b(this,oe,ed).call(this,e)})},Fu=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Materiel : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Materiel RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=b(this,oe,Is).call(this,s);i(this,pe).set(s.$id,a),i(this,ne)?.upsertMateriel(a)}else n==="delete"&&(i(this,pe).delete(s.$id),i(this,ne)?.deleteMateriel(s.$id))}catch(r){console.error("[MaterielStore] Erreur realtime Materiel:",r)}},ed=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Loan : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Loan RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=dn(s);i(this,we).set(s.$id,a),i(this,ne)?.upsertLoan(s),b(this,oe,As).call(this,a)}else if(n==="delete"){const a=i(this,we).get(s.$id);a&&b(this,oe,As).call(this,a),i(this,we).delete(s.$id),i(this,ne)?.deleteLoan(s.$id)}}catch(r){console.error("[MaterielStore] Erreur realtime Loan:",r)}},Is=function(e){const r=Array.from(i(this,we).values());return Ku(e,r)},As=function(e){const r=e.materielItems,s=Array.from(i(this,we).values());for(const n of r){const a=i(this,pe).get(n.materielId);if(a){const o=mm(a,s);i(this,pe).set(n.materielId,o),i(this,ne)?.upsertMateriel(o)}}};const tl=new vm,Ni="teamdocs";async function bm(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:Ni})).rows}catch(t){throw console.error("[appwrite-teamdocs] Error listing documents:",t),t}}async function Em(t,e,r,s){try{const{tables:n,config:a}=await D(),o=[te.read(ie.team(e)),te.update(ie.team(e)),te.delete(ie.team(e))],c=await n.createRow({databaseId:a.databaseId,tableId:Ni,rowId:ht.unique(),data:{...t,teamId:e,createdBy:r},permissions:o});return console.log(`[appwrite-teamdocs] Document created: ${c.$id}`),c}catch(n){throw console.error("[appwrite-teamdocs] Error creating document:",n),n}}async function td(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow({databaseId:s.databaseId,tableId:Ni,rowId:t,data:e});return console.log(`[appwrite-teamdocs] Document updated: ${t}`),n}catch(r){throw console.error(`[appwrite-teamdocs] Error updating document ${t}:`,r),r}}async function Sm(t){try{const{tables:e,config:r}=await D();await e.deleteRow({databaseId:r.databaseId,tableId:Ni,rowId:t}),console.log(`[appwrite-teamdocs] Document deleted: ${t}`)}catch(e){throw console.error(`[appwrite-teamdocs] Error deleting document ${t}:`,e),e}}async function Im(t,e){try{await td(t,{lockedBy:e}),console.log(`[appwrite-teamdocs] Lock ${t} mis Ã  jour: ${e||"libÃ©rÃ©"}`)}catch(r){throw console.error(`[appwrite-teamdocs] Erreur verrouillage ${t}:`,r),r}}var Ce,Os,Ir,sr,Ar,Bs,xs,jn,ns,Hs,st,rd,sd,Wr;class Am{constructor(){y(this,st);y(this,Ce,new ft);y(this,Os,new ft);y(this,Ir,P(!1));y(this,sr,P(null));y(this,Ar,P(!1));y(this,Bs,P(!1));y(this,xs,!1);y(this,jn,P(null));y(this,ns,null);y(this,Hs,z(()=>Array.from(i(this,Ce).values())))}get loading(){return f(i(this,Ir))}get error(){return f(i(this,sr))}get isInitialized(){return f(i(this,Ar))}get isRealtimeActive(){return f(i(this,Bs))}get count(){return i(this,Ce).size}get documents(){return f(i(this,Hs))}getTeamDocuments(e){return f(i(this,Hs)).filter(r=>r.teamId===e)}getTeamTags(e){return i(this,Os).get(e)||[]}async loadCache(){if(!f(i(this,Ar))){m(i(this,Ir),!0),m(i(this,sr),null);try{if(!T.userId){m(i(this,Ar),!0);return}m(i(this,Ar),!0),console.log("[TeamdocsStore] Cache chargÃ© (sans IDB)")}catch(e){throw m(i(this,sr),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[TeamdocsStore] LoadCache error:",e),e}finally{m(i(this,Ir),!1)}}}async syncFromRemote(){m(i(this,Ir),!0),m(i(this,sr),null);try{if(!T.userId)return;const e=await bm();for(const r of e)i(this,Ce).set(r.$id,r);await b(this,st,Wr).call(this),m(i(this,jn),new Date().toISOString(),!0),console.log(`[TeamdocsStore] Sync terminÃ© : ${i(this,Ce).size} documents`)}catch(e){throw m(i(this,sr),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[TeamdocsStore] SyncFromRemote error:",e),e}finally{m(i(this,Ir),!1)}}async setupRealtime(){if(T.userId){if(i(this,xs)){console.log("[TeamdocsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await b(this,st,rd).call(this),m(i(this,Bs),!0),_(this,xs,!0),console.log("[TeamdocsStore] Realtime configurÃ©")}catch(e){throw m(i(this,sr),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[TeamdocsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async createDocument(e,r){if(!T.userId||!T.userName)throw new Error("Utilisateur non connectÃ©");const s=await Em(e,r,T.userId,T.userName);return i(this,Ce).set(s.$id,s),await b(this,st,Wr).call(this),console.log(`[TeamdocsStore] Document crÃ©Ã© : ${s.$id}`),s}async updateDocument(e,r){const s=await td(e,r);return i(this,Ce).set(e,s),r.tags&&await b(this,st,Wr).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${e}`),s}async deleteDocument(e){await Sm(e),i(this,Ce).delete(e),await b(this,st,Wr).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${e}`)}getDocumentById(e){return i(this,Ce).get(e)}async updateDocumentLock(e,r){if(T.userId)try{await Im(e,r);const s=i(this,Ce).get(e);s&&i(this,Ce).set(e,{...s,lockedBy:r}),console.log(`[TeamdocsStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`)}catch(s){throw console.error(`[TeamdocsStore] Erreur verrouillage ${e}:`,s),s}}destroy(){i(this,ns)&&(i(this,ns).call(this),_(this,ns,null)),i(this,Ce).clear(),i(this,Os).clear(),m(i(this,Ar),!1),m(i(this,Bs),!1),_(this,xs,!1),console.log("[TeamdocsStore] Store dÃ©truit")}async hardReset(){this.destroy(),m(i(this,jn),null),console.log("[TeamdocsStore] Hard reset effectuÃ©")}}Ce=new WeakMap,Os=new WeakMap,Ir=new WeakMap,sr=new WeakMap,Ar=new WeakMap,Bs=new WeakMap,xs=new WeakMap,jn=new WeakMap,ns=new WeakMap,Hs=new WeakMap,st=new WeakSet,rd=async function(){const e=["databases.*.collections.undefined"];Ht.register(e,async r=>{await b(this,st,sd).call(this,r)}),_(this,ns,()=>{})},sd=async function(e){const{events:r,payload:s}=e,n=r?.[0];if(!n)return;const a=s;switch(n){case"databases.*.collections.*.documents.create":case"databases.*.collections.*.documents.update":a&&(i(this,Ce).set(a.$id,a),await b(this,st,Wr).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${a.$id}`));break;case"databases.*.collections.*.documents.delete":a?.$id&&(i(this,Ce).delete(a.$id),await b(this,st,Wr).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${a.$id}`));break}},Wr=async function(){const e=new Map;for(const r of f(i(this,Hs))){const s=r.teamId;e.has(s)||e.set(s,new Set),r.tags&&r.tags.forEach(n=>{e.get(s).add(n)})}e.forEach((r,s)=>{i(this,Os).set(s,Array.from(r).sort())}),console.log(`[TeamdocsStore] Tags mis Ã  jour pour ${e.size} Ã©quipes`)};const rl=new Am;var qn,Vs,Ws,Br,nd,ad,id;class _m{constructor(){y(this,Br);y(this,qn,P(!1));y(this,Vs,!1);y(this,Ws,[])}async initialize(){const e=T.userId;if(!e){console.error("[NotificationStore] No userId found, cannot initialize");return}const r=lt();try{const n=await(await D()).tables.getRow({databaseId:r,tableId:"user_notifications",rowId:e});_(this,Ws,JSON.parse(n.notifications||"[]")),console.log(`[NotificationStore] User row found for ${e}`)}catch(s){if(s.code===404)console.log(`[NotificationStore] User row not found, creating lazy init for ${e}`),await b(this,Br,id).call(this,e),_(this,Ws,[]);else throw console.error("[NotificationStore] Error fetching user row:",s),s}await this.setupRealtime()}async setupRealtime(){if(i(this,Vs)){console.log("[NotificationStore] Already initialized, skipping.");return}try{console.log("[NotificationStore] Setting up realtime...");const e=lt();Ht.register([`databases.${e}.collections.user_notifications.documents`],async r=>await b(this,Br,nd).call(this,r)),m(i(this,qn),!0),_(this,Vs,!0),console.log("[NotificationStore] â Realtime configured (RealtimeManager)")}catch(e){throw console.error("[NotificationStore] Error configuring realtime:",e),e}}destroy(){m(i(this,qn),!1),_(this,Vs,!1),_(this,Ws,[]),console.log("[NotificationStore] Store destroyed")}}qn=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,Br=new WeakSet,nd=async function(e){console.log("[NotificationStore] ð¨ Raw realtime event:",{events:e.events,channels:e.channels,payload:e.payload});const r=e.payload,s=T.userId,n=T.currentMainId;if(console.log("[NotificationStore] ð Context check:",{payloadScope:r.scope,payloadId:r.$id,currentUserId:s,currentMainId:n}),r.scope==="event"&&!n){console.log("[NotificationStore] â ï¸ Ignored: event scope but no currentMainId");return}if(r.scope==="user"){if(r.$id!==s){console.log("[NotificationStore] â ï¸ Ignored: user ID mismatch");return}}else if(r.scope==="event"){if(r.$id!==n){console.log("[NotificationStore] â ï¸ Ignored: event ID mismatch");return}}else{console.log("[NotificationStore] â ï¸ Ignored: invalid scope");return}if(console.log("[NotificationStore] â Event passed filters, processing..."),e.events.some(a=>a.includes(".update"))){console.log("[NotificationStore] â Update event detected");const a=JSON.parse(r.notifications||"[]");console.log("[NotificationStore] ð Notifications to process:",a);for(const o of a)await b(this,Br,ad).call(this,o)}else console.log("[NotificationStore] â ï¸ Ignored: not an update event",e.events)},ad=async function(e){switch(console.log("[NotificationStore] ð Processing notification:",e),e.type){case"team_access_granted":await gt.reload(),Qe.success("Nouvelle Ã©quipe ajoutÃ©e");break;case"event_access_granted":console.log("[NotificationStore] ð event_access_granted received");const r=e.targetDocumentId;await Ye.fetchEvent(r)?(console.log(`[NotificationStore] â Event ${r} fetched successfully`),Qe.success("Nouvel Ã©vÃ©nement disponible")):(console.log(`[NotificationStore] â ï¸ Failed to fetch ${r}, falling back to reload()`),await Ye.reload(),Qe.success("Nouvel Ã©vÃ©nement disponible"));break;case"batch_products_update":console.log("[NotificationStore] ð batch_products_update received"),e.targetDocumentId===T.currentMainId?(console.log("[NotificationStore] â Calling productsStore.syncFromAppwrite()"),await qd.syncFromAppwrite(),e.from&&e.from!==T.userId&&(e.from==="system"?Qe.info("Produits mis Ã  jour",{source:"system"}):Qe.info("Produits modifiÃ©s par un autre utilisateur",{source:"realtime-other"}))):console.log("[NotificationStore] â ï¸ Ignored: mainId mismatch",{notificationTarget:e.targetDocumentId,currentMain:T.currentMainId});break;default:console.log("[NotificationStore] â Unknown notification type:",e.type)}},id=async function(e){const r=lt();await(await D()).tables.createRow({databaseId:r,tableId:"user_notifications",rowId:e,data:{scope:"user",notifications:JSON.stringify([])},permissions:[te.read(ie.user(e)),te.update(ie.user(e))]}),console.log(`[NotificationStore] User row created for ${e}`)};const Rm=new _m;function ii(t,e){if(e)for(const r in e)t=t.replace(`:${r}`,String(e[r]));return ue.name==="#"?t==="/"?"/#/":oi("#",t):ue.name?oi(ue.name,t):t}function Pm(t,e){let r=ii(t,e?.params);return e?.search&&(r+=Uo(e.search)),e?.hash&&!e.hash.startsWith("#")&&(r+="#"+e.hash),r}function od(t){return Promise.all(t.map(e=>Dm(e)))}function Dm(t){return new Promise(e=>{Mm(t)?Promise.resolve(t()).then(r=>{e(r.default)}):e(t)})}function Mm(t){return typeof t=="function"&&!!/\(\)\s?=>\s?(import|__vite_ssr_dynamic_import__)\(.*\)/.test(String(t))}function oi(...t){let e="";for(let r of t)r.startsWith("/")||(e+="/"),r.endsWith("/")&&(r=r.slice(0,-1)),e+=r;return e}function jo(t){return ue.name&&t.startsWith(ue.name)&&(t=t.slice(ue.name.length)||"/"),t}function qo(){const t=ue.name==="#"?globalThis.location.hash.slice(1):globalThis.location.pathname,e=ue.name==="#"?"":globalThis.location.hash;return{pathname:t,search:globalThis.location.search,state:history.state,hash:e}}function Uo(t){if(!t)return;if(typeof t=="string")return t.startsWith("?")||(t="?"+t),t;const e=Object.fromEntries(Object.entries(t).map(([s,n])=>[s,String(n)]));return Object.keys(e).length===0?void 0:"?"+new URLSearchParams(e).toString()}function Oo(t){if(!t)return{};if(typeof t=="string"){const e=new URLSearchParams(t);return Object.fromEntries([...e.entries()].map(([r,s])=>[r,gn(s)]))}return t}function gn(t){if(t==="")return"";if(t==="true")return!0;if(t==="false")return!1;const e=Number(t);return Number.isNaN(e)?t:e}function oo(t,e){return cd((r,s)=>r===s,t,e)}oo.startsWith=(t,e)=>cd((r,s)=>r.startsWith(s),t,e);function cd(t,e,r){if(!e.includes(":"))return t(Ie.pathname,e);if(r)return ue.name==="#"?t(Ie.pathname,ii(e,r).replace("/#","")):t(Ie.pathname,ii(e,r));const s=e.split("/").slice(1);let n=Ie.pathname.split("/").slice(1);if(s.length>n.length)return!1;for(const[a,o]of s.entries()){const c=n[a];if(!o.startsWith(":")&&o!==c)return!1}return!0}function Bo(t,e){t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1));const r=t.split("/").slice(1),s=$m(Object.keys(e));let n,a=[],o=[],c={},l={};const u=e["/"];u&&typeof u=="object"&&"meta"in u&&u.meta&&(l={...l,...u.meta});let d=!1;e:for(const h of s){const p=h.split("/");p[0]===""&&p.shift();for(let[g,w]of p.entries()){d=w.startsWith("(")&&w.endsWith(")"),d&&(w=w.slice(1,-1));const A=r[g];if(w.startsWith(":"))c[w.slice(1)]=decodeURIComponent(A);else if(w.startsWith("*")){const H=w.slice(1);H&&(c[H]=r.slice(g).map(decodeURIComponent).join("/")),d?(w=`(${w})`,a=[]):"layout"in e&&e.layout&&a.push(e.layout);const B=(g?"/":"")+p.join("/");n=e[B];break e}else if(w.toLowerCase()!==A?.toLowerCase())break;if(g!==p.length-1)continue;const E=e["/"+p.join("/")];if(typeof E=="function"&&p.length!==r.length)continue;if(!d&&"layout"in e&&e.layout&&a.push(e.layout),"hooks"in e&&e.hooks&&o.push(e.hooks),"meta"in e&&e.meta&&(l={...l,...e.meta}),typeof E=="function"){if(p.length===r.length){n=E;break e}continue}const I="/"+r.slice(g+1).join("/"),$=Bo(I,E);if($.match)n=$.match,c={...c,...$.params},o.push(...$.hooks),l={...l,...$.meta},$.breakFromLayouts?a=[]:a.push(...$.layouts);else continue;break e}}return{match:n,layouts:a,hooks:o,params:c,meta:l,breakFromLayouts:d}}function $m(t){return t.toSorted((e,r)=>sl(e)-sl(r))}function sl(t){return t===""||t==="/"?1:t.includes("*")?4:t.includes(":")?3:2}const km=200,Cm=Math.PI/6,Tm=50;async function ld(t,e,r){const{match:s,layouts:n,hooks:a,meta:o}=Bo(e,t);for(const{onPreload:c}of a)c?.({pathname:e,meta:o,...r,search:Oo(r?.search)});await od(s?[...n,s]:n)}const nl=new Set,vs=new Set;function Nm(t){function e(o){if(!o.getAttribute("href"))return;const l=new URL(o.href),u=jo(l.pathname),{replace:d,state:h}=o.dataset;ld(t,u,{replace:d===""||d==="true",search:l.search,state:h,hash:l.hash})}let r=null;function s(o){if(!o.getPredictedEvents||r)return;if(r=setTimeout(()=>{r=null},Tm),vs.size===0){document.removeEventListener("pointermove",s);return}const l=o.getPredictedEvents().at(-1);if(!l)return;const u=o.clientX,d=o.clientY,h=l.clientX-u,p=l.clientY-d,g=Math.hypot(h,p);if(g<2)return;const w=h/g,A=p/g;e:for(const E of vs){E.isConnected||vs.delete(E);const I=E.getBoundingClientRect(),$=[{x:I.left,y:I.top},{x:I.right,y:I.top},{x:I.left,y:I.bottom},{x:I.right,y:I.bottom},{x:I.left+I.width/2,y:I.top+I.height/2}];for(const H of $){const B=H.x-u,G=H.y-d,N=Math.hypot(B,G);if(N>km||N<.001)continue;const U=B/N,F=G/N,se=w*U+A*F;if(Math.acos(Math.max(-1,Math.min(1,se)))<=Cm){e(E),vs.delete(E);continue e}}}}const n=new IntersectionObserver(o=>{for(const c of o)c.isIntersecting&&(n.unobserve(c.target),e(c.target))});new MutationObserver(()=>{const o=document.querySelectorAll("a[data-preload]");for(const c of o)if(!nl.has(c)){switch(nl.add(c),c.dataset.preload){case"":case"hover":{c.addEventListener("mouseenter",function l(){c.removeEventListener("mouseenter",l),e(c)});break}case"predict":{vs.size===0&&document.addEventListener("pointermove",s),vs.add(c);break}case"viewport":{n.observe(c);break}default:{console.warn(`Unknown preload strategy \`${c.dataset.preload}\` on`,c,`
Available strategies are: hover, viewport, predict`);break}}c.addEventListener("focus",function l(){c.removeEventListener("focus",l),e(c)})}}).observe(document.body,{subtree:!0,childList:!0})}class al extends Error{constructor(e){super(`Navigating to: ${e}`),this.name="Redirect"}}let Se=new Wh(globalThis.location.search);const Lm={append(t,e,r){Se.append(t,String(e)),ja(r)},delete(t,e,r){Se.delete(t,e===void 0?void 0:String(e)),ja(r)},entries(){return[...Se.entries()].map(([t,e])=>[t,gn(e)])},forEach(...t){return Se.forEach(...t)},get(...t){const e=Se.get(...t);return e===null?null:gn(e)},getAll(...t){return Se.getAll(...t).map(gn)},has(...t){return Se.has(...t)},keys(){return Se.keys()},set(t,e,r){Se.set(t,String(e)),ja(r)},sort(t){Se.sort(),ja(t)},toString(){return Se.toString()},values(){return[...Se.values()].map(gn)},get size(){return Se.size},[Symbol.iterator](){return Se[Symbol.iterator]()}};function il(t){if(Se.toString()===t)return;const e=new URLSearchParams(t);for(const[r,s]of e)Se.set(r,s);for(const r of Se.keys())e.has(r)||Se.delete(r)}function ja(t){const e=new URL(globalThis.location.toString());e.search=Se.toString(),globalThis.history[t?.replace?"replaceState":"pushState"]({},"",e)}let bn;const ue={name:void 0};let co=ge({value:[]}),Ie=ge({pathname:"/",search:"",state:null,hash:""});queueMicrotask(()=>{const t=qo();Ie.pathname=t.pathname,Ie.search=t.search,Ie.state=t.state,Ie.hash=t.hash});let lo=ge({value:{}}),ud=ge({value:{}}),Ga=null,Gi=0,ol=0;function jm(t){if(t){const e=new URL(globalThis.location.toString());t==="#"?(ue.name="#",globalThis.location.href.includes("#")||(e.hash="/",history.replaceState(history.state||{},"",e.toString()))):(ue.name=(t.startsWith("/")?"":"/")+t,e.pathname.startsWith(ue.name)||(e.pathname=oi(ue.name,e.pathname),history.replaceState(history.state||{},"",e.toString())))}Object.assign(Ie,qo())}function qm(t){return bn=t,Nm(bn),{p:Pm,navigate:Um,isActive:oo,async preload(e){await ld(bn,e)},route:{get params(){return lo.value},getParams(e){if(!oo(e))throw new Error(`\`${e}\` does not match the current route`);return lo.value},get pathname(){return jo(Ie.pathname)},get search(){return Oo(Ie.search)},get state(){return Ie.state},get hash(){return Ie.hash},get meta(){return ud.value}}}}function Um(t,e={}){return typeof t=="number"?(globalThis.history.go(t),new al(`History entry: ${t}`)):(t=ii(t,e.params),ue.name==="#"?t=t.replace("/#",""):e.hash&&!e.hash.startsWith("#")&&(e.hash="#"+e.hash),ci(t,e),new al(`${t}${Uo(e?.search??"")}${e?.hash??""}`))}async function ci(t,e={}){if(!bn)throw new Error("Router not initialized: `createRouter` was not called.");if(Ga){if(!Ga()){const w=new URL(globalThis.location.toString());w.search=Ie.search,w.hash=Ie.hash,ue.name==="#"?w.hash=Ie.pathname:w.pathname=Ie.pathname,globalThis.history.replaceState(Ss(Ie.state)||{},"",w.toString());return}Ga=null}Gi++;const r=Gi,s=Om(t),{match:n,layouts:a,hooks:o,meta:c,params:l}=Bo(s,bn),u=Oo(e.search),d={pathname:s,meta:c,...e,search:u};let h=[];for(const w of o)try{const{beforeLoad:A}=w;h.push(w),ol=r,await A?.(d)}catch(A){for(const{onError:E}of h)E?.(A,d);return}const p=new Error().stack?.includes("beforeLoad");let g;try{g=await od(n?[...a,n]:a)}catch(w){for(const{onError:A}of o)A?.(w,d);throw w}if(!(Gi!==r||p&&ol+1!==r)){if(t){const w=Uo(e.search),A=new URL(globalThis.location.toString());A.search=w||"",A.hash=e.hash||"",ue.name==="#"?A.hash=t:ue.name&&!t.startsWith(ue.name)?A.pathname=oi(ue.name,t):A.pathname=t;const E=e.replace?"replaceState":"pushState";globalThis.history[E](e.state||{},"",A.toString()),il(w)}else il(globalThis.location.search);e.viewTransition&&document.startViewTransition!==void 0?document.startViewTransition(()=>{co.value=g}):co.value=g,lo.value=l,ud.value=c,Object.assign(Ie,qo()),e.scrollToTop!==!1&&window.scrollTo({top:0,left:0,behavior:e.scrollToTop});for(const{afterLoad:w}of o)w?.(d)}}function Om(t){let e;return t?e=t:ue.name==="#"?e=globalThis.location.hash.slice(1):e=globalThis.location.pathname,ue.name&&e.startsWith(ue.name)&&(e=e.slice(ue.name.length)||"/"),jo(e)}function Bm(t){const e=t.target.closest("a");if(!e||e.hasAttribute("target")||e.hasAttribute("download")||!e.hasAttribute("href")||e.getAttribute("href")?.startsWith("#"))return;const r=new URL(e.href),s=globalThis.location.origin;if(r.origin!==s)return;const n=ue.name==="#"?r.hash:r.pathname,a=ue.name==="#"?void 0:r.hash;t.preventDefault();const{replace:o,state:c,scrollToTop:l,viewTransition:u}=e.dataset;let d;if(c)try{d=JSON.parse(c)}catch{d=c}ci(n,{replace:o===""||o==="true",search:r.search,state:d,hash:a,scrollToTop:l==="false"?!1:l,viewTransition:u===""||u==="true"})}function xm(t){Ga=t}function dd(t,e){bo(e,!0);const r=z(()=>e.tree[0]),s=z(()=>e.tree.slice(1));var n=fc(),a=oc(n);yh(a,()=>f(r),(o,c)=>{c(o,{children:(l,u)=>{var d=fc(),h=oc(d);{var p=g=>{dd(g,{get tree(){return f(s)}})};hh(h,g=>{f(s).length>0&&g(p)})}hc(l,d)},$$slots:{default:!0}})}),hc(t,n),Eo()}function Hm(t,e){bo(e,!0),jm(e.base),ci(),qr(()=>{const r=zs(globalThis,"popstate",()=>ci()),s=zs(globalThis,"click",Bm);return()=>{r(),s()}}),dd(t,{get tree(){return co.value}}),Eo()}const Jt={async beforeLoad({pathname:t}){if(!T.isAuthenticated){console.log(`[AuthGuard] AccÃ¨s refusÃ© Ã  ${t} > Redirection /`);const{navigate:e}=await J(async()=>{const{navigate:r}=await Promise.resolve().then(()=>Ym);return{navigate:r}},void 0);throw e("/",{replace:!0})}}},Vm={async beforeLoad(){Ye.isInitialized||(T.isAuthenticated?(console.log("[EventGuard] Mode normal > initialize"),await Ye.initialize()):(console.log("[EventGuard] Mode public > initializeForPublic"),await Ye.initializeForPublic())),console.log("[EventGuard] â Store initialisÃ©")}},Wm={"/":()=>J(()=>import("./HomePage.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),"/verify-email":()=>J(()=>import("./VerifyEmailPage.js"),__vite__mapDeps([8,1,2,3])),"/recipe":()=>J(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3])),"/recipe/:uuid":()=>J(()=>import("./RecipeDetailPage.js"),__vite__mapDeps([18,15,19,20,2,10,21,5,22,23,1,3])),"/accept-invite":()=>J(()=>import("./AcceptInvite.js"),__vite__mapDeps([24,1,2,3])),"/reset-password":()=>J(()=>import("./ResetPassword.js"),__vite__mapDeps([25,2,26])),"/dashboard":{hooks:Jt,"/":()=>J(()=>import("./DashboardPage.js"),__vite__mapDeps([27,1,2,3,28,29,30,31,32,20,33,34,6])),"/teams":()=>J(()=>import("./TeamsManagement.js"),__vite__mapDeps([35,2,29,30,1,3,31])),"/eventCreate":()=>J(()=>import("./EventCreatePage.js"),__vite__mapDeps([36,37,12,2,30,1,3,20,28,4,10])),"/materiel":()=>J(()=>import("./MaterielPage.js"),__vite__mapDeps([38,1,2,3,28,14,13,10,16])),"/materiel/:teamId":()=>J(()=>import("./MaterielPage.js"),__vite__mapDeps([38,1,2,3,28,14,13,10,16])),"/loans":()=>J(()=>import("./LoansPage.js"),__vite__mapDeps([39,1,2,3,11,12,40,14,28])),"/loans/:teamId":()=>J(()=>import("./LoansPage.js"),__vite__mapDeps([39,1,2,3,11,12,40,14,28])),"/loans/return/:loanId":()=>J(()=>import("./LoanReturnPage.js"),__vite__mapDeps([41,1,2,3,28]))},"/recipe/my":{hooks:Jt,"/":()=>J(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3])),"/draft":()=>J(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3]))},"/recipe/new":{hooks:Jt,"/":()=>J(()=>import("./RecipeCreatePage.js"),__vite__mapDeps([42,17,1,2,3,43,20,44,10,40,14,45,46]))},"/recipe/:uuid/edit":(()=>{const t=()=>J(()=>import("./RecipeEditPage.js"),__vite__mapDeps([47,17,1,2,3,43,20,44,10,40,14,45,11,12,30,46,23]));return t.hooks=Jt,t})(),"/recipe/:uuid/duplicate":(()=>{const t=()=>J(()=>import("./RecipeCreatePage.js"),__vite__mapDeps([42,17,1,2,3,43,20,44,10,40,14,45,46]));return t.hooks=Jt,t})(),"/eventList":{hooks:Jt,"/":()=>J(()=>import("./EventListPage.js"),__vite__mapDeps([48,1,2,3,32,20,33]))},"/createdocument/:teamId/new":(()=>{const t=()=>J(()=>import("./CreateDocumentPage.js"),__vite__mapDeps([49,1,2,3,50,44,51,40,14,52]));return t.hooks=Jt,t})(),"/editdocument/:teamId/:docId":(()=>{const t=()=>J(()=>import("./EditDocumentPage.js"),__vite__mapDeps([53,1,2,3,50,44,51,40,14,46,21,5,22,54]));return t.hooks=Jt,t})(),"/documents/:teamId":(()=>{const t=()=>J(()=>import("./DocumentListPage.js"),__vite__mapDeps([55,1,2,3,34,28]));return t.hooks=Jt,t})(),"/event/:id":{hooks:Vm,"/":()=>J(()=>import("./EventEditPage.js"),__vite__mapDeps([56,37,12,2,30,1,3,20,28,4,10,57,33,58,14,40,46])),"/recipes":()=>J(()=>import("./EventRecipesPage.js"),__vite__mapDeps([59,33,58,2,28,19,20,10,21,5,22,15,16,11,12,1,3,60])),"/products":()=>J(()=>import("./EventProductsPage.js"),__vite__mapDeps([61,28,40,14,2,31,1,3,20,10,58,33,57,16,62])),"/posters":()=>J(()=>import("./EventPosterPage.js"),__vite__mapDeps([63,1,2,3]))},"(*)":()=>J(()=>import("./NotFoundPage.js"),__vite__mapDeps([64,5,1,2,3]))},{p:Gm,navigate:Qm,preload:Jm,route:uo}=qm(Wm),Km=Hm,Ym=Object.freeze(Object.defineProperty({__proto__:null,Router:Km,blockNavigation:xm,navigate:Qm,p:Gm,preload:Jm,route:uo,searchParams:Lm},Symbol.toStringTag,{value:"Module"}));var ce,et,_r,Rr,as,Si,nr,is,Gs,Un,On,Bn,xn;class Xm{constructor(){C(this,"isMobileQuery",new Rc("max-width: 768px"));C(this,"isDesktopQuery",new Rc("min-width: 1024px"));y(this,ce,P(null));y(this,et,P(ge([])));y(this,_r,P(!1));y(this,Rr,P(null));y(this,as,P(!1));y(this,Si,z(()=>{const e=uo.pathname,r=uo.params.id;return e.includes("/event/")&&r?(console.log(`[GlobalState] â currentMainId dÃ©rivÃ©: ${r}`),r):(console.log(`[GlobalState] â ï¸ Pas de mainId: path=${e}, params.id=${r}`),null)}));y(this,nr,P(0));y(this,is,P(!0));y(this,Gs,P("down"));y(this,Un,P(ge({isOpen:!1,conflicts:[]})));y(this,On,P(ge({isOpen:!1})));y(this,Bn,P(ge({isRunning:!1,name:"",progress:0})));y(this,xn,P(ge({isOpen:!1,showLogin:!0})))}get user(){return f(i(this,ce))}get userId(){return f(i(this,ce))?.$id??null}get userEmail(){return f(i(this,ce))?.email??null}get userTeams(){return f(i(this,et))}get isAuthenticated(){return f(i(this,ce))!==null}get authLoading(){return f(i(this,_r))}get authError(){return f(i(this,Rr))}get authInitialized(){return f(i(this,as))}async initializeAuth(){if(f(i(this,as))){console.log("[GlobalState] Authentification dÃ©jÃ  initialisÃ©e");return}console.log("[GlobalState] Initialisation de l'authentification..."),m(i(this,_r),!0),m(i(this,Rr),null);try{const{account:e}=await D();m(i(this,ce),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,ce)).name),localStorage.setItem("appwrite-user-email",f(i(this,ce)).email),localStorage.setItem("appwrite-user-id",f(i(this,ce)).$id),await gt.initialize(),m(i(this,et),gt.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] AuthentifiÃ©: ${f(i(this,ce)).name} (${f(i(this,et)).length} Ã©quipes)`)}catch(e){m(i(this,ce),null),m(i(this,et),[],!0),m(i(this,Rr),e instanceof Error?e.message:"Erreur d'authentification",!0),console.log("[GlobalState] Utilisateur non connectÃ©")}finally{m(i(this,_r),!1),m(i(this,as),!0)}}async refreshAuthAfterLogin(){console.log("[GlobalState] RÃ©initialisation aprÃ¨s login..."),m(i(this,_r),!0),m(i(this,Rr),null);try{const{account:e}=await D();m(i(this,ce),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,ce)).name),localStorage.setItem("appwrite-user-email",f(i(this,ce)).email),localStorage.setItem("appwrite-user-id",f(i(this,ce)).$id),await gt.initialize(),await Ye.syncFromRemote(),await Ye.setupRealtime(),await tl.syncFromRemote(),await tl.setupRealtime(),await rl.syncFromRemote(),await rl.setupRealtime(),await Rm.initialize(),await Ht.initialize(),m(i(this,et),gt.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] RÃ©initialisÃ© aprÃ¨s login: ${f(i(this,ce)).name} (${f(i(this,et)).length} Ã©quipes)`)}catch(e){console.error("[GlobalState] Erreur lors de la rÃ©initialisation:",e),m(i(this,Rr),e instanceof Error?e.message:"Erreur de rÃ©initialisation",!0)}finally{m(i(this,_r),!1)}}async logout(){try{const{account:e}=await D();await e.deleteSession({sessionId:"current"}),Mu(),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-id"),m(i(this,ce),null),m(i(this,et),[],!0),m(i(this,as),!1),console.log("[GlobalState] DÃ©connexion rÃ©ussie")}catch(e){throw console.error("[GlobalState] Erreur lors de la dÃ©connexion:",e),e}}async refreshTeams(){if(!f(i(this,ce))){console.warn("[GlobalState] Impossible de rafraÃ®chir les Ã©quipes: utilisateur non connectÃ©");return}try{await gt.syncFromRemote();const e=gt.myTeams.map(r=>r.$id);(e.length>0||f(i(this,et)).length===0)&&(m(i(this,et),e,!0),console.log(`[GlobalState] Ãquipes rafraÃ®chies: ${f(i(this,et)).length}`))}catch(e){console.error("[GlobalState] Erreur lors du rafraÃ®chissement des Ã©quipes:",e)}}isTeamOwner(e){if(!f(i(this,ce)))return!1;const r=gt.myTeams.find(n=>n.$id===e);return r?r.members.find(n=>n.id===f(i(this,ce)).$id)?.roles?.includes("owner")??!1:!1}hasTeamRole(e,r){if(!f(i(this,ce)))return!1;const s=gt.myTeams.find(a=>a.$id===e);return s?s.members.find(a=>a.id===f(i(this,ce)).$id)?.roles?.includes(r)??!1:!1}get currentMainId(){return f(i(this,Si))}get isMobile(){return this.isMobileQuery.current}get isDesktop(){return this.isDesktopQuery.current}get headerVisible(){return f(i(this,is))}get scrollDirection(){return f(i(this,Gs))}initializeScrollDirection(){qr(()=>{const e=Rp.current??0;if(e>f(i(this,nr))?m(i(this,Gs),"down"):e<f(i(this,nr))&&m(i(this,Gs),"up"),this.isDesktop){m(i(this,is),!0),m(i(this,nr),e,!0);return}e>f(i(this,nr))&&e>100?m(i(this,is),!1):e<f(i(this,nr))&&m(i(this,is),!0),m(i(this,nr),e,!0)})}get userName(){return f(i(this,ce))?.name||localStorage.getItem("appwrite-user-name")||""}get toasts(){return Qe.toasts}get toast(){return Qe}get modalOverride(){return f(i(this,Un))}set modalOverride(e){m(i(this,Un),e,!0)}get modal(){return f(i(this,On))}set modal(e){m(i(this,On),e,!0)}get backgroundOperation(){return f(i(this,Bn))}set backgroundOperation(e){m(i(this,Bn),e,!0)}get authModal(){return f(i(this,xn))}set authModal(e){m(i(this,xn),e,!0)}}ce=new WeakMap,et=new WeakMap,_r=new WeakMap,Rr=new WeakMap,as=new WeakMap,Si=new WeakMap,nr=new WeakMap,is=new WeakMap,Gs=new WeakMap,Un=new WeakMap,On=new WeakMap,Bn=new WeakMap,xn=new WeakMap;const T=new Xm;var Hn,Vn;class Zm{constructor(){y(this,Hn,P("survolez des Ã©lÃ©ment pour obtenir de l'aide"));y(this,Vn,P(!0));C(this,"reset",()=>{this.msg="survolez des Ã©lÃ©ment pour obtenir de l'aide"});C(this,"toggle",()=>{this.isExpanded=!this.isExpanded});C(this,"expand",()=>{this.isExpanded=!0});C(this,"collapse",()=>{this.isExpanded=!1})}get msg(){return f(i(this,Hn))}set msg(e){m(i(this,Hn),e,!0)}get isExpanded(){return f(i(this,Vn))}set isExpanded(e){m(i(this,Vn),e,!0)}get help(){return this.msg}set help(e){this.msg=e}}Hn=new WeakMap,Vn=new WeakMap;const Ny=new Zm;async function Ly(t,e,r,s,n=!1){try{const{functions:a,config:o}=await D(),c=o.functions.enkaData,l=JSON.stringify({action:t,recipeId:e,userId:r,data:s}),u=await a.createExecution({functionId:c,body:l,async:n});if(n){if(u.status==="failed")throw new Error(`Function execution failed to start: ${u.status}`);return{success:!0,executionId:u.$id}}if(u.status!=="completed")throw new Error(`Function execution failed: ${u.status} - ${u.responseBody}`);const d=JSON.parse(u.responseBody);if(!d.success)throw new Error(d.error||"Unknown error in manage_recipe");return d.data}catch(a){throw console.error(`[appwrite-recipes] Error executing manage_recipe (${t}):`,a),a}}const gs="recettes";async function cl(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:gs})).rows}catch(t){throw console.error("[appwrite-recipes] Error listing all recipes:",t),t}}async function zm(t){try{const{tables:e,config:r}=await D(),s=[S.greaterThan("$updatedAt",t)];return(await e.listRows({databaseId:r.databaseId,tableId:gs,queries:s})).rows}catch(e){throw console.error(`[appwrite-recipes] Error listing updated recipes since ${t}:`,e),e}}async function Qi(t){try{const{tables:e,config:r}=await D();return await e.getRow({databaseId:r.databaseId,tableId:gs,rowId:t})}catch(e){if(e.code===404)return null;throw console.error(`[appwrite-recipes] Error getting recipe ${t}:`,e),e}}async function jy(t,e){try{const{tables:r,config:s,account:n}=await D(),a=_p(t.title,t.versionLabel||void 0),o=[te.read(ie.users()),te.update(ie.user(e)),te.delete(ie.user(e))],l=(await n.get()).name,u={title:t.title,plate:t.plate,ingredients:t.ingredients,preparation:t.preparation,draft:t.draft??!0,typeR:t.typeR,categories:t.categories??[],regime:t.regime??[],check:t.check??!1,description:t.description??null,quantite_desc:t.quantite_desc??null,region:t.region??null,saison:t.saison??[],cuisson:t.cuisson??[],serveHot:t.serveHot??!0,auteur:l,preparation24h:t.preparation24h??null,astuces:t.astuces??null,publishedAt:t.publishedAt||new Date().toISOString().split("T")[0]+"T00:00:00Z",$id:a,createdBy:e,permissionWrite:t.permissionWrite||[e],rootRecipeId:t.rootRecipeId??null,versionLabel:t.versionLabel??null},d=await r.createRow({databaseId:s.databaseId,tableId:gs,rowId:a,data:u,permissions:o});return console.log(`[appwrite-recipes] Recipe created: ${a}`),d}catch(r){throw console.error("[appwrite-recipes] Error creating recipe:",r),r}}async function Fm(t,e,r){try{const{tables:s,config:n}=await D(),a={...e,check:e.check??!1,...e.publishedAt&&{publishedAt:e.publishedAt}},o=await s.updateRow({databaseId:n.databaseId,tableId:gs,rowId:t,data:a});return console.log(`[appwrite-recipes] Recipe updated: ${t}`),o}catch(s){throw console.error(`[appwrite-recipes] Error updating recipe ${t}:`,s),s}}async function qy(t){try{const{tables:e,config:r}=await D();await e.updateRow({databaseId:r.databaseId,tableId:gs,rowId:t,data:{status:"deleted"}}),console.log(`[appwrite-recipes] Recipe soft deleted: ${t}`)}catch(e){throw console.error(`[appwrite-recipes] Error deleting recipe ${t}:`,e),e}}const eg="/api/data.json";var Q,Te,qe,Pr,Wn,x,jt,Dr,Qs,je,Qa,fd,hd,fo,ho;class tg{constructor(){y(this,je);y(this,Q,P(ge(new ft)));y(this,Te,P(!1));y(this,qe,P(null));y(this,Pr,P(!1));y(this,Wn,P(null));y(this,x,null);y(this,jt,new Set);y(this,Dr,null);y(this,Qs,!1)}get loading(){return f(i(this,Te))}get error(){return f(i(this,qe))}get isInitialized(){return f(i(this,Pr))}get recipesIndex(){return Array.from(f(i(this,Q)).values())}get count(){return f(i(this,Q)).size}getAllRecipes(){return Array.from(f(i(this,Q)).values())}async loadCache(){if(f(i(this,Pr))){console.log("[RecipesStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[RecipesStore] Chargement du cache..."),m(i(this,Te),!0),m(i(this,qe),null);try{_(this,x,await dp());const e=await i(this,x).loadRecipesIndex(),r=await i(this,x).loadMetadata();e.size>0&&(console.log(`[RecipesStore] ${e.size} recettes (index) chargÃ©es depuis le cache`),m(i(this,Q),new ft(e),!0)),m(i(this,Pr),!0),console.log(`[RecipesStore] Cache chargÃ©: ${f(i(this,Q)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Te),!1)}}async syncFromRemote(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation depuis sources distantes..."),m(i(this,Te),!0);try{const e=await i(this,x).loadMetadata();try{await b(this,je,Qa).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,Q)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}if(T.userId)try{await b(this,je,fd).call(this,e)}catch(r){console.warn("[RecipesStore] Erreur sync Appwrite:",r)}console.log(`[RecipesStore] Synchronisation terminÃ©e: ${f(i(this,Q)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Te),!1)}}async syncFromRemotePublicOnly(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation publique (Hugo uniquement)..."),m(i(this,Te),!0);try{const e=await i(this,x).loadMetadata();try{await b(this,je,Qa).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,Q)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}console.log(`[RecipesStore] Synchronisation publique terminÃ©e: ${f(i(this,Q)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation publique";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Te),!1)}}async setupRealtime(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,Qs)){console.log("[RecipesStore] Realtime dÃ©jÃ  configurÃ©");return}if(console.log("[RecipesStore] Configuration du realtime..."),T.userId)try{b(this,je,hd).call(this),_(this,Qs,!0)}catch(e){console.warn("[RecipesStore] Erreur activation realtime:",e)}}async initialize(){if(f(i(this,Pr))){console.log("[RecipesStore] DÃ©jÃ  initialisÃ©");return}return i(this,Dr)?(console.log("[RecipesStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,Dr)):(console.log("[RecipesStore] Initialisation..."),m(i(this,Te),!0),m(i(this,qe),null),_(this,Dr,(async()=>{try{if(await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),f(i(this,Q)).size===0){const e="Aucune recette disponible aprÃ¨s initialisation";m(i(this,qe),e),console.warn("[RecipesStore]",e)}console.log(`[RecipesStore] Initialisation complÃ©tÃ©e: ${f(i(this,Q)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw m(i(this,qe),r,!0),console.error("[RecipesStore] ECHEC Initialisation:",r,e),e}finally{m(i(this,Te),!1),_(this,Dr,null)}})()),i(this,Dr))}async forceReloadAllRecipes(){if(!T.userId)throw new Error("Utilisateur non connectÃ©");m(i(this,Te),!0),m(i(this,qe),null);try{console.log("[RecipesStore] Rechargement forcÃ© des recettes Appwrite...");const e=await cl();let r=0,s=0;if(e.forEach(n=>{n.status==="deleted"?f(i(this,Q)).has(n.$id)&&(f(i(this,Q)).delete(n.$id),s++,console.log(`[RecipesStore] Recette ${n.$id} supprimÃ©e (status=deleted)`)):(f(i(this,Q)).set(n.$id,Ta(n)),r++)}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es`),i(this,x)){const n=await i(this,x).loadMetadata(),a=new Date().toISOString();await i(this,x).saveRecipesIndex(f(i(this,Q))),await i(this,x).saveMetadata({...n,lastAppwriteSync:a,recipesCount:f(i(this,Q)).size,cacheVersion:1})}console.log("[RecipesStore] Rechargement forcÃ© terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw m(i(this,qe),r,!0),console.error("[RecipesStore] Erreur rechargement forcÃ©:",e),e}finally{m(i(this,Te),!1)}}async hardReset(){if(!T.userId)throw new Error("Utilisateur non connectÃ©");console.log("[RecipesStore] ð HARD RESET - Vidage complet..."),m(i(this,Te),!0),m(i(this,qe),null);try{f(i(this,Q)).clear(),i(this,x)&&(await i(this,x).clear(),console.log("[RecipesStore] Cache IDB vidÃ©")),await b(this,je,Qa).call(this,null);const e=await cl();let r=0,s=0;if(e.forEach(n=>{n.status!=="deleted"?(f(i(this,Q)).set(n.$id,Ta(n)),r++):s++}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es ignorÃ©es`),i(this,x)){const n=new Date().toISOString();await i(this,x).saveRecipesIndex(f(i(this,Q))),await i(this,x).saveMetadata({buildTimestamp:f(i(this,Wn)),lastAppwriteSync:n,recipesCount:f(i(this,Q)).size,cacheVersion:1}),console.log("[RecipesStore] Cache IDB recrÃ©Ã©")}console.log("[RecipesStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,qe),r,!0),console.error("[RecipesStore] Erreur hard reset:",e),e}finally{m(i(this,Te),!1)}}getRecipeIndexByUuid(e){return f(i(this,Q)).get(e)||null}searchRecipes(e){if(!e.trim())return this.recipesIndex;const r=b(this,je,fo).call(this,e.trim()).split(/\s+/);return this.recipesIndex.filter(s=>{const a=b(this,je,fo).call(this,s.title).split(/[\s\-_]+/);return r.every(o=>a.some(c=>c.startsWith(o)))})}get availableTypes(){const e=new Set;return this.recipesIndex.forEach(r=>e.add(r.typeR)),Array.from(e).sort()}async canEditRecipe(e){if(!T.userId)return!1;try{const r=await Qi(e);return r?r.createdBy===T.userId||!!r.permissionWrite?.includes(T.userId)||!!r.teams?.some(s=>T.userTeams.includes(s)):!1}catch(r){return console.error(`[RecipesStore] Erreur lors de la vÃ©rification des permissions pour ${e}:`,r),!1}}getRecipeLockStatus(e){return f(i(this,Q)).get(e)?.lockedBy||null}async updateRecipeLock(e,r){if(T.userId)try{await Fm(e,{lockedBy:r},T.userId),console.log(`[RecipesStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`);const s=f(i(this,Q)).get(e);s&&f(i(this,Q)).set(e,{...s,lockedBy:r})}catch(s){throw console.error(`[RecipesStore] Erreur verrouillage ${e}:`,s),s}}async getRecipeByUuid(e){if(i(this,jt).has(e)){for(console.log(`[RecipesStore] Chargement de ${e} dÃ©jÃ  en cours, attente...`);i(this,jt).has(e);)await new Promise(r=>setTimeout(r,50));return i(this,x)&&await i(this,x).loadRecipeDetail(e)||null}i(this,jt).add(e);try{if(i(this,x)){const s=await i(this,x).loadRecipeDetail(e);if(s)return s}let r=null;try{const s=`/recettes/${e}/recipe.json`,n=await fetch(s);if(n.ok){const a=await n.json();r=kc(a),console.log(`[RecipesStore] ${e} chargÃ©e depuis Hugo`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Hugo`)}if(!r&&T.userId)try{const s=await Qi(e);if(s){const n=Ha(s.ingredients||[]);r={...s,ingredients:n,astuces:Vi(s.astuces),prepAlt:s.prepAlt||null,categories:s.categories,regime:s.regime,saison:s.saison,teams:s.teams,permissionWrite:s.permissionWrite},console.log(`[RecipesStore] ${e} chargÃ©e depuis Appwrite (fallback)`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Appwrite`)}return r&&i(this,x)&&await i(this,x).saveRecipeDetail(r),r||console.warn(`[RecipesStore] ${e} non trouvÃ©e (Hugo ni Appwrite)`),r}catch(r){return console.error(`[RecipesStore] Erreur lors du chargement de ${e}:`,r),null}finally{i(this,jt).delete(e)}}async getRecipesByUuidsBulk(e){const r=performance.now(),s=[...new Set(e.filter(Boolean))];if(s.length===0)return new Map;console.log(`[RecipesStore] Chargement bulk de ${s.length} recettes...`);const n=new Map;i(this,x)&&(await i(this,x).loadRecipeDetailsBulk(s)).forEach((d,h)=>n.set(h,d));const a=s.filter(u=>!n.has(u));console.log(`[RecipesStore] Bulk: ${n.size} dans le cache, ${a.length} Ã  fetch`);const o=new Map;if(a.length>0){a.forEach(u=>i(this,jt).add(u));try{const u=a.map(async h=>{let p=null;try{const g=`/recettes/${h}/recipe.json`,w=await fetch(g);if(w.ok){const A=await w.json();p=kc(A)}}catch{}if(!p&&T.userId)try{const g=await Qi(h);if(g){const w=Ha(g.ingredients||[]);p={...g,ingredients:w,astuces:Vi(g.astuces),prepAlt:g.prepAlt||null,categories:g.categories,regime:g.regime,saison:g.saison,teams:g.teams,permissionWrite:g.permissionWrite}}}catch{}return p?{uuid:h,recipe:p}:null});(await Promise.all(u)).forEach(h=>{h&&o.set(h.uuid,h.recipe)}),o.size>0&&i(this,x)&&await i(this,x).saveRecipeDetailsBulk(o),a.forEach(h=>i(this,jt).delete(h))}catch(u){console.error("[RecipesStore] Erreur lors du fetch bulk:",u),a.forEach(d=>i(this,jt).delete(d))}}const c=new Map([...n,...o]),l=performance.now()-r;return console.log(`[RecipesStore] Bulk terminÃ©: ${c.size}/${s.length} recettes en ${l.toFixed(0)}ms`),c}async preloadRecipes(e){console.log(`[RecipesStore] PrÃ©chargement de ${e.length} recettes...`);const r=e.map(s=>this.getRecipeByUuid(s));await Promise.all(r),console.log("[RecipesStore] PrÃ©chargement terminÃ©")}async getVariantGroup(e,r=2){const s=this.getRecipeIndexByUuid(e);if(!s)return{root:null,variants:[],isRoot:!1};const n=new Map,a=new Set;let o=s;for(;o.rootRecipeId&&!a.has(o.rootRecipeId);){a.add(o.$id);const l=this.getRecipeIndexByUuid(o.rootRecipeId);if(!l)break;o=l}const c=o;return n.set(c.$id,c),await b(this,je,ho).call(this,c.$id,n,new Set([c.$id]),0,r),{root:c,variants:Array.from(n.values()),isRoot:!s.rootRecipeId||s.rootRecipeId===s.$id}}findRootRecipe(e){const r=new Set;let s=e,n=10;for(let a=0;a<n;a++){const o=this.getRecipeIndexByUuid(s);if(!o||!o.rootRecipeId)return s;if(r.has(s))return console.error("[RecipesStore] Cycle dÃ©tectÃ© dans rootRecipeId, retour Ã ",e),e;r.add(s),s=o.rootRecipeId}return e}destroy(){i(this,x)&&(i(this,x).close(),_(this,x,null)),f(i(this,Q)).clear(),m(i(this,Pr),!1),_(this,Qs,!1),console.log("[RecipesStore] Ressources nettoyÃ©es")}}Q=new WeakMap,Te=new WeakMap,qe=new WeakMap,Pr=new WeakMap,Wn=new WeakMap,x=new WeakMap,jt=new WeakMap,Dr=new WeakMap,Qs=new WeakMap,je=new WeakSet,Qa=async function(e){try{console.log("[RecipesStore] Chargement data.json...");const r=await fetch(eg);if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);const s=await r.json();if(!Array.isArray(s.recipes))throw new Error("Format invalide: recipes n'est pas un tableau");const n=s.meta?.timestamp;if(m(i(this,Wn),n,!0),n&&e&&e.buildTimestamp&&e.buildTimestamp>=n){console.log(`[RecipesStore] Cache Ã  jour (Ts: ${e.buildTimestamp} >= ${n})`);return}console.log(`[RecipesStore] Nouvelle version dÃ©tectÃ©e ou cache manquant (Ts: ${n}), Traitement...`);const a=s.recipes.map(c=>mp(c));let o=0;a.forEach(c=>{const l=f(i(this,Q)).get(c.$id);let u=!1;if(!l)u=!0;else{const d=new Date(c.$updatedAt).getTime(),h=new Date(l.$updatedAt).getTime();d>h&&(u=!0)}u&&(f(i(this,Q)).set(c.$id,c),o++)}),console.log(`[RecipesStore] Smart Merge: ${o} recettes mises Ã  jour/ajoutÃ©es.`),i(this,x)&&(await i(this,x).saveRecipesIndex(f(i(this,Q))),await i(this,x).saveMetadata({...e,buildTimestamp:n||Date.now()/1e3,recipesCount:f(i(this,Q)).size,cacheVersion:1}))}catch(r){throw console.error("[RecipesStore] Erreur loadIndexFromDataJson:",r),r}},fd=async function(e){console.log("[RecipesStore] Sync incrÃ©mentiel Appwrite...");const r=e?.lastAppwriteSync||"1970-01-01T00:00:00.000Z";e?.buildTimestamp&&new Date(e.buildTimestamp*1e3).toISOString(),console.log(`[RecipesStore] Sync Appwrite: depuis ${r}`);const s=await zm(r);if(s.length===0){console.log("[RecipesStore] Aucune mise Ã  jour Appwrite dÃ©tectÃ©e.");return}console.log(`[RecipesStore] ${s.length} recettes mises Ã  jour depuis Appwrite.`);let n=0,a=0;s.forEach(c=>{if(c.status==="deleted")f(i(this,Q)).has(c.$id)&&(f(i(this,Q)).delete(c.$id),a++,console.log(`[RecipesStore] Recette ${c.$id} supprimÃ©e (status=deleted)`));else{const l=Ta(c);f(i(this,Q)).set(l.$id,l),n++}});const o=new Date().toISOString();i(this,x)&&(await i(this,x).saveRecipesIndex(f(i(this,Q))),await i(this,x).saveMetadata({...e,lastAppwriteSync:o})),console.log(`[RecipesStore] Sync incrÃ©mentiel terminÃ© (${n} mises Ã  jour, ${a} supprimÃ©es).`)},hd=async function(){try{console.log("[RecipesStore] Configuration du Realtime...");const e=lt();Ht.register([`databases.${e}.collections.${gs}.documents`],async r=>{const s=r.payload;let n="update";if(r.events.some(a=>a.includes(".create"))?n="create":r.events.some(a=>a.includes(".delete"))&&(n="delete"),console.log(`[RecipesStore] â¡ï¸ Realtime RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){if(s.status==="deleted"){if(f(i(this,Q)).delete(s.$id),i(this,x))try{await i(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e de l'index (status=deleted)`)}catch(l){console.warn(`[RecipesStore] Erreur suppression index ${s.$id}:`,l)}return}const a=Ta(s);f(i(this,Q)).set(s.$id,a);const o=Ha(s.ingredients),c={...s,ingredients:o,astuces:Vi(s.astuces)};if(i(this,x))try{await i(this,x).saveRecipeDetail(c),console.log(`[RecipesStore] DÃ©tails de ${s.$id} mis Ã  jour dans le cache`)}catch(l){console.warn(`[RecipesStore] Erreur mise Ã  jour cache dÃ©tails ${s.$id}:`,l)}}else if(n==="delete"&&(f(i(this,Q)).delete(s.$id),i(this,x)))try{await i(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e du cache`)}catch(a){console.warn(`[RecipesStore] Erreur suppression cache ${s.$id}:`,a)}}),console.log("[RecipesStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[RecipesStore] Erreur lors de la configuration du realtime:",e)}},fo=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},ho=async function(e,r,s,n,a){if(!(n>a))for(const[o,c]of f(i(this,Q)))r.has(o)||c.rootRecipeId===e&&(r.set(o,c),c.rootRecipeId&&c.rootRecipeId!==e&&!s.has(c.rootRecipeId)&&(s.add(c.rootRecipeId),await b(this,je,ho).call(this,c.rootRecipeId,r,s,n+1,a)))};const li=new tg;function rg(t){const e=kr(t.specs)??null,r=ko($o(t.purchases??[]));let s=[];e?.quantity&&(s=[e.quantity]);const n=kr(t.totalNeededOverride),a=n?[n.totalOverride]:s,{numeric:o,display:c}=Ti(a,r);let l=kr(t.stockReel)??null;if(l&&l.quantity&&l.unit){const p=Co.normalize(parseFloat(l.quantity),l.unit);l={...l,quantity:p.quantity,unit:p.unit}}const u=ut(r),d=t.store?kr(t.store):null,h=l?`${l.quantity} ${l.unit}`:u;return{$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,productHugoUuid:t.productHugoUuid||"",productName:t.productName,productType:t.productType||"none",pF:e?.pF??!1,pS:e?.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:t.isSynced,mainId:t.mainId,totalNeededRaw:[],status:t.status,who:t.who,store:t.store,stockReel:t.stockReel,previousNames:t.previousNames,isMerged:t.isMerged,mergedFrom:t.mergedFrom,mergeDate:t.mergeDate,mergeReason:t.mergeReason,mergedInto:t.mergedInto,totalNeededOverride:t.totalNeededOverride,purchases:t.purchases,specs:t.specs,byDate:{},storeInfo:d,stockParsed:l,specsParsed:e,totalNeededArray:s,totalPurchasesArray:r,missingQuantityArray:o,stockOrTotalPurchases:h,displayTotalNeeded:ut(s),displayTotalPurchases:u,displayMissingQuantity:c,totalNeededOverrideParsed:n,displayTotalOverride:n?ut([n.totalOverride]):"",dateDisplayInfo:{}}}function qa(t,e){const r=t.purchases??e.purchases,s=t.specs??e.specs,n=s?kr(s):e.specsParsed,a=ko($o(r??[])),o=ut(a);let c=e.totalNeededArray;!e.productHugoUuid&&n?.quantity&&(c=[n.quantity]);const l=kr(t.totalNeededOverride??e.totalNeededOverride),u=l?[l.totalOverride]:c,{numeric:d,display:h}=Ti(u,a),p=t.stockReel??e.stockReel;let g=p?kr(p):e.stockParsed;if(g&&g.quantity&&g.unit){const I=Co.normalize(parseFloat(g.quantity),g.unit);g={...g,quantity:I.quantity,unit:I.unit}}const w=t.store??e.store,A=w?kr(w):e.storeInfo,E=g?`${g.quantity} ${g.unit}`:o;return t.purchases===void 0&&e.purchases?.length&&console.log(`[ProductsStore] Fusion intelligente : prÃ©servation de ${e.purchases.length} purchases pour ${e.productName}`),{...e,$updatedAt:t.$updatedAt,productName:t.productName??e.productName,productType:t.productType??e.productType,isSynced:t.isSynced??e.isSynced,mainId:t.mainId??e.mainId,pF:n?.pF??e.pF,pS:n?.pS??e.pS,status:t.status??e.status,who:t.who??e.who,store:w,stockReel:p,specs:s,purchases:r,previousNames:t.previousNames??e.previousNames,isMerged:t.isMerged??e.isMerged,mergedFrom:t.mergedFrom??e.mergedFrom,mergeDate:t.mergeDate??e.mergeDate,mergeReason:t.mergeReason??e.mergeReason,mergedInto:t.mergedInto??e.mergedInto,totalNeededOverride:t.totalNeededOverride??e.totalNeededOverride,storeInfo:A,stockParsed:g,specsParsed:n,totalNeededArray:c,totalPurchasesArray:a,missingQuantityArray:d,stockOrTotalPurchases:E,displayTotalPurchases:o,displayMissingQuantity:h,displayTotalNeeded:ut(c),totalNeededOverrideParsed:l,displayTotalOverride:l?ut([l.totalOverride]):""}}function sg(t){t.totalPurchasesArray=ko($o(t.purchases??[]));const e=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray,{numeric:r,display:s}=Ti(e,t.totalPurchasesArray);t.missingQuantityArray=r,t.displayMissingQuantity=s}async function ll(t,e,r){console.log(`[productEnrichment] Calcul pour Ã©vÃ©nement ${t.$id} avec ${t.meals.length} repas`);const s=new Set;for(const l of t.meals)for(const u of l.recipes)s.add(u.recipeUuid);console.log(`[productEnrichment] ${s.size} recettes uniques identifiÃ©es`);const n=await li.getRecipesByUuidsBulk([...s]);console.log(`[productEnrichment] ${n.size}/${s.size} recettes chargÃ©es`);const a=l=>Promise.resolve(n.get(l)||null),o=new Map;for(const l of t.meals)await ng(l,a,o);const c=[];for(const[l,u]of o)c.push(ig(u,r));return console.log(`[productEnrichment] ${c.length} produits calculÃ©s`),c}async function ng(t,e,r){const s=t.date;for(const n of t.recipes){const a=await e(n.recipeUuid);if(!a){console.warn(`[processMeal] Recette ${n.recipeUuid} introuvable`);continue}const o=n.plates/a.plate;for(const c of a.ingredients)ag(c,o,s,r,a.title,n.plates)}}function ag(t,e,r,s,n,a){const o=t.uuid;s.has(o)||s.set(o,{productHugoUuid:o,productName:t.name,productType:t.type,pF:t.pF??!1,pS:t.pS??!1,byDate:{},allergens:new Set(t.allergens||[])});const c=s.get(o),l=t.normalizedUnit==="au goÃ»t"?t.normalizedQuantity:t.normalizedQuantity*e,u=t.normalizedUnit==="au goÃ»t"?t.originalQuantity:t.originalQuantity*e;c.byDate[r]||(c.byDate[r]={quantities:[],recipes:[],totalAssiettes:0});const d=c.byDate[r];d.quantities.push({q:l,u:t.normalizedUnit}),d.recipes.push({r:n,q:u,u:t.originalUnit,qEq:l,uEq:t.normalizedUnit,a}),d.totalAssiettes+=a,t.allergens&&t.allergens.forEach(h=>c.allergens.add(h))}function ig(t,e){const r=_u(t.productName).substring(0,20),s=e.slice(-10),n=`${r}_${s}`,a={};for(const[I,$]of Object.entries(t.byDate))a[I]={totalConsolidated:ao($.quantities),recipes:$.recipes,totalAssiettes:$.totalAssiettes,recipeCount:$.recipes.length};const o=Object.values(a).flatMap(I=>I.totalConsolidated),c=ao(o),l=[],u=[],d=c,{numeric:h,display:p}=Ti(d,l),g=Object.values(a).reduce((I,$)=>I+$.recipeCount,0),w=Object.values(a).reduce((I,$)=>I+$.totalAssiettes,0),A=op(Object.keys(a));return{$id:n,mainId:e,productHugoUuid:t.productHugoUuid,productName:t.productName,productType:t.productType,byDate:a,totalNeededArray:c,totalPurchasesArray:l,missingQuantityArray:h,displayTotalNeeded:ut(c),displayTotalPurchases:ut(l),displayMissingQuantity:p,isSynced:!1,status:"active",who:[],store:"",storeInfo:null,purchases:u,stockReel:"",stockParsed:null,totalNeededOverride:null,totalNeededOverrideParsed:null,displayTotalOverride:"",stockOrTotalPurchases:"",previousNames:null,isMerged:!1,mergedFrom:[],mergeDate:null,mergeReason:null,mergedInto:null,specs:null,specsParsed:null,pF:t.pF??!1,pS:t.pS??!1,nbRecipes:g,totalAssiettes:w,totalNeededRaw:c,dateDisplayInfo:A,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],$databaseId:"",$tableId:""}}function pd(t,e){const{operationName:r,maxAutoRetries:s=1,autoRetryDelay:n=1e3}=e;let a=1;return new Promise((o,c)=>{const l=async()=>{try{console.log(`[RetryUtils] ${r} - Tentative ${a}/${s+1}`);const u=await t();console.log(`[RetryUtils] ${r} - SuccÃ¨s`),e.onSuccess?.(u),o(u)}catch(u){if(console.error(`[RetryUtils] Erreur ${r} (Tentative ${a}):`,u),u instanceof Error&&u.message,a<=s){a++,console.log(`[RetryUtils] Nouvelle tentative dans ${n/1e3}s...`),setTimeout(()=>l(),n);return}console.error(`[RetryUtils] ${r} - Ãchec aprÃ¨s ${a} tentatives`),e.onError?.(u),c(u)}};l()})}function Da(t){if(!t)return[];const e=[],r=t.$id;return e.push(te.read(ie.label(r)),te.update(ie.label(r))),e}function og(t,e,r,s){let n=t.who,a=t.store;return r==="who"?n=e.names||null:r==="store"&&(a=JSON.stringify(e)),{$id:t.$id,productHugoUuid:t.productHugoUuid,productName:t.productName,mainId:t.mainId,status:t.status||null,who:n,store:a,stockReel:t.stockReel||null,previousNames:t.previousNames||null,isMerged:t.isMerged||!1,mergedFrom:t.mergedFrom||null,mergeDate:t.mergeDate||null,mergeReason:t.mergeReason||null,mergedInto:t.mergedInto||null,totalNeededOverride:t.totalNeededOverride||null,$permissions:[te.read(ie.label(s)),te.update(ie.label(s))]}}function md(t,e){return{$id:t.$id,mainId:t.mainId,productHugoUuid:t.productHugoUuid,productName:t.productName,...e}}async function cg(t){const{account:e}=await D(),r=await e.get();return{...t,updatedBy:r.name}}function gd(){return localStorage.getItem("appwrite-user-name")||""}async function yd(t,e,r=100){try{const{tables:s,config:n}=await D(),a=await s.listRows({databaseId:n.databaseId,tableId:n.collections.purchases,queries:[S.greaterThan("$updatedAt",e),S.equal("mainId",t),S.limit(r)]});return console.log(`[Appwrite product] ${a.rows.length} purchases modifiÃ©s chargÃ©s`),a.rows}catch(s){return console.error("[Appwrite product] Erreur chargement purchases modifiÃ©s:",s),[]}}async function wd(t,e){const{lastSync:r,limit:s=1e3}=e;try{const{tables:n,config:a}=await D();if(!r){console.log("[Appwrite product] Chargement complet des produits et achats");const p=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[S.equal("mainId",t),S.limit(s)]})).rows,w=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[S.equal("mainId",t),S.limit(s*2)]})).rows,A=new Map;return p.forEach(E=>{A.set(E.$id,{...E,purchases:[]})}),w.forEach(E=>{E.products?.forEach(I=>{const $=A.get(I);$&&($.purchases||($.purchases=[]),$.purchases.push(E))})}),console.log(`[Appwrite product] ${p.length} produits chargÃ©s avec ${w.length} achats`),Array.from(A.values())}const o=await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[S.greaterThan("$updatedAt",r),S.equal("mainId",t),S.limit(s)]}),c=o.rows,u=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[S.greaterThan("$updatedAt",r),S.equal("mainId",t),S.limit(s*2)]})).rows,d=new Map;return c.forEach(h=>{d.set(h.$id,{...h,purchases:[]})}),u.forEach(h=>{h.products?.forEach(p=>{const g=d.get(p);g&&(g.purchases||(g.purchases=[]),g.purchases.push(h))})}),o.rows.length>0&&console.log(`[Appwrite product] ${o.rows.length} produits synchronisÃ©s (delta)`),Array.from(d.values())}catch(n){console.error(`[Appwrite product] Erreur sync produits avec purchases pour mainId ${t}:`,n);const a=n instanceof Error?n.message:"Erreur lors de la synchronisation";throw new Error(`Ãchec de la synchronisation: ${a}`)}}async function vd(t,e,r=!0){const{tables:s,config:n}=await D();return r&&(e.updatedBy=gd()),await s.updateRow({databaseId:n.databaseId,tableId:n.collections.products,rowId:t,data:e})}async function bd(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour crÃ©ation`);console.log(`[Appwrite product] CrÃ©ation produit ${t} sur Appwrite...`);const n=md(s,e),a=await cg(n),{tables:o,config:c}=await D(),l=Ye.getEventById(a.mainId),u=Da(l),d=await o.createRow({databaseId:c.databaseId,tableId:c.collections.products,rowId:t,data:a,permissions:u});return console.log(`[Appwrite product] Produit ${t} crÃ©Ã© avec permissions (labels + teams)`),d}catch(s){console.error(`[Appwrite product] Erreur crÃ©ation produit ${t}:`,s);const n=s instanceof Error?s.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation du produit: ${n}`)}}async function lg(t,e){try{const{tables:r,config:s}=await D(),a=`${_u(t.productName).substring(0,10)}_${Date.now().toString(36)}`,o={quantity:t.quantity,pF:t.pF||!1,pS:t.pS||!1},c={productHugoUuid:null,productName:t.productName,productType:t.productType||"Autre",store:t.store?JSON.stringify(t.store):null,who:t.who||[],isSynced:!0,mainId:e,status:"active",updatedBy:gd(),stockReel:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,mergedInto:null,totalNeededOverride:null,specs:JSON.stringify(o)};console.log(`[Appwrite product] CrÃ©ation produit manuel ${a}...`,c);const l=Ye.getEventById(e),u=Da(l),d=await r.createRow({databaseId:s.databaseId,tableId:s.collections.products,rowId:a,data:c,permissions:u});return console.log(`[Appwrite product] Produit manuel ${a} crÃ©Ã© avec permissions Label`),d}catch(r){throw console.error("[Appwrite product] Erreur crÃ©ation produit manuel:",r),r}}async function ug(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour mise Ã  jour batch`);const n={};return e.stockReel!==void 0&&(n.stockReel=e.stockReel),e.who!==void 0&&(n.who=e.who),e.storeInfo!==void 0&&(n.store=JSON.stringify(e.storeInfo)),s.isSynced?(console.log(`[Appwrite product] Produit ${t} dÃ©jÃ  sync, update batch normal...`),await vd(t,n)):(console.log(`[Appwrite product] Produit ${t} local, crÃ©ation batch avec upsert...`),await bd(t,n,r))}catch(s){throw console.error(`[Appwrite product] Erreur lors de la mise Ã  jour batch du produit ${t}:`,s),s}}async function dg(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow(s.databaseId,s.collections.purchases,t,e);return console.log(`[Appwrite product] Achat ${t} mis Ã  jour:`,e),n}catch(r){console.error(`[Appwrite product] Erreur mise Ã  jour achat ${t}:`,r);const s=r instanceof Error?r.message:"Erreur inconnue";throw new Error(`Ãchec de la mise Ã  jour de l'achat: ${s}`)}}async function fg(t){try{const{tables:e,config:r}=await D();await e.deleteRow(r.databaseId,r.collections.purchases,t),console.log(`[Appwrite product] Achat ${t} supprimÃ©`)}catch(e){console.error(`[Appwrite product] Erreur suppression achat ${t}:`,e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec de la suppression de l'achat: ${r}`)}}async function Ed(t){if(!t?.length)return[];try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[S.equal("$id",t)]);return console.log(`[Appwrite product] ${s.rows.length} purchases chargÃ©s avec relations products`),s.rows}catch(e){console.error("[Appwrite product] Erreur chargement purchases avec relations:",e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec du chargement des purchases: ${r}`)}}async function hg(t,e,r,s){try{const{functions:n,config:a,account:o}=await D(),c=qd.currentMainId;if(!c)throw new Error("No current event - cannot determine mainId for permissions");const l=await o.get(),u=t.map(g=>{const w=e.find(A=>A.$id===g);if(!w)throw new Error(`Product ${g} not found in products data`);return og(w,s,r,c)});console.log(`[Appwrite product] Lancement mise Ã  jour groupÃ©e OPTIMISÃE: ${u.length} produits, type: ${r}`);const d={operation:"batchUpdateProductsOptimized",data:{rows:u,fromUserId:l.$id}},h=await pd(()=>n.createExecution(a.functions.batchUpdate,JSON.stringify(d),!1,"/",In.POST),{operationName:`batchUpdateProductsOptimized (${u.length} products, type: ${r})`,maxAutoRetries:1,autoRetryDelay:2e3});if(!h)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives de mise Ã  jour groupÃ©e optimisÃ©e");if(h.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${h.status}. Erreur: ${h.stderr||h.responseBody}`);const p=JSON.parse(h.responseBody);return p.success?console.log(`[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e rÃ©ussie: ${p.updatedCount} produits mis Ã  jour`):console.error("[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e Ã©chouÃ©e:",p.error),p}catch(n){console.error("[Appwrite products] Erreur mise Ã  jour groupÃ©e optimisÃ©e:",n);const a=n instanceof Error?n.message:"Erreur inconnue";return{success:!1,updatedCount:t.length,updateType:r,error:a,timestamp:new Date().toISOString()}}}async function pg(t,e,r,s={}){try{const{tables:n,config:a,account:o}=await D(),c=await o.get(),l=Ye.getEventById(t),u=Da(l),d=[];console.log("[Appwrite product] Debug createQuickValidationPurchases:",{mainId:t,productId:e,productIdType:typeof e,quantities:r,options:s});const h=s.status||"delivered";let p=s.deliveryDate||null;h==="delivered"&&!p&&(p=new Date().toISOString());for(const g of r){const w={products:[e],mainId:t,quantity:g.q,unit:g.u,status:h,notes:s.notes||`Validation rapide ${new Date().toLocaleDateString("fr-FR")}`,store:s.store??null,who:s.who||c.name,price:s.price||null,orderDate:s.orderDate||null,deliveryDate:p,createdBy:c.$id,invoiceId:s.invoiceId,invoiceTotal:null},A=await n.createRow(a.databaseId,a.collections.purchases,ht.unique(),w,u);d.push(A)}return console.log(`[Appwrite product] ${d.length} validations rapides crÃ©Ã©es avec permissions (labels + teams) pour produit ${e}`),d}catch(n){console.error("[Appwrite product] Erreur crÃ©ation validation rapide:",n);const a=n instanceof Error?n.message:"Erreur inconnue";throw new Error(`Ãchec de la validation rapide: ${a}`)}}async function mg(t,e,r,s,n,a){try{const{tables:o,config:c,account:l}=await D(),u=await l.get(),d=e||ht.unique(),h=u.name;if(!r)throw new Error("invoiceTotal est requis pour une dÃ©pense");const p=Ye.getEventById(t),g=Da(p),w={products:[],mainId:t,quantity:1,unit:"global",status:"expense",notes:n||"",store:s??null,who:h||u.name,price:r,invoiceId:d,invoiceTotal:r,orderDate:null,deliveryDate:new Date().toISOString(),createdBy:u.$id},A=await o.createRow(c.databaseId,c.collections.purchases,ht.unique(),w,g);return console.log("[Appwrite product] DÃ©pense crÃ©Ã©e avec permissions (labels + teams):",A),A}catch(o){console.error("[Appwrite product] Erreur crÃ©ation dÃ©pense:",o);const c=o instanceof Error?o.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation de la dÃ©pense: ${c}`)}}async function Sd(t){try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[S.equal("mainId",t),S.equal("status","expense"),S.limit(1e3)]);return console.log(`[Appwrite product] ${s.rows.length} dÃ©penses globales chargÃ©es`),s.rows}catch(e){return console.error("[Appwrite product] Erreur chargement dÃ©penses globales:",e),[]}}const Vr=Object.freeze(Object.defineProperty({__proto__:null,batchUpdateProductsOptimized:hg,createExpensePurchase:mg,createManualProduct:lg,createQuickValidationPurchases:pg,deletePurchase:fg,enrichedProductToAppwriteProduct:md,getEventPermissionsFromEvent:Da,loadOrphanPurchases:Sd,loadPurchasesListByIds:Ed,loadUpdatedPurchases:yd,syncProductsWithPurchases:wd,updateProduct:vd,updateProductBatch:ug,updatePurchase:dg,upsertProduct:bd},Symbol.toStringTag,{value:"Module"}));class gg{constructor(e){C(this,"dbName");C(this,"db",null);C(this,"version",1);C(this,"PRODUCTS_STORE","products");C(this,"METADATA_STORE","metadata");C(this,"LAST_SYNC_KEY","lastSync");C(this,"ALL_DATES_KEY","allDates");C(this,"HUGO_HASH_KEY","hugoContentHash");this.dbName=`products-cache-${e}`}async open(){if(!this.db)return new Promise((e,r)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>r(s.error),s.onsuccess=()=>{this.db=s.result,console.log(`[IDBCache] Base ouverte: ${this.dbName}`),e()},s.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(this.PRODUCTS_STORE)||(a.createObjectStore(this.PRODUCTS_STORE,{keyPath:"$id"}),console.log("[IDBCache] Object store 'products' crÃ©Ã©")),a.objectStoreNames.contains(this.METADATA_STORE)||(a.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[IDBCache] Object store 'metadata' crÃ©Ã© avec keyPath"))}})}async loadProducts(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.PRODUCTS_STORE,"readonly").objectStore(this.PRODUCTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[IDBCache] ${o.size} produits chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null,allDates:[],hugoContentHash:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY?c.lastSync=l.value:l.key===this.ALL_DATES_KEY?c.allDates=l.value||[]:l.key===this.HUGO_HASH_KEY&&(c.hugoContentHash=l.value)}),console.log(`[IDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}, dates=${c.allDates?.length||0}, hash=${c.hugoContentHash}`),e(c)},a.onerror=()=>r(a.error)})}async saveProducts(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.PRODUCTS_STORE,"readwrite"),a=n.objectStore(this.PRODUCTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[IDBCache] ${e.size} produits sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_KEY,value:e.lastSync}),a.put({key:this.ALL_DATES_KEY,value:e.allDates}),e.hugoContentHash!==void 0&&a.put({key:this.HUGO_HASH_KEY,value:e.hugoContentHash}),n.oncomplete=()=>{console.log("[IDBCache] Metadata sauvegardÃ©es (objets {key, value})"),r()},n.onerror=()=>s(n.error)})}async updateLastSync(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] lastSync mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateAllDates(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.ALL_DATES_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] allDates mis Ã  jour: ${e.length} dates`),r()},o.onerror=()=>s(o.error)})}async updateHugoContentHash(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.HUGO_HASH_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] hugoContentHash mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateLastHugoMenuUpdate(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:"lastHugoMenuUpdate",value:e});o.onsuccess=()=>{console.log("[IDBCache] lastHugoMenuUpdate sauvegardÃ©"),r()},o.onerror=()=>s(o.error)})}async upsertProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).put(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.PRODUCTS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.PRODUCTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[IDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[IDBCache] Connexion fermÃ©e"))}}async function yg(t){const e=new gg(t);return await e.open(),e}var Gn,Qn;class bs{constructor(e,r){y(this,Gn,P(ge({})));C(this,"dateStore");y(this,Qn,z(()=>{const e=this.dateStore.current;this.dateStore.dates;let r;if(e.start&&e.end)r=cp(this.data,e.start,e.end);else return{quantities:[],formattedQuantities:"",nbRecipes:0,totalAssiettes:0,stockResult:[],availableQuantities:[],missingQuantities:[],formattedMissingQuantities:"",formattedAvailableQuantities:"En attente",hasAvailable:!1,hasMissing:!1,concernedDates:[],recipesByDate:new Map};return{quantities:r.requiredQuantities,formattedQuantities:r.requiredQuantitiesFormatted,nbRecipes:r.totalRecipesInRange,totalAssiettes:r.totalPortionsInRange,stockResult:r.stockBalance,availableQuantities:r.availableStockQuantities,missingQuantities:r.missingStockQuantities,formattedMissingQuantities:r.missingStockFormatted,formattedAvailableQuantities:r.availableStockFormatted,hasAvailable:r.hasAvailableStock,hasMissing:r.hasMissingStock,concernedDates:r.datesInSelectedRange,recipesByDate:r.recipesByDate}}));this.data=e,this.dateStore=r}get data(){return f(i(this,Gn))}set data(e){m(i(this,Gn),e,!0)}update(e){this.data=e}get $id(){return this.data.$id}get productName(){return this.data.productName}get productType(){return this.data.productType}get storeInfo(){return this.data.storeInfo}get who(){return this.data.who}get pF(){return this.data.pF}get pS(){return this.data.pS}get status(){return this.data.status}get previousNames(){return this.data.previousNames}get purchases(){return this.data.purchases}get totalNeededOverrideParsed(){return this.data.totalNeededOverrideParsed}get displayMissingQuantity(){return this.data.displayMissingQuantity}get missingQuantityArray(){return this.data.missingQuantityArray}get isSynced(){return this.data.isSynced}get byDate(){return this.data.byDate}get stats(){return f(i(this,Qn))}set stats(e){m(i(this,Qn),e)}}Gn=new WeakMap,Qn=new WeakMap;var le,ve,Ee,Jn,Kn,Yn,Xn,Zn,zn,Fn,ea,ta;class wg{constructor(e=[]){y(this,le,P(ge([])));y(this,ve,P(null));y(this,Ee,P(null));y(this,Jn,z(()=>[...f(i(this,le))].sort()[0]));y(this,Kn,z(()=>[...f(i(this,le))].sort()[f(i(this,le)).length-1]));y(this,Yn,z(()=>{if(f(i(this,le)).length===0)return!0;const e=this.lastAvailableDate?new Date(this.lastAvailableDate):new Date;return e.setHours(23,59,59,999),e<new Date}));y(this,Xn,z(()=>{if(f(i(this,le)).length===0)return!1;const e=new Date;return e.setHours(0,0,0,0),f(i(this,le)).some(r=>new Date(r)>=e)}));y(this,Zn,z(()=>f(i(this,ve))===this.firstAvailableDate&&f(i(this,Ee))===this.lastAvailableDate));y(this,zn,z(()=>{if(f(i(this,le)).length===0)return!1;const e=[...f(i(this,le))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(o=>new Date(o)>=r)||null;let n,a;if(s)n=s,a=e[e.length-1];else{const o=e[e.length-1];n=o,a=o}return f(i(this,ve))===n&&f(i(this,Ee))===a}));y(this,Fn,z(()=>f(i(this,le)).length===1));y(this,ea,z(()=>!!(f(i(this,ve))&&f(i(this,ve))===f(i(this,Ee)))));y(this,ta,z(()=>{if(!f(i(this,ve))||!f(i(this,Ee))||this.isEventPassed)return!1;const e=new Date(f(i(this,ve)));return e.setHours(e.getHours()+Ru),e<new Date}));m(i(this,le),e,!0),this.initializeSmartRange()}get start(){return f(i(this,ve))}get end(){return f(i(this,Ee))}get dates(){return f(i(this,le))}get firstAvailableDate(){return f(i(this,Jn))}set firstAvailableDate(e){m(i(this,Jn),e)}get lastAvailableDate(){return f(i(this,Kn))}set lastAvailableDate(e){m(i(this,Kn),e)}get current(){return{start:f(i(this,ve)),end:f(i(this,Ee))}}get isEventPassed(){return f(i(this,Yn))}set isEventPassed(e){m(i(this,Yn),e)}get hasUpcomingDates(){return f(i(this,Xn))}set hasUpcomingDates(e){m(i(this,Xn),e)}get isFullRange(){return f(i(this,Zn))}set isFullRange(e){m(i(this,Zn),e)}get isUpcomingRange(){return f(i(this,zn))}set isUpcomingRange(e){m(i(this,zn),e)}get hasSingleDateEvent(){return f(i(this,Fn))}set hasSingleDateEvent(e){m(i(this,Fn),e)}get hasSingleDateInRange(){return f(i(this,ea))}set hasSingleDateInRange(e){m(i(this,ea),e)}get hasPastDatesInRange(){return f(i(this,ta))}set hasPastDatesInRange(e){m(i(this,ta),e)}setAvailableDates(e){m(i(this,le),e,!0),this.initializeSmartRange()}setRange(e,r){if(!e&&!r){m(i(this,ve),null),m(i(this,Ee),null);return}if(!e||!r){const a=e||r;m(i(this,ve),a,!0),m(i(this,Ee),a,!0);return}const s=new Date(e)<=new Date(r)?e:r,n=new Date(e)>=new Date(r)?e:r;m(i(this,ve),s,!0),m(i(this,Ee),n,!0)}selectAll(){f(i(this,le)).length!==0&&(m(i(this,ve),f(i(this,le))[0],!0),m(i(this,Ee),f(i(this,le))[f(i(this,le)).length-1],!0))}selectUpcoming(){if(f(i(this,le)).length===0)return;const e=[...f(i(this,le))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(n=>new Date(n)>=r)||null;if(s)m(i(this,ve),s,!0),m(i(this,Ee),e[e.length-1],!0);else{const n=e[e.length-1];m(i(this,ve),n,!0),m(i(this,Ee),n,!0)}}selectFutureDatesOnly(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const r=f(i(this,le)).filter(s=>new Date(s)>=e);r.length>0&&(m(i(this,ve),r[0],!0),m(i(this,Ee),r[r.length-1],!0))}initializeSmartRange(){if(f(i(this,le)).length===0)return;const e=[...f(i(this,le))].sort(),r=this.isEventPassed,s=new Date(e[0])<new Date,n=new Date;let a;r?a=e[0]:s?a=n.toISOString().slice(0,19)+"Z":a=e[0],m(i(this,ve),a,!0),m(i(this,Ee),e[e.length-1],!0),console.log(`[DateRangeStore] Initialized: ${f(i(this,ve))} - ${f(i(this,Ee))}`)}reset(){m(i(this,le),[],!0),m(i(this,ve),null),m(i(this,Ee),null),console.log("[DateRangeStore] Reset")}}le=new WeakMap,ve=new WeakMap,Ee=new WeakMap,Jn=new WeakMap,Kn=new WeakMap,Yn=new WeakMap,Xn=new WeakMap,Zn=new WeakMap,zn=new WeakMap,Fn=new WeakMap,ea=new WeakMap,ta=new WeakMap;function vg(t,e={}){const{showOtherUserToasts:r=!0}=e;return s=>{const{events:n,payload:a}=s;if(!a)return;if(s.event==="client.connected"){t.onConnect?.();return}const o=n.some(h=>h.includes("products.")),c=n.some(h=>h.includes("purchases.")),l=n.some(h=>h.includes(".create")),u=n.some(h=>h.includes(".update")),d=n.some(h=>h.includes(".delete"));o?bg(a,{isCreate:l,isUpdate:u,isDelete:d},t,r):c&&Eg(a,{isCreate:l,isUpdate:u,isDelete:d},t,r)}}function bg(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;s&&t.updatedBy&&t.updatedBy!==T.userName&&(n||a?Qe.info(`${t.updatedBy} a modifiÃ© le produit "${t.productName}"`,{source:"realtime-other"}):o&&Qe.info(`${t.updatedBy} a supprimÃ© un produit`,{source:"realtime-other"})),n?r.onProductCreate(t):a?r.onProductUpdate(t):o&&r.onProductDelete(t.$id)}function Eg(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;if(s&&t.createdBy&&t.createdBy!==T.userName){const c="un produit";n&&t.who!==T.userName?Qe.info(`${t.who} a ajoutÃ© un achat pour ${c}`,{source:"realtime-other"}):a&&t.who!==T.userName?Qe.info(`${t.who} a modifiÃ© un achat pour ${c}`,{source:"realtime-other"}):o&&Qe.info(`${t.who} a supprimÃ© un achat pour ${c}`,{source:"realtime-other"})}n?r.onPurchaseCreate(t):a?r.onPurchaseUpdate(t):o&&r.onPurchaseDelete(t.$id)}function Sg(t,e={}){const r=lt(),s=yr("products"),n=yr("purchases"),a=[`databases.${r}.collections.${s}.documents`,`databases.${r}.collections.${n}.documents`],o=vg(t,e),c=Ht.registerDynamic(a,o);return console.log(`[ProductsRealtimeHandler] â Realtime configurÃ© (${a.length} channels)`),c}const ul=1e3;var O,tt,Ne,de,Mr,ra,Js,os,cs,Ve,re,$r,sa,q,na,aa,ia,oa,ca,Ii,la,ua,Ai,j,Id,Ks,ar,Ad,_d,Ja,Ka,Rd,po,Ag,Ya,Pd,Dd,Md,$d,kd,Xa,mo,Cd,Td,Nd,Ld,jd,da,fa;class Ig{constructor(){y(this,j);y(this,O,new ft);y(this,tt,new ft);y(this,Ne,P(null));y(this,de,P(null));y(this,Mr,P(!1));y(this,ra,P(!1));y(this,Js,P(null));y(this,os,P(!1));y(this,cs,P(!1));y(this,Ve,P(null));C(this,"dateStore",new wg);y(this,re,null);y(this,$r,null);y(this,sa,P(ge([])));y(this,q,P(ge({searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"})));y(this,na,z(()=>{const e=Array.from(i(this,O).values()).map(r=>r.data);return console.log(`[ProductsStore] enrichedProducts recalculated: ${e.length} products`),e}));y(this,aa,z(()=>{if(console.log("[Store] Filtering products by date range (Map)"),!this.dateRange.start||!this.dateRange.end)return new Map;new Date(this.dateRange.start),new Date(this.dateRange.end);const e=new Map,r=this.dateRange.start,s=this.dateRange.end;for(const[n,a]of i(this,O)){const o=a.data,c=!o.productHugoUuid;if(!o.byDate&&!c||!sp(o,f(i(this,q))))continue;if(f(i(this,q)).completionStatus!=="all"){const d=a.stats.hasMissing;if(f(i(this,q)).completionStatus==="completed"&&d||f(i(this,q)).completionStatus==="incomplete"&&!d)continue}let u=!1;o.byDate&&(u=Object.keys(o.byDate).some(d=>d>=r&&d<=s)),(u||c)&&e.set(n,a)}return e}));y(this,ia,z(()=>({total:i(this,O).size,frais:Array.from(i(this,O).values()).filter(e=>e.pF).length,surgel:Array.from(i(this,O).values()).filter(e=>e.pS).length,merged:Array.from(i(this,O).values()).filter(e=>e.data.isMerged).length})));y(this,oa,z(()=>{const e=Array.from(i(this,O).values()).map(r=>r.storeInfo?.storeName).filter(Boolean);return[...new Set(e)]}));y(this,ca,z(()=>{if(!f(i(this,de)))return[];const e=Ye.getEventById(f(i(this,de)));return e?.contributors?e.contributors.filter(r=>r.status==="accepted"&&r.name?.trim()).map(r=>r.name.trim()).sort():[]}));y(this,Ii,z(()=>{const e=Array.from(i(this,O).values()).flatMap(r=>r.who||[]);return[...new Set(e)].sort()}));y(this,la,z(()=>{const e=new Set([...this.eventContributors,...f(i(this,Ii))]);return Array.from(e).sort()}));y(this,ua,z(()=>{const e=Array.from(i(this,O).values()).map(r=>r.productType).filter(Boolean);return[...new Set(e)]}));y(this,Ai,z(()=>{const r=Array.from(this.filteredProductsMap.values()).sort((o,c)=>o.$id.localeCompare(c.$id));if(f(i(this,q)).groupBy==="none")return{"":r};const s=Object.groupBy(r,o=>f(i(this,q)).groupBy==="store"?o.storeInfo?.storeName||"Non dÃ©fini":o.productType||"Non dÃ©fini"),n=Object.keys(s).sort((o,c)=>o===""?1:c===""?-1:o.localeCompare(c)),a={};return n.forEach(o=>{a[o]=s[o]}),a}));y(this,Ks,"");y(this,ar,null);C(this,"setSearchQuery",Zh(e=>{f(i(this,q)).searchQuery=e,e.trim().length>0&&(f(i(this,q)).selectedStores=[],f(i(this,q)).selectedWho=[],f(i(this,q)).selectedProductTypes=[],f(i(this,q)).selectedTemperatures=[],f(i(this,q)).temperatureFilter="all",f(i(this,q)).completionStatus="all")},()=>500));y(this,da,z(()=>{let e=0,r=0;for(const s of i(this,O).values())s.stats.hasMissing?r++:e++;return{completed:e,missing:r,total:e+r}}));y(this,fa,z(()=>{let e=0;const r={},s={},n=[];for(const a of i(this,tt).values()){const o=a.invoiceTotal||a.price||0;e+=o;const c=a.store||"Non dÃ©fini";r[c]=(r[c]||0)+o;const l=a.who||"Non dÃ©fini";s[l]=(s[l]||0)+o,n.push(a)}for(const a of i(this,O).values()){const o=a.data;if(o.purchases&&o.purchases.length>0){for(const c of o.purchases)if(c.price){e+=c.price;const l=c.store||"Non dÃ©fini";r[l]=(r[l]||0)+c.price;const u=c.who||"Non dÃ©fini";s[u]=(s[u]||0)+c.price;const d={...c,_productName:o.productName};n.push(d)}}}return n.sort((a,o)=>{const c=new Date(a.orderDate||a.$createdAt).getTime();return new Date(o.orderDate||o.$createdAt).getTime()-c}),{totalGlobal:e,byStore:r,byWho:s,allPurchases:n}}))}get currentMainId(){return f(i(this,Ne))}get dateRange(){return this.dateStore.current}get availableDates(){return this.dateStore.dates}get isEventPassed(){return this.dateStore.isEventPassed}get hasSingleDateEvent(){return this.dateStore.hasSingleDateEvent}get hasSingleDateInRange(){return this.dateStore.hasSingleDateInRange}get hasPastDatesInRange(){return this.dateStore.hasPastDatesInRange}get hasPendingConflicts(){return f(i(this,sa)).length>0}get pendingConflicts(){return f(i(this,sa))}get filters(){return f(i(this,q))}get hasFilters(){return this.filters.searchQuery!==""||this.filters.selectedStores.length>0||this.filters.selectedWho.length>0||this.filters.selectedProductTypes.length>0||this.filters.selectedTemperatures.length>0||this.filters.temperatureFilter!=="all"||this.filters.completionStatus!=="all"}get isSearchActive(){return this.filters.searchQuery.trim().length>0}get activeFiltersDescription(){const e=[];if(this.filters.completionStatus==="incomplete"?e.push("Manquants"):this.filters.completionStatus==="completed"&&e.push("Complets"),this.filters.temperatureFilter!=="all"){const r={frais:"Frais","not-frais":"Sans frais",surgele:"SurgelÃ©s","not-surgele":"Sans surgelÃ©s"};e.push(r[this.filters.temperatureFilter]||"")}return this.filters.selectedProductTypes.length>0&&e.push(`Types: ${this.filters.selectedProductTypes.length}`),this.filters.selectedStores.length>0&&e.push(`Magasins: ${this.filters.selectedStores.length}`),this.filters.selectedWho.length>0&&e.push(`Qui: ${this.filters.selectedWho.length}`),e}get groupedFilteredProducts(){return f(i(this,Ai))}get loading(){return f(i(this,ra))}get error(){return f(i(this,Js))}get lastSync(){return f(i(this,Ve))}get syncing(){return f(i(this,os))}setDateRange(e,r){this.dateStore.setRange(e,r)}isFullRange(){return this.dateStore.isFullRange}initializeDateRange(){this.dateStore.initializeSmartRange()}selectUpcomingDates(){this.dateStore.selectUpcoming()}isUpcomingRange(){return this.dateStore.isUpcomingRange}get firstAvailableDate(){return this.dateStore.firstAvailableDate}get lastAvailableDate(){return this.dateStore.lastAvailableDate}selectFutureDatesOnly(){this.dateStore.selectFutureDatesOnly()}get realtimeConnected(){return f(i(this,cs))}get enrichedProducts(){return f(i(this,na))}set enrichedProducts(e){m(i(this,na),e)}get filteredProductsMap(){return f(i(this,aa))}set filteredProductsMap(e){m(i(this,aa),e)}get stats(){return f(i(this,ia))}set stats(e){m(i(this,ia),e)}get uniqueStores(){return f(i(this,oa))}set uniqueStores(e){m(i(this,oa),e)}get eventContributors(){return f(i(this,ca))}set eventContributors(e){m(i(this,ca),e)}get uniqueWho(){return f(i(this,la))}set uniqueWho(e){m(i(this,la),e)}get uniqueProductTypes(){return f(i(this,ua))}set uniqueProductTypes(e){m(i(this,ua),e)}async initialize(e){if(!e?.trim())throw new Error("eventId invalide fourni");if(f(i(this,Mr))&&f(i(this,de))===e){console.log(`[ProductsStore] DÃ©jÃ  initialisÃ© pour eventId: ${e}`);return}f(i(this,Mr))&&f(i(this,de))!==e&&(console.log(`[ProductsStore] Changement d'Ã©vÃ©nement: ${f(i(this,de))} â ${e}, reset...`),this.reset()),console.log(`[ProductsStore] Initialisation avec eventId: ${e}`);const r=Ye.getEventById(e);if(!r)throw new Error(`ÃvÃ©nement ${e} introuvable dans EventsStore`);try{m(i(this,de),r.$id,!0),m(i(this,Ne),r.$id,!0),console.log(`[ProductsStore] Initialisation du cache IDB pour mainId: ${f(i(this,Ne))}`),_(this,re,await yg(f(i(this,Ne)))),await b(this,j,_d).call(this),i(this,O).size===0&&(console.log("[ProductsStore] Cache vide, calcul depuis event.meals..."),await b(this,j,Ad).call(this,r),await b(this,j,Ja).call(this)),this.dateStore.setAvailableDates([...r.allDates||[]]),this.initializeDateRange(),await this.syncFromAppwrite(),await b(this,j,jd).call(this),m(i(this,Mr),!0),b(this,j,Td).call(this),i(this,ar)&&i(this,ar).call(this),_(this,ar,Kl(()=>{qr(()=>{const s=Ye.getEventById(e);s&&b(this,j,Id).call(this,s)})})),console.log(`[ProductsStore] Initialisation complÃ©tÃ©e: ${i(this,O).size} produits`)}catch(s){const n=s instanceof Error?s.message:"Erreur lors de l'initialisation";throw m(i(this,Js),n,!0),console.error("[ProductsStore]",n,s),s}}async syncFromAppwrite(){if(ae(f(i(this,de)))){console.log("[ProductsStore] Mode local: skip syncFromAppwrite");return}if(f(i(this,Ne))){m(i(this,os),!0),console.log(`[ProductsStore] DÃ©but syncFromAppwrite pour mainId: ${f(i(this,Ne))}`);try{console.log(`[ProductsStore] RÃ©cupÃ©ration des produits modifiÃ©s depuis lastSync: ${f(i(this,Ve))}`);const e=await wd(f(i(this,Ne)),{lastSync:f(i(this,Ve)),limit:ul});if(console.log(`[ProductsStore] ${e.length} produits rÃ©cupÃ©rÃ©s depuis Appwrite`),e.forEach(r=>{const s=i(this,O).get(r.$id);console.log(`[ProductsStore] Sync produit ${r.$id}: existing=${!!s}, who=${r.who}, store=${r.store}`);const n=b(this,j,po).call(this,r,s?.data);n.isSynced=!0,n.status="active",s?s.update(n):i(this,O).set(r.$id,new bs(n,this.dateStore))}),f(i(this,Ve))){console.log(`[ProductsStore] RÃ©cupÃ©ration des purchases modifiÃ©s depuis lastSync: ${f(i(this,Ve))}`);const r=await yd(f(i(this,Ne)),f(i(this,Ve)),ul);console.log(`[ProductsStore] ${r.length} purchases modifiÃ©s rÃ©cupÃ©rÃ©s`),r.forEach(s=>{if(s.status==="expense")i(this,tt).set(s.$id,s);else if(s.products?.length){const n=s.products.map(a=>typeof a=="string"?a:a.$id);b(this,j,Xa).call(this,n,s)}})}b(this,j,Rd).call(this),await b(this,j,Ja).call(this),console.log("[ProductsStore] SyncFromAppwrite terminÃ© avec succÃ¨s")}catch(e){throw console.error("[ProductsStore] Erreur lors du sync:",e),e}finally{m(i(this,os),!1)}}}toggleProductType(e){const r=f(i(this,q)).selectedProductTypes.indexOf(e);r>-1?f(i(this,q)).selectedProductTypes.splice(r,1):f(i(this,q)).selectedProductTypes.push(e)}toggleTemperature(e){const r=f(i(this,q)).selectedTemperatures.indexOf(e);r>-1?f(i(this,q)).selectedTemperatures.splice(r,1):f(i(this,q)).selectedTemperatures.push(e)}setTemperatureFilter(e){f(i(this,q)).temperatureFilter=e}clearTypeAndTemperatureFilters(){f(i(this,q)).selectedProductTypes=[],f(i(this,q)).selectedTemperatures=[],f(i(this,q)).temperatureFilter="all"}setGroupBy(e){f(i(this,q)).groupBy=e}toggleStore(e){const r=f(i(this,q)).selectedStores.indexOf(e);r>-1?f(i(this,q)).selectedStores.splice(r,1):f(i(this,q)).selectedStores.push(e)}toggleWho(e){const r=f(i(this,q)).selectedWho.indexOf(e);r>-1?f(i(this,q)).selectedWho.splice(r,1):f(i(this,q)).selectedWho.push(e)}clearStoreFilters(){f(i(this,q)).selectedStores=[]}clearWhoFilters(){f(i(this,q)).selectedWho=[]}setCompletionStatus(e){f(i(this,q)).completionStatus=e}handleSort(e){f(i(this,q)).sortColumn===e?f(i(this,q)).sortDirection=f(i(this,q)).sortDirection==="asc"?"desc":"asc":(f(i(this,q)).sortColumn=e,f(i(this,q)).sortDirection="asc")}clearFilters(){m(i(this,q),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0)}sortProducts(e){return f(i(this,q)).sortColumn?[...e].sort((r,s)=>{let n=r[f(i(this,q)).sortColumn],a=s[f(i(this,q)).sortColumn];return f(i(this,q)).sortColumn==="totalNeededConsolidated"?(n=parseFloat(n)||0,a=parseFloat(a)||0):f(i(this,q)).sortColumn==="purchases"&&(n=r.purchases?.length||0,a=s.purchases?.length||0),n<a?f(i(this,q)).sortDirection==="asc"?-1:1:n>a?f(i(this,q)).sortDirection==="asc"?1:-1:0}):e}getEnrichedProductById(e){return i(this,O).get(e)?.data??null}getProductModelById(e){return i(this,O).get(e)??null}hasConversions(e){const r=i(this,O).get(e)?.data;return r?.byDate?rp(r.byDate):!1}async forceReload(e){await this.clearCache(),await this.initialize(e)}async clearCache(){i(this,O).clear(),m(i(this,Ve),null),i(this,re)&&await i(this,re).clear(),console.log("[ProductsStore] Cache vidÃ©")}setSyncStatus(e,r){const s=r?"isSyncing":"active";e.forEach(n=>{const a=i(this,O).get(n);if(a){const o={...a.data,status:s};a.update(o)}}),console.log(`[ProductsStore] Statut de synchronisation mis Ã  jour: ${e.length} produits â ${s}`)}clearSyncStatus(){const e=[];for(const[r,s]of i(this,O))s.status==="isSyncing"&&e.push(r);e.length>0&&(this.setSyncStatus(e,!1),console.log(`[ProductsStore] Nettoyage de ${e.length} produits en statut "isSyncing"`))}reset(){var e;console.log(`[ProductsStore] Reset pour eventId: ${f(i(this,de))}`),(e=i(this,$r))==null||e.call(this),_(this,$r,null),i(this,ar)&&(i(this,ar).call(this),_(this,ar,null)),i(this,re)&&(i(this,re).close(),_(this,re,null)),i(this,O).clear(),i(this,tt).clear(),m(i(this,Ne),null),m(i(this,de),null),m(i(this,Mr),!1),m(i(this,ra),!1),m(i(this,Js),null),m(i(this,os),!1),m(i(this,cs),!1),m(i(this,Ve),null),_(this,Ks,""),this.dateStore.reset(),m(i(this,q),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0),console.log("[ProductsStore] Reset terminÃ©")}async createPurchaseLocal(e,r,s){const n=i(this,O).get(e);if(!n)throw new Error(`Produit ${e} introuvable`);const a=s.status||"delivered";let o=s.deliveryDate||null;a==="delivered"&&!o&&(o=new Date().toISOString());const c={$id:crypto.randomUUID(),$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$databaseId:"localDemo",$tableId:"localDemo",$permissions:[],$sequence:0,invoiceId:s.invoiceId||null,notes:s.notes||"",store:s.store||null,mainId:f(i(this,de)),unit:r[0]?.u||"",quantity:r.reduce((d,h)=>d+h.q,0),price:s.price||null,status:a,who:s.who||null,createdBy:"guest",orderDate:s.orderDate||new Date().toISOString(),deliveryDate:o,invoiceTotal:null,products:[e]},l=Ss(n.data),u={...l,purchases:[...l.purchases||[],c],$updatedAt:new Date().toISOString()};i(this,re)&&await i(this,re).upsertProduct(u),n.update(u),console.log(`[ProductsStore] Mode local: purchase crÃ©Ã© pour ${e}`)}async createProductLocal(e){const r=crypto.randomUUID(),s={$id:r,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],productHugoUuid:null,productName:e.productName,productType:e.productType||"ingredient",pF:e.pF??!1,pS:e.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:!1,mainId:f(i(this,de)),totalNeededRaw:[],status:e.status||"ok",who:e.who||null,store:e.store||"",stockReel:e.stockReel||null,previousNames:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,isLocal:!0,mergedInto:null,totalNeededOverride:null,updatedBy:null,specs:null,purchases:[],pL:null,byDate:{},storeInfo:null,totalNeededOverrideParsed:null,displayMissingQuantity:null,missingQuantityArray:null},n=new bs(s,this.dateStore);return i(this,O).set(r,n),i(this,re)&&await i(this,re).upsertProduct(s),console.log(`[ProductsStore] Mode local: produit crÃ©Ã© ${r}`),r}async updateProductLocal(e,r){const s=i(this,O).get(e);if(!s)throw new Error(`Produit ${e} introuvable`);const n={...s.data,...r,$updatedAt:new Date().toISOString()};if(s.update(n),i(this,re)){const a=Ss(s.data);await i(this,re).upsertProduct(a)}console.log(`[ProductsStore] Mode local: produit mis Ã  jour ${e}`)}async addPurchaseToLocal(e,r,s){return await this.createPurchaseLocal(e,r,s)}async updatePurchaseLocal(e,r){let s=null;for(const[o,c]of i(this,O))if(c.data.purchases?.some(l=>l.$id===e)){s=o;break}if(!s)throw new Error(`Purchase ${e} introuvable`);const a=i(this,O).get(s).data.purchases.map(o=>o.$id===e?{...o,...r,$updatedAt:new Date().toISOString()}:o);await this.updateProductLocal(s,{purchases:a})}async deletePurchaseLocal(e){let r=null;for(const[a,o]of i(this,O))if(o.data.purchases?.some(c=>c.$id===e)){r=a;break}if(!r)throw new Error(`Purchase ${e} introuvable`);const n=i(this,O).get(r).data.purchases.filter(a=>a.$id!==e);await this.updateProductLocal(r,{purchases:n})}async createPurchase(e,r,s){if(ae(f(i(this,de))))return await this.createPurchaseLocal(e,r,s);{const{createQuickValidationPurchases:n}=await J(async()=>{const{createQuickValidationPurchases:a}=await Promise.resolve().then(()=>Vr);return{createQuickValidationPurchases:a}},void 0);await n(f(i(this,Ne)),e,r,s)}}async updatePurchase(e,r){if(ae(f(i(this,de))))return await this.updatePurchaseLocal(e,r);{const{updatePurchase:s}=await J(async()=>{const{updatePurchase:n}=await Promise.resolve().then(()=>Vr);return{updatePurchase:n}},void 0);await s(e,r)}}async deletePurchase(e){if(ae(f(i(this,de))))return await this.deletePurchaseLocal(e);{const{deletePurchase:r}=await J(async()=>{const{deletePurchase:s}=await Promise.resolve().then(()=>Vr);return{deletePurchase:s}},void 0);await r(e)}}async createProduct(e){if(ae(f(i(this,de))))return await this.createProductLocal(e);{const{upsertProduct:r}=await J(async()=>{const{upsertProduct:n}=await Promise.resolve().then(()=>Vr);return{upsertProduct:n}},void 0);return(await r(crypto.randomUUID(),e,n=>this.getEnrichedProductById(n))).$id}}async updateProduct(e,r){if(ae(f(i(this,de))))return await this.updateProductLocal(e,r);{const{updateProduct:s}=await J(async()=>{const{updateProduct:n}=await Promise.resolve().then(()=>Vr);return{updateProduct:n}},void 0);await s(e,r)}}async updateProductBatch(e,r,s){if(ae(f(i(this,de))))for(const[n,a]of Object.entries(r))await this.updateProductLocal(e,{[n]:a});else{const{updateProductBatch:n}=await J(async()=>{const{updateProductBatch:a}=await Promise.resolve().then(()=>Vr);return{updateProductBatch:a}},void 0);await n(e,r,s||(a=>this.getEnrichedProductById(a)))}}async batchUpdateProducts(e,r,s,n){if(ae(f(i(this,de))))return await b(this,j,Nd).call(this,e,s,n);{const{batchUpdateProductsOptimized:a}=await J(async()=>{const{batchUpdateProductsOptimized:o}=await Promise.resolve().then(()=>Vr);return{batchUpdateProductsOptimized:o}},void 0);return await a(e,r,s,n)}}async createGroupPurchase(e,r){if(ae(f(i(this,de))))return await b(this,j,Ld).call(this,e,r);{const{createGroupPurchaseWithSync:s}=await J(async()=>{const{createGroupPurchaseWithSync:n}=await Promise.resolve().then(()=>Ug);return{createGroupPurchaseWithSync:n}},void 0);return await s(f(i(this,Ne)),e,r)}}destroy(){var e;(e=i(this,$r))==null||e.call(this),_(this,$r,null),i(this,re)&&(i(this,re).close(),_(this,re,null)),console.log("[ProductsStore] Ressources nettoyÃ©es")}get completionStats(){return f(i(this,da))}set completionStats(e){m(i(this,da),e)}get financialStats(){return f(i(this,fa))}set financialStats(e){m(i(this,fa),e)}}O=new WeakMap,tt=new WeakMap,Ne=new WeakMap,de=new WeakMap,Mr=new WeakMap,ra=new WeakMap,Js=new WeakMap,os=new WeakMap,cs=new WeakMap,Ve=new WeakMap,re=new WeakMap,$r=new WeakMap,sa=new WeakMap,q=new WeakMap,na=new WeakMap,aa=new WeakMap,ia=new WeakMap,oa=new WeakMap,ca=new WeakMap,Ii=new WeakMap,la=new WeakMap,ua=new WeakMap,Ai=new WeakMap,j=new WeakSet,Id=async function(e){if(!f(i(this,Mr))){console.warn("[ProductsStore] Sync ignorÃ© car store non initialisÃ©");return}const r=JSON.stringify(e.meals);if(i(this,Ks)===r)return;console.log(`[ProductsStore] â¡ï¸ CHANGEMENT REPAS DÃTECTÃ pour ${e.$id} (Hash: ${r.substring(0,10)}...), recalcul...`),_(this,Ks,r);const n=await ll(e,async o=>await li.getRecipeByUuid(o),e.$id);n.forEach(o=>{const c=i(this,O).get(o.$id);if(c){const u={...c.data,byDate:o.byDate,totalNeededArray:o.totalNeededArray,totalNeededRaw:o.totalNeededRaw,nbRecipes:o.nbRecipes,totalAssiettes:o.totalAssiettes};sg(u),c.update(u)}else i(this,O).set(o.$id,new bs(o,this.dateStore))});const a=new Set(n.map(o=>o.$id));for(const[o,c]of i(this,O))a.has(o)||!c.data.isSynced&&!c.data.purchases?.length&&i(this,O).delete(o);this.dateStore.setAvailableDates([...e.allDates||[]]),b(this,j,Ja).call(this)},Ks=new WeakMap,ar=new WeakMap,Ad=async function(e){const s=await ll(e,async n=>await li.getRecipeByUuid(n),e.$id);s.forEach(n=>{i(this,O).set(n.$id,new bs(n,this.dateStore))}),console.log(`[ProductsStore] ${s.length} produits calculÃ©s depuis ${e.meals.length} repas`)},_d=async function(){if(i(this,re))try{const e=await i(this,re).loadProducts();e.forEach((s,n)=>{s.status==="isSyncing"&&(s.status="active"),i(this,O).set(n,new bs(s,this.dateStore))});const r=await i(this,re).loadMetadata();m(i(this,Ve),r.lastSync,!0),this.dateStore.setAvailableDates([...r.allDates]),console.log(`[ProductsStore] ${e.size} produits chargÃ©s du cache IDB, lastSync: ${r.lastSync}`)}catch(e){console.warn("[ProductsStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Ja=async function(){if(i(this,re))try{const e=new Map;i(this,O).forEach((r,s)=>{const n=Ss(r.data);n.status==="isSyncing"&&(n.status="active"),e.set(s,n)}),await i(this,re).saveProducts(e),await i(this,re).saveMetadata({lastSync:f(i(this,Ve)),allDates:[...this.dateStore.dates]}),console.log("[ProductsStore] Cache IDB persistÃ©")}catch(e){console.error("[ProductsStore] Erreur persist cache IDB:",e)}},Ka=async function(e){if(!(!i(this,re)||e.length===0))try{const r=e.map(s=>i(this,O).get(s)?.data).filter(s=>s!=null).map(s=>{const n=Ss(s);return n.status==="isSyncing"&&(n.status="active"),i(this,re).upsertProduct(n)});r.length>0&&(await Promise.all(r),console.log(`[ProductsStore] ${r.length} produits affectÃ©s persistÃ©s`))}catch(r){console.error("[ProductsStore] Erreur persistence produits affectÃ©s:",r)}},Rd=function(){m(i(this,Ve),new Date().toISOString(),!0)},po=function(e,r){return r?qa(e,r):rg(e)},Ag=function(e){e.length&&(e.forEach(r=>b(this,j,Ya).call(this,r)),console.log(`[ProductsStore] ${e.length} produits upserted`))},Ya=function(e){const r=i(this,O).get(e.$id),s=b(this,j,po).call(this,e,r?.data);r?r.update(s):(this.dateStore.dates,i(this,O).set(e.$id,new bs(s,this.dateStore)))},Pd=function(e){i(this,O).delete(e)},Dd=async function(e){if(!e.products?.length)return console.warn("[ProductsStore] Purchase crÃ©Ã© sans products:",e.$id),[];const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return b(this,j,kd).call(this,r,e),r},Md=async function(e){if(e.products?.length){const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return b(this,j,Xa).call(this,r,e),r}console.log("[ProductsStore] Purchase update sans products[], rechargement...");try{const[r]=await Ed([e.$id]);if(r?.products?.length){const s=r.products.map(n=>typeof n=="string"?n:n.$id).filter(Boolean);return b(this,j,Xa).call(this,s,r),s}return[]}catch(r){return console.error("[ProductsStore] Erreur rechargement purchase:",r),[]}},$d=async function(e){const r=Array.from(i(this,O).values()).map(s=>s.data).filter(s=>s.purchases?.some(n=>n.$id===e));return r.forEach(s=>{b(this,j,Ya).call(this,s)}),r.map(s=>s.$id)},kd=function(e,r){const s=Dc(r),n=[];e.forEach(a=>{const o=i(this,O).get(a);if(o){const c=o.data,l=c.purchases||[];if(!l.some(u=>u.$id===s.$id)){const u=qa({...c,purchases:[...l,s],status:"active"},c);n.push(u)}}}),n.forEach(a=>{const o=i(this,O).get(a.$id);o&&o.update(a)})},Xa=function(e,r){const s=Dc(r),n=[];e.forEach(a=>{const o=i(this,O).get(a);if(o){const c=o.data,l=c.purchases||[],u=l.findIndex(d=>d.$id===s.$id);if(u>=0){const d=[...l];d[u]=s;const h=qa({...c,purchases:d,status:"active"},c);n.push(h)}else{const d=qa({...c,purchases:[...l,r],status:"active"},c);n.push(d)}}}),n.forEach(a=>{const o=i(this,O).get(a.$id);o&&o.update(a)})},mo=function(e){if(b(this,j,Ya).call(this,e),i(this,re)){const r=i(this,O).get(e.$id);r&&i(this,re).upsertProduct(Ss(r.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},Cd=function(){return{onProductCreate:e=>b(this,j,mo).call(this,e),onProductUpdate:e=>b(this,j,mo).call(this,e),onProductDelete:e=>{b(this,j,Pd).call(this,e),i(this,re)&&i(this,re).deleteProduct(e).catch(r=>console.error("[ProductsStore] Erreur suppression produit:",r))},onPurchaseCreate:async e=>{if(e.status==="expense"){i(this,tt).set(e.$id,e);return}const r=await b(this,j,Dd).call(this,e);await b(this,j,Ka).call(this,r)},onPurchaseUpdate:async e=>{if(e.status==="expense"){i(this,tt).set(e.$id,e);return}i(this,tt).has(e.$id)&&i(this,tt).delete(e.$id);const r=await b(this,j,Md).call(this,e);await b(this,j,Ka).call(this,r)},onPurchaseDelete:async e=>{if(i(this,tt).has(e)){i(this,tt).delete(e);return}const r=await b(this,j,$d).call(this,e);await b(this,j,Ka).call(this,r)},onConnect:()=>{m(i(this,cs),!0)},onDisconnect:()=>{m(i(this,cs),!1)},onError:e=>{console.error("[ProductsStore] Erreur realtime:",e)}}},Td=function(){if(ae(f(i(this,de)))){console.log("[ProductsStore] Mode local: skip realtime setup");return}const e=b(this,j,Cd).call(this);_(this,$r,Sg(e))},Nd=async function(e,r,s){try{let n=0;for(const a of e){if(r==="who"){const o=s.names||[];await this.updateProductLocal(a,{who:o})}else if(r==="store"){const o=s;await this.updateProductLocal(a,{storeInfo:o})}n++}return{success:!0,updatedCount:n,updateType:r,timestamp:new Date().toISOString()}}catch(n){return{success:!1,updatedCount:0,updateType:r,error:n instanceof Error?n.message:"Erreur inconnue",timestamp:new Date().toISOString()}}},Ld=async function(e,r){try{if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};let s=0;for(const n of e)await this.createPurchaseLocal(n.productId,n.missingQuantities,{invoiceId:r.invoiceId,notes:r.notes,store:r.store}),s++;return{success:!0,results:[],totalProductsCreated:e.length,totalPurchasesCreated:s,totalExpensesCreated:0}}catch(s){return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:s instanceof Error?s.message:"Erreur inconnue"}}},jd=async function(){if(ae(f(i(this,de)))){console.log("[ProductsStore] Mode local: skip loadOrphanPurchases");return}if(f(i(this,Ne)))try{const e=await Sd(f(i(this,Ne)));e.forEach(r=>{i(this,tt).set(r.$id,r)}),console.log(`[ProductsStore] ${e.length} dÃ©penses globales chargÃ©es`)}catch(e){console.error("[ProductsStore] Erreur chargement dÃ©penses globales:",e)}},da=new WeakMap,fa=new WeakMap;const qd=new Ig,{APPWRITE_CONFIG:Li}=ms();async function _g(t,e){return Gt(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:Li.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,teamId:e}),async:!1}),n=Ia(s.responseBody,{context:"removeTeamFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de la team");console.log(`[appwrite-functions] Team ${e} retirÃ©e de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeTeamFromEvent",timeout:6e4,errorMessage:"Erreur lors du retrait de la team"})}async function Rg(t){return Gt(async()=>{const{functions:e}=await D(),r=await e.createExecution({functionId:Li.functions.usersTeamsManager,body:JSON.stringify({action:"checkEmails",emails:t}),async:!1}),s=Ia(r.responseBody,{context:"checkUserEmails",fallback:null});if(!s||!s.success)throw new Error(s?.error||"Erreur lors de la vÃ©rification des emails");return s.data},{context:"AppwriteFunctions.checkUserEmails",timeout:15e3,errorMessage:"Erreur lors de la vÃ©rification des emails"})}async function Pg(t,e,r){const{teamIds:s=[],emails:n=[],userIds:a=[],message:o,sendEmailToExistingMembers:c=!0}=r;return Gt(async()=>{const{functions:l}=await D(),u=await l.createExecution({functionId:Li.functions.usersTeamsManager,body:JSON.stringify({action:"invite",context:{type:"event",id:t,name:e},teamIds:s,emails:n,userIds:a,message:o,sendEmailToExistingMembers:c}),async:!1}),d=Ia(u.responseBody,{context:"inviteParticipantsToEvent",fallback:null});if(!d||!d.success)throw new Error(d?.error||"Erreur lors de l'invitation");return console.log(`[appwrite-functions] ${d.processed} invitations traitÃ©es pour ${e}`),d},{context:"AppwriteFunctions.inviteParticipantsToEvent",timeout:6e4,errorMessage:"Erreur lors de l'invitation"})}async function Dg(t,e){return Gt(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:Li.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,userId:e}),async:!1}),n=Ia(s.responseBody,{context:"removeUserFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de l'utilisateur");console.log(`[appwrite-functions] Utilisateur ${e} retirÃ© de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeUserFromEvent",timeout:1e4,errorMessage:"Erreur lors du retrait de l'utilisateur"})}const Ji=Object.freeze(Object.defineProperty({__proto__:null,checkUserEmails:Rg,inviteParticipantsToEvent:Pg,removeTeamFromEvent:_g,removeUserFromEvent:Dg},Symbol.toStringTag,{value:"Module"})),Mg=ms().APPWRITE_CONFIG;async function Uy(t,e,r){try{const{functions:s}=await D(),n=await s.createExecution({functionId:Mg.functions.usersTeamsManager,body:JSON.stringify({action:"exchange-invite",userId:t,eventId:e,teamId:r})}),a=JSON.parse(n.responseBody);if(!a.success)throw new Error(a.error||"L'invitation est invalide.");return{token:a.token,userId:a.userId}}catch(s){throw console.error("[invitations] Error validating invitation:",s),s}}var $g=(t=>(t.ENTREE="entree",t.PLAT="plat",t.DESSERT="dessert",t.AUTRE="autre",t))($g||{}),kg=(t=>(t.PUBLIC="public",t.PRIVATE="private",t.DELETED="deleted",t))(kg||{});const Cg=7,Oy={async getLock(t){const{tables:e}=await D();try{const r=await e.getRow({databaseId:lt(),tableId:yr("locks"),rowId:t});return!r.userId||new Date(r.expiresAt)<new Date?null:r}catch(r){if(r.code===404)return null;throw r}},async acquireLock(t,e,r){const{tables:s}=await D(),n=new Date(Date.now()+Cg*60*1e3).toISOString(),a={userId:e,userName:r,expiresAt:n},o=[te.read(ie.any()),te.update(ie.user(e))];try{return await s.updateRow({databaseId:lt(),tableId:yr("locks"),rowId:t,data:a,permissions:o}),!0}catch(c){if(c.code===404)try{return await s.createRow({databaseId:lt(),tableId:yr("locks"),rowId:t,data:a,permissions:o}),!0}catch(l){return console.error("[locksService] Erreur crÃ©ation verrou:",l),!1}return console.warn("[locksService] Acquisition refusÃ©e (peut-Ãªtre dÃ©jÃ  verrouillÃ©):",c.message),!1}},async releaseLock(t,e){const{tables:r}=await D();try{await r.updateRow({databaseId:lt(),tableId:yr("locks"),rowId:t,data:{userId:"",userName:"",expiresAt:new Date(0).toISOString()},permissions:[te.read(ie.any()),te.update(ie.any())]}),console.log(`[locksService] Verrou libÃ©rÃ© (rÃ©initialisÃ©) pour ${t}`)}catch(s){if(s.code===404){console.log(`[locksService] Verrou dÃ©jÃ  libÃ©rÃ© pour ${t}`);return}console.warn("[locksService] Impossible de libÃ©rer le verrou sur le serveur:",s.message)}},subscribeToLock(t,e){const r=lt(),s=yr("locks"),n=`databases.${r}.collections.${s}.documents.${t}`;return console.log("[locksService] Enregistrement du channel de lock:",n),Ht.registerDynamic([n],a=>{if(a.events?.some(c=>c.endsWith(".delete"))){e(null);return}if(!a.payload)return;const o=a.payload;!o.userId||new Date(o.expiresAt)<new Date?e(null):e(o)})}};function Tg(t,e){const r=t.reduce((n,a)=>n+a.missingQuantities.length,0),s=e.invoiceTotal?1:0;return r+s}async function Ng(t,e,r){let s=null;try{const{account:c}=await D();s=(await c.get()).$id}catch(c){console.warn("[Appwrite Transaction] Impossible de rÃ©cupÃ©rer l'utilisateur connectÃ©:",c)}const n=e.purchaseStatus||"delivered";let a=e.purchaseDeliveryDate||null;n==="delivered"&&!a&&(a=new Date().toISOString());const o=t.flatMap(c=>c.missingQuantities.map(l=>({productId:c.productId,quantity:l.q,unit:l.u,status:n,notes:e.notes||"",store:e.store||"",who:e.who||void 0,price:void 0,orderDate:null,deliveryDate:a,createdBy:s})));return{mainId:r,purchasesData:o,invoiceData:e,fromUserId:s||""}}function Lg(t,e,r=98){const s=[];let n=[],a=0;const o=!!e.invoiceTotal;let c=!1;for(const l of t){const u=l.missingQuantities.length;let d=a+u>r;o&&!c&&n.length>0&&(d=a+u+1>r),d&&n.length>0?(s.push(n),n=[l],a=u,c=!1):(n.push(l),a+=u)}return n.length>0&&s.push(n),s}async function jg(t){try{const e=ms(),{functions:r}=await D(),s={operation:"createGroupPurchaseWithSync",data:t};console.log(`[Appwrite Interactions] ExÃ©cution du lot: ${t.purchasesData.length} achats Ã  crÃ©er`);const n=await r.createExecution(e.APPWRITE_CONFIG.functions.batchUpdate,JSON.stringify(s),!1,"/","POST");if(n.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${n.status}.`);const a=JSON.parse(n.responseBody);return a.success?console.log(`[Appwrite Interactions] Lot exÃ©cutÃ© avec succÃ¨s: ${a.purchasesCreated} achats crÃ©Ã©s`):console.error("[Appwrite Interactions] Lot Ã©chouÃ©:",a.error),a}catch(e){console.error("[Appwrite Interactions] Erreur exÃ©cution lot:",e);const r=e instanceof Error?e.message:"Erreur inconnue";return{success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:t.invoiceData.invoiceId,error:r,timestamp:new Date().toISOString()}}}async function qg(t,e,r){if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};const s=Tg(e,r);console.log(`[Appwrite Interactions] Achat groupÃ©: ${e.length} produits, ${s} achats Ã  crÃ©er`);const n=Lg(e,r,98);console.log(`[Appwrite Interactions] DÃ©coupage en ${n.length} lot(s) pour respecter la limite de 100 achats par lot`);const a=[];let o=0,c=0,l=0;for(let h=0;h<n.length;h++){const p=n[h];console.log(`[Appwrite Interactions] ExÃ©cution du lot ${h+1}/${n.length} (${p.length} produits)`);try{const g=await Ng(p,r,t),w=await pd(()=>jg(g),{operationName:`Lot ${h+1}/${n.length}`,maxAutoRetries:1,autoRetryDelay:2e3});if(!w)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives");if(a.push(w),w.success)o+=w.productsCreated,c+=w.purchasesCreated,l+=w.expenseCreated?1:0;else{console.error(`[Appwrite Interactions] Erreur sur le lot ${h+1}: ${w.error}`);break}}catch(g){const w=g instanceof Error?g.message:"Erreur inconnue";console.error(`[Appwrite Interactions] Erreur lors de l'exÃ©cution du lot ${h+1}:`,g),a.push({success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:r.invoiceId,error:w,timestamp:new Date().toISOString()});break}}const u=a.every(h=>h.success),d=a.some(h=>!h.success);return{success:u,results:a,totalProductsCreated:o,totalPurchasesCreated:c,totalExpensesCreated:l,error:d?"Un ou plusieurs lots ont Ã©chouÃ©":void 0}}const Ug=Object.freeze(Object.defineProperty({__proto__:null,createGroupPurchaseWithSync:qg},Symbol.toStringTag,{value:"Module"}));export{tl as $,m as A,lh as B,Ph as C,uo as D,Qm as E,gt as F,Rf as G,Lm as H,T as I,qr as J,hh as K,Gm as L,ai as M,li as N,Qe as O,iy as P,Rp as Q,gy as R,Kg as S,hy as T,Zg as U,D as V,Mh as W,jh as X,Ey as Y,Rm as Z,Ye as _,dy as a,dg as a$,rl as a0,Ht as a1,Jm as a2,qd as a3,Km as a4,Fg as a5,Dh as a6,Nu as a7,J as a8,Py as a9,Co as aA,kg as aB,_c as aC,qy as aD,ft as aE,Ss as aF,ae as aG,Oy as aH,Sh as aI,xm as aJ,Iy as aK,sy as aL,Jg as aM,fy as aN,lg as aO,Ay as aP,Fh as aQ,Jr as aR,ep as aS,Au as aT,_y as aU,ut as aV,ap as aW,Ru as aX,Ny as aY,ip as aZ,Sy as a_,Ah as aa,yh as ab,Vg as ac,ly as ad,Uy as ae,Qg as af,cy as ag,ey as ah,pr as ai,py as aj,Ap as ak,my as al,uy as am,ay as an,Cy as ao,$y as ap,No as aq,ky as ar,Ty as as,_p as at,Dy as au,Ry as av,jy as aw,Ly as ax,Fm as ay,$g as az,hc as b,mg as b0,zf as b1,yy as b2,Hg as b3,My as b4,Ji as b5,Eo as c,bo as d,ry as e,Xg as f,Gg as g,Wg as h,ty as i,fc as j,oc as k,oy as l,f as m,cn as n,_f as o,by as p,vy as q,wy as r,ny as s,Bg as t,z as u,Yg as v,Kf as w,zg as x,P as y,ge as z};
