var Fu=Object.defineProperty;var ed=Object.getPrototypeOf;var td=Reflect.get;var $o=t=>{throw TypeError(t)};var rd=(t,e,r)=>e in t?Fu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var C=(t,e,r)=>rd(t,typeof e!="symbol"?e+"":e,r),Ai=(t,e,r)=>e.has(t)||$o("Cannot "+r);var i=(t,e,r)=>(Ai(t,e,"read from private field"),r?r.call(t):e.get(t)),y=(t,e,r)=>e.has(t)?$o("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),I=(t,e,r,s)=>(Ai(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),v=(t,e,r)=>(Ai(t,e,"access private method"),r);var Co=(t,e,r)=>td(ed(t),r,e);var hi=Array.isArray,sd=Array.prototype.indexOf,pi=Array.from,nd=Object.defineProperty,Dr=Object.getOwnPropertyDescriptor,Nc=Object.getOwnPropertyDescriptors,Tc=Object.prototype,ad=Array.prototype,gi=Object.getPrototypeOf,ko=Object.isExtensible;function ps(t){return typeof t=="function"}const zs=()=>{};function id(t){return t()}function Li(t){for(var e=0;e<t.length;e++)t[e]()}function Lc(){var t,e,r=new Promise((s,n)=>{t=s,e=n});return{promise:r,resolve:t,reject:e}}function Mg(t,e,r=!1){return t===void 0?r?e():e:t}function $g(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const r=[];for(const s of t)if(r.push(s),r.length===e)break;return r}const Ie=2,Oa=4,na=8,zi=1<<24,Ot=16,or=32,Lr=64,Fi=128,ot=512,De=1024,Ge=2048,cr=4096,Fe=8192,sr=16384,aa=32768,jt=65536,No=1<<17,jc=1<<18,os=1<<19,qc=1<<20,rr=1<<25,ns=32768,ji=1<<21,eo=1<<22,Mr=1<<23,Lt=Symbol("$state"),Uc=Symbol("legacy props"),od=Symbol(""),ys=new class extends Error{constructor(){super(...arguments);C(this,"name","StaleReactionError");C(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},cd=1,mi=3,Vs=8;function Bc(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ld(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ud(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function dd(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function fd(t){throw new Error("https://svelte.dev/e/effect_orphan")}function hd(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function pd(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function gd(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function md(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function yd(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function wd(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const vd=1,bd=2,Oc=4,Ed=8,Sd=16,Id=1,Ad=2,_d=4,Rd=8,Pd=16,Dd=1,Md=2,$d=4,Cd=1,kd=2,Nd="[",yi="[!",to="]",ia={},ve=Symbol(),Td="http://www.w3.org/1999/xhtml",Ld="http://www.w3.org/2000/svg",jd="@attach";function oa(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function qd(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ud(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let N=!1;function vt(t){N=t}let K;function be(t){if(t===null)throw oa(),ia;return K=t}function qt(){return be(xt(K))}function Bd(t){if(N){if(xt(K)!==null)throw oa(),ia;K=t}}function Od(t=1){if(N){for(var e=t,r=K;e--;)r=xt(r);K=r}}function xa(t=!0){for(var e=0,r=K;;){if(r.nodeType===Vs){var s=r.data;if(s===to){if(e===0)return r;e-=1}else(s===Nd||s===yi)&&(e+=1)}var n=xt(r);t&&r.remove(),r=n}}function xc(t){if(!t||t.nodeType!==Vs)throw oa(),ia;return t.data}function Hc(t){return t===this.v}function xd(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Wc(t){return!xd(t,this.v)}let Qs=!1;function kg(){Qs=!0}const Hd=[];function Fs(t,e=!1,r=!1){return Da(t,new Map,"",Hd,null,r)}function Da(t,e,r,s,n=null,a=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(hi(t)){var c=Array(t.length);e.set(t,c),n!==null&&e.set(n,c);for(var l=0;l<t.length;l+=1){var u=t[l];l in t&&(c[l]=Da(u,e,r,s,null,a))}return c}if(gi(t)===Tc){c={},e.set(t,c),n!==null&&e.set(n,c);for(var d in t)c[d]=Da(t[d],e,r,s,null,a);return c}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!a)return Da(t.toJSON(),e,r,s,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let fe=null;function xs(t){fe=t}function Wd(t,e=!1,r){fe={p:fe,i:!1,c:null,e:null,s:t,x:null,l:Qs&&!e?{s:null,u:null,$:[]}:null}}function Gd(t){var e=fe,r=e.e;if(r!==null){e.e=null;for(var s of r)pl(s)}return t!==void 0&&(e.x=t),e.i=!0,fe=e.p,t??{}}function Js(){return!Qs||fe!==null&&fe.l===null}let Br=[];function Gc(){var t=Br;Br=[],Li(t)}function Et(t){if(Br.length===0&&!cn){var e=Br;queueMicrotask(()=>{e===Br&&Gc()})}Br.push(t)}function Vd(){for(;Br.length>0;)Gc()}function Vc(t){var e=Y;if(e===null)return J.f|=Mr,t;if((e.f&aa)===0){if((e.f&Fi)===0)throw t;e.b.error(t)}else Hs(t,e)}function Hs(t,e){for(;e!==null;){if((e.f&Fi)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const Qd=-7169;function Se(t,e){t.f=t.f&Qd|e}function ro(t){(t.f&ot)!==0||t.deps===null?Se(t,De):Se(t,cr)}function Qc(t){if(t!==null)for(const e of t)(e.f&Ie)===0||(e.f&ns)===0||(e.f^=ns,Qc(e.deps))}function Jc(t,e,r){(t.f&Ge)!==0?e.add(t):(t.f&cr)!==0&&r.add(t),Qc(t.deps),Se(t,De)}const ba=new Set;let F=null,on=null,mt=null,nt=[],wi=null,qi=!1,cn=!1;var vs,bs,Hr,Wr,hn,Es,Ss,ut,Ui,Bi,Kc,Yc;const Za=class Za{constructor(){y(this,ut);C(this,"committed",!1);C(this,"current",new Map);C(this,"previous",new Map);y(this,vs,new Set);y(this,bs,new Set);y(this,Hr,0);y(this,Wr,0);y(this,hn,null);y(this,Es,new Set);y(this,Ss,new Set);C(this,"skipped_effects",new Set);C(this,"is_fork",!1)}is_deferred(){return this.is_fork||i(this,Wr)>0}process(e){nt=[],on=null,this.apply();var r=[],s=[];for(const n of e)v(this,ut,Ui).call(this,n,r,s);this.is_fork||v(this,ut,Kc).call(this),this.is_deferred()?(v(this,ut,Bi).call(this,s),v(this,ut,Bi).call(this,r)):(on=this,F=null,To(s),To(r),on=null,i(this,hn)?.resolve()),mt=null}capture(e,r){r!==ve&&!this.previous.has(e)&&this.previous.set(e,r),(e.f&Mr)===0&&(this.current.set(e,e.v),mt?.set(e,e.v))}activate(){F=this,this.apply()}deactivate(){F===this&&(F=null,mt=null)}flush(){if(this.activate(),nt.length>0){if(Xc(),F!==null&&F!==this)return}else i(this,Hr)===0&&this.process([]);this.deactivate()}discard(){for(const e of i(this,bs))e(this);i(this,bs).clear()}increment(e){I(this,Hr,i(this,Hr)+1),e&&I(this,Wr,i(this,Wr)+1)}decrement(e){I(this,Hr,i(this,Hr)-1),e&&I(this,Wr,i(this,Wr)-1),this.revive()}revive(){for(const e of i(this,Es))i(this,Ss).delete(e),Se(e,Ge),ar(e);for(const e of i(this,Ss))Se(e,cr),ar(e);this.flush()}oncommit(e){i(this,vs).add(e)}ondiscard(e){i(this,bs).add(e)}settled(){return(i(this,hn)??I(this,hn,Lc())).promise}static ensure(){if(F===null){const e=F=new Za;ba.add(F),cn||Za.enqueue(()=>{F===e&&e.flush()})}return F}static enqueue(e){Et(e)}apply(){}};vs=new WeakMap,bs=new WeakMap,Hr=new WeakMap,Wr=new WeakMap,hn=new WeakMap,Es=new WeakMap,Ss=new WeakMap,ut=new WeakSet,Ui=function(e,r,s){e.f^=De;for(var n=e.first,a=null;n!==null;){var o=n.f,c=(o&(or|Lr))!==0,l=c&&(o&De)!==0,u=l||(o&Fe)!==0||this.skipped_effects.has(n);if(!u&&n.fn!==null){c?n.f^=De:a!==null&&(o&(Oa|na|zi))!==0?a.b.defer_effect(n):(o&Oa)!==0?r.push(n):fa(n)&&((o&Ot)!==0&&i(this,Es).add(n),un(n));var d=n.first;if(d!==null){n=d;continue}}var h=n.parent;for(n=n.next;n===null&&h!==null;)h===a&&(a=null),n=h.next,h=h.parent}},Bi=function(e){for(var r=0;r<e.length;r+=1)Jc(e[r],i(this,Es),i(this,Ss))},Kc=function(){if(i(this,Wr)===0){for(const e of i(this,vs))e();i(this,vs).clear()}i(this,Hr)===0&&v(this,ut,Yc).call(this)},Yc=function(){var n;if(ba.size>1){this.previous.clear();var e=mt,r=!0;for(const a of ba){if(a===this){r=!1;continue}const o=[];for(const[l,u]of this.current){if(a.current.has(l))if(r&&u!==a.current.get(l))a.current.set(l,u);else continue;o.push(l)}if(o.length===0)continue;const c=[...a.current.keys()].filter(l=>!this.current.has(l));if(c.length>0){var s=nt;nt=[];const l=new Set,u=new Map;for(const d of o)Zc(d,c,l,u);if(nt.length>0){F=a,a.apply();for(const d of nt)v(n=a,ut,Ui).call(n,d,[],[]);a.deactivate()}nt=s}}F=null,mt=e}this.committed=!0,ba.delete(this)};let Tt=Za;function Jd(t){var e=cn;cn=!0;try{for(var r;;){if(Vd(),nt.length===0&&(F?.flush(),nt.length===0))return wi=null,r;Xc()}}finally{cn=e}}function Xc(){var t=ss;qi=!0;var e=null;try{var r=0;for(Wa(!0);nt.length>0;){var s=Tt.ensure();if(r++>1e3){var n,a;Kd()}s.process(nt),$r.clear()}}finally{qi=!1,Wa(t),wi=null}}function Kd(){try{hd()}catch(t){Hs(t,wi)}}let Gt=null;function To(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var s=t[r++];if((s.f&(sr|Fe))===0&&fa(s)&&(Gt=new Set,un(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?bl(s):s.fn=null),Gt?.size>0)){$r.clear();for(const n of Gt){if((n.f&(sr|Fe))!==0)continue;const a=[n];let o=n.parent;for(;o!==null;)Gt.has(o)&&(Gt.delete(o),a.push(o)),o=o.parent;for(let c=a.length-1;c>=0;c--){const l=a[c];(l.f&(sr|Fe))===0&&un(l)}}Gt.clear()}}Gt=null}}function Zc(t,e,r,s){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const n of t.reactions){const a=n.f;(a&Ie)!==0?Zc(n,e,r,s):(a&(eo|Ot))!==0&&(a&Ge)===0&&zc(n,e,s)&&(Se(n,Ge),ar(n))}}function zc(t,e,r){const s=r.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const n of t.deps){if(e.includes(n))return!0;if((n.f&Ie)!==0&&zc(n,e,r))return r.set(n,!0),!0}return r.set(t,!1),!1}function ar(t){for(var e=wi=t;e.parent!==null;){e=e.parent;var r=e.f;if(qi&&e===Y&&(r&Ot)!==0&&(r&jc)===0)return;if((r&(Lr|or))!==0){if((r&De)===0)return;e.f^=De}}nt.push(e)}function so(t){let e=0,r=ir(0),s;return()=>{io()&&(f(r),da(()=>(e===0&&(s=lr(()=>t(()=>ze(r)))),e+=1,()=>{Et(()=>{e-=1,e===0&&(s?.(),s=void 0,ze(r))})})))}}var Yd=jt|os|Fi;function Xd(t,e,r){new Zd(t,e,r)}var Qe,pn,It,Gr,At,st,Te,_t,Qt,hr,Vr,Jt,Qr,Is,As,pr,za,me,Fc,el,Oi,Ma,$a,xi;class Zd{constructor(e,r,s){y(this,me);C(this,"parent");C(this,"is_pending",!1);y(this,Qe);y(this,pn,N?K:null);y(this,It);y(this,Gr);y(this,At);y(this,st,null);y(this,Te,null);y(this,_t,null);y(this,Qt,null);y(this,hr,null);y(this,Vr,0);y(this,Jt,0);y(this,Qr,!1);y(this,Is,new Set);y(this,As,new Set);y(this,pr,null);y(this,za,so(()=>(I(this,pr,ir(i(this,Vr))),()=>{I(this,pr,null)})));I(this,Qe,e),I(this,It,r),I(this,Gr,s),this.parent=Y.b,this.is_pending=!!i(this,It).pending,I(this,At,cs(()=>{if(Y.b=this,N){const a=i(this,pn);qt(),a.nodeType===Vs&&a.data===yi?v(this,me,el).call(this):(v(this,me,Fc).call(this),i(this,Jt)===0&&(this.is_pending=!1))}else{var n=v(this,me,Oi).call(this);try{I(this,st,Oe(()=>s(n)))}catch(a){this.error(a)}i(this,Jt)>0?v(this,me,$a).call(this):this.is_pending=!1}return()=>{i(this,hr)?.remove()}},Yd)),N&&I(this,Qe,K)}defer_effect(e){Jc(e,i(this,Is),i(this,As))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!i(this,It).pending}update_pending_count(e){v(this,me,xi).call(this,e),I(this,Vr,i(this,Vr)+e),i(this,pr)&&Ws(i(this,pr),i(this,Vr))}get_effect_pending(){return i(this,za).call(this),f(i(this,pr))}error(e){var r=i(this,It).onerror;let s=i(this,It).failed;if(i(this,Qr)||!r&&!s)throw e;i(this,st)&&(Ee(i(this,st)),I(this,st,null)),i(this,Te)&&(Ee(i(this,Te)),I(this,Te,null)),i(this,_t)&&(Ee(i(this,_t)),I(this,_t,null)),N&&(be(i(this,pn)),Od(),be(xa()));var n=!1,a=!1;const o=()=>{if(n){Ud();return}n=!0,a&&wd(),Tt.ensure(),I(this,Vr,0),i(this,_t)!==null&&rs(i(this,_t),()=>{I(this,_t,null)}),this.is_pending=this.has_pending_snippet(),I(this,st,v(this,me,Ma).call(this,()=>(I(this,Qr,!1),Oe(()=>i(this,Gr).call(this,i(this,Qe)))))),i(this,Jt)>0?v(this,me,$a).call(this):this.is_pending=!1};var c=J;try{We(null),a=!0,r?.(e,o),a=!1}catch(l){Hs(l,i(this,At)&&i(this,At).parent)}finally{We(c)}s&&Et(()=>{I(this,_t,v(this,me,Ma).call(this,()=>{Tt.ensure(),I(this,Qr,!0);try{return Oe(()=>{s(i(this,Qe),()=>e,()=>o)})}catch(l){return Hs(l,i(this,At).parent),null}finally{I(this,Qr,!1)}}))})}}Qe=new WeakMap,pn=new WeakMap,It=new WeakMap,Gr=new WeakMap,At=new WeakMap,st=new WeakMap,Te=new WeakMap,_t=new WeakMap,Qt=new WeakMap,hr=new WeakMap,Vr=new WeakMap,Jt=new WeakMap,Qr=new WeakMap,Is=new WeakMap,As=new WeakMap,pr=new WeakMap,za=new WeakMap,me=new WeakSet,Fc=function(){try{I(this,st,Oe(()=>i(this,Gr).call(this,i(this,Qe))))}catch(e){this.error(e)}},el=function(){const e=i(this,It).pending;e&&(I(this,Te,Oe(()=>e(i(this,Qe)))),Tt.enqueue(()=>{var r=v(this,me,Oi).call(this);I(this,st,v(this,me,Ma).call(this,()=>(Tt.ensure(),Oe(()=>i(this,Gr).call(this,r))))),i(this,Jt)>0?v(this,me,$a).call(this):(rs(i(this,Te),()=>{I(this,Te,null)}),this.is_pending=!1)}))},Oi=function(){var e=i(this,Qe);return this.is_pending&&(I(this,hr,Ne()),i(this,Qe).before(i(this,hr)),e=i(this,hr)),e},Ma=function(e){var r=Y,s=J,n=fe;Ut(i(this,At)),We(i(this,At)),xs(i(this,At).ctx);try{return e()}catch(a){return Vc(a),null}finally{Ut(r),We(s),xs(n)}},$a=function(){const e=i(this,It).pending;i(this,st)!==null&&(I(this,Qt,document.createDocumentFragment()),i(this,Qt).append(i(this,hr)),Il(i(this,st),i(this,Qt))),i(this,Te)===null&&I(this,Te,Oe(()=>e(i(this,Qe))))},xi=function(e){var r;if(!this.has_pending_snippet()){this.parent&&v(r=this.parent,me,xi).call(r,e);return}if(I(this,Jt,i(this,Jt)+e),i(this,Jt)===0){this.is_pending=!1;for(const s of i(this,Is))Se(s,Ge),ar(s);for(const s of i(this,As))Se(s,cr),ar(s);i(this,Is).clear(),i(this,As).clear(),i(this,Te)&&rs(i(this,Te),()=>{I(this,Te,null)}),i(this,Qt)&&(i(this,Qe).before(i(this,Qt)),I(this,Qt,null))}};function tl(t,e,r,s){const n=Js()?ca:no;if(r.length===0&&t.length===0){s(e.map(n));return}var a=F,o=Y,c=zd();function l(){Promise.all(r.map(u=>Fd(u))).then(u=>{c();try{s([...e.map(n),...u])}catch(d){(o.f&sr)===0&&Hs(d,o)}a?.deactivate(),Ha()}).catch(u=>{Hs(u,o)})}t.length>0?Promise.all(t).then(()=>{c();try{return l()}finally{a?.deactivate(),Ha()}}):l()}function zd(){var t=Y,e=J,r=fe,s=F;return function(a=!0){Ut(t),We(e),xs(r),a&&s?.activate()}}function Ha(){Ut(null),We(null),xs(null)}function ca(t){var e=Ie|Ge,r=J!==null&&(J.f&Ie)!==0?J:null;return Y!==null&&(Y.f|=os),{ctx:fe,deps:null,effects:null,equals:Hc,f:e,fn:t,reactions:null,rv:0,v:ve,wv:0,parent:r??Y,ac:null}}function Fd(t,e,r){let s=Y;s===null&&ld();var n=s.b,a=void 0,o=ir(ve),c=!J,l=new Map;return uf(()=>{var u=Lc();a=u.promise;try{Promise.resolve(t()).then(u.resolve,u.reject).then(()=>{d===F&&d.committed&&d.deactivate(),Ha()})}catch(m){u.reject(m),Ha()}var d=F;if(c){var h=n.is_rendered();n.update_pending_count(1),d.increment(h),l.get(d)?.reject(ys),l.delete(d),l.set(d,u)}const p=(m,b=void 0)=>{if(d.activate(),b)b!==ys&&(o.f|=Mr,Ws(o,b));else{(o.f&Mr)!==0&&(o.f^=Mr),Ws(o,m);for(const[R,S]of l){if(l.delete(R),R===d)break;S.reject(ys)}}c&&(n.update_pending_count(-1),d.decrement(h))};u.promise.then(p,m=>p(null,m||"unknown"))}),la(()=>{for(const u of l.values())u.reject(ys)}),new Promise(u=>{function d(h){function p(){h===a?u(o):d(a)}h.then(p,p)}d(a)})}function Z(t){const e=ca(t);return Al(e),e}function no(t){const e=ca(t);return e.equals=Wc,e}function rl(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)Ee(e[r])}}function ef(t){for(var e=t.parent;e!==null;){if((e.f&Ie)===0)return(e.f&sr)===0?e:null;e=e.parent}return null}function ao(t){var e,r=Y;Ut(ef(t));try{t.f&=~ns,rl(t),e=Dl(t)}finally{Ut(r)}return e}function sl(t){var e=ao(t);if(!t.equals(e)&&(t.wv=Rl(),(!F?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Se(t,De);return}kr||(mt!==null?(io()||F?.is_fork)&&mt.set(t,e):ro(t))}let Hi=new Set;const $r=new Map;let nl=!1;function ir(t,e){var r={f:0,v:t,reactions:null,equals:Hc,rv:0,wv:0};return r}function P(t,e){const r=ir(t);return Al(r),r}function tf(t,e=!1,r=!0){var n;const s=ir(t);return e||(s.equals=Wc),Qs&&r&&fe!==null&&fe.l!==null&&((n=fe.l).s??(n.s=[])).push(s),s}function g(t,e,r=!1){J!==null&&(!yt||(J.f&No)!==0)&&Js()&&(J.f&(Ie|Ot|eo|No))!==0&&!nr?.includes(t)&&yd();let s=r?ge(e):e;return Ws(t,s)}function Ws(t,e){if(!t.equals(e)){var r=t.v;kr?$r.set(t,e):$r.set(t,r),t.v=e;var s=Tt.ensure();if(s.capture(t,r),(t.f&Ie)!==0){const n=t;(t.f&Ge)!==0&&ao(n),ro(n)}t.wv=Rl(),al(t,Ge),Js()&&Y!==null&&(Y.f&De)!==0&&(Y.f&(or|Lr))===0&&(rt===null?hf([t]):rt.push(t)),!s.is_fork&&Hi.size>0&&!nl&&rf()}return e}function rf(){nl=!1;var t=ss;Wa(!0);const e=Array.from(Hi);try{for(const r of e)(r.f&De)!==0&&Se(r,cr),fa(r)&&un(r)}finally{Wa(t)}Hi.clear()}function Ng(t,e=1){var r=f(t),s=e===1?r++:r--;return g(t,r),s}function ze(t){g(t,t.v+1)}function al(t,e){var r=t.reactions;if(r!==null)for(var s=Js(),n=r.length,a=0;a<n;a++){var o=r[a],c=o.f;if(!(!s&&o===Y)){var l=(c&Ge)===0;if(l&&Se(o,e),(c&Ie)!==0){var u=o;mt?.delete(u),(c&ns)===0&&(c&ot&&(o.f|=ns),al(u,cr))}else l&&((c&Ot)!==0&&Gt!==null&&Gt.add(o),ar(o))}}}function ge(t){if(typeof t!="object"||t===null||Lt in t)return t;const e=gi(t);if(e!==Tc&&e!==ad)return t;var r=new Map,s=hi(t),n=P(0),a=bt,o=c=>{if(bt===a)return c();var l=J,u=bt;We(null),Bo(a);var d=c();return We(l),Bo(u),d};return s&&r.set("length",P(t.length)),new Proxy(t,{defineProperty(c,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&gd();var d=r.get(l);return d===void 0?d=o(()=>{var h=P(u.value);return r.set(l,h),h}):g(d,u.value,!0),!0},deleteProperty(c,l){var u=r.get(l);if(u===void 0){if(l in c){const d=o(()=>P(ve));r.set(l,d),ze(n)}}else g(u,ve),ze(n);return!0},get(c,l,u){if(l===Lt)return t;var d=r.get(l),h=l in c;if(d===void 0&&(!h||Dr(c,l)?.writable)&&(d=o(()=>{var m=ge(h?c[l]:ve),b=P(m);return b}),r.set(l,d)),d!==void 0){var p=f(d);return p===ve?void 0:p}return Reflect.get(c,l,u)},getOwnPropertyDescriptor(c,l){var u=Reflect.getOwnPropertyDescriptor(c,l);if(u&&"value"in u){var d=r.get(l);d&&(u.value=f(d))}else if(u===void 0){var h=r.get(l),p=h?.v;if(h!==void 0&&p!==ve)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return u},has(c,l){if(l===Lt)return!0;var u=r.get(l),d=u!==void 0&&u.v!==ve||Reflect.has(c,l);if(u!==void 0||Y!==null&&(!d||Dr(c,l)?.writable)){u===void 0&&(u=o(()=>{var p=d?ge(c[l]):ve,m=P(p);return m}),r.set(l,u));var h=f(u);if(h===ve)return!1}return d},set(c,l,u,d){var h=r.get(l),p=l in c;if(s&&l==="length")for(var m=u;m<h.v;m+=1){var b=r.get(m+"");b!==void 0?g(b,ve):m in c&&(b=o(()=>P(ve)),r.set(m+"",b))}if(h===void 0)(!p||Dr(c,l)?.writable)&&(h=o(()=>P(void 0)),g(h,ge(u)),r.set(l,h));else{p=h.v!==ve;var R=o(()=>ge(u));g(h,R)}var S=Reflect.getOwnPropertyDescriptor(c,l);if(S?.set&&S.set.call(d,u),!p){if(s&&typeof l=="string"){var A=r.get("length"),O=Number(l);Number.isInteger(O)&&O>=A.v&&g(A,O+1)}ze(n)}return!0},ownKeys(c){f(n);var l=Reflect.ownKeys(c).filter(h=>{var p=r.get(h);return p===void 0||p.v!==ve});for(var[u,d]of r)d.v!==ve&&!(u in c)&&l.push(u);return l},setPrototypeOf(){md()}})}function Lo(t){try{if(t!==null&&typeof t=="object"&&Lt in t)return t[Lt]}catch{}return t}function il(t,e){return Object.is(Lo(t),Lo(e))}var jo,ol,cl,ll;function sf(){if(jo===void 0){jo=window,ol=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;cl=Dr(e,"firstChild").get,ll=Dr(e,"nextSibling").get,ko(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ko(r)&&(r.__t=void 0)}}function Ne(t=""){return document.createTextNode(t)}function He(t){return cl.call(t)}function xt(t){return ll.call(t)}function Tg(t,e){if(!N)return He(t);var r=He(K);if(r===null)r=K.appendChild(Ne());else if(e&&r.nodeType!==mi){var s=Ne();return r?.before(s),be(s),s}return be(r),r}function Lg(t,e=!1){if(!N){var r=He(t);return r instanceof Comment&&r.data===""?xt(r):r}if(e&&K?.nodeType!==mi){var s=Ne();return K?.before(s),be(s),s}return K}function jg(t,e=1,r=!1){let s=N?K:t;for(var n;e--;)n=s,s=xt(s);if(!N)return s;if(r&&s?.nodeType!==mi){var a=Ne();return s===null?n?.after(a):s.before(a),be(a),a}return be(s),s}function ul(t){t.textContent=""}function dl(){return!1}function nf(t=""){return document.createComment(t)}function af(t,e){if(e){const r=document.body;t.autofocus=!0,Et(()=>{document.activeElement===r&&t.focus()})}}function qg(t){N&&He(t)!==null&&ul(t)}let qo=!1;function fl(){qo||(qo=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Ks(t){var e=J,r=Y;We(null),Ut(null);try{return t()}finally{We(e),Ut(r)}}function vi(t,e,r,s=r){t.addEventListener(e,()=>Ks(r));const n=t.__on_r;n?t.__on_r=()=>{n(),s(!0)}:t.__on_r=()=>s(!0),fl()}function hl(t){Y===null&&(J===null&&fd(),dd()),kr&&ud()}function of(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function dt(t,e,r){var s=Y;s!==null&&(s.f&Fe)!==0&&(t|=Fe);var n={ctx:fe,deps:null,nodes:null,f:t|Ge|ot,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{un(n),n.f|=aa}catch(c){throw Ee(n),c}else e!==null&&ar(n);var a=n;if(r&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&os)===0&&(a=a.first,(t&Ot)!==0&&(t&jt)!==0&&a!==null&&(a.f|=jt)),a!==null&&(a.parent=s,s!==null&&of(a,s),J!==null&&(J.f&Ie)!==0&&(t&Lr)===0)){var o=J;(o.effects??(o.effects=[])).push(a)}return n}function io(){return J!==null&&!yt}function la(t){const e=dt(na,null,!1);return Se(e,De),e.teardown=t,e}function as(t){hl();var e=Y.f,r=!J&&(e&or)!==0&&(e&aa)===0;if(r){var s=fe;(s.e??(s.e=[])).push(t)}else return pl(t)}function pl(t){return dt(Oa|qc,t,!1)}function cf(t){return hl(),dt(na|qc,t,!0)}function gl(t){Tt.ensure();const e=dt(Lr|os,t,!0);return()=>{Ee(e)}}function lf(t){Tt.ensure();const e=dt(Lr|os,t,!0);return(r={})=>new Promise(s=>{r.outro?rs(e,()=>{Ee(e),s(void 0)}):(Ee(e),s(void 0))})}function ua(t){return dt(Oa,t,!1)}function uf(t){return dt(eo|os,t,!0)}function da(t,e=0){return dt(na|e,t,!0)}function df(t,e=[],r=[],s=[]){tl(s,e,r,n=>{dt(na,()=>t(...n.map(f)),!0)})}function cs(t,e=0){var r=dt(Ot|e,t,!0);return r}function ml(t,e=0){var r=dt(zi|e,t,!0);return r}function Oe(t){return dt(or|os,t,!0)}function yl(t){var e=t.teardown;if(e!==null){const r=kr,s=J;Uo(!0),We(null);try{e.call(null)}finally{Uo(r),We(s)}}}function wl(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const n=r.ac;n!==null&&Ks(()=>{n.abort(ys)});var s=r.next;(r.f&Lr)!==0?r.parent=null:Ee(r,e),r=s}}function ff(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&or)===0&&Ee(e),e=r}}function Ee(t,e=!0){var r=!1;(e||(t.f&jc)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(vl(t.nodes.start,t.nodes.end),r=!0),wl(t,e&&!r),Ga(t,0),Se(t,sr);var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)a.stop();yl(t);var n=t.parent;n!==null&&n.first!==null&&bl(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function vl(t,e){for(;t!==null;){var r=t===e?null:xt(t);t.remove(),t=r}}function bl(t){var e=t.parent,r=t.prev,s=t.next;r!==null&&(r.next=s),s!==null&&(s.prev=r),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=r))}function rs(t,e,r=!0){var s=[];El(t,s,!0);var n=()=>{r&&Ee(t),e&&e()},a=s.length;if(a>0){var o=()=>--a||n();for(var c of s)c.out(o)}else n()}function El(t,e,r){if((t.f&Fe)===0){t.f^=Fe;var s=t.nodes&&t.nodes.t;if(s!==null)for(const c of s)(c.is_global||r)&&e.push(c);for(var n=t.first;n!==null;){var a=n.next,o=(n.f&jt)!==0||(n.f&or)!==0&&(t.f&Ot)!==0;El(n,e,o?r:!1),n=a}}}function oo(t){Sl(t,!0)}function Sl(t,e){if((t.f&Fe)!==0){t.f^=Fe,(t.f&De)===0&&(Se(t,Ge),ar(t));for(var r=t.first;r!==null;){var s=r.next,n=(r.f&jt)!==0||(r.f&or)!==0;Sl(r,n?e:!1),r=s}var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)(o.is_global||e)&&o.in()}}function Il(t,e){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end;r!==null;){var n=r===s?null:xt(r);e.append(r),r=n}}let ss=!1;function Wa(t){ss=t}let kr=!1;function Uo(t){kr=t}let J=null,yt=!1;function We(t){J=t}let Y=null;function Ut(t){Y=t}let nr=null;function Al(t){J!==null&&(nr===null?nr=[t]:nr.push(t))}let Be=null,Ve=0,rt=null;function hf(t){rt=t}let _l=1,Or=0,bt=Or;function Bo(t){bt=t}function Rl(){return++_l}function fa(t){var e=t.f;if((e&Ge)!==0)return!0;if(e&Ie&&(t.f&=~ns),(e&cr)!==0){for(var r=t.deps,s=r.length,n=0;n<s;n++){var a=r[n];if(fa(a)&&sl(a),a.wv>t.wv)return!0}(e&ot)!==0&&mt===null&&Se(t,De)}return!1}function Pl(t,e,r=!0){var s=t.reactions;if(s!==null&&!nr?.includes(t))for(var n=0;n<s.length;n++){var a=s[n];(a.f&Ie)!==0?Pl(a,e,!1):e===a&&(r?Se(a,Ge):(a.f&De)!==0&&Se(a,cr),ar(a))}}function Dl(t){var b;var e=Be,r=Ve,s=rt,n=J,a=nr,o=fe,c=yt,l=bt,u=t.f;Be=null,Ve=0,rt=null,J=(u&(or|Lr))===0?t:null,nr=null,xs(t.ctx),yt=!1,bt=++Or,t.ac!==null&&(Ks(()=>{t.ac.abort(ys)}),t.ac=null);try{t.f|=ji;var d=t.fn,h=d(),p=t.deps;if(Be!==null){var m;if(Ga(t,Ve),p!==null&&Ve>0)for(p.length=Ve+Be.length,m=0;m<Be.length;m++)p[Ve+m]=Be[m];else t.deps=p=Be;if(io()&&(t.f&ot)!==0)for(m=Ve;m<p.length;m++)((b=p[m]).reactions??(b.reactions=[])).push(t)}else p!==null&&Ve<p.length&&(Ga(t,Ve),p.length=Ve);if(Js()&&rt!==null&&!yt&&p!==null&&(t.f&(Ie|cr|Ge))===0)for(m=0;m<rt.length;m++)Pl(rt[m],t);if(n!==null&&n!==t){if(Or++,n.deps!==null)for(let R=0;R<r;R+=1)n.deps[R].rv=Or;if(e!==null)for(const R of e)R.rv=Or;rt!==null&&(s===null?s=rt:s.push(...rt))}return(t.f&Mr)!==0&&(t.f^=Mr),h}catch(R){return Vc(R)}finally{t.f^=ji,Be=e,Ve=r,rt=s,J=n,nr=a,xs(o),yt=c,bt=l}}function pf(t,e){let r=e.reactions;if(r!==null){var s=sd.call(r,t);if(s!==-1){var n=r.length-1;n===0?r=e.reactions=null:(r[s]=r[n],r.pop())}}if(r===null&&(e.f&Ie)!==0&&(Be===null||!Be.includes(e))){var a=e;(a.f&ot)!==0&&(a.f^=ot,a.f&=~ns),ro(a),rl(a),Ga(a,0)}}function Ga(t,e){var r=t.deps;if(r!==null)for(var s=e;s<r.length;s++)pf(t,r[s])}function un(t){var e=t.f;if((e&sr)===0){Se(t,De);var r=Y,s=ss;Y=t,ss=!0;try{(e&(Ot|zi))!==0?ff(t):wl(t),yl(t);var n=Dl(t);t.teardown=typeof n=="function"?n:null,t.wv=_l;var a}finally{ss=s,Y=r}}}async function gf(){await Promise.resolve(),Jd()}function f(t){var e=t.f,r=(e&Ie)!==0;if(J!==null&&!yt){var s=Y!==null&&(Y.f&sr)!==0;if(!s&&!nr?.includes(t)){var n=J.deps;if((J.f&ji)!==0)t.rv<Or&&(t.rv=Or,Be===null&&n!==null&&n[Ve]===t?Ve++:Be===null?Be=[t]:Be.push(t));else{(J.deps??(J.deps=[])).push(t);var a=t.reactions;a===null?t.reactions=[J]:a.includes(J)||a.push(J)}}}if(kr&&$r.has(t))return $r.get(t);if(r){var o=t;if(kr){var c=o.v;return((o.f&De)===0&&o.reactions!==null||$l(o))&&(c=ao(o)),$r.set(o,c),c}var l=(o.f&ot)===0&&!yt&&J!==null&&(ss||(J.f&ot)!==0),u=o.deps===null;fa(o)&&(l&&(o.f|=ot),sl(o)),l&&!u&&Ml(o)}if(mt?.has(t))return mt.get(t);if((t.f&Mr)!==0)throw t.v;return t.v}function Ml(t){if(t.deps!==null){t.f|=ot;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&Ie)!==0&&(e.f&ot)===0&&Ml(e)}}function $l(t){if(t.v===ve)return!0;if(t.deps===null)return!1;for(const e of t.deps)if($r.has(e)||(e.f&Ie)!==0&&$l(e))return!0;return!1}function lr(t){var e=yt;try{return yt=!0,t()}finally{yt=e}}function mf(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Lt in t)Wi(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Lt in r&&Wi(r)}}}function Wi(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let s in t)try{Wi(t[s],e)}catch{}const r=gi(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const s=Nc(r);for(let n in s){const a=s[n].get;if(a)try{a.call(t)}catch{}}}}}function yf(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const wf=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function vf(t){return wf.includes(t)}const bf={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Ef(t){return t=t.toLowerCase(),bf[t]??t}const Sf=["touchstart","touchmove"];function If(t){return Sf.includes(t)}const Af=["textarea","script","style","title"];function _f(t){return Af.includes(t)}const Cl=new Set,Gi=new Set;function Ug(t){if(!N)return;t.removeAttribute("onload"),t.removeAttribute("onerror");const e=t.__e;e!==void 0&&(t.__e=void 0,queueMicrotask(()=>{t.isConnected&&t.dispatchEvent(e)}))}function co(t,e,r,s={}){function n(a){if(s.capture||sn.call(e,a),!a.cancelBubble)return Ks(()=>r?.call(this,a))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Et(()=>{e.addEventListener(t,n,s)}):e.addEventListener(t,n,s),n}function Va(t,e,r,s={}){var n=co(e,t,r,s);return()=>{t.removeEventListener(e,n,s)}}function Bg(t,e,r,s,n){var a={capture:s,passive:n},o=co(t,e,r,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&la(()=>{e.removeEventListener(t,o,a)})}function Rf(t){for(var e=0;e<t.length;e++)Cl.add(t[e]);for(var r of Gi)r(t)}let Oo=null;function sn(t){var e=this,r=e.ownerDocument,s=t.type,n=t.composedPath?.()||[],a=n[0]||t.target;Oo=t;var o=0,c=Oo===t&&t.__root;if(c){var l=n.indexOf(c);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var u=n.indexOf(e);if(u===-1)return;l<=u&&(o=l)}if(a=n[o]||t.target,a!==e){nd(t,"currentTarget",{configurable:!0,get(){return a||r}});var d=J,h=Y;We(null),Ut(null);try{for(var p,m=[];a!==null;){var b=a.assignedSlot||a.parentNode||a.host||null;try{var R=a["__"+s];R!=null&&(!a.disabled||t.target===a)&&R.call(a,t)}catch(S){p?m.push(S):p=S}if(t.cancelBubble||b===e||b===null)break;a=b}if(p){for(let S of m)queueMicrotask(()=>{throw S});throw p}}finally{t.__root=e,delete t.currentTarget,We(d),Ut(h)}}}function lo(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function et(t,e){var r=Y;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function Og(t,e){var r=(e&Cd)!==0,s=(e&kd)!==0,n,a=!t.startsWith("<!>");return()=>{if(N)return et(K,null),K;n===void 0&&(n=lo(a?t:"<!>"+t),r||(n=He(n)));var o=s||ol?document.importNode(n,!0):n.cloneNode(!0);if(r){var c=He(o),l=o.lastChild;et(c,l)}else et(o,o);return o}}function Pf(t,e,r="svg"){var s=!t.startsWith("<!>"),n=`<${r}>${s?t:"<!>"+t}</${r}>`,a;return()=>{if(N)return et(K,null),K;if(!a){var o=lo(n),c=He(o);a=He(c)}var l=a.cloneNode(!0);return et(l,l),l}}function xg(t,e){return Pf(t,e,"svg")}function Hg(t=""){if(!N){var e=Ne(t+"");return et(e,e),e}var r=K;return r.nodeType!==mi&&(r.before(r=Ne()),be(r)),et(r,r),r}function Wg(){if(N)return et(K,null),K;var t=document.createDocumentFragment(),e=document.createComment(""),r=Ne();return t.append(e,r),et(e,r),t}function Gg(t,e){if(N){var r=Y;((r.f&aa)===0||r.nodes.end===null)&&(r.nodes.end=K),qt();return}t!==null&&t.before(e)}let Qa=!0;function Ea(t){Qa=t}function Vg(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=r,t.nodeValue=r+"")}function Qg(t,e){return Df(t,e)}const fs=new Map;function Df(t,{target:e,anchor:r,props:s={},events:n,context:a,intro:o=!0}){sf();var c=new Set,l=h=>{for(var p=0;p<h.length;p++){var m=h[p];if(!c.has(m)){c.add(m);var b=If(m);e.addEventListener(m,sn,{passive:b});var R=fs.get(m);R===void 0?(document.addEventListener(m,sn,{passive:b}),fs.set(m,1)):fs.set(m,R+1)}}};l(pi(Cl)),Gi.add(l);var u=void 0,d=lf(()=>{var h=r??e.appendChild(Ne());return Xd(h,{pending:()=>{}},p=>{if(a){Wd({});var m=fe;m.c=a}if(n&&(s.$$events=n),N&&et(p,null),Qa=o,u=t(p,s)||{},Qa=!0,N&&(Y.nodes.end=K,K===null||K.nodeType!==Vs||K.data!==to))throw oa(),ia;a&&Gd()}),()=>{for(var p of c){e.removeEventListener(p,sn);var m=fs.get(p);--m===0?(document.removeEventListener(p,sn),fs.delete(p)):fs.set(p,m)}Gi.delete(l),h!==r&&h.parentNode?.removeChild(h)}});return Mf.set(u,d),u}let Mf=new WeakMap;var pt,Rt,Je,Jr,gn,mn,Fa;class ha{constructor(e,r=!0){C(this,"anchor");y(this,pt,new Map);y(this,Rt,new Map);y(this,Je,new Map);y(this,Jr,new Set);y(this,gn,!0);y(this,mn,()=>{var e=F;if(i(this,pt).has(e)){var r=i(this,pt).get(e),s=i(this,Rt).get(r);if(s)oo(s),i(this,Jr).delete(r);else{var n=i(this,Je).get(r);n&&(i(this,Rt).set(r,n.effect),i(this,Je).delete(r),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),s=n.effect)}for(const[a,o]of i(this,pt)){if(i(this,pt).delete(a),a===e)break;const c=i(this,Je).get(o);c&&(Ee(c.effect),i(this,Je).delete(o))}for(const[a,o]of i(this,Rt)){if(a===r||i(this,Jr).has(a))continue;const c=()=>{if(Array.from(i(this,pt).values()).includes(a)){var u=document.createDocumentFragment();Il(o,u),u.append(Ne()),i(this,Je).set(a,{effect:o,fragment:u})}else Ee(o);i(this,Jr).delete(a),i(this,Rt).delete(a)};i(this,gn)||!s?(i(this,Jr).add(a),rs(o,c,!1)):c()}}});y(this,Fa,e=>{i(this,pt).delete(e);const r=Array.from(i(this,pt).values());for(const[s,n]of i(this,Je))r.includes(s)||(Ee(n.effect),i(this,Je).delete(s))});this.anchor=e,I(this,gn,r)}ensure(e,r){var s=F,n=dl();if(r&&!i(this,Rt).has(e)&&!i(this,Je).has(e))if(n){var a=document.createDocumentFragment(),o=Ne();a.append(o),i(this,Je).set(e,{effect:Oe(()=>r(o)),fragment:a})}else i(this,Rt).set(e,Oe(()=>r(this.anchor)));if(i(this,pt).set(s,e),n){for(const[c,l]of i(this,Rt))c===e?s.skipped_effects.delete(l):s.skipped_effects.add(l);for(const[c,l]of i(this,Je))c===e?s.skipped_effects.delete(l.effect):s.skipped_effects.add(l.effect);s.oncommit(i(this,mn)),s.ondiscard(i(this,Fa))}else N&&(this.anchor=K),i(this,mn).call(this)}}pt=new WeakMap,Rt=new WeakMap,Je=new WeakMap,Jr=new WeakMap,gn=new WeakMap,mn=new WeakMap,Fa=new WeakMap;function Jg(t,e,r=!1){N&&qt();var s=new ha(t),n=r?jt:0;function a(o,c){if(N){const u=xc(t)===yi;if(o===u){var l=xa();be(l),s.anchor=l,vt(!1),s.ensure(o,c),vt(!0);return}}s.ensure(o,c)}cs(()=>{var o=!1;e((c,l=!0)=>{o=!0,a(l,c)}),o||a(!1,null)},n)}function Kg(t,e,r){N&&qt();var s=new ha(t),n=!Js();cs(()=>{var a=e();n&&a!==null&&typeof a=="object"&&(a={}),s.ensure(a,r)})}function Yg(t,e){return e}function $f(t,e,r){for(var s=[],n=e.length,a,o=e.length,c=0;c<n;c++){let h=e[c];rs(h,()=>{if(a){if(a.pending.delete(h),a.done.add(h),a.pending.size===0){var p=t.outrogroups;Vi(pi(a.done)),p.delete(a),p.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=s.length===0&&r!==null;if(l){var u=r,d=u.parentNode;ul(d),d.append(u),t.items.clear()}Vi(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(a)}function Vi(t,e=!0){for(var r=0;r<t.length;r++)Ee(t[r],e)}var xo;function Xg(t,e,r,s,n,a=null){var o=t,c=new Map,l=(e&Oc)!==0;if(l){var u=t;o=N?be(He(u)):u.appendChild(Ne())}N&&qt();var d=null,h=no(()=>{var A=r();return hi(A)?A:A==null?[]:pi(A)}),p,m=!0;function b(){S.fallback=d,Cf(S,p,o,e,s),d!==null&&(p.length===0?(d.f&rr)===0?oo(d):(d.f^=rr,nn(d,null,o)):rs(d,()=>{d=null}))}var R=cs(()=>{p=f(h);var A=p.length;let O=!1;if(N){var X=xc(o)===yi;X!==(A===0)&&(o=xa(),be(o),vt(!1),O=!0)}for(var H=new Set,Q=F,U=dl(),B=0;B<A;B+=1){N&&K.nodeType===Vs&&K.data===to&&(o=K,O=!0,vt(!1));var z=p[B],oe=s(z,B),W=m?null:c.get(oe);W?(W.v&&Ws(W.v,z),W.i&&Ws(W.i,B),U&&Q.skipped_effects.delete(W.e)):(W=kf(c,m?o:xo??(xo=Ne()),z,oe,B,n,e,r),m||(W.e.f|=rr),c.set(oe,W)),H.add(oe)}if(A===0&&a&&!d&&(m?d=Oe(()=>a(o)):(d=Oe(()=>a(xo??(xo=Ne()))),d.f|=rr)),N&&A>0&&be(xa()),!m)if(U){for(const[Xs,Zs]of c)H.has(Xs)||Q.skipped_effects.add(Zs.e);Q.oncommit(b),Q.ondiscard(()=>{})}else b();O&&vt(!0),f(h)}),S={effect:R,items:c,outrogroups:null,fallback:d};m=!1,N&&(o=K)}function Cf(t,e,r,s,n){var a=(s&Ed)!==0,o=e.length,c=t.items,l=t.effect.first,u,d=null,h,p=[],m=[],b,R,S,A;if(a)for(A=0;A<o;A+=1)b=e[A],R=n(b,A),S=c.get(R).e,(S.f&rr)===0&&(S.nodes?.a?.measure(),(h??(h=new Set)).add(S));for(A=0;A<o;A+=1){if(b=e[A],R=n(b,A),S=c.get(R).e,t.outrogroups!==null)for(const W of t.outrogroups)W.pending.delete(S),W.done.delete(S);if((S.f&rr)!==0)if(S.f^=rr,S===l)nn(S,null,r);else{var O=d?d.next:l;S===t.effect.last&&(t.effect.last=S.prev),S.prev&&(S.prev.next=S.next),S.next&&(S.next.prev=S.prev),ur(t,d,S),ur(t,S,O),nn(S,O,r),d=S,p=[],m=[],l=d.next;continue}if((S.f&Fe)!==0&&(oo(S),a&&(S.nodes?.a?.unfix(),(h??(h=new Set)).delete(S))),S!==l){if(u!==void 0&&u.has(S)){if(p.length<m.length){var X=m[0],H;d=X.prev;var Q=p[0],U=p[p.length-1];for(H=0;H<p.length;H+=1)nn(p[H],X,r);for(H=0;H<m.length;H+=1)u.delete(m[H]);ur(t,Q.prev,U.next),ur(t,d,Q),ur(t,U,X),l=X,d=U,A-=1,p=[],m=[]}else u.delete(S),nn(S,l,r),ur(t,S.prev,S.next),ur(t,S,d===null?t.effect.first:d.next),ur(t,d,S),d=S;continue}for(p=[],m=[];l!==null&&l!==S;)(u??(u=new Set)).add(l),m.push(l),l=l.next;if(l===null)continue}(S.f&rr)===0&&p.push(S),d=S,l=S.next}if(t.outrogroups!==null){for(const W of t.outrogroups)W.pending.size===0&&(Vi(pi(W.done)),t.outrogroups?.delete(W));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||u!==void 0){var B=[];if(u!==void 0)for(S of u)(S.f&Fe)===0&&B.push(S);for(;l!==null;)(l.f&Fe)===0&&l!==t.fallback&&B.push(l),l=l.next;var z=B.length;if(z>0){var oe=(s&Oc)!==0&&o===0?r:null;if(a){for(A=0;A<z;A+=1)B[A].nodes?.a?.measure();for(A=0;A<z;A+=1)B[A].nodes?.a?.fix()}$f(t,B,oe)}}a&&Et(()=>{if(h!==void 0)for(S of h)S.nodes?.a?.apply()})}function kf(t,e,r,s,n,a,o,c){var l=(o&vd)!==0?(o&Sd)===0?tf(r,!1,!1):ir(r):null,u=(o&bd)!==0?ir(n):null;return{v:l,i:u,e:Oe(()=>(a(e,l??r,u??n,c),()=>{t.delete(s)}))}}function nn(t,e,r){if(t.nodes)for(var s=t.nodes.start,n=t.nodes.end,a=e&&(e.f&rr)===0?e.nodes.start:r;s!==null;){var o=xt(s);if(a.before(s),s===n)return;s=o}}function ur(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function Zg(t,e,r=!1,s=!1,n=!1){var a=t,o="";df(()=>{var c=Y;if(o===(o=e()??"")){N&&qt();return}if(c.nodes!==null&&(vl(c.nodes.start,c.nodes.end),c.nodes=null),o!==""){if(N){K.data;for(var l=qt(),u=l;l!==null&&(l.nodeType!==Vs||l.data!=="");)u=l,l=xt(l);if(l===null)throw oa(),ia;et(K,u),a=be(l);return}var d=o+"";r?d=`<svg>${d}</svg>`:s&&(d=`<math>${d}</math>`);var h=lo(d);if((r||s)&&(h=He(h)),et(He(h),h.lastChild),r||s)for(;He(h);)a.before(He(h));else a.before(h)}})}function zg(t,e,...r){var s=new ha(t);cs(()=>{const n=e()??null;s.ensure(n,n&&(a=>n(a,...r)))},jt)}function Fg(t,e,r){N&&qt();var s=new ha(t);cs(()=>{var n=e()??null;s.ensure(n,n&&(a=>r(a,n)))},jt)}const Nf=()=>performance.now(),tr={tick:t=>requestAnimationFrame(t),now:()=>Nf(),tasks:new Set};function kl(){const t=tr.now();tr.tasks.forEach(e=>{e.c(t)||(tr.tasks.delete(e),e.f())}),tr.tasks.size!==0&&tr.tick(kl)}function Tf(t){let e;return tr.tasks.size===0&&tr.tick(kl),{promise:new Promise(r=>{tr.tasks.add(e={c:t,f:r})}),abort(){tr.tasks.delete(e)}}}function Sa(t,e){Ks(()=>{t.dispatchEvent(new CustomEvent(e))})}function Lf(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function Ho(t){const e={},r=t.split(";");for(const s of r){const[n,a]=s.split(":");if(!n||a===void 0)break;const o=Lf(n.trim());e[o]=a.trim()}return e}const jf=t=>t;let Nl=null;function Wo(t){Nl=t}function em(t,e,r){var s=Nl??Y,n=s.nodes,a,o,c,l=null;n.a??(n.a={element:t,measure(){a=this.element.getBoundingClientRect()},apply(){if(c?.abort(),o=this.element.getBoundingClientRect(),a.left!==o.left||a.right!==o.right||a.top!==o.top||a.bottom!==o.bottom){const u=e()(this.element,{from:a,to:o},r?.());c=Ja(this.element,u,void 0,1,()=>{c?.abort(),c=void 0})}},fix(){if(!t.getAnimations().length){var{position:u,width:d,height:h}=getComputedStyle(t);if(u!=="absolute"&&u!=="fixed"){var p=t.style;l={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=d,p.height=h;var m=t.getBoundingClientRect();if(a.left!==m.left||a.top!==m.top){var b=`translate(${a.left-m.left}px, ${a.top-m.top}px)`;p.transform=p.transform?`${p.transform} ${b}`:b}}}},unfix(){if(l){var u=t.style;u.position=l.position,u.width=l.width,u.height=l.height,u.transform=l.transform}}}),n.a.element=t}function tm(t,e,r,s){var X;var n=(t&Dd)!==0,a=(t&Md)!==0,o=n&&a,c=(t&$d)!==0,l=o?"both":n?"in":"out",u,d=e.inert,h=e.style.overflow,p,m;function b(){return Ks(()=>u??(u=r()(e,s?.()??{},{direction:l})))}var R={is_global:c,in(){if(e.inert=d,!n){m?.abort(),m?.reset?.();return}a||p?.abort(),Sa(e,"introstart"),p=Ja(e,b(),m,1,()=>{Sa(e,"introend"),p?.abort(),p=u=void 0,e.style.overflow=h})},out(H){if(!a){H?.(),u=void 0;return}e.inert=!0,Sa(e,"outrostart"),m=Ja(e,b(),p,0,()=>{Sa(e,"outroend"),H?.()})},stop:()=>{p?.abort(),m?.abort()}},S=Y;if(((X=S.nodes).t??(X.t=[])).push(R),n&&Qa){var A=c;if(!A){for(var O=S.parent;O&&(O.f&jt)!==0;)for(;(O=O.parent)&&(O.f&Ot)===0;);A=!O||(O.f&aa)!==0}A&&ua(()=>{lr(()=>R.in())})}}function Ja(t,e,r,s,n){var a=s===1;if(ps(e)){var o,c=!1;return Et(()=>{if(!c){var S=e({direction:a?"in":"out"});o=Ja(t,S,r,s,n)}}),{abort:()=>{c=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(r?.deactivate(),!e?.duration)return n(),{abort:zs,deactivate:zs,reset:zs,t:()=>s};const{delay:l=0,css:u,tick:d,easing:h=jf}=e;var p=[];if(a&&r===void 0&&(d&&d(0,1),u)){var m=Ho(u(0,1));p.push(m,m)}var b=()=>1-s,R=t.animate(p,{duration:l,fill:"forwards"});return R.onfinish=()=>{R.cancel();var S=r?.t()??1-s;r?.abort();var A=s-S,O=e.duration*Math.abs(A),X=[];if(O>0){var H=!1;if(u)for(var Q=Math.ceil(O/16.666666666666668),U=0;U<=Q;U+=1){var B=S+A*h(U/Q),z=Ho(u(B,1-B));X.push(z),H||(H=z.overflow==="hidden")}H&&(t.style.overflow="hidden"),b=()=>{var oe=R.currentTime;return S+A*h(oe/O)},d&&Tf(()=>{if(R.playState!=="running")return!1;var oe=b();return d(oe,1-oe),!0})}R=t.animate(X,{duration:O,fill:"forwards"}),R.onfinish=()=>{b=()=>s,d?.(s,1-s),n()}},{abort:()=>{R&&(R.cancel(),R.effect=null,R.onfinish=zs)},deactivate:()=>{n=zs},reset:()=>{s===0&&d?.(1,0)},t:()=>b()}}function rm(t,e,r,s,n,a){let o=N;N&&qt();var c=null;N&&K.nodeType===cd&&(c=K,qt());var l=N?K:t,u=Y,d=new ha(l,!1);cs(()=>{const h=e()||null;var p=Ld;if(h===null){d.ensure(null,null),Ea(!0);return}return d.ensure(h,m=>{if(h){if(c=N?c:document.createElementNS(p,h),et(c,c),s){N&&_f(h)&&c.append(document.createComment(""));var b=N?He(c):c.appendChild(Ne());N&&(b===null?vt(!1):be(b)),Wo(u),s(c,b),Wo(null)}Y.nodes.end=c,m.before(c)}N&&be(m)}),Ea(!0),()=>{h&&Ea(!1)}},jt),la(()=>{Ea(!0)}),o&&(vt(!0),be(l))}function qf(t,e){var r=void 0,s;ml(()=>{r!==(r=e())&&(s&&(Ee(s),s=null),r&&(s=Oe(()=>{ua(()=>r(t))})))})}function Tl(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=Tl(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Uf(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=Tl(t))&&(s&&(s+=" "),s+=e);return s}function Bf(t){return typeof t=="object"?Uf(t):t??""}const Go=[...` 	
\r\fÂ \v\uFEFF`];function Of(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var n in r)if(r[n])s=s?s+" "+n:n;else if(s.length)for(var a=n.length,o=0;(o=s.indexOf(n,o))>=0;){var c=o+a;(o===0||Go.includes(s[o-1]))&&(c===s.length||Go.includes(s[c]))?s=(o===0?"":s.substring(0,o))+s.substring(c+1):o=c}}return s===""?null:s}function Vo(t,e=!1){var r=e?" !important;":";",s="";for(var n in t){var a=t[n];a!=null&&a!==""&&(s+=" "+n+": "+a+r)}return s}function _i(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function xf(t,e){if(e){var r="",s,n;if(Array.isArray(e)?(s=e[0],n=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,o=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(_i)),n&&l.push(...Object.keys(n).map(_i));var u=0,d=-1;const R=t.length;for(var h=0;h<R;h++){var p=t[h];if(c?p==="/"&&t[h-1]==="*"&&(c=!1):a?a===p&&(a=!1):p==="/"&&t[h+1]==="*"?c=!0:p==='"'||p==="'"?a=p:p==="("?o++:p===")"&&o--,!c&&a===!1&&o===0){if(p===":"&&d===-1)d=h;else if(p===";"||h===R-1){if(d!==-1){var m=_i(t.substring(u,d).trim());if(!l.includes(m)){p!==";"&&h++;var b=t.substring(u,h).trim();r+=" "+b+";"}}u=h+1,d=-1}}}}return s&&(r+=Vo(s)),n&&(r+=Vo(n,!0)),r=r.trim(),r===""?null:r}return t==null?null:String(t)}function Hf(t,e,r,s,n,a){var o=t.__className;if(N||o!==r||o===void 0){var c=Of(r,s,a);(!N||c!==t.getAttribute("class"))&&(c==null?t.removeAttribute("class"):e?t.className=c:t.setAttribute("class",c)),t.__className=r}else if(a&&n!==a)for(var l in a){var u=!!a[l];(n==null||u!==!!n[l])&&t.classList.toggle(l,u)}return a}function Ri(t,e={},r,s){for(var n in r){var a=r[n];e[n]!==a&&(r[n]==null?t.style.removeProperty(n):t.style.setProperty(n,a,s))}}function Wf(t,e,r,s){var n=t.__style;if(N||n!==e){var a=xf(e,s);(!N||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=e}else s&&(Array.isArray(s)?(Ri(t,r?.[0],s[0]),Ri(t,r?.[1],s[1],"important")):Ri(t,r,s));return s}function Ka(t,e,r=!1){if(t.multiple){if(e==null)return;if(!hi(e))return qd();for(var s of t.options)s.selected=e.includes(ln(s));return}for(s of t.options){var n=ln(s);if(il(n,e)){s.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function Ll(t){var e=new MutationObserver(()=>{Ka(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),la(()=>{e.disconnect()})}function sm(t,e,r=e){var s=new WeakSet,n=!0;vi(t,"change",a=>{var o=a?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(o),ln);else{var l=t.querySelector(o)??t.querySelector("option:not([disabled])");c=l&&ln(l)}r(c),F!==null&&s.add(F)}),ua(()=>{var a=e();if(t===document.activeElement){var o=on??F;if(s.has(o))return}if(Ka(t,a,n),n&&a===void 0){var c=t.querySelector(":checked");c!==null&&(a=ln(c),r(a))}t.__value=a,n=!1}),Ll(t)}function ln(t){return"__value"in t?t.__value:t.value}const en=Symbol("class"),tn=Symbol("style"),jl=Symbol("is custom element"),ql=Symbol("is html");function Gf(t){if(N){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var s=t.value;Ya(t,"value",null),t.value=s}if(t.hasAttribute("checked")){var n=t.checked;Ya(t,"checked",null),t.checked=n}}};t.__on_r=r,Et(r),fl()}}function nm(t,e){var r=bi(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function am(t,e){var r=bi(t);r.checked!==(r.checked=e??void 0)&&(t.checked=e)}function Vf(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function Ya(t,e,r,s){var n=bi(t);N&&(n[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(t[od]=r),r==null?t.removeAttribute(e):typeof r!="string"&&Ul(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function Qf(t,e,r,s,n=!1,a=!1){if(N&&n&&t.tagName==="INPUT"){var o=t,c=o.type==="checkbox"?"defaultChecked":"defaultValue";c in r||Gf(o)}var l=bi(t),u=l[jl],d=!l[ql];let h=N&&u;h&&vt(!1);var p=e||{},m=t.tagName==="OPTION";for(var b in e)b in r||(r[b]=null);r.class?r.class=Bf(r.class):r[en]&&(r.class=null),r[tn]&&(r.style??(r.style=null));var R=Ul(t);for(const U in r){let B=r[U];if(m&&U==="value"&&B==null){t.value=t.__value="",p[U]=B;continue}if(U==="class"){var S=t.namespaceURI==="http://www.w3.org/1999/xhtml";Hf(t,S,B,s,e?.[en],r[en]),p[U]=B,p[en]=r[en];continue}if(U==="style"){Wf(t,B,e?.[tn],r[tn]),p[U]=B,p[tn]=r[tn];continue}var A=p[U];if(!(B===A&&!(B===void 0&&t.hasAttribute(U)))){p[U]=B;var O=U[0]+U[1];if(O!=="$$")if(O==="on"){const z={},oe="$$"+U;let W=U.slice(2);var X=vf(W);if(yf(W)&&(W=W.slice(0,-7),z.capture=!0),!X&&A){if(B!=null)continue;t.removeEventListener(W,p[oe],z),p[oe]=null}if(B!=null)if(X)t[`__${W}`]=B,Rf([W]);else{let Xs=function(Zs){p[U].call(this,Zs)};p[oe]=co(W,t,Xs,z)}else X&&(t[`__${W}`]=void 0)}else if(U==="style")Ya(t,U,B);else if(U==="autofocus")af(t,!!B);else if(!u&&(U==="__value"||U==="value"&&B!=null))t.value=t.__value=B;else if(U==="selected"&&m)Vf(t,B);else{var H=U;d||(H=Ef(H));var Q=H==="defaultValue"||H==="defaultChecked";if(B==null&&!u&&!Q)if(l[U]=null,H==="value"||H==="checked"){let z=t;const oe=e===void 0;if(H==="value"){let W=z.defaultValue;z.removeAttribute(H),z.defaultValue=W,z.value=z.__value=oe?W:null}else{let W=z.defaultChecked;z.removeAttribute(H),z.defaultChecked=W,z.checked=oe?W:!1}}else t.removeAttribute(U);else Q||R.includes(H)&&(u||typeof B!="string")?(t[H]=B,H in l&&(l[H]=ve)):typeof B!="function"&&Ya(t,H,B)}}}return h&&vt(!0),p}function im(t,e,r=[],s=[],n=[],a,o=!1,c=!1){tl(n,r,s,l=>{var u=void 0,d={},h=t.nodeName==="SELECT",p=!1;if(ml(()=>{var b=e(...l.map(f)),R=Qf(t,u,b,a,o,c);p&&h&&"value"in b&&Ka(t,b.value);for(let A of Object.getOwnPropertySymbols(d))b[A]||Ee(d[A]);for(let A of Object.getOwnPropertySymbols(b)){var S=b[A];A.description===jd&&(!u||S!==u[A])&&(d[A]&&Ee(d[A]),d[A]=Oe(()=>qf(t,()=>S))),R[A]=S}u=R}),h){var m=t;ua(()=>{Ka(m,u.value,!0),Ll(m)})}p=!0})}function bi(t){return t.__attributes??(t.__attributes={[jl]:t.nodeName.includes("-"),[ql]:t.namespaceURI===Td})}var Qo=new Map;function Ul(t){var e=t.getAttribute("is")||t.nodeName,r=Qo.get(e);if(r)return r;Qo.set(e,r=[]);for(var s,n=t,a=Element.prototype;a!==n;){s=Nc(n);for(var o in s)s[o].set&&r.push(o);n=gi(n)}return r}let Pi=null;function Jf(){if(Pi===null){var t=document.createElement("select");t.innerHTML="<option><span>t</span></option>",Pi=t.firstChild?.firstChild?.nodeType===1}return Pi}function om(t,e){var r=N;Jf()||(vt(!1),t.textContent="",t.append(nf("")));try{e()}finally{r&&(N?Bd(t):(vt(!0),be(t)))}}function cm(t,e,r=e){var s=new WeakSet;vi(t,"input",async n=>{var a=n?t.defaultValue:t.value;if(a=Mi(t)?$i(a):a,r(a),F!==null&&s.add(F),await gf(),a!==(a=e())){var o=t.selectionStart,c=t.selectionEnd,l=t.value.length;if(t.value=a??"",c!==null){var u=t.value.length;o===c&&c===l&&u>l?(t.selectionStart=u,t.selectionEnd=u):(t.selectionStart=o,t.selectionEnd=Math.min(c,u))}}}),(N&&t.defaultValue!==t.value||lr(e)==null&&t.value)&&(r(Mi(t)?$i(t.value):t.value),F!==null&&s.add(F)),da(()=>{var n=e();if(t===document.activeElement){var a=on??F;if(s.has(a))return}Mi(t)&&n===$i(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}const Di=new Set;function lm(t,e,r,s,n=s){var a=r.getAttribute("type")==="checkbox",o=t;let c=!1;if(e!==null)for(var l of e)o=o[l]??(o[l]=[]);o.push(r),vi(r,"change",()=>{var u=r.__value;a&&(u=Jo(o,u,r.checked)),n(u)},()=>n(a?[]:null)),da(()=>{var u=s();if(N&&r.defaultChecked!==r.checked){c=!0;return}a?(u=u||[],r.checked=u.includes(r.__value)):r.checked=il(r.__value,u)}),la(()=>{var u=o.indexOf(r);u!==-1&&o.splice(u,1)}),Di.has(o)||(Di.add(o),Et(()=>{o.sort((u,d)=>u.compareDocumentPosition(d)===4?-1:1),Di.delete(o)})),Et(()=>{if(c){var u;if(a)u=Jo(o,u,r.checked);else{var d=o.find(h=>h.checked);u=d?.__value}n(u)}})}function um(t,e,r=e){vi(t,"change",s=>{var n=s?t.defaultChecked:t.checked;r(n)}),(N&&t.defaultChecked!==t.checked||lr(e)==null)&&r(t.checked),da(()=>{var s=e();t.checked=!!s})}function Jo(t,e,r){for(var s=new Set,n=0;n<t.length;n+=1)t[n].checked&&s.add(t[n].__value);return r||s.delete(e),Array.from(s)}function Mi(t){var e=t.type;return e==="number"||e==="range"}function $i(t){return t===""?null:+t}function Ko(t,e){return t===e||t?.[Lt]===e}function dm(t={},e,r,s){return ua(()=>{var n,a;return da(()=>{n=a,a=s?.()||[],lr(()=>{t!==r(...a)&&(e(t,...a),n&&Ko(r(...n),t)&&e(null,...n))})}),()=>{Et(()=>{a&&Ko(r(...a),t)&&e(null,...a)})}}),t}function fm(t=!1){const e=fe,r=e.l.u;if(!r)return;let s=()=>mf(e.s);if(t){let n=0,a={};const o=ca(()=>{let c=!1;const l=e.s;for(const u in l)l[u]!==a[u]&&(a[u]=l[u],c=!0);return c&&n++,n});s=()=>f(o)}r.b.length&&cf(()=>{Yo(e,s),Li(r.b)}),as(()=>{const n=lr(()=>r.m.map(id));return()=>{for(const a of n)typeof a=="function"&&a()}}),r.a.length&&as(()=>{Yo(e,s),Li(r.a)})}function Yo(t,e){if(t.l.s)for(const r of t.l.s)f(r);e()}let Ia=!1;function Kf(t){var e=Ia;try{return Ia=!1,[t(),Ia]}finally{Ia=e}}const Yf={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function hm(t,e,r){return new Proxy({props:t,exclude:e},Yf)}const Xf={get(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(ps(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(t,e,r){let s=t.props.length;for(;s--;){let n=t.props[s];ps(n)&&(n=n());const a=Dr(n,e);if(a&&a.set)return a.set(r),!0}return!1},getOwnPropertyDescriptor(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(ps(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const n=Dr(s,e);return n&&!n.configurable&&(n.configurable=!0),n}}},has(t,e){if(e===Lt||e===Uc)return!1;for(let r of t.props)if(ps(r)&&(r=r()),r!=null&&e in r)return!0;return!1},ownKeys(t){const e=[];for(let r of t.props)if(ps(r)&&(r=r()),!!r){for(const s in r)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(r))e.includes(s)||e.push(s)}return e}};function pm(...t){return new Proxy({props:t},Xf)}function gm(t,e,r,s){var n=!Qs||(r&Ad)!==0,a=(r&Rd)!==0,o=(r&Pd)!==0,c=s,l=!0,u=()=>(l&&(l=!1,c=o?lr(s):s),c),d;if(a){var h=Lt in t||Uc in t;d=Dr(t,e)?.set??(h&&e in t?X=>t[e]=X:void 0)}var p,m=!1;a?[p,m]=Kf(()=>t[e]):p=t[e],p===void 0&&s!==void 0&&(p=u(),d&&(n&&pd(),d(p)));var b;if(n?b=()=>{var X=t[e];return X===void 0?u():(l=!0,X)}:b=()=>{var X=t[e];return X!==void 0&&(c=void 0),X===void 0?c:X},n&&(r&_d)===0)return b;if(d){var R=t.$$legacy;return(function(X,H){return arguments.length>0?((!n||!H||R||m)&&d(H?b():X),X):b()})}var S=!1,A=((r&Id)!==0?ca:no)(()=>(S=!1,b()));a&&f(A);var O=Y;return(function(X,H){if(arguments.length>0){const Q=H?f(A):n&&a?ge(X):X;return g(A,Q),S=!0,c!==void 0&&(c=Q),X}return kr&&S||(O.f&sr)!==0?A.v:f(A)})}function Zf(t){fe===null&&Bc(),Qs&&fe.l!==null?zf(fe).m.push(t):as(()=>{const e=lr(t);if(typeof e=="function")return e})}function mm(t){fe===null&&Bc(),Zf(()=>()=>lr(t))}function zf(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Ff="modulepreload",eh=function(t){return"/app/"+t},Xo={},ft=function(e,r,s){let n=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");n=l(r.map(u=>{if(u=eh(u),u in Xo)return;Xo[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Ff,d||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((m,b)=>{p.addEventListener("load",m),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})};var th=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],rh=["difference","intersection","symmetricDifference","union"],Zo=!1,_s,gt,gr,ei,Gs,Bl,Ol;const ti=class ti extends Set{constructor(r){super();y(this,Gs);y(this,_s,new Map);y(this,gt,P(0));y(this,gr,P(0));y(this,ei,bt||-1);if(r){for(var s of r)super.add(s);i(this,gr).v=super.size}Zo||v(this,Gs,Ol).call(this)}has(r){var s=super.has(r),n=i(this,_s),a=n.get(r);if(a===void 0){if(!s)return f(i(this,gt)),!1;a=v(this,Gs,Bl).call(this,!0),n.set(r,a)}return f(a),s}add(r){return super.has(r)||(super.add(r),g(i(this,gr),super.size),ze(i(this,gt))),this}delete(r){var s=super.delete(r),n=i(this,_s),a=n.get(r);return a!==void 0&&(n.delete(r),g(a,!1)),s&&(g(i(this,gr),super.size),ze(i(this,gt))),s}clear(){if(super.size!==0){super.clear();var r=i(this,_s);for(var s of r.values())g(s,!1);r.clear(),g(i(this,gr),0),ze(i(this,gt))}}keys(){return this.values()}values(){return f(i(this,gt)),super.values()}entries(){return f(i(this,gt)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return f(i(this,gr))}};_s=new WeakMap,gt=new WeakMap,gr=new WeakMap,ei=new WeakMap,Gs=new WeakSet,Bl=function(r){return bt===i(this,ei)?P(r):ir(r)},Ol=function(){Zo=!0;var r=ti.prototype,s=Set.prototype;for(const n of th)r[n]=function(...a){return f(i(this,gt)),s[n].apply(this,a)};for(const n of rh)r[n]=function(...a){f(i(this,gt));var o=s[n].apply(this,a);return new ti(o)}};let zo=ti;var Pt,Dt,Kt,ri,wt,an,Ca;const yo=class yo extends Map{constructor(r){super();y(this,wt);y(this,Pt,new Map);y(this,Dt,P(0));y(this,Kt,P(0));y(this,ri,bt||-1);if(r){for(var[s,n]of r)super.set(s,n);i(this,Kt).v=super.size}}has(r){var s=i(this,Pt),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=v(this,wt,an).call(this,0),s.set(r,n);else return f(i(this,Dt)),!1}return f(n),!0}forEach(r,s){v(this,wt,Ca).call(this),super.forEach(r,s)}get(r){var s=i(this,Pt),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=v(this,wt,an).call(this,0),s.set(r,n);else{f(i(this,Dt));return}}return f(n),super.get(r)}set(r,s){var n=i(this,Pt),a=n.get(r),o=super.get(r),c=super.set(r,s),l=i(this,Dt);if(a===void 0)a=v(this,wt,an).call(this,0),n.set(r,a),g(i(this,Kt),super.size),ze(l);else if(o!==s){ze(a);var u=l.reactions===null?null:new Set(l.reactions),d=u===null||!a.reactions?.every(h=>u.has(h));d&&ze(l)}return c}delete(r){var s=i(this,Pt),n=s.get(r),a=super.delete(r);return n!==void 0&&(s.delete(r),g(i(this,Kt),super.size),g(n,-1),ze(i(this,Dt))),a}clear(){if(super.size!==0){super.clear();var r=i(this,Pt);g(i(this,Kt),0);for(var s of r.values())g(s,-1);ze(i(this,Dt)),r.clear()}}keys(){return f(i(this,Dt)),super.keys()}values(){return v(this,wt,Ca).call(this),super.values()}entries(){return v(this,wt,Ca).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(i(this,Kt)),super.size}};Pt=new WeakMap,Dt=new WeakMap,Kt=new WeakMap,ri=new WeakMap,wt=new WeakSet,an=function(r){return bt===i(this,ri)?P(r):ir(r)},Ca=function(){f(i(this,Dt));var r=i(this,Pt);if(i(this,Kt).v!==r.size){for(var s of Co(yo.prototype,this,"keys").call(this))if(!r.has(s)){var n=v(this,wt,an).call(this,0);r.set(s,n)}}for([,n]of i(this,Pt))f(n)};let ct=yo;var yn,wn;class xl{constructor(e,r){y(this,yn);y(this,wn);I(this,yn,e),I(this,wn,so(r))}get current(){return i(this,wn).call(this),i(this,yn).call(this)}}yn=new WeakMap,wn=new WeakMap;const sh=/\(.+\)/,nh=new Set(["all","print","screen","and","or","not","only"]);class Fo extends xl{constructor(e,r){let s=sh.test(e)||e.split(/[\s,]+/).some(a=>nh.has(a.trim()))?e:`(${e})`;const n=window.matchMedia(s);super(()=>n.matches,a=>Va(n,"change",a))}}const Hl=typeof window<"u"?window:void 0;function ah(t){let e=t.activeElement;for(;e?.shadowRoot;){const r=e.shadowRoot.activeElement;if(r===e)break;e=r}return e}var Rs,vn;class ih{constructor(e={}){y(this,Rs);y(this,vn);const{window:r=Hl,document:s=r?.document}=e;r!==void 0&&(I(this,Rs,s),I(this,vn,so(n=>{const a=Va(r,"focusin",n),o=Va(r,"focusout",n);return()=>{a(),o()}})))}get current(){var e;return(e=i(this,vn))==null||e.call(this),i(this,Rs)?ah(i(this,Rs)):null}}Rs=new WeakMap,vn=new WeakMap;new ih;function Wl(t){return typeof t=="function"}function Gl(t,e){if(Wl(t)){const s=t();return s===void 0?e:s}return t===void 0?e:t}function oh(t,e){let r=P(null);const s=Z(()=>Gl(e,250));function n(...a){if(f(r))f(r).timeout&&clearTimeout(f(r).timeout);else{let o,c;const l=new Promise((u,d)=>{o=u,c=d});g(r,{timeout:null,runner:null,promise:l,resolve:o,reject:c},!0)}return f(r).runner=async()=>{if(!f(r))return;const o=f(r);g(r,null);try{o.resolve(await t.apply(this,a))}catch(c){o.reject(c)}},f(r).timeout=setTimeout(f(r).runner,f(s)),f(r).promise}return n.cancel=async()=>{(!f(r)||f(r).timeout===null)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||f(r).timeout===null)||(clearTimeout(f(r).timeout),f(r).reject("Cancelled"),g(r,null))},n.runScheduledNow=async()=>{(!f(r)||!f(r).timeout)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||!f(r).timeout)||(clearTimeout(f(r).timeout),f(r).timeout=null,await f(r).runner?.())},Object.defineProperty(n,"pending",{enumerable:!0,get(){return!!f(r)?.timeout}}),n}function ch(t){return Wl(t)?t():t}function ym(t,e,r={}){const{root:s,rootMargin:n="0px",threshold:a=.1,immediate:o=!0,window:c=Hl}=r;let l=P(ge(o)),u;const d=Z(()=>{const p=Gl(t);return new Set(p?Array.isArray(p)?p:[p]:[])}),h=gl(()=>{as(()=>{if(!(!f(d).size||!f(l)||!c)){u=new c.IntersectionObserver(e,{rootMargin:n,root:ch(s),threshold:a});for(const p of f(d))u.observe(p);return()=>{u?.disconnect()}}})});return as(()=>h),{get isActive(){return f(l)},stop:h,pause(){g(l,!1)},resume(){g(l,!0)}}}function Vl(t,e){switch(e){case"kg":case"l.":return Math.round(t*100)/100;case"gr.":case"ml":return Math.round(t);default:return Math.round(t*10)/10}}function it(t){return t?.length?t.map(e=>xr(e.q,e.u)).join(" et "):"-"}function lh(t,e){const r=typeof t=="number"?t:parseFloat(t);if(isNaN(r))return{value:0,unit:e};let s=e,n=r;return(e==="gr."||e==="ml")&&r>=1e3?(n=r/1e3,s=e==="gr."?"kg":"l."):(e==="kg"||e==="l.")&&r<1&&r>0&&(n=r*1e3,s=e==="kg"?"gr.":"ml"),{value:Vl(n,s),unit:s}}function xr(t,e){const{value:r,unit:s}=lh(t,e);let n;return s==="kg"||s==="l."?n=r.toFixed(2).replace(/\.?0+$/,""):n=r.toString(),`${n} ${s}`}function wm(t,e,r){if(e==="au goÃ»t")return{quantity:t,unit:e,formatted:`${t} ${e}`,formattedNumber:`${t}`};const s=t*r,{q:n,u:a}=uh(s,e),o=Vl(n,a);let c=`${o}`;return(a==="kg"||a==="l.")&&(c=o.toFixed(2).replace(/\.?0+$/,"")),{quantity:o,unit:a,formatted:`${c} ${a}`,formattedNumber:c}}function uh(t,e){const r=e.toLowerCase().trim();return(r==="gr."||r==="ml")&&t>=1e3?{q:t/1e3,u:r==="gr."?"kg":"l."}:(r==="kg"||r==="l.")&&t<1&&t>0?{q:t*1e3,u:r==="kg"?"gr.":"ml"}:{q:t,u:e}}function Qi(t){if(!t?.length)return[];const e=new Map;return t.forEach(({q:r,u:s})=>{if(typeof r=="number"&&!isNaN(r)){const n=e.get(s)||0;e.set(s,n+r)}}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function dh(t,e){const r=new Map,s=new Map;t.forEach(({q:o,u:c})=>{r.set(c,(r.get(c)||0)+o)}),e.forEach(({q:o,u:c})=>{s.set(c,(s.get(c)||0)+o)});const n=[],a=new Set([...r.keys(),...s.keys()]);for(const o of a){const c=r.get(o)||0,l=s.get(o)||0,u=c-l;Math.abs(u)>.001&&n.push({q:u,u:o})}return n}function Rr(t){if(!t?.trim())return null;try{return JSON.parse(t)}catch(e){return console.warn("[ProductsStore] Erreur parsing JSON:",e),null}}function uo(t){return t?.length?t.filter(e=>e.quantity!=null&&e.unit).map(e=>({q:typeof e.quantity=="number"?e.quantity:parseFloat(e.quantity),u:e.unit})).filter(e=>!isNaN(e.q)):[]}function fo(t){if(!t?.length)return[];const e=new Map;return t.forEach(r=>{if(!r.q||!r.u||typeof r.q!="number"||isNaN(r.q))return;const s=e.get(r.u)||0;e.set(r.u,s+r.q)}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function Ei(t,e){if(!t?.length)return{numeric:[],display:"â Complet"};if(!e?.length){const c=t.map(l=>xr(l.q,l.u)).join(" et ");return{numeric:t,display:c}}const r=new Map,s=new Map;t.forEach(c=>{const l=parseFloat(c.q);isNaN(l)||r.set(c.u,(r.get(c.u)||0)+l)}),e.forEach(c=>{s.set(c.u,(s.get(c.u)||0)+c.q)});const n=[],a=[];r.forEach((c,l)=>{const u=s.get(l)||0,d=c-u;d>0&&(n.push({q:d,u:l}),a.push(xr(d,l)))});const o=a.length>0?a.join(" et "):"â Complet";return{numeric:n,display:o}}function fh(t){return t?Object.values(t).some(e=>e.recipes?.some(r=>r.q!==void 0||r.u!==void 0)):!1}function vm(t){if(!t)return[];const e=[];return Object.entries(t).forEach(([r,s])=>{s.recipes?.forEach(n=>{e.push({...n,date:r,dateTimeService:r})})}),e}function ec(t){if(!t?.length)return"ÃquilibrÃ©";const e=t.filter(s=>s.q>0),r=t.filter(s=>s.q<0);if(e.length>0&&r.length>0){const s=e.map(a=>xr(a.q,a.u)).join(" et "),n=r.map(a=>xr(Math.abs(a.q),a.u)).join(" et ");return`${s} disponibles, ${n} manquant${r.length>1?"s":""}`}else return e.length>0?e.map(s=>"+"+xr(s.q,s.u)).join(" et ")+" disponibles":r.length>0?r.map(s=>xr(Math.abs(s.q),s.u)).join(" et ")+` manquant${r.length>1?"s":""}`:"ÃquilibrÃ©"}function hh(t,e){if(e.searchQuery.trim()){const s=e.searchQuery.toLowerCase();if(!t.productName.toLowerCase().includes(s))return!1}if(e.selectedStores.length>0&&(!t.storeInfo?.storeName||!e.selectedStores.includes(t.storeInfo.storeName))||e.selectedWho.length>0&&(!t.who||!t.who.some(s=>e.selectedWho.includes(s)))||e.selectedProductTypes.length>0&&(!t.productType||!e.selectedProductTypes.includes(t.productType)))return!1;const r=e.temperatureFilter;if(r&&r!=="all")switch(r){case"frais":if(!t.pF)return!1;break;case"not-frais":if(t.pF)return!1;break;case"surgele":if(!t.pS)return!1;break;case"not-surgele":if(t.pS)return!1;break}return!0}function Ql(t){return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function ph(t,e,r=.01){if(!t?.length&&!e?.length)return!0;if(!t?.length||!e?.length)return!1;const s=new Map(t.map(c=>[c.u,c.q])),n=new Map(e.map(c=>[c.u,c.q])),a=Array.from(s.keys()).sort(),o=Array.from(n.keys()).sort();if(a.length!==o.length||!a.every((c,l)=>c===o[l]))return!1;for(const[c,l]of s){const u=n.get(c);if(u===void 0)return!1;const d=Math.abs(l-u),h=Math.max(l,u),p=Math.max(h*r,1);if(d>p)return!1}return!0}function bm(t){const e=t.totalNeededOverrideParsed;if(!e)return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};if(!(e.totalComputedWhenOverride!==void 0&&e.platesNbWhenOverride!==void 0&&e.recipesNbWhenOverride!==void 0))return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};const s=e.totalComputedWhenOverride,n=t.totalNeededArray,a=e.platesNbWhenOverride,o=t.totalAssiettes,c=e.recipesNbWhenOverride,l=t.nbRecipes,u=!ph(s,n),d=a!==o,h=c!==l,p=u||d||h;return{hasMismatch:p,computedChanged:u,platesChanged:d,recipesChanged:h,details:p?{oldComputed:s,newComputed:n,oldPlates:a,newPlates:o,oldRecipes:c,newRecipes:l}:void 0}}function tc(t){return{...t,products:t.products?.map(e=>typeof e=="string"?e:e.$id)||[],mainId:t.mainId}}class ho{static normalize(e,r,s=""){const n=r.toLowerCase(),a=s.toLowerCase(),o=n.includes("caf"),c=n.includes("soupe"),l=n.includes("pinc"),u=n.includes("gousse"),d=n.includes("tÃªte"),h=n.includes("unit")||n==="piÃ¨ce"||n==="piece",p=a.includes("sucre"),m=a.includes("sel"),b=a.includes("farine"),R=a.includes("crÃ¨me Ã©paisse")||a.includes("creme epaisse"),S=a==="ail",A=a.includes("oignon"),O=a==="tomate",X=a==="poireau",H=a.includes("aubergine"),Q=a==="courgette",U=a==="Ã©chalote"||a==="echalote",B=a==="orange"&&!a.includes("jus"),z=a.includes("citron")&&!a.includes("jus"),oe=a==="concombre",W=a==="levure chimique",Xs=a==="carotte",Zs=a==="betterave rouge",wo=a.includes("semoule"),vo=a.includes("poivre"),bo=a.includes("cacao"),Eo=a.includes("sucre glace"),So=a.includes("maizena")||a.includes("maÃ¯zena"),Io=a.includes("bicarbonate"),Ao=a.includes("curcuma"),_o=a.includes("cumin"),Ro=a.includes("curry"),Po=a.includes("muscade"),Do=a.includes("paprika"),Mo=a.includes("miel");let Wt=e,ds=r,St=!1,jr="",G="";if(o){St=!0;let T="cafe_default";G="ml",p?(T="cafe_sucre",G="gr."):m?(T="cafe_sel",G="gr."):b?(T="cafe_farine",G="gr."):wo?(T="cafe_semoule",G="gr."):vo?(T="cafe_poivre",G="gr."):bo?(T="cafe_cacao",G="gr."):Eo?(T="cafe_sucre_glace",G="gr."):So?(T="cafe_maizena",G="gr."):Io?(T="cafe_bicarbonate",G="gr."):Ao?(T="cafe_curcuma",G="gr."):_o?(T="cafe_cumin",G="gr."):Ro?(T="cafe_curry",G="gr."):Po?(T="cafe_muscade",G="gr."):Do?(T="cafe_paprika",G="gr."):Mo?(T="cafe_miel",G="gr."):R&&(T="cafe_creme_epaisse",G="ml"),Wt=e*this.CONVERSION_RULES[T],jr=`1 c. Ã  cafÃ© = ${this.CONVERSION_RULES[T]} ${G}`}else if(c){St=!0;let T="soupe_default";G="ml",p?(T="soupe_sucre",G="gr."):m?(T="soupe_sel",G="gr."):b?(T="soupe_farine",G="gr."):wo?(T="soupe_semoule",G="gr."):vo?(T="soupe_poivre",G="gr."):bo?(T="soupe_cacao",G="gr."):Eo?(T="soupe_sucre_glace",G="gr."):So?(T="soupe_maizena",G="gr."):R?(T="soupe_creme_epaisse",G="ml"):Io?(T="soupe_bicarbonate",G="gr."):Ao?(T="soupe_curcuma",G="gr."):_o?(T="soupe_cumin",G="gr."):Ro?(T="soupe_curry",G="gr."):Po?(T="soupe_muscade",G="gr."):Do?(T="soupe_paprika",G="gr."):Mo&&(T="soupe_miel",G="gr."),Wt=e*this.CONVERSION_RULES[T],jr=`1 c. Ã  soupe = ${this.CONVERSION_RULES[T]} ${G}`}else if(l)St=!0,G="gr.",Wt=e*this.CONVERSION_RULES.pincee,jr="1 pincÃ©e = 0.4 gr.";else if(u&&S)St=!0,G="gr.",Wt=e*this.CONVERSION_RULES.gousse_ail,jr="1 gousse = 6.5 gr.";else if(d&&S)St=!0,G="gr.",Wt=e*this.CONVERSION_RULES.tete_ail,jr="1 tÃªte = 80 gr.";else if(h){St=!0,G="gr.";let T="";A?T="unite_oignon":S?T="unite_ail":O?T="unite_tomate":X?T="unite_poireau":H?T="unite_aubergine":Q?T="unite_courgette":U?T="unite_eshalote":B?T="unite_orange":z?T="unite_citron":oe?T="unite_concombre":W?T="unite_levure_chimique":Xs?T="unite_carotte":Zs?T="unite_betterave_rouge":St=!1,St&&(Wt=e*this.CONVERSION_RULES[T],jr=`1 unitÃ© = ${this.CONVERSION_RULES[T]} gr.`)}return St?ds=G:n==="kg"?(Wt=e*1e3,ds="gr."):n==="l."?(Wt=e*1e3,ds="ml"):n==="gr."?ds="gr.":n==="ml"&&(ds="ml"),{quantity:Wt,unit:ds,originalUnit:r,ruleUsed:jr,hasConversion:St}}}C(ho,"CONVERSION_RULES",{cafe_sucre:5,cafe_sel:5,cafe_farine:3,cafe_semoule:4,cafe_poivre:2.5,cafe_cacao:2.5,cafe_sucre_glace:3,cafe_maizena:3,cafe_bicarbonate:5,cafe_curcuma:2,cafe_cumin:2,cafe_curry:2,cafe_muscade:2,cafe_paprika:2,cafe_miel:10,cafe_creme_epaisse:5,cafe_default:5,soupe_sucre:15,soupe_sel:15,soupe_farine:10,soupe_semoule:12,soupe_poivre:8,soupe_cacao:8,soupe_sucre_glace:9,soupe_maizena:10,soupe_creme_epaisse:15,soupe_bicarbonate:15,soupe_curcuma:6,soupe_cumin:6,soupe_curry:6,soupe_muscade:7,soupe_paprika:6,soupe_miel:30,soupe_default:15,pincee:.4,gousse_ail:6.5,tete_ail:80,unite_oignon:120,unite_ail:6.5,unite_tomate:120,unite_poireau:150,unite_aubergine:250,unite_courgette:200,unite_eshalote:30,unite_orange:200,unite_citron:100,unite_concombre:200,unite_levure_chimique:11,unite_carotte:125,unite_betterave_rouge:250});const Jl=2;function gh(t){const r=new Date(t).getHours();return r>=11&&r<=13?"sun":r>=19&&r<=21?"moon":r>=7&&r<=9?"cloud":null}function mh(t){return{formattedDate:new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),timeIcon:gh(t)}}function yh(t){const e={};for(const r of t)e[r]=mh(r);return e}function wh(t,e,r){const s=!t.productHugoUuid,n=t.byDate&&Object.keys(t.byDate).length>0,a=s&&(t.totalNeededArray&&t.totalNeededArray.length>0||t.totalNeededOverrideParsed);if(!n&&!a)return{requiredQuantities:[],requiredQuantitiesFormatted:"-",stockBalance:[],availableStockQuantities:[],missingStockQuantities:[],availableStockFormatted:"-",missingStockFormatted:"-",hasAvailableStock:!1,hasMissingStock:!1,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map};if(s&&!n){const Q=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray||[],U=Q.length>0?it(Q):"-",B=rc(t,e,r,Q),z=B.filter(W=>W.q>0),oe=B.filter(W=>W.q<0);return{requiredQuantities:Q,requiredQuantitiesFormatted:U,stockBalance:B,availableStockQuantities:z,missingStockQuantities:oe,availableStockFormatted:ec(B),missingStockFormatted:it(oe.map(W=>({q:Math.abs(W.q),u:W.u}))),hasAvailableStock:z.length>0,hasMissingStock:oe.length>0,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map}}const o=e,c=r,l=[],u=new Map,d=new Map;let h=0,p=0;for(const[Q,U]of Object.entries(t.byDate))Q>=o&&Q<=c&&(l.push(Q),h+=U.totalAssiettes||0,U.recipes?.length&&(u.set(Q,U.recipes),p+=U.recipes.length),U.totalConsolidated&&U.totalConsolidated.forEach(({q:B,u:z})=>{d.set(z,(d.get(z)||0)+B)}));const m=Array.from(d.entries()).map(([Q,U])=>({q:U,u:Q})),b=m.length>0?it(m):"-",R=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:m,S=rc(t,e,r,R),A=S.filter(Q=>Q.q>0),O=new Date().toISOString().split("T")[0],H=r<O?[]:S.filter(Q=>Q.q<0);return{requiredQuantities:m,requiredQuantitiesFormatted:b,stockBalance:S,availableStockQuantities:A,missingStockQuantities:H,availableStockFormatted:ec(S),missingStockFormatted:it(H.map(Q=>({q:Math.abs(Q.q),u:Q.u}))),hasAvailableStock:A.length>0,hasMissingStock:H.length>0,totalRecipesInRange:p,totalPortionsInRange:h,datesInSelectedRange:l,recipesByDate:u}}function rc(t,e,r,s){let n=[],a="";t.stockParsed?.dateTime&&t.stockParsed.dateTime<=e&&(n=[{q:parseFloat(t.stockParsed.quantity),u:t.stockParsed.unit}],a=t.stockParsed.dateTime);const o=[];if(t.purchases)for(const u of t.purchases)vh(u,e,r,a)&&o.push({q:u.quantity,u:u.unit});const c=[...n,...o],l=Qi(c);return dh(l,s)}function vh(t,e,r,s=""){if(t.status==="cancelled")return!1;const n=t.deliveryDate||t.$createdAt;if(!n)return!1;const a=new Date(r);return a.setHours(a.getHours()+Jl),!(a<new Date||n>a.toISOString()||s&&t.$createdAt<s)}class bh{constructor(){C(this,"dbName","recipes-cache");C(this,"db",null);C(this,"version",5);C(this,"RECIPES_INDEX_STORE","recipes-index");C(this,"RECIPES_DETAILS_STORE","recipes-details");C(this,"METADATA_STORE","metadata");C(this,"BUILD_TIMESTAMP_KEY","buildTimestamp");C(this,"LAST_APPWRITE_SYNC_KEY","lastAppwriteSync");C(this,"RECIPES_COUNT_KEY","recipesCount")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.RECIPES_INDEX_STORE)||(d.createObjectStore(this.RECIPES_INDEX_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-index' crÃ©Ã©")),d.objectStoreNames.contains(this.RECIPES_DETAILS_STORE)||(d.createObjectStore(this.RECIPES_DETAILS_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-details' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[RecipesIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.RECIPES_INDEX_STORE),n=r.objectStoreNames.contains(this.RECIPES_DETAILS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[RecipesIDBCache] Base corrompue dÃ©tectÃ©e (index=${s}, details=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[RecipesIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[RecipesIDBCache] Base ouverte: ${this.dbName}`)}async loadRecipesIndex(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_INDEX_STORE,"readonly").objectStore(this.RECIPES_INDEX_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} recettes (index) chargÃ©es`),e(o)},a.onerror=()=>r(a.error)})}async saveRecipesIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_INDEX_STORE,"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[RecipesIDBCache] ${e.size} recettes (index) sauvegardÃ©es`),r()},n.onerror=()=>s(n.error)})}async loadRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).get(e);o.onsuccess=()=>{const c=o.result;c&&console.log(`[RecipesIDBCache] DÃ©tails de ${e} chargÃ©s depuis le cache`),r(c||null)},o.onerror=()=>s(o.error)})}async saveRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).put(e);o.onsuccess=()=>{console.log(`[RecipesIDBCache] DÃ©tails de ${e.$id} sauvegardÃ©s`),r()},o.onerror=()=>s(o.error)})}async loadAllRecipeDetails(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} dÃ©tails de recettes chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE),o=new Map;let c=0;const l=e.length;for(const u of e){const d=a.get(u);d.onsuccess=()=>{const h=d.result;h&&o.set(u,h),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk`),r(o))},d.onerror=()=>{console.warn(`[RecipesIDBCache] Erreur chargement ${u} en bulk:`,d.error),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk (avec erreurs)`),r(o))}}l===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  charger en bulk"),r(o))})}async saveRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite"),a=n.objectStore(this.RECIPES_DETAILS_STORE);let o=0;const c=e.size;e.forEach(l=>{const u=a.put(l);u.onsuccess=()=>{o++,o===c&&(console.log(`[RecipesIDBCache] ${c} recettes sauvegardÃ©es en bulk`),r())},u.onerror=()=>{console.error(`[RecipesIDBCache] Erreur sauvegarde ${l.$id} en bulk:`,u.error),s(u.error)}}),c===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  sauvegarder en bulk"),r()),n.onerror=()=>s(n.error)})}async deleteRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteRecipeFromIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE],"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE),o=n.objectStore(this.RECIPES_DETAILS_STORE);a.delete(e),o.delete(e),n.oncomplete=()=>{console.log(`[RecipesIDBCache] Recette ${e} supprimÃ©e de l'index et des dÃ©tails`),r()},n.onerror=()=>s(n.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={buildTimestamp:null,lastAppwriteSync:null,recipesCount:0,cacheVersion:1};o.forEach(l=>{l.key===this.RECIPES_COUNT_KEY?c.recipesCount=l.value:l.key===this.BUILD_TIMESTAMP_KEY?c.buildTimestamp=l.value:l.key===this.LAST_APPWRITE_SYNC_KEY&&(c.lastAppwriteSync=l.value)}),console.log(`[RecipesIDBCache] Metadata chargÃ©es: count=${c.recipesCount}, build=${c.buildTimestamp}, sync=${c.lastAppwriteSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.BUILD_TIMESTAMP_KEY,value:e.buildTimestamp}),a.put({key:this.LAST_APPWRITE_SYNC_KEY,value:e.lastAppwriteSync}),a.put({key:this.RECIPES_COUNT_KEY,value:e.recipesCount}),n.oncomplete=()=>{console.log("[RecipesIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.RECIPES_INDEX_STORE).clear(),s.objectStore(this.RECIPES_DETAILS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[RecipesIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[RecipesIDBCache] Connexion fermÃ©e"))}}async function Eh(){const t=new bh;return await t.open(),t}function Em(t){return t.map(e=>JSON.stringify(e))}function ka(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{return JSON.parse(e)}catch(r){return console.warn("[ingredientUtils] Failed to parse ingredient:",e,r),null}}).filter(e=>e!==null)}const sc={"BouchÃ©es salÃ©es":"sandwich",Boisson:"cup-soda",Cake:"cake-slice","CrÃ¨mes dessert":"fast-food-pudding",Friture:"fryer",Gateau:"cake-slice",Pain:"bread","Plat au Four":"oven","Plat en Sauce":"pot",Salade:"lettuce",Sauce:"sauce",Snacking:"hamburger",Soupe:"soup","Tarte (salÃ©e)":"pizza","Tarte (sucrÃ©e)":"pie",Tartinade:"tartinade"},Sh={entree:"salad",plat:"dish",dessert:"fast-food-pudding"};function Sm(t,e){const r=Array.isArray(e)?e[0]:e;if(r&&sc[r])return{label:r,iconId:sc[r]};const s=Ih(t),n=Sh[t]||"no-cat";return{label:s,iconId:n}}function Ih(t){switch(t){case"entree":return"EntrÃ©e";case"plat":return"Plat";case"dessert":return"Dessert";default:return t}}function Ci(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{const r=JSON.parse(e);if(r&&typeof r.astuce=="string")return r;if(typeof e=="string")return{astuce:e}}catch(r){console.warn("[recipeUtils] Failed to parse astuce:",e,r)}return null}).filter(e=>e!==null)}function Im(t){return!t||!Array.isArray(t)||t.length===0?null:t.map(e=>JSON.stringify(typeof e=="string"?{astuce:e}:e))}function Ah(t){if(!t||typeof t!="object"||Array.isArray(t))throw new Error(`Format d'ingrÃ©dient invalide: ${JSON.stringify(t)}`);return{uuid:t.uuid||"",name:t.name||"",originalQuantity:t.originalQuantity||0,originalUnit:t.originalUnit||"",normalizedQuantity:t.normalizedQuantity||0,normalizedUnit:t.normalizedUnit||"",comment:t.comment||"",allergens:Array.isArray(t.allergens)?t.allergens:[],type:t.type||"",pF:t.pF??!1,pS:t.pS??!1}}function nc(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{try{e.push(Ah(r))}catch(s){console.warn("[parseRecipeData] IngrÃ©dient invalide ignorÃ©:",s)}}),{...t,$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||"",ingredients:e}}function _h(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es d'index de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{typeof r=="string"?e.push(r):r&&typeof r.name=="string"&&e.push(r.name)}),{title:t.title||"",typeR:t.typeR||"",categories:Array.isArray(t.categories)?t.categories:[],regime:t.regime||null,draft:t.draft??!1,materiel:Array.isArray(t.materiel)?t.materiel:[],region:t.region||"",serveHot:t.serveHot??!1,cuisson:t.cuisson??!1,check:t.check??!1,saison:Array.isArray(t.saison)?t.saison:[],permissionWrite:Array.isArray(t.permissionWrite)?t.permissionWrite:[],lockedBy:t.lockedBy||null,plate:t.plate??100,ingredients:e,auteur:t.auteur||"",createdBy:t.createdBy||"",$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||""}}function Aa(t){let e=[];return t.ingredients&&(e=ka(t.ingredients).map(s=>s.name)),{title:t.title,typeR:t.typeR,categories:t.categories,regime:t.regime,draft:t.draft||!1,saison:t.saison,ingredients:e,materiel:t.materiel,region:t.region||null,serveHot:t.serveHot,cuisson:t.cuisson,check:t.check,auteur:t.auteur||t.createdBy,permissionWrite:t.permissionWrite,lockedBy:t.lockedBy||null,$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,createdBy:t.createdBy,plate:t.plate,rootRecipeId:t.rootRecipeId||null,versionLabel:t.versionLabel||null}}function ki(t,e,r,s){function n(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function c(d){try{u(s.next(d))}catch(h){o(h)}}function l(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):n(d.value).then(c,l)}u((s=s.apply(t,[])).next())})}function Rh(t,e,r,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?s:r==="a"?s.call(t):s?s.value:e.get(t)}class E{constructor(e,r,s){this.method=e,this.attribute=r,s!==void 0&&(Array.isArray(s)?this.values=s:this.values=[s])}toString(){return JSON.stringify({method:this.method,attribute:this.attribute,values:this.values})}}E.equal=(t,e)=>new E("equal",t,e).toString();E.notEqual=(t,e)=>new E("notEqual",t,e).toString();E.lessThan=(t,e)=>new E("lessThan",t,e).toString();E.lessThanEqual=(t,e)=>new E("lessThanEqual",t,e).toString();E.greaterThan=(t,e)=>new E("greaterThan",t,e).toString();E.greaterThanEqual=(t,e)=>new E("greaterThanEqual",t,e).toString();E.isNull=t=>new E("isNull",t).toString();E.isNotNull=t=>new E("isNotNull",t).toString();E.between=(t,e,r)=>new E("between",t,[e,r]).toString();E.startsWith=(t,e)=>new E("startsWith",t,e).toString();E.endsWith=(t,e)=>new E("endsWith",t,e).toString();E.select=t=>new E("select",void 0,t).toString();E.search=(t,e)=>new E("search",t,e).toString();E.orderDesc=t=>new E("orderDesc",t).toString();E.orderAsc=t=>new E("orderAsc",t).toString();E.orderRandom=()=>new E("orderRandom").toString();E.cursorAfter=t=>new E("cursorAfter",void 0,t).toString();E.cursorBefore=t=>new E("cursorBefore",void 0,t).toString();E.limit=t=>new E("limit",void 0,t).toString();E.offset=t=>new E("offset",void 0,t).toString();E.contains=(t,e)=>new E("contains",t,e).toString();E.notContains=(t,e)=>new E("notContains",t,e).toString();E.notSearch=(t,e)=>new E("notSearch",t,e).toString();E.notBetween=(t,e,r)=>new E("notBetween",t,[e,r]).toString();E.notStartsWith=(t,e)=>new E("notStartsWith",t,e).toString();E.notEndsWith=(t,e)=>new E("notEndsWith",t,e).toString();E.createdBefore=t=>E.lessThan("$createdAt",t);E.createdAfter=t=>E.greaterThan("$createdAt",t);E.createdBetween=(t,e)=>E.between("$createdAt",t,e);E.updatedBefore=t=>E.lessThan("$updatedAt",t);E.updatedAfter=t=>E.greaterThan("$updatedAt",t);E.updatedBetween=(t,e)=>E.between("$updatedAt",t,e);E.or=t=>new E("or",void 0,t.map(e=>JSON.parse(e))).toString();E.and=t=>new E("and",void 0,t.map(e=>JSON.parse(e))).toString();E.distanceEqual=(t,e,r,s=!0)=>new E("distanceEqual",t,[[e,r,s]]).toString();E.distanceNotEqual=(t,e,r,s=!0)=>new E("distanceNotEqual",t,[[e,r,s]]).toString();E.distanceGreaterThan=(t,e,r,s=!0)=>new E("distanceGreaterThan",t,[[e,r,s]]).toString();E.distanceLessThan=(t,e,r,s=!0)=>new E("distanceLessThan",t,[[e,r,s]]).toString();E.intersects=(t,e)=>new E("intersects",t,[e]).toString();E.notIntersects=(t,e)=>new E("notIntersects",t,[e]).toString();E.crosses=(t,e)=>new E("crosses",t,[e]).toString();E.notCrosses=(t,e)=>new E("notCrosses",t,[e]).toString();E.overlaps=(t,e)=>new E("overlaps",t,[e]).toString();E.notOverlaps=(t,e)=>new E("notOverlaps",t,[e]).toString();E.touches=(t,e)=>new E("touches",t,[e]).toString();E.notTouches=(t,e)=>new E("notTouches",t,[e]).toString();class w extends Error{constructor(e,r=0,s="",n=""){super(e),this.name="AppwriteException",this.message=e,this.code=r,this.type=s,this.response=n}}class Vt{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.5.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var e;(e=this.realtime.socket)===null||e===void 0||e.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var e,r,s;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(e=this.realtime.socket)===null||e===void 0||e.close();return}const n=new URLSearchParams;this.config.project&&n.set("project",this.config.project),this.realtime.channels.forEach(o=>{n.append("channels[]",o)});const a=this.config.endpointRealtime+"/realtime?"+n.toString();(a!==this.realtime.url||!this.realtime.socket||((r=this.realtime.socket)===null||r===void 0?void 0:r.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((s=this.realtime.socket)===null||s===void 0?void 0:s.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=a,this.realtime.socket=new WebSocket(a),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",o=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",o=>{var c,l,u;if(!this.realtime.reconnect||((l=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||l===void 0?void 0:l.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,o.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:e=>{var r,s;try{const n=JSON.parse(e.data);switch(this.realtime.lastMessage=n,n.type){case"connected":let a=this.config.session;if(!a){const l=JSON.parse((r=window.localStorage.getItem("cookieFallback"))!==null&&r!==void 0?r:"{}");a=l?.[`a_session_${this.config.project}`]}const o=n.data;a&&!o.user&&((s=this.realtime.socket)===null||s===void 0||s.send(JSON.stringify({type:"authentication",data:{session:a}})));break;case"event":let c=n.data;if(c?.channels){if(!c.channels.some(u=>this.realtime.channels.has(u)))return;this.realtime.subscriptions.forEach(u=>{c.channels.some(d=>u.channels.includes(d))&&setTimeout(()=>u.callback(c))})}break;case"pong":break;case"error":throw n.data;default:break}}catch(n){console.error(n)}},cleanUp:e=>{this.realtime.channels.forEach(r=>{e.includes(r)&&(Array.from(this.realtime.subscriptions).some(([n,a])=>a.channels.includes(r))||this.realtime.channels.delete(r))})}}}setEndpoint(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new w("Invalid endpoint URL: "+e);return this.config.endpoint=e,this.config.endpointRealtime=e.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){if(!e.startsWith("ws://")&&!e.startsWith("wss://"))throw new w("Invalid realtime endpoint URL: "+e);return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}setSession(e){return this.headers["X-Appwrite-Session"]=e,this.config.session=e,this}setDevKey(e){return this.headers["X-Appwrite-Dev-Key"]=e,this.config.devkey=e,this}subscribe(e,r){let s=typeof e=="string"?[e]:e;s.forEach(a=>this.realtime.channels.add(a));const n=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(n,{channels:s,callback:r}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(n),this.realtime.cleanUp(s),this.realtime.connect()}}prepareRequest(e,r,s={},n={}){if(e=e.toUpperCase(),s=Object.assign({},this.headers,s),typeof window<"u"&&window.localStorage){const o=window.localStorage.getItem("cookieFallback");o&&(s["X-Fallback-Cookies"]=o)}let a={method:e,headers:s};if(s["X-Appwrite-Dev-Key"]===void 0&&(a.credentials="include"),e==="GET")for(const[o,c]of Object.entries(Vt.flatten(n)))r.searchParams.append(o,c);else switch(s["content-type"]){case"application/json":a.body=JSON.stringify(n);break;case"multipart/form-data":const o=new FormData;for(const[c,l]of Object.entries(n))if(l instanceof File)o.append(c,l,l.name);else if(Array.isArray(l))for(const u of l)o.append(`${c}[]`,u);else o.append(c,l);a.body=o,delete s["content-type"];break}return{uri:r.toString(),options:a}}chunkedUpload(e,r,s={},n={},a){var o;return ki(this,void 0,void 0,function*(){const[c,l]=(o=Object.entries(n).find(([h,p])=>p instanceof File))!==null&&o!==void 0?o:[];if(!l||!c)throw new Error("File not found in payload");if(l.size<=Vt.CHUNK_SIZE)return yield this.call(e,r,s,n);let u=0,d=null;for(;u<l.size;){let h=u+Vt.CHUNK_SIZE;h>=l.size&&(h=l.size),s["content-range"]=`bytes ${u}-${h-1}/${l.size}`;const p=l.slice(u,h);let m=Object.assign({},n);m[c]=new File([p],l.name),d=yield this.call(e,r,s,m),a&&typeof a=="function"&&a({$id:d.$id,progress:Math.round(h/l.size*100),sizeUploaded:h,chunksTotal:Math.ceil(l.size/Vt.CHUNK_SIZE),chunksUploaded:Math.ceil(h/Vt.CHUNK_SIZE)}),d&&d.$id&&(s["x-appwrite-id"]=d.$id),u=h}return d})}ping(){return ki(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(e,r,s={},n={},a="json"){var o,c;return ki(this,void 0,void 0,function*(){const{uri:l,options:u}=this.prepareRequest(e,r,s,n);let d=null;const h=yield fetch(l,u);if(h.type==="opaque")throw new w(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const p=h.headers.get("x-appwrite-warning");if(p&&p.split(";").forEach(b=>console.warn("Warning: "+b)),!((o=h.headers.get("content-type"))===null||o===void 0)&&o.includes("application/json")?d=yield h.json():a==="arrayBuffer"?d=yield h.arrayBuffer():d={message:yield h.text()},400<=h.status){let b="";throw!((c=h.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||a==="arrayBuffer"?b=JSON.stringify(d):b=d?.message,new w(d?.message,h.status,d?.type,b)}const m=h.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&m&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",m)),d})}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),Vt.flatten(a,o)):s[o]=a}return s}}Vt.CHUNK_SIZE=1024*1024*5;class dn{constructor(e){this.client=e}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),dn.flatten(a,o)):s[o]=a}return s}}dn.CHUNK_SIZE=5*1024*1024;class Ph{constructor(e){this.client=e}get(){const e="/account",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],password:r[1],name:r[2]};const n=s.userId,a=s.email,o=s.password,c=s.name;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "email"');if(typeof o>"u")throw new w('Missing required parameter: "password"');const l="/account",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.password=o),typeof c<"u"&&(u.name=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}updateEmail(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new w('Missing required parameter: "email"');if(typeof a>"u")throw new w('Missing required parameter: "password"');const o="/account/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}listIdentities(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/identities",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}deleteIdentity(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={identityId:e};const s=r.identityId;if(typeof s>"u")throw new w('Missing required parameter: "identityId"');const n="/account/identities/{identityId}".replace("{identityId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createJWT(){const e="/account/jwts",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}listLogs(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/logs",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMFA(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={mfa:e};const s=r.mfa;if(typeof s>"u")throw new w('Missing required parameter: "mfa"');const n="/account/mfa",a={};typeof s<"u"&&(a.mfa=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new w('Missing required parameter: "type"');if(typeof a>"u")throw new w('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new w('Missing required parameter: "type"');if(typeof a>"u")throw new w('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deleteMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}deleteMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new w('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createMfaChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new w('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new w('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new w('Missing required parameter: "challengeId"');if(typeof a>"u")throw new w('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new w('Missing required parameter: "challengeId"');if(typeof a>"u")throw new w('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}listMfaFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}listMFAFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}createMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updateMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateName(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={name:e};const s=r.name;if(typeof s>"u")throw new w('Missing required parameter: "name"');const n="/account/name",a={};typeof s<"u"&&(a.name=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}updatePassword(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={password:e,oldPassword:r[0]};const n=s.password,a=s.oldPassword;if(typeof n>"u")throw new w('Missing required parameter: "password"');const o="/account/password",c={};typeof n<"u"&&(c.password=n),typeof a<"u"&&(c.oldPassword=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}updatePhone(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={phone:e,password:r[0]};const n=s.phone,a=s.password;if(typeof n>"u")throw new w('Missing required parameter: "phone"');if(typeof a>"u")throw new w('Missing required parameter: "password"');const o="/account/phone",c={};typeof n<"u"&&(c.phone=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}getPrefs(){const e="/account/prefs",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}updatePrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"prefs"in e?r=e||{}:r={prefs:e};const s=r.prefs;if(typeof s>"u")throw new w('Missing required parameter: "prefs"');const n="/account/prefs",a={};typeof s<"u"&&(a.prefs=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,url:r[0]};const n=s.email,a=s.url;if(typeof n>"u")throw new w('Missing required parameter: "email"');if(typeof a>"u")throw new w('Missing required parameter: "url"');const o="/account/recovery",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.url=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0],password:r[1]};const n=s.userId,a=s.secret,o=s.password;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');if(typeof o>"u")throw new w('Missing required parameter: "password"');const c="/account/recovery",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.secret=a),typeof o<"u"&&(l.password=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("put",u,d,l)}listSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}deleteSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("delete",s,n,r)}createAnonymousSession(){const e="/account/sessions/anonymous",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createEmailPasswordSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new w('Missing required parameter: "email"');if(typeof a>"u")throw new w('Missing required parameter: "password"');const o="/account/sessions/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateMagicURLSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/sessions/magic-url",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createOAuth2Session(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new w('Missing required parameter: "provider"');const l="/account/sessions/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(dn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}updatePhoneSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/sessions/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/sessions/token",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}getSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}deleteSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new w('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}updateStatus(){const e="/account/status",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}createPushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0],providerId:r[1]};const n=s.targetId,a=s.identifier,o=s.providerId;if(typeof n>"u")throw new w('Missing required parameter: "targetId"');if(typeof a>"u")throw new w('Missing required parameter: "identifier"');const c="/account/targets/push",l={};typeof n<"u"&&(l.targetId=n),typeof a<"u"&&(l.identifier=a),typeof o<"u"&&(l.providerId=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}updatePushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0]};const n=s.targetId,a=s.identifier;if(typeof n>"u")throw new w('Missing required parameter: "targetId"');if(typeof a>"u")throw new w('Missing required parameter: "identifier"');const o="/account/targets/{targetId}/push".replace("{targetId}",n),c={};typeof a<"u"&&(c.identifier=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deletePushTarget(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={targetId:e};const s=r.targetId;if(typeof s>"u")throw new w('Missing required parameter: "targetId"');const n="/account/targets/{targetId}/push".replace("{targetId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createEmailToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],phrase:r[1]};const n=s.userId,a=s.email,o=s.phrase;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "email"');const c="/account/tokens/email",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.email=a),typeof o<"u"&&(l.phrase=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}createMagicURLToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],url:r[1],phrase:r[2]};const n=s.userId,a=s.email,o=s.url,c=s.phrase;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "email"');const l="/account/tokens/magic-url",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.url=o),typeof c<"u"&&(u.phrase=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}createOAuth2Token(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new w('Missing required parameter: "provider"');const l="/account/tokens/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(dn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}createPhoneToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,phone:r[0]};const n=s.userId,a=s.phone;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "phone"');const o="/account/tokens/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.phone=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}createEmailVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new w('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new w('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateEmailVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createPhoneVerification(){const e="/account/verifications/phone",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updatePhoneVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "userId"');if(typeof a>"u")throw new w('Missing required parameter: "secret"');const o="/account/verifications/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}class Dh{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/databases/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/databases/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new w('Missing required parameter: "transactionId"');const c="/databases/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new w('Missing required parameter: "transactionId"');const o="/databases/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listDocuments(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.collectionId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');const u="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),h={};typeof o<"u"&&(h.documentId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",p,m,h)}getDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');const u="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",p,m,h)}updateDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",p,m,h)}deleteDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');const l="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/decrement".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("patch",m,b,p)}incrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "collectionId"');if(typeof o>"u")throw new w('Missing required parameter: "documentId"');if(typeof c>"u")throw new w('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/increment".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("patch",m,b,p)}}class Mh{constructor(e){this.client=e}listExecutions(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,queries:r[0],total:r[1]};const n=s.functionId,a=s.queries,o=s.total;if(typeof n>"u")throw new w('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",n),l={};typeof a<"u"&&(l.queries=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}createExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,body:r[0],async:r[1],xpath:r[2],method:r[3],headers:r[4],scheduledAt:r[5]};const n=s.functionId,a=s.body,o=s.async,c=s.xpath,l=s.method,u=s.headers,d=s.scheduledAt;if(typeof n>"u")throw new w('Missing required parameter: "functionId"');const h="/functions/{functionId}/executions".replace("{functionId}",n),p={};typeof a<"u"&&(p.body=a),typeof o<"u"&&(p.async=o),typeof c<"u"&&(p.path=c),typeof l<"u"&&(p.method=l),typeof u<"u"&&(p.headers=u),typeof d<"u"&&(p.scheduledAt=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("post",m,b,p)}getExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,executionId:r[0]};const n=s.functionId,a=s.executionId;if(typeof n>"u")throw new w('Missing required parameter: "functionId"');if(typeof a>"u")throw new w('Missing required parameter: "executionId"');const o="/functions/{functionId}/executions/{executionId}".replace("{functionId}",n).replace("{executionId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}}class $h{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new w('Missing required parameter: "transactionId"');const c="/tablesdb/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new w('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new w('Missing required parameter: "transactionId"');const o="/tablesdb/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listRows(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.tableId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "data"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),h={};typeof o<"u"&&(h.rowId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("post",p,m,h)}getRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("put",p,m,h)}updateRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),m={"content-type":"application/json"};return this.client.call("patch",p,m,h)}deleteRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');const l="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/decrement".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("patch",m,b,p)}incrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new w('Missing required parameter: "databaseId"');if(typeof a>"u")throw new w('Missing required parameter: "tableId"');if(typeof o>"u")throw new w('Missing required parameter: "rowId"');if(typeof c>"u")throw new w('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/increment".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("patch",m,b,p)}}class Ch{constructor(e){this.client=e}list(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,search:r[0],total:r[1]};const n=s.queries,a=s.search,o=s.total,c="/teams",l={};typeof n<"u"&&(l.queries=n),typeof a<"u"&&(l.search=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0],roles:r[1]};const n=s.teamId,a=s.name,o=s.roles;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "name"');const c="/teams",l={};typeof n<"u"&&(l.teamId=n),typeof a<"u"&&(l.name=a),typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}get(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateName(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0]};const n=s.teamId,a=s.name;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "name"');const o="/teams/{teamId}".replace("{teamId}",n),c={};typeof a<"u"&&(c.name=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}delete(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}listMemberships(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,queries:r[0],search:r[1],total:r[2]};const n=s.teamId,a=s.queries,o=s.search,c=s.total;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');const l="/teams/{teamId}/memberships".replace("{teamId}",n),u={};typeof a<"u"&&(u.queries=a),typeof o<"u"&&(u.search=o),typeof c<"u"&&(u.total=c);const d=new URL(this.client.config.endpoint+l),h={};return this.client.call("get",d,h,u)}createMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,roles:r[0],email:r[1],userId:r[2],phone:r[3],url:r[4],name:r[5]};const n=s.teamId,a=s.roles,o=s.email,c=s.userId,l=s.phone,u=s.url,d=s.name;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "roles"');const h="/teams/{teamId}/memberships".replace("{teamId}",n),p={};typeof o<"u"&&(p.email=o),typeof c<"u"&&(p.userId=c),typeof l<"u"&&(p.phone=l),typeof a<"u"&&(p.roles=a),typeof u<"u"&&(p.url=u),typeof d<"u"&&(p.name=d);const m=new URL(this.client.config.endpoint+h),b={"content-type":"application/json"};return this.client.call("post",m,b,p)}getMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],roles:r[1]};const n=s.teamId,a=s.membershipId,o=s.roles;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "membershipId"');if(typeof o>"u")throw new w('Missing required parameter: "roles"');const c="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),l={};typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("delete",l,u,c)}updateMembershipStatus(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],userId:r[1],secret:r[2]};const n=s.teamId,a=s.membershipId,o=s.userId,c=s.secret;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "membershipId"');if(typeof o>"u")throw new w('Missing required parameter: "userId"');if(typeof c>"u")throw new w('Missing required parameter: "secret"');const l="/teams/{teamId}/memberships/{membershipId}/status".replace("{teamId}",n).replace("{membershipId}",a),u={};typeof o<"u"&&(u.userId=o),typeof c<"u"&&(u.secret=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("patch",d,h,u)}getPrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new w('Missing required parameter: "teamId"');const n="/teams/{teamId}/prefs".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updatePrefs(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,prefs:r[0]};const n=s.teamId,a=s.prefs;if(typeof n>"u")throw new w('Missing required parameter: "teamId"');if(typeof a>"u")throw new w('Missing required parameter: "prefs"');const o="/teams/{teamId}/prefs".replace("{teamId}",n),c={};typeof a<"u"&&(c.prefs=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}var ac;(function(t){t[t.NORMAL_CLOSURE=1e3]="NORMAL_CLOSURE",t[t.POLICY_VIOLATION=1008]="POLICY_VIOLATION",t[t.UNKNOWN_ERROR=-1]="UNKNOWN_ERROR"})(ac||(ac={}));class ee{}ee.read=t=>`read("${t}")`;ee.write=t=>`write("${t}")`;ee.create=t=>`create("${t}")`;ee.update=t=>`update("${t}")`;ee.delete=t=>`delete("${t}")`;class se{static any(){return"any"}static user(e,r=""){return r===""?`user:${e}`:`user:${e}/${r}`}static users(e=""){return e===""?"users":`users/${e}`}static guests(){return"guests"}static team(e,r=""){return r===""?`team:${e}`:`team:${e}/${r}`}static member(e){return`member:${e}`}static label(e){return`label:${e}`}}var Kl,Yl;class lt{static custom(e){return e}static unique(e=7){const r=Rh(lt,Kl,"m",Yl).call(lt);let s="";for(let n=0;n<e;n++){const a=Math.floor(Math.random()*16).toString(16);s+=a}return r+s}}Kl=lt,Yl=function(){const e=new Date,r=Math.floor(e.getTime()/1e3),s=e.getMilliseconds();return r.toString(16)+s.toString(16).padStart(5,"0")};var ic;(function(t){t.Equal="equal",t.NotEqual="notEqual",t.GreaterThan="greaterThan",t.GreaterThanEqual="greaterThanEqual",t.LessThan="lessThan",t.LessThanEqual="lessThanEqual",t.Contains="contains",t.IsNull="isNull",t.IsNotNull="isNotNull"})(ic||(ic={}));var oc;(function(t){t.Totp="totp"})(oc||(oc={}));var cc;(function(t){t.Email="email",t.Phone="phone",t.Totp="totp",t.Recoverycode="recoverycode"})(cc||(cc={}));var lc;(function(t){t.Amazon="amazon",t.Apple="apple",t.Auth0="auth0",t.Authentik="authentik",t.Autodesk="autodesk",t.Bitbucket="bitbucket",t.Bitly="bitly",t.Box="box",t.Dailymotion="dailymotion",t.Discord="discord",t.Disqus="disqus",t.Dropbox="dropbox",t.Etsy="etsy",t.Facebook="facebook",t.Figma="figma",t.Github="github",t.Gitlab="gitlab",t.Google="google",t.Linkedin="linkedin",t.Microsoft="microsoft",t.Notion="notion",t.Oidc="oidc",t.Okta="okta",t.Paypal="paypal",t.PaypalSandbox="paypalSandbox",t.Podio="podio",t.Salesforce="salesforce",t.Slack="slack",t.Spotify="spotify",t.Stripe="stripe",t.Tradeshift="tradeshift",t.TradeshiftBox="tradeshiftBox",t.Twitch="twitch",t.Wordpress="wordpress",t.Yahoo="yahoo",t.Yammer="yammer",t.Yandex="yandex",t.Zoho="zoho",t.Zoom="zoom",t.Mock="mock"})(lc||(lc={}));var uc;(function(t){t.AvantBrowser="aa",t.AndroidWebViewBeta="an",t.GoogleChrome="ch",t.GoogleChromeIOS="ci",t.GoogleChromeMobile="cm",t.Chromium="cr",t.MozillaFirefox="ff",t.Safari="sf",t.MobileSafari="mf",t.MicrosoftEdge="ps",t.MicrosoftEdgeIOS="oi",t.OperaMini="om",t.Opera="op",t.OperaNext="on"})(uc||(uc={}));var dc;(function(t){t.AmericanExpress="amex",t.Argencard="argencard",t.Cabal="cabal",t.Cencosud="cencosud",t.DinersClub="diners",t.Discover="discover",t.Elo="elo",t.Hipercard="hipercard",t.JCB="jcb",t.Mastercard="mastercard",t.Naranja="naranja",t.TarjetaShopping="targeta-shopping",t.UnionPay="unionpay",t.Visa="visa",t.MIR="mir",t.Maestro="maestro",t.Rupay="rupay"})(dc||(dc={}));var fc;(function(t){t.Afghanistan="af",t.Angola="ao",t.Albania="al",t.Andorra="ad",t.UnitedArabEmirates="ae",t.Argentina="ar",t.Armenia="am",t.AntiguaAndBarbuda="ag",t.Australia="au",t.Austria="at",t.Azerbaijan="az",t.Burundi="bi",t.Belgium="be",t.Benin="bj",t.BurkinaFaso="bf",t.Bangladesh="bd",t.Bulgaria="bg",t.Bahrain="bh",t.Bahamas="bs",t.BosniaAndHerzegovina="ba",t.Belarus="by",t.Belize="bz",t.Bolivia="bo",t.Brazil="br",t.Barbados="bb",t.BruneiDarussalam="bn",t.Bhutan="bt",t.Botswana="bw",t.CentralAfricanRepublic="cf",t.Canada="ca",t.Switzerland="ch",t.Chile="cl",t.China="cn",t.CoteDIvoire="ci",t.Cameroon="cm",t.DemocraticRepublicOfTheCongo="cd",t.RepublicOfTheCongo="cg",t.Colombia="co",t.Comoros="km",t.CapeVerde="cv",t.CostaRica="cr",t.Cuba="cu",t.Cyprus="cy",t.CzechRepublic="cz",t.Germany="de",t.Djibouti="dj",t.Dominica="dm",t.Denmark="dk",t.DominicanRepublic="do",t.Algeria="dz",t.Ecuador="ec",t.Egypt="eg",t.Eritrea="er",t.Spain="es",t.Estonia="ee",t.Ethiopia="et",t.Finland="fi",t.Fiji="fj",t.France="fr",t.MicronesiaFederatedStatesOf="fm",t.Gabon="ga",t.UnitedKingdom="gb",t.Georgia="ge",t.Ghana="gh",t.Guinea="gn",t.Gambia="gm",t.GuineaBissau="gw",t.EquatorialGuinea="gq",t.Greece="gr",t.Grenada="gd",t.Guatemala="gt",t.Guyana="gy",t.Honduras="hn",t.Croatia="hr",t.Haiti="ht",t.Hungary="hu",t.Indonesia="id",t.India="in",t.Ireland="ie",t.IranIslamicRepublicOf="ir",t.Iraq="iq",t.Iceland="is",t.Israel="il",t.Italy="it",t.Jamaica="jm",t.Jordan="jo",t.Japan="jp",t.Kazakhstan="kz",t.Kenya="ke",t.Kyrgyzstan="kg",t.Cambodia="kh",t.Kiribati="ki",t.SaintKittsAndNevis="kn",t.SouthKorea="kr",t.Kuwait="kw",t.LaoPeopleSDemocraticRepublic="la",t.Lebanon="lb",t.Liberia="lr",t.Libya="ly",t.SaintLucia="lc",t.Liechtenstein="li",t.SriLanka="lk",t.Lesotho="ls",t.Lithuania="lt",t.Luxembourg="lu",t.Latvia="lv",t.Morocco="ma",t.Monaco="mc",t.Moldova="md",t.Madagascar="mg",t.Maldives="mv",t.Mexico="mx",t.MarshallIslands="mh",t.NorthMacedonia="mk",t.Mali="ml",t.Malta="mt",t.Myanmar="mm",t.Montenegro="me",t.Mongolia="mn",t.Mozambique="mz",t.Mauritania="mr",t.Mauritius="mu",t.Malawi="mw",t.Malaysia="my",t.Namibia="na",t.Niger="ne",t.Nigeria="ng",t.Nicaragua="ni",t.Netherlands="nl",t.Norway="no",t.Nepal="np",t.Nauru="nr",t.NewZealand="nz",t.Oman="om",t.Pakistan="pk",t.Panama="pa",t.Peru="pe",t.Philippines="ph",t.Palau="pw",t.PapuaNewGuinea="pg",t.Poland="pl",t.FrenchPolynesia="pf",t.NorthKorea="kp",t.Portugal="pt",t.Paraguay="py",t.Qatar="qa",t.Romania="ro",t.Russia="ru",t.Rwanda="rw",t.SaudiArabia="sa",t.Sudan="sd",t.Senegal="sn",t.Singapore="sg",t.SolomonIslands="sb",t.SierraLeone="sl",t.ElSalvador="sv",t.SanMarino="sm",t.Somalia="so",t.Serbia="rs",t.SouthSudan="ss",t.SaoTomeAndPrincipe="st",t.Suriname="sr",t.Slovakia="sk",t.Slovenia="si",t.Sweden="se",t.Eswatini="sz",t.Seychelles="sc",t.Syria="sy",t.Chad="td",t.Togo="tg",t.Thailand="th",t.Tajikistan="tj",t.Turkmenistan="tm",t.TimorLeste="tl",t.Tonga="to",t.TrinidadAndTobago="tt",t.Tunisia="tn",t.Turkey="tr",t.Tuvalu="tv",t.Tanzania="tz",t.Uganda="ug",t.Ukraine="ua",t.Uruguay="uy",t.UnitedStates="us",t.Uzbekistan="uz",t.VaticanCity="va",t.SaintVincentAndTheGrenadines="vc",t.Venezuela="ve",t.Vietnam="vn",t.Vanuatu="vu",t.Samoa="ws",t.Yemen="ye",t.SouthAfrica="za",t.Zambia="zm",t.Zimbabwe="zw"})(fc||(fc={}));var hc;(function(t){t.Light="light",t.Dark="dark"})(hc||(hc={}));var pc;(function(t){t.AfricaAbidjan="africa/abidjan",t.AfricaAccra="africa/accra",t.AfricaAddisAbaba="africa/addis_ababa",t.AfricaAlgiers="africa/algiers",t.AfricaAsmara="africa/asmara",t.AfricaBamako="africa/bamako",t.AfricaBangui="africa/bangui",t.AfricaBanjul="africa/banjul",t.AfricaBissau="africa/bissau",t.AfricaBlantyre="africa/blantyre",t.AfricaBrazzaville="africa/brazzaville",t.AfricaBujumbura="africa/bujumbura",t.AfricaCairo="africa/cairo",t.AfricaCasablanca="africa/casablanca",t.AfricaCeuta="africa/ceuta",t.AfricaConakry="africa/conakry",t.AfricaDakar="africa/dakar",t.AfricaDarEsSalaam="africa/dar_es_salaam",t.AfricaDjibouti="africa/djibouti",t.AfricaDouala="africa/douala",t.AfricaElAaiun="africa/el_aaiun",t.AfricaFreetown="africa/freetown",t.AfricaGaborone="africa/gaborone",t.AfricaHarare="africa/harare",t.AfricaJohannesburg="africa/johannesburg",t.AfricaJuba="africa/juba",t.AfricaKampala="africa/kampala",t.AfricaKhartoum="africa/khartoum",t.AfricaKigali="africa/kigali",t.AfricaKinshasa="africa/kinshasa",t.AfricaLagos="africa/lagos",t.AfricaLibreville="africa/libreville",t.AfricaLome="africa/lome",t.AfricaLuanda="africa/luanda",t.AfricaLubumbashi="africa/lubumbashi",t.AfricaLusaka="africa/lusaka",t.AfricaMalabo="africa/malabo",t.AfricaMaputo="africa/maputo",t.AfricaMaseru="africa/maseru",t.AfricaMbabane="africa/mbabane",t.AfricaMogadishu="africa/mogadishu",t.AfricaMonrovia="africa/monrovia",t.AfricaNairobi="africa/nairobi",t.AfricaNdjamena="africa/ndjamena",t.AfricaNiamey="africa/niamey",t.AfricaNouakchott="africa/nouakchott",t.AfricaOuagadougou="africa/ouagadougou",t.AfricaPortonovo="africa/porto-novo",t.AfricaSaoTome="africa/sao_tome",t.AfricaTripoli="africa/tripoli",t.AfricaTunis="africa/tunis",t.AfricaWindhoek="africa/windhoek",t.AmericaAdak="america/adak",t.AmericaAnchorage="america/anchorage",t.AmericaAnguilla="america/anguilla",t.AmericaAntigua="america/antigua",t.AmericaAraguaina="america/araguaina",t.AmericaArgentinaBuenosAires="america/argentina/buenos_aires",t.AmericaArgentinaCatamarca="america/argentina/catamarca",t.AmericaArgentinaCordoba="america/argentina/cordoba",t.AmericaArgentinaJujuy="america/argentina/jujuy",t.AmericaArgentinaLaRioja="america/argentina/la_rioja",t.AmericaArgentinaMendoza="america/argentina/mendoza",t.AmericaArgentinaRioGallegos="america/argentina/rio_gallegos",t.AmericaArgentinaSalta="america/argentina/salta",t.AmericaArgentinaSanJuan="america/argentina/san_juan",t.AmericaArgentinaSanLuis="america/argentina/san_luis",t.AmericaArgentinaTucuman="america/argentina/tucuman",t.AmericaArgentinaUshuaia="america/argentina/ushuaia",t.AmericaAruba="america/aruba",t.AmericaAsuncion="america/asuncion",t.AmericaAtikokan="america/atikokan",t.AmericaBahia="america/bahia",t.AmericaBahiaBanderas="america/bahia_banderas",t.AmericaBarbados="america/barbados",t.AmericaBelem="america/belem",t.AmericaBelize="america/belize",t.AmericaBlancsablon="america/blanc-sablon",t.AmericaBoaVista="america/boa_vista",t.AmericaBogota="america/bogota",t.AmericaBoise="america/boise",t.AmericaCambridgeBay="america/cambridge_bay",t.AmericaCampoGrande="america/campo_grande",t.AmericaCancun="america/cancun",t.AmericaCaracas="america/caracas",t.AmericaCayenne="america/cayenne",t.AmericaCayman="america/cayman",t.AmericaChicago="america/chicago",t.AmericaChihuahua="america/chihuahua",t.AmericaCiudadJuarez="america/ciudad_juarez",t.AmericaCostaRica="america/costa_rica",t.AmericaCoyhaique="america/coyhaique",t.AmericaCreston="america/creston",t.AmericaCuiaba="america/cuiaba",t.AmericaCuracao="america/curacao",t.AmericaDanmarkshavn="america/danmarkshavn",t.AmericaDawson="america/dawson",t.AmericaDawsonCreek="america/dawson_creek",t.AmericaDenver="america/denver",t.AmericaDetroit="america/detroit",t.AmericaDominica="america/dominica",t.AmericaEdmonton="america/edmonton",t.AmericaEirunepe="america/eirunepe",t.AmericaElSalvador="america/el_salvador",t.AmericaFortNelson="america/fort_nelson",t.AmericaFortaleza="america/fortaleza",t.AmericaGlaceBay="america/glace_bay",t.AmericaGooseBay="america/goose_bay",t.AmericaGrandTurk="america/grand_turk",t.AmericaGrenada="america/grenada",t.AmericaGuadeloupe="america/guadeloupe",t.AmericaGuatemala="america/guatemala",t.AmericaGuayaquil="america/guayaquil",t.AmericaGuyana="america/guyana",t.AmericaHalifax="america/halifax",t.AmericaHavana="america/havana",t.AmericaHermosillo="america/hermosillo",t.AmericaIndianaIndianapolis="america/indiana/indianapolis",t.AmericaIndianaKnox="america/indiana/knox",t.AmericaIndianaMarengo="america/indiana/marengo",t.AmericaIndianaPetersburg="america/indiana/petersburg",t.AmericaIndianaTellCity="america/indiana/tell_city",t.AmericaIndianaVevay="america/indiana/vevay",t.AmericaIndianaVincennes="america/indiana/vincennes",t.AmericaIndianaWinamac="america/indiana/winamac",t.AmericaInuvik="america/inuvik",t.AmericaIqaluit="america/iqaluit",t.AmericaJamaica="america/jamaica",t.AmericaJuneau="america/juneau",t.AmericaKentuckyLouisville="america/kentucky/louisville",t.AmericaKentuckyMonticello="america/kentucky/monticello",t.AmericaKralendijk="america/kralendijk",t.AmericaLaPaz="america/la_paz",t.AmericaLima="america/lima",t.AmericaLosAngeles="america/los_angeles",t.AmericaLowerPrinces="america/lower_princes",t.AmericaMaceio="america/maceio",t.AmericaManagua="america/managua",t.AmericaManaus="america/manaus",t.AmericaMarigot="america/marigot",t.AmericaMartinique="america/martinique",t.AmericaMatamoros="america/matamoros",t.AmericaMazatlan="america/mazatlan",t.AmericaMenominee="america/menominee",t.AmericaMerida="america/merida",t.AmericaMetlakatla="america/metlakatla",t.AmericaMexicoCity="america/mexico_city",t.AmericaMiquelon="america/miquelon",t.AmericaMoncton="america/moncton",t.AmericaMonterrey="america/monterrey",t.AmericaMontevideo="america/montevideo",t.AmericaMontserrat="america/montserrat",t.AmericaNassau="america/nassau",t.AmericaNewYork="america/new_york",t.AmericaNome="america/nome",t.AmericaNoronha="america/noronha",t.AmericaNorthDakotaBeulah="america/north_dakota/beulah",t.AmericaNorthDakotaCenter="america/north_dakota/center",t.AmericaNorthDakotaNewSalem="america/north_dakota/new_salem",t.AmericaNuuk="america/nuuk",t.AmericaOjinaga="america/ojinaga",t.AmericaPanama="america/panama",t.AmericaParamaribo="america/paramaribo",t.AmericaPhoenix="america/phoenix",t.AmericaPortauprince="america/port-au-prince",t.AmericaPortOfSpain="america/port_of_spain",t.AmericaPortoVelho="america/porto_velho",t.AmericaPuertoRico="america/puerto_rico",t.AmericaPuntaArenas="america/punta_arenas",t.AmericaRankinInlet="america/rankin_inlet",t.AmericaRecife="america/recife",t.AmericaRegina="america/regina",t.AmericaResolute="america/resolute",t.AmericaRioBranco="america/rio_branco",t.AmericaSantarem="america/santarem",t.AmericaSantiago="america/santiago",t.AmericaSantoDomingo="america/santo_domingo",t.AmericaSaoPaulo="america/sao_paulo",t.AmericaScoresbysund="america/scoresbysund",t.AmericaSitka="america/sitka",t.AmericaStBarthelemy="america/st_barthelemy",t.AmericaStJohns="america/st_johns",t.AmericaStKitts="america/st_kitts",t.AmericaStLucia="america/st_lucia",t.AmericaStThomas="america/st_thomas",t.AmericaStVincent="america/st_vincent",t.AmericaSwiftCurrent="america/swift_current",t.AmericaTegucigalpa="america/tegucigalpa",t.AmericaThule="america/thule",t.AmericaTijuana="america/tijuana",t.AmericaToronto="america/toronto",t.AmericaTortola="america/tortola",t.AmericaVancouver="america/vancouver",t.AmericaWhitehorse="america/whitehorse",t.AmericaWinnipeg="america/winnipeg",t.AmericaYakutat="america/yakutat",t.AntarcticaCasey="antarctica/casey",t.AntarcticaDavis="antarctica/davis",t.AntarcticaDumontdurville="antarctica/dumontdurville",t.AntarcticaMacquarie="antarctica/macquarie",t.AntarcticaMawson="antarctica/mawson",t.AntarcticaMcmurdo="antarctica/mcmurdo",t.AntarcticaPalmer="antarctica/palmer",t.AntarcticaRothera="antarctica/rothera",t.AntarcticaSyowa="antarctica/syowa",t.AntarcticaTroll="antarctica/troll",t.AntarcticaVostok="antarctica/vostok",t.ArcticLongyearbyen="arctic/longyearbyen",t.AsiaAden="asia/aden",t.AsiaAlmaty="asia/almaty",t.AsiaAmman="asia/amman",t.AsiaAnadyr="asia/anadyr",t.AsiaAqtau="asia/aqtau",t.AsiaAqtobe="asia/aqtobe",t.AsiaAshgabat="asia/ashgabat",t.AsiaAtyrau="asia/atyrau",t.AsiaBaghdad="asia/baghdad",t.AsiaBahrain="asia/bahrain",t.AsiaBaku="asia/baku",t.AsiaBangkok="asia/bangkok",t.AsiaBarnaul="asia/barnaul",t.AsiaBeirut="asia/beirut",t.AsiaBishkek="asia/bishkek",t.AsiaBrunei="asia/brunei",t.AsiaChita="asia/chita",t.AsiaColombo="asia/colombo",t.AsiaDamascus="asia/damascus",t.AsiaDhaka="asia/dhaka",t.AsiaDili="asia/dili",t.AsiaDubai="asia/dubai",t.AsiaDushanbe="asia/dushanbe",t.AsiaFamagusta="asia/famagusta",t.AsiaGaza="asia/gaza",t.AsiaHebron="asia/hebron",t.AsiaHoChiMinh="asia/ho_chi_minh",t.AsiaHongKong="asia/hong_kong",t.AsiaHovd="asia/hovd",t.AsiaIrkutsk="asia/irkutsk",t.AsiaJakarta="asia/jakarta",t.AsiaJayapura="asia/jayapura",t.AsiaJerusalem="asia/jerusalem",t.AsiaKabul="asia/kabul",t.AsiaKamchatka="asia/kamchatka",t.AsiaKarachi="asia/karachi",t.AsiaKathmandu="asia/kathmandu",t.AsiaKhandyga="asia/khandyga",t.AsiaKolkata="asia/kolkata",t.AsiaKrasnoyarsk="asia/krasnoyarsk",t.AsiaKualaLumpur="asia/kuala_lumpur",t.AsiaKuching="asia/kuching",t.AsiaKuwait="asia/kuwait",t.AsiaMacau="asia/macau",t.AsiaMagadan="asia/magadan",t.AsiaMakassar="asia/makassar",t.AsiaManila="asia/manila",t.AsiaMuscat="asia/muscat",t.AsiaNicosia="asia/nicosia",t.AsiaNovokuznetsk="asia/novokuznetsk",t.AsiaNovosibirsk="asia/novosibirsk",t.AsiaOmsk="asia/omsk",t.AsiaOral="asia/oral",t.AsiaPhnomPenh="asia/phnom_penh",t.AsiaPontianak="asia/pontianak",t.AsiaPyongyang="asia/pyongyang",t.AsiaQatar="asia/qatar",t.AsiaQostanay="asia/qostanay",t.AsiaQyzylorda="asia/qyzylorda",t.AsiaRiyadh="asia/riyadh",t.AsiaSakhalin="asia/sakhalin",t.AsiaSamarkand="asia/samarkand",t.AsiaSeoul="asia/seoul",t.AsiaShanghai="asia/shanghai",t.AsiaSingapore="asia/singapore",t.AsiaSrednekolymsk="asia/srednekolymsk",t.AsiaTaipei="asia/taipei",t.AsiaTashkent="asia/tashkent",t.AsiaTbilisi="asia/tbilisi",t.AsiaTehran="asia/tehran",t.AsiaThimphu="asia/thimphu",t.AsiaTokyo="asia/tokyo",t.AsiaTomsk="asia/tomsk",t.AsiaUlaanbaatar="asia/ulaanbaatar",t.AsiaUrumqi="asia/urumqi",t.AsiaUstnera="asia/ust-nera",t.AsiaVientiane="asia/vientiane",t.AsiaVladivostok="asia/vladivostok",t.AsiaYakutsk="asia/yakutsk",t.AsiaYangon="asia/yangon",t.AsiaYekaterinburg="asia/yekaterinburg",t.AsiaYerevan="asia/yerevan",t.AtlanticAzores="atlantic/azores",t.AtlanticBermuda="atlantic/bermuda",t.AtlanticCanary="atlantic/canary",t.AtlanticCapeVerde="atlantic/cape_verde",t.AtlanticFaroe="atlantic/faroe",t.AtlanticMadeira="atlantic/madeira",t.AtlanticReykjavik="atlantic/reykjavik",t.AtlanticSouthGeorgia="atlantic/south_georgia",t.AtlanticStHelena="atlantic/st_helena",t.AtlanticStanley="atlantic/stanley",t.AustraliaAdelaide="australia/adelaide",t.AustraliaBrisbane="australia/brisbane",t.AustraliaBrokenHill="australia/broken_hill",t.AustraliaDarwin="australia/darwin",t.AustraliaEucla="australia/eucla",t.AustraliaHobart="australia/hobart",t.AustraliaLindeman="australia/lindeman",t.AustraliaLordHowe="australia/lord_howe",t.AustraliaMelbourne="australia/melbourne",t.AustraliaPerth="australia/perth",t.AustraliaSydney="australia/sydney",t.EuropeAmsterdam="europe/amsterdam",t.EuropeAndorra="europe/andorra",t.EuropeAstrakhan="europe/astrakhan",t.EuropeAthens="europe/athens",t.EuropeBelgrade="europe/belgrade",t.EuropeBerlin="europe/berlin",t.EuropeBratislava="europe/bratislava",t.EuropeBrussels="europe/brussels",t.EuropeBucharest="europe/bucharest",t.EuropeBudapest="europe/budapest",t.EuropeBusingen="europe/busingen",t.EuropeChisinau="europe/chisinau",t.EuropeCopenhagen="europe/copenhagen",t.EuropeDublin="europe/dublin",t.EuropeGibraltar="europe/gibraltar",t.EuropeGuernsey="europe/guernsey",t.EuropeHelsinki="europe/helsinki",t.EuropeIsleOfMan="europe/isle_of_man",t.EuropeIstanbul="europe/istanbul",t.EuropeJersey="europe/jersey",t.EuropeKaliningrad="europe/kaliningrad",t.EuropeKirov="europe/kirov",t.EuropeKyiv="europe/kyiv",t.EuropeLisbon="europe/lisbon",t.EuropeLjubljana="europe/ljubljana",t.EuropeLondon="europe/london",t.EuropeLuxembourg="europe/luxembourg",t.EuropeMadrid="europe/madrid",t.EuropeMalta="europe/malta",t.EuropeMariehamn="europe/mariehamn",t.EuropeMinsk="europe/minsk",t.EuropeMonaco="europe/monaco",t.EuropeMoscow="europe/moscow",t.EuropeOslo="europe/oslo",t.EuropeParis="europe/paris",t.EuropePodgorica="europe/podgorica",t.EuropePrague="europe/prague",t.EuropeRiga="europe/riga",t.EuropeRome="europe/rome",t.EuropeSamara="europe/samara",t.EuropeSanMarino="europe/san_marino",t.EuropeSarajevo="europe/sarajevo",t.EuropeSaratov="europe/saratov",t.EuropeSimferopol="europe/simferopol",t.EuropeSkopje="europe/skopje",t.EuropeSofia="europe/sofia",t.EuropeStockholm="europe/stockholm",t.EuropeTallinn="europe/tallinn",t.EuropeTirane="europe/tirane",t.EuropeUlyanovsk="europe/ulyanovsk",t.EuropeVaduz="europe/vaduz",t.EuropeVatican="europe/vatican",t.EuropeVienna="europe/vienna",t.EuropeVilnius="europe/vilnius",t.EuropeVolgograd="europe/volgograd",t.EuropeWarsaw="europe/warsaw",t.EuropeZagreb="europe/zagreb",t.EuropeZurich="europe/zurich",t.IndianAntananarivo="indian/antananarivo",t.IndianChagos="indian/chagos",t.IndianChristmas="indian/christmas",t.IndianCocos="indian/cocos",t.IndianComoro="indian/comoro",t.IndianKerguelen="indian/kerguelen",t.IndianMahe="indian/mahe",t.IndianMaldives="indian/maldives",t.IndianMauritius="indian/mauritius",t.IndianMayotte="indian/mayotte",t.IndianReunion="indian/reunion",t.PacificApia="pacific/apia",t.PacificAuckland="pacific/auckland",t.PacificBougainville="pacific/bougainville",t.PacificChatham="pacific/chatham",t.PacificChuuk="pacific/chuuk",t.PacificEaster="pacific/easter",t.PacificEfate="pacific/efate",t.PacificFakaofo="pacific/fakaofo",t.PacificFiji="pacific/fiji",t.PacificFunafuti="pacific/funafuti",t.PacificGalapagos="pacific/galapagos",t.PacificGambier="pacific/gambier",t.PacificGuadalcanal="pacific/guadalcanal",t.PacificGuam="pacific/guam",t.PacificHonolulu="pacific/honolulu",t.PacificKanton="pacific/kanton",t.PacificKiritimati="pacific/kiritimati",t.PacificKosrae="pacific/kosrae",t.PacificKwajalein="pacific/kwajalein",t.PacificMajuro="pacific/majuro",t.PacificMarquesas="pacific/marquesas",t.PacificMidway="pacific/midway",t.PacificNauru="pacific/nauru",t.PacificNiue="pacific/niue",t.PacificNorfolk="pacific/norfolk",t.PacificNoumea="pacific/noumea",t.PacificPagoPago="pacific/pago_pago",t.PacificPalau="pacific/palau",t.PacificPitcairn="pacific/pitcairn",t.PacificPohnpei="pacific/pohnpei",t.PacificPortMoresby="pacific/port_moresby",t.PacificRarotonga="pacific/rarotonga",t.PacificSaipan="pacific/saipan",t.PacificTahiti="pacific/tahiti",t.PacificTarawa="pacific/tarawa",t.PacificTongatapu="pacific/tongatapu",t.PacificWake="pacific/wake",t.PacificWallis="pacific/wallis",t.Utc="utc"})(pc||(pc={}));var gc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(gc||(gc={}));var fn;(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.DELETE="DELETE",t.OPTIONS="OPTIONS",t.HEAD="HEAD"})(fn||(fn={}));var mc;(function(t){t.Center="center",t.Topleft="top-left",t.Top="top",t.Topright="top-right",t.Left="left",t.Right="right",t.Bottomleft="bottom-left",t.Bottom="bottom",t.Bottomright="bottom-right"})(mc||(mc={}));var yc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(yc||(yc={}));var wc;(function(t){t.Http="http",t.Schedule="schedule",t.Event="event"})(wc||(wc={}));var vc;(function(t){t.Waiting="waiting",t.Processing="processing",t.Completed="completed",t.Failed="failed",t.Scheduled="scheduled"})(vc||(vc={}));const Xe={endpoint:"https://aw.oupla.net/v1",projectId:"696b7acb0037bde79e3f",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3",usersTeamsManager:"692cb2cd000cbb24549c",enkaData:"68f00487000c624533a3"},collections:{events:"main",ingredients:"ingredients",main:"main",purchases:"purchases",products:"products",kteams:"kteams",locks:"locks",user_notifications:"user_notifications",materiel_loan:"materiel_loan",teamdocs:"teamdocs"}};let Pr=null;async function D(){if(Pr)return Pr;console.log("[appwrite] Initialisation des instances Appwrite...");const t=new Vt().setEndpoint(Xe.endpoint).setProject(Xe.projectId),e=new Ph(t),r=new Dh(t),s=new $h(t),n=new Mh(t),a=new Ch(t);return Pr={client:t,account:e,databases:r,tables:s,functions:n,teams:a,config:Xe},console.log("[appwrite] Instances initialisÃ©es avec succÃ¨s"),Pr}function Xl(){console.log("[appwrite] Cache rÃ©initialisÃ©"),Pr=null}function ls(){return{APPWRITE_ENDPOINT:Xe.endpoint,APPWRITE_PROJECT_ID:Xe.projectId,APPWRITE_DATABASE_ID:Xe.databaseId,APPWRITE_FUNCTION_ID:Xe.functions.batchUpdate,ACCESS_REQUEST_FUNCTION_ID:Xe.functions.accessRequest,MANAGE_RECIPE_FUNCTION_ID:Xe.functions.enkaData,APPWRITE_CONFIG:Xe}}async function kh(t,e){Pr||(console.log("[appwrite] Subscribe appelÃ© avant initialisation, initialisation forcÃ©e..."),await D());const r=Array.isArray(t)?t:[t];return console.log("[appwrite] Subscribe aux channels:",r),Pr.client.subscribe(t,n=>{n.event==="client.connected"&&console.log("[appwrite] â WebSocket connectÃ© avec succÃ¨s"),e(n)})}function Nh(){return Pr!==null}function at(){return Xe.databaseId}function fr(t){return Xe.collections[t]}function Zl(t){return Xe.functions[t]}const Am=Object.freeze(Object.defineProperty({__proto__:null,clearAppwriteCache:Xl,getAppwriteConfig:ls,getAppwriteInstances:D,getCollectionId:fr,getDatabaseId:at,getFunctionId:Zl,isInitialized:Nh,subscribe:kh},Symbol.toStringTag,{value:"Module"}));let Th=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");function Lh(t,e){const r=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),s=e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"";let n;if(s){const a=r.slice(0,16),o=s.slice(0,5);n=`${a}-${o}`}else n=r.slice(0,22);return`${n}_${Th(12).toLowerCase()}`}const jh=new xl(()=>window.scrollY,t=>Va(window,"scroll",t)),qh={loading:0,success:2e3,info:3e3,warning:5e3,error:0},Uh=2;var ce,is,zl,Ji;class Bh{constructor(){y(this,is);y(this,ce,P(ge([])));C(this,"MAX_TOASTS",3)}get toasts(){return[...f(i(this,ce))].sort((e,r)=>r.timestamp-e.timestamp)}create(e){const r=e.id||crypto.randomUUID(),s={id:r,state:e.state,message:e.message,timestamp:Date.now(),source:e.source||"user",position:e.position,timeoutId:void 0,autoCloseDelay:e.autoCloseDelay,details:e.details,actions:e.actions||[]};return v(this,is,zl).call(this,s),r}update(e,r){const s=f(i(this,ce)).findIndex(a=>a.id===e);if(s===-1)return;const n=f(i(this,ce))[s];n.timeoutId&&clearTimeout(n.timeoutId),n.loadingTimeoutId&&clearTimeout(n.loadingTimeoutId),f(i(this,ce))[s]={...n,state:r.state||n.state,message:r.message||n.message,source:r.source||n.source,position:r.position||n.position,actions:r.actions||n.actions,autoCloseDelay:r.autoCloseDelay!==void 0?r.autoCloseDelay:n.autoCloseDelay,loadingTimeoutId:void 0},v(this,is,Ji).call(this,f(i(this,ce))[s])}async track(e,r){const s=this.create({id:r.id,state:"loading",message:r.loading,source:"user",position:r.position});try{const n=await e;return this.update(s,{state:"success",message:r.success||"OpÃ©ration rÃ©ussie",autoCloseDelay:r.successDelay}),n}catch(n){throw this.update(s,{state:"error",message:r.error||"Erreur lors de l'opÃ©ration",autoCloseDelay:r.errorDelay}),n}}dismiss(e){const r=f(i(this,ce)).findIndex(n=>n.id===e);if(r===-1)return;const s=f(i(this,ce))[r];s.timeoutId&&clearTimeout(s.timeoutId),s.loadingTimeoutId&&clearTimeout(s.loadingTimeoutId),f(i(this,ce)).splice(r,1)}dismissAll(){f(i(this,ce)).forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.loadingTimeoutId&&clearTimeout(e.loadingTimeoutId)}),g(i(this,ce),[],!0)}success(e,r){return this.create({state:"success",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}error(e,r){return this.create({state:"error",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}warning(e,r){return this.create({state:"warning",message:e,source:r?.source||"system",details:r?.details,actions:r?.actions,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}info(e,r){return this.create({state:"info",message:e,source:r?.source||"system",details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}loading(e,r){const n=r?.autoCloseDelay??3e4,a=this.create({state:"loading",message:e,details:r?.details,autoCloseDelay:n,position:r?.position}),o=setTimeout(()=>{this.update(a,{state:"warning",message:"Ãchec, temps expirÃ©",autoCloseDelay:2e3})},n-2e3),c=f(i(this,ce)).findIndex(l=>l.id===a);return c!==-1&&(f(i(this,ce))[c].loadingTimeoutId=o),a}}ce=new WeakMap,is=new WeakSet,zl=function(e){const r=f(i(this,ce)).findIndex(s=>s.source===e.source);if(r>=0){const s=f(i(this,ce))[r];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,ce))[r]=e}else if(f(i(this,ce)).length<this.MAX_TOASTS)f(i(this,ce)).push(e);else{const s=f(i(this,ce))[0];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,ce)).shift(),f(i(this,ce)).push(e)}v(this,is,Ji).call(this,e)},Ji=function(e){e.timeoutId&&clearTimeout(e.timeoutId);let r;if(e.autoCloseDelay!==void 0)r=e.autoCloseDelay===0?void 0:e.autoCloseDelay;else{const s=qh[e.state];e.source==="realtime-other"&&s>0?r=s*Uh:r=s===0?void 0:s}r!==void 0&&(e.timeoutId=setTimeout(()=>{this.dismiss(e.id)},r))};const xe=new Bh;async function Oh(){const{teams:t}=await D();return await t.list()}async function xh(t){const{teams:e}=await D();return await e.get({teamId:t})}async function Hh(t){const{teams:e}=await D();return await e.create({teamId:lt.unique(),name:t})}async function Wh(t,e){const{teams:r}=await D();return await r.updateName({teamId:t,name:e})}async function Gh(t){const{teams:e}=await D();await e.delete({teamId:t})}async function Vh(t){const{teams:e}=await D();return await e.listMemberships({teamId:t})}async function Qh(t,e){const{teams:r}=await D();await r.deleteMembership({teamId:t,membershipId:e})}async function Jh(t,e,r){const{functions:s}=await D(),n=Zl("usersTeamsManager"),a={action:"native-invite",teamId:t,emails:e,message:r},o=await s.createExecution({functionId:n,body:JSON.stringify(a)});if(o.status!=="completed")throw new Error(`Erreur lors de l'invitation : ${o.errors}`);return JSON.parse(o.responseBody)}async function bc(t,e){const{teams:r}=await D();return await r.updatePrefs({teamId:t,prefs:e})}var Mt,Kr,Yt,si,Fl;class Kh{constructor(){y(this,si);y(this,Mt,[]);y(this,Kr,null);y(this,Yt,!1)}register(e,r){i(this,Yt)&&console.warn("[RealtimeManager] Enregistrement aprÃ¨s initialisation. Utilisez registerDynamic() pour les inscriptions dynamiques."),i(this,Mt).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels enregistrÃ©s:",e)}registerDynamic(e,r){return i(this,Mt).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels dynamiques enregistrÃ©s:",e),i(this,Yt)&&v(this,si,Fl).call(this,e,r),()=>{const s=i(this,Mt).findIndex(n=>n.channels===e&&n.callback===r);s!==-1&&(i(this,Mt).splice(s,1),console.log("[RealtimeManager] Channels dynamiques dÃ©senregistrÃ©s:",e))}}async initialize(){if(i(this,Yt))return;const e=[...new Set(i(this,Mt).flatMap(r=>r.channels))];if(e.length===0){console.log("[RealtimeManager] Aucun channel Ã  souscrire."),I(this,Yt,!0);return}try{console.log(`[RealtimeManager] Initialisation de la connexion unique avec ${e.length} channels...`);const{client:r}=await D();I(this,Kr,r.subscribe(e,s=>{for(const n of i(this,Mt))s.channels.some(o=>n.channels.includes(o))&&n.callback(s)})),I(this,Yt,!0),console.log("[RealtimeManager] â Connexion Realtime Ã©tablie.")}catch(r){throw console.error("[RealtimeManager] Erreur lors de l'initialisation:",r),r}}destroy(){i(this,Kr)&&(i(this,Kr).call(this),I(this,Kr,null)),I(this,Mt,[]),I(this,Yt,!1),console.log("[RealtimeManager] Connexion Realtime fermÃ©e.")}}Mt=new WeakMap,Kr=new WeakMap,Yt=new WeakMap,si=new WeakSet,Fl=async function(e,r){try{console.log(`[RealtimeManager] Ajout de ${e.length} channels Ã  la connexion existante...`);const{client:s}=await D();s.subscribe(e,n=>{r(n)}),console.log("[RealtimeManager] â Channels dynamiques ajoutÃ©s:",e)}catch(s){console.error("[RealtimeManager] Erreur lors de l'ajout de channels dynamiques:",s)}};const Bt=new Kh;var Le,mr,Yr,Xt,Ps,bn,Cr,Na,eu;class Yh{constructor(){y(this,Cr);y(this,Le,new ct);y(this,mr,P(!1));y(this,Yr,P(null));y(this,Xt,P(!1));y(this,Ps,!1);y(this,bn,Z(()=>Array.from(i(this,Le).values())))}get loading(){return f(i(this,mr))}get error(){return f(i(this,Yr))}get isInitialized(){return f(i(this,Xt))}get count(){return i(this,Le).size}get teams(){return f(i(this,bn))}isUserInAnyTeam(e){return Array.from(i(this,Le).values()).some(r=>r.members?.some(s=>s.id===e))}get myTeams(){return L.userId?f(i(this,bn)):[]}async loadCache(){if(!f(i(this,Xt))){if(!L.userId){g(i(this,Xt),!0);return}g(i(this,Xt),!0),console.log("[NativeTeamsStore] Cache chargÃ© : 0 Ã©quipes (pas de cache)")}}async syncFromRemote(){g(i(this,mr),!0),g(i(this,Yr),null);try{if(!L.userId)return;await v(this,Cr,Na).call(this),console.log(`[NativeTeamsStore] Sync terminÃ© : ${i(this,Le).size} Ã©quipes`)}catch(e){throw g(i(this,Yr),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[NativeTeamsStore] SyncFromRemote error:",e),e}finally{g(i(this,mr),!1)}}async setupRealtime(){if(L.userId){if(i(this,Ps)){console.log("[NativeTeamsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,Cr,eu).call(this),I(this,Ps,!0),console.log("[NativeTeamsStore] Realtime configurÃ©")}catch(e){throw g(i(this,Yr),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[NativeTeamsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async hardReset(){console.log("[NativeTeamsStore] Hard reset..."),i(this,Le).clear(),g(i(this,Xt),!1),await this.initialize(),console.log("[NativeTeamsStore] Hard reset terminÃ©")}getTeamById(e){return i(this,Le).get(e)}getTeamMemberNames(e){const r=i(this,Le).get(e);return!r||!r.members?[]:r.members.map(s=>s.name?s.name:s.userEmail?s.userEmail.split("@")[0]:"Inconnu").filter(Boolean)}async fetchTeam(e){try{const r=await xh(e),s=await Vh(e),n={$id:r.$id,name:r.name,total:r.total,$createdAt:r.$createdAt,$updatedAt:r.$updatedAt,prefs:r.prefs,members:s.memberships.map(a=>({$id:a.$id,id:a.userId,name:a.userName,userEmail:a.userEmail,roles:a.roles,joinedAt:a.joined,confirmed:a.confirm}))};return i(this,Le).set(e,n),n}catch(r){return console.error(`[NativeTeamsStore] Error fetching team ${e}:`,r),null}}async createTeam(e,r){const s=await Hh(e);r&&Object.keys(r).length>0&&await bc(s.$id,r);const n=await this.fetchTeam(s.$id);if(!n)throw new Error("Erreur aprÃ¨s crÃ©ation d'Ã©quipe");return n}async updateTeam(e,r,s){r&&await Wh(e,r),s&&Object.keys(s).length>0&&await bc(e,s),await this.fetchTeam(e)}async deleteTeam(e){await Gh(e),i(this,Le).delete(e)}async inviteTeamMember(e,r,s){await Jh(e,r,s),await this.fetchTeam(e)}async removeMember(e,r){await Qh(e,r),await this.fetchTeam(e)}async reload(){g(i(this,mr),!0);try{i(this,Le).clear(),await v(this,Cr,Na).call(this)}finally{g(i(this,mr),!1)}}destroy(){i(this,Le).clear(),g(i(this,Xt),!1),I(this,Ps,!1)}}Le=new WeakMap,mr=new WeakMap,Yr=new WeakMap,Xt=new WeakMap,Ps=new WeakMap,bn=new WeakMap,Cr=new WeakSet,Na=async function(){const e=await Oh();for(const r of e.teams)await this.fetchTeam(r.$id)},eu=async function(){Bt.register(["teams","memberships"],async e=>{console.log("[NativeTeamsStore] â¡ï¸ Realtime RECEIVED:",e.events),await v(this,Cr,Na).call(this)})};const ht=new Yh;async function Ht(t,e={}){const{maxAttempts:r=3,timeout:s=1e4,context:n="Operation",successMessage:a,errorMessage:o,retryDelay:c=1e3,silent:l=!1}=e;let u=null;for(let d=1;d<=r;d++)try{console.log(`[${n}] Tentative ${d}/${r}`);const h=await Promise.race([t(),Xh(s)]);return d>1&&console.log(`[${n}] â SuccÃ¨s aprÃ¨s ${d} tentatives`),a&&!l&&xe.success(a),h}catch(h){if(u=h instanceof Error?h:new Error(String(h)),console.error(`[${n}] â Tentative ${d}/${r} Ã©chouÃ©e:`,u.message),d===r)throw console.error(`[${n}] â Ãchec aprÃ¨s ${r} tentatives`),o&&!l&&xe.error(o),u;const p=c*d;console.log(`[${n}] Nouvelle tentative dans ${p}ms...`),await Zh(p)}throw u||new Error(`${n}: Ãchec inconnu`)}function Xh(t){return new Promise((e,r)=>{setTimeout(()=>{r(new Error(`Timeout aprÃ¨s ${t}ms`))},t)})}function Zh(t){return new Promise(e=>setTimeout(e,t))}function pa(t,e={}){const{fallback:r=null,context:s="JSON.parse"}=e;try{return JSON.parse(t)}catch(n){return console.error(`[${s}] â JSON invalide:`,n instanceof Error?n.message:n),r}}function po(t,e={}){const{context:r="JSON.parseArray",itemFallback:s}=e;return!t||!Array.isArray(t)?(console.warn(`[${r}] Tableau vide ou invalide`),[]):t.map((n,a)=>{const o=pa(n,{context:`${r}[${a}]`,fallback:void 0});return o===void 0&&s?s(n,a):o}).filter(n=>n!==null)}const{APPWRITE_CONFIG:Nr}=ls(),Ys="main";async function Ec(t,e=null){return Ht(async()=>{const{tables:r}=await D(),s=[E.orderDesc("dateStart")];return e&&s.push(E.greaterThanEqual("dateEnd",e)),{events:(await r.listRows({databaseId:Nr.databaseId,tableId:Ys,queries:s})).rows}},{context:"AppwriteEvents.listEvents",timeout:2e4,errorMessage:"Erreur lors du chargement des Ã©vÃ©nements"})}async function zh(t){try{return await Ht(async()=>{const{tables:e}=await D();return await e.getRow({databaseId:Nr.databaseId,tableId:Ys,rowId:t})},{context:"AppwriteEvents.getEvent",timeout:1e4,errorMessage:"Erreur lors du chargement de l'Ã©vÃ©nement"})}catch(e){if(e.code===404)return null;throw e}}async function Fh(t,e){return Ht(async()=>{const{tables:r}=await D(),s=lt.unique(),n=await r.createRow({databaseId:Nr.databaseId,tableId:Ys,rowId:s,data:{name:t.name,dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(o=>JSON.stringify(o)):[],createdBy:e,teams:t.teams??[],contributors:t.contributors?t.contributors.map(o=>JSON.stringify(o)):[],todos:t.todos?t.todos.map(o=>JSON.stringify(o)):[]}});console.log(`[appwrite-events] Event created: ${s}`);const{functions:a}=await D();return await a.createExecution({functionId:Nr.functions.usersTeamsManager,body:JSON.stringify({action:"add-label-to-user",mainId:s,userId:e}),async:!1}),console.log(`[appwrite-events] Label ${s} attribuÃ© au crÃ©ateur ${e}`),n},{context:"AppwriteEvents.createEvent",timeout:15e3,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function ep(t,e,r=[],s=!0){return Ht(async()=>{const{functions:n}=await D(),a={name:t.name,description:t.description||"",dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(u=>JSON.stringify(u)):[],createdBy:e,teams:t.teams||[],teamsId:t.teamsId||[],contributors:t.contributors?t.contributors.map(u=>JSON.stringify(u)):[],todos:t.todos?t.todos.map(u=>JSON.stringify(u)):[],status:t.status||"proposition"};console.log(`[appwrite-events] CrÃ©ation Ã©vÃ©nement avec ${r.length} team(s)`);const o=await n.createExecution({functionId:Nr.functions.usersTeamsManager,body:JSON.stringify({action:"create-event-with-teams",eventData:a,creatorId:e,teamIds:r,sendEmailToExistingMembers:s}),async:!1}),c=JSON.parse(o.responseBody);if(!c.success)throw new Error(c.error||"Erreur lors de la crÃ©ation");return console.log(`[appwrite-events] ÃvÃ©nement crÃ©Ã© avec teams: ${c.eventId}`),c.event},{context:"AppwriteEvents.createEventWithTeams",timeout:3e4,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function Sc(t,e){return Ht(async()=>{const{tables:r}=await D(),s={...e};e.meals&&(s.meals=e.meals.map(a=>JSON.stringify(a))),e.contributors&&(s.contributors=Array.isArray(e.contributors)?e.contributors.map(a=>JSON.stringify(a)):[]),e.todos&&(s.todos=e.todos.map(a=>JSON.stringify(a))),e.allDates&&(s.allDates=e.allDates);const n=await r.updateRow({databaseId:Nr.databaseId,tableId:Ys,rowId:t,data:s});return console.log(`[appwrite-events] Event updated: ${t}`),n},{context:"AppwriteEvents.updateEvent",timeout:1e4,successMessage:"ÃvÃ©nement mis Ã  jour",errorMessage:"Erreur lors de la mise Ã  jour"})}async function tp(t){return Ht(async()=>{const{tables:e,functions:r}=await D();await e.deleteRow({databaseId:Nr.databaseId,tableId:Ys,rowId:t}),console.log(`[appwrite-events] Event deleted: ${t}`),await r.createExecution({functionId:Nr.functions.usersTeamsManager,body:JSON.stringify({action:"delete-event-label",mainId:t}),async:!0}),console.log(`[appwrite-events] Label deletion initiated for event: ${t}`)},{context:"AppwriteEvents.deleteEvent",timeout:1e4,successMessage:"ÃvÃ©nement supprimÃ©",errorMessage:"Erreur lors de la suppression"})}function rp(t){return po(t,{context:"parseEventMeals",itemFallback:(e,r)=>(console.warn(`[parseEventMeals] Meal ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,name:"Repas inconnu",date:new Date().toISOString(),guests:1,recipes:[]})})}function sp(t){return po(t,{context:"parseEventContributors",itemFallback:(e,r)=>(console.warn(`[parseEventContributors] Contributor ${r} invalide, utilisation d'un fallback`,e),{id:typeof e=="string"?e:`unknown-${r}`,status:"accepted",invitedAt:new Date().toISOString()})})}function np(t){return po(t,{context:"parseEventTodos",itemFallback:(e,r)=>(console.warn(`[parseEventTodos] Todo ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,taskName:"TÃ¢che invalide",taskDescription:null,dueDate:null,priority:null,status:null,taskOn:null,requiredPeopleNb:1,assignedTo:null})})}async function _m(){if(window.location.hash.startsWith("#/demo/event/")&&!ke.isInitialized){console.log("[ensureDemoEventsLoaded] Route dÃ©mo dÃ©tectÃ©e > Auto-chargement events dÃ©mo");try{await ke.initializeForPublic()}catch(e){throw console.error("[ensureDemoEventsLoaded] Erreur chargement events dÃ©mo:",e),e}}}async function Rm(t,e=20){let r=0;for(;r<e;){if(ke.getEventById(t))return console.log(`[waitForEvent] Event ${t} trouvÃ© aprÃ¨s ${r*100}ms`),!0;await new Promise(n=>setTimeout(n,100)),r++}return console.warn(`[waitForEvent] Event ${t} non trouvÃ© aprÃ¨s ${e*100}ms`),!1}class ap{constructor(){C(this,"dbName","events-cache");C(this,"db",null);C(this,"version",2);C(this,"EVENTS_STORE","events");C(this,"METADATA_STORE","metadata");C(this,"POSTER_CONFIGS_STORE","poster-configs");C(this,"LAST_SYNC_KEY","lastSync")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.EVENTS_STORE)||(d.createObjectStore(this.EVENTS_STORE,{keyPath:"$id"}),console.log("[EventsIDBCache] Object store 'events' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[EventsIDBCache] Object store 'metadata' crÃ©Ã©")),d.objectStoreNames.contains(this.POSTER_CONFIGS_STORE)||(d.createObjectStore(this.POSTER_CONFIGS_STORE,{keyPath:"eventId"}),console.log("[EventsIDBCache] Object store 'poster-configs' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.EVENTS_STORE),n=r.objectStoreNames.contains(this.METADATA_STORE),a=r.objectStoreNames.contains(this.POSTER_CONFIGS_STORE);(!s||!n||!a)&&(console.warn(`[EventsIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (events=${s}, metadata=${n}, posters=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[EventsIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[EventsIDBCache] Base ouverte: ${this.dbName}`)}async loadEvents(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.EVENTS_STORE,"readonly").objectStore(this.EVENTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[EventsIDBCache] ${o.size} Ã©vÃ©nements chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveEvents(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.EVENTS_STORE,"readwrite"),a=n.objectStore(this.EVENTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[EventsIDBCache] ${e.size} Ã©vÃ©nements sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).put(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).delete(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadPosterConfig(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE),o=a.get(e);o.onsuccess=()=>{const c=o.result;if(!c){r(null);return}if(c.config&&!c.current){console.log(`[EventsIDBCache] Migration config affiche V1 -> V2 pour ${e}`);const l={current:c.config,versions:[]};a.put({eventId:e,...l,updatedAt:new Date().toISOString()}),r(l)}else c.current?r({current:c.current,versions:c.versions}):r(null)},o.onerror=()=>s(o.error)})}async savePosterConfig(e,r){if(!this.db)throw new Error("DB non ouverte");return new Promise((s,n)=>{const c=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE).put({eventId:e,...r,updatedAt:new Date().toISOString()});c.onsuccess=()=>{console.log(`[EventsIDBCache] Config affiche (container) pour ${e} sauvegardÃ©e`),s()},c.onerror=()=>n(c.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY&&(c.lastSync=l.value)}),console.log(`[EventsIDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite");n.objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e.lastSync}),n.oncomplete=()=>{console.log("[EventsIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.EVENTS_STORE,this.METADATA_STORE,this.POSTER_CONFIGS_STORE],"readwrite");s.objectStore(this.EVENTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.objectStore(this.POSTER_CONFIGS_STORE).clear(),s.oncomplete=()=>{console.log("[EventsIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[EventsIDBCache] Connexion fermÃ©e"))}}async function Ic(){const t=new ap;return await t.open(),t}const ip={name:"Rassemblement festif",description:"Exemple d'Ã©vÃ©nement sur plusieurs jours, avec plein de recettes...",durationDays:5,meals:[{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"houmous-pois-chiche_dw7yaqdlvjg9",plates:50,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"banoffee-vegan-et-sans_2h83u0xlel3u",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:0,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"falafel_n9qzdiwbz4dp",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tourte-betterave-lenti_c54ri2ggbvt2",plates:30,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"cheesecake-vegan-citro_lmvlf0ryne1v",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:0,time:"19:30"},{recipes:[{recipeUuid:"houmous-de-betterave-a_7c1hbo8nci50",plates:280,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"risotto-sarrasin-torre_0ay8dp7smyrw",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"blanquette-de-soja-tex_1oq9igtwzpr2",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"panna-cotta-vegan-vani_kytwplnialyp",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:1,time:"12:00"},{recipes:[{recipeUuid:"taboule-libanais-quino_0zgww2rc17i3",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"curry-veg_xnkksxn0t76q",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"escalope-de-seitan_ly3x5wxnq3ve",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"abricots-poches-vervei_izz7yef86m3j",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:1,time:"19:30"},{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:200,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"loubia_5m8okqsbqk66",plates:200,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_do1dg0nokwpd",plates:25,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"lassi-vegan-a-la-mangu_szk3bdykgyra",plates:200,typeR:"dessert",hasOwnPlatesNb:!0}],guests:200,dayOffset:2,time:"12:00"},{recipes:[{recipeUuid:"tartinade-de-pois-cass_tgpoyg0cm317",plates:280,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"champignons-frits-et-s_j71g5m5afdob",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"steak-vegetarien-champ_g288g77vujzb",plates:45,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tarte-au-citron-vegane_mw6a5i2da5hf",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:2,time:"19:30"},{recipes:[{recipeUuid:"soupe-froide-de-courge_nm0vvoqx6bbh",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"couscous-dautomne-vege_tntsav2ghe2f",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"jambalaya-vegan_jai01fvdixw5",plates:30,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-de-riz-libanaise_k00sjxzgi6ql",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:3,time:"12:00"},{recipes:[{recipeUuid:"gaspacho_cf5hqia64o1j",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_fzejp2oz5xj2",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"bahn-mi-a-la-proteine-_go4i0y6buluy",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"fondant-au-chocolat-ve_0vedt76modbc",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:3,time:"19:30"},{recipes:[{recipeUuid:"tartinade-de-haricot-r_w8ympby8n43o",plates:300,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"risotto-torrefie-de-sa_slsqvoqaqra7",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"proteines-de-soja-mari_ggo9802gtbxq",plates:50,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"salami-au-chocolat-veg_gp22v4hamxcv",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"aubergines-grillees-ca_3y287nb3wv9b",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-vegan-au-sureau_lds9ghlhjlwn",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"20:00"}]},_a=[ip];function op(t=0){const e=new Date,r=new Date(e);r.setDate(e.getDate()+7+t);const n=(5-r.getDay()+7)%7;return r.setDate(r.getDate()+n),r.setHours(0,0,0,0),r}function Ac(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),r}function cp(t){const e=new Set;return t.forEach(r=>{const s=r.date.split("T")[0];e.add(s)}),Array.from(e).sort()}function lp(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function up(t,e){const[r,s]=e.time.split(":"),n=new Date(t);n.setHours(parseInt(r),parseInt(s),0,0);const o=(await Promise.all(e.recipes.map(async c=>{if(!await Xa.getRecipeByUuid(c.recipeUuid))return console.error(`[DemoEvents] Recipe not found: ${c.recipeUuid}. Skipping.`),null;const u=c.hasOwnPlatesNb??!1,d={recipeUuid:c.recipeUuid,plates:c.plates,typeR:c.typeR};return u&&(d.hasOwnPlatesNb=u),d}))).filter(c=>c!==null);if(o.length===0)throw new Error(`No valid recipes found for meal at day ${e.dayOffset}, ${e.time}`);return{id:crypto.randomUUID(),date:n.toISOString(),guests:e.guests,recipes:o}}async function dp(t,e=0){console.log(`[DemoEvents] Generating event: ${t.name}`);const r=op(e),s=Ac(r,t.durationDays-1);s.setHours(23,59,59,999),console.log(`[DemoEvents] Event dates: ${r.toISOString()} â ${s.toISOString()}`);const n=[];for(const u of t.meals){const d=Ac(r,u.dayOffset);try{const h=await up(d,u);n.push(h)}catch(h){console.error("[DemoEvents] Error generating meal:",h)}}n.sort((u,d)=>new Date(u.date).getTime()-new Date(d.date).getTime()),console.log(`[DemoEvents] Generated ${n.length} meals`);const a=cp(n);console.log(`[DemoEvents] Event covers ${a.length} days: ${a.join(", ")}`);const o=`demo-${lp(t.name)}`,c={id:"guest",name:"Visiteur",email:"guest@demo.local",status:"accepted",invitedAt:new Date().toISOString(),respondedAt:new Date().toISOString()},l={$id:o,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],name:t.name,description:t.description,status:"local",dateStart:r.toISOString(),dateEnd:s.toISOString(),allDates:a,meals:n,contributors:[c],todos:[],teams:[],teamsId:[],createdBy:"demo-system",isActive:!0,originalDataHash:null,error:null,minContrib:1,$sequence:0,$tableId:"",$databaseId:""};return console.log(`[DemoEvents] Event generated: ${o}`),hp(l),l}async function fp(){console.log(`[DemoEvents] Generating ${_a.length} demo events`);const t=[],e=30;for(let r=0;r<_a.length;r++){const s=_a[r],n=r*e;try{const a=await dp(s,n);t.push(a)}catch(a){console.error(`[DemoEvents] Error generating event "${s.name}":`,a)}}return console.log(`[DemoEvents] Generated ${t.length}/${_a.length} events successfully`),t}function hp(t){console.log(`[DemoEvents] Validating event: ${t.$id}`);const e=[];t.status!=="local"&&e.push(`Event status should be "local", got: ${t.status}`);const r=new Set(t.meals.map(o=>o.date.split("T")[0])),s=new Set(t.allDates||[]),n=Array.from(r).filter(o=>!s.has(o));n.length>0&&e.push(`Dates missing in allDates: ${n.join(", ")}`);const a=Array.from(s).filter(o=>!r.has(o));if(a.length>0&&e.push(`Extra dates in allDates (no meals): ${a.join(", ")}`),!t.dateStart||!t.dateEnd)e.push("Event dateStart and dateEnd must be defined");else{const o=new Date(t.dateStart).getTime(),c=new Date(t.dateEnd).getTime();for(const l of t.meals){const u=new Date(l.date).getTime();(u<o||u>c)&&e.push(`Meal "${l.id}" date (${l.date}) is outside event range (${t.dateStart} â ${t.dateEnd})`)}}for(const o of t.meals)(!o.recipes||o.recipes.length===0)&&e.push(`Meal "${o.id}" has no recipes`);if(e.length>0)throw new Error(`Demo event validation failed:
  - ${e.join(`
  - `)}`);console.log(`[DemoEvents] â Validation passed for event: ${t.$id}`)}var _,we,je,$t,M,qe,Ds,ni,k,Ae,ai,En,yr,Ms,Ta,dr,tu,ru,su,nu,au,iu,ou,cu,lu,uu,du,fu,hu;class pp{constructor(){y(this,k);y(this,_,new ct);y(this,we,P(!1));y(this,je,P(null));y(this,$t,P(!1));y(this,M,null);y(this,qe,null);y(this,Ds,[]);y(this,ni,null);y(this,ai,Z(()=>{const e=new Date;return e.setHours(0,0,0,0),Array.from(i(this,_).values()).filter(r=>!r.dateStart||!r.dateEnd?!1:new Date(r.dateEnd)>=e)}));y(this,En,Z(()=>{const e=new Date;return Array.from(i(this,_).values()).filter(r=>r.dateEnd?new Date(r.dateEnd)<e:!1)}));y(this,yr,null);y(this,Ms,!1)}get loading(){return f(i(this,we))}get error(){return f(i(this,je))}get isInitialized(){return f(i(this,$t))}get events(){return Array.from(i(this,_).values())}get count(){return i(this,_).size}get currentEvents(){return f(i(this,ai))}get pastEvents(){return f(i(this,En))}get pastEventsCount(){return f(i(this,En)).length}async loadCache(){if(f(i(this,$t))){console.log("[EventsStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[EventsStore] Chargement du cache..."),g(i(this,we),!0),g(i(this,je),null);try{if(!L.isAuthenticated)throw new Error("Utilisateur non connectÃ©");I(this,qe,L.userId),I(this,Ds,L.userTeams),I(this,M,await Ic());const e=await i(this,M).loadEvents();if(e.size>0){console.log(`[EventsStore] ${e.size} Ã©vÃ©nements chargÃ©s depuis le cache`),i(this,_).clear();for(const[r,s]of e)i(this,_).set(r,s)}g(i(this,$t),!0),console.log(`[EventsStore] Cache chargÃ©: ${i(this,_).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(i(this,je),r,!0),console.error("[EventsStore]",r,e),e}finally{g(i(this,we),!1)}}async syncFromRemote(){if(!i(this,M)){console.warn("[EventsStore] Impossible de sync : cache non initialisÃ©");return}if(v(this,k,Ae).call(this)){console.log("[EventsStore] Mode local: skip syncFromRemote");return}console.log("[EventsStore] Synchronisation depuis Appwrite..."),g(i(this,we),!0);try{await v(this,k,Ta).call(this),await i(this,M).saveEvents(i(this,_)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log(`[EventsStore] Synchronisation terminÃ©e: ${i(this,_).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(i(this,je),r,!0),console.error("[EventsStore]",r,e),e}finally{g(i(this,we),!1)}}async setupRealtime(){if(!i(this,M)){console.warn("[EventsStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,Ms)){console.log("[EventsStore] Realtime dÃ©jÃ  configurÃ©");return}console.log("[EventsStore] Configuration du realtime..."),await v(this,k,hu).call(this),I(this,Ms,!0)}async initialize(){if(f(i(this,$t))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}return i(this,yr)?(console.log("[EventsStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,yr)):(console.log("[EventsStore] Initialisation complÃ¨te..."),g(i(this,we),!0),g(i(this,je),null),I(this,yr,(async()=>{try{await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),console.log(`[EventsStore] Initialisation complÃ©tÃ©e: ${i(this,_).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(i(this,je),r,!0),console.error("[EventsStore]",r,e),e}finally{g(i(this,we),!1),I(this,yr,null)}})()),i(this,yr))}async initializeForPublic(){if(f(i(this,$t))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}console.log("[EventsStore] Initialisation mode public..."),g(i(this,we),!0),g(i(this,je),null);try{I(this,M,await Ic()),await this.loadDemoEvents(),g(i(this,$t),!0),I(this,qe,"guest"),I(this,Ds,[]),console.log("[EventsStore] Mode public initialisÃ© : events dÃ©mo chargÃ©s")}catch(e){throw console.error("[EventsStore] Erreur init mode public:",e),e}finally{g(i(this,we),!1)}}async loadDemoEvents(){console.log("[EventsStore] Loading demo events...");try{const e=await fp();console.log(`[EventsStore] Generated ${e.length} demo events`),e.forEach(r=>{i(this,_).set(r.$id,r)}),i(this,M)&&(await i(this,M).saveEvents(i(this,_)),console.log("[EventsStore] Demo events persisted to IDB")),console.log(`[EventsStore] Total events in store: ${i(this,_).size}`)}catch(e){throw console.error("[EventsStore] Error loading demo events:",e),e}}getEventById(e){return i(this,_).get(e)||null}async fetchEvent(e){try{const r=await zh(e);if(r){const s=v(this,k,dr).call(this,r);return i(this,_).set(e,s),s}return null}catch(r){return console.error(`[EventsStore] Erreur lors du fetch de ${e}:`,r),null}}getEventsByDateRange(e,r){return this.events.filter(s=>s.dateStart&&s.dateEnd&&s.dateStart>=e&&s.dateEnd<=r)}canEditEvent(e){if(!i(this,qe))return!1;const r=i(this,_).get(e);return r?!!(r.createdBy===i(this,qe)||r.teams?.some(s=>i(this,Ds).includes(s))||r.contributors&&r.contributors.some(s=>s.id===i(this,qe)&&s.status==="accepted")):!1}canUserEditEvent(e,r,s){const n=i(this,_).get(e);return n?n.status==="local"?!0:r?!!(n.createdBy===r||n.teams?.length&&s?.length&&n.teams.some(a=>s.includes(a))||n.contributors&&n.contributors.some(a=>a.id===r&&a.status==="accepted")):!1:!1}async createEvent(e){if(!L.userId)throw new Error("Utilisateur non connectÃ©");const r=await Fh(e,L.userId),s=v(this,k,dr).call(this,r);return i(this,_).set(r.$id,s),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã©: ${r.$id}`),s}async createEventWithTeams(e,r=[],s=!0){if(!L.userId)throw new Error("Utilisateur non connectÃ©");const n=await ep(e,L.userId,r,s),a=v(this,k,dr).call(this,n);return i(this,_).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã© avec ${r.length} team(s): ${n.$id}`),a}async updateEvent(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,tu).call(this,e,r);const s=await Sc(e,r),n=v(this,k,dr).call(this,s);return i(this,_).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] ÃvÃ©nement mis Ã  jour: ${e}`),n}async updateEventStatus(e,r){if(v(this,k,Ae).call(this,e)){await v(this,k,ru).call(this,e,r);return}try{await Sc(e,{status:r});const s=i(this,_).get(e);s&&(s.status=r),console.log(`[EventsStore] Statut mis Ã  jour: ${e} -> ${r}`)}catch(s){throw console.error(`[EventsStore] Erreur mise Ã  jour statut ${e}:`,s),s}}async deleteEvent(e){await tp(e),i(this,_).delete(e),i(this,M)&&await i(this,M).deleteEvent(e),console.log(`[EventsStore] ÃvÃ©nement supprimÃ©: ${e}`)}getContributors(e){const r=i(this,_).get(e);return r?r.contributors:[]}getContributorStatus(e){const r=i(this,_).get(e);if(!r)return"";const s=r.contributors.filter(n=>n.id===i(this,qe));return s.length>0?s[0].status:""}async removeContributor(e,r){try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{removeUserFromEvent:n}=await ft(async()=>{const{removeUserFromEvent:o}=await Promise.resolve().then(()=>Ti);return{removeUserFromEvent:o}},void 0);await n(e,r);const a=s.contributors.filter(o=>o.id!==r&&o.email!==r);return s.contributors.length===a.length?s:await this.updateEvent(e,{contributors:a})}catch(s){throw console.error("[EventsStore] Erreur suppression contributeur:",s),s}}async inviteParticipants(e,r){try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{teamIds:n=[],emails:a=[],userIds:o=[],sendEmailToExistingMembers:c=!0}=r;if(n.length===0&&a.length===0&&o.length===0)return console.log("[EventsStore] Aucun participant Ã  inviter"),s;const{inviteParticipantsToEvent:l}=await ft(async()=>{const{inviteParticipantsToEvent:p}=await Promise.resolve().then(()=>Ti);return{inviteParticipantsToEvent:p}},void 0),u=await l(e,s.name,{teamIds:n,emails:a,userIds:o,sendEmailToExistingMembers:c});console.log(`[EventsStore] Invitation result: ${u.processed} traitÃ©s`);const d=n.length>0?2e3:500;await new Promise(p=>setTimeout(p,d));const h=await this.fetchEvent(e);if(!h)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return h}catch(s){throw console.error("[EventsStore] Erreur invitation participants:",s),s}}async removeTeam(e,r){try{const{removeTeamFromEvent:s}=await ft(async()=>{const{removeTeamFromEvent:a}=await Promise.resolve().then(()=>Ti);return{removeTeamFromEvent:a}},void 0);await s(e,r),await new Promise(a=>setTimeout(a,1e3));const n=await this.fetchEvent(e);if(!n)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return console.log(`[EventsStore] Team ${r} retirÃ©e de l'Ã©vÃ©nement ${e}`),n}catch(s){throw console.error("[EventsStore] Erreur retrait team:",s),s}}async updateContributorStatus(e,r,s){if(v(this,k,Ae).call(this,e))return await v(this,k,fu).call(this,e,r,s);try{const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(c=>c.id===r||c.email===r);if(o===-1)throw new Error("Contributeur introuvable");return a[o]={...a[o],status:s,respondedAt:new Date().toISOString()},await this.updateEvent(e,{contributors:a})}catch(n){throw console.error("[EventsStore] Erreur maj statut:",n),n}}getMeals(e){const r=i(this,_).get(e);return r?r.meals:[]}async addMeal(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,su).call(this,e,r);try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals,r];return await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur ajout meal:",s),s}}async updateMeal(e,r,s){if(v(this,k,Ae).call(this,e))return await v(this,k,nu).call(this,e,r,s);try{const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");return a[r]=s,await this.updateEvent(e,{meals:a})}catch(n){throw console.error("[EventsStore] Erreur maj meal:",n),n}}async deleteMeal(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,au).call(this,e,r);try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");return n.splice(r,1),await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur suppression meal:",s),s}}getTodos(e){const r=i(this,_).get(e);return r?r.todos:[]}async addTodo(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,iu).call(this,e,r);try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todo:",s),s}}async addTodos(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,ou).call(this,e,r);try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,...r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todos:",s),s}}async updateTodoStatus(e,r,s){if(v(this,k,Ae).call(this,e)){await v(this,k,uu).call(this,e,r,s);return}try{const n=i(this,_).get(e);n&&(n.todos=n.todos.map(c=>c.id===r?{...c,status:s,updatedAt:new Date().toISOString()}:c));const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"update_todo_status",data:{eventId:e,todoId:r,status:s}}),!1,"/",fn.POST)}catch(n){throw console.error("[EventsStore] Erreur updateTodoStatus:",n),n}}async toggleTodoAssignment(e,r){if(v(this,k,Ae).call(this,e)){await v(this,k,du).call(this,e,r);return}try{const s=L.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const n=i(this,_).get(e);if(n){const c=n.todos.find(l=>l.id===r);if(c){let l=[];Array.isArray(c.assignedTo)?l=[...c.assignedTo]:c.assignedTo&&(l=[c.assignedTo]),l.includes(s)?l=l.filter(u=>u!==s):l.push(s),n.todos=n.todos.map(u=>u.id===r?{...u,assignedTo:l.length>0?l:null,updatedAt:new Date().toISOString()}:u)}}const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"toggle_todo_assignment",data:{eventId:e,todoId:r}}),!1,"/",fn.POST)}catch(s){throw console.error("[EventsStore] Erreur toggleTodoAssignment:",s),s}}async updateTodo(e,r,s){if(v(this,k,Ae).call(this,e))return await v(this,k,cu).call(this,e,r,s);try{const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(o=>o.id===r?{...o,...s,updatedAt:new Date().toISOString()}:o);return await this.updateEvent(e,{todos:a})}catch(n){throw console.error("[EventsStore] Erreur maj todo:",n),n}}async deleteTodo(e,r){if(v(this,k,Ae).call(this,e))return await v(this,k,lu).call(this,e,r);try{const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(a=>a.id!==r);return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur suppression todo:",s),s}}async loadAllPastEvents(){try{if(console.log("[EventsStore] Chargement de TOUS les Ã©vÃ©nements..."),!i(this,qe)){console.warn("[EventsStore] userId non dÃ©fini");return}g(i(this,we),!0);const{events:e}=await Ec(i(this,qe),null);e.forEach(r=>{i(this,_).set(r.$id,v(this,k,dr).call(this,r))}),console.log(`[EventsStore] ${e.length} Ã©vÃ©nements chargÃ©s (sans filtre de date, total: ${i(this,_).size})`)}catch(e){throw console.error("[EventsStore] Erreur lors du chargement:",e),e}finally{g(i(this,we),!1)}}calculateScaleFactor(e,r){return e/r}async loadPosterConfig(e){return i(this,M)?await i(this,M).loadPosterConfig(e):null}async savePosterConfig(e,r){if(!i(this,M))return;const n=await i(this,M).loadPosterConfig(e)||{versions:[]};n.current=r,await i(this,M).savePosterConfig(e,n)}async createPosterVersion(e,r,s){if(!i(this,M))return;const a=await i(this,M).loadPosterConfig(e)||{current:r,versions:[]};if(a.versions||(a.versions=[]),a.versions.length>=3)throw new Error("Limite de 3 versions atteinte");const o={id:crypto.randomUUID(),name:s,config:JSON.parse(JSON.stringify(r)),createdAt:new Date().toISOString()};return a.versions.push(o),a.current=r,await i(this,M).savePosterConfig(e,a),o}async deletePosterVersion(e,r){if(!i(this,M))return;const s=await i(this,M).loadPosterConfig(e);!s||!s.versions||(s.versions=s.versions.filter(n=>n.id!==r),await i(this,M).savePosterConfig(e,s))}async reload(){console.log("[EventsStore] Rechargement..."),g(i(this,we),!0),g(i(this,je),null);try{i(this,_).clear(),await v(this,k,Ta).call(this),console.log("[EventsStore] Rechargement complÃ©tÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(i(this,je),r,!0),console.error("[EventsStore]",r,e),e}finally{g(i(this,we),!1)}}async hardReset(){console.log("[EventsStore] ð HARD RESET - Vidage complet..."),g(i(this,we),!0),g(i(this,je),null);try{i(this,_).clear(),i(this,M)&&(await i(this,M).clear(),console.log("[EventsStore] Cache IDB vidÃ©")),await v(this,k,Ta).call(this),i(this,M)&&(await i(this,M).saveEvents(i(this,_)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log("[EventsStore] Cache IDB recrÃ©Ã©")),console.log("[EventsStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(i(this,je),r,!0),console.error("[EventsStore]",r,e),e}finally{g(i(this,we),!1)}}destroy(){i(this,M)&&(i(this,M).close(),I(this,M,null)),i(this,_).clear(),g(i(this,$t),!1),I(this,Ms,!1),console.log("[EventsStore] Ressources nettoyÃ©es")}}_=new WeakMap,we=new WeakMap,je=new WeakMap,$t=new WeakMap,M=new WeakMap,qe=new WeakMap,Ds=new WeakMap,ni=new WeakMap,k=new WeakSet,Ae=function(e){const r=e||i(this,ni);return r?i(this,_).get(r)?.status==="local":!1},ai=new WeakMap,En=new WeakMap,yr=new WeakMap,Ms=new WeakMap,Ta=async function(e=null){if(v(this,k,Ae).call(this)){console.log("[EventsStore] Mode local: skip loadEvents from Appwrite");return}try{if(console.log("[EventsStore] Chargement des Ã©vÃ©nements..."),!i(this,qe)){console.warn("[EventsStore] userId non dÃ©fini, impossible de charger les Ã©vÃ©nements");return}if(!e){const s=new Date;s.setHours(0,0,0,0);const n=new Date(s);n.setDate(n.getDate()-15),e=n.toISOString()}const{events:r}=await Ec(i(this,qe),e);r.forEach(s=>{i(this,_).set(s.$id,v(this,k,dr).call(this,s))}),console.log(`[EventsStore] ${r.length} Ã©vÃ©nements chargÃ©s (filtrÃ©s pour userId: ${i(this,qe)}, date >= ${e})`)}catch(r){throw console.error("[EventsStore] Erreur lors du chargement:",r),r}},dr=function(e){return{...e,meals:rp(e.meals),contributors:sp(e.contributors),todos:np(e.todos)}},tu=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,...r,$updatedAt:new Date().toISOString()};return i(this,_).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Event mis Ã  jour: ${e}`),n},ru=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");s.status=r,s.$updatedAt=new Date().toISOString(),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] Mode local: Status mis Ã  jour: ${e} -> ${r}`)},su=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,meals:[...s.meals,r],$updatedAt:new Date().toISOString()};return i(this,_).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Meal ajoutÃ© Ã  ${e}`),n},nu=async function(e,r,s){const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");a[r]=s;const o={...n,meals:a,$updatedAt:new Date().toISOString()};return i(this,_).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Meal mis Ã  jour dans ${e}`),o},au=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");n.splice(r,1);const a={...s,meals:n,$updatedAt:new Date().toISOString()};return i(this,_).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Meal supprimÃ© de ${e}`),a},iu=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,r],$updatedAt:new Date().toISOString()};return i(this,_).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo ajoutÃ© Ã  ${e}`),n},ou=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,...r],$updatedAt:new Date().toISOString()};return i(this,_).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: ${r.length} todos ajoutÃ©s Ã  ${e}`),n},cu=async function(e,r,s){const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(c=>c.id===r?{...c,...s,updatedAt:new Date().toISOString()}:c),o={...n,todos:a,$updatedAt:new Date().toISOString()};return i(this,_).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Todo mis Ã  jour dans ${e}`),o},lu=async function(e,r){const s=i(this,_).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(o=>o.id!==r),a={...s,todos:n,$updatedAt:new Date().toISOString()};return i(this,_).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Todo supprimÃ© de ${e}`),a},uu=async function(e,r,s){const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");n.todos=n.todos.map(a=>a.id===r?{...a,status:s,updatedAt:new Date().toISOString()}:a),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo status mis Ã  jour: ${r} -> ${s}`)},du=async function(e,r){const s=L.userId||"guest",n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.find(c=>c.id===r);if(!a)throw new Error("Todo introuvable");let o=[];Array.isArray(a.assignedTo)?o=[...a.assignedTo]:a.assignedTo&&(o=[a.assignedTo]),o.includes(s)?o=o.filter(c=>c!==s):o.push(s),n.todos=n.todos.map(c=>c.id===r?{...c,assignedTo:o.length>0?o:null,updatedAt:new Date().toISOString()}:c),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo assignment toggled: ${r} par ${s}`)},fu=async function(e,r,s){const n=i(this,_).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(l=>l.id===r||l.email===r);if(o===-1)throw new Error("Contributeur introuvable");a[o]={...a[o],status:s,respondedAt:new Date().toISOString()};const c={...n,contributors:a,$updatedAt:new Date().toISOString()};return i(this,_).set(e,c),i(this,M)&&await i(this,M).saveEvent(c),console.log(`[EventsStore] Mode local: Contributor status mis Ã  jour: ${r} -> ${s}`),c},hu=async function(){if(v(this,k,Ae).call(this)){console.log("[EventsStore] Mode local: skip realtime setup");return}try{console.log("[EventsStore] Activation du Realtime...");const e=at();Bt.register([`databases.${e}.collections.${Ys}.documents`],async r=>{const s=r.events.some(a=>a.includes(".create"))?"create":r.events.some(a=>a.includes(".delete"))?"delete":"update",n=r.payload;if(console.log(`[EventsStore] â¡ï¸ Realtime RECEIVED: ${s} pour ${n.$id}`,{name:n.name,updatedAt:n.$updatedAt}),s==="create"||s==="update"){const a=v(this,k,dr).call(this,n);i(this,_).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a)}else s==="delete"&&(i(this,_).delete(n.$id),i(this,M)&&await i(this,M).deleteEvent(n.$id))}),console.log("[EventsStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[EventsStore] Erreur lors de la configuration du realtime:",e)}};const ke=new pp,ga=ls(),ma="materiel";async function _c(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:ga.APPWRITE_CONFIG.databaseId,tableId:ma,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel] Error listing materiels:",e),e}}async function gp(t,e){try{const{tables:r}=await D(),s=lt.unique();let n;try{n=typeof t.owner=="string"?JSON.parse(t.owner):t.owner}catch(c){throw console.error("[appwrite-materiel] Error parsing owner:",t.owner,c),new Error("Invalid owner format")}const a=[ee.read(se.user(e)),ee.update(se.user(e))];n.teamId?a.push(ee.read(se.team(n.teamId)),ee.update(se.team(n.teamId))):n.userId&&a.push(ee.read(se.user(n.userId)),ee.update(se.user(n.userId)));const o=await r.createRow({databaseId:ga.APPWRITE_CONFIG.databaseId,tableId:ma,rowId:s,data:{name:t.name,description:t.description||null,type:t.type||null,quantity:t.quantity,status:t.status||"ok",location:t.location||null,shareableWith:t.shareableWith||null,owner:t.owner},permissions:a});return console.log(`[appwrite-materiel] Materiel created: ${s}`),o}catch(r){throw console.error("[appwrite-materiel] Error creating materiel:",r),r}}async function Ra(t,e){try{const{tables:r}=await D(),s=await r.updateRow({databaseId:ga.APPWRITE_CONFIG.databaseId,tableId:ma,rowId:t,data:e});return console.log(`[appwrite-materiel] Materiel updated: ${t}`),s}catch(r){throw console.error(`[appwrite-materiel] Error updating materiel ${t}:`,r),r}}async function mp(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:ga.APPWRITE_CONFIG.databaseId,tableId:ma,rowId:t}),console.log(`[appwrite-materiel] Materiel deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel] Error deleting materiel ${t}:`,e),e}}function yp(){return[`databases.${ga.APPWRITE_CONFIG.databaseId}.collections.${ma}.documents`]}const ya=ls(),wa="materiel_loan";async function Rc(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:ya.APPWRITE_CONFIG.databaseId,tableId:wa,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel-loan] Error listing loans:",e),e}}async function wp(t,e){try{const{tables:r}=await D(),s=lt.unique(),n=[ee.read(se.user(e)),ee.update(se.user(e)),ee.read(se.team(t.ownerId)),ee.update(se.team(t.ownerId))],a=await r.createRow({databaseId:ya.APPWRITE_CONFIG.databaseId,tableId:wa,rowId:s,data:{startDate:t.startDate,endDate:t.endDate,responsibleId:t.responsibleId,responsibleName:t.responsibleName,ownerId:t.ownerId,ownerName:t.ownerName,materiels:t.materiels.map(o=>JSON.stringify(o)),notes:t.notes||null,status:t.status||"asked",completedAt:null,returnedAt:null,returnNotes:null},permissions:n});return console.log(`[appwrite-materiel-loan] Loan created: ${s}`),a}catch(r){throw console.error("[appwrite-materiel-loan] Error creating loan:",r),r}}async function vp(t,e){try{const{tables:r}=await D(),s={};e.startDate!==void 0&&(s.startDate=e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate),e.materiels!==void 0&&(s.materiels=e.materiels.map(a=>JSON.stringify(a))),e.status!==void 0&&(s.status=e.status),e.notes!==void 0&&(s.notes=e.notes),e.returnedAt!==void 0&&(s.returnedAt=e.returnedAt),e.returnNotes!==void 0&&(s.returnNotes=e.returnNotes);const n=await r.updateRow({databaseId:ya.APPWRITE_CONFIG.databaseId,tableId:wa,rowId:t,data:s});return console.log(`[appwrite-materiel-loan] Loan updated: ${t}`),n}catch(r){throw console.error(`[appwrite-materiel-loan] Error updating loan ${t}:`,r),r}}async function bp(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:ya.APPWRITE_CONFIG.databaseId,tableId:wa,rowId:t}),console.log(`[appwrite-materiel-loan] Loan deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel-loan] Error deleting loan ${t}:`,e),e}}function Ep(){return[`databases.${ya.APPWRITE_CONFIG.databaseId}.collections.${wa}.documents`]}class Sp{constructor(){C(this,"dbName","materiel-cache");C(this,"db",null);C(this,"version",1);C(this,"MATERIELS_STORE","materiels");C(this,"LOANS_STORE","loans");C(this,"METADATA_STORE","metadata");C(this,"LAST_SYNC_MATERIEL_KEY","lastSyncMateriel");C(this,"LAST_SYNC_LOANS_KEY","lastSyncLoans")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.MATERIELS_STORE)||(d.createObjectStore(this.MATERIELS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'materiels' crÃ©Ã©")),d.objectStoreNames.contains(this.LOANS_STORE)||(d.createObjectStore(this.LOANS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'loans' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[MaterielIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.MATERIELS_STORE),n=r.objectStoreNames.contains(this.LOANS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[MaterielIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (materiels=${s}, loans=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[MaterielIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[MaterielIDBCache] Base ouverte: ${this.dbName}`)}async loadMateriels(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.MATERIELS_STORE,"readonly").objectStore(this.MATERIELS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} matÃ©riels chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveMateriels(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.MATERIELS_STORE,"readwrite"),a=n.objectStore(this.MATERIELS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} matÃ©riels sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadLoans(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.LOANS_STORE,"readonly").objectStore(this.LOANS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} emprunts chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveLoans(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.LOANS_STORE,"readwrite"),a=n.objectStore(this.LOANS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} emprunts sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSyncMateriel:null,lastSyncLoans:null};o.forEach(l=>{l.key===this.LAST_SYNC_MATERIEL_KEY&&(c.lastSyncMateriel=l.value),l.key===this.LAST_SYNC_LOANS_KEY&&(c.lastSyncLoans=l.value)}),console.log(`[MaterielIDBCache] Metadata chargÃ©es: lastSyncMateriel=${c.lastSyncMateriel}, lastSyncLoans=${c.lastSyncLoans}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_MATERIEL_KEY,value:e.lastSyncMateriel}),a.put({key:this.LAST_SYNC_LOANS_KEY,value:e.lastSyncLoans}),n.oncomplete=()=>{console.log("[MaterielIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.MATERIELS_STORE,this.LOANS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.MATERIELS_STORE).clear(),s.objectStore(this.LOANS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[MaterielIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[MaterielIDBCache] Connexion fermÃ©e"))}}async function Ip(){const t=new Sp;return await t.open(),t}function go(t){const e={electronic:{label:"Ãlectronique",badgeClass:"badge-warning",textColor:"text-warning",bgColor:"bg-warning/10"},manual:{label:"Manuel",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},tools:{label:"Outils",badgeClass:"badge-secondary",textColor:"text-secondary",bgColor:"bg-secondary/10"},dish:{label:"Vaisselle",badgeClass:"badge-primary",textColor:"text-primary",bgColor:"bg-primary/10"},cooking:{label:"Cuisine",badgeClass:"badge-success",textColor:"text-success",bgColor:"bg-success/10"},gaz:{label:"Gaz",badgeClass:"badge-error",textColor:"text-error",bgColor:"bg-error/10"},hygiene:{label:"HygiÃ¨ne",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},other:{label:"Autre",badgeClass:"badge-neutral",textColor:"text-neutral",bgColor:"bg-neutral/10"}};return e[t||"other"]||e.other}function Pm(t){return go(t).badgeClass}function Dm(t){return go(t).textColor}function Mm(t){return go(t).bgColor}function $m(t){return{ok:"OK",lost:"Perdu",torepair:"Ã rÃ©parer"}[t||"ok"]||t||"OK"}const Pc={userName:"",userId:"",teamName:"",teamId:""};function Ap(t){if(!t)return Pc;try{return typeof t=="string"?JSON.parse(t):t}catch(e){return console.error("[materiel.utils] Error parsing owner from Appwrite:",t,e),Pc}}function mo(t){if(!t)return[];try{return Array.isArray(t)?t.map(e=>{try{return JSON.parse(e)}catch{return console.warn("[materiel.utils] Failed to parse loan item string:",e),null}}).filter(e=>e!==null):typeof t=="string"?JSON.parse(t):[]}catch(e){return console.error("[materiel.utils] Error parsing loan items from Appwrite:",t,e),[]}}function _p(t){return mo(t)}function rn(t){return{...t,materielItems:_p(t.materiels)}}function pu(t,e,r=new Date){const s=Ap(t.owner),n=[];let a=0;e.forEach(u=>{const h=mo(u.materiels).filter(A=>A.materielId===t.$id);if(h.length===0)return;const p=new Date(u.startDate),m=new Date(u.endDate),b=p<=r&&m>=r,R=p>r,S=["accepted","asked"].includes(u.status);(b||R)&&S&&h.forEach(A=>{n.push({loanId:u.$id,responsibleName:u.responsibleName||"",startDate:u.startDate,endDate:u.endDate,quantity:A.quantity,status:u.status})}),b&&S&&h.forEach(A=>{a+=A.quantity})});const c=n.some(u=>{const d=new Date(u.startDate),h=new Date(u.endDate);return d<=r&&h>=r})?"loan":t.status,l=t.quantity-a;return{...t,status:c,ownerData:s,loanDetails:n,availableQuantity:l,totalLoanedQuantity:a,isAvailable:l>0,isFullyLoaned:l===0}}function Rp(t,e){const r={...t};return pu(r,e)}function Pp(t){return["asked","accepted"].includes(t.status)}function Dp(t,e,r,s){return t<=s&&e>=r}function Mp(t,e,r,s){let n=0;return e.forEach(a=>{if(!Pp(a))return;const o=new Date(a.startDate),c=new Date(a.endDate);if(!Dp(o,c,r,s))return;const u=mo(a.materiels).filter(d=>d.materielId===t);n+=u.reduce((d,h)=>d+h.quantity,0)}),n}var ue,he,re,de,le,Xr,Sn,$s,Ct,kt,ii,Zt,oi,ci,li,In,ne,gu,mu,yu,wu,vu,bu,gs,ms;class $p{constructor(){y(this,ne);y(this,ue,new ct);y(this,he,new ct);y(this,re,null);y(this,de,P(!1));y(this,le,P(null));y(this,Xr,P(!1));y(this,Sn,P(!1));y(this,$s,!1);y(this,Ct,P(null));y(this,kt,P(null));y(this,ii,null);y(this,Zt,Z(()=>Array.from(i(this,ue).values())));y(this,oi,Z(()=>Array.from(i(this,he).values())));y(this,ci,Z(()=>{if(!L.userId)return[];const e=ht.myTeams.map(r=>r.$id);return f(i(this,Zt)).filter(r=>r.ownerData?.teamId&&e.includes(r.ownerData.teamId))}));y(this,li,Z(()=>{if(!L.userId)return[];const e=ht.myTeams.map(r=>r.$id);return f(i(this,Zt)).filter(r=>r.shareableWith?.some(n=>e.includes(n))&&!(r.ownerData?.teamId&&e.includes(r.ownerData.teamId)))}));y(this,In,Z(()=>f(i(this,Zt)).filter(e=>e.isAvailable)))}get loading(){return f(i(this,de))}get error(){return f(i(this,le))}get isInitialized(){return f(i(this,Xr))}get isRealtimeActive(){return f(i(this,Sn))}get count(){return i(this,ue).size}get materiels(){return f(i(this,Zt))}get loans(){return f(i(this,oi))}get teamMateriels(){return f(i(this,ci))}get shareableMateriels(){return f(i(this,li))}get availableMateriels(){return f(i(this,In))}getAvailableMaterielsByOwner(e){return f(i(this,In)).filter(r=>r.ownerData?.teamId===e&&r.status!=="lost"&&r.status!=="torepair")}getMaterielsByOwner(e){return f(i(this,Zt)).filter(r=>r.ownerData?.teamId===e)}getAvailableMaterielsForPeriod(e,r,s){const n=new Date(r),a=new Date(s),o=Array.from(i(this,he).values());return f(i(this,Zt)).filter(c=>c.ownerData?.teamId===e).filter(c=>c.status!=="lost"&&c.status!=="torepair").map(c=>{const l=Mp(c.$id,o,n,a),u=c.quantity-l;return{...c,availableForPeriod:u}}).filter(c=>c.availableForPeriod>0)}async loadCache(){if(!f(i(this,Xr))){g(i(this,de),!0),g(i(this,le),null);try{if(!L.userId){g(i(this,Xr),!0);return}I(this,re,await Ip()),await v(this,ne,gu).call(this),g(i(this,Xr),!0),console.log(`[MaterielStore] Cache chargÃ© : ${i(this,ue).size} matÃ©riels, ${i(this,he).size} emprunts`)}catch(e){throw g(i(this,le),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[MaterielStore] LoadCache error:",e),e}finally{g(i(this,de),!1)}}}async syncFromRemote(){g(i(this,de),!0),g(i(this,le),null);try{if(!L.userId)return;await v(this,ne,mu).call(this),console.log(`[MaterielStore] Sync terminÃ© : ${i(this,ue).size} matÃ©riels, ${i(this,he).size} emprunts`)}catch(e){throw g(i(this,le),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[MaterielStore] SyncFromRemote error:",e),e}finally{g(i(this,de),!1)}}async setupRealtime(){if(L.userId){if(i(this,$s)){console.log("[MaterielStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,ne,wu).call(this),g(i(this,Sn),!0),I(this,$s,!0),console.log("[MaterielStore] Realtime configurÃ©")}catch(e){throw g(i(this,le),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[MaterielStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}getMaterielById(e){return i(this,ue).get(e)}getLoanById(e){return i(this,he).get(e)}async createMateriel(e){g(i(this,de),!0),g(i(this,le),null);try{if(!L.userId)throw new Error("Utilisateur non connectÃ©");const r=await gp(e,L.userId),s=v(this,ne,gs).call(this,r);return i(this,ue).set(r.$id,s),i(this,re)?.upsertMateriel(s),s}catch(r){throw g(i(this,le),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{g(i(this,de),!1)}}async updateMateriel(e,r){g(i(this,de),!0),g(i(this,le),null);try{const s=await Ra(e,r),n=v(this,ne,gs).call(this,s);i(this,ue).set(s.$id,n),i(this,re)?.upsertMateriel(n)}catch(s){throw g(i(this,le),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{g(i(this,de),!1)}}async deleteMateriel(e){g(i(this,de),!0),g(i(this,le),null);try{await mp(e),i(this,ue).delete(e),i(this,re)?.deleteMateriel(e)}catch(r){throw g(i(this,le),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{g(i(this,de),!1)}}async createLoan(e){g(i(this,de),!0),g(i(this,le),null);try{if(!L.userId)throw new Error("Utilisateur non connectÃ©");const r=await wp(e,L.userId);return rn(r)}catch(r){throw g(i(this,le),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{g(i(this,de),!1)}}async updateLoan(e,r){g(i(this,de),!0),g(i(this,le),null);try{await vp(e,r)}catch(s){throw g(i(this,le),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{g(i(this,de),!1)}}async acceptLoan(e){await this.updateLoan(e,{status:"accepted"})}async refuseLoan(e){await this.updateLoan(e,{status:"refused"})}async cancelLoan(e){await this.updateLoan(e,{status:"canceled"})}async completeLoanWithReturn(e,r){for(const s of r.materiels){const n=s.lostQuantity||0,a=s.brokenQuantity||0;n+a>=s.quantity?await Ra(s.materielId,{status:"lost"}):a>0?await Ra(s.materielId,{status:"torepair"}):await Ra(s.materielId,{status:"ok"})}await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString(),returnNotes:r.returnNotes,materiels:r.materiels})}async completeLoan(e){await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString()})}async deleteLoan(e){g(i(this,de),!0),g(i(this,le),null);try{const r=i(this,he).get(e);r&&v(this,ne,ms).call(this,r),await bp(e)}catch(r){throw g(i(this,le),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{g(i(this,de),!1)}}async hardReset(){console.log("[MaterielStore] ð HARD RESET - Vidage complet..."),g(i(this,de),!0),g(i(this,le),null);try{if(i(this,ue).clear(),i(this,he).clear(),i(this,re)&&(await i(this,re).clear(),console.log("[MaterielStore] Cache IDB vidÃ©")),await v(this,ne,yu).call(this),i(this,re)){for(const[,e]of i(this,ue))await i(this,re).upsertMateriel(e);for(const[,e]of i(this,he))await i(this,re).upsertLoan(e);await i(this,re).saveMetadata({lastSyncMateriel:f(i(this,Ct)),lastSyncLoans:f(i(this,kt))}),console.log("[MaterielStore] Cache IDB recrÃ©Ã©")}console.log("[MaterielStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(i(this,le),r,!0),console.error("[MaterielStore] Erreur hard reset:",e),e}finally{g(i(this,de),!1)}}destroy(){var e;(e=i(this,ii))==null||e.call(this),i(this,ue).clear(),i(this,he).clear(),I(this,re,null),I(this,$s,!1)}}ue=new WeakMap,he=new WeakMap,re=new WeakMap,de=new WeakMap,le=new WeakMap,Xr=new WeakMap,Sn=new WeakMap,$s=new WeakMap,Ct=new WeakMap,kt=new WeakMap,ii=new WeakMap,Zt=new WeakMap,oi=new WeakMap,ci=new WeakMap,li=new WeakMap,In=new WeakMap,ne=new WeakSet,gu=async function(){if(i(this,re))try{(await i(this,re).loadMateriels()).forEach(n=>{i(this,ue).set(n.$id,n)}),(await i(this,re).loadLoans()).forEach(n=>{const a=rn(n);i(this,he).set(n.$id,a)});const s=await i(this,re).loadMetadata();g(i(this,Ct),s.lastSyncMateriel,!0),g(i(this,kt),s.lastSyncLoans,!0),console.log(`[MaterielStore] ${i(this,ue).size} matÃ©riels et ${i(this,he).size} emprunts chargÃ©s du cache IDB`)}catch(e){console.warn("[MaterielStore] Erreur lecture cache IDB, ignorÃ©:",e)}},mu=async function(){try{const e=f(i(this,Ct))?[E.greaterThan("$updatedAt",f(i(this,Ct)))]:[],r=await _c(e);for(const a of r){const o=v(this,ne,gs).call(this,a);i(this,ue).set(a.$id,o),i(this,re)?.upsertMateriel(o)}g(i(this,Ct),new Date().toISOString(),!0);const s=f(i(this,kt))?[E.greaterThan("$updatedAt",f(i(this,kt))),E.limit(100)]:[],n=await Rc(s);for(const a of n){const o=rn(a);i(this,he).set(a.$id,o),i(this,re)?.upsertLoan(a),v(this,ne,ms).call(this,o)}g(i(this,kt),new Date().toISOString(),!0),await i(this,re)?.saveMetadata({lastSyncMateriel:f(i(this,Ct)),lastSyncLoans:f(i(this,kt))}),console.log("[MaterielStore] Sync terminÃ©")}catch(e){throw console.error("[MaterielStore] Erreur sync:",e),e}},yu=async function(){try{console.log("[MaterielStore] Chargement complet depuis Appwrite...");const e=await _c([E.limit(1e3)]);for(const n of e){const a=v(this,ne,gs).call(this,n);i(this,ue).set(n.$id,a)}const r=await Rc([E.limit(1e3)]),s=[];for(const n of r){const a=rn(n);i(this,he).set(n.$id,a),s.push(a)}for(const n of s)v(this,ne,ms).call(this,n);g(i(this,Ct),new Date().toISOString(),!0),g(i(this,kt),new Date().toISOString(),!0),console.log(`[MaterielStore] ${e.length} matÃ©riels et ${r.length} emprunts chargÃ©s`)}catch(e){throw console.error("[MaterielStore] Erreur chargement complet:",e),e}},wu=async function(){Bt.register(yp(),async e=>{await v(this,ne,vu).call(this,e)}),Bt.register(Ep(),async e=>{await v(this,ne,bu).call(this,e)})},vu=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Materiel : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Materiel RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=v(this,ne,gs).call(this,s);i(this,ue).set(s.$id,a),i(this,re)?.upsertMateriel(a)}else n==="delete"&&(i(this,ue).delete(s.$id),i(this,re)?.deleteMateriel(s.$id))}catch(r){console.error("[MaterielStore] Erreur realtime Materiel:",r)}},bu=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Loan : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Loan RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=rn(s);i(this,he).set(s.$id,a),i(this,re)?.upsertLoan(s),v(this,ne,ms).call(this,a)}else if(n==="delete"){const a=i(this,he).get(s.$id);a&&v(this,ne,ms).call(this,a),i(this,he).delete(s.$id),i(this,re)?.deleteLoan(s.$id)}}catch(r){console.error("[MaterielStore] Erreur realtime Loan:",r)}},gs=function(e){const r=Array.from(i(this,he).values());return pu(e,r)},ms=function(e){const r=e.materielItems,s=Array.from(i(this,he).values());for(const n of r){const a=i(this,ue).get(n.materielId);if(a){const o=Rp(a,s);i(this,ue).set(n.materielId,o),i(this,re)?.upsertMateriel(o)}}};const Dc=new $p,Si="teamdocs";async function Cp(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:Si})).rows}catch(t){throw console.error("[appwrite-teamdocs] Error listing documents:",t),t}}async function kp(t,e,r,s){try{const{tables:n,config:a}=await D(),o=[ee.read(se.team(e)),ee.update(se.team(e)),ee.delete(se.team(e))],c=await n.createRow({databaseId:a.databaseId,tableId:Si,rowId:lt.unique(),data:{...t,teamId:e,createdBy:r},permissions:o});return console.log(`[appwrite-teamdocs] Document created: ${c.$id}`),c}catch(n){throw console.error("[appwrite-teamdocs] Error creating document:",n),n}}async function Eu(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow({databaseId:s.databaseId,tableId:Si,rowId:t,data:e});return console.log(`[appwrite-teamdocs] Document updated: ${t}`),n}catch(r){throw console.error(`[appwrite-teamdocs] Error updating document ${t}:`,r),r}}async function Np(t){try{const{tables:e,config:r}=await D();await e.deleteRow({databaseId:r.databaseId,tableId:Si,rowId:t}),console.log(`[appwrite-teamdocs] Document deleted: ${t}`)}catch(e){throw console.error(`[appwrite-teamdocs] Error deleting document ${t}:`,e),e}}async function Tp(t,e){try{await Eu(t,{lockedBy:e}),console.log(`[appwrite-teamdocs] Lock ${t} mis Ã  jour: ${e||"libÃ©rÃ©"}`)}catch(r){throw console.error(`[appwrite-teamdocs] Erreur verrouillage ${t}:`,r),r}}var _e,Cs,wr,zt,vr,ks,Ns,An,Zr,Ts,Ze,Su,Iu,Ur;class Lp{constructor(){y(this,Ze);y(this,_e,new ct);y(this,Cs,new ct);y(this,wr,P(!1));y(this,zt,P(null));y(this,vr,P(!1));y(this,ks,P(!1));y(this,Ns,!1);y(this,An,P(null));y(this,Zr,null);y(this,Ts,Z(()=>Array.from(i(this,_e).values())))}get loading(){return f(i(this,wr))}get error(){return f(i(this,zt))}get isInitialized(){return f(i(this,vr))}get isRealtimeActive(){return f(i(this,ks))}get count(){return i(this,_e).size}get documents(){return f(i(this,Ts))}getTeamDocuments(e){return f(i(this,Ts)).filter(r=>r.teamId===e)}getTeamTags(e){return i(this,Cs).get(e)||[]}async loadCache(){if(!f(i(this,vr))){g(i(this,wr),!0),g(i(this,zt),null);try{if(!L.userId){g(i(this,vr),!0);return}g(i(this,vr),!0),console.log("[TeamdocsStore] Cache chargÃ© (sans IDB)")}catch(e){throw g(i(this,zt),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[TeamdocsStore] LoadCache error:",e),e}finally{g(i(this,wr),!1)}}}async syncFromRemote(){g(i(this,wr),!0),g(i(this,zt),null);try{if(!L.userId)return;const e=await Cp();for(const r of e)i(this,_e).set(r.$id,r);await v(this,Ze,Ur).call(this),g(i(this,An),new Date().toISOString(),!0),console.log(`[TeamdocsStore] Sync terminÃ© : ${i(this,_e).size} documents`)}catch(e){throw g(i(this,zt),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[TeamdocsStore] SyncFromRemote error:",e),e}finally{g(i(this,wr),!1)}}async setupRealtime(){if(L.userId){if(i(this,Ns)){console.log("[TeamdocsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,Ze,Su).call(this),g(i(this,ks),!0),I(this,Ns,!0),console.log("[TeamdocsStore] Realtime configurÃ©")}catch(e){throw g(i(this,zt),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[TeamdocsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async createDocument(e,r){if(!L.userId||!L.userName)throw new Error("Utilisateur non connectÃ©");const s=await kp(e,r,L.userId,L.userName);return i(this,_e).set(s.$id,s),await v(this,Ze,Ur).call(this),console.log(`[TeamdocsStore] Document crÃ©Ã© : ${s.$id}`),s}async updateDocument(e,r){const s=await Eu(e,r);return i(this,_e).set(e,s),r.tags&&await v(this,Ze,Ur).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${e}`),s}async deleteDocument(e){await Np(e),i(this,_e).delete(e),await v(this,Ze,Ur).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${e}`)}getDocumentById(e){return i(this,_e).get(e)}async updateDocumentLock(e,r){if(L.userId)try{await Tp(e,r);const s=i(this,_e).get(e);s&&i(this,_e).set(e,{...s,lockedBy:r}),console.log(`[TeamdocsStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`)}catch(s){throw console.error(`[TeamdocsStore] Erreur verrouillage ${e}:`,s),s}}destroy(){i(this,Zr)&&(i(this,Zr).call(this),I(this,Zr,null)),i(this,_e).clear(),i(this,Cs).clear(),g(i(this,vr),!1),g(i(this,ks),!1),I(this,Ns,!1),console.log("[TeamdocsStore] Store dÃ©truit")}async hardReset(){this.destroy(),g(i(this,An),null),console.log("[TeamdocsStore] Hard reset effectuÃ©")}}_e=new WeakMap,Cs=new WeakMap,wr=new WeakMap,zt=new WeakMap,vr=new WeakMap,ks=new WeakMap,Ns=new WeakMap,An=new WeakMap,Zr=new WeakMap,Ts=new WeakMap,Ze=new WeakSet,Su=async function(){const e=["databases.*.collections.undefined"];Bt.register(e,async r=>{await v(this,Ze,Iu).call(this,r)}),I(this,Zr,()=>{})},Iu=async function(e){const{events:r,payload:s}=e,n=r?.[0];if(!n)return;const a=s;switch(n){case"databases.*.collections.*.documents.create":case"databases.*.collections.*.documents.update":a&&(i(this,_e).set(a.$id,a),await v(this,Ze,Ur).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${a.$id}`));break;case"databases.*.collections.*.documents.delete":a?.$id&&(i(this,_e).delete(a.$id),await v(this,Ze,Ur).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${a.$id}`));break}},Ur=async function(){const e=new Map;for(const r of f(i(this,Ts))){const s=r.teamId;e.has(s)||e.set(s,new Set),r.tags&&r.tags.forEach(n=>{e.get(s).add(n)})}e.forEach((r,s)=>{i(this,Cs).set(s,Array.from(r).sort())}),console.log(`[TeamdocsStore] Tags mis Ã  jour pour ${e.size} Ã©quipes`)};const Mc=new Lp;var _n,Ls,js,Tr,Au,_u,Ru;class jp{constructor(){y(this,Tr);y(this,_n,P(!1));y(this,Ls,!1);y(this,js,[])}async initialize(){const e=L.userId;if(!e){console.error("[NotificationStore] No userId found, cannot initialize");return}const r=at();try{const n=await(await D()).tables.getRow({databaseId:r,tableId:"user_notifications",rowId:e});I(this,js,JSON.parse(n.notifications||"[]")),console.log(`[NotificationStore] User row found for ${e}`)}catch(s){if(s.code===404)console.log(`[NotificationStore] User row not found, creating lazy init for ${e}`),await v(this,Tr,Ru).call(this,e),I(this,js,[]);else throw console.error("[NotificationStore] Error fetching user row:",s),s}await this.setupRealtime()}async setupRealtime(){if(i(this,Ls)){console.log("[NotificationStore] Already initialized, skipping.");return}try{console.log("[NotificationStore] Setting up realtime...");const e=at();Bt.register([`databases.${e}.collections.user_notifications.documents`],async r=>await v(this,Tr,Au).call(this,r)),g(i(this,_n),!0),I(this,Ls,!0),console.log("[NotificationStore] â Realtime configured (RealtimeManager)")}catch(e){throw console.error("[NotificationStore] Error configuring realtime:",e),e}}destroy(){g(i(this,_n),!1),I(this,Ls,!1),I(this,js,[]),console.log("[NotificationStore] Store destroyed")}}_n=new WeakMap,Ls=new WeakMap,js=new WeakMap,Tr=new WeakSet,Au=async function(e){console.log("[NotificationStore] ð¨ Raw realtime event:",{events:e.events,channels:e.channels,payload:e.payload});const r=e.payload,s=L.userId,n=L.currentMainId;if(console.log("[NotificationStore] ð Context check:",{payloadScope:r.scope,payloadId:r.$id,currentUserId:s,currentMainId:n}),r.scope==="event"&&!n){console.log("[NotificationStore] â ï¸ Ignored: event scope but no currentMainId");return}if(r.scope==="user"){if(r.$id!==s){console.log("[NotificationStore] â ï¸ Ignored: user ID mismatch");return}}else if(r.scope==="event"){if(r.$id!==n){console.log("[NotificationStore] â ï¸ Ignored: event ID mismatch");return}}else{console.log("[NotificationStore] â ï¸ Ignored: invalid scope");return}if(console.log("[NotificationStore] â Event passed filters, processing..."),e.events.some(a=>a.includes(".update"))){console.log("[NotificationStore] â Update event detected");const a=JSON.parse(r.notifications||"[]");console.log("[NotificationStore] ð Notifications to process:",a);for(const o of a)await v(this,Tr,_u).call(this,o)}else console.log("[NotificationStore] â ï¸ Ignored: not an update event",e.events)},_u=async function(e){switch(console.log("[NotificationStore] ð Processing notification:",e),e.type){case"team_access_granted":await ht.reload(),xe.success("Nouvelle Ã©quipe ajoutÃ©e");break;case"event_access_granted":console.log("[NotificationStore] ð event_access_granted received");const r=e.targetDocumentId;await ke.fetchEvent(r)?(console.log(`[NotificationStore] â Event ${r} fetched successfully`),xe.success("Nouvel Ã©vÃ©nement disponible")):(console.log(`[NotificationStore] â ï¸ Failed to fetch ${r}, falling back to reload()`),await ke.reload(),xe.success("Nouvel Ã©vÃ©nement disponible"));break;case"batch_products_update":console.log("[NotificationStore] ð batch_products_update received"),e.targetDocumentId===L.currentMainId?(console.log("[NotificationStore] â Calling productsStore.syncFromAppwrite()"),await zu.syncFromAppwrite(),e.from&&e.from!==L.userId&&(e.from==="system"?xe.info("Produits mis Ã  jour",{source:"system"}):xe.info("Produits modifiÃ©s par un autre utilisateur",{source:"realtime-other"}))):console.log("[NotificationStore] â ï¸ Ignored: mainId mismatch",{notificationTarget:e.targetDocumentId,currentMain:L.currentMainId});break;default:console.log("[NotificationStore] â Unknown notification type:",e.type)}},Ru=async function(e){const r=at();await(await D()).tables.createRow({databaseId:r,tableId:"user_notifications",rowId:e,data:{scope:"user",notifications:JSON.stringify([])},permissions:[ee.read(se.user(e)),ee.update(se.user(e))]}),console.log(`[NotificationStore] User row created for ${e}`)};const qp=new jp;var Rn,Pn,Dn;class Up{constructor(){C(this,"routes",[]);y(this,Rn,P(""));y(this,Pn,P(ge({})));y(this,Dn,P(ge({})));C(this,"currentRouteMatch",null);C(this,"isNavigating",!1);C(this,"dynamicGuards",new Map);C(this,"componentCache",new Map);this.currentPath=this.getHashPath(),this.updateQueryParams(),window.addEventListener("hashchange",()=>{const e=this.getHashPath();this.handleHashChange(e)})}get currentPath(){return f(i(this,Rn))}set currentPath(e){g(i(this,Rn),e,!0)}get currentParams(){return f(i(this,Pn))}set currentParams(e){g(i(this,Pn),e,!0)}get currentQuery(){return f(i(this,Dn))}set currentQuery(e){g(i(this,Dn),e,!0)}addRoute(e,r,s){this.routes.push({path:e,component:r,guards:s})}registerRouteGuard(e,r){return this.dynamicGuards.set(e,r),()=>{this.dynamicGuards.delete(e)}}async handleHashChange(e){if(this.isNavigating)return;this.updateQueryParams();const r={path:this.currentPath,params:this.currentParams,query:this.currentQuery},s={path:e,params:{},query:this.currentQuery},n=this.dynamicGuards.get(r.path);if(n?.beforeLeave)try{if(!await n.beforeLeave(r,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard dynamique)"),window.location.hash=r.path;return}}catch(o){console.error("[Router] Erreur dans beforeLeave (guard dynamique):",o)}if(this.currentRouteMatch?.guards?.beforeLeave)try{if(!await this.currentRouteMatch.guards.beforeLeave(r,s)){console.log("[Router] Navigation annulÃ©e par beforeLeave (guard statique)"),window.location.hash=r.path;return}}catch(o){console.error("[Router] Erreur dans beforeLeave (guard statique):",o)}const a=await this.findRouteMatch(e);if(!a){this.currentPath=e,this.currentParams={},this.currentRouteMatch=null;return}if(s.params=a.params,a.guards?.beforeEnter)try{if(!await a.guards.beforeEnter(s,r)){console.log("[Router] Navigation annulÃ©e par beforeEnter"),window.location.hash=r.path;return}}catch(o){console.error("[Router] Erreur dans beforeEnter:",o)}this.currentPath=e,this.currentParams=a.params,this.currentRouteMatch=a}async navigate(e,r){if(!this.isNavigating){this.isNavigating=!0;try{const s={path:this.currentPath,params:this.currentParams,query:this.currentQuery},n=await this.findRouteMatch(e),a={path:e,params:n?.params||{},query:r||{}};if(this.currentRouteMatch?.guards?.beforeLeave&&!await this.currentRouteMatch.guards.beforeLeave(s,a)){console.log("[Router] Navigation annulÃ©e par beforeLeave");return}if(n?.guards?.beforeEnter&&!await n.guards.beforeEnter(a,s)){console.log("[Router] Navigation annulÃ©e par beforeEnter");return}const o=r?"?"+new URLSearchParams(r).toString():"",c="#"+(e.startsWith("/")?e:"/"+e)+o;window.location.hash=c}finally{this.isNavigating=!1}}}async findRouteMatch(e){for(const r of this.routes){const s=this.matchRoute(r.path,e);if(s)return{component:await this.resolveComponent(r.path.toString(),r.component),params:s.params,query:this.currentQuery,guards:r.guards}}return null}async resolveComponent(e,r){if(typeof r!="function"||r.length>0)return r;if(this.componentCache.has(e))return this.componentCache.get(e);try{const n=(await r()).default;return this.componentCache.set(e,n),n}catch(s){throw console.error(`[Router] Erreur lors du chargement du composant pour ${e}:`,s),s}}async match(){const e=await this.findRouteMatch(this.currentPath);return e&&(this.currentParams=e.params,this.currentRouteMatch=e),e}matchRoute(e,r){if(e instanceof RegExp){const c=r.match(e);return c?{params:c.groups||{}}:null}const s=[],n=e.replace(/:([^/]+)/g,(c,l)=>(s.push(l),"([^/]+)")),a=new RegExp(`^${n}$`),o=r.match(a);if(o){const c={};return s.forEach((l,u)=>{c[l]=o[u+1]}),{params:c}}return null}getHashPath(){return window.location.hash.slice(1).split("?")[0]||"/"}updateQueryParams(){const r=window.location.hash.slice(1).split("?")[1],s={};r&&new URLSearchParams(r).forEach((a,o)=>{s[o]=a}),this.currentQuery=s}get path(){return this.currentPath}get params(){return this.currentParams}get query(){return this.currentQuery}async preload(e){const r=this.routes.find(s=>typeof s.path=="string"?s.path===e:!1);r&&(await this.resolveComponent(r.path.toString(),r.component),console.log(`[Router] Composant prÃ©chargÃ©: ${e}`))}}Rn=new WeakMap,Pn=new WeakMap,Dn=new WeakMap;const ws=new Up;function Cm(t,e){ws.navigate(t,e)}function km(t){return ws.query[t]}function Nm(t){return ws.preload(t)}var ae,Ke,br,Er,zr,ui,Ft,Fr,qs,Mn,$n,Cn,kn;class Bp{constructor(){C(this,"isMobileQuery",new Fo("max-width: 768px"));C(this,"isDesktopQuery",new Fo("min-width: 1024px"));y(this,ae,P(null));y(this,Ke,P(ge([])));y(this,br,P(!1));y(this,Er,P(null));y(this,zr,P(!1));y(this,ui,Z(()=>{const e=ws.path,r=ws.params.id;return e.includes("/eventEdit/")&&r?(console.log(`[GlobalState] â currentMainId dÃ©rivÃ©: ${r}`),r):(console.log(`[GlobalState] â ï¸ Pas de mainId: path=${e}, params.id=${ws.params.id}`),null)}));y(this,Ft,P(0));y(this,Fr,P(!0));y(this,qs,P("down"));y(this,Mn,P(ge({isOpen:!1,conflicts:[]})));y(this,$n,P(ge({isOpen:!1})));y(this,Cn,P(ge({isRunning:!1,name:"",progress:0})));y(this,kn,P(ge({isOpen:!1,showLogin:!0})))}get user(){return f(i(this,ae))}get userId(){return f(i(this,ae))?.$id??null}get userEmail(){return f(i(this,ae))?.email??null}get userTeams(){return f(i(this,Ke))}get isAuthenticated(){return f(i(this,ae))!==null}get authLoading(){return f(i(this,br))}get authError(){return f(i(this,Er))}get authInitialized(){return f(i(this,zr))}async initializeAuth(){if(f(i(this,zr))){console.log("[GlobalState] Authentification dÃ©jÃ  initialisÃ©e");return}console.log("[GlobalState] Initialisation de l'authentification..."),g(i(this,br),!0),g(i(this,Er),null);try{const{account:e}=await D();g(i(this,ae),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,ae)).name),localStorage.setItem("appwrite-user-email",f(i(this,ae)).email),localStorage.setItem("appwrite-user-id",f(i(this,ae)).$id),await ht.initialize(),g(i(this,Ke),ht.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] AuthentifiÃ©: ${f(i(this,ae)).name} (${f(i(this,Ke)).length} Ã©quipes)`)}catch(e){g(i(this,ae),null),g(i(this,Ke),[],!0),g(i(this,Er),e instanceof Error?e.message:"Erreur d'authentification",!0),console.log("[GlobalState] Utilisateur non connectÃ©")}finally{g(i(this,br),!1),g(i(this,zr),!0)}}async refreshAuthAfterLogin(){console.log("[GlobalState] RÃ©initialisation aprÃ¨s login..."),g(i(this,br),!0),g(i(this,Er),null);try{const{account:e}=await D();g(i(this,ae),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,ae)).name),localStorage.setItem("appwrite-user-email",f(i(this,ae)).email),localStorage.setItem("appwrite-user-id",f(i(this,ae)).$id),await ht.initialize(),await ke.syncFromRemote(),await ke.setupRealtime(),await Dc.syncFromRemote(),await Dc.setupRealtime(),await Mc.syncFromRemote(),await Mc.setupRealtime(),await qp.initialize(),await Bt.initialize(),g(i(this,Ke),ht.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] RÃ©initialisÃ© aprÃ¨s login: ${f(i(this,ae)).name} (${f(i(this,Ke)).length} Ã©quipes)`)}catch(e){console.error("[GlobalState] Erreur lors de la rÃ©initialisation:",e),g(i(this,Er),e instanceof Error?e.message:"Erreur de rÃ©initialisation",!0)}finally{g(i(this,br),!1)}}async logout(){try{const{account:e}=await D();await e.deleteSession({sessionId:"current"}),Xl(),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-id"),g(i(this,ae),null),g(i(this,Ke),[],!0),g(i(this,zr),!1),console.log("[GlobalState] DÃ©connexion rÃ©ussie")}catch(e){throw console.error("[GlobalState] Erreur lors de la dÃ©connexion:",e),e}}async refreshTeams(){if(!f(i(this,ae))){console.warn("[GlobalState] Impossible de rafraÃ®chir les Ã©quipes: utilisateur non connectÃ©");return}try{await ht.syncFromRemote();const e=ht.myTeams.map(r=>r.$id);(e.length>0||f(i(this,Ke)).length===0)&&(g(i(this,Ke),e,!0),console.log(`[GlobalState] Ãquipes rafraÃ®chies: ${f(i(this,Ke)).length}`))}catch(e){console.error("[GlobalState] Erreur lors du rafraÃ®chissement des Ã©quipes:",e)}}isTeamOwner(e){if(!f(i(this,ae)))return!1;const r=ht.myTeams.find(n=>n.$id===e);return r?r.members.find(n=>n.id===f(i(this,ae)).$id)?.roles?.includes("owner")??!1:!1}hasTeamRole(e,r){if(!f(i(this,ae)))return!1;const s=ht.myTeams.find(a=>a.$id===e);return s?s.members.find(a=>a.id===f(i(this,ae)).$id)?.roles?.includes(r)??!1:!1}get currentMainId(){return f(i(this,ui))}get isMobile(){return this.isMobileQuery.current}get isDesktop(){return this.isDesktopQuery.current}get headerVisible(){return f(i(this,Fr))}get scrollDirection(){return f(i(this,qs))}initializeScrollDirection(){as(()=>{const e=jh.current??0;if(e>f(i(this,Ft))?g(i(this,qs),"down"):e<f(i(this,Ft))&&g(i(this,qs),"up"),this.isDesktop){g(i(this,Fr),!0),g(i(this,Ft),e,!0);return}e>f(i(this,Ft))&&e>100?g(i(this,Fr),!1):e<f(i(this,Ft))&&g(i(this,Fr),!0),g(i(this,Ft),e,!0)})}get userName(){return f(i(this,ae))?.name||localStorage.getItem("appwrite-user-name")||""}get toasts(){return xe.toasts}get toast(){return xe}get modalOverride(){return f(i(this,Mn))}set modalOverride(e){g(i(this,Mn),e,!0)}get modal(){return f(i(this,$n))}set modal(e){g(i(this,$n),e,!0)}get backgroundOperation(){return f(i(this,Cn))}set backgroundOperation(e){g(i(this,Cn),e,!0)}get authModal(){return f(i(this,kn))}set authModal(e){g(i(this,kn),e,!0)}}ae=new WeakMap,Ke=new WeakMap,br=new WeakMap,Er=new WeakMap,zr=new WeakMap,ui=new WeakMap,Ft=new WeakMap,Fr=new WeakMap,qs=new WeakMap,Mn=new WeakMap,$n=new WeakMap,Cn=new WeakMap,kn=new WeakMap;const L=new Bp;var Nn,Tn;class Op{constructor(){y(this,Nn,P("survolez des Ã©lÃ©ment pour obtenir de l'aide"));y(this,Tn,P(!0));C(this,"reset",()=>{this.msg="survolez des Ã©lÃ©ment pour obtenir de l'aide"});C(this,"toggle",()=>{this.isExpanded=!this.isExpanded});C(this,"expand",()=>{this.isExpanded=!0});C(this,"collapse",()=>{this.isExpanded=!1})}get msg(){return f(i(this,Nn))}set msg(e){g(i(this,Nn),e,!0)}get isExpanded(){return f(i(this,Tn))}set isExpanded(e){g(i(this,Tn),e,!0)}get help(){return this.msg}set help(e){this.msg=e}}Nn=new WeakMap,Tn=new WeakMap;const Tm=new Op;async function Lm(t,e,r,s,n=!1){try{const{functions:a,config:o}=await D(),c=o.functions.enkaData,l=JSON.stringify({action:t,recipeId:e,userId:r,data:s}),u=await a.createExecution({functionId:c,body:l,async:n});if(n){if(u.status==="failed")throw new Error(`Function execution failed to start: ${u.status}`);return{success:!0,executionId:u.$id}}if(u.status!=="completed")throw new Error(`Function execution failed: ${u.status} - ${u.responseBody}`);const d=JSON.parse(u.responseBody);if(!d.success)throw new Error(d.error||"Unknown error in manage_recipe");return d.data}catch(a){throw console.error(`[appwrite-recipes] Error executing manage_recipe (${t}):`,a),a}}const us="recettes";async function $c(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:us})).rows}catch(t){throw console.error("[appwrite-recipes] Error listing all recipes:",t),t}}async function xp(t){try{const{tables:e,config:r}=await D(),s=[E.greaterThan("$updatedAt",t)];return(await e.listRows({databaseId:r.databaseId,tableId:us,queries:s})).rows}catch(e){throw console.error(`[appwrite-recipes] Error listing updated recipes since ${t}:`,e),e}}async function Ni(t){try{const{tables:e,config:r}=await D();return await e.getRow({databaseId:r.databaseId,tableId:us,rowId:t})}catch(e){if(e.code===404)return null;throw console.error(`[appwrite-recipes] Error getting recipe ${t}:`,e),e}}async function jm(t,e){try{const{tables:r,config:s,account:n}=await D(),a=Lh(t.title,t.versionLabel||void 0),o=[ee.read(se.users()),ee.update(se.user(e)),ee.delete(se.user(e))],l=(await n.get()).name,u={title:t.title,plate:t.plate,ingredients:t.ingredients,preparation:t.preparation,draft:t.draft??!0,typeR:t.typeR,categories:t.categories??[],regime:t.regime??[],check:t.check??!1,description:t.description??null,quantite_desc:t.quantite_desc??null,region:t.region??null,saison:t.saison??[],cuisson:t.cuisson??[],serveHot:t.serveHot??!0,auteur:l,preparation24h:t.preparation24h??null,astuces:t.astuces??null,publishedAt:t.publishedAt||new Date().toISOString().split("T")[0]+"T00:00:00Z",$id:a,createdBy:e,permissionWrite:t.permissionWrite||[e],rootRecipeId:t.rootRecipeId??null,versionLabel:t.versionLabel??null},d=await r.createRow({databaseId:s.databaseId,tableId:us,rowId:a,data:u,permissions:o});return console.log(`[appwrite-recipes] Recipe created: ${a}`),d}catch(r){throw console.error("[appwrite-recipes] Error creating recipe:",r),r}}async function Hp(t,e,r){try{const{tables:s,config:n}=await D(),a={...e,check:e.check??!1,...e.publishedAt&&{publishedAt:e.publishedAt}},o=await s.updateRow({databaseId:n.databaseId,tableId:us,rowId:t,data:a});return console.log(`[appwrite-recipes] Recipe updated: ${t}`),o}catch(s){throw console.error(`[appwrite-recipes] Error updating recipe ${t}:`,s),s}}async function qm(t){try{const{tables:e,config:r}=await D();await e.updateRow({databaseId:r.databaseId,tableId:us,rowId:t,data:{status:"deleted"}}),console.log(`[appwrite-recipes] Recipe soft deleted: ${t}`)}catch(e){throw console.error(`[appwrite-recipes] Error deleting recipe ${t}:`,e),e}}const Wp="/api/data.json";var V,Re,$e,Sr,Ln,x,Nt,Ir,Us,Me,La,Pu,Du,Ki,Yi;class Gp{constructor(){y(this,Me);y(this,V,P(ge(new ct)));y(this,Re,P(!1));y(this,$e,P(null));y(this,Sr,P(!1));y(this,Ln,P(null));y(this,x,null);y(this,Nt,new Set);y(this,Ir,null);y(this,Us,!1)}get loading(){return f(i(this,Re))}get error(){return f(i(this,$e))}get isInitialized(){return f(i(this,Sr))}get recipesIndex(){return Array.from(f(i(this,V)).values())}get count(){return f(i(this,V)).size}getAllRecipes(){return Array.from(f(i(this,V)).values())}async loadCache(){if(f(i(this,Sr))){console.log("[RecipesStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[RecipesStore] Chargement du cache..."),g(i(this,Re),!0),g(i(this,$e),null);try{I(this,x,await Eh());const e=await i(this,x).loadRecipesIndex(),r=await i(this,x).loadMetadata();e.size>0&&(console.log(`[RecipesStore] ${e.size} recettes (index) chargÃ©es depuis le cache`),g(i(this,V),new ct(e),!0)),g(i(this,Sr),!0),console.log(`[RecipesStore] Cache chargÃ©: ${f(i(this,V)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw g(i(this,$e),r,!0),console.error("[RecipesStore]",r,e),e}finally{g(i(this,Re),!1)}}async syncFromRemote(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation depuis sources distantes..."),g(i(this,Re),!0);try{const e=await i(this,x).loadMetadata();try{await v(this,Me,La).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,V)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}if(L.userId)try{await v(this,Me,Pu).call(this,e)}catch(r){console.warn("[RecipesStore] Erreur sync Appwrite:",r)}console.log(`[RecipesStore] Synchronisation terminÃ©e: ${f(i(this,V)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw g(i(this,$e),r,!0),console.error("[RecipesStore]",r,e),e}finally{g(i(this,Re),!1)}}async syncFromRemotePublicOnly(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation publique (Hugo uniquement)..."),g(i(this,Re),!0);try{const e=await i(this,x).loadMetadata();try{await v(this,Me,La).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,V)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}console.log(`[RecipesStore] Synchronisation publique terminÃ©e: ${f(i(this,V)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation publique";throw g(i(this,$e),r,!0),console.error("[RecipesStore]",r,e),e}finally{g(i(this,Re),!1)}}async setupRealtime(){if(!i(this,x)){console.warn("[RecipesStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,Us)){console.log("[RecipesStore] Realtime dÃ©jÃ  configurÃ©");return}if(console.log("[RecipesStore] Configuration du realtime..."),L.userId)try{v(this,Me,Du).call(this),I(this,Us,!0)}catch(e){console.warn("[RecipesStore] Erreur activation realtime:",e)}}async initialize(){if(f(i(this,Sr))){console.log("[RecipesStore] DÃ©jÃ  initialisÃ©");return}return i(this,Ir)?(console.log("[RecipesStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,Ir)):(console.log("[RecipesStore] Initialisation..."),g(i(this,Re),!0),g(i(this,$e),null),I(this,Ir,(async()=>{try{if(await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),f(i(this,V)).size===0){const e="Aucune recette disponible aprÃ¨s initialisation";g(i(this,$e),e),console.warn("[RecipesStore]",e)}console.log(`[RecipesStore] Initialisation complÃ©tÃ©e: ${f(i(this,V)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw g(i(this,$e),r,!0),console.error("[RecipesStore] ECHEC Initialisation:",r,e),e}finally{g(i(this,Re),!1),I(this,Ir,null)}})()),i(this,Ir))}async forceReloadAllRecipes(){if(!L.userId)throw new Error("Utilisateur non connectÃ©");g(i(this,Re),!0),g(i(this,$e),null);try{console.log("[RecipesStore] Rechargement forcÃ© des recettes Appwrite...");const e=await $c();let r=0,s=0;if(e.forEach(n=>{n.status==="deleted"?f(i(this,V)).has(n.$id)&&(f(i(this,V)).delete(n.$id),s++,console.log(`[RecipesStore] Recette ${n.$id} supprimÃ©e (status=deleted)`)):(f(i(this,V)).set(n.$id,Aa(n)),r++)}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es`),i(this,x)){const n=await i(this,x).loadMetadata(),a=new Date().toISOString();await i(this,x).saveRecipesIndex(f(i(this,V))),await i(this,x).saveMetadata({...n,lastAppwriteSync:a,recipesCount:f(i(this,V)).size,cacheVersion:1})}console.log("[RecipesStore] Rechargement forcÃ© terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw g(i(this,$e),r,!0),console.error("[RecipesStore] Erreur rechargement forcÃ©:",e),e}finally{g(i(this,Re),!1)}}async hardReset(){if(!L.userId)throw new Error("Utilisateur non connectÃ©");console.log("[RecipesStore] ð HARD RESET - Vidage complet..."),g(i(this,Re),!0),g(i(this,$e),null);try{f(i(this,V)).clear(),i(this,x)&&(await i(this,x).clear(),console.log("[RecipesStore] Cache IDB vidÃ©")),await v(this,Me,La).call(this,null);const e=await $c();let r=0,s=0;if(e.forEach(n=>{n.status!=="deleted"?(f(i(this,V)).set(n.$id,Aa(n)),r++):s++}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es ignorÃ©es`),i(this,x)){const n=new Date().toISOString();await i(this,x).saveRecipesIndex(f(i(this,V))),await i(this,x).saveMetadata({buildTimestamp:f(i(this,Ln)),lastAppwriteSync:n,recipesCount:f(i(this,V)).size,cacheVersion:1}),console.log("[RecipesStore] Cache IDB recrÃ©Ã©")}console.log("[RecipesStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw g(i(this,$e),r,!0),console.error("[RecipesStore] Erreur hard reset:",e),e}finally{g(i(this,Re),!1)}}getRecipeIndexByUuid(e){return f(i(this,V)).get(e)||null}searchRecipes(e){if(!e.trim())return this.recipesIndex;const r=v(this,Me,Ki).call(this,e.trim()).split(/\s+/);return this.recipesIndex.filter(s=>{const a=v(this,Me,Ki).call(this,s.title).split(/[\s\-_]+/);return r.every(o=>a.some(c=>c.startsWith(o)))})}get availableTypes(){const e=new Set;return this.recipesIndex.forEach(r=>e.add(r.typeR)),Array.from(e).sort()}async canEditRecipe(e){if(!L.userId)return!1;try{const r=await Ni(e);return r?r.createdBy===L.userId||!!r.permissionWrite?.includes(L.userId)||!!r.teams?.some(s=>L.userTeams.includes(s)):!1}catch(r){return console.error(`[RecipesStore] Erreur lors de la vÃ©rification des permissions pour ${e}:`,r),!1}}getRecipeLockStatus(e){return f(i(this,V)).get(e)?.lockedBy||null}async updateRecipeLock(e,r){if(L.userId)try{await Hp(e,{lockedBy:r},L.userId),console.log(`[RecipesStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`);const s=f(i(this,V)).get(e);s&&f(i(this,V)).set(e,{...s,lockedBy:r})}catch(s){throw console.error(`[RecipesStore] Erreur verrouillage ${e}:`,s),s}}async getRecipeByUuid(e){if(i(this,Nt).has(e)){for(console.log(`[RecipesStore] Chargement de ${e} dÃ©jÃ  en cours, attente...`);i(this,Nt).has(e);)await new Promise(r=>setTimeout(r,50));return i(this,x)&&await i(this,x).loadRecipeDetail(e)||null}i(this,Nt).add(e);try{if(i(this,x)){const s=await i(this,x).loadRecipeDetail(e);if(s)return s}let r=null;try{const s=`/recettes/${e}/recipe.json`,n=await fetch(s);if(n.ok){const a=await n.json();r=nc(a),console.log(`[RecipesStore] ${e} chargÃ©e depuis Hugo`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Hugo`)}if(!r&&L.userId)try{const s=await Ni(e);if(s){const n=ka(s.ingredients||[]);r={...s,ingredients:n,astuces:Ci(s.astuces),prepAlt:s.prepAlt||null,categories:s.categories,regime:s.regime,saison:s.saison,teams:s.teams,permissionWrite:s.permissionWrite},console.log(`[RecipesStore] ${e} chargÃ©e depuis Appwrite (fallback)`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Appwrite`)}return r&&i(this,x)&&await i(this,x).saveRecipeDetail(r),r||console.warn(`[RecipesStore] ${e} non trouvÃ©e (Hugo ni Appwrite)`),r}catch(r){return console.error(`[RecipesStore] Erreur lors du chargement de ${e}:`,r),null}finally{i(this,Nt).delete(e)}}async getRecipesByUuidsBulk(e){const r=performance.now(),s=[...new Set(e.filter(Boolean))];if(s.length===0)return new Map;console.log(`[RecipesStore] Chargement bulk de ${s.length} recettes...`);const n=new Map;i(this,x)&&(await i(this,x).loadRecipeDetailsBulk(s)).forEach((d,h)=>n.set(h,d));const a=s.filter(u=>!n.has(u));console.log(`[RecipesStore] Bulk: ${n.size} dans le cache, ${a.length} Ã  fetch`);const o=new Map;if(a.length>0){a.forEach(u=>i(this,Nt).add(u));try{const u=a.map(async h=>{let p=null;try{const m=`/recettes/${h}/recipe.json`,b=await fetch(m);if(b.ok){const R=await b.json();p=nc(R)}}catch{}if(!p&&L.userId)try{const m=await Ni(h);if(m){const b=ka(m.ingredients||[]);p={...m,ingredients:b,astuces:Ci(m.astuces),prepAlt:m.prepAlt||null,categories:m.categories,regime:m.regime,saison:m.saison,teams:m.teams,permissionWrite:m.permissionWrite}}}catch{}return p?{uuid:h,recipe:p}:null});(await Promise.all(u)).forEach(h=>{h&&o.set(h.uuid,h.recipe)}),o.size>0&&i(this,x)&&await i(this,x).saveRecipeDetailsBulk(o),a.forEach(h=>i(this,Nt).delete(h))}catch(u){console.error("[RecipesStore] Erreur lors du fetch bulk:",u),a.forEach(d=>i(this,Nt).delete(d))}}const c=new Map([...n,...o]),l=performance.now()-r;return console.log(`[RecipesStore] Bulk terminÃ©: ${c.size}/${s.length} recettes en ${l.toFixed(0)}ms`),c}async preloadRecipes(e){console.log(`[RecipesStore] PrÃ©chargement de ${e.length} recettes...`);const r=e.map(s=>this.getRecipeByUuid(s));await Promise.all(r),console.log("[RecipesStore] PrÃ©chargement terminÃ©")}async getVariantGroup(e,r=2){const s=this.getRecipeIndexByUuid(e);if(!s)return{root:null,variants:[],isRoot:!1};const n=new Map,a=new Set;let o=s;for(;o.rootRecipeId&&!a.has(o.rootRecipeId);){a.add(o.$id);const l=this.getRecipeIndexByUuid(o.rootRecipeId);if(!l)break;o=l}const c=o;return n.set(c.$id,c),await v(this,Me,Yi).call(this,c.$id,n,new Set([c.$id]),0,r),{root:c,variants:Array.from(n.values()),isRoot:!s.rootRecipeId||s.rootRecipeId===s.$id}}findRootRecipe(e){const r=new Set;let s=e,n=10;for(let a=0;a<n;a++){const o=this.getRecipeIndexByUuid(s);if(!o||!o.rootRecipeId)return s;if(r.has(s))return console.error("[RecipesStore] Cycle dÃ©tectÃ© dans rootRecipeId, retour Ã ",e),e;r.add(s),s=o.rootRecipeId}return e}destroy(){i(this,x)&&(i(this,x).close(),I(this,x,null)),f(i(this,V)).clear(),g(i(this,Sr),!1),I(this,Us,!1),console.log("[RecipesStore] Ressources nettoyÃ©es")}}V=new WeakMap,Re=new WeakMap,$e=new WeakMap,Sr=new WeakMap,Ln=new WeakMap,x=new WeakMap,Nt=new WeakMap,Ir=new WeakMap,Us=new WeakMap,Me=new WeakSet,La=async function(e){try{console.log("[RecipesStore] Chargement data.json...");const r=await fetch(Wp);if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);const s=await r.json();if(!Array.isArray(s.recipes))throw new Error("Format invalide: recipes n'est pas un tableau");const n=s.meta?.timestamp;if(g(i(this,Ln),n,!0),n&&e&&e.buildTimestamp&&e.buildTimestamp>=n){console.log(`[RecipesStore] Cache Ã  jour (Ts: ${e.buildTimestamp} >= ${n})`);return}console.log(`[RecipesStore] Nouvelle version dÃ©tectÃ©e ou cache manquant (Ts: ${n}), Traitement...`);const a=s.recipes.map(c=>_h(c));let o=0;a.forEach(c=>{const l=f(i(this,V)).get(c.$id);let u=!1;if(!l)u=!0;else{const d=new Date(c.$updatedAt).getTime(),h=new Date(l.$updatedAt).getTime();d>h&&(u=!0)}u&&(f(i(this,V)).set(c.$id,c),o++)}),console.log(`[RecipesStore] Smart Merge: ${o} recettes mises Ã  jour/ajoutÃ©es.`),i(this,x)&&(await i(this,x).saveRecipesIndex(f(i(this,V))),await i(this,x).saveMetadata({...e,buildTimestamp:n||Date.now()/1e3,recipesCount:f(i(this,V)).size,cacheVersion:1}))}catch(r){throw console.error("[RecipesStore] Erreur loadIndexFromDataJson:",r),r}},Pu=async function(e){console.log("[RecipesStore] Sync incrÃ©mentiel Appwrite...");const r=e?.lastAppwriteSync||"1970-01-01T00:00:00.000Z";e?.buildTimestamp&&new Date(e.buildTimestamp*1e3).toISOString(),console.log(`[RecipesStore] Sync Appwrite: depuis ${r}`);const s=await xp(r);if(s.length===0){console.log("[RecipesStore] Aucune mise Ã  jour Appwrite dÃ©tectÃ©e.");return}console.log(`[RecipesStore] ${s.length} recettes mises Ã  jour depuis Appwrite.`);let n=0,a=0;s.forEach(c=>{if(c.status==="deleted")f(i(this,V)).has(c.$id)&&(f(i(this,V)).delete(c.$id),a++,console.log(`[RecipesStore] Recette ${c.$id} supprimÃ©e (status=deleted)`));else{const l=Aa(c);f(i(this,V)).set(l.$id,l),n++}});const o=new Date().toISOString();i(this,x)&&(await i(this,x).saveRecipesIndex(f(i(this,V))),await i(this,x).saveMetadata({...e,lastAppwriteSync:o})),console.log(`[RecipesStore] Sync incrÃ©mentiel terminÃ© (${n} mises Ã  jour, ${a} supprimÃ©es).`)},Du=async function(){try{console.log("[RecipesStore] Configuration du Realtime...");const e=at();Bt.register([`databases.${e}.collections.${us}.documents`],async r=>{const s=r.payload;let n="update";if(r.events.some(a=>a.includes(".create"))?n="create":r.events.some(a=>a.includes(".delete"))&&(n="delete"),console.log(`[RecipesStore] â¡ï¸ Realtime RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){if(s.status==="deleted"){if(f(i(this,V)).delete(s.$id),i(this,x))try{await i(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e de l'index (status=deleted)`)}catch(l){console.warn(`[RecipesStore] Erreur suppression index ${s.$id}:`,l)}return}const a=Aa(s);f(i(this,V)).set(s.$id,a);const o=ka(s.ingredients),c={...s,ingredients:o,astuces:Ci(s.astuces)};if(i(this,x))try{await i(this,x).saveRecipeDetail(c),console.log(`[RecipesStore] DÃ©tails de ${s.$id} mis Ã  jour dans le cache`)}catch(l){console.warn(`[RecipesStore] Erreur mise Ã  jour cache dÃ©tails ${s.$id}:`,l)}}else if(n==="delete"&&(f(i(this,V)).delete(s.$id),i(this,x)))try{await i(this,x).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e du cache`)}catch(a){console.warn(`[RecipesStore] Erreur suppression cache ${s.$id}:`,a)}}),console.log("[RecipesStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[RecipesStore] Erreur lors de la configuration du realtime:",e)}},Ki=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},Yi=async function(e,r,s,n,a){if(!(n>a))for(const[o,c]of f(i(this,V)))r.has(o)||c.rootRecipeId===e&&(r.set(o,c),c.rootRecipeId&&c.rootRecipeId!==e&&!s.has(c.rootRecipeId)&&(s.add(c.rootRecipeId),await v(this,Me,Yi).call(this,c.rootRecipeId,r,s,n+1,a)))};const Xa=new Gp;function Vp(t){const e=Rr(t.specs)??null,r=fo(uo(t.purchases??[]));let s=[];e?.quantity&&(s=[e.quantity]);const n=Rr(t.totalNeededOverride),a=n?[n.totalOverride]:s,{numeric:o,display:c}=Ei(a,r);let l=Rr(t.stockReel)??null;if(l&&l.quantity&&l.unit){const p=ho.normalize(parseFloat(l.quantity),l.unit);l={...l,quantity:p.quantity,unit:p.unit}}const u=it(r),d=t.store?Rr(t.store):null,h=l?`${l.quantity} ${l.unit}`:u;return{$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,productHugoUuid:t.productHugoUuid||"",productName:t.productName,productType:t.productType||"none",pF:e?.pF??!1,pS:e?.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:t.isSynced,mainId:t.mainId,totalNeededRaw:[],status:t.status,who:t.who,store:t.store,stockReel:t.stockReel,previousNames:t.previousNames,isMerged:t.isMerged,mergedFrom:t.mergedFrom,mergeDate:t.mergeDate,mergeReason:t.mergeReason,mergedInto:t.mergedInto,totalNeededOverride:t.totalNeededOverride,purchases:t.purchases,specs:t.specs,byDate:{},storeInfo:d,stockParsed:l,specsParsed:e,totalNeededArray:s,totalPurchasesArray:r,missingQuantityArray:o,stockOrTotalPurchases:h,displayTotalNeeded:it(s),displayTotalPurchases:u,displayMissingQuantity:c,totalNeededOverrideParsed:n,displayTotalOverride:n?it([n.totalOverride]):"",dateDisplayInfo:{}}}function Pa(t,e){const r=t.purchases??e.purchases,s=t.specs??e.specs,n=s?Rr(s):e.specsParsed,a=fo(uo(r??[])),o=it(a);let c=e.totalNeededArray;!e.productHugoUuid&&n?.quantity&&(c=[n.quantity]);const l=Rr(t.totalNeededOverride??e.totalNeededOverride),u=l?[l.totalOverride]:c,{numeric:d,display:h}=Ei(u,a),p=t.stockReel??e.stockReel;let m=p?Rr(p):e.stockParsed;if(m&&m.quantity&&m.unit){const A=ho.normalize(parseFloat(m.quantity),m.unit);m={...m,quantity:A.quantity,unit:A.unit}}const b=t.store??e.store,R=b?Rr(b):e.storeInfo,S=m?`${m.quantity} ${m.unit}`:o;return t.purchases===void 0&&e.purchases?.length&&console.log(`[ProductsStore] Fusion intelligente : prÃ©servation de ${e.purchases.length} purchases pour ${e.productName}`),{...e,$updatedAt:t.$updatedAt,productName:t.productName??e.productName,productType:t.productType??e.productType,isSynced:t.isSynced??e.isSynced,mainId:t.mainId??e.mainId,pF:n?.pF??e.pF,pS:n?.pS??e.pS,status:t.status??e.status,who:t.who??e.who,store:b,stockReel:p,specs:s,purchases:r,previousNames:t.previousNames??e.previousNames,isMerged:t.isMerged??e.isMerged,mergedFrom:t.mergedFrom??e.mergedFrom,mergeDate:t.mergeDate??e.mergeDate,mergeReason:t.mergeReason??e.mergeReason,mergedInto:t.mergedInto??e.mergedInto,totalNeededOverride:t.totalNeededOverride??e.totalNeededOverride,storeInfo:R,stockParsed:m,specsParsed:n,totalNeededArray:c,totalPurchasesArray:a,missingQuantityArray:d,stockOrTotalPurchases:S,displayTotalPurchases:o,displayMissingQuantity:h,displayTotalNeeded:it(c),totalNeededOverrideParsed:l,displayTotalOverride:l?it([l.totalOverride]):""}}function Qp(t){t.totalPurchasesArray=fo(uo(t.purchases??[]));const e=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray,{numeric:r,display:s}=Ei(e,t.totalPurchasesArray);t.missingQuantityArray=r,t.displayMissingQuantity=s}async function Cc(t,e,r){console.log(`[productEnrichment] Calcul pour Ã©vÃ©nement ${t.$id} avec ${t.meals.length} repas`);const s=new Set;for(const l of t.meals)for(const u of l.recipes)s.add(u.recipeUuid);console.log(`[productEnrichment] ${s.size} recettes uniques identifiÃ©es`);const n=await Xa.getRecipesByUuidsBulk([...s]);console.log(`[productEnrichment] ${n.size}/${s.size} recettes chargÃ©es`);const a=l=>Promise.resolve(n.get(l)||null),o=new Map;for(const l of t.meals)await Jp(l,a,o);const c=[];for(const[l,u]of o)c.push(Yp(u,r));return console.log(`[productEnrichment] ${c.length} produits calculÃ©s`),c}async function Jp(t,e,r){const s=t.date;for(const n of t.recipes){const a=await e(n.recipeUuid);if(!a){console.warn(`[processMeal] Recette ${n.recipeUuid} introuvable`);continue}const o=n.plates/a.plate;for(const c of a.ingredients)Kp(c,o,s,r,a.title,n.plates)}}function Kp(t,e,r,s,n,a){const o=t.uuid;s.has(o)||s.set(o,{productHugoUuid:o,productName:t.name,productType:t.type,pF:t.pF??!1,pS:t.pS??!1,byDate:{},allergens:new Set(t.allergens||[])});const c=s.get(o),l=t.normalizedUnit==="au goÃ»t"?t.normalizedQuantity:t.normalizedQuantity*e,u=t.normalizedUnit==="au goÃ»t"?t.originalQuantity:t.originalQuantity*e;c.byDate[r]||(c.byDate[r]={quantities:[],recipes:[],totalAssiettes:0});const d=c.byDate[r];d.quantities.push({q:l,u:t.normalizedUnit}),d.recipes.push({r:n,q:u,u:t.originalUnit,qEq:l,uEq:t.normalizedUnit,a}),d.totalAssiettes+=a,t.allergens&&t.allergens.forEach(h=>c.allergens.add(h))}function Yp(t,e){const r=Ql(t.productName).substring(0,20),s=e.slice(-10),n=`${r}_${s}`,a={};for(const[A,O]of Object.entries(t.byDate))a[A]={totalConsolidated:Qi(O.quantities),recipes:O.recipes,totalAssiettes:O.totalAssiettes,recipeCount:O.recipes.length};const o=Object.values(a).flatMap(A=>A.totalConsolidated),c=Qi(o),l=[],u=[],d=c,{numeric:h,display:p}=Ei(d,l),m=Object.values(a).reduce((A,O)=>A+O.recipeCount,0),b=Object.values(a).reduce((A,O)=>A+O.totalAssiettes,0),R=yh(Object.keys(a));return{$id:n,mainId:e,productHugoUuid:t.productHugoUuid,productName:t.productName,productType:t.productType,byDate:a,totalNeededArray:c,totalPurchasesArray:l,missingQuantityArray:h,displayTotalNeeded:it(c),displayTotalPurchases:it(l),displayMissingQuantity:p,isSynced:!1,status:"active",who:[],store:"",storeInfo:null,purchases:u,stockReel:"",stockParsed:null,totalNeededOverride:null,totalNeededOverrideParsed:null,displayTotalOverride:"",stockOrTotalPurchases:"",previousNames:null,isMerged:!1,mergedFrom:[],mergeDate:null,mergeReason:null,mergedInto:null,specs:null,specsParsed:null,pF:t.pF??!1,pS:t.pS??!1,nbRecipes:m,totalAssiettes:b,totalNeededRaw:c,dateDisplayInfo:R,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],$databaseId:"",$tableId:""}}function Mu(t,e){const{operationName:r,maxAutoRetries:s=1,autoRetryDelay:n=1e3}=e;let a=1;return new Promise((o,c)=>{const l=async()=>{try{console.log(`[RetryUtils] ${r} - Tentative ${a}/${s+1}`);const u=await t();console.log(`[RetryUtils] ${r} - SuccÃ¨s`),e.onSuccess?.(u),o(u)}catch(u){if(console.error(`[RetryUtils] Erreur ${r} (Tentative ${a}):`,u),u instanceof Error&&u.message,a<=s){a++,console.log(`[RetryUtils] Nouvelle tentative dans ${n/1e3}s...`),setTimeout(()=>l(),n);return}console.error(`[RetryUtils] ${r} - Ãchec aprÃ¨s ${a} tentatives`),e.onError?.(u),c(u)}};l()})}function va(t){if(!t)return[];const e=[],r=t.$id;return e.push(ee.read(se.label(r)),ee.update(se.label(r))),e}function Xp(t,e,r,s){let n=t.who,a=t.store;return r==="who"?n=e.names||null:r==="store"&&(a=JSON.stringify(e)),{$id:t.$id,productHugoUuid:t.productHugoUuid,productName:t.productName,mainId:t.mainId,status:t.status||null,who:n,store:a,stockReel:t.stockReel||null,previousNames:t.previousNames||null,isMerged:t.isMerged||!1,mergedFrom:t.mergedFrom||null,mergeDate:t.mergeDate||null,mergeReason:t.mergeReason||null,mergedInto:t.mergedInto||null,totalNeededOverride:t.totalNeededOverride||null,$permissions:[ee.read(se.label(s)),ee.update(se.label(s))]}}function $u(t,e){return{$id:t.$id,mainId:t.mainId,productHugoUuid:t.productHugoUuid,productName:t.productName,...e}}async function Zp(t){const{account:e}=await D(),r=await e.get();return{...t,updatedBy:r.name}}function Cu(){return localStorage.getItem("appwrite-user-name")||""}async function ku(t,e,r=100){try{const{tables:s,config:n}=await D(),a=await s.listRows({databaseId:n.databaseId,tableId:n.collections.purchases,queries:[E.greaterThan("$updatedAt",e),E.equal("mainId",t),E.limit(r)]});return console.log(`[Appwrite product] ${a.rows.length} purchases modifiÃ©s chargÃ©s`),a.rows}catch(s){return console.error("[Appwrite product] Erreur chargement purchases modifiÃ©s:",s),[]}}async function Nu(t,e){const{lastSync:r,limit:s=1e3}=e;try{const{tables:n,config:a}=await D();if(!r){console.log("[Appwrite product] Chargement complet des produits et achats");const p=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[E.equal("mainId",t),E.limit(s)]})).rows,b=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[E.equal("mainId",t),E.limit(s*2)]})).rows,R=new Map;return p.forEach(S=>{R.set(S.$id,{...S,purchases:[]})}),b.forEach(S=>{S.products?.forEach(A=>{const O=R.get(A);O&&(O.purchases||(O.purchases=[]),O.purchases.push(S))})}),console.log(`[Appwrite product] ${p.length} produits chargÃ©s avec ${b.length} achats`),Array.from(R.values())}const o=await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[E.greaterThan("$updatedAt",r),E.equal("mainId",t),E.limit(s)]}),c=o.rows,u=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[E.greaterThan("$updatedAt",r),E.equal("mainId",t),E.limit(s*2)]})).rows,d=new Map;return c.forEach(h=>{d.set(h.$id,{...h,purchases:[]})}),u.forEach(h=>{h.products?.forEach(p=>{const m=d.get(p);m&&(m.purchases||(m.purchases=[]),m.purchases.push(h))})}),o.rows.length>0&&console.log(`[Appwrite product] ${o.rows.length} produits synchronisÃ©s (delta)`),Array.from(d.values())}catch(n){console.error(`[Appwrite product] Erreur sync produits avec purchases pour mainId ${t}:`,n);const a=n instanceof Error?n.message:"Erreur lors de la synchronisation";throw new Error(`Ãchec de la synchronisation: ${a}`)}}async function Tu(t,e,r=!0){const{tables:s,config:n}=await D();return r&&(e.updatedBy=Cu()),await s.updateRow({databaseId:n.databaseId,tableId:n.collections.products,rowId:t,data:e})}async function Lu(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour crÃ©ation`);console.log(`[Appwrite product] CrÃ©ation produit ${t} sur Appwrite...`);const n=$u(s,e),a=await Zp(n),{tables:o,config:c}=await D(),l=ke.getEventById(a.mainId),u=va(l),d=await o.createRow({databaseId:c.databaseId,tableId:c.collections.products,rowId:t,data:a,permissions:u});return console.log(`[Appwrite product] Produit ${t} crÃ©Ã© avec permissions (labels + teams)`),d}catch(s){console.error(`[Appwrite product] Erreur crÃ©ation produit ${t}:`,s);const n=s instanceof Error?s.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation du produit: ${n}`)}}async function zp(t,e){try{const{tables:r,config:s}=await D(),a=`${Ql(t.productName).substring(0,10)}_${Date.now().toString(36)}`,o={quantity:t.quantity,pF:t.pF||!1,pS:t.pS||!1},c={productHugoUuid:null,productName:t.productName,productType:t.productType||"Autre",store:t.store?JSON.stringify(t.store):null,who:t.who||[],isSynced:!0,mainId:e,status:"active",updatedBy:Cu(),stockReel:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,mergedInto:null,totalNeededOverride:null,specs:JSON.stringify(o)};console.log(`[Appwrite product] CrÃ©ation produit manuel ${a}...`,c);const l=ke.getEventById(e),u=va(l),d=await r.createRow({databaseId:s.databaseId,tableId:s.collections.products,rowId:a,data:c,permissions:u});return console.log(`[Appwrite product] Produit manuel ${a} crÃ©Ã© avec permissions Label`),d}catch(r){throw console.error("[Appwrite product] Erreur crÃ©ation produit manuel:",r),r}}async function Fp(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour mise Ã  jour batch`);const n={};return e.stockReel!==void 0&&(n.stockReel=e.stockReel),e.who!==void 0&&(n.who=e.who),e.storeInfo!==void 0&&(n.store=JSON.stringify(e.storeInfo)),s.isSynced?(console.log(`[Appwrite product] Produit ${t} dÃ©jÃ  sync, update batch normal...`),await Tu(t,n)):(console.log(`[Appwrite product] Produit ${t} local, crÃ©ation batch avec upsert...`),await Lu(t,n,r))}catch(s){throw console.error(`[Appwrite product] Erreur lors de la mise Ã  jour batch du produit ${t}:`,s),s}}async function eg(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow(s.databaseId,s.collections.purchases,t,e);return console.log(`[Appwrite product] Achat ${t} mis Ã  jour:`,e),n}catch(r){console.error(`[Appwrite product] Erreur mise Ã  jour achat ${t}:`,r);const s=r instanceof Error?r.message:"Erreur inconnue";throw new Error(`Ãchec de la mise Ã  jour de l'achat: ${s}`)}}async function tg(t){try{const{tables:e,config:r}=await D();await e.deleteRow(r.databaseId,r.collections.purchases,t),console.log(`[Appwrite product] Achat ${t} supprimÃ©`)}catch(e){console.error(`[Appwrite product] Erreur suppression achat ${t}:`,e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec de la suppression de l'achat: ${r}`)}}async function ju(t){if(!t?.length)return[];try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[E.equal("$id",t)]);return console.log(`[Appwrite product] ${s.rows.length} purchases chargÃ©s avec relations products`),s.rows}catch(e){console.error("[Appwrite product] Erreur chargement purchases avec relations:",e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec du chargement des purchases: ${r}`)}}async function rg(t,e,r,s){try{const{functions:n,config:a,account:o}=await D(),c=zu.currentMainId;if(!c)throw new Error("No current event - cannot determine mainId for permissions");const l=await o.get(),u=t.map(m=>{const b=e.find(R=>R.$id===m);if(!b)throw new Error(`Product ${m} not found in products data`);return Xp(b,s,r,c)});console.log(`[Appwrite product] Lancement mise Ã  jour groupÃ©e OPTIMISÃE: ${u.length} produits, type: ${r}`);const d={operation:"batchUpdateProductsOptimized",data:{rows:u,fromUserId:l.$id}},h=await Mu(()=>n.createExecution(a.functions.batchUpdate,JSON.stringify(d),!1,"/",fn.POST),{operationName:`batchUpdateProductsOptimized (${u.length} products, type: ${r})`,maxAutoRetries:1,autoRetryDelay:2e3});if(!h)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives de mise Ã  jour groupÃ©e optimisÃ©e");if(h.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${h.status}. Erreur: ${h.stderr||h.responseBody}`);const p=JSON.parse(h.responseBody);return p.success?console.log(`[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e rÃ©ussie: ${p.updatedCount} produits mis Ã  jour`):console.error("[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e Ã©chouÃ©e:",p.error),p}catch(n){console.error("[Appwrite products] Erreur mise Ã  jour groupÃ©e optimisÃ©e:",n);const a=n instanceof Error?n.message:"Erreur inconnue";return{success:!1,updatedCount:t.length,updateType:r,error:a,timestamp:new Date().toISOString()}}}async function sg(t,e,r,s={}){try{const{tables:n,config:a,account:o}=await D(),c=await o.get(),l=ke.getEventById(t),u=va(l),d=[];console.log("[Appwrite product] Debug createQuickValidationPurchases:",{mainId:t,productId:e,productIdType:typeof e,quantities:r,options:s});for(const h of r){const p={products:[e],mainId:t,quantity:h.q,unit:h.u,status:"delivered",notes:s.notes||`Validation rapide ${new Date().toLocaleDateString("fr-FR")}`,store:s.store??null,who:c.name,price:null,orderDate:null,deliveryDate:null,createdBy:c.$id,invoiceId:s.invoiceId,invoiceTotal:null},m=await n.createRow(a.databaseId,a.collections.purchases,lt.unique(),p,u);d.push(m)}return console.log(`[Appwrite product] ${d.length} validations rapides crÃ©Ã©es avec permissions (labels + teams) pour produit ${e}`),d}catch(n){console.error("[Appwrite product] Erreur crÃ©ation validation rapide:",n);const a=n instanceof Error?n.message:"Erreur inconnue";throw new Error(`Ãchec de la validation rapide: ${a}`)}}async function ng(t,e,r,s,n,a){try{const{tables:o,config:c,account:l}=await D(),u=await l.get(),d=e||lt.unique(),h=u.name;if(!r)throw new Error("invoiceTotal est requis pour une dÃ©pense");const p=ke.getEventById(t),m=va(p),b={products:[],mainId:t,quantity:1,unit:"global",status:"expense",notes:n||"",store:s??null,who:h||u.name,price:r,invoiceId:d,invoiceTotal:r,orderDate:null,deliveryDate:null,createdBy:u.$id},R=await o.createRow(c.databaseId,c.collections.purchases,lt.unique(),b,m);return console.log("[Appwrite product] DÃ©pense crÃ©Ã©e avec permissions (labels + teams):",R),R}catch(o){console.error("[Appwrite product] Erreur crÃ©ation dÃ©pense:",o);const c=o instanceof Error?o.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation de la dÃ©pense: ${c}`)}}async function qu(t){try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[E.equal("mainId",t),E.equal("status","expense"),E.limit(1e3)]);return console.log(`[Appwrite product] ${s.rows.length} dÃ©penses globales chargÃ©es`),s.rows}catch(e){return console.error("[Appwrite product] Erreur chargement dÃ©penses globales:",e),[]}}const qr=Object.freeze(Object.defineProperty({__proto__:null,batchUpdateProductsOptimized:rg,createExpensePurchase:ng,createManualProduct:zp,createQuickValidationPurchases:sg,deletePurchase:tg,enrichedProductToAppwriteProduct:$u,getEventPermissionsFromEvent:va,loadOrphanPurchases:qu,loadPurchasesListByIds:ju,loadUpdatedPurchases:ku,syncProductsWithPurchases:Nu,updateProduct:Tu,updateProductBatch:Fp,updatePurchase:eg,upsertProduct:Lu},Symbol.toStringTag,{value:"Module"}));class ag{constructor(e){C(this,"dbName");C(this,"db",null);C(this,"version",1);C(this,"PRODUCTS_STORE","products");C(this,"METADATA_STORE","metadata");C(this,"LAST_SYNC_KEY","lastSync");C(this,"ALL_DATES_KEY","allDates");C(this,"HUGO_HASH_KEY","hugoContentHash");this.dbName=`products-cache-${e}`}async open(){if(!this.db)return new Promise((e,r)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>r(s.error),s.onsuccess=()=>{this.db=s.result,console.log(`[IDBCache] Base ouverte: ${this.dbName}`),e()},s.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(this.PRODUCTS_STORE)||(a.createObjectStore(this.PRODUCTS_STORE,{keyPath:"$id"}),console.log("[IDBCache] Object store 'products' crÃ©Ã©")),a.objectStoreNames.contains(this.METADATA_STORE)||(a.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[IDBCache] Object store 'metadata' crÃ©Ã© avec keyPath"))}})}async loadProducts(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.PRODUCTS_STORE,"readonly").objectStore(this.PRODUCTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[IDBCache] ${o.size} produits chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null,allDates:[],hugoContentHash:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY?c.lastSync=l.value:l.key===this.ALL_DATES_KEY?c.allDates=l.value||[]:l.key===this.HUGO_HASH_KEY&&(c.hugoContentHash=l.value)}),console.log(`[IDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}, dates=${c.allDates?.length||0}, hash=${c.hugoContentHash}`),e(c)},a.onerror=()=>r(a.error)})}async saveProducts(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.PRODUCTS_STORE,"readwrite"),a=n.objectStore(this.PRODUCTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[IDBCache] ${e.size} produits sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_KEY,value:e.lastSync}),a.put({key:this.ALL_DATES_KEY,value:e.allDates}),e.hugoContentHash!==void 0&&a.put({key:this.HUGO_HASH_KEY,value:e.hugoContentHash}),n.oncomplete=()=>{console.log("[IDBCache] Metadata sauvegardÃ©es (objets {key, value})"),r()},n.onerror=()=>s(n.error)})}async updateLastSync(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] lastSync mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateAllDates(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.ALL_DATES_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] allDates mis Ã  jour: ${e.length} dates`),r()},o.onerror=()=>s(o.error)})}async updateHugoContentHash(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.HUGO_HASH_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] hugoContentHash mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateLastHugoMenuUpdate(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:"lastHugoMenuUpdate",value:e});o.onsuccess=()=>{console.log("[IDBCache] lastHugoMenuUpdate sauvegardÃ©"),r()},o.onerror=()=>s(o.error)})}async upsertProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).put(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.PRODUCTS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.PRODUCTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[IDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[IDBCache] Connexion fermÃ©e"))}}async function ig(t){const e=new ag(t);return await e.open(),e}var jn,qn;class hs{constructor(e,r){y(this,jn,P(ge({})));C(this,"dateStore");y(this,qn,Z(()=>{const e=this.dateStore.current;this.dateStore.dates;let r;if(e.start&&e.end)r=wh(this.data,e.start,e.end);else return{quantities:[],formattedQuantities:"",nbRecipes:0,totalAssiettes:0,stockResult:[],availableQuantities:[],missingQuantities:[],formattedMissingQuantities:"",formattedAvailableQuantities:"En attente",hasAvailable:!1,hasMissing:!1,concernedDates:[],recipesByDate:new Map};return{quantities:r.requiredQuantities,formattedQuantities:r.requiredQuantitiesFormatted,nbRecipes:r.totalRecipesInRange,totalAssiettes:r.totalPortionsInRange,stockResult:r.stockBalance,availableQuantities:r.availableStockQuantities,missingQuantities:r.missingStockQuantities,formattedMissingQuantities:r.missingStockFormatted,formattedAvailableQuantities:r.availableStockFormatted,hasAvailable:r.hasAvailableStock,hasMissing:r.hasMissingStock,concernedDates:r.datesInSelectedRange,recipesByDate:r.recipesByDate}}));this.data=e,this.dateStore=r}get data(){return f(i(this,jn))}set data(e){g(i(this,jn),e,!0)}update(e){this.data=e}get $id(){return this.data.$id}get productName(){return this.data.productName}get productType(){return this.data.productType}get storeInfo(){return this.data.storeInfo}get who(){return this.data.who}get pF(){return this.data.pF}get pS(){return this.data.pS}get status(){return this.data.status}get previousNames(){return this.data.previousNames}get purchases(){return this.data.purchases}get totalNeededOverrideParsed(){return this.data.totalNeededOverrideParsed}get displayMissingQuantity(){return this.data.displayMissingQuantity}get missingQuantityArray(){return this.data.missingQuantityArray}get isSynced(){return this.data.isSynced}get byDate(){return this.data.byDate}get stats(){return f(i(this,qn))}set stats(e){g(i(this,qn),e)}}jn=new WeakMap,qn=new WeakMap;var ie,pe,ye,Un,Bn,On,xn,Hn,Wn,Gn,Vn,Qn;class og{constructor(e=[]){y(this,ie,P(ge([])));y(this,pe,P(null));y(this,ye,P(null));y(this,Un,Z(()=>[...f(i(this,ie))].sort()[0]));y(this,Bn,Z(()=>[...f(i(this,ie))].sort()[f(i(this,ie)).length-1]));y(this,On,Z(()=>{if(f(i(this,ie)).length===0)return!0;const e=this.lastAvailableDate?new Date(this.lastAvailableDate):new Date;return e.setHours(23,59,59,999),e<new Date}));y(this,xn,Z(()=>{if(f(i(this,ie)).length===0)return!1;const e=new Date;return e.setHours(0,0,0,0),f(i(this,ie)).some(r=>new Date(r)>=e)}));y(this,Hn,Z(()=>f(i(this,pe))===this.firstAvailableDate&&f(i(this,ye))===this.lastAvailableDate));y(this,Wn,Z(()=>{if(f(i(this,ie)).length===0)return!1;const e=[...f(i(this,ie))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(o=>new Date(o)>=r)||null;let n,a;if(s)n=s,a=e[e.length-1];else{const o=e[e.length-1];n=o,a=o}return f(i(this,pe))===n&&f(i(this,ye))===a}));y(this,Gn,Z(()=>f(i(this,ie)).length===1));y(this,Vn,Z(()=>!!(f(i(this,pe))&&f(i(this,pe))===f(i(this,ye)))));y(this,Qn,Z(()=>{if(!f(i(this,pe))||!f(i(this,ye))||this.isEventPassed)return!1;const e=new Date(f(i(this,pe)));return e.setHours(e.getHours()+Jl),e<new Date}));g(i(this,ie),e,!0),this.initializeSmartRange()}get start(){return f(i(this,pe))}get end(){return f(i(this,ye))}get dates(){return f(i(this,ie))}get firstAvailableDate(){return f(i(this,Un))}set firstAvailableDate(e){g(i(this,Un),e)}get lastAvailableDate(){return f(i(this,Bn))}set lastAvailableDate(e){g(i(this,Bn),e)}get current(){return{start:f(i(this,pe)),end:f(i(this,ye))}}get isEventPassed(){return f(i(this,On))}set isEventPassed(e){g(i(this,On),e)}get hasUpcomingDates(){return f(i(this,xn))}set hasUpcomingDates(e){g(i(this,xn),e)}get isFullRange(){return f(i(this,Hn))}set isFullRange(e){g(i(this,Hn),e)}get isUpcomingRange(){return f(i(this,Wn))}set isUpcomingRange(e){g(i(this,Wn),e)}get hasSingleDateEvent(){return f(i(this,Gn))}set hasSingleDateEvent(e){g(i(this,Gn),e)}get hasSingleDateInRange(){return f(i(this,Vn))}set hasSingleDateInRange(e){g(i(this,Vn),e)}get hasPastDatesInRange(){return f(i(this,Qn))}set hasPastDatesInRange(e){g(i(this,Qn),e)}setAvailableDates(e){g(i(this,ie),e,!0),this.initializeSmartRange()}setRange(e,r){if(!e&&!r){g(i(this,pe),null),g(i(this,ye),null);return}if(!e||!r){const a=e||r;g(i(this,pe),a,!0),g(i(this,ye),a,!0);return}const s=new Date(e)<=new Date(r)?e:r,n=new Date(e)>=new Date(r)?e:r;g(i(this,pe),s,!0),g(i(this,ye),n,!0)}selectAll(){f(i(this,ie)).length!==0&&(g(i(this,pe),f(i(this,ie))[0],!0),g(i(this,ye),f(i(this,ie))[f(i(this,ie)).length-1],!0))}selectUpcoming(){if(f(i(this,ie)).length===0)return;const e=[...f(i(this,ie))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(n=>new Date(n)>=r)||null;if(s)g(i(this,pe),s,!0),g(i(this,ye),e[e.length-1],!0);else{const n=e[e.length-1];g(i(this,pe),n,!0),g(i(this,ye),n,!0)}}selectFutureDatesOnly(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const r=f(i(this,ie)).filter(s=>new Date(s)>=e);r.length>0&&(g(i(this,pe),r[0],!0),g(i(this,ye),r[r.length-1],!0))}initializeSmartRange(){if(f(i(this,ie)).length===0)return;const e=[...f(i(this,ie))].sort(),r=this.isEventPassed,s=new Date(e[0])<new Date,n=new Date;let a;r?a=e[0]:s?a=n.toISOString().slice(0,19)+"Z":a=e[0],g(i(this,pe),a,!0),g(i(this,ye),e[e.length-1],!0),console.log(`[DateRangeStore] Initialized: ${f(i(this,pe))} - ${f(i(this,ye))}`)}reset(){g(i(this,ie),[],!0),g(i(this,pe),null),g(i(this,ye),null),console.log("[DateRangeStore] Reset")}}ie=new WeakMap,pe=new WeakMap,ye=new WeakMap,Un=new WeakMap,Bn=new WeakMap,On=new WeakMap,xn=new WeakMap,Hn=new WeakMap,Wn=new WeakMap,Gn=new WeakMap,Vn=new WeakMap,Qn=new WeakMap;function cg(t,e={}){const{showOtherUserToasts:r=!0}=e;return s=>{const{events:n,payload:a}=s;if(!a)return;if(s.event==="client.connected"){t.onConnect?.();return}const o=n.some(h=>h.includes("products.")),c=n.some(h=>h.includes("purchases.")),l=n.some(h=>h.includes(".create")),u=n.some(h=>h.includes(".update")),d=n.some(h=>h.includes(".delete"));o?lg(a,{isCreate:l,isUpdate:u,isDelete:d},t,r):c&&ug(a,{isCreate:l,isUpdate:u,isDelete:d},t,r)}}function lg(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;s&&t.updatedBy&&t.updatedBy!==L.userName&&(n||a?xe.info(`${t.updatedBy} a modifiÃ© le produit "${t.productName}"`,{source:"realtime-other"}):o&&xe.info(`${t.updatedBy} a supprimÃ© un produit`,{source:"realtime-other"})),n?r.onProductCreate(t):a?r.onProductUpdate(t):o&&r.onProductDelete(t.$id)}function ug(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;if(s&&t.createdBy&&t.createdBy!==L.userName){const c="un produit";n&&t.who!==L.userName?xe.info(`${t.who} a ajoutÃ© un achat pour ${c}`,{source:"realtime-other"}):a&&t.who!==L.userName?xe.info(`${t.who} a modifiÃ© un achat pour ${c}`,{source:"realtime-other"}):o&&xe.info(`${t.who} a supprimÃ© un achat pour ${c}`,{source:"realtime-other"})}n?r.onPurchaseCreate(t):a?r.onPurchaseUpdate(t):o&&r.onPurchaseDelete(t.$id)}function dg(t,e={}){const r=at(),s=fr("products"),n=fr("purchases"),a=[`databases.${r}.collections.${s}.documents`,`databases.${r}.collections.${n}.documents`],o=cg(t,e),c=Bt.registerDynamic(a,o);return console.log(`[ProductsRealtimeHandler] â Realtime configurÃ© (${a.length} channels)`),c}const kc=1e3;var q,Ye,Pe,Ce,Ar,Jn,Bs,es,ts,Ue,te,_r,Kn,$,tt,j,Yn,Xn,Zn,zn,Fn,di,ea,ta,fi,Uu,Os,er,Bu,Ou,ja,qa,xu,Xi,hg,Ua,Hu,Wu,Gu,Vu,Qu,Ba,Zi,Ju,Ku,Yu,Xu,Zu,ra,sa;class fg{constructor(){y(this,$);y(this,q,new ct);y(this,Ye,new ct);y(this,Pe,P(null));y(this,Ce,P(null));y(this,Ar,P(!1));y(this,Jn,P(!1));y(this,Bs,P(null));y(this,es,P(!1));y(this,ts,P(!1));y(this,Ue,P(null));C(this,"dateStore",new og);y(this,te,null);y(this,_r,null);y(this,Kn,P(ge([])));y(this,j,P(ge({searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"})));y(this,Yn,Z(()=>{const e=Array.from(i(this,q).values()).map(r=>r.data);return console.log(`[ProductsStore] enrichedProducts recalculated: ${e.length} products`),e}));y(this,Xn,Z(()=>{if(console.log("[Store] Filtering products by date range (Map)"),!this.dateRange.start||!this.dateRange.end)return new Map;new Date(this.dateRange.start),new Date(this.dateRange.end);const e=new Map,r=this.dateRange.start,s=this.dateRange.end;for(const[n,a]of i(this,q)){const o=a.data,c=!o.productHugoUuid;if(!o.byDate&&!c||!hh(o,f(i(this,j))))continue;if(f(i(this,j)).completionStatus!=="all"){const d=a.stats.hasMissing;if(f(i(this,j)).completionStatus==="completed"&&d||f(i(this,j)).completionStatus==="incomplete"&&!d)continue}let u=!1;o.byDate&&(u=Object.keys(o.byDate).some(d=>d>=r&&d<=s)),(u||c)&&e.set(n,a)}return e}));y(this,Zn,Z(()=>({total:i(this,q).size,frais:Array.from(i(this,q).values()).filter(e=>e.pF).length,surgel:Array.from(i(this,q).values()).filter(e=>e.pS).length,merged:Array.from(i(this,q).values()).filter(e=>e.data.isMerged).length})));y(this,zn,Z(()=>{const e=Array.from(i(this,q).values()).map(r=>r.storeInfo?.storeName).filter(Boolean);return[...new Set(e)]}));y(this,Fn,Z(()=>{if(!f(i(this,Ce)))return[];const e=ke.getEventById(f(i(this,Ce)));return e?.contributors?e.contributors.filter(r=>r.status==="accepted"&&r.name?.trim()).map(r=>r.name.trim()).sort():[]}));y(this,di,Z(()=>{const e=Array.from(i(this,q).values()).flatMap(r=>r.who||[]);return[...new Set(e)].sort()}));y(this,ea,Z(()=>{const e=new Set([...this.eventContributors,...f(i(this,di))]);return Array.from(e).sort()}));y(this,ta,Z(()=>{const e=Array.from(i(this,q).values()).map(r=>r.productType).filter(Boolean);return[...new Set(e)]}));y(this,fi,Z(()=>{const r=Array.from(this.filteredProductsMap.values()).sort((o,c)=>o.$id.localeCompare(c.$id));if(f(i(this,j)).groupBy==="none")return{"":r};const s=Object.groupBy(r,o=>f(i(this,j)).groupBy==="store"?o.storeInfo?.storeName||"Non dÃ©fini":o.productType||"Non dÃ©fini"),n=Object.keys(s).sort((o,c)=>o===""?1:c===""?-1:o.localeCompare(c)),a={};return n.forEach(o=>{a[o]=s[o]}),a}));y(this,Os,"");y(this,er,null);C(this,"setSearchQuery",oh(e=>{f(i(this,j)).searchQuery=e,e.trim().length>0&&(f(i(this,j)).selectedStores=[],f(i(this,j)).selectedWho=[],f(i(this,j)).selectedProductTypes=[],f(i(this,j)).selectedTemperatures=[],f(i(this,j)).temperatureFilter="all",f(i(this,j)).completionStatus="all")},()=>500));y(this,ra,Z(()=>{let e=0,r=0;for(const s of i(this,q).values())s.stats.hasMissing?r++:e++;return{completed:e,missing:r,total:e+r}}));y(this,sa,Z(()=>{let e=0;const r={},s={},n=[];for(const a of i(this,Ye).values()){const o=a.invoiceTotal||a.price||0;e+=o;const c=a.store||"Non dÃ©fini";r[c]=(r[c]||0)+o;const l=a.who||"Non dÃ©fini";s[l]=(s[l]||0)+o,n.push(a)}for(const a of i(this,q).values()){const o=a.data;if(o.purchases&&o.purchases.length>0){for(const c of o.purchases)if(c.price){e+=c.price;const l=c.store||"Non dÃ©fini";r[l]=(r[l]||0)+c.price;const u=c.who||"Non dÃ©fini";s[u]=(s[u]||0)+c.price;const d={...c,_productName:o.productName};n.push(d)}}}return n.sort((a,o)=>{const c=new Date(a.orderDate||a.$createdAt).getTime();return new Date(o.orderDate||o.$createdAt).getTime()-c}),{totalGlobal:e,byStore:r,byWho:s,allPurchases:n}}))}get currentMainId(){return f(i(this,Pe))}get dateRange(){return this.dateStore.current}get availableDates(){return this.dateStore.dates}get isEventPassed(){return this.dateStore.isEventPassed}get hasSingleDateEvent(){return this.dateStore.hasSingleDateEvent}get hasSingleDateInRange(){return this.dateStore.hasSingleDateInRange}get hasPastDatesInRange(){return this.dateStore.hasPastDatesInRange}get hasPendingConflicts(){return f(i(this,Kn)).length>0}get pendingConflicts(){return f(i(this,Kn))}get filters(){return f(i(this,j))}get hasFilters(){return this.filters.searchQuery!==""||this.filters.selectedStores.length>0||this.filters.selectedWho.length>0||this.filters.selectedProductTypes.length>0||this.filters.selectedTemperatures.length>0||this.filters.temperatureFilter!=="all"||this.filters.completionStatus!=="all"}get isSearchActive(){return this.filters.searchQuery.trim().length>0}get activeFiltersDescription(){const e=[];if(this.filters.completionStatus==="incomplete"?e.push("Manquants"):this.filters.completionStatus==="completed"&&e.push("Complets"),this.filters.temperatureFilter!=="all"){const r={frais:"Frais","not-frais":"Sans frais",surgele:"SurgelÃ©s","not-surgele":"Sans surgelÃ©s"};e.push(r[this.filters.temperatureFilter]||"")}return this.filters.selectedProductTypes.length>0&&e.push(`Types: ${this.filters.selectedProductTypes.length}`),this.filters.selectedStores.length>0&&e.push(`Magasins: ${this.filters.selectedStores.length}`),this.filters.selectedWho.length>0&&e.push(`Qui: ${this.filters.selectedWho.length}`),e}get groupedFilteredProducts(){return f(i(this,fi))}get loading(){return f(i(this,Jn))}get error(){return f(i(this,Bs))}get lastSync(){return f(i(this,Ue))}get syncing(){return f(i(this,es))}setDateRange(e,r){this.dateStore.setRange(e,r)}isFullRange(){return this.dateStore.isFullRange}initializeDateRange(){this.dateStore.initializeSmartRange()}selectUpcomingDates(){this.dateStore.selectUpcoming()}isUpcomingRange(){return this.dateStore.isUpcomingRange}get firstAvailableDate(){return this.dateStore.firstAvailableDate}get lastAvailableDate(){return this.dateStore.lastAvailableDate}selectFutureDatesOnly(){this.dateStore.selectFutureDatesOnly()}get realtimeConnected(){return f(i(this,ts))}get enrichedProducts(){return f(i(this,Yn))}set enrichedProducts(e){g(i(this,Yn),e)}get filteredProductsMap(){return f(i(this,Xn))}set filteredProductsMap(e){g(i(this,Xn),e)}get stats(){return f(i(this,Zn))}set stats(e){g(i(this,Zn),e)}get uniqueStores(){return f(i(this,zn))}set uniqueStores(e){g(i(this,zn),e)}get eventContributors(){return f(i(this,Fn))}set eventContributors(e){g(i(this,Fn),e)}get uniqueWho(){return f(i(this,ea))}set uniqueWho(e){g(i(this,ea),e)}get uniqueProductTypes(){return f(i(this,ta))}set uniqueProductTypes(e){g(i(this,ta),e)}async initialize(e){if(!e?.trim())throw new Error("eventId invalide fourni");if(f(i(this,Ar))&&f(i(this,Ce))===e){console.log(`[ProductsStore] DÃ©jÃ  initialisÃ© pour eventId: ${e}`);return}f(i(this,Ar))&&f(i(this,Ce))!==e&&(console.log(`[ProductsStore] Changement d'Ã©vÃ©nement: ${f(i(this,Ce))} â ${e}, reset...`),this.reset()),console.log(`[ProductsStore] Initialisation avec eventId: ${e}`);const r=ke.getEventById(e);if(!r)throw new Error(`ÃvÃ©nement ${e} introuvable dans EventsStore`);try{g(i(this,Ce),r.$id,!0),g(i(this,Pe),r.$id,!0),console.log(`[ProductsStore] Initialisation du cache IDB pour mainId: ${f(i(this,Pe))}`),I(this,te,await ig(f(i(this,Pe)))),await v(this,$,Ou).call(this),i(this,q).size===0&&(console.log("[ProductsStore] Cache vide, calcul depuis event.meals..."),await v(this,$,Bu).call(this,r),await v(this,$,ja).call(this)),this.dateStore.setAvailableDates([...r.allDates||[]]),this.initializeDateRange(),await this.syncFromAppwrite(),await v(this,$,Zu).call(this),g(i(this,Ar),!0),v(this,$,Ku).call(this),i(this,er)&&i(this,er).call(this),I(this,er,gl(()=>{as(()=>{const s=ke.getEventById(e);s&&v(this,$,Uu).call(this,s)})})),console.log(`[ProductsStore] Initialisation complÃ©tÃ©e: ${i(this,q).size} produits`)}catch(s){const n=s instanceof Error?s.message:"Erreur lors de l'initialisation";throw g(i(this,Bs),n,!0),console.error("[ProductsStore]",n,s),s}}async syncFromAppwrite(){if(v(this,$,tt).call(this)){console.log("[ProductsStore] Mode local: skip syncFromAppwrite");return}if(f(i(this,Pe))){g(i(this,es),!0),console.log(`[ProductsStore] DÃ©but syncFromAppwrite pour mainId: ${f(i(this,Pe))}`);try{console.log(`[ProductsStore] RÃ©cupÃ©ration des produits modifiÃ©s depuis lastSync: ${f(i(this,Ue))}`);const e=await Nu(f(i(this,Pe)),{lastSync:f(i(this,Ue)),limit:kc});if(console.log(`[ProductsStore] ${e.length} produits rÃ©cupÃ©rÃ©s depuis Appwrite`),e.forEach(r=>{const s=i(this,q).get(r.$id);console.log(`[ProductsStore] Sync produit ${r.$id}: existing=${!!s}, who=${r.who}, store=${r.store}`);const n=v(this,$,Xi).call(this,r,s?.data);n.isSynced=!0,n.status="active",s?s.update(n):i(this,q).set(r.$id,new hs(n,this.dateStore))}),f(i(this,Ue))){console.log(`[ProductsStore] RÃ©cupÃ©ration des purchases modifiÃ©s depuis lastSync: ${f(i(this,Ue))}`);const r=await ku(f(i(this,Pe)),f(i(this,Ue)),kc);console.log(`[ProductsStore] ${r.length} purchases modifiÃ©s rÃ©cupÃ©rÃ©s`),r.forEach(s=>{if(s.status==="expense")i(this,Ye).set(s.$id,s);else if(s.products?.length){const n=s.products.map(a=>typeof a=="string"?a:a.$id);v(this,$,Ba).call(this,n,s)}})}v(this,$,xu).call(this),await v(this,$,ja).call(this),console.log("[ProductsStore] SyncFromAppwrite terminÃ© avec succÃ¨s")}catch(e){throw console.error("[ProductsStore] Erreur lors du sync:",e),e}finally{g(i(this,es),!1)}}}toggleProductType(e){const r=f(i(this,j)).selectedProductTypes.indexOf(e);r>-1?f(i(this,j)).selectedProductTypes.splice(r,1):f(i(this,j)).selectedProductTypes.push(e)}toggleTemperature(e){const r=f(i(this,j)).selectedTemperatures.indexOf(e);r>-1?f(i(this,j)).selectedTemperatures.splice(r,1):f(i(this,j)).selectedTemperatures.push(e)}setTemperatureFilter(e){f(i(this,j)).temperatureFilter=e}clearTypeAndTemperatureFilters(){f(i(this,j)).selectedProductTypes=[],f(i(this,j)).selectedTemperatures=[],f(i(this,j)).temperatureFilter="all"}setGroupBy(e){f(i(this,j)).groupBy=e}toggleStore(e){const r=f(i(this,j)).selectedStores.indexOf(e);r>-1?f(i(this,j)).selectedStores.splice(r,1):f(i(this,j)).selectedStores.push(e)}toggleWho(e){const r=f(i(this,j)).selectedWho.indexOf(e);r>-1?f(i(this,j)).selectedWho.splice(r,1):f(i(this,j)).selectedWho.push(e)}clearStoreFilters(){f(i(this,j)).selectedStores=[]}clearWhoFilters(){f(i(this,j)).selectedWho=[]}setCompletionStatus(e){f(i(this,j)).completionStatus=e}handleSort(e){f(i(this,j)).sortColumn===e?f(i(this,j)).sortDirection=f(i(this,j)).sortDirection==="asc"?"desc":"asc":(f(i(this,j)).sortColumn=e,f(i(this,j)).sortDirection="asc")}clearFilters(){g(i(this,j),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0)}sortProducts(e){return f(i(this,j)).sortColumn?[...e].sort((r,s)=>{let n=r[f(i(this,j)).sortColumn],a=s[f(i(this,j)).sortColumn];return f(i(this,j)).sortColumn==="totalNeededConsolidated"?(n=parseFloat(n)||0,a=parseFloat(a)||0):f(i(this,j)).sortColumn==="purchases"&&(n=r.purchases?.length||0,a=s.purchases?.length||0),n<a?f(i(this,j)).sortDirection==="asc"?-1:1:n>a?f(i(this,j)).sortDirection==="asc"?1:-1:0}):e}getEnrichedProductById(e){return i(this,q).get(e)?.data??null}getProductModelById(e){return i(this,q).get(e)??null}hasConversions(e){const r=i(this,q).get(e)?.data;return r?.byDate?fh(r.byDate):!1}async forceReload(e){await this.clearCache(),await this.initialize(e)}async clearCache(){i(this,q).clear(),g(i(this,Ue),null),i(this,te)&&await i(this,te).clear(),console.log("[ProductsStore] Cache vidÃ©")}setSyncStatus(e,r){const s=r?"isSyncing":"active";e.forEach(n=>{const a=i(this,q).get(n);if(a){const o={...a.data,status:s};a.update(o)}}),console.log(`[ProductsStore] Statut de synchronisation mis Ã  jour: ${e.length} produits â ${s}`)}clearSyncStatus(){const e=[];for(const[r,s]of i(this,q))s.status==="isSyncing"&&e.push(r);e.length>0&&(this.setSyncStatus(e,!1),console.log(`[ProductsStore] Nettoyage de ${e.length} produits en statut "isSyncing"`))}reset(){var e;console.log(`[ProductsStore] Reset pour eventId: ${f(i(this,Ce))}`),(e=i(this,_r))==null||e.call(this),I(this,_r,null),i(this,er)&&(i(this,er).call(this),I(this,er,null)),i(this,te)&&(i(this,te).close(),I(this,te,null)),i(this,q).clear(),i(this,Ye).clear(),g(i(this,Pe),null),g(i(this,Ce),null),g(i(this,Ar),!1),g(i(this,Jn),!1),g(i(this,Bs),null),g(i(this,es),!1),g(i(this,ts),!1),g(i(this,Ue),null),I(this,Os,""),this.dateStore.reset(),g(i(this,j),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0),console.log("[ProductsStore] Reset terminÃ©")}async createPurchaseLocal(e,r,s){const n=i(this,q).get(e);if(!n)throw new Error(`Produit ${e} introuvable`);const a={$id:crypto.randomUUID(),$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$databaseId:"localDemo",$tableId:"localDemo",$permissions:[],$sequence:0,invoiceId:s.invoiceId||null,notes:s.notes||"",store:s.store||null,mainId:f(i(this,Ce)),unit:r[0]?.u||"",quantity:r.reduce((l,u)=>l+u.q,0),price:s.price||null,status:"received",who:null,createdBy:"guest",orderDate:new Date().toISOString(),deliveryDate:null,invoiceTotal:null,products:[e]},o=Fs(n.data),c={...o,purchases:[...o.purchases||[],a],$updatedAt:new Date().toISOString()};i(this,te)&&await i(this,te).upsertProduct(c),n.update(c),console.log(`[ProductsStore] Mode local: purchase crÃ©Ã© pour ${e}`)}async createProductLocal(e){const r=crypto.randomUUID(),s={$id:r,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],productHugoUuid:null,productName:e.productName,productType:e.productType||"ingredient",pF:e.pF??!1,pS:e.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:!1,mainId:f(i(this,Ce)),totalNeededRaw:[],status:e.status||"ok",who:e.who||null,store:e.store||"",stockReel:e.stockReel||null,previousNames:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,isLocal:!0,mergedInto:null,totalNeededOverride:null,updatedBy:null,specs:null,purchases:[],pL:null,byDate:{},storeInfo:null,totalNeededOverrideParsed:null,displayMissingQuantity:null,missingQuantityArray:null},n=new hs(s,this.dateStore);return i(this,q).set(r,n),i(this,te)&&await i(this,te).upsertProduct(s),console.log(`[ProductsStore] Mode local: produit crÃ©Ã© ${r}`),r}async updateProductLocal(e,r){const s=i(this,q).get(e);if(!s)throw new Error(`Produit ${e} introuvable`);const n={...s.data,...r,$updatedAt:new Date().toISOString()};if(s.update(n),i(this,te)){const a=Fs(s.data);await i(this,te).upsertProduct(a)}console.log(`[ProductsStore] Mode local: produit mis Ã  jour ${e}`)}async addPurchaseToLocal(e,r,s){return await this.createPurchaseLocal(e,r,s)}async updatePurchaseLocal(e,r){let s=null;for(const[o,c]of i(this,q))if(c.data.purchases?.some(l=>l.$id===e)){s=o;break}if(!s)throw new Error(`Purchase ${e} introuvable`);const a=i(this,q).get(s).data.purchases.map(o=>o.$id===e?{...o,...r,$updatedAt:new Date().toISOString()}:o);await this.updateProductLocal(s,{purchases:a})}async deletePurchaseLocal(e){let r=null;for(const[a,o]of i(this,q))if(o.data.purchases?.some(c=>c.$id===e)){r=a;break}if(!r)throw new Error(`Purchase ${e} introuvable`);const n=i(this,q).get(r).data.purchases.filter(a=>a.$id!==e);await this.updateProductLocal(r,{purchases:n})}async createPurchase(e,r,s){if(v(this,$,tt).call(this))return await this.createPurchaseLocal(e,r,s);{const{createQuickValidationPurchases:n}=await ft(async()=>{const{createQuickValidationPurchases:a}=await Promise.resolve().then(()=>qr);return{createQuickValidationPurchases:a}},void 0);await n(f(i(this,Pe)),e,r,s)}}async updatePurchase(e,r){if(v(this,$,tt).call(this))return await this.updatePurchaseLocal(e,r);{const{updatePurchase:s}=await ft(async()=>{const{updatePurchase:n}=await Promise.resolve().then(()=>qr);return{updatePurchase:n}},void 0);await s(e,r)}}async deletePurchase(e){if(v(this,$,tt).call(this))return await this.deletePurchaseLocal(e);{const{deletePurchase:r}=await ft(async()=>{const{deletePurchase:s}=await Promise.resolve().then(()=>qr);return{deletePurchase:s}},void 0);await r(e)}}async createProduct(e){if(v(this,$,tt).call(this))return await this.createProductLocal(e);{const{upsertProduct:r}=await ft(async()=>{const{upsertProduct:n}=await Promise.resolve().then(()=>qr);return{upsertProduct:n}},void 0);return(await r(crypto.randomUUID(),e,n=>this.getEnrichedProductById(n))).$id}}async updateProduct(e,r){if(v(this,$,tt).call(this))return await this.updateProductLocal(e,r);{const{updateProduct:s}=await ft(async()=>{const{updateProduct:n}=await Promise.resolve().then(()=>qr);return{updateProduct:n}},void 0);await s(e,r)}}async updateProductBatch(e,r,s){if(v(this,$,tt).call(this))for(const[n,a]of Object.entries(r))await this.updateProductLocal(e,{[n]:a});else{const{updateProductBatch:n}=await ft(async()=>{const{updateProductBatch:a}=await Promise.resolve().then(()=>qr);return{updateProductBatch:a}},void 0);await n(e,r,s||(a=>this.getEnrichedProductById(a)))}}async batchUpdateProducts(e,r,s,n){if(v(this,$,tt).call(this))return await v(this,$,Yu).call(this,e,s,n);{const{batchUpdateProductsOptimized:a}=await ft(async()=>{const{batchUpdateProductsOptimized:o}=await Promise.resolve().then(()=>qr);return{batchUpdateProductsOptimized:o}},void 0);return await a(e,r,s,n)}}async createGroupPurchase(e,r){if(v(this,$,tt).call(this))return await v(this,$,Xu).call(this,e,r);{const{createGroupPurchaseWithSync:s}=await ft(async()=>{const{createGroupPurchaseWithSync:n}=await Promise.resolve().then(()=>Ig);return{createGroupPurchaseWithSync:n}},void 0);return await s(f(i(this,Pe)),e,r)}}destroy(){var e;(e=i(this,_r))==null||e.call(this),I(this,_r,null),i(this,te)&&(i(this,te).close(),I(this,te,null)),console.log("[ProductsStore] Ressources nettoyÃ©es")}get completionStats(){return f(i(this,ra))}set completionStats(e){g(i(this,ra),e)}get financialStats(){return f(i(this,sa))}set financialStats(e){g(i(this,sa),e)}}q=new WeakMap,Ye=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Ar=new WeakMap,Jn=new WeakMap,Bs=new WeakMap,es=new WeakMap,ts=new WeakMap,Ue=new WeakMap,te=new WeakMap,_r=new WeakMap,Kn=new WeakMap,$=new WeakSet,tt=function(){return f(i(this,Ce))?ke.getEventById(f(i(this,Ce)))?.status==="local":!1},j=new WeakMap,Yn=new WeakMap,Xn=new WeakMap,Zn=new WeakMap,zn=new WeakMap,Fn=new WeakMap,di=new WeakMap,ea=new WeakMap,ta=new WeakMap,fi=new WeakMap,Uu=async function(e){if(!f(i(this,Ar))){console.warn("[ProductsStore] Sync ignorÃ© car store non initialisÃ©");return}const r=JSON.stringify(e.meals);if(i(this,Os)===r)return;console.log(`[ProductsStore] â¡ï¸ CHANGEMENT REPAS DÃTECTÃ pour ${e.$id} (Hash: ${r.substring(0,10)}...), recalcul...`),I(this,Os,r);const n=await Cc(e,async o=>await Xa.getRecipeByUuid(o),e.$id);n.forEach(o=>{const c=i(this,q).get(o.$id);if(c){const u={...c.data,byDate:o.byDate,totalNeededArray:o.totalNeededArray,totalNeededRaw:o.totalNeededRaw,nbRecipes:o.nbRecipes,totalAssiettes:o.totalAssiettes};Qp(u),c.update(u)}else i(this,q).set(o.$id,new hs(o,this.dateStore))});const a=new Set(n.map(o=>o.$id));for(const[o,c]of i(this,q))a.has(o)||!c.data.isSynced&&!c.data.purchases?.length&&i(this,q).delete(o);this.dateStore.setAvailableDates([...e.allDates||[]]),v(this,$,ja).call(this)},Os=new WeakMap,er=new WeakMap,Bu=async function(e){const s=await Cc(e,async n=>await Xa.getRecipeByUuid(n),e.$id);s.forEach(n=>{i(this,q).set(n.$id,new hs(n,this.dateStore))}),console.log(`[ProductsStore] ${s.length} produits calculÃ©s depuis ${e.meals.length} repas`)},Ou=async function(){if(i(this,te))try{const e=await i(this,te).loadProducts();e.forEach((s,n)=>{s.status==="isSyncing"&&(s.status="active"),i(this,q).set(n,new hs(s,this.dateStore))});const r=await i(this,te).loadMetadata();g(i(this,Ue),r.lastSync,!0),this.dateStore.setAvailableDates([...r.allDates]),console.log(`[ProductsStore] ${e.size} produits chargÃ©s du cache IDB, lastSync: ${r.lastSync}`)}catch(e){console.warn("[ProductsStore] Erreur lecture cache IDB, ignorÃ©:",e)}},ja=async function(){if(i(this,te))try{const e=new Map;i(this,q).forEach((r,s)=>{const n=Fs(r.data);n.status==="isSyncing"&&(n.status="active"),e.set(s,n)}),await i(this,te).saveProducts(e),await i(this,te).saveMetadata({lastSync:f(i(this,Ue)),allDates:[...this.dateStore.dates]}),console.log("[ProductsStore] Cache IDB persistÃ©")}catch(e){console.error("[ProductsStore] Erreur persist cache IDB:",e)}},qa=async function(e){if(!(!i(this,te)||e.length===0))try{const r=e.map(s=>i(this,q).get(s)?.data).filter(s=>s!=null).map(s=>{const n=Fs(s);return n.status==="isSyncing"&&(n.status="active"),i(this,te).upsertProduct(n)});r.length>0&&(await Promise.all(r),console.log(`[ProductsStore] ${r.length} produits affectÃ©s persistÃ©s`))}catch(r){console.error("[ProductsStore] Erreur persistence produits affectÃ©s:",r)}},xu=function(){g(i(this,Ue),new Date().toISOString(),!0)},Xi=function(e,r){return r?Pa(e,r):Vp(e)},hg=function(e){e.length&&(e.forEach(r=>v(this,$,Ua).call(this,r)),console.log(`[ProductsStore] ${e.length} produits upserted`))},Ua=function(e){const r=i(this,q).get(e.$id),s=v(this,$,Xi).call(this,e,r?.data);r?r.update(s):(this.dateStore.dates,i(this,q).set(e.$id,new hs(s,this.dateStore)))},Hu=function(e){i(this,q).delete(e)},Wu=async function(e){if(!e.products?.length)return console.warn("[ProductsStore] Purchase crÃ©Ã© sans products:",e.$id),[];const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return v(this,$,Qu).call(this,r,e),r},Gu=async function(e){if(e.products?.length){const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return v(this,$,Ba).call(this,r,e),r}console.log("[ProductsStore] Purchase update sans products[], rechargement...");try{const[r]=await ju([e.$id]);if(r?.products?.length){const s=r.products.map(n=>typeof n=="string"?n:n.$id).filter(Boolean);return v(this,$,Ba).call(this,s,r),s}return[]}catch(r){return console.error("[ProductsStore] Erreur rechargement purchase:",r),[]}},Vu=async function(e){const r=Array.from(i(this,q).values()).map(s=>s.data).filter(s=>s.purchases?.some(n=>n.$id===e));return r.forEach(s=>{v(this,$,Ua).call(this,s)}),r.map(s=>s.$id)},Qu=function(e,r){const s=tc(r),n=[];e.forEach(a=>{const o=i(this,q).get(a);if(o){const c=o.data,l=c.purchases||[];if(!l.some(u=>u.$id===s.$id)){const u=Pa({...c,purchases:[...l,s],status:"active"},c);n.push(u)}}}),n.forEach(a=>{const o=i(this,q).get(a.$id);o&&o.update(a)})},Ba=function(e,r){const s=tc(r),n=[];e.forEach(a=>{const o=i(this,q).get(a);if(o){const c=o.data,l=c.purchases||[],u=l.findIndex(d=>d.$id===s.$id);if(u>=0){const d=[...l];d[u]=s;const h=Pa({...c,purchases:d,status:"active"},c);n.push(h)}else{const d=Pa({...c,purchases:[...l,r],status:"active"},c);n.push(d)}}}),n.forEach(a=>{const o=i(this,q).get(a.$id);o&&o.update(a)})},Zi=function(e){if(v(this,$,Ua).call(this,e),i(this,te)){const r=i(this,q).get(e.$id);r&&i(this,te).upsertProduct(Fs(r.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},Ju=function(){return{onProductCreate:e=>v(this,$,Zi).call(this,e),onProductUpdate:e=>v(this,$,Zi).call(this,e),onProductDelete:e=>{v(this,$,Hu).call(this,e),i(this,te)&&i(this,te).deleteProduct(e).catch(r=>console.error("[ProductsStore] Erreur suppression produit:",r))},onPurchaseCreate:async e=>{if(e.status==="expense"){i(this,Ye).set(e.$id,e);return}const r=await v(this,$,Wu).call(this,e);await v(this,$,qa).call(this,r)},onPurchaseUpdate:async e=>{if(e.status==="expense"){i(this,Ye).set(e.$id,e);return}i(this,Ye).has(e.$id)&&i(this,Ye).delete(e.$id);const r=await v(this,$,Gu).call(this,e);await v(this,$,qa).call(this,r)},onPurchaseDelete:async e=>{if(i(this,Ye).has(e)){i(this,Ye).delete(e);return}const r=await v(this,$,Vu).call(this,e);await v(this,$,qa).call(this,r)},onConnect:()=>{g(i(this,ts),!0)},onDisconnect:()=>{g(i(this,ts),!1)},onError:e=>{console.error("[ProductsStore] Erreur realtime:",e)}}},Ku=function(){if(v(this,$,tt).call(this)){console.log("[ProductsStore] Mode local: skip realtime setup");return}const e=v(this,$,Ju).call(this);I(this,_r,dg(e))},Yu=async function(e,r,s){try{let n=0;for(const a of e){if(r==="who"){const o=s.names||[];await this.updateProductLocal(a,{who:o})}else if(r==="store"){const o=s;await this.updateProductLocal(a,{storeInfo:o})}n++}return{success:!0,updatedCount:n,updateType:r,timestamp:new Date().toISOString()}}catch(n){return{success:!1,updatedCount:0,updateType:r,error:n instanceof Error?n.message:"Erreur inconnue",timestamp:new Date().toISOString()}}},Xu=async function(e,r){try{if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};let s=0;for(const n of e)await this.createPurchaseLocal(n.productId,n.missingQuantities,{invoiceId:r.invoiceId,notes:r.notes,store:r.store}),s++;return{success:!0,results:[],totalProductsCreated:e.length,totalPurchasesCreated:s,totalExpensesCreated:0}}catch(s){return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:s instanceof Error?s.message:"Erreur inconnue"}}},Zu=async function(){if(v(this,$,tt).call(this)){console.log("[ProductsStore] Mode local: skip loadOrphanPurchases");return}if(f(i(this,Pe)))try{const e=await qu(f(i(this,Pe)));e.forEach(r=>{i(this,Ye).set(r.$id,r)}),console.log(`[ProductsStore] ${e.length} dÃ©penses globales chargÃ©es`)}catch(e){console.error("[ProductsStore] Erreur chargement dÃ©penses globales:",e)}},ra=new WeakMap,sa=new WeakMap;const zu=new fg,{APPWRITE_CONFIG:Ii}=ls();async function pg(t,e){return Ht(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:Ii.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,teamId:e}),async:!1}),n=pa(s.responseBody,{context:"removeTeamFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de la team");console.log(`[appwrite-functions] Team ${e} retirÃ©e de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeTeamFromEvent",timeout:6e4,errorMessage:"Erreur lors du retrait de la team"})}async function gg(t){return Ht(async()=>{const{functions:e}=await D(),r=await e.createExecution({functionId:Ii.functions.usersTeamsManager,body:JSON.stringify({action:"checkEmails",emails:t}),async:!1}),s=pa(r.responseBody,{context:"checkUserEmails",fallback:null});if(!s||!s.success)throw new Error(s?.error||"Erreur lors de la vÃ©rification des emails");return s.data},{context:"AppwriteFunctions.checkUserEmails",timeout:15e3,errorMessage:"Erreur lors de la vÃ©rification des emails"})}async function mg(t,e,r){const{teamIds:s=[],emails:n=[],userIds:a=[],message:o,sendEmailToExistingMembers:c=!0}=r;return Ht(async()=>{const{functions:l}=await D(),u=await l.createExecution({functionId:Ii.functions.usersTeamsManager,body:JSON.stringify({action:"invite",context:{type:"event",id:t,name:e},teamIds:s,emails:n,userIds:a,message:o,sendEmailToExistingMembers:c}),async:!1}),d=pa(u.responseBody,{context:"inviteParticipantsToEvent",fallback:null});if(!d||!d.success)throw new Error(d?.error||"Erreur lors de l'invitation");return console.log(`[appwrite-functions] ${d.processed} invitations traitÃ©es pour ${e}`),d},{context:"AppwriteFunctions.inviteParticipantsToEvent",timeout:6e4,errorMessage:"Erreur lors de l'invitation"})}async function yg(t,e){return Ht(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:Ii.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,userId:e}),async:!1}),n=pa(s.responseBody,{context:"removeUserFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de l'utilisateur");console.log(`[appwrite-functions] Utilisateur ${e} retirÃ© de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeUserFromEvent",timeout:1e4,errorMessage:"Erreur lors du retrait de l'utilisateur"})}const Ti=Object.freeze(Object.defineProperty({__proto__:null,checkUserEmails:gg,inviteParticipantsToEvent:mg,removeTeamFromEvent:pg,removeUserFromEvent:yg},Symbol.toStringTag,{value:"Module"}));function wg(t,e){const r=t.reduce((n,a)=>n+a.missingQuantities.length,0),s=e.invoiceTotal?1:0;return r+s}async function vg(t,e,r){let s=null;try{const{account:c}=await D();s=(await c.get()).$id}catch(c){console.warn("[Appwrite Transaction] Impossible de rÃ©cupÃ©rer l'utilisateur connectÃ©:",c)}const n=e.purchaseStatus||"delivered";let a=e.purchaseDeliveryDate||null;n==="delivered"&&!a&&(a=new Date().toISOString());const o=t.flatMap(c=>c.missingQuantities.map(l=>({productId:c.productId,quantity:l.q,unit:l.u,status:n,notes:e.notes||"",store:e.store||"",who:e.who||void 0,price:void 0,orderDate:null,deliveryDate:a,createdBy:s})));return{mainId:r,purchasesData:o,invoiceData:e,fromUserId:s||""}}function bg(t,e,r=98){const s=[];let n=[],a=0;const o=!!e.invoiceTotal;let c=!1;for(const l of t){const u=l.missingQuantities.length;let d=a+u>r;o&&!c&&n.length>0&&(d=a+u+1>r),d&&n.length>0?(s.push(n),n=[l],a=u,c=!1):(n.push(l),a+=u)}return n.length>0&&s.push(n),s}async function Eg(t){try{const e=ls(),{functions:r}=await D(),s={operation:"createGroupPurchaseWithSync",data:t};console.log(`[Appwrite Interactions] ExÃ©cution du lot: ${t.purchasesData.length} achats Ã  crÃ©er`);const n=await r.createExecution(e.APPWRITE_CONFIG.functions.batchUpdate,JSON.stringify(s),!1,"/","POST");if(n.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${n.status}.`);const a=JSON.parse(n.responseBody);return a.success?console.log(`[Appwrite Interactions] Lot exÃ©cutÃ© avec succÃ¨s: ${a.purchasesCreated} achats crÃ©Ã©s`):console.error("[Appwrite Interactions] Lot Ã©chouÃ©:",a.error),a}catch(e){console.error("[Appwrite Interactions] Erreur exÃ©cution lot:",e);const r=e instanceof Error?e.message:"Erreur inconnue";return{success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:t.invoiceData.invoiceId,error:r,timestamp:new Date().toISOString()}}}async function Sg(t,e,r){if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};const s=wg(e,r);console.log(`[Appwrite Interactions] Achat groupÃ©: ${e.length} produits, ${s} achats Ã  crÃ©er`);const n=bg(e,r,98);console.log(`[Appwrite Interactions] DÃ©coupage en ${n.length} lot(s) pour respecter la limite de 100 achats par lot`);const a=[];let o=0,c=0,l=0;for(let h=0;h<n.length;h++){const p=n[h];console.log(`[Appwrite Interactions] ExÃ©cution du lot ${h+1}/${n.length} (${p.length} produits)`);try{const m=await vg(p,r,t),b=await Mu(()=>Eg(m),{operationName:`Lot ${h+1}/${n.length}`,maxAutoRetries:1,autoRetryDelay:2e3});if(!b)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives");if(a.push(b),b.success)o+=b.productsCreated,c+=b.purchasesCreated,l+=b.expenseCreated?1:0;else{console.error(`[Appwrite Interactions] Erreur sur le lot ${h+1}: ${b.error}`);break}}catch(m){const b=m instanceof Error?m.message:"Erreur inconnue";console.error(`[Appwrite Interactions] Erreur lors de l'exÃ©cution du lot ${h+1}:`,m),a.push({success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:r.invoiceId,error:b,timestamp:new Date().toISOString()});break}}const u=a.every(h=>h.success),d=a.some(h=>!h.success);return{success:u,results:a,totalProductsCreated:o,totalPurchasesCreated:c,totalExpensesCreated:l,error:d?"Un ou plusieurs lots ont Ã©chouÃ©":void 0}}const Ig=Object.freeze(Object.defineProperty({__proto__:null,createGroupPurchaseWithSync:Sg},Symbol.toStringTag,{value:"Module"}));var Ag=(t=>(t.ENTREE="entree",t.PLAT="plat",t.DESSERT="dessert",t.AUTRE="autre",t))(Ag||{}),_g=(t=>(t.PUBLIC="public",t.PRIVATE="private",t.DELETED="deleted",t))(_g||{});const Rg=ls().APPWRITE_CONFIG;async function Um(t,e,r){try{const{functions:s}=await D(),n=await s.createExecution({functionId:Rg.functions.usersTeamsManager,body:JSON.stringify({action:"exchange-invite",userId:t,eventId:e,teamId:r})}),a=JSON.parse(n.responseBody);if(!a.success)throw new Error(a.error||"L'invitation est invalide.");return{token:a.token,userId:a.userId}}catch(s){throw console.error("[invitations] Error validating invitation:",s),s}}const Pg=7,Bm={async getLock(t){const{tables:e}=await D();try{const r=await e.getRow({databaseId:at(),tableId:fr("locks"),rowId:t});return!r.userId||new Date(r.expiresAt)<new Date?null:r}catch(r){if(r.code===404)return null;throw r}},async acquireLock(t,e,r){const{tables:s}=await D(),n=new Date(Date.now()+Pg*60*1e3).toISOString(),a={userId:e,userName:r,expiresAt:n},o=[ee.read(se.any()),ee.update(se.user(e))];try{return await s.updateRow({databaseId:at(),tableId:fr("locks"),rowId:t,data:a,permissions:o}),!0}catch(c){if(c.code===404)try{return await s.createRow({databaseId:at(),tableId:fr("locks"),rowId:t,data:a,permissions:o}),!0}catch(l){return console.error("[locksService] Erreur crÃ©ation verrou:",l),!1}return console.warn("[locksService] Acquisition refusÃ©e (peut-Ãªtre dÃ©jÃ  verrouillÃ©):",c.message),!1}},async releaseLock(t,e){const{tables:r}=await D();try{await r.updateRow({databaseId:at(),tableId:fr("locks"),rowId:t,data:{userId:"",userName:"",expiresAt:new Date(0).toISOString()},permissions:[ee.read(se.any()),ee.update(se.any())]}),console.log(`[locksService] Verrou libÃ©rÃ© (rÃ©initialisÃ©) pour ${t}`)}catch(s){if(s.code===404){console.log(`[locksService] Verrou dÃ©jÃ  libÃ©rÃ© pour ${t}`);return}console.warn("[locksService] Impossible de libÃ©rer le verrou sur le serveur:",s.message)}},subscribeToLock(t,e){const r=at(),s=fr("locks"),n=`databases.${r}.collections.${s}.documents.${t}`;return console.log("[locksService] Enregistrement du channel de lock:",n),Bt.registerDynamic([n],a=>{if(a.events?.some(c=>c.endsWith(".delete"))){e(null);return}if(!a.payload)return;const o=a.payload;!o.userId||new Date(o.expiresAt)<new Date?e(null):e(o)})}};export{mm as $,g as A,Rf as B,Hf as C,ws as D,Cm as E,ht as F,L as G,as as H,Jg as I,Xa as J,Od as K,Ya as L,xe as M,jh as N,tm as O,dm as P,Bg as Q,cm as R,Hg as S,D as T,Gf as U,kg as V,ke as W,Wf as X,fm as Y,Zf as Z,ft as _,im as a,Dm as a$,gf as a0,qp as a1,Dc as a2,Mc as a3,Bt as a4,Nm as a5,Fg as a6,zu as a7,Qg as a8,Sm as a9,Bm as aA,Fs as aB,_m as aC,Rm as aD,qf as aE,wm as aF,Zg as aG,zp as aH,vm as aI,lh as aJ,xr as aK,uh as aL,Vl as aM,bm as aN,it as aO,gh as aP,Jl as aQ,Tm as aR,mh as aS,ym as aT,eg as aU,ng as aV,no as aW,Mg as aX,Mm as aY,Pm as aZ,go as a_,Bf as aa,Ng as ab,Lh as ac,Im as ad,Em as ae,jm as af,Lm as ag,Hp as ah,lm as ai,Ag as aj,am as ak,sm as al,um as am,nm as an,Th as ao,ho as ap,qg as aq,_g as ar,zo as as,qm as at,ct as au,km as av,Um as aw,Kg as ax,lr as ay,em as az,Gg as b,$m as b0,Ug as b1,om as b2,Am as b3,Ti as b4,Gd as c,Wd as d,Xg as e,xg as f,Tg as g,jg as h,Yg as i,Wg as j,Lg as k,rm as l,f as m,zs as n,Bd as o,gm as p,pm as q,hm as r,zg as s,$g as t,Z as u,Og as v,df as w,Vg as x,P as y,ge as z};
