const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage.js","assets/index.js","assets/icons.js","assets/index.css","assets/index2.js","assets/legacy.js","assets/EmailVerificationAlert.js","assets/HomePage.css","assets/VerifyEmailPage.js","assets/RecipesListPage.js","assets/Fieldset.js","assets/AutocompleteInput.js","assets/keyboardNavigation.svelte.js","assets/BadgeList.js","assets/CheckboxBadge.js","assets/RecipeRegimeBadges.js","assets/LeftPanel.js","assets/RecipeDataStore.svelte.js","assets/RecipeDetailPage.js","assets/RecipePreparation.js","assets/products-display.js","assets/SvelteMarkdown.js","assets/SvelteMarkdown.css","assets/RecipeMetadata.js","assets/AcceptInvite.js","assets/ResetPassword.js","assets/ResetPassword.css","assets/DashboardPage.js","assets/date-helpers.js","assets/CreateTeamModal.js","assets/ConfirmModal.js","assets/InfoCollapse.js","assets/EventCard.js","assets/event-stats-helpers.js","assets/DocCard.js","assets/TeamsManagement.js","assets/EventCreatePage.js","assets/EventMealCard.js","assets/MaterielPage.js","assets/LoansPage.js","assets/BtnGroupCheck.js","assets/LoanReturnPage.js","assets/EventEditPage.js","assets/EventInvitationAlert.js","assets/EventStats.js","assets/UnsavedChangesGuard.js","assets/EventRecipesPage.js","assets/EventRecipesPage.css","assets/EventProductsPage.js","assets/EventProductsPage.css","assets/EventPosterPage.js","assets/EventPosterPage.css","assets/RecipeCreatePage.js","assets/RecipeEditPage2.js","assets/tiptap-markdown.es.js","assets/RecipeEditPage.css","assets/RecipeEditPage.js","assets/EventListPage.js","assets/CreateDocumentPage.js","assets/MarkdownEditorAdvanced.js","assets/MarkdownEditorAdvanced.css","assets/CreateDocumentPage.css","assets/EditDocumentPage.js","assets/EditDocumentPage.css","assets/DocumentListPage.js","assets/NotFoundPage.js"])))=>i.map(i=>d[i]);
var Ud=Object.defineProperty;var Bd=Object.getPrototypeOf;var xd=Reflect.get;var tc=t=>{throw TypeError(t)};var Hd=(t,e,r)=>e in t?Ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var N=(t,e,r)=>Hd(t,typeof e!="symbol"?e+"":e,r),qi=(t,e,r)=>e.has(t)||tc("Cannot "+r);var i=(t,e,r)=>(qi(t,e,"read from private field"),r?r.call(t):e.get(t)),y=(t,e,r)=>e.has(t)?tc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),_=(t,e,r,s)=>(qi(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),v=(t,e,r)=>(qi(t,e,"access private method"),r);var rc=(t,e,r)=>xd(Bd(t),r,e);var Ri=Array.isArray,Vd=Array.prototype.indexOf,Pi=Array.from,Wd=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,hl=Object.getOwnPropertyDescriptors,pl=Object.prototype,Gd=Array.prototype,Di=Object.getPrototypeOf,sc=Object.isExtensible;function Ss(t){return typeof t=="function"}const cn=()=>{};function Qd(t){return t()}function Yi(t){for(var e=0;e<t.length;e++)t[e]()}function ml(){var t,e,r=new Promise((s,n)=>{t=s,e=n});return{promise:r,resolve:t,reject:e}}function xg(t,e,r=!1){return t===void 0?r?e():e:t}function Hg(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const r=[];for(const s of t)if(r.push(s),r.length===e)break;return r}const De=2,Za=4,ha=8,yo=1<<24,Wt=16,hr=32,Hr=64,wo=128,ft=512,Le=1024,Xe=2048,pr=4096,nt=8192,lr=16384,pa=32768,Bt=65536,nc=1<<17,gl=1<<18,ps=1<<19,yl=1<<20,cr=1<<25,fs=32768,Xi=1<<21,vo=1<<22,Lr=1<<23,Ut=Symbol("$state"),wl=Symbol("legacy props"),Jd=Symbol(""),Rs=new class extends Error{constructor(){super(...arguments);N(this,"name","StaleReactionError");N(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}},Kd=1,Mi=3,en=8;function vl(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Yd(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Xd(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Zd(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function zd(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Fd(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ef(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function tf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function rf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function sf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function nf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const af=1,of=2,bl=4,cf=8,lf=16,uf=1,df=2,ff=4,hf=8,pf=16,mf=1,gf=2,yf=4,wf=1,vf=2,bf="[",$i="[!",bo="]",ma={},Ie=Symbol(),Ef="http://www.w3.org/1999/xhtml",Sf="http://www.w3.org/2000/svg",If="@attach";function ga(t){console.warn("https://svelte.dev/e/hydration_mismatch")}function Af(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function _f(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let T=!1;function It(t){T=t}let X;function _e(t){if(t===null)throw ga(),ma;return X=t}function xt(){return _e(Gt(X))}function Rf(t){if(T){if(Gt(X)!==null)throw ga(),ma;X=t}}function Pf(t=1){if(T){for(var e=t,r=X;e--;)r=Gt(r);X=r}}function za(t=!0){for(var e=0,r=X;;){if(r.nodeType===en){var s=r.data;if(s===bo){if(e===0)return r;e-=1}else(s===bf||s===$i)&&(e+=1)}var n=Gt(r);t&&r.remove(),r=n}}function El(t){if(!t||t.nodeType!==en)throw ga(),ma;return t.data}function Sl(t){return t===this.v}function Df(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Il(t){return!Df(t,this.v)}let tn=!1;function Wg(){tn=!0}const Mf=[];function Is(t,e=!1,r=!1){return Oa(t,new Map,"",Mf,null,r)}function Oa(t,e,r,s,n=null,a=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(Ri(t)){var c=Array(t.length);e.set(t,c),n!==null&&e.set(n,c);for(var l=0;l<t.length;l+=1){var u=t[l];l in t&&(c[l]=Oa(u,e,r,s,null,a))}return c}if(Di(t)===pl){c={},e.set(t,c),n!==null&&e.set(n,c);for(var d in t)c[d]=Oa(t[d],e,r,s,null,a);return c}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!a)return Oa(t.toJSON(),e,r,s,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let me=null;function Ys(t){me=t}function Eo(t,e=!1,r){me={p:me,i:!1,c:null,e:null,s:t,x:null,l:tn&&!e?{s:null,u:null,$:[]}:null}}function So(t){var e=me,r=e.e;if(r!==null){e.e=null;for(var s of r)Kl(s)}return t!==void 0&&(e.x=t),e.i=!0,me=e.p,t??{}}function rn(){return!tn||me!==null&&me.l===null}let Qr=[];function Al(){var t=Qr;Qr=[],Yi(t)}function _t(t){if(Qr.length===0&&!wn){var e=Qr;queueMicrotask(()=>{e===Qr&&Al()})}Qr.push(t)}function $f(){for(;Qr.length>0;)Al()}function _l(t){var e=Z;if(e===null)return Y.f|=Lr,t;if((e.f&pa)===0){if((e.f&wo)===0)throw t;e.b.error(t)}else Xs(t,e)}function Xs(t,e){for(;e!==null;){if((e.f&wo)!==0)try{e.b.error(t);return}catch(r){t=r}e=e.parent}throw t}const kf=-7169;function Pe(t,e){t.f=t.f&kf|e}function Io(t){(t.f&ft)!==0||t.deps===null?Pe(t,Le):Pe(t,pr)}function Rl(t){if(t!==null)for(const e of t)(e.f&De)===0||(e.f&fs)===0||(e.f^=fs,Rl(e.deps))}function Pl(t,e,r){(t.f&Xe)!==0?e.add(t):(t.f&pr)!==0&&r.add(t),Rl(t.deps),Pe(t,Le)}const Ma=new Set;let ee=null,yn=null,bt=null,lt=[],ki=null,Zi=!1,wn=!1;var Ps,Ds,Yr,Xr,An,Ms,$s,mt,zi,Fi,Dl,Ml;const ui=class ui{constructor(){y(this,mt);N(this,"committed",!1);N(this,"current",new Map);N(this,"previous",new Map);y(this,Ps,new Set);y(this,Ds,new Set);y(this,Yr,0);y(this,Xr,0);y(this,An,null);y(this,Ms,new Set);y(this,$s,new Set);N(this,"skipped_effects",new Set);N(this,"is_fork",!1)}is_deferred(){return this.is_fork||i(this,Xr)>0}process(e){lt=[],yn=null,this.apply();var r=[],s=[];for(const n of e)v(this,mt,zi).call(this,n,r,s);this.is_fork||v(this,mt,Dl).call(this),this.is_deferred()?(v(this,mt,Fi).call(this,s),v(this,mt,Fi).call(this,r)):(yn=this,ee=null,ac(s),ac(r),yn=null,i(this,An)?.resolve()),bt=null}capture(e,r){r!==Ie&&!this.previous.has(e)&&this.previous.set(e,r),(e.f&Lr)===0&&(this.current.set(e,e.v),bt?.set(e,e.v))}activate(){ee=this,this.apply()}deactivate(){ee===this&&(ee=null,bt=null)}flush(){if(this.activate(),lt.length>0){if($l(),ee!==null&&ee!==this)return}else i(this,Yr)===0&&this.process([]);this.deactivate()}discard(){for(const e of i(this,Ds))e(this);i(this,Ds).clear()}increment(e){_(this,Yr,i(this,Yr)+1),e&&_(this,Xr,i(this,Xr)+1)}decrement(e){_(this,Yr,i(this,Yr)-1),e&&_(this,Xr,i(this,Xr)-1),this.revive()}revive(){for(const e of i(this,Ms))i(this,$s).delete(e),Pe(e,Xe),dr(e);for(const e of i(this,$s))Pe(e,pr),dr(e);this.flush()}oncommit(e){i(this,Ps).add(e)}ondiscard(e){i(this,Ds).add(e)}settled(){return(i(this,An)??_(this,An,ml())).promise}static ensure(){if(ee===null){const e=ee=new ui;Ma.add(ee),wn||ui.enqueue(()=>{ee===e&&e.flush()})}return ee}static enqueue(e){_t(e)}apply(){}};Ps=new WeakMap,Ds=new WeakMap,Yr=new WeakMap,Xr=new WeakMap,An=new WeakMap,Ms=new WeakMap,$s=new WeakMap,mt=new WeakSet,zi=function(e,r,s){e.f^=Le;for(var n=e.first,a=null;n!==null;){var o=n.f,c=(o&(hr|Hr))!==0,l=c&&(o&Le)!==0,u=l||(o&nt)!==0||this.skipped_effects.has(n);if(!u&&n.fn!==null){c?n.f^=Le:a!==null&&(o&(Za|ha|yo))!==0?a.b.defer_effect(n):(o&Za)!==0?r.push(n):Ea(n)&&((o&Wt)!==0&&i(this,Ms).add(n),En(n));var d=n.first;if(d!==null){n=d;continue}}var h=n.parent;for(n=n.next;n===null&&h!==null;)h===a&&(a=null),n=h.next,h=h.parent}},Fi=function(e){for(var r=0;r<e.length;r+=1)Pl(e[r],i(this,Ms),i(this,$s))},Dl=function(){if(i(this,Xr)===0){for(const e of i(this,Ps))e();i(this,Ps).clear()}i(this,Yr)===0&&v(this,mt,Ml).call(this)},Ml=function(){var n;if(Ma.size>1){this.previous.clear();var e=bt,r=!0;for(const a of Ma){if(a===this){r=!1;continue}const o=[];for(const[l,u]of this.current){if(a.current.has(l))if(r&&u!==a.current.get(l))a.current.set(l,u);else continue;o.push(l)}if(o.length===0)continue;const c=[...a.current.keys()].filter(l=>!this.current.has(l));if(c.length>0){var s=lt;lt=[];const l=new Set,u=new Map;for(const d of o)kl(d,c,l,u);if(lt.length>0){ee=a,a.apply();for(const d of lt)v(n=a,mt,zi).call(n,d,[],[]);a.deactivate()}lt=s}}ee=null,bt=e}this.committed=!0,Ma.delete(this)};let Ot=ui;function Cf(t){var e=wn;wn=!0;try{for(var r;;){if($f(),lt.length===0&&(ee?.flush(),lt.length===0))return ki=null,r;$l()}}finally{wn=e}}function $l(){var t=ds;Zi=!0;var e=null;try{var r=0;for(ei(!0);lt.length>0;){var s=Ot.ensure();if(r++>1e3){var n,a;Tf()}s.process(lt),jr.clear()}}finally{Zi=!1,ei(t),ki=null}}function Tf(){try{Fd()}catch(t){Xs(t,ki)}}let Yt=null;function ac(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var s=t[r++];if((s.f&(lr|nt))===0&&Ea(s)&&(Yt=new Set,En(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?eu(s):s.fn=null),Yt?.size>0)){jr.clear();for(const n of Yt){if((n.f&(lr|nt))!==0)continue;const a=[n];let o=n.parent;for(;o!==null;)Yt.has(o)&&(Yt.delete(o),a.push(o)),o=o.parent;for(let c=a.length-1;c>=0;c--){const l=a[c];(l.f&(lr|nt))===0&&En(l)}}Yt.clear()}}Yt=null}}function kl(t,e,r,s){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const n of t.reactions){const a=n.f;(a&De)!==0?kl(n,e,r,s):(a&(vo|Wt))!==0&&(a&Xe)===0&&Cl(n,e,s)&&(Pe(n,Xe),dr(n))}}function Cl(t,e,r){const s=r.get(t);if(s!==void 0)return s;if(t.deps!==null)for(const n of t.deps){if(e.includes(n))return!0;if((n.f&De)!==0&&Cl(n,e,r))return r.set(n,!0),!0}return r.set(t,!1),!1}function dr(t){for(var e=ki=t;e.parent!==null;){e=e.parent;var r=e.f;if(Zi&&e===Z&&(r&Wt)!==0&&(r&gl)===0)return;if((r&(Hr|hr))!==0){if((r&Le)===0)return;e.f^=Le}}lt.push(e)}function Ao(t){let e=0,r=fr(0),s;return()=>{Po()&&(f(r),ba(()=>(e===0&&(s=mr(()=>t(()=>Ae(r)))),e+=1,()=>{_t(()=>{e-=1,e===0&&(s?.(),s=void 0,Ae(r))})})))}}var Nf=Bt|ps|wo;function Lf(t,e,r){new jf(t,e,r)}var ze,_n,Pt,Zr,Dt,ct,Be,Mt,Zt,vr,zr,zt,Fr,ks,Cs,br,di,we,Tl,Nl,eo,Ua,Ba,to;class jf{constructor(e,r,s){y(this,we);N(this,"parent");N(this,"is_pending",!1);y(this,ze);y(this,_n,T?X:null);y(this,Pt);y(this,Zr);y(this,Dt);y(this,ct,null);y(this,Be,null);y(this,Mt,null);y(this,Zt,null);y(this,vr,null);y(this,zr,0);y(this,zt,0);y(this,Fr,!1);y(this,ks,new Set);y(this,Cs,new Set);y(this,br,null);y(this,di,Ao(()=>(_(this,br,fr(i(this,zr))),()=>{_(this,br,null)})));_(this,ze,e),_(this,Pt,r),_(this,Zr,s),this.parent=Z.b,this.is_pending=!!i(this,Pt).pending,_(this,Dt,ms(()=>{if(Z.b=this,T){const a=i(this,_n);xt(),a.nodeType===en&&a.data===$i?v(this,we,Nl).call(this):(v(this,we,Tl).call(this),i(this,zt)===0&&(this.is_pending=!1))}else{var n=v(this,we,eo).call(this);try{_(this,ct,Qe(()=>s(n)))}catch(a){this.error(a)}i(this,zt)>0?v(this,we,Ba).call(this):this.is_pending=!1}return()=>{i(this,vr)?.remove()}},Nf)),T&&_(this,ze,X)}defer_effect(e){Pl(e,i(this,ks),i(this,Cs))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!i(this,Pt).pending}update_pending_count(e){v(this,we,to).call(this,e),_(this,zr,i(this,zr)+e),i(this,br)&&Zs(i(this,br),i(this,zr))}get_effect_pending(){return i(this,di).call(this),f(i(this,br))}error(e){var r=i(this,Pt).onerror;let s=i(this,Pt).failed;if(i(this,Fr)||!r&&!s)throw e;i(this,ct)&&(Re(i(this,ct)),_(this,ct,null)),i(this,Be)&&(Re(i(this,Be)),_(this,Be,null)),i(this,Mt)&&(Re(i(this,Mt)),_(this,Mt,null)),T&&(_e(i(this,_n)),Pf(),_e(za()));var n=!1,a=!1;const o=()=>{if(n){_f();return}n=!0,a&&nf(),Ot.ensure(),_(this,zr,0),i(this,Mt)!==null&&us(i(this,Mt),()=>{_(this,Mt,null)}),this.is_pending=this.has_pending_snippet(),_(this,ct,v(this,we,Ua).call(this,()=>(_(this,Fr,!1),Qe(()=>i(this,Zr).call(this,i(this,ze)))))),i(this,zt)>0?v(this,we,Ba).call(this):this.is_pending=!1};var c=Y;try{Ye(null),a=!0,r?.(e,o),a=!1}catch(l){Xs(l,i(this,Dt)&&i(this,Dt).parent)}finally{Ye(c)}s&&_t(()=>{_(this,Mt,v(this,we,Ua).call(this,()=>{Ot.ensure(),_(this,Fr,!0);try{return Qe(()=>{s(i(this,ze),()=>e,()=>o)})}catch(l){return Xs(l,i(this,Dt).parent),null}finally{_(this,Fr,!1)}}))})}}ze=new WeakMap,_n=new WeakMap,Pt=new WeakMap,Zr=new WeakMap,Dt=new WeakMap,ct=new WeakMap,Be=new WeakMap,Mt=new WeakMap,Zt=new WeakMap,vr=new WeakMap,zr=new WeakMap,zt=new WeakMap,Fr=new WeakMap,ks=new WeakMap,Cs=new WeakMap,br=new WeakMap,di=new WeakMap,we=new WeakSet,Tl=function(){try{_(this,ct,Qe(()=>i(this,Zr).call(this,i(this,ze))))}catch(e){this.error(e)}},Nl=function(){const e=i(this,Pt).pending;e&&(_(this,Be,Qe(()=>e(i(this,ze)))),Ot.enqueue(()=>{var r=v(this,we,eo).call(this);_(this,ct,v(this,we,Ua).call(this,()=>(Ot.ensure(),Qe(()=>i(this,Zr).call(this,r))))),i(this,zt)>0?v(this,we,Ba).call(this):(us(i(this,Be),()=>{_(this,Be,null)}),this.is_pending=!1)}))},eo=function(){var e=i(this,ze);return this.is_pending&&(_(this,vr,Ue()),i(this,ze).before(i(this,vr)),e=i(this,vr)),e},Ua=function(e){var r=Z,s=Y,n=me;Ht(i(this,Dt)),Ye(i(this,Dt)),Ys(i(this,Dt).ctx);try{return e()}catch(a){return _l(a),null}finally{Ht(r),Ye(s),Ys(n)}},Ba=function(){const e=i(this,Pt).pending;i(this,ct)!==null&&(_(this,Zt,document.createDocumentFragment()),i(this,Zt).append(i(this,vr)),su(i(this,ct),i(this,Zt))),i(this,Be)===null&&_(this,Be,Qe(()=>e(i(this,ze))))},to=function(e){var r;if(!this.has_pending_snippet()){this.parent&&v(r=this.parent,we,to).call(r,e);return}if(_(this,zt,i(this,zt)+e),i(this,zt)===0){this.is_pending=!1;for(const s of i(this,ks))Pe(s,Xe),dr(s);for(const s of i(this,Cs))Pe(s,pr),dr(s);i(this,ks).clear(),i(this,Cs).clear(),i(this,Be)&&us(i(this,Be),()=>{_(this,Be,null)}),i(this,Zt)&&(i(this,ze).before(i(this,Zt)),_(this,Zt,null))}};function Ll(t,e,r,s){const n=rn()?ya:_o;if(r.length===0&&t.length===0){s(e.map(n));return}var a=ee,o=Z,c=qf();function l(){Promise.all(r.map(u=>Of(u))).then(u=>{c();try{s([...e.map(n),...u])}catch(d){(o.f&lr)===0&&Xs(d,o)}a?.deactivate(),Fa()}).catch(u=>{Xs(u,o)})}t.length>0?Promise.all(t).then(()=>{c();try{return l()}finally{a?.deactivate(),Fa()}}):l()}function qf(){var t=Z,e=Y,r=me,s=ee;return function(a=!0){Ht(t),Ye(e),Ys(r),a&&s?.activate()}}function Fa(){Ht(null),Ye(null),Ys(null)}function ya(t){var e=De|Xe,r=Y!==null&&(Y.f&De)!==0?Y:null;return Z!==null&&(Z.f|=ps),{ctx:me,deps:null,effects:null,equals:Sl,f:e,fn:t,reactions:null,rv:0,v:Ie,wv:0,parent:r??Z,ac:null}}function Of(t,e,r){let s=Z;s===null&&Yd();var n=s.b,a=void 0,o=fr(Ie),c=!Y,l=new Map;return Kf(()=>{var u=ml();a=u.promise;try{Promise.resolve(t()).then(u.resolve,u.reject).then(()=>{d===ee&&d.committed&&d.deactivate(),Fa()})}catch(g){u.reject(g),Fa()}var d=ee;if(c){var h=n.is_rendered();n.update_pending_count(1),d.increment(h),l.get(d)?.reject(Rs),l.delete(d),l.set(d,u)}const p=(g,w=void 0)=>{if(d.activate(),w)w!==Rs&&(o.f|=Lr,Zs(o,w));else{(o.f&Lr)!==0&&(o.f^=Lr),Zs(o,g);for(const[A,E]of l){if(l.delete(A),A===d)break;E.reject(Rs)}}c&&(n.update_pending_count(-1),d.decrement(h))};u.promise.then(p,g=>p(null,g||"unknown"))}),wa(()=>{for(const u of l.values())u.reject(Rs)}),new Promise(u=>{function d(h){function p(){h===a?u(o):d(a)}h.then(p,p)}d(a)})}function z(t){const e=ya(t);return nu(e),e}function _o(t){const e=ya(t);return e.equals=Il,e}function jl(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)Re(e[r])}}function Uf(t){for(var e=t.parent;e!==null;){if((e.f&De)===0)return(e.f&lr)===0?e:null;e=e.parent}return null}function Ro(t){var e,r=Z;Ht(Uf(t));try{t.f&=~fs,jl(t),e=cu(t)}finally{Ht(r)}return e}function ql(t){var e=Ro(t);if(!t.equals(e)&&(t.wv=iu(),(!ee?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Pe(t,Le);return}Ur||(bt!==null?(Po()||ee?.is_fork)&&bt.set(t,e):Io(t))}let ro=new Set;const jr=new Map;let Ol=!1;function fr(t,e){var r={f:0,v:t,reactions:null,equals:Sl,rv:0,wv:0};return r}function P(t,e){const r=fr(t);return nu(r),r}function Bf(t,e=!1,r=!0){var n;const s=fr(t);return e||(s.equals=Il),tn&&r&&me!==null&&me.l!==null&&((n=me.l).s??(n.s=[])).push(s),s}function m(t,e,r=!1){Y!==null&&(!Et||(Y.f&nc)!==0)&&rn()&&(Y.f&(De|Wt|vo|nc))!==0&&!ur?.includes(t)&&sf();let s=r?pe(e):e;return Zs(t,s)}function Zs(t,e){if(!t.equals(e)){var r=t.v;Ur?jr.set(t,e):jr.set(t,r),t.v=e;var s=Ot.ensure();if(s.capture(t,r),(t.f&De)!==0){const n=t;(t.f&Xe)!==0&&Ro(n),Io(n)}t.wv=iu(),Ul(t,Xe),rn()&&Z!==null&&(Z.f&Le)!==0&&(Z.f&(hr|Hr))===0&&(ot===null?Zf([t]):ot.push(t)),!s.is_fork&&ro.size>0&&!Ol&&xf()}return e}function xf(){Ol=!1;var t=ds;ei(!0);const e=Array.from(ro);try{for(const r of e)(r.f&Le)!==0&&Pe(r,pr),Ea(r)&&En(r)}finally{ei(t)}ro.clear()}function Gg(t,e=1){var r=f(t),s=e===1?r++:r--;return m(t,r),s}function Ae(t){m(t,t.v+1)}function Ul(t,e){var r=t.reactions;if(r!==null)for(var s=rn(),n=r.length,a=0;a<n;a++){var o=r[a],c=o.f;if(!(!s&&o===Z)){var l=(c&Xe)===0;if(l&&Pe(o,e),(c&De)!==0){var u=o;bt?.delete(u),(c&fs)===0&&(c&ft&&(o.f|=fs),Ul(u,pr))}else l&&((c&Wt)!==0&&Yt!==null&&Yt.add(o),dr(o))}}}function pe(t){if(typeof t!="object"||t===null||Ut in t)return t;const e=Di(t);if(e!==pl&&e!==Gd)return t;var r=new Map,s=Ri(t),n=P(0),a=At,o=c=>{if(At===a)return c();var l=Y,u=At;Ye(null),dc(a);var d=c();return Ye(l),dc(u),d};return s&&r.set("length",P(t.length)),new Proxy(t,{defineProperty(c,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&tf();var d=r.get(l);return d===void 0?d=o(()=>{var h=P(u.value);return r.set(l,h),h}):m(d,u.value,!0),!0},deleteProperty(c,l){var u=r.get(l);if(u===void 0){if(l in c){const d=o(()=>P(Ie));r.set(l,d),Ae(n)}}else m(u,Ie),Ae(n);return!0},get(c,l,u){if(l===Ut)return t;var d=r.get(l),h=l in c;if(d===void 0&&(!h||Nr(c,l)?.writable)&&(d=o(()=>{var g=pe(h?c[l]:Ie),w=P(g);return w}),r.set(l,d)),d!==void 0){var p=f(d);return p===Ie?void 0:p}return Reflect.get(c,l,u)},getOwnPropertyDescriptor(c,l){var u=Reflect.getOwnPropertyDescriptor(c,l);if(u&&"value"in u){var d=r.get(l);d&&(u.value=f(d))}else if(u===void 0){var h=r.get(l),p=h?.v;if(h!==void 0&&p!==Ie)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return u},has(c,l){if(l===Ut)return!0;var u=r.get(l),d=u!==void 0&&u.v!==Ie||Reflect.has(c,l);if(u!==void 0||Z!==null&&(!d||Nr(c,l)?.writable)){u===void 0&&(u=o(()=>{var p=d?pe(c[l]):Ie,g=P(p);return g}),r.set(l,u));var h=f(u);if(h===Ie)return!1}return d},set(c,l,u,d){var h=r.get(l),p=l in c;if(s&&l==="length")for(var g=u;g<h.v;g+=1){var w=r.get(g+"");w!==void 0?m(w,Ie):g in c&&(w=o(()=>P(Ie)),r.set(g+"",w))}if(h===void 0)(!p||Nr(c,l)?.writable)&&(h=o(()=>P(void 0)),m(h,pe(u)),r.set(l,h));else{p=h.v!==Ie;var A=o(()=>pe(u));m(h,A)}var E=Reflect.getOwnPropertyDescriptor(c,l);if(E?.set&&E.set.call(d,u),!p){if(s&&typeof l=="string"){var I=r.get("length"),k=Number(l);Number.isInteger(k)&&k>=I.v&&m(I,k+1)}Ae(n)}return!0},ownKeys(c){f(n);var l=Reflect.ownKeys(c).filter(h=>{var p=r.get(h);return p===void 0||p.v!==Ie});for(var[u,d]of r)d.v!==Ie&&!(u in c)&&l.push(u);return l},setPrototypeOf(){rf()}})}function ic(t){try{if(t!==null&&typeof t=="object"&&Ut in t)return t[Ut]}catch{}return t}function Bl(t,e){return Object.is(ic(t),ic(e))}var oc,xl,Hl,Vl;function Hf(){if(oc===void 0){oc=window,xl=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;Hl=Nr(e,"firstChild").get,Vl=Nr(e,"nextSibling").get,sc(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),sc(r)&&(r.__t=void 0)}}function Ue(t=""){return document.createTextNode(t)}function Ke(t){return Hl.call(t)}function Gt(t){return Vl.call(t)}function Qg(t,e){if(!T)return Ke(t);var r=Ke(X);if(r===null)r=X.appendChild(Ue());else if(e&&r.nodeType!==Mi){var s=Ue();return r?.before(s),_e(s),s}return _e(r),r}function cc(t,e=!1){if(!T){var r=Ke(t);return r instanceof Comment&&r.data===""?Gt(r):r}if(e&&X?.nodeType!==Mi){var s=Ue();return X?.before(s),_e(s),s}return X}function Jg(t,e=1,r=!1){let s=T?X:t;for(var n;e--;)n=s,s=Gt(s);if(!T)return s;if(r&&s?.nodeType!==Mi){var a=Ue();return s===null?n?.after(a):s.before(a),_e(a),a}return _e(s),s}function Wl(t){t.textContent=""}function Gl(){return!1}function Vf(t=""){return document.createComment(t)}function Wf(t,e){if(e){const r=document.body;t.autofocus=!0,_t(()=>{document.activeElement===r&&t.focus()})}}function Kg(t){T&&Ke(t)!==null&&Wl(t)}let lc=!1;function Ql(){lc||(lc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function sn(t){var e=Y,r=Z;Ye(null),Ht(null);try{return t()}finally{Ye(e),Ht(r)}}function Ci(t,e,r,s=r){t.addEventListener(e,()=>sn(r));const n=t.__on_r;n?t.__on_r=()=>{n(),s(!0)}:t.__on_r=()=>s(!0),Ql()}function Jl(t){Z===null&&(Y===null&&zd(),Zd()),Ur&&Xd()}function Gf(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function gt(t,e,r){var s=Z;s!==null&&(s.f&nt)!==0&&(t|=nt);var n={ctx:me,deps:null,nodes:null,f:t|Xe|ft,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{En(n),n.f|=pa}catch(c){throw Re(n),c}else e!==null&&dr(n);var a=n;if(r&&a.deps===null&&a.teardown===null&&a.nodes===null&&a.first===a.last&&(a.f&ps)===0&&(a=a.first,(t&Wt)!==0&&(t&Bt)!==0&&a!==null&&(a.f|=Bt)),a!==null&&(a.parent=s,s!==null&&Gf(a,s),Y!==null&&(Y.f&De)!==0&&(t&Hr)===0)){var o=Y;(o.effects??(o.effects=[])).push(a)}return n}function Po(){return Y!==null&&!Et}function wa(t){const e=gt(ha,null,!1);return Pe(e,Le),e.teardown=t,e}function Or(t){Jl();var e=Z.f,r=!Y&&(e&hr)!==0&&(e&pa)===0;if(r){var s=me;(s.e??(s.e=[])).push(t)}else return Kl(t)}function Kl(t){return gt(Za|yl,t,!1)}function Qf(t){return Jl(),gt(ha|yl,t,!0)}function Yl(t){Ot.ensure();const e=gt(Hr|ps,t,!0);return()=>{Re(e)}}function Jf(t){Ot.ensure();const e=gt(Hr|ps,t,!0);return(r={})=>new Promise(s=>{r.outro?us(e,()=>{Re(e),s(void 0)}):(Re(e),s(void 0))})}function va(t){return gt(Za,t,!1)}function Kf(t){return gt(vo|ps,t,!0)}function ba(t,e=0){return gt(ha|e,t,!0)}function Yf(t,e=[],r=[],s=[]){Ll(s,e,r,n=>{gt(ha,()=>t(...n.map(f)),!0)})}function ms(t,e=0){var r=gt(Wt|e,t,!0);return r}function Xl(t,e=0){var r=gt(yo|e,t,!0);return r}function Qe(t){return gt(hr|ps,t,!0)}function Zl(t){var e=t.teardown;if(e!==null){const r=Ur,s=Y;uc(!0),Ye(null);try{e.call(null)}finally{uc(r),Ye(s)}}}function zl(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const n=r.ac;n!==null&&sn(()=>{n.abort(Rs)});var s=r.next;(r.f&Hr)!==0?r.parent=null:Re(r,e),r=s}}function Xf(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&hr)===0&&Re(e),e=r}}function Re(t,e=!0){var r=!1;(e||(t.f&gl)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Fl(t.nodes.start,t.nodes.end),r=!0),zl(t,e&&!r),ti(t,0),Pe(t,lr);var s=t.nodes&&t.nodes.t;if(s!==null)for(const a of s)a.stop();Zl(t);var n=t.parent;n!==null&&n.first!==null&&eu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Fl(t,e){for(;t!==null;){var r=t===e?null:Gt(t);t.remove(),t=r}}function eu(t){var e=t.parent,r=t.prev,s=t.next;r!==null&&(r.next=s),s!==null&&(s.prev=r),e!==null&&(e.first===t&&(e.first=s),e.last===t&&(e.last=r))}function us(t,e,r=!0){var s=[];tu(t,s,!0);var n=()=>{r&&Re(t),e&&e()},a=s.length;if(a>0){var o=()=>--a||n();for(var c of s)c.out(o)}else n()}function tu(t,e,r){if((t.f&nt)===0){t.f^=nt;var s=t.nodes&&t.nodes.t;if(s!==null)for(const c of s)(c.is_global||r)&&e.push(c);for(var n=t.first;n!==null;){var a=n.next,o=(n.f&Bt)!==0||(n.f&hr)!==0&&(t.f&Wt)!==0;tu(n,e,o?r:!1),n=a}}}function Do(t){ru(t,!0)}function ru(t,e){if((t.f&nt)!==0){t.f^=nt,(t.f&Le)===0&&(Pe(t,Xe),dr(t));for(var r=t.first;r!==null;){var s=r.next,n=(r.f&Bt)!==0||(r.f&hr)!==0;ru(r,n?e:!1),r=s}var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)(o.is_global||e)&&o.in()}}function su(t,e){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end;r!==null;){var n=r===s?null:Gt(r);e.append(r),r=n}}let ds=!1;function ei(t){ds=t}let Ur=!1;function uc(t){Ur=t}let Y=null,Et=!1;function Ye(t){Y=t}let Z=null;function Ht(t){Z=t}let ur=null;function nu(t){Y!==null&&(ur===null?ur=[t]:ur.push(t))}let Ge=null,Ze=0,ot=null;function Zf(t){ot=t}let au=1,Jr=0,At=Jr;function dc(t){At=t}function iu(){return++au}function Ea(t){var e=t.f;if((e&Xe)!==0)return!0;if(e&De&&(t.f&=~fs),(e&pr)!==0){for(var r=t.deps,s=r.length,n=0;n<s;n++){var a=r[n];if(Ea(a)&&ql(a),a.wv>t.wv)return!0}(e&ft)!==0&&bt===null&&Pe(t,Le)}return!1}function ou(t,e,r=!0){var s=t.reactions;if(s!==null&&!ur?.includes(t))for(var n=0;n<s.length;n++){var a=s[n];(a.f&De)!==0?ou(a,e,!1):e===a&&(r?Pe(a,Xe):(a.f&Le)!==0&&Pe(a,pr),dr(a))}}function cu(t){var w;var e=Ge,r=Ze,s=ot,n=Y,a=ur,o=me,c=Et,l=At,u=t.f;Ge=null,Ze=0,ot=null,Y=(u&(hr|Hr))===0?t:null,ur=null,Ys(t.ctx),Et=!1,At=++Jr,t.ac!==null&&(sn(()=>{t.ac.abort(Rs)}),t.ac=null);try{t.f|=Xi;var d=t.fn,h=d(),p=t.deps;if(Ge!==null){var g;if(ti(t,Ze),p!==null&&Ze>0)for(p.length=Ze+Ge.length,g=0;g<Ge.length;g++)p[Ze+g]=Ge[g];else t.deps=p=Ge;if(Po()&&(t.f&ft)!==0)for(g=Ze;g<p.length;g++)((w=p[g]).reactions??(w.reactions=[])).push(t)}else p!==null&&Ze<p.length&&(ti(t,Ze),p.length=Ze);if(rn()&&ot!==null&&!Et&&p!==null&&(t.f&(De|pr|Xe))===0)for(g=0;g<ot.length;g++)ou(ot[g],t);if(n!==null&&n!==t){if(Jr++,n.deps!==null)for(let A=0;A<r;A+=1)n.deps[A].rv=Jr;if(e!==null)for(const A of e)A.rv=Jr;ot!==null&&(s===null?s=ot:s.push(...ot))}return(t.f&Lr)!==0&&(t.f^=Lr),h}catch(A){return _l(A)}finally{t.f^=Xi,Ge=e,Ze=r,ot=s,Y=n,ur=a,Ys(o),Et=c,At=l}}function zf(t,e){let r=e.reactions;if(r!==null){var s=Vd.call(r,t);if(s!==-1){var n=r.length-1;n===0?r=e.reactions=null:(r[s]=r[n],r.pop())}}if(r===null&&(e.f&De)!==0&&(Ge===null||!Ge.includes(e))){var a=e;(a.f&ft)!==0&&(a.f^=ft,a.f&=~fs),Io(a),jl(a),ti(a,0)}}function ti(t,e){var r=t.deps;if(r!==null)for(var s=e;s<r.length;s++)zf(t,r[s])}function En(t){var e=t.f;if((e&lr)===0){Pe(t,Le);var r=Z,s=ds;Z=t,ds=!0;try{(e&(Wt|yo))!==0?Xf(t):zl(t),Zl(t);var n=cu(t);t.teardown=typeof n=="function"?n:null,t.wv=au;var a}finally{ds=s,Z=r}}}async function Ff(){await Promise.resolve(),Cf()}function f(t){var e=t.f,r=(e&De)!==0;if(Y!==null&&!Et){var s=Z!==null&&(Z.f&lr)!==0;if(!s&&!ur?.includes(t)){var n=Y.deps;if((Y.f&Xi)!==0)t.rv<Jr&&(t.rv=Jr,Ge===null&&n!==null&&n[Ze]===t?Ze++:Ge===null?Ge=[t]:Ge.push(t));else{(Y.deps??(Y.deps=[])).push(t);var a=t.reactions;a===null?t.reactions=[Y]:a.includes(Y)||a.push(Y)}}}if(Ur&&jr.has(t))return jr.get(t);if(r){var o=t;if(Ur){var c=o.v;return((o.f&Le)===0&&o.reactions!==null||uu(o))&&(c=Ro(o)),jr.set(o,c),c}var l=(o.f&ft)===0&&!Et&&Y!==null&&(ds||(Y.f&ft)!==0),u=o.deps===null;Ea(o)&&(l&&(o.f|=ft),ql(o)),l&&!u&&lu(o)}if(bt?.has(t))return bt.get(t);if((t.f&Lr)!==0)throw t.v;return t.v}function lu(t){if(t.deps!==null){t.f|=ft;for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&De)!==0&&(e.f&ft)===0&&lu(e)}}function uu(t){if(t.v===Ie)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(jr.has(e)||(e.f&De)!==0&&uu(e))return!0;return!1}function mr(t){var e=Et;try{return Et=!0,t()}finally{Et=e}}function eh(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ut in t)so(t);else if(!Array.isArray(t))for(let e in t){const r=t[e];typeof r=="object"&&r&&Ut in r&&so(r)}}}function so(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let s in t)try{so(t[s],e)}catch{}const r=Di(t);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const s=hl(r);for(let n in s){const a=s[n].get;if(a)try{a.call(t)}catch{}}}}}function th(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const rh=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function sh(t){return rh.includes(t)}const nh={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function ah(t){return t=t.toLowerCase(),nh[t]??t}const ih=["touchstart","touchmove"];function oh(t){return ih.includes(t)}const ch=["textarea","script","style","title"];function lh(t){return ch.includes(t)}const du=new Set,no=new Set;function Yg(t){if(!T)return;t.removeAttribute("onload"),t.removeAttribute("onerror");const e=t.__e;e!==void 0&&(t.__e=void 0,queueMicrotask(()=>{t.isConnected&&t.dispatchEvent(e)}))}function Mo(t,e,r,s={}){function n(a){if(s.capture||fn.call(e,a),!a.cancelBubble)return sn(()=>r?.call(this,a))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?_t(()=>{e.addEventListener(t,n,s)}):e.addEventListener(t,n,s),n}function zs(t,e,r,s={}){var n=Mo(e,t,r,s);return()=>{t.removeEventListener(e,n,s)}}function Xg(t,e,r,s,n){var a={capture:s,passive:n},o=Mo(t,e,r,a);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&wa(()=>{e.removeEventListener(t,o,a)})}function uh(t){for(var e=0;e<t.length;e++)du.add(t[e]);for(var r of no)r(t)}let fc=null;function fn(t){var e=this,r=e.ownerDocument,s=t.type,n=t.composedPath?.()||[],a=n[0]||t.target;fc=t;var o=0,c=fc===t&&t.__root;if(c){var l=n.indexOf(c);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var u=n.indexOf(e);if(u===-1)return;l<=u&&(o=l)}if(a=n[o]||t.target,a!==e){Wd(t,"currentTarget",{configurable:!0,get(){return a||r}});var d=Y,h=Z;Ye(null),Ht(null);try{for(var p,g=[];a!==null;){var w=a.assignedSlot||a.parentNode||a.host||null;try{var A=a["__"+s];A!=null&&(!a.disabled||t.target===a)&&A.call(a,t)}catch(E){p?g.push(E):p=E}if(t.cancelBubble||w===e||w===null)break;a=w}if(p){for(let E of g)queueMicrotask(()=>{throw E});throw p}}finally{t.__root=e,delete t.currentTarget,Ye(d),Ht(h)}}}function $o(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function at(t,e){var r=Z;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function Zg(t,e){var r=(e&wf)!==0,s=(e&vf)!==0,n,a=!t.startsWith("<!>");return()=>{if(T)return at(X,null),X;n===void 0&&(n=$o(a?t:"<!>"+t),r||(n=Ke(n)));var o=s||xl?document.importNode(n,!0):n.cloneNode(!0);if(r){var c=Ke(o),l=o.lastChild;at(c,l)}else at(o,o);return o}}function dh(t,e,r="svg"){var s=!t.startsWith("<!>"),n=`<${r}>${s?t:"<!>"+t}</${r}>`,a;return()=>{if(T)return at(X,null),X;if(!a){var o=$o(n),c=Ke(o);a=Ke(c)}var l=a.cloneNode(!0);return at(l,l),l}}function zg(t,e){return dh(t,e,"svg")}function Fg(t=""){if(!T){var e=Ue(t+"");return at(e,e),e}var r=X;return r.nodeType!==Mi&&(r.before(r=Ue()),_e(r)),at(r,r),r}function hc(){if(T)return at(X,null),X;var t=document.createDocumentFragment(),e=document.createComment(""),r=Ue();return t.append(e,r),at(e,r),t}function pc(t,e){if(T){var r=Z;((r.f&pa)===0||r.nodes.end===null)&&(r.nodes.end=X),xt();return}t!==null&&t.before(e)}let ri=!0;function $a(t){ri=t}function ey(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=r,t.nodeValue=r+"")}function ty(t,e){return fh(t,e)}const vs=new Map;function fh(t,{target:e,anchor:r,props:s={},events:n,context:a,intro:o=!0}){Hf();var c=new Set,l=h=>{for(var p=0;p<h.length;p++){var g=h[p];if(!c.has(g)){c.add(g);var w=oh(g);e.addEventListener(g,fn,{passive:w});var A=vs.get(g);A===void 0?(document.addEventListener(g,fn,{passive:w}),vs.set(g,1)):vs.set(g,A+1)}}};l(Pi(du)),no.add(l);var u=void 0,d=Jf(()=>{var h=r??e.appendChild(Ue());return Lf(h,{pending:()=>{}},p=>{if(a){Eo({});var g=me;g.c=a}if(n&&(s.$$events=n),T&&at(p,null),ri=o,u=t(p,s)||{},ri=!0,T&&(Z.nodes.end=X,X===null||X.nodeType!==en||X.data!==bo))throw ga(),ma;a&&So()}),()=>{for(var p of c){e.removeEventListener(p,fn);var g=vs.get(p);--g===0?(document.removeEventListener(p,fn),vs.delete(p)):vs.set(p,g)}no.delete(l),h!==r&&h.parentNode?.removeChild(h)}});return hh.set(u,d),u}let hh=new WeakMap;var wt,$t,Fe,es,Rn,Pn,fi;class Sa{constructor(e,r=!0){N(this,"anchor");y(this,wt,new Map);y(this,$t,new Map);y(this,Fe,new Map);y(this,es,new Set);y(this,Rn,!0);y(this,Pn,()=>{var e=ee;if(i(this,wt).has(e)){var r=i(this,wt).get(e),s=i(this,$t).get(r);if(s)Do(s),i(this,es).delete(r);else{var n=i(this,Fe).get(r);n&&(i(this,$t).set(r,n.effect),i(this,Fe).delete(r),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),s=n.effect)}for(const[a,o]of i(this,wt)){if(i(this,wt).delete(a),a===e)break;const c=i(this,Fe).get(o);c&&(Re(c.effect),i(this,Fe).delete(o))}for(const[a,o]of i(this,$t)){if(a===r||i(this,es).has(a))continue;const c=()=>{if(Array.from(i(this,wt).values()).includes(a)){var u=document.createDocumentFragment();su(o,u),u.append(Ue()),i(this,Fe).set(a,{effect:o,fragment:u})}else Re(o);i(this,es).delete(a),i(this,$t).delete(a)};i(this,Rn)||!s?(i(this,es).add(a),us(o,c,!1)):c()}}});y(this,fi,e=>{i(this,wt).delete(e);const r=Array.from(i(this,wt).values());for(const[s,n]of i(this,Fe))r.includes(s)||(Re(n.effect),i(this,Fe).delete(s))});this.anchor=e,_(this,Rn,r)}ensure(e,r){var s=ee,n=Gl();if(r&&!i(this,$t).has(e)&&!i(this,Fe).has(e))if(n){var a=document.createDocumentFragment(),o=Ue();a.append(o),i(this,Fe).set(e,{effect:Qe(()=>r(o)),fragment:a})}else i(this,$t).set(e,Qe(()=>r(this.anchor)));if(i(this,wt).set(s,e),n){for(const[c,l]of i(this,$t))c===e?s.skipped_effects.delete(l):s.skipped_effects.add(l);for(const[c,l]of i(this,Fe))c===e?s.skipped_effects.delete(l.effect):s.skipped_effects.add(l.effect);s.oncommit(i(this,Pn)),s.ondiscard(i(this,fi))}else T&&(this.anchor=X),i(this,Pn).call(this)}}wt=new WeakMap,$t=new WeakMap,Fe=new WeakMap,es=new WeakMap,Rn=new WeakMap,Pn=new WeakMap,fi=new WeakMap;function ph(t,e,r=!1){T&&xt();var s=new Sa(t),n=r?Bt:0;function a(o,c){if(T){const u=El(t)===$i;if(o===u){var l=za();_e(l),s.anchor=l,It(!1),s.ensure(o,c),It(!0);return}}s.ensure(o,c)}ms(()=>{var o=!1;e((c,l=!0)=>{o=!0,a(l,c)}),o||a(!1,null)},n)}function ry(t,e,r){T&&xt();var s=new Sa(t),n=!rn();ms(()=>{var a=e();n&&a!==null&&typeof a=="object"&&(a={}),s.ensure(a,r)})}function sy(t,e){return e}function mh(t,e,r){for(var s=[],n=e.length,a,o=e.length,c=0;c<n;c++){let h=e[c];us(h,()=>{if(a){if(a.pending.delete(h),a.done.add(h),a.pending.size===0){var p=t.outrogroups;ao(Pi(a.done)),p.delete(a),p.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=s.length===0&&r!==null;if(l){var u=r,d=u.parentNode;Wl(d),d.append(u),t.items.clear()}ao(e,!l)}else a={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(a)}function ao(t,e=!0){for(var r=0;r<t.length;r++)Re(t[r],e)}var mc;function ny(t,e,r,s,n,a=null){var o=t,c=new Map,l=(e&bl)!==0;if(l){var u=t;o=T?_e(Ke(u)):u.appendChild(Ue())}T&&xt();var d=null,h=_o(()=>{var I=r();return Ri(I)?I:I==null?[]:Pi(I)}),p,g=!0;function w(){E.fallback=d,gh(E,p,o,e,s),d!==null&&(p.length===0?(d.f&cr)===0?Do(d):(d.f^=cr,hn(d,null,o)):us(d,()=>{d=null}))}var A=ms(()=>{p=f(h);var I=p.length;let k=!1;if(T){var W=El(o)===$i;W!==(I===0)&&(o=za(),_e(o),It(!1),k=!0)}for(var x=new Set,J=ee,L=Gl(),U=0;U<I;U+=1){T&&X.nodeType===en&&X.data===bo&&(o=X,k=!0,It(!1));var F=p[U],se=s(F,U),G=g?null:c.get(se);G?(G.v&&Zs(G.v,F),G.i&&Zs(G.i,U),L&&J.skipped_effects.delete(G.e)):(G=yh(c,g?o:mc??(mc=Ue()),F,se,U,n,e,r),g||(G.e.f|=cr),c.set(se,G)),x.add(se)}if(I===0&&a&&!d&&(g?d=Qe(()=>a(o)):(d=Qe(()=>a(mc??(mc=Ue()))),d.f|=cr)),T&&I>0&&_e(za()),!g)if(L){for(const[an,on]of c)x.has(an)||J.skipped_effects.add(on.e);J.oncommit(w),J.ondiscard(()=>{})}else w();k&&It(!0),f(h)}),E={effect:A,items:c,outrogroups:null,fallback:d};g=!1,T&&(o=X)}function gh(t,e,r,s,n){var a=(s&cf)!==0,o=e.length,c=t.items,l=t.effect.first,u,d=null,h,p=[],g=[],w,A,E,I;if(a)for(I=0;I<o;I+=1)w=e[I],A=n(w,I),E=c.get(A).e,(E.f&cr)===0&&(E.nodes?.a?.measure(),(h??(h=new Set)).add(E));for(I=0;I<o;I+=1){if(w=e[I],A=n(w,I),E=c.get(A).e,t.outrogroups!==null)for(const G of t.outrogroups)G.pending.delete(E),G.done.delete(E);if((E.f&cr)!==0)if(E.f^=cr,E===l)hn(E,null,r);else{var k=d?d.next:l;E===t.effect.last&&(t.effect.last=E.prev),E.prev&&(E.prev.next=E.next),E.next&&(E.next.prev=E.prev),gr(t,d,E),gr(t,E,k),hn(E,k,r),d=E,p=[],g=[],l=d.next;continue}if((E.f&nt)!==0&&(Do(E),a&&(E.nodes?.a?.unfix(),(h??(h=new Set)).delete(E))),E!==l){if(u!==void 0&&u.has(E)){if(p.length<g.length){var W=g[0],x;d=W.prev;var J=p[0],L=p[p.length-1];for(x=0;x<p.length;x+=1)hn(p[x],W,r);for(x=0;x<g.length;x+=1)u.delete(g[x]);gr(t,J.prev,L.next),gr(t,d,J),gr(t,L,W),l=W,d=L,I-=1,p=[],g=[]}else u.delete(E),hn(E,l,r),gr(t,E.prev,E.next),gr(t,E,d===null?t.effect.first:d.next),gr(t,d,E),d=E;continue}for(p=[],g=[];l!==null&&l!==E;)(u??(u=new Set)).add(l),g.push(l),l=l.next;if(l===null)continue}(E.f&cr)===0&&p.push(E),d=E,l=E.next}if(t.outrogroups!==null){for(const G of t.outrogroups)G.pending.size===0&&(ao(Pi(G.done)),t.outrogroups?.delete(G));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||u!==void 0){var U=[];if(u!==void 0)for(E of u)(E.f&nt)===0&&U.push(E);for(;l!==null;)(l.f&nt)===0&&l!==t.fallback&&U.push(l),l=l.next;var F=U.length;if(F>0){var se=(s&bl)!==0&&o===0?r:null;if(a){for(I=0;I<F;I+=1)U[I].nodes?.a?.measure();for(I=0;I<F;I+=1)U[I].nodes?.a?.fix()}mh(t,U,se)}}a&&_t(()=>{if(h!==void 0)for(E of h)E.nodes?.a?.apply()})}function yh(t,e,r,s,n,a,o,c){var l=(o&af)!==0?(o&lf)===0?Bf(r,!1,!1):fr(r):null,u=(o&of)!==0?fr(n):null;return{v:l,i:u,e:Qe(()=>(a(e,l??r,u??n,c),()=>{t.delete(s)}))}}function hn(t,e,r){if(t.nodes)for(var s=t.nodes.start,n=t.nodes.end,a=e&&(e.f&cr)===0?e.nodes.start:r;s!==null;){var o=Gt(s);if(a.before(s),s===n)return;s=o}}function gr(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function ay(t,e,r=!1,s=!1,n=!1){var a=t,o="";Yf(()=>{var c=Z;if(o===(o=e()??"")){T&&xt();return}if(c.nodes!==null&&(Fl(c.nodes.start,c.nodes.end),c.nodes=null),o!==""){if(T){X.data;for(var l=xt(),u=l;l!==null&&(l.nodeType!==en||l.data!=="");)u=l,l=Gt(l);if(l===null)throw ga(),ma;at(X,u),a=_e(l);return}var d=o+"";r?d=`<svg>${d}</svg>`:s&&(d=`<math>${d}</math>`);var h=$o(d);if((r||s)&&(h=Ke(h)),at(Ke(h),h.lastChild),r||s)for(;Ke(h);)a.before(Ke(h));else a.before(h)}})}function iy(t,e,...r){var s=new Sa(t);ms(()=>{const n=e()??null;s.ensure(n,n&&(a=>n(a,...r)))},Bt)}function wh(t,e,r){T&&xt();var s=new Sa(t);ms(()=>{var n=e()??null;s.ensure(n,n&&(a=>r(a,n)))},Bt)}const vh=()=>performance.now(),or={tick:t=>requestAnimationFrame(t),now:()=>vh(),tasks:new Set};function fu(){const t=or.now();or.tasks.forEach(e=>{e.c(t)||(or.tasks.delete(e),e.f())}),or.tasks.size!==0&&or.tick(fu)}function bh(t){let e;return or.tasks.size===0&&or.tick(fu),{promise:new Promise(r=>{or.tasks.add(e={c:t,f:r})}),abort(){or.tasks.delete(e)}}}function ka(t,e){sn(()=>{t.dispatchEvent(new CustomEvent(e))})}function Eh(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function gc(t){const e={},r=t.split(";");for(const s of r){const[n,a]=s.split(":");if(!n||a===void 0)break;const o=Eh(n.trim());e[o]=a.trim()}return e}const Sh=t=>t;let hu=null;function yc(t){hu=t}function oy(t,e,r){var s=hu??Z,n=s.nodes,a,o,c,l=null;n.a??(n.a={element:t,measure(){a=this.element.getBoundingClientRect()},apply(){if(c?.abort(),o=this.element.getBoundingClientRect(),a.left!==o.left||a.right!==o.right||a.top!==o.top||a.bottom!==o.bottom){const u=e()(this.element,{from:a,to:o},r?.());c=si(this.element,u,void 0,1,()=>{c?.abort(),c=void 0})}},fix(){if(!t.getAnimations().length){var{position:u,width:d,height:h}=getComputedStyle(t);if(u!=="absolute"&&u!=="fixed"){var p=t.style;l={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=d,p.height=h;var g=t.getBoundingClientRect();if(a.left!==g.left||a.top!==g.top){var w=`translate(${a.left-g.left}px, ${a.top-g.top}px)`;p.transform=p.transform?`${p.transform} ${w}`:w}}}},unfix(){if(l){var u=t.style;u.position=l.position,u.width=l.width,u.height=l.height,u.transform=l.transform}}}),n.a.element=t}function cy(t,e,r,s){var W;var n=(t&mf)!==0,a=(t&gf)!==0,o=n&&a,c=(t&yf)!==0,l=o?"both":n?"in":"out",u,d=e.inert,h=e.style.overflow,p,g;function w(){return sn(()=>u??(u=r()(e,s?.()??{},{direction:l})))}var A={is_global:c,in(){if(e.inert=d,!n){g?.abort(),g?.reset?.();return}a||p?.abort(),ka(e,"introstart"),p=si(e,w(),g,1,()=>{ka(e,"introend"),p?.abort(),p=u=void 0,e.style.overflow=h})},out(x){if(!a){x?.(),u=void 0;return}e.inert=!0,ka(e,"outrostart"),g=si(e,w(),p,0,()=>{ka(e,"outroend"),x?.()})},stop:()=>{p?.abort(),g?.abort()}},E=Z;if(((W=E.nodes).t??(W.t=[])).push(A),n&&ri){var I=c;if(!I){for(var k=E.parent;k&&(k.f&Bt)!==0;)for(;(k=k.parent)&&(k.f&Wt)===0;);I=!k||(k.f&pa)!==0}I&&va(()=>{mr(()=>A.in())})}}function si(t,e,r,s,n){var a=s===1;if(Ss(e)){var o,c=!1;return _t(()=>{if(!c){var E=e({direction:a?"in":"out"});o=si(t,E,r,s,n)}}),{abort:()=>{c=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(r?.deactivate(),!e?.duration)return n(),{abort:cn,deactivate:cn,reset:cn,t:()=>s};const{delay:l=0,css:u,tick:d,easing:h=Sh}=e;var p=[];if(a&&r===void 0&&(d&&d(0,1),u)){var g=gc(u(0,1));p.push(g,g)}var w=()=>1-s,A=t.animate(p,{duration:l,fill:"forwards"});return A.onfinish=()=>{A.cancel();var E=r?.t()??1-s;r?.abort();var I=s-E,k=e.duration*Math.abs(I),W=[];if(k>0){var x=!1;if(u)for(var J=Math.ceil(k/16.666666666666668),L=0;L<=J;L+=1){var U=E+I*h(L/J),F=gc(u(U,1-U));W.push(F),x||(x=F.overflow==="hidden")}x&&(t.style.overflow="hidden"),w=()=>{var se=A.currentTime;return E+I*h(se/k)},d&&bh(()=>{if(A.playState!=="running")return!1;var se=w();return d(se,1-se),!0})}A=t.animate(W,{duration:k,fill:"forwards"}),A.onfinish=()=>{w=()=>s,d?.(s,1-s),n()}},{abort:()=>{A&&(A.cancel(),A.effect=null,A.onfinish=cn)},deactivate:()=>{n=cn},reset:()=>{s===0&&d?.(1,0)},t:()=>w()}}function ly(t,e,r,s,n,a){let o=T;T&&xt();var c=null;T&&X.nodeType===Kd&&(c=X,xt());var l=T?X:t,u=Z,d=new Sa(l,!1);ms(()=>{const h=e()||null;var p=Sf;if(h===null){d.ensure(null,null),$a(!0);return}return d.ensure(h,g=>{if(h){if(c=T?c:document.createElementNS(p,h),at(c,c),s){T&&lh(h)&&c.append(document.createComment(""));var w=T?Ke(c):c.appendChild(Ue());T&&(w===null?It(!1):_e(w)),yc(u),s(c,w),yc(null)}Z.nodes.end=c,g.before(c)}T&&_e(g)}),$a(!0),()=>{h&&$a(!1)}},Bt),wa(()=>{$a(!0)}),o&&(It(!0),_e(l))}function Ih(t,e){var r=void 0,s;Xl(()=>{r!==(r=e())&&(s&&(Re(s),s=null),r&&(s=Qe(()=>{va(()=>r(t))})))})}function pu(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(r=pu(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function Ah(){for(var t,e,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(e=pu(t))&&(s&&(s+=" "),s+=e);return s}function _h(t){return typeof t=="object"?Ah(t):t??""}const wc=[...` 	
\r\fÂ \v\uFEFF`];function Rh(t,e,r){var s=t==null?"":""+t;if(e&&(s=s?s+" "+e:e),r){for(var n in r)if(r[n])s=s?s+" "+n:n;else if(s.length)for(var a=n.length,o=0;(o=s.indexOf(n,o))>=0;){var c=o+a;(o===0||wc.includes(s[o-1]))&&(c===s.length||wc.includes(s[c]))?s=(o===0?"":s.substring(0,o))+s.substring(c+1):o=c}}return s===""?null:s}function vc(t,e=!1){var r=e?" !important;":";",s="";for(var n in t){var a=t[n];a!=null&&a!==""&&(s+=" "+n+": "+a+r)}return s}function Oi(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ph(t,e){if(e){var r="",s,n;if(Array.isArray(e)?(s=e[0],n=e[1]):s=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,o=0,c=!1,l=[];s&&l.push(...Object.keys(s).map(Oi)),n&&l.push(...Object.keys(n).map(Oi));var u=0,d=-1;const A=t.length;for(var h=0;h<A;h++){var p=t[h];if(c?p==="/"&&t[h-1]==="*"&&(c=!1):a?a===p&&(a=!1):p==="/"&&t[h+1]==="*"?c=!0:p==='"'||p==="'"?a=p:p==="("?o++:p===")"&&o--,!c&&a===!1&&o===0){if(p===":"&&d===-1)d=h;else if(p===";"||h===A-1){if(d!==-1){var g=Oi(t.substring(u,d).trim());if(!l.includes(g)){p!==";"&&h++;var w=t.substring(u,h).trim();r+=" "+w+";"}}u=h+1,d=-1}}}}return s&&(r+=vc(s)),n&&(r+=vc(n,!0)),r=r.trim(),r===""?null:r}return t==null?null:String(t)}function Dh(t,e,r,s,n,a){var o=t.__className;if(T||o!==r||o===void 0){var c=Rh(r,s,a);(!T||c!==t.getAttribute("class"))&&(c==null?t.removeAttribute("class"):e?t.className=c:t.setAttribute("class",c)),t.__className=r}else if(a&&n!==a)for(var l in a){var u=!!a[l];(n==null||u!==!!n[l])&&t.classList.toggle(l,u)}return a}function Ui(t,e={},r,s){for(var n in r){var a=r[n];e[n]!==a&&(r[n]==null?t.style.removeProperty(n):t.style.setProperty(n,a,s))}}function Mh(t,e,r,s){var n=t.__style;if(T||n!==e){var a=Ph(e,s);(!T||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=e}else s&&(Array.isArray(s)?(Ui(t,r?.[0],s[0]),Ui(t,r?.[1],s[1],"important")):Ui(t,r,s));return s}function ni(t,e,r=!1){if(t.multiple){if(e==null)return;if(!Ri(e))return Af();for(var s of t.options)s.selected=e.includes(vn(s));return}for(s of t.options){var n=vn(s);if(Bl(n,e)){s.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function mu(t){var e=new MutationObserver(()=>{ni(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),wa(()=>{e.disconnect()})}function uy(t,e,r=e){var s=new WeakSet,n=!0;Ci(t,"change",a=>{var o=a?"[selected]":":checked",c;if(t.multiple)c=[].map.call(t.querySelectorAll(o),vn);else{var l=t.querySelector(o)??t.querySelector("option:not([disabled])");c=l&&vn(l)}r(c),ee!==null&&s.add(ee)}),va(()=>{var a=e();if(t===document.activeElement){var o=yn??ee;if(s.has(o))return}if(ni(t,a,n),n&&a===void 0){var c=t.querySelector(":checked");c!==null&&(a=vn(c),r(a))}t.__value=a,n=!1}),mu(t)}function vn(t){return"__value"in t?t.__value:t.value}const ln=Symbol("class"),un=Symbol("style"),gu=Symbol("is custom element"),yu=Symbol("is html");function $h(t){if(T){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var s=t.value;ai(t,"value",null),t.value=s}if(t.hasAttribute("checked")){var n=t.checked;ai(t,"checked",null),t.checked=n}}};t.__on_r=r,_t(r),Ql()}}function dy(t,e){var r=Ti(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function fy(t,e){var r=Ti(t);r.checked!==(r.checked=e??void 0)&&(t.checked=e)}function kh(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function ai(t,e,r,s){var n=Ti(t);T&&(n[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||n[e]!==(n[e]=r)&&(e==="loading"&&(t[Jd]=r),r==null?t.removeAttribute(e):typeof r!="string"&&wu(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function Ch(t,e,r,s,n=!1,a=!1){if(T&&n&&t.tagName==="INPUT"){var o=t,c=o.type==="checkbox"?"defaultChecked":"defaultValue";c in r||$h(o)}var l=Ti(t),u=l[gu],d=!l[yu];let h=T&&u;h&&It(!1);var p=e||{},g=t.tagName==="OPTION";for(var w in e)w in r||(r[w]=null);r.class?r.class=_h(r.class):r[ln]&&(r.class=null),r[un]&&(r.style??(r.style=null));var A=wu(t);for(const L in r){let U=r[L];if(g&&L==="value"&&U==null){t.value=t.__value="",p[L]=U;continue}if(L==="class"){var E=t.namespaceURI==="http://www.w3.org/1999/xhtml";Dh(t,E,U,s,e?.[ln],r[ln]),p[L]=U,p[ln]=r[ln];continue}if(L==="style"){Mh(t,U,e?.[un],r[un]),p[L]=U,p[un]=r[un];continue}var I=p[L];if(!(U===I&&!(U===void 0&&t.hasAttribute(L)))){p[L]=U;var k=L[0]+L[1];if(k!=="$$")if(k==="on"){const F={},se="$$"+L;let G=L.slice(2);var W=sh(G);if(th(G)&&(G=G.slice(0,-7),F.capture=!0),!W&&I){if(U!=null)continue;t.removeEventListener(G,p[se],F),p[se]=null}if(U!=null)if(W)t[`__${G}`]=U,uh([G]);else{let an=function(on){p[L].call(this,on)};p[se]=Mo(G,t,an,F)}else W&&(t[`__${G}`]=void 0)}else if(L==="style")ai(t,L,U);else if(L==="autofocus")Wf(t,!!U);else if(!u&&(L==="__value"||L==="value"&&U!=null))t.value=t.__value=U;else if(L==="selected"&&g)kh(t,U);else{var x=L;d||(x=ah(x));var J=x==="defaultValue"||x==="defaultChecked";if(U==null&&!u&&!J)if(l[L]=null,x==="value"||x==="checked"){let F=t;const se=e===void 0;if(x==="value"){let G=F.defaultValue;F.removeAttribute(x),F.defaultValue=G,F.value=F.__value=se?G:null}else{let G=F.defaultChecked;F.removeAttribute(x),F.defaultChecked=G,F.checked=se?G:!1}}else t.removeAttribute(L);else J||A.includes(x)&&(u||typeof U!="string")?(t[x]=U,x in l&&(l[x]=Ie)):typeof U!="function"&&ai(t,x,U)}}}return h&&It(!0),p}function hy(t,e,r=[],s=[],n=[],a,o=!1,c=!1){Ll(n,r,s,l=>{var u=void 0,d={},h=t.nodeName==="SELECT",p=!1;if(Xl(()=>{var w=e(...l.map(f)),A=Ch(t,u,w,a,o,c);p&&h&&"value"in w&&ni(t,w.value);for(let I of Object.getOwnPropertySymbols(d))w[I]||Re(d[I]);for(let I of Object.getOwnPropertySymbols(w)){var E=w[I];I.description===If&&(!u||E!==u[I])&&(d[I]&&Re(d[I]),d[I]=Qe(()=>Ih(t,()=>E))),A[I]=E}u=A}),h){var g=t;va(()=>{ni(g,u.value,!0),mu(g)})}p=!0})}function Ti(t){return t.__attributes??(t.__attributes={[gu]:t.nodeName.includes("-"),[yu]:t.namespaceURI===Ef})}var bc=new Map;function wu(t){var e=t.getAttribute("is")||t.nodeName,r=bc.get(e);if(r)return r;bc.set(e,r=[]);for(var s,n=t,a=Element.prototype;a!==n;){s=hl(n);for(var o in s)s[o].set&&r.push(o);n=Di(n)}return r}let Bi=null;function Th(){if(Bi===null){var t=document.createElement("select");t.innerHTML="<option><span>t</span></option>",Bi=t.firstChild?.firstChild?.nodeType===1}return Bi}function py(t,e){var r=T;Th()||(It(!1),t.textContent="",t.append(Vf("")));try{e()}finally{r&&(T?Rf(t):(It(!0),_e(t)))}}function my(t,e,r=e){var s=new WeakSet;Ci(t,"input",async n=>{var a=n?t.defaultValue:t.value;if(a=Hi(t)?Vi(a):a,r(a),ee!==null&&s.add(ee),await Ff(),a!==(a=e())){var o=t.selectionStart,c=t.selectionEnd,l=t.value.length;if(t.value=a??"",c!==null){var u=t.value.length;o===c&&c===l&&u>l?(t.selectionStart=u,t.selectionEnd=u):(t.selectionStart=o,t.selectionEnd=Math.min(c,u))}}}),(T&&t.defaultValue!==t.value||mr(e)==null&&t.value)&&(r(Hi(t)?Vi(t.value):t.value),ee!==null&&s.add(ee)),ba(()=>{var n=e();if(t===document.activeElement){var a=yn??ee;if(s.has(a))return}Hi(t)&&n===Vi(t.value)||t.type==="date"&&!n&&!t.value||n!==t.value&&(t.value=n??"")})}const xi=new Set;function gy(t,e,r,s,n=s){var a=r.getAttribute("type")==="checkbox",o=t;let c=!1;if(e!==null)for(var l of e)o=o[l]??(o[l]=[]);o.push(r),Ci(r,"change",()=>{var u=r.__value;a&&(u=Ec(o,u,r.checked)),n(u)},()=>n(a?[]:null)),ba(()=>{var u=s();if(T&&r.defaultChecked!==r.checked){c=!0;return}a?(u=u||[],r.checked=u.includes(r.__value)):r.checked=Bl(r.__value,u)}),wa(()=>{var u=o.indexOf(r);u!==-1&&o.splice(u,1)}),xi.has(o)||(xi.add(o),_t(()=>{o.sort((u,d)=>u.compareDocumentPosition(d)===4?-1:1),xi.delete(o)})),_t(()=>{if(c){var u;if(a)u=Ec(o,u,r.checked);else{var d=o.find(h=>h.checked);u=d?.__value}n(u)}})}function yy(t,e,r=e){Ci(t,"change",s=>{var n=s?t.defaultChecked:t.checked;r(n)}),(T&&t.defaultChecked!==t.checked||mr(e)==null)&&r(t.checked),ba(()=>{var s=e();t.checked=!!s})}function Ec(t,e,r){for(var s=new Set,n=0;n<t.length;n+=1)t[n].checked&&s.add(t[n].__value);return r||s.delete(e),Array.from(s)}function Hi(t){var e=t.type;return e==="number"||e==="range"}function Vi(t){return t===""?null:+t}function Sc(t,e){return t===e||t?.[Ut]===e}function wy(t={},e,r,s){return va(()=>{var n,a;return ba(()=>{n=a,a=s?.()||[],mr(()=>{t!==r(...a)&&(e(t,...a),n&&Sc(r(...n),t)&&e(null,...n))})}),()=>{_t(()=>{a&&Sc(r(...a),t)&&e(null,...a)})}}),t}function vy(t=!1){const e=me,r=e.l.u;if(!r)return;let s=()=>eh(e.s);if(t){let n=0,a={};const o=ya(()=>{let c=!1;const l=e.s;for(const u in l)l[u]!==a[u]&&(a[u]=l[u],c=!0);return c&&n++,n});s=()=>f(o)}r.b.length&&Qf(()=>{Ic(e,s),Yi(r.b)}),Or(()=>{const n=mr(()=>r.m.map(Qd));return()=>{for(const a of n)typeof a=="function"&&a()}}),r.a.length&&Or(()=>{Ic(e,s),Yi(r.a)})}function Ic(t,e){if(t.l.s)for(const r of t.l.s)f(r);e()}let Ca=!1;function Nh(t){var e=Ca;try{return Ca=!1,[t(),Ca]}finally{Ca=e}}const Lh={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function by(t,e,r){return new Proxy({props:t,exclude:e},Lh)}const jh={get(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Ss(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s)return s[e]}},set(t,e,r){let s=t.props.length;for(;s--;){let n=t.props[s];Ss(n)&&(n=n());const a=Nr(n,e);if(a&&a.set)return a.set(r),!0}return!1},getOwnPropertyDescriptor(t,e){let r=t.props.length;for(;r--;){let s=t.props[r];if(Ss(s)&&(s=s()),typeof s=="object"&&s!==null&&e in s){const n=Nr(s,e);return n&&!n.configurable&&(n.configurable=!0),n}}},has(t,e){if(e===Ut||e===wl)return!1;for(let r of t.props)if(Ss(r)&&(r=r()),r!=null&&e in r)return!0;return!1},ownKeys(t){const e=[];for(let r of t.props)if(Ss(r)&&(r=r()),!!r){for(const s in r)e.includes(s)||e.push(s);for(const s of Object.getOwnPropertySymbols(r))e.includes(s)||e.push(s)}return e}};function Ey(...t){return new Proxy({props:t},jh)}function Sy(t,e,r,s){var n=!tn||(r&df)!==0,a=(r&hf)!==0,o=(r&pf)!==0,c=s,l=!0,u=()=>(l&&(l=!1,c=o?mr(s):s),c),d;if(a){var h=Ut in t||wl in t;d=Nr(t,e)?.set??(h&&e in t?W=>t[e]=W:void 0)}var p,g=!1;a?[p,g]=Nh(()=>t[e]):p=t[e],p===void 0&&s!==void 0&&(p=u(),d&&(n&&ef(),d(p)));var w;if(n?w=()=>{var W=t[e];return W===void 0?u():(l=!0,W)}:w=()=>{var W=t[e];return W!==void 0&&(c=void 0),W===void 0?c:W},n&&(r&ff)===0)return w;if(d){var A=t.$$legacy;return(function(W,x){return arguments.length>0?((!n||!x||A||g)&&d(x?w():W),W):w()})}var E=!1,I=((r&uf)!==0?ya:_o)(()=>(E=!1,w()));a&&f(I);var k=Z;return(function(W,x){if(arguments.length>0){const J=x?f(I):n&&a?pe(W):W;return m(I,J),E=!0,c!==void 0&&(c=J),W}return Ur&&E||(k.f&lr)!==0?I.v:f(I)})}function qh(t){me===null&&vl(),tn&&me.l!==null?Oh(me).m.push(t):Or(()=>{const e=mr(t);if(typeof e=="function")return e})}function Iy(t){me===null&&vl(),qh(()=>()=>mr(t))}function Oh(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const Uh="5";var fl;typeof window<"u"&&((fl=window.__svelte??(window.__svelte={})).v??(fl.v=new Set)).add(Uh);const Bh="modulepreload",xh=function(t){return"/app/"+t},Ac={},V=function(e,r,s){let n=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");n=l(r.map(u=>{if(u=xh(u),u in Ac)return;Ac[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Bh,d||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((g,w)=>{p.addEventListener("load",g),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})};var Hh=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Vh=["difference","intersection","symmetricDifference","union"],_c=!1,Ts,vt,Er,hi,Fs,vu,bu;const pi=class pi extends Set{constructor(r){super();y(this,Fs);y(this,Ts,new Map);y(this,vt,P(0));y(this,Er,P(0));y(this,hi,At||-1);if(r){for(var s of r)super.add(s);i(this,Er).v=super.size}_c||v(this,Fs,bu).call(this)}has(r){var s=super.has(r),n=i(this,Ts),a=n.get(r);if(a===void 0){if(!s)return f(i(this,vt)),!1;a=v(this,Fs,vu).call(this,!0),n.set(r,a)}return f(a),s}add(r){return super.has(r)||(super.add(r),m(i(this,Er),super.size),Ae(i(this,vt))),this}delete(r){var s=super.delete(r),n=i(this,Ts),a=n.get(r);return a!==void 0&&(n.delete(r),m(a,!1)),s&&(m(i(this,Er),super.size),Ae(i(this,vt))),s}clear(){if(super.size!==0){super.clear();var r=i(this,Ts);for(var s of r.values())m(s,!1);r.clear(),m(i(this,Er),0),Ae(i(this,vt))}}keys(){return this.values()}values(){return f(i(this,vt)),super.values()}entries(){return f(i(this,vt)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return f(i(this,Er))}};Ts=new WeakMap,vt=new WeakMap,Er=new WeakMap,hi=new WeakMap,Fs=new WeakSet,vu=function(r){return At===i(this,hi)?P(r):fr(r)},bu=function(){_c=!0;var r=pi.prototype,s=Set.prototype;for(const n of Hh)r[n]=function(...a){return f(i(this,vt)),s[n].apply(this,a)};for(const n of Vh)r[n]=function(...a){f(i(this,vt));var o=s[n].apply(this,a);return new pi(o)}};let Rc=pi;var kt,Ct,Ft,mi,St,pn,xa;const Ho=class Ho extends Map{constructor(r){super();y(this,St);y(this,kt,new Map);y(this,Ct,P(0));y(this,Ft,P(0));y(this,mi,At||-1);if(r){for(var[s,n]of r)super.set(s,n);i(this,Ft).v=super.size}}has(r){var s=i(this,kt),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=v(this,St,pn).call(this,0),s.set(r,n);else return f(i(this,Ct)),!1}return f(n),!0}forEach(r,s){v(this,St,xa).call(this),super.forEach(r,s)}get(r){var s=i(this,kt),n=s.get(r);if(n===void 0){var a=super.get(r);if(a!==void 0)n=v(this,St,pn).call(this,0),s.set(r,n);else{f(i(this,Ct));return}}return f(n),super.get(r)}set(r,s){var n=i(this,kt),a=n.get(r),o=super.get(r),c=super.set(r,s),l=i(this,Ct);if(a===void 0)a=v(this,St,pn).call(this,0),n.set(r,a),m(i(this,Ft),super.size),Ae(l);else if(o!==s){Ae(a);var u=l.reactions===null?null:new Set(l.reactions),d=u===null||!a.reactions?.every(h=>u.has(h));d&&Ae(l)}return c}delete(r){var s=i(this,kt),n=s.get(r),a=super.delete(r);return n!==void 0&&(s.delete(r),m(i(this,Ft),super.size),m(n,-1),Ae(i(this,Ct))),a}clear(){if(super.size!==0){super.clear();var r=i(this,kt);m(i(this,Ft),0);for(var s of r.values())m(s,-1);Ae(i(this,Ct)),r.clear()}}keys(){return f(i(this,Ct)),super.keys()}values(){return v(this,St,xa).call(this),super.values()}entries(){return v(this,St,xa).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(i(this,Ft)),super.size}};kt=new WeakMap,Ct=new WeakMap,Ft=new WeakMap,mi=new WeakMap,St=new WeakSet,pn=function(r){return At===i(this,mi)?P(r):fr(r)},xa=function(){f(i(this,Ct));var r=i(this,kt);if(i(this,Ft).v!==r.size){for(var s of rc(Ho.prototype,this,"keys").call(this))if(!r.has(s)){var n=v(this,St,pn).call(this,0);r.set(s,n)}}for([,n]of i(this,kt))f(n)};let ht=Ho;const Wh=Symbol();var $e,Dn,er,ts,mn;class Gh extends URLSearchParams{constructor(){super(...arguments);y(this,ts);y(this,$e,P(0));y(this,Dn,Jh());y(this,er,!1)}[Wh](r){if(!i(this,er)){_(this,er,!0);for(const s of[...super.keys()])super.delete(s);for(const[s,n]of r)super.append(s,n);Ae(i(this,$e)),_(this,er,!1)}}append(r,s){super.append(r,s),v(this,ts,mn).call(this),Ae(i(this,$e))}delete(r,s){var n=super.has(r,s);super.delete(r,s),n&&(v(this,ts,mn).call(this),Ae(i(this,$e)))}get(r){return f(i(this,$e)),super.get(r)}getAll(r){return f(i(this,$e)),super.getAll(r)}has(r,s){return f(i(this,$e)),super.has(r,s)}keys(){return f(i(this,$e)),super.keys()}set(r,s){var n=super.getAll(r).join("");super.set(r,s),n!==super.getAll(r).join("")&&(v(this,ts,mn).call(this),Ae(i(this,$e)))}sort(){super.sort(),v(this,ts,mn).call(this),Ae(i(this,$e))}toString(){return f(i(this,$e)),super.toString()}values(){return f(i(this,$e)),super.values()}entries(){return f(i(this,$e)),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return f(i(this,$e)),super.size}}$e=new WeakMap,Dn=new WeakMap,er=new WeakMap,ts=new WeakSet,mn=function(){if(!i(this,Dn)||i(this,er))return;_(this,er,!0);const r=this.toString();i(this,Dn).search=r&&`?${r}`,_(this,er,!1)};let Qh=null;function Jh(){return Qh}var Mn,$n;class Eu{constructor(e,r){y(this,Mn);y(this,$n);_(this,Mn,e),_(this,$n,Ao(r))}get current(){return i(this,$n).call(this),i(this,Mn).call(this)}}Mn=new WeakMap,$n=new WeakMap;const Kh=/\(.+\)/,Yh=new Set(["all","print","screen","and","or","not","only"]);class Pc extends Eu{constructor(e,r){let s=Kh.test(e)||e.split(/[\s,]+/).some(a=>Yh.has(a.trim()))?e:`(${e})`;const n=window.matchMedia(s);super(()=>n.matches,a=>zs(n,"change",a))}}const Su=typeof window<"u"?window:void 0;function Xh(t){let e=t.activeElement;for(;e?.shadowRoot;){const r=e.shadowRoot.activeElement;if(r===e)break;e=r}return e}var Ns,kn;class Zh{constructor(e={}){y(this,Ns);y(this,kn);const{window:r=Su,document:s=r?.document}=e;r!==void 0&&(_(this,Ns,s),_(this,kn,Ao(n=>{const a=zs(r,"focusin",n),o=zs(r,"focusout",n);return()=>{a(),o()}})))}get current(){var e;return(e=i(this,kn))==null||e.call(this),i(this,Ns)?Xh(i(this,Ns)):null}}Ns=new WeakMap,kn=new WeakMap;new Zh;function Iu(t){return typeof t=="function"}function Au(t,e){if(Iu(t)){const s=t();return s===void 0?e:s}return t===void 0?e:t}function zh(t,e){let r=P(null);const s=z(()=>Au(e,250));function n(...a){if(f(r))f(r).timeout&&clearTimeout(f(r).timeout);else{let o,c;const l=new Promise((u,d)=>{o=u,c=d});m(r,{timeout:null,runner:null,promise:l,resolve:o,reject:c},!0)}return f(r).runner=async()=>{if(!f(r))return;const o=f(r);m(r,null);try{o.resolve(await t.apply(this,a))}catch(c){o.reject(c)}},f(r).timeout=setTimeout(f(r).runner,f(s)),f(r).promise}return n.cancel=async()=>{(!f(r)||f(r).timeout===null)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||f(r).timeout===null)||(clearTimeout(f(r).timeout),f(r).reject("Cancelled"),m(r,null))},n.runScheduledNow=async()=>{(!f(r)||!f(r).timeout)&&(await new Promise(a=>setTimeout(a,0)),!f(r)||!f(r).timeout)||(clearTimeout(f(r).timeout),f(r).timeout=null,await f(r).runner?.())},Object.defineProperty(n,"pending",{enumerable:!0,get(){return!!f(r)?.timeout}}),n}function Fh(t){return Iu(t)?t():t}function Ay(t,e,r={}){const{root:s,rootMargin:n="0px",threshold:a=.1,immediate:o=!0,window:c=Su,once:l=!1}=r;let u=P(pe(o)),d;const h=z(()=>{const g=Au(t);return new Set(g?Array.isArray(g)?g:[g]:[])}),p=Yl(()=>{Or(()=>{if(!f(h).size||!f(u)||!c)return;const g=(w,A)=>{w.forEach(E=>{const I=Array.isArray(a)?a.some(W=>E.intersectionRatio>=W):E.intersectionRatio>=a,k=E.isIntersecting&&I;if(e([E],A),l&&k)return m(u,!1),()=>{A?.disconnect()}})};d=new c.IntersectionObserver(g,{rootMargin:n,root:Fh(s),threshold:a});for(const w of f(h))d.observe(w);return()=>{d?.disconnect()}})});return Or(()=>p),{get isActive(){return f(u)},stop:p,pause(){m(u,!1)},resume(){m(u,!0)}}}function _u(t,e){switch(e){case"kg":case"l.":return Math.round(t*100)/100;case"gr.":case"ml":return Math.round(t);default:return Math.round(t*10)/10}}function dt(t){return t?.length?t.map(e=>Kr(e.q,e.u)).join(" et "):"-"}function ep(t,e){const r=typeof t=="number"?t:parseFloat(t);if(isNaN(r))return{value:0,unit:e};let s=e,n=r;return(e==="gr."||e==="ml")&&r>=1e3?(n=r/1e3,s=e==="gr."?"kg":"l."):(e==="kg"||e==="l.")&&r<1&&r>0&&(n=r*1e3,s=e==="kg"?"gr.":"ml"),{value:_u(n,s),unit:s}}function Kr(t,e){const{value:r,unit:s}=ep(t,e);let n;return s==="kg"||s==="l."?n=r.toFixed(2).replace(/\.?0+$/,""):n=r.toString(),`${n} ${s}`}function _y(t,e,r){if(e==="au goÃ»t")return{quantity:t,unit:e,formatted:`${t} ${e}`,formattedNumber:`${t}`};const s=t*r,{q:n,u:a}=tp(s,e),o=_u(n,a);let c=`${o}`;return(a==="kg"||a==="l.")&&(c=o.toFixed(2).replace(/\.?0+$/,"")),{quantity:o,unit:a,formatted:`${c} ${a}`,formattedNumber:c}}function tp(t,e){const r=e.toLowerCase().trim();return(r==="gr."||r==="ml")&&t>=1e3?{q:t/1e3,u:r==="gr."?"kg":"l."}:(r==="kg"||r==="l.")&&t<1&&t>0?{q:t*1e3,u:r==="kg"?"gr.":"ml"}:{q:t,u:e}}function io(t){if(!t?.length)return[];const e=new Map;return t.forEach(({q:r,u:s})=>{if(typeof r=="number"&&!isNaN(r)){const n=e.get(s)||0;e.set(s,n+r)}}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function rp(t,e){const r=new Map,s=new Map;t.forEach(({q:o,u:c})=>{r.set(c,(r.get(c)||0)+o)}),e.forEach(({q:o,u:c})=>{s.set(c,(s.get(c)||0)+o)});const n=[],a=new Set([...r.keys(),...s.keys()]);for(const o of a){const c=r.get(o)||0,l=s.get(o)||0,u=c-l;Math.abs(u)>.001&&n.push({q:u,u:o})}return n}function Cr(t){if(!t?.trim())return null;try{return JSON.parse(t)}catch(e){return console.warn("[ProductsStore] Erreur parsing JSON:",e),null}}function ko(t){return t?.length?t.filter(e=>e.quantity!=null&&e.unit).map(e=>({q:typeof e.quantity=="number"?e.quantity:parseFloat(e.quantity),u:e.unit})).filter(e=>!isNaN(e.q)):[]}function Co(t){if(!t?.length)return[];const e=new Map;return t.forEach(r=>{if(!r.q||!r.u||typeof r.q!="number"||isNaN(r.q))return;const s=e.get(r.u)||0;e.set(r.u,s+r.q)}),Array.from(e.entries()).map(([r,s])=>({q:s,u:r}))}function Ni(t,e){if(!t?.length)return{numeric:[],display:"â Complet"};if(!e?.length){const c=t.map(l=>Kr(l.q,l.u)).join(" et ");return{numeric:t,display:c}}const r=new Map,s=new Map;t.forEach(c=>{const l=parseFloat(c.q);isNaN(l)||r.set(c.u,(r.get(c.u)||0)+l)}),e.forEach(c=>{s.set(c.u,(s.get(c.u)||0)+c.q)});const n=[],a=[];r.forEach((c,l)=>{const u=s.get(l)||0,d=c-u;d>0&&(n.push({q:d,u:l}),a.push(Kr(d,l)))});const o=a.length>0?a.join(" et "):"â Complet";return{numeric:n,display:o}}function sp(t){return t?Object.values(t).some(e=>e.recipes?.some(r=>r.q!==void 0||r.u!==void 0)):!1}function Ry(t){if(!t)return[];const e=[];return Object.entries(t).forEach(([r,s])=>{s.recipes?.forEach(n=>{e.push({...n,date:r,dateTimeService:r})})}),e}function Dc(t){if(!t?.length)return"ÃquilibrÃ©";const e=t.filter(s=>s.q>0),r=t.filter(s=>s.q<0);if(e.length>0&&r.length>0){const s=e.map(a=>Kr(a.q,a.u)).join(" et "),n=r.map(a=>Kr(Math.abs(a.q),a.u)).join(" et ");return`${s} disponibles, ${n} manquant${r.length>1?"s":""}`}else return e.length>0?e.map(s=>"+"+Kr(s.q,s.u)).join(" et ")+" disponibles":r.length>0?r.map(s=>Kr(Math.abs(s.q),s.u)).join(" et ")+` manquant${r.length>1?"s":""}`:"ÃquilibrÃ©"}function np(t,e){if(e.searchQuery.trim()){const s=e.searchQuery.toLowerCase();if(!t.productName.toLowerCase().includes(s))return!1}if(e.selectedStores.length>0&&(!t.storeInfo?.storeName||!e.selectedStores.includes(t.storeInfo.storeName))||e.selectedWho.length>0&&(!t.who||!t.who.some(s=>e.selectedWho.includes(s)))||e.selectedProductTypes.length>0&&(!t.productType||!e.selectedProductTypes.includes(t.productType)))return!1;const r=e.temperatureFilter;if(r&&r!=="all")switch(r){case"frais":if(!t.pF)return!1;break;case"not-frais":if(t.pF)return!1;break;case"surgele":if(!t.pS)return!1;break;case"not-surgele":if(t.pS)return!1;break}return!0}function Ru(t){return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function ap(t,e,r=.01){if(!t?.length&&!e?.length)return!0;if(!t?.length||!e?.length)return!1;const s=new Map(t.map(c=>[c.u,c.q])),n=new Map(e.map(c=>[c.u,c.q])),a=Array.from(s.keys()).sort(),o=Array.from(n.keys()).sort();if(a.length!==o.length||!a.every((c,l)=>c===o[l]))return!1;for(const[c,l]of s){const u=n.get(c);if(u===void 0)return!1;const d=Math.abs(l-u),h=Math.max(l,u),p=Math.max(h*r,1);if(d>p)return!1}return!0}function Py(t){const e=t.totalNeededOverrideParsed;if(!e)return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};if(!(e.totalComputedWhenOverride!==void 0&&e.platesNbWhenOverride!==void 0&&e.recipesNbWhenOverride!==void 0))return{hasMismatch:!1,computedChanged:!1,platesChanged:!1,recipesChanged:!1};const s=e.totalComputedWhenOverride,n=t.totalNeededArray,a=e.platesNbWhenOverride,o=t.totalAssiettes,c=e.recipesNbWhenOverride,l=t.nbRecipes,u=!ap(s,n),d=a!==o,h=c!==l,p=u||d||h;return{hasMismatch:p,computedChanged:u,platesChanged:d,recipesChanged:h,details:p?{oldComputed:s,newComputed:n,oldPlates:a,newPlates:o,oldRecipes:c,newRecipes:l}:void 0}}function Mc(t){return{...t,products:t.products?.map(e=>typeof e=="string"?e:e.$id)||[],mainId:t.mainId}}class To{static normalize(e,r,s=""){const n=r.toLowerCase(),a=s.toLowerCase(),o=n.includes("caf"),c=n.includes("soupe"),l=n.includes("pinc"),u=n.includes("gousse"),d=n.includes("tÃªte"),h=n.includes("unit")||n==="piÃ¨ce"||n==="piece",p=a.includes("sucre"),g=a.includes("sel"),w=a.includes("farine"),A=a.includes("crÃ¨me Ã©paisse")||a.includes("creme epaisse"),E=a==="ail",I=a.includes("oignon"),k=a==="tomate",W=a==="poireau",x=a.includes("aubergine"),J=a==="courgette",L=a==="Ã©chalote"||a==="echalote",U=a==="orange"&&!a.includes("jus"),F=a.includes("citron")&&!a.includes("jus"),se=a==="concombre",G=a==="levure chimique",an=a==="carotte",on=a==="betterave rouge",Vo=a.includes("semoule"),Wo=a.includes("poivre"),Go=a.includes("cacao"),Qo=a.includes("sucre glace"),Jo=a.includes("maizena")||a.includes("maÃ¯zena"),Ko=a.includes("bicarbonate"),Yo=a.includes("curcuma"),Xo=a.includes("cumin"),Zo=a.includes("curry"),zo=a.includes("muscade"),Fo=a.includes("paprika"),ec=a.includes("miel");let Jt=e,ws=r,Rt=!1,Vr="",Q="";if(o){Rt=!0;let j="cafe_default";Q="ml",p?(j="cafe_sucre",Q="gr."):g?(j="cafe_sel",Q="gr."):w?(j="cafe_farine",Q="gr."):Vo?(j="cafe_semoule",Q="gr."):Wo?(j="cafe_poivre",Q="gr."):Go?(j="cafe_cacao",Q="gr."):Qo?(j="cafe_sucre_glace",Q="gr."):Jo?(j="cafe_maizena",Q="gr."):Ko?(j="cafe_bicarbonate",Q="gr."):Yo?(j="cafe_curcuma",Q="gr."):Xo?(j="cafe_cumin",Q="gr."):Zo?(j="cafe_curry",Q="gr."):zo?(j="cafe_muscade",Q="gr."):Fo?(j="cafe_paprika",Q="gr."):ec?(j="cafe_miel",Q="gr."):A&&(j="cafe_creme_epaisse",Q="ml"),Jt=e*this.CONVERSION_RULES[j],Vr=`1 c. Ã  cafÃ© = ${this.CONVERSION_RULES[j]} ${Q}`}else if(c){Rt=!0;let j="soupe_default";Q="ml",p?(j="soupe_sucre",Q="gr."):g?(j="soupe_sel",Q="gr."):w?(j="soupe_farine",Q="gr."):Vo?(j="soupe_semoule",Q="gr."):Wo?(j="soupe_poivre",Q="gr."):Go?(j="soupe_cacao",Q="gr."):Qo?(j="soupe_sucre_glace",Q="gr."):Jo?(j="soupe_maizena",Q="gr."):A?(j="soupe_creme_epaisse",Q="ml"):Ko?(j="soupe_bicarbonate",Q="gr."):Yo?(j="soupe_curcuma",Q="gr."):Xo?(j="soupe_cumin",Q="gr."):Zo?(j="soupe_curry",Q="gr."):zo?(j="soupe_muscade",Q="gr."):Fo?(j="soupe_paprika",Q="gr."):ec&&(j="soupe_miel",Q="gr."),Jt=e*this.CONVERSION_RULES[j],Vr=`1 c. Ã  soupe = ${this.CONVERSION_RULES[j]} ${Q}`}else if(l)Rt=!0,Q="gr.",Jt=e*this.CONVERSION_RULES.pincee,Vr="1 pincÃ©e = 0.4 gr.";else if(u&&E)Rt=!0,Q="gr.",Jt=e*this.CONVERSION_RULES.gousse_ail,Vr="1 gousse = 6.5 gr.";else if(d&&E)Rt=!0,Q="gr.",Jt=e*this.CONVERSION_RULES.tete_ail,Vr="1 tÃªte = 80 gr.";else if(h){Rt=!0,Q="gr.";let j="";I?j="unite_oignon":E?j="unite_ail":k?j="unite_tomate":W?j="unite_poireau":x?j="unite_aubergine":J?j="unite_courgette":L?j="unite_eshalote":U?j="unite_orange":F?j="unite_citron":se?j="unite_concombre":G?j="unite_levure_chimique":an?j="unite_carotte":on?j="unite_betterave_rouge":Rt=!1,Rt&&(Jt=e*this.CONVERSION_RULES[j],Vr=`1 unitÃ© = ${this.CONVERSION_RULES[j]} gr.`)}return Rt?ws=Q:n==="kg"?(Jt=e*1e3,ws="gr."):n==="l."?(Jt=e*1e3,ws="ml"):n==="gr."?ws="gr.":n==="ml"&&(ws="ml"),{quantity:Jt,unit:ws,originalUnit:r,ruleUsed:Vr,hasConversion:Rt}}}N(To,"CONVERSION_RULES",{cafe_sucre:5,cafe_sel:5,cafe_farine:3,cafe_semoule:4,cafe_poivre:2.5,cafe_cacao:2.5,cafe_sucre_glace:3,cafe_maizena:3,cafe_bicarbonate:5,cafe_curcuma:2,cafe_cumin:2,cafe_curry:2,cafe_muscade:2,cafe_paprika:2,cafe_miel:10,cafe_creme_epaisse:5,cafe_default:5,soupe_sucre:15,soupe_sel:15,soupe_farine:10,soupe_semoule:12,soupe_poivre:8,soupe_cacao:8,soupe_sucre_glace:9,soupe_maizena:10,soupe_creme_epaisse:15,soupe_bicarbonate:15,soupe_curcuma:6,soupe_cumin:6,soupe_curry:6,soupe_muscade:7,soupe_paprika:6,soupe_miel:30,soupe_default:15,pincee:.4,gousse_ail:6.5,tete_ail:80,unite_oignon:120,unite_ail:6.5,unite_tomate:120,unite_poireau:150,unite_aubergine:250,unite_courgette:200,unite_eshalote:30,unite_orange:200,unite_citron:100,unite_concombre:200,unite_levure_chimique:11,unite_carotte:125,unite_betterave_rouge:250});const Pu=2;function ip(t){const r=new Date(t).getHours();return r>=11&&r<=13?"sun":r>=19&&r<=21?"moon":r>=7&&r<=9?"cloud":null}function op(t){return{formattedDate:new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"}),timeIcon:ip(t)}}function cp(t){const e={};for(const r of t)e[r]=op(r);return e}function lp(t,e,r){const s=!t.productHugoUuid,n=t.byDate&&Object.keys(t.byDate).length>0,a=s&&(t.totalNeededArray&&t.totalNeededArray.length>0||t.totalNeededOverrideParsed);if(!n&&!a)return{requiredQuantities:[],requiredQuantitiesFormatted:"-",stockBalance:[],availableStockQuantities:[],missingStockQuantities:[],availableStockFormatted:"-",missingStockFormatted:"-",hasAvailableStock:!1,hasMissingStock:!1,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map};if(s&&!n){const J=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray||[],L=J.length>0?dt(J):"-",U=$c(t,e,r,J),F=U.filter(G=>G.q>0),se=U.filter(G=>G.q<0);return{requiredQuantities:J,requiredQuantitiesFormatted:L,stockBalance:U,availableStockQuantities:F,missingStockQuantities:se,availableStockFormatted:Dc(U),missingStockFormatted:dt(se.map(G=>({q:Math.abs(G.q),u:G.u}))),hasAvailableStock:F.length>0,hasMissingStock:se.length>0,totalRecipesInRange:0,totalPortionsInRange:0,datesInSelectedRange:[],recipesByDate:new Map}}const o=e,c=r,l=[],u=new Map,d=new Map;let h=0,p=0;for(const[J,L]of Object.entries(t.byDate))J>=o&&J<=c&&(l.push(J),h+=L.totalAssiettes||0,L.recipes?.length&&(u.set(J,L.recipes),p+=L.recipes.length),L.totalConsolidated&&L.totalConsolidated.forEach(({q:U,u:F})=>{d.set(F,(d.get(F)||0)+U)}));const g=Array.from(d.entries()).map(([J,L])=>({q:L,u:J})),w=g.length>0?dt(g):"-",A=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:g,E=$c(t,e,r,A),I=E.filter(J=>J.q>0),k=new Date().toISOString().split("T")[0],x=r<k?[]:E.filter(J=>J.q<0);return{requiredQuantities:g,requiredQuantitiesFormatted:w,stockBalance:E,availableStockQuantities:I,missingStockQuantities:x,availableStockFormatted:Dc(E),missingStockFormatted:dt(x.map(J=>({q:Math.abs(J.q),u:J.u}))),hasAvailableStock:I.length>0,hasMissingStock:x.length>0,totalRecipesInRange:p,totalPortionsInRange:h,datesInSelectedRange:l,recipesByDate:u}}function $c(t,e,r,s){let n=[],a="";t.stockParsed?.dateTime&&t.stockParsed.dateTime<=e&&(n=[{q:parseFloat(t.stockParsed.quantity),u:t.stockParsed.unit}],a=t.stockParsed.dateTime);const o=[];if(t.purchases)for(const u of t.purchases)up(u,e,r,a)&&o.push({q:u.quantity,u:u.unit});const c=[...n,...o],l=io(c);return rp(l,s)}function up(t,e,r,s=""){if(t.status==="cancelled")return!1;const n=t.deliveryDate||t.$createdAt;if(!n)return!1;const a=new Date(r);return a.setHours(a.getHours()+Pu),!(a<new Date||n>a.toISOString()||s&&t.$createdAt<s)}class dp{constructor(){N(this,"dbName","recipes-cache");N(this,"db",null);N(this,"version",5);N(this,"RECIPES_INDEX_STORE","recipes-index");N(this,"RECIPES_DETAILS_STORE","recipes-details");N(this,"METADATA_STORE","metadata");N(this,"BUILD_TIMESTAMP_KEY","buildTimestamp");N(this,"LAST_APPWRITE_SYNC_KEY","lastAppwriteSync");N(this,"RECIPES_COUNT_KEY","recipesCount")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.RECIPES_INDEX_STORE)||(d.createObjectStore(this.RECIPES_INDEX_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-index' crÃ©Ã©")),d.objectStoreNames.contains(this.RECIPES_DETAILS_STORE)||(d.createObjectStore(this.RECIPES_DETAILS_STORE,{keyPath:"$id"}),console.log("[RecipesIDBCache] Object store 'recipes-details' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[RecipesIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.RECIPES_INDEX_STORE),n=r.objectStoreNames.contains(this.RECIPES_DETAILS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[RecipesIDBCache] Base corrompue dÃ©tectÃ©e (index=${s}, details=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[RecipesIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[RecipesIDBCache] Base ouverte: ${this.dbName}`)}async loadRecipesIndex(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_INDEX_STORE,"readonly").objectStore(this.RECIPES_INDEX_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} recettes (index) chargÃ©es`),e(o)},a.onerror=()=>r(a.error)})}async saveRecipesIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_INDEX_STORE,"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[RecipesIDBCache] ${e.size} recettes (index) sauvegardÃ©es`),r()},n.onerror=()=>s(n.error)})}async loadRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).get(e);o.onsuccess=()=>{const c=o.result;c&&console.log(`[RecipesIDBCache] DÃ©tails de ${e} chargÃ©s depuis le cache`),r(c||null)},o.onerror=()=>s(o.error)})}async saveRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).put(e);o.onsuccess=()=>{console.log(`[RecipesIDBCache] DÃ©tails de ${e.$id} sauvegardÃ©s`),r()},o.onerror=()=>s(o.error)})}async loadAllRecipeDetails(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[RecipesIDBCache] ${o.size} dÃ©tails de recettes chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.RECIPES_DETAILS_STORE,"readonly").objectStore(this.RECIPES_DETAILS_STORE),o=new Map;let c=0;const l=e.length;for(const u of e){const d=a.get(u);d.onsuccess=()=>{const h=d.result;h&&o.set(u,h),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk`),r(o))},d.onerror=()=>{console.warn(`[RecipesIDBCache] Erreur chargement ${u} en bulk:`,d.error),c++,c===l&&(console.log(`[RecipesIDBCache] ${o.size}/${l} recettes chargÃ©es en bulk (avec erreurs)`),r(o))}}l===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  charger en bulk"),r(o))})}async saveRecipeDetailsBulk(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite"),a=n.objectStore(this.RECIPES_DETAILS_STORE);let o=0;const c=e.size;e.forEach(l=>{const u=a.put(l);u.onsuccess=()=>{o++,o===c&&(console.log(`[RecipesIDBCache] ${c} recettes sauvegardÃ©es en bulk`),r())},u.onerror=()=>{console.error(`[RecipesIDBCache] Erreur sauvegarde ${l.$id} en bulk:`,u.error),s(u.error)}}),c===0&&(console.log("[RecipesIDBCache] 0 recettes Ã  sauvegarder en bulk"),r()),n.onerror=()=>s(n.error)})}async deleteRecipeDetail(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.RECIPES_DETAILS_STORE,"readwrite").objectStore(this.RECIPES_DETAILS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteRecipeFromIndex(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE],"readwrite"),a=n.objectStore(this.RECIPES_INDEX_STORE),o=n.objectStore(this.RECIPES_DETAILS_STORE);a.delete(e),o.delete(e),n.oncomplete=()=>{console.log(`[RecipesIDBCache] Recette ${e} supprimÃ©e de l'index et des dÃ©tails`),r()},n.onerror=()=>s(n.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={buildTimestamp:null,lastAppwriteSync:null,recipesCount:0,cacheVersion:1};o.forEach(l=>{l.key===this.RECIPES_COUNT_KEY?c.recipesCount=l.value:l.key===this.BUILD_TIMESTAMP_KEY?c.buildTimestamp=l.value:l.key===this.LAST_APPWRITE_SYNC_KEY&&(c.lastAppwriteSync=l.value)}),console.log(`[RecipesIDBCache] Metadata chargÃ©es: count=${c.recipesCount}, build=${c.buildTimestamp}, sync=${c.lastAppwriteSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.BUILD_TIMESTAMP_KEY,value:e.buildTimestamp}),a.put({key:this.LAST_APPWRITE_SYNC_KEY,value:e.lastAppwriteSync}),a.put({key:this.RECIPES_COUNT_KEY,value:e.recipesCount}),n.oncomplete=()=>{console.log("[RecipesIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.RECIPES_INDEX_STORE,this.RECIPES_DETAILS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.RECIPES_INDEX_STORE).clear(),s.objectStore(this.RECIPES_DETAILS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[RecipesIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[RecipesIDBCache] Connexion fermÃ©e"))}}async function fp(){const t=new dp;return await t.open(),t}function Dy(t){return t.map(e=>JSON.stringify(e))}function Ha(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{return JSON.parse(e)}catch(r){return console.warn("[ingredientUtils] Failed to parse ingredient:",e,r),null}}).filter(e=>e!==null)}const kc={"BouchÃ©es salÃ©es":"sandwich",Boisson:"cup-soda",Cake:"cake-slice","CrÃ¨mes dessert":"fast-food-pudding",Friture:"fryer",Gateau:"cake-slice",Pain:"bread","Plat au Four":"oven","Plat en Sauce":"pot",Salade:"lettuce",Sauce:"sauce",Snacking:"hamburger",Soupe:"soup","Tarte (salÃ©e)":"pizza","Tarte (sucrÃ©e)":"pie",Tartinade:"tartinade"},hp={entree:"salad",plat:"dish",dessert:"fast-food-pudding"};function My(t,e){const r=Array.isArray(e)?e[0]:e;if(r&&kc[r])return{label:r,iconId:kc[r]};const s=pp(t),n=hp[t]||"no-cat";return{label:s,iconId:n}}function pp(t){switch(t){case"entree":return"EntrÃ©e";case"plat":return"Plat";case"dessert":return"Dessert";default:return t}}function Wi(t){return!t||!Array.isArray(t)?[]:t.map(e=>{try{const r=JSON.parse(e);if(r&&typeof r.astuce=="string")return r;if(typeof e=="string")return{astuce:e}}catch(r){console.warn("[recipeUtils] Failed to parse astuce:",e,r)}return null}).filter(e=>e!==null)}function $y(t){return!t||!Array.isArray(t)||t.length===0?null:t.map(e=>JSON.stringify(typeof e=="string"?{astuce:e}:e))}function mp(t){if(!t||typeof t!="object"||Array.isArray(t))throw new Error(`Format d'ingrÃ©dient invalide: ${JSON.stringify(t)}`);return{uuid:t.uuid||"",name:t.name||"",originalQuantity:t.originalQuantity||0,originalUnit:t.originalUnit||"",normalizedQuantity:t.normalizedQuantity||0,normalizedUnit:t.normalizedUnit||"",comment:t.comment||"",allergens:Array.isArray(t.allergens)?t.allergens:[],type:t.type||"",pF:t.pF??!1,pS:t.pS??!1}}function Cc(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{try{e.push(mp(r))}catch(s){console.warn("[parseRecipeData] IngrÃ©dient invalide ignorÃ©:",s)}}),{...t,$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||"",ingredients:e}}function gp(t){if(!t||typeof t!="object")throw new Error("DonnÃ©es d'index de recette invalides");const e=[];return Array.isArray(t.ingredients)&&t.ingredients.forEach(r=>{typeof r=="string"?e.push(r):r&&typeof r.name=="string"&&e.push(r.name)}),{title:t.title||"",typeR:t.typeR||"",categories:Array.isArray(t.categories)?t.categories:[],regime:t.regime||null,draft:t.draft??!1,materiel:Array.isArray(t.materiel)?t.materiel:[],region:t.region||"",serveHot:t.serveHot??!1,cuisson:t.cuisson??!1,check:t.check??!1,saison:Array.isArray(t.saison)?t.saison:[],permissionWrite:Array.isArray(t.permissionWrite)?t.permissionWrite:[],lockedBy:t.lockedBy||null,plate:t.plate??100,ingredients:e,auteur:t.auteur||"",createdBy:t.createdBy||"",$id:t.$id||t.id||"",$createdAt:t.$createdAt||t.createdAt||"",$updatedAt:t.$updatedAt||t.updatedAt||""}}function Ta(t){let e=[];return t.ingredients&&(e=Ha(t.ingredients).map(s=>s.name)),{title:t.title,typeR:t.typeR,categories:t.categories,regime:t.regime,draft:t.draft||!1,saison:t.saison,ingredients:e,materiel:t.materiel,region:t.region||null,serveHot:t.serveHot,cuisson:t.cuisson,check:t.check,auteur:t.auteur||t.createdBy,permissionWrite:t.permissionWrite,lockedBy:t.lockedBy||null,$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,createdBy:t.createdBy,plate:t.plate,rootRecipeId:t.rootRecipeId||null,versionLabel:t.versionLabel||null}}function Gi(t,e,r,s){function n(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function c(d){try{u(s.next(d))}catch(h){o(h)}}function l(d){try{u(s.throw(d))}catch(h){o(h)}}function u(d){d.done?a(d.value):n(d.value).then(c,l)}u((s=s.apply(t,[])).next())})}function yp(t,e,r,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?s:r==="a"?s.call(t):s?s.value:e.get(t)}class S{constructor(e,r,s){this.method=e,this.attribute=r,s!==void 0&&(Array.isArray(s)?this.values=s:this.values=[s])}toString(){return JSON.stringify({method:this.method,attribute:this.attribute,values:this.values})}}S.equal=(t,e)=>new S("equal",t,e).toString();S.notEqual=(t,e)=>new S("notEqual",t,e).toString();S.lessThan=(t,e)=>new S("lessThan",t,e).toString();S.lessThanEqual=(t,e)=>new S("lessThanEqual",t,e).toString();S.greaterThan=(t,e)=>new S("greaterThan",t,e).toString();S.greaterThanEqual=(t,e)=>new S("greaterThanEqual",t,e).toString();S.isNull=t=>new S("isNull",t).toString();S.isNotNull=t=>new S("isNotNull",t).toString();S.between=(t,e,r)=>new S("between",t,[e,r]).toString();S.startsWith=(t,e)=>new S("startsWith",t,e).toString();S.endsWith=(t,e)=>new S("endsWith",t,e).toString();S.select=t=>new S("select",void 0,t).toString();S.search=(t,e)=>new S("search",t,e).toString();S.orderDesc=t=>new S("orderDesc",t).toString();S.orderAsc=t=>new S("orderAsc",t).toString();S.orderRandom=()=>new S("orderRandom").toString();S.cursorAfter=t=>new S("cursorAfter",void 0,t).toString();S.cursorBefore=t=>new S("cursorBefore",void 0,t).toString();S.limit=t=>new S("limit",void 0,t).toString();S.offset=t=>new S("offset",void 0,t).toString();S.contains=(t,e)=>new S("contains",t,e).toString();S.notContains=(t,e)=>new S("notContains",t,e).toString();S.notSearch=(t,e)=>new S("notSearch",t,e).toString();S.notBetween=(t,e,r)=>new S("notBetween",t,[e,r]).toString();S.notStartsWith=(t,e)=>new S("notStartsWith",t,e).toString();S.notEndsWith=(t,e)=>new S("notEndsWith",t,e).toString();S.createdBefore=t=>S.lessThan("$createdAt",t);S.createdAfter=t=>S.greaterThan("$createdAt",t);S.createdBetween=(t,e)=>S.between("$createdAt",t,e);S.updatedBefore=t=>S.lessThan("$updatedAt",t);S.updatedAfter=t=>S.greaterThan("$updatedAt",t);S.updatedBetween=(t,e)=>S.between("$updatedAt",t,e);S.or=t=>new S("or",void 0,t.map(e=>JSON.parse(e))).toString();S.and=t=>new S("and",void 0,t.map(e=>JSON.parse(e))).toString();S.distanceEqual=(t,e,r,s=!0)=>new S("distanceEqual",t,[[e,r,s]]).toString();S.distanceNotEqual=(t,e,r,s=!0)=>new S("distanceNotEqual",t,[[e,r,s]]).toString();S.distanceGreaterThan=(t,e,r,s=!0)=>new S("distanceGreaterThan",t,[[e,r,s]]).toString();S.distanceLessThan=(t,e,r,s=!0)=>new S("distanceLessThan",t,[[e,r,s]]).toString();S.intersects=(t,e)=>new S("intersects",t,[e]).toString();S.notIntersects=(t,e)=>new S("notIntersects",t,[e]).toString();S.crosses=(t,e)=>new S("crosses",t,[e]).toString();S.notCrosses=(t,e)=>new S("notCrosses",t,[e]).toString();S.overlaps=(t,e)=>new S("overlaps",t,[e]).toString();S.notOverlaps=(t,e)=>new S("notOverlaps",t,[e]).toString();S.touches=(t,e)=>new S("touches",t,[e]).toString();S.notTouches=(t,e)=>new S("notTouches",t,[e]).toString();class b extends Error{constructor(e,r=0,s="",n=""){super(e),this.name="AppwriteException",this.message=e,this.code=r,this.type=s,this.response=n}}class Xt{constructor(){this.config={endpoint:"https://cloud.appwrite.io/v1",endpointRealtime:"",project:"",jwt:"",locale:"",session:"",devkey:""},this.headers={"x-sdk-name":"Web","x-sdk-platform":"client","x-sdk-language":"web","x-sdk-version":"21.5.0","X-Appwrite-Response-Format":"1.8.0"},this.realtime={socket:void 0,timeout:void 0,heartbeat:void 0,url:"",channels:new Set,subscriptions:new Map,subscriptionsCounter:0,reconnect:!0,reconnectAttempts:0,lastMessage:void 0,connect:()=>{clearTimeout(this.realtime.timeout),this.realtime.timeout=window?.setTimeout(()=>{this.realtime.createSocket()},50)},getTimeout:()=>{switch(!0){case this.realtime.reconnectAttempts<5:return 1e3;case this.realtime.reconnectAttempts<15:return 5e3;case this.realtime.reconnectAttempts<100:return 1e4;default:return 6e4}},createHeartbeat:()=>{this.realtime.heartbeat&&clearTimeout(this.realtime.heartbeat),this.realtime.heartbeat=window?.setInterval(()=>{var e;(e=this.realtime.socket)===null||e===void 0||e.send(JSON.stringify({type:"ping"}))},2e4)},createSocket:()=>{var e,r,s;if(this.realtime.channels.size<1){this.realtime.reconnect=!1,(e=this.realtime.socket)===null||e===void 0||e.close();return}const n=new URLSearchParams;this.config.project&&n.set("project",this.config.project),this.realtime.channels.forEach(o=>{n.append("channels[]",o)});const a=this.config.endpointRealtime+"/realtime?"+n.toString();(a!==this.realtime.url||!this.realtime.socket||((r=this.realtime.socket)===null||r===void 0?void 0:r.readyState)>WebSocket.OPEN)&&(this.realtime.socket&&((s=this.realtime.socket)===null||s===void 0?void 0:s.readyState)<WebSocket.CLOSING&&(this.realtime.reconnect=!1,this.realtime.socket.close()),this.realtime.url=a,this.realtime.socket=new WebSocket(a),this.realtime.socket.addEventListener("message",this.realtime.onMessage),this.realtime.socket.addEventListener("open",o=>{this.realtime.reconnectAttempts=0,this.realtime.createHeartbeat()}),this.realtime.socket.addEventListener("close",o=>{var c,l,u;if(!this.realtime.reconnect||((l=(c=this.realtime)===null||c===void 0?void 0:c.lastMessage)===null||l===void 0?void 0:l.type)==="error"&&((u=this.realtime)===null||u===void 0?void 0:u.lastMessage.data).code===1008){this.realtime.reconnect=!0;return}const d=this.realtime.getTimeout();console.error(`Realtime got disconnected. Reconnect will be attempted in ${d/1e3} seconds.`,o.reason),setTimeout(()=>{this.realtime.reconnectAttempts++,this.realtime.createSocket()},d)}))},onMessage:e=>{var r,s;try{const n=JSON.parse(e.data);switch(this.realtime.lastMessage=n,n.type){case"connected":let a=this.config.session;if(!a){const l=JSON.parse((r=window.localStorage.getItem("cookieFallback"))!==null&&r!==void 0?r:"{}");a=l?.[`a_session_${this.config.project}`]}const o=n.data;a&&!o.user&&((s=this.realtime.socket)===null||s===void 0||s.send(JSON.stringify({type:"authentication",data:{session:a}})));break;case"event":let c=n.data;if(c?.channels){if(!c.channels.some(u=>this.realtime.channels.has(u)))return;this.realtime.subscriptions.forEach(u=>{c.channels.some(d=>u.channels.includes(d))&&setTimeout(()=>u.callback(c))})}break;case"pong":break;case"error":throw n.data;default:break}}catch(n){console.error(n)}},cleanUp:e=>{this.realtime.channels.forEach(r=>{e.includes(r)&&(Array.from(this.realtime.subscriptions).some(([n,a])=>a.channels.includes(r))||this.realtime.channels.delete(r))})}}}setEndpoint(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new b("Invalid endpoint URL: "+e);return this.config.endpoint=e,this.config.endpointRealtime=e.replace("https://","wss://").replace("http://","ws://"),this}setEndpointRealtime(e){if(!e.startsWith("ws://")&&!e.startsWith("wss://"))throw new b("Invalid realtime endpoint URL: "+e);return this.config.endpointRealtime=e,this}setProject(e){return this.headers["X-Appwrite-Project"]=e,this.config.project=e,this}setJWT(e){return this.headers["X-Appwrite-JWT"]=e,this.config.jwt=e,this}setLocale(e){return this.headers["X-Appwrite-Locale"]=e,this.config.locale=e,this}setSession(e){return this.headers["X-Appwrite-Session"]=e,this.config.session=e,this}setDevKey(e){return this.headers["X-Appwrite-Dev-Key"]=e,this.config.devkey=e,this}subscribe(e,r){let s=typeof e=="string"?[e]:e;s.forEach(a=>this.realtime.channels.add(a));const n=this.realtime.subscriptionsCounter++;return this.realtime.subscriptions.set(n,{channels:s,callback:r}),this.realtime.connect(),()=>{this.realtime.subscriptions.delete(n),this.realtime.cleanUp(s),this.realtime.connect()}}prepareRequest(e,r,s={},n={}){if(e=e.toUpperCase(),s=Object.assign({},this.headers,s),typeof window<"u"&&window.localStorage){const o=window.localStorage.getItem("cookieFallback");o&&(s["X-Fallback-Cookies"]=o)}let a={method:e,headers:s};if(s["X-Appwrite-Dev-Key"]===void 0&&(a.credentials="include"),e==="GET")for(const[o,c]of Object.entries(Xt.flatten(n)))r.searchParams.append(o,c);else switch(s["content-type"]){case"application/json":a.body=JSON.stringify(n);break;case"multipart/form-data":const o=new FormData;for(const[c,l]of Object.entries(n))if(l instanceof File)o.append(c,l,l.name);else if(Array.isArray(l))for(const u of l)o.append(`${c}[]`,u);else o.append(c,l);a.body=o,delete s["content-type"];break}return{uri:r.toString(),options:a}}chunkedUpload(e,r,s={},n={},a){var o;return Gi(this,void 0,void 0,function*(){const[c,l]=(o=Object.entries(n).find(([h,p])=>p instanceof File))!==null&&o!==void 0?o:[];if(!l||!c)throw new Error("File not found in payload");if(l.size<=Xt.CHUNK_SIZE)return yield this.call(e,r,s,n);let u=0,d=null;for(;u<l.size;){let h=u+Xt.CHUNK_SIZE;h>=l.size&&(h=l.size),s["content-range"]=`bytes ${u}-${h-1}/${l.size}`;const p=l.slice(u,h);let g=Object.assign({},n);g[c]=new File([p],l.name),d=yield this.call(e,r,s,g),a&&typeof a=="function"&&a({$id:d.$id,progress:Math.round(h/l.size*100),sizeUploaded:h,chunksTotal:Math.ceil(l.size/Xt.CHUNK_SIZE),chunksUploaded:Math.ceil(h/Xt.CHUNK_SIZE)}),d&&d.$id&&(s["x-appwrite-id"]=d.$id),u=h}return d})}ping(){return Gi(this,void 0,void 0,function*(){return this.call("GET",new URL(this.config.endpoint+"/ping"))})}call(e,r,s={},n={},a="json"){var o,c;return Gi(this,void 0,void 0,function*(){const{uri:l,options:u}=this.prepareRequest(e,r,s,n);let d=null;const h=yield fetch(l,u);if(h.type==="opaque")throw new b(`Invalid Origin. Register your new client (${window.location.host}) as a new Web platform on your project console dashboard`,403,"forbidden","");const p=h.headers.get("x-appwrite-warning");if(p&&p.split(";").forEach(w=>console.warn("Warning: "+w)),!((o=h.headers.get("content-type"))===null||o===void 0)&&o.includes("application/json")?d=yield h.json():a==="arrayBuffer"?d=yield h.arrayBuffer():d={message:yield h.text()},400<=h.status){let w="";throw!((c=h.headers.get("content-type"))===null||c===void 0)&&c.includes("application/json")||a==="arrayBuffer"?w=JSON.stringify(d):w=d?.message,new b(d?.message,h.status,d?.type,w)}const g=h.headers.get("X-Fallback-Cookies");return typeof window<"u"&&window.localStorage&&g&&(window.console.warn("Appwrite is using localStorage for session management. Increase your security by adding a custom domain as your API endpoint."),window.localStorage.setItem("cookieFallback",g)),d})}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),Xt.flatten(a,o)):s[o]=a}return s}}Xt.CHUNK_SIZE=1024*1024*5;class Sn{constructor(e){this.client=e}static flatten(e,r=""){let s={};for(const[n,a]of Object.entries(e)){let o=r?r+"["+n+"]":n;Array.isArray(a)?s=Object.assign(Object.assign({},s),Sn.flatten(a,o)):s[o]=a}return s}}Sn.CHUNK_SIZE=5*1024*1024;class wp{constructor(e){this.client=e}get(){const e="/account",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],password:r[1],name:r[2]};const n=s.userId,a=s.email,o=s.password,c=s.name;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "email"');if(typeof o>"u")throw new b('Missing required parameter: "password"');const l="/account",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.password=o),typeof c<"u"&&(u.name=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}updateEmail(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new b('Missing required parameter: "email"');if(typeof a>"u")throw new b('Missing required parameter: "password"');const o="/account/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}listIdentities(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/identities",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}deleteIdentity(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={identityId:e};const s=r.identityId;if(typeof s>"u")throw new b('Missing required parameter: "identityId"');const n="/account/identities/{identityId}".replace("{identityId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createJWT(){const e="/account/jwts",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}listLogs(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,total:r[0]};const n=s.queries,a=s.total,o="/account/logs",c={};typeof n<"u"&&(c.queries=n),typeof a<"u"&&(c.total=a);const l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMFA(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={mfa:e};const s=r.mfa;if(typeof s>"u")throw new b('Missing required parameter: "mfa"');const n="/account/mfa",a={};typeof s<"u"&&(a.mfa=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new b('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new b('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new b('Missing required parameter: "type"');if(typeof a>"u")throw new b('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAAuthenticator(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?s=e||{}:s={type:e,otp:r[0]};const n=s.type,a=s.otp;if(typeof n>"u")throw new b('Missing required parameter: "type"');if(typeof a>"u")throw new b('Missing required parameter: "otp"');const o="/account/mfa/authenticators/{type}".replace("{type}",n),c={};typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deleteMfaAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new b('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}deleteMFAAuthenticator(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"type"in e?r=e||{}:r={type:e};const s=r.type;if(typeof s>"u")throw new b('Missing required parameter: "type"');const n="/account/mfa/authenticators/{type}".replace("{type}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createMfaChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new b('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createMFAChallenge(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"factor"in e?r=e||{}:r={factor:e};const s=r.factor;if(typeof s>"u")throw new b('Missing required parameter: "factor"');const n="/account/mfa/challenges",a={};typeof s<"u"&&(a.factor=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateMfaChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new b('Missing required parameter: "challengeId"');if(typeof a>"u")throw new b('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateMFAChallenge(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={challengeId:e,otp:r[0]};const n=s.challengeId,a=s.otp;if(typeof n>"u")throw new b('Missing required parameter: "challengeId"');if(typeof a>"u")throw new b('Missing required parameter: "otp"');const o="/account/mfa/challenges",c={};typeof n<"u"&&(c.challengeId=n),typeof a<"u"&&(c.otp=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}listMfaFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}listMFAFactors(){const e="/account/mfa/factors",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}getMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}createMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updateMfaRecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateMFARecoveryCodes(){const e="/account/mfa/recovery-codes",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}updateName(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={name:e};const s=r.name;if(typeof s>"u")throw new b('Missing required parameter: "name"');const n="/account/name",a={};typeof s<"u"&&(a.name=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}updatePassword(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={password:e,oldPassword:r[0]};const n=s.password,a=s.oldPassword;if(typeof n>"u")throw new b('Missing required parameter: "password"');const o="/account/password",c={};typeof n<"u"&&(c.password=n),typeof a<"u"&&(c.oldPassword=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}updatePhone(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={phone:e,password:r[0]};const n=s.phone,a=s.password;if(typeof n>"u")throw new b('Missing required parameter: "phone"');if(typeof a>"u")throw new b('Missing required parameter: "password"');const o="/account/phone",c={};typeof n<"u"&&(c.phone=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("patch",l,u,c)}getPrefs(){const e="/account/prefs",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}updatePrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)&&"prefs"in e?r=e||{}:r={prefs:e};const s=r.prefs;if(typeof s>"u")throw new b('Missing required parameter: "prefs"');const n="/account/prefs",a={};typeof s<"u"&&(a.prefs=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}createRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,url:r[0]};const n=s.email,a=s.url;if(typeof n>"u")throw new b('Missing required parameter: "email"');if(typeof a>"u")throw new b('Missing required parameter: "url"');const o="/account/recovery",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.url=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateRecovery(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0],password:r[1]};const n=s.userId,a=s.secret,o=s.password;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');if(typeof o>"u")throw new b('Missing required parameter: "password"');const c="/account/recovery",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.secret=a),typeof o<"u"&&(l.password=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("put",u,d,l)}listSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={};return this.client.call("get",s,n,r)}deleteSessions(){const e="/account/sessions",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("delete",s,n,r)}createAnonymousSession(){const e="/account/sessions/anonymous",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}createEmailPasswordSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={email:e,password:r[0]};const n=s.email,a=s.password;if(typeof n>"u")throw new b('Missing required parameter: "email"');if(typeof a>"u")throw new b('Missing required parameter: "password"');const o="/account/sessions/email",c={};typeof n<"u"&&(c.email=n),typeof a<"u"&&(c.password=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}updateMagicURLSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/sessions/magic-url",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createOAuth2Session(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new b('Missing required parameter: "provider"');const l="/account/sessions/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(Sn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}updatePhoneSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/sessions/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createSession(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/sessions/token",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}getSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new b('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new b('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("patch",o,c,a)}deleteSession(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={sessionId:e};const s=r.sessionId;if(typeof s>"u")throw new b('Missing required parameter: "sessionId"');const n="/account/sessions/{sessionId}".replace("{sessionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}updateStatus(){const e="/account/status",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("patch",s,n,r)}createPushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0],providerId:r[1]};const n=s.targetId,a=s.identifier,o=s.providerId;if(typeof n>"u")throw new b('Missing required parameter: "targetId"');if(typeof a>"u")throw new b('Missing required parameter: "identifier"');const c="/account/targets/push",l={};typeof n<"u"&&(l.targetId=n),typeof a<"u"&&(l.identifier=a),typeof o<"u"&&(l.providerId=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}updatePushTarget(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={targetId:e,identifier:r[0]};const n=s.targetId,a=s.identifier;if(typeof n>"u")throw new b('Missing required parameter: "targetId"');if(typeof a>"u")throw new b('Missing required parameter: "identifier"');const o="/account/targets/{targetId}/push".replace("{targetId}",n),c={};typeof a<"u"&&(c.identifier=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}deletePushTarget(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={targetId:e};const s=r.targetId;if(typeof s>"u")throw new b('Missing required parameter: "targetId"');const n="/account/targets/{targetId}/push".replace("{targetId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createEmailToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],phrase:r[1]};const n=s.userId,a=s.email,o=s.phrase;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "email"');const c="/account/tokens/email",l={};typeof n<"u"&&(l.userId=n),typeof a<"u"&&(l.email=a),typeof o<"u"&&(l.phrase=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}createMagicURLToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,email:r[0],url:r[1],phrase:r[2]};const n=s.userId,a=s.email,o=s.url,c=s.phrase;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "email"');const l="/account/tokens/magic-url",u={};typeof n<"u"&&(u.userId=n),typeof a<"u"&&(u.email=a),typeof o<"u"&&(u.url=o),typeof c<"u"&&(u.phrase=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("post",d,h,u)}createOAuth2Token(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)&&"provider"in e?s=e||{}:s={provider:e,success:r[0],failure:r[1],scopes:r[2]};const n=s.provider,a=s.success,o=s.failure,c=s.scopes;if(typeof n>"u")throw new b('Missing required parameter: "provider"');const l="/account/tokens/oauth2/{provider}".replace("{provider}",n),u={};typeof a<"u"&&(u.success=a),typeof o<"u"&&(u.failure=o),typeof c<"u"&&(u.scopes=c);const d=new URL(this.client.config.endpoint+l);u.project=this.client.config.project;for(const[h,p]of Object.entries(Sn.flatten(u)))d.searchParams.append(h,p);if(typeof window<"u"&&window?.location){window.location.href=d.toString();return}else return d.toString()}createPhoneToken(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,phone:r[0]};const n=s.userId,a=s.phone;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "phone"');const o="/account/tokens/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.phone=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}createEmailVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new b('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}createVerification(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={url:e};const s=r.url;if(typeof s>"u")throw new b('Missing required parameter: "url"');const n="/account/verifications/email",a={};typeof s<"u"&&(a.url=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}updateEmailVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}updateVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/verifications/email",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}createPhoneVerification(){const e="/account/verifications/phone",r={},s=new URL(this.client.config.endpoint+e),n={"content-type":"application/json"};return this.client.call("post",s,n,r)}updatePhoneVerification(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={userId:e,secret:r[0]};const n=s.userId,a=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "userId"');if(typeof a>"u")throw new b('Missing required parameter: "secret"');const o="/account/verifications/phone",c={};typeof n<"u"&&(c.userId=n),typeof a<"u"&&(c.secret=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}class vp{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/databases/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/databases/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new b('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new b('Missing required parameter: "transactionId"');const c="/databases/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new b('Missing required parameter: "transactionId"');const n="/databases/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new b('Missing required parameter: "transactionId"');const o="/databases/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listDocuments(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.collectionId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');const u="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');if(typeof c>"u")throw new b('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents".replace("{databaseId}",n).replace("{collectionId}",a),h={};typeof o<"u"&&(h.documentId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("post",p,g,h)}getDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');const u="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');if(typeof c>"u")throw new b('Missing required parameter: "data"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("put",p,g,h)}updateDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');const d="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("patch",p,g,h)}deleteDocument(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');const l="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');if(typeof c>"u")throw new b('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/decrement".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}incrementDocumentAttribute(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,collectionId:r[0],documentId:r[1],attribute:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.collectionId,o=s.documentId,c=s.attribute,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "collectionId"');if(typeof o>"u")throw new b('Missing required parameter: "documentId"');if(typeof c>"u")throw new b('Missing required parameter: "attribute"');const h="/databases/{databaseId}/collections/{collectionId}/documents/{documentId}/{attribute}/increment".replace("{databaseId}",n).replace("{collectionId}",a).replace("{documentId}",o).replace("{attribute}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}}class bp{constructor(e){this.client=e}listExecutions(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,queries:r[0],total:r[1]};const n=s.functionId,a=s.queries,o=s.total;if(typeof n>"u")throw new b('Missing required parameter: "functionId"');const c="/functions/{functionId}/executions".replace("{functionId}",n),l={};typeof a<"u"&&(l.queries=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}createExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,body:r[0],async:r[1],xpath:r[2],method:r[3],headers:r[4],scheduledAt:r[5]};const n=s.functionId,a=s.body,o=s.async,c=s.xpath,l=s.method,u=s.headers,d=s.scheduledAt;if(typeof n>"u")throw new b('Missing required parameter: "functionId"');const h="/functions/{functionId}/executions".replace("{functionId}",n),p={};typeof a<"u"&&(p.body=a),typeof o<"u"&&(p.async=o),typeof c<"u"&&(p.path=c),typeof l<"u"&&(p.method=l),typeof u<"u"&&(p.headers=u),typeof d<"u"&&(p.scheduledAt=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("post",g,w,p)}getExecution(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={functionId:e,executionId:r[0]};const n=s.functionId,a=s.executionId;if(typeof n>"u")throw new b('Missing required parameter: "functionId"');if(typeof a>"u")throw new b('Missing required parameter: "executionId"');const o="/functions/{functionId}/executions/{executionId}".replace("{functionId}",n).replace("{executionId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}}class Ep{constructor(e){this.client=e}listTransactions(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={queries:e};const s=r.queries,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.queries=s);const o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}createTransaction(e){let r;!e||e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={ttl:e};const s=r.ttl,n="/tablesdb/transactions",a={};typeof s<"u"&&(a.ttl=s);const o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("post",o,c,a)}getTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new b('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateTransaction(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,commit:r[0],rollback:r[1]};const n=s.transactionId,a=s.commit,o=s.rollback;if(typeof n>"u")throw new b('Missing required parameter: "transactionId"');const c="/tablesdb/transactions/{transactionId}".replace("{transactionId}",n),l={};typeof a<"u"&&(l.commit=a),typeof o<"u"&&(l.rollback=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteTransaction(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={transactionId:e};const s=r.transactionId;if(typeof s>"u")throw new b('Missing required parameter: "transactionId"');const n="/tablesdb/transactions/{transactionId}".replace("{transactionId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}createOperations(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={transactionId:e,operations:r[0]};const n=s.transactionId,a=s.operations;if(typeof n>"u")throw new b('Missing required parameter: "transactionId"');const o="/tablesdb/transactions/{transactionId}/operations".replace("{transactionId}",n),c={};typeof a<"u"&&(c.operations=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("post",l,u,c)}listRows(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],queries:r[1],transactionId:r[2],total:r[3]};const n=s.databaseId,a=s.tableId,o=s.queries,c=s.transactionId,l=s.total;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),d={};typeof o<"u"&&(d.queries=o),typeof c<"u"&&(d.transactionId=c),typeof l<"u"&&(d.total=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}createRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');if(typeof c>"u")throw new b('Missing required parameter: "data"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows".replace("{databaseId}",n).replace("{tableId}",a),h={};typeof o<"u"&&(h.rowId=o),typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("post",p,g,h)}getRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],queries:r[2],transactionId:r[3]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.queries,l=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');const u="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),d={};typeof c<"u"&&(d.queries=c),typeof l<"u"&&(d.transactionId=l);const h=new URL(this.client.config.endpoint+u),p={};return this.client.call("get",h,p,d)}upsertRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("put",p,g,h)}updateRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],data:r[2],permissions:r[3],transactionId:r[4]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.data,l=s.permissions,u=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');const d="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),h={};typeof c<"u"&&(h.data=c),typeof l<"u"&&(h.permissions=l),typeof u<"u"&&(h.transactionId=u);const p=new URL(this.client.config.endpoint+d),g={"content-type":"application/json"};return this.client.call("patch",p,g,h)}deleteRow(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],transactionId:r[2]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');const l="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o),u={};typeof c<"u"&&(u.transactionId=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("delete",d,h,u)}decrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],min:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.min,d=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');if(typeof c>"u")throw new b('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/decrement".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.min=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}incrementRowColumn(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={databaseId:e,tableId:r[0],rowId:r[1],column:r[2],value:r[3],max:r[4],transactionId:r[5]};const n=s.databaseId,a=s.tableId,o=s.rowId,c=s.column,l=s.value,u=s.max,d=s.transactionId;if(typeof n>"u")throw new b('Missing required parameter: "databaseId"');if(typeof a>"u")throw new b('Missing required parameter: "tableId"');if(typeof o>"u")throw new b('Missing required parameter: "rowId"');if(typeof c>"u")throw new b('Missing required parameter: "column"');const h="/tablesdb/{databaseId}/tables/{tableId}/rows/{rowId}/{column}/increment".replace("{databaseId}",n).replace("{tableId}",a).replace("{rowId}",o).replace("{column}",c),p={};typeof l<"u"&&(p.value=l),typeof u<"u"&&(p.max=u),typeof d<"u"&&(p.transactionId=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("patch",g,w,p)}}class Sp{constructor(e){this.client=e}list(e,...r){let s;!e||e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={queries:e,search:r[0],total:r[1]};const n=s.queries,a=s.search,o=s.total,c="/teams",l={};typeof n<"u"&&(l.queries=n),typeof a<"u"&&(l.search=a),typeof o<"u"&&(l.total=o);const u=new URL(this.client.config.endpoint+c),d={};return this.client.call("get",u,d,l)}create(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0],roles:r[1]};const n=s.teamId,a=s.name,o=s.roles;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "name"');const c="/teams",l={};typeof n<"u"&&(l.teamId=n),typeof a<"u"&&(l.name=a),typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("post",u,d,l)}get(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new b('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updateName(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,name:r[0]};const n=s.teamId,a=s.name;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "name"');const o="/teams/{teamId}".replace("{teamId}",n),c={};typeof a<"u"&&(c.name=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}delete(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new b('Missing required parameter: "teamId"');const n="/teams/{teamId}".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={"content-type":"application/json"};return this.client.call("delete",o,c,a)}listMemberships(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,queries:r[0],search:r[1],total:r[2]};const n=s.teamId,a=s.queries,o=s.search,c=s.total;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');const l="/teams/{teamId}/memberships".replace("{teamId}",n),u={};typeof a<"u"&&(u.queries=a),typeof o<"u"&&(u.search=o),typeof c<"u"&&(u.total=c);const d=new URL(this.client.config.endpoint+l),h={};return this.client.call("get",d,h,u)}createMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,roles:r[0],email:r[1],userId:r[2],phone:r[3],url:r[4],name:r[5]};const n=s.teamId,a=s.roles,o=s.email,c=s.userId,l=s.phone,u=s.url,d=s.name;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "roles"');const h="/teams/{teamId}/memberships".replace("{teamId}",n),p={};typeof o<"u"&&(p.email=o),typeof c<"u"&&(p.userId=c),typeof l<"u"&&(p.phone=l),typeof a<"u"&&(p.roles=a),typeof u<"u"&&(p.url=u),typeof d<"u"&&(p.name=d);const g=new URL(this.client.config.endpoint+h),w={"content-type":"application/json"};return this.client.call("post",g,w,p)}getMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={};return this.client.call("get",l,u,c)}updateMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],roles:r[1]};const n=s.teamId,a=s.membershipId,o=s.roles;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "membershipId"');if(typeof o>"u")throw new b('Missing required parameter: "roles"');const c="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),l={};typeof o<"u"&&(l.roles=o);const u=new URL(this.client.config.endpoint+c),d={"content-type":"application/json"};return this.client.call("patch",u,d,l)}deleteMembership(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0]};const n=s.teamId,a=s.membershipId;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "membershipId"');const o="/teams/{teamId}/memberships/{membershipId}".replace("{teamId}",n).replace("{membershipId}",a),c={},l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("delete",l,u,c)}updateMembershipStatus(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,membershipId:r[0],userId:r[1],secret:r[2]};const n=s.teamId,a=s.membershipId,o=s.userId,c=s.secret;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "membershipId"');if(typeof o>"u")throw new b('Missing required parameter: "userId"');if(typeof c>"u")throw new b('Missing required parameter: "secret"');const l="/teams/{teamId}/memberships/{membershipId}/status".replace("{teamId}",n).replace("{membershipId}",a),u={};typeof o<"u"&&(u.userId=o),typeof c<"u"&&(u.secret=c);const d=new URL(this.client.config.endpoint+l),h={"content-type":"application/json"};return this.client.call("patch",d,h,u)}getPrefs(e){let r;e&&typeof e=="object"&&!Array.isArray(e)?r=e||{}:r={teamId:e};const s=r.teamId;if(typeof s>"u")throw new b('Missing required parameter: "teamId"');const n="/teams/{teamId}/prefs".replace("{teamId}",s),a={},o=new URL(this.client.config.endpoint+n),c={};return this.client.call("get",o,c,a)}updatePrefs(e,...r){let s;e&&typeof e=="object"&&!Array.isArray(e)?s=e||{}:s={teamId:e,prefs:r[0]};const n=s.teamId,a=s.prefs;if(typeof n>"u")throw new b('Missing required parameter: "teamId"');if(typeof a>"u")throw new b('Missing required parameter: "prefs"');const o="/teams/{teamId}/prefs".replace("{teamId}",n),c={};typeof a<"u"&&(c.prefs=a);const l=new URL(this.client.config.endpoint+o),u={"content-type":"application/json"};return this.client.call("put",l,u,c)}}var Tc;(function(t){t[t.NORMAL_CLOSURE=1e3]="NORMAL_CLOSURE",t[t.POLICY_VIOLATION=1008]="POLICY_VIOLATION",t[t.UNKNOWN_ERROR=-1]="UNKNOWN_ERROR"})(Tc||(Tc={}));class te{}te.read=t=>`read("${t}")`;te.write=t=>`write("${t}")`;te.create=t=>`create("${t}")`;te.update=t=>`update("${t}")`;te.delete=t=>`delete("${t}")`;class ae{static any(){return"any"}static user(e,r=""){return r===""?`user:${e}`:`user:${e}/${r}`}static users(e=""){return e===""?"users":`users/${e}`}static guests(){return"guests"}static team(e,r=""){return r===""?`team:${e}`:`team:${e}/${r}`}static member(e){return`member:${e}`}static label(e){return`label:${e}`}}var Du,Mu;class pt{static custom(e){return e}static unique(e=7){const r=yp(pt,Du,"m",Mu).call(pt);let s="";for(let n=0;n<e;n++){const a=Math.floor(Math.random()*16).toString(16);s+=a}return r+s}}Du=pt,Mu=function(){const e=new Date,r=Math.floor(e.getTime()/1e3),s=e.getMilliseconds();return r.toString(16)+s.toString(16).padStart(5,"0")};var Nc;(function(t){t.Equal="equal",t.NotEqual="notEqual",t.GreaterThan="greaterThan",t.GreaterThanEqual="greaterThanEqual",t.LessThan="lessThan",t.LessThanEqual="lessThanEqual",t.Contains="contains",t.IsNull="isNull",t.IsNotNull="isNotNull"})(Nc||(Nc={}));var Lc;(function(t){t.Totp="totp"})(Lc||(Lc={}));var jc;(function(t){t.Email="email",t.Phone="phone",t.Totp="totp",t.Recoverycode="recoverycode"})(jc||(jc={}));var qc;(function(t){t.Amazon="amazon",t.Apple="apple",t.Auth0="auth0",t.Authentik="authentik",t.Autodesk="autodesk",t.Bitbucket="bitbucket",t.Bitly="bitly",t.Box="box",t.Dailymotion="dailymotion",t.Discord="discord",t.Disqus="disqus",t.Dropbox="dropbox",t.Etsy="etsy",t.Facebook="facebook",t.Figma="figma",t.Github="github",t.Gitlab="gitlab",t.Google="google",t.Linkedin="linkedin",t.Microsoft="microsoft",t.Notion="notion",t.Oidc="oidc",t.Okta="okta",t.Paypal="paypal",t.PaypalSandbox="paypalSandbox",t.Podio="podio",t.Salesforce="salesforce",t.Slack="slack",t.Spotify="spotify",t.Stripe="stripe",t.Tradeshift="tradeshift",t.TradeshiftBox="tradeshiftBox",t.Twitch="twitch",t.Wordpress="wordpress",t.Yahoo="yahoo",t.Yammer="yammer",t.Yandex="yandex",t.Zoho="zoho",t.Zoom="zoom",t.Mock="mock"})(qc||(qc={}));var Oc;(function(t){t.AvantBrowser="aa",t.AndroidWebViewBeta="an",t.GoogleChrome="ch",t.GoogleChromeIOS="ci",t.GoogleChromeMobile="cm",t.Chromium="cr",t.MozillaFirefox="ff",t.Safari="sf",t.MobileSafari="mf",t.MicrosoftEdge="ps",t.MicrosoftEdgeIOS="oi",t.OperaMini="om",t.Opera="op",t.OperaNext="on"})(Oc||(Oc={}));var Uc;(function(t){t.AmericanExpress="amex",t.Argencard="argencard",t.Cabal="cabal",t.Cencosud="cencosud",t.DinersClub="diners",t.Discover="discover",t.Elo="elo",t.Hipercard="hipercard",t.JCB="jcb",t.Mastercard="mastercard",t.Naranja="naranja",t.TarjetaShopping="targeta-shopping",t.UnionPay="unionpay",t.Visa="visa",t.MIR="mir",t.Maestro="maestro",t.Rupay="rupay"})(Uc||(Uc={}));var Bc;(function(t){t.Afghanistan="af",t.Angola="ao",t.Albania="al",t.Andorra="ad",t.UnitedArabEmirates="ae",t.Argentina="ar",t.Armenia="am",t.AntiguaAndBarbuda="ag",t.Australia="au",t.Austria="at",t.Azerbaijan="az",t.Burundi="bi",t.Belgium="be",t.Benin="bj",t.BurkinaFaso="bf",t.Bangladesh="bd",t.Bulgaria="bg",t.Bahrain="bh",t.Bahamas="bs",t.BosniaAndHerzegovina="ba",t.Belarus="by",t.Belize="bz",t.Bolivia="bo",t.Brazil="br",t.Barbados="bb",t.BruneiDarussalam="bn",t.Bhutan="bt",t.Botswana="bw",t.CentralAfricanRepublic="cf",t.Canada="ca",t.Switzerland="ch",t.Chile="cl",t.China="cn",t.CoteDIvoire="ci",t.Cameroon="cm",t.DemocraticRepublicOfTheCongo="cd",t.RepublicOfTheCongo="cg",t.Colombia="co",t.Comoros="km",t.CapeVerde="cv",t.CostaRica="cr",t.Cuba="cu",t.Cyprus="cy",t.CzechRepublic="cz",t.Germany="de",t.Djibouti="dj",t.Dominica="dm",t.Denmark="dk",t.DominicanRepublic="do",t.Algeria="dz",t.Ecuador="ec",t.Egypt="eg",t.Eritrea="er",t.Spain="es",t.Estonia="ee",t.Ethiopia="et",t.Finland="fi",t.Fiji="fj",t.France="fr",t.MicronesiaFederatedStatesOf="fm",t.Gabon="ga",t.UnitedKingdom="gb",t.Georgia="ge",t.Ghana="gh",t.Guinea="gn",t.Gambia="gm",t.GuineaBissau="gw",t.EquatorialGuinea="gq",t.Greece="gr",t.Grenada="gd",t.Guatemala="gt",t.Guyana="gy",t.Honduras="hn",t.Croatia="hr",t.Haiti="ht",t.Hungary="hu",t.Indonesia="id",t.India="in",t.Ireland="ie",t.IranIslamicRepublicOf="ir",t.Iraq="iq",t.Iceland="is",t.Israel="il",t.Italy="it",t.Jamaica="jm",t.Jordan="jo",t.Japan="jp",t.Kazakhstan="kz",t.Kenya="ke",t.Kyrgyzstan="kg",t.Cambodia="kh",t.Kiribati="ki",t.SaintKittsAndNevis="kn",t.SouthKorea="kr",t.Kuwait="kw",t.LaoPeopleSDemocraticRepublic="la",t.Lebanon="lb",t.Liberia="lr",t.Libya="ly",t.SaintLucia="lc",t.Liechtenstein="li",t.SriLanka="lk",t.Lesotho="ls",t.Lithuania="lt",t.Luxembourg="lu",t.Latvia="lv",t.Morocco="ma",t.Monaco="mc",t.Moldova="md",t.Madagascar="mg",t.Maldives="mv",t.Mexico="mx",t.MarshallIslands="mh",t.NorthMacedonia="mk",t.Mali="ml",t.Malta="mt",t.Myanmar="mm",t.Montenegro="me",t.Mongolia="mn",t.Mozambique="mz",t.Mauritania="mr",t.Mauritius="mu",t.Malawi="mw",t.Malaysia="my",t.Namibia="na",t.Niger="ne",t.Nigeria="ng",t.Nicaragua="ni",t.Netherlands="nl",t.Norway="no",t.Nepal="np",t.Nauru="nr",t.NewZealand="nz",t.Oman="om",t.Pakistan="pk",t.Panama="pa",t.Peru="pe",t.Philippines="ph",t.Palau="pw",t.PapuaNewGuinea="pg",t.Poland="pl",t.FrenchPolynesia="pf",t.NorthKorea="kp",t.Portugal="pt",t.Paraguay="py",t.Qatar="qa",t.Romania="ro",t.Russia="ru",t.Rwanda="rw",t.SaudiArabia="sa",t.Sudan="sd",t.Senegal="sn",t.Singapore="sg",t.SolomonIslands="sb",t.SierraLeone="sl",t.ElSalvador="sv",t.SanMarino="sm",t.Somalia="so",t.Serbia="rs",t.SouthSudan="ss",t.SaoTomeAndPrincipe="st",t.Suriname="sr",t.Slovakia="sk",t.Slovenia="si",t.Sweden="se",t.Eswatini="sz",t.Seychelles="sc",t.Syria="sy",t.Chad="td",t.Togo="tg",t.Thailand="th",t.Tajikistan="tj",t.Turkmenistan="tm",t.TimorLeste="tl",t.Tonga="to",t.TrinidadAndTobago="tt",t.Tunisia="tn",t.Turkey="tr",t.Tuvalu="tv",t.Tanzania="tz",t.Uganda="ug",t.Ukraine="ua",t.Uruguay="uy",t.UnitedStates="us",t.Uzbekistan="uz",t.VaticanCity="va",t.SaintVincentAndTheGrenadines="vc",t.Venezuela="ve",t.Vietnam="vn",t.Vanuatu="vu",t.Samoa="ws",t.Yemen="ye",t.SouthAfrica="za",t.Zambia="zm",t.Zimbabwe="zw"})(Bc||(Bc={}));var xc;(function(t){t.Light="light",t.Dark="dark"})(xc||(xc={}));var Hc;(function(t){t.AfricaAbidjan="africa/abidjan",t.AfricaAccra="africa/accra",t.AfricaAddisAbaba="africa/addis_ababa",t.AfricaAlgiers="africa/algiers",t.AfricaAsmara="africa/asmara",t.AfricaBamako="africa/bamako",t.AfricaBangui="africa/bangui",t.AfricaBanjul="africa/banjul",t.AfricaBissau="africa/bissau",t.AfricaBlantyre="africa/blantyre",t.AfricaBrazzaville="africa/brazzaville",t.AfricaBujumbura="africa/bujumbura",t.AfricaCairo="africa/cairo",t.AfricaCasablanca="africa/casablanca",t.AfricaCeuta="africa/ceuta",t.AfricaConakry="africa/conakry",t.AfricaDakar="africa/dakar",t.AfricaDarEsSalaam="africa/dar_es_salaam",t.AfricaDjibouti="africa/djibouti",t.AfricaDouala="africa/douala",t.AfricaElAaiun="africa/el_aaiun",t.AfricaFreetown="africa/freetown",t.AfricaGaborone="africa/gaborone",t.AfricaHarare="africa/harare",t.AfricaJohannesburg="africa/johannesburg",t.AfricaJuba="africa/juba",t.AfricaKampala="africa/kampala",t.AfricaKhartoum="africa/khartoum",t.AfricaKigali="africa/kigali",t.AfricaKinshasa="africa/kinshasa",t.AfricaLagos="africa/lagos",t.AfricaLibreville="africa/libreville",t.AfricaLome="africa/lome",t.AfricaLuanda="africa/luanda",t.AfricaLubumbashi="africa/lubumbashi",t.AfricaLusaka="africa/lusaka",t.AfricaMalabo="africa/malabo",t.AfricaMaputo="africa/maputo",t.AfricaMaseru="africa/maseru",t.AfricaMbabane="africa/mbabane",t.AfricaMogadishu="africa/mogadishu",t.AfricaMonrovia="africa/monrovia",t.AfricaNairobi="africa/nairobi",t.AfricaNdjamena="africa/ndjamena",t.AfricaNiamey="africa/niamey",t.AfricaNouakchott="africa/nouakchott",t.AfricaOuagadougou="africa/ouagadougou",t.AfricaPortonovo="africa/porto-novo",t.AfricaSaoTome="africa/sao_tome",t.AfricaTripoli="africa/tripoli",t.AfricaTunis="africa/tunis",t.AfricaWindhoek="africa/windhoek",t.AmericaAdak="america/adak",t.AmericaAnchorage="america/anchorage",t.AmericaAnguilla="america/anguilla",t.AmericaAntigua="america/antigua",t.AmericaAraguaina="america/araguaina",t.AmericaArgentinaBuenosAires="america/argentina/buenos_aires",t.AmericaArgentinaCatamarca="america/argentina/catamarca",t.AmericaArgentinaCordoba="america/argentina/cordoba",t.AmericaArgentinaJujuy="america/argentina/jujuy",t.AmericaArgentinaLaRioja="america/argentina/la_rioja",t.AmericaArgentinaMendoza="america/argentina/mendoza",t.AmericaArgentinaRioGallegos="america/argentina/rio_gallegos",t.AmericaArgentinaSalta="america/argentina/salta",t.AmericaArgentinaSanJuan="america/argentina/san_juan",t.AmericaArgentinaSanLuis="america/argentina/san_luis",t.AmericaArgentinaTucuman="america/argentina/tucuman",t.AmericaArgentinaUshuaia="america/argentina/ushuaia",t.AmericaAruba="america/aruba",t.AmericaAsuncion="america/asuncion",t.AmericaAtikokan="america/atikokan",t.AmericaBahia="america/bahia",t.AmericaBahiaBanderas="america/bahia_banderas",t.AmericaBarbados="america/barbados",t.AmericaBelem="america/belem",t.AmericaBelize="america/belize",t.AmericaBlancsablon="america/blanc-sablon",t.AmericaBoaVista="america/boa_vista",t.AmericaBogota="america/bogota",t.AmericaBoise="america/boise",t.AmericaCambridgeBay="america/cambridge_bay",t.AmericaCampoGrande="america/campo_grande",t.AmericaCancun="america/cancun",t.AmericaCaracas="america/caracas",t.AmericaCayenne="america/cayenne",t.AmericaCayman="america/cayman",t.AmericaChicago="america/chicago",t.AmericaChihuahua="america/chihuahua",t.AmericaCiudadJuarez="america/ciudad_juarez",t.AmericaCostaRica="america/costa_rica",t.AmericaCoyhaique="america/coyhaique",t.AmericaCreston="america/creston",t.AmericaCuiaba="america/cuiaba",t.AmericaCuracao="america/curacao",t.AmericaDanmarkshavn="america/danmarkshavn",t.AmericaDawson="america/dawson",t.AmericaDawsonCreek="america/dawson_creek",t.AmericaDenver="america/denver",t.AmericaDetroit="america/detroit",t.AmericaDominica="america/dominica",t.AmericaEdmonton="america/edmonton",t.AmericaEirunepe="america/eirunepe",t.AmericaElSalvador="america/el_salvador",t.AmericaFortNelson="america/fort_nelson",t.AmericaFortaleza="america/fortaleza",t.AmericaGlaceBay="america/glace_bay",t.AmericaGooseBay="america/goose_bay",t.AmericaGrandTurk="america/grand_turk",t.AmericaGrenada="america/grenada",t.AmericaGuadeloupe="america/guadeloupe",t.AmericaGuatemala="america/guatemala",t.AmericaGuayaquil="america/guayaquil",t.AmericaGuyana="america/guyana",t.AmericaHalifax="america/halifax",t.AmericaHavana="america/havana",t.AmericaHermosillo="america/hermosillo",t.AmericaIndianaIndianapolis="america/indiana/indianapolis",t.AmericaIndianaKnox="america/indiana/knox",t.AmericaIndianaMarengo="america/indiana/marengo",t.AmericaIndianaPetersburg="america/indiana/petersburg",t.AmericaIndianaTellCity="america/indiana/tell_city",t.AmericaIndianaVevay="america/indiana/vevay",t.AmericaIndianaVincennes="america/indiana/vincennes",t.AmericaIndianaWinamac="america/indiana/winamac",t.AmericaInuvik="america/inuvik",t.AmericaIqaluit="america/iqaluit",t.AmericaJamaica="america/jamaica",t.AmericaJuneau="america/juneau",t.AmericaKentuckyLouisville="america/kentucky/louisville",t.AmericaKentuckyMonticello="america/kentucky/monticello",t.AmericaKralendijk="america/kralendijk",t.AmericaLaPaz="america/la_paz",t.AmericaLima="america/lima",t.AmericaLosAngeles="america/los_angeles",t.AmericaLowerPrinces="america/lower_princes",t.AmericaMaceio="america/maceio",t.AmericaManagua="america/managua",t.AmericaManaus="america/manaus",t.AmericaMarigot="america/marigot",t.AmericaMartinique="america/martinique",t.AmericaMatamoros="america/matamoros",t.AmericaMazatlan="america/mazatlan",t.AmericaMenominee="america/menominee",t.AmericaMerida="america/merida",t.AmericaMetlakatla="america/metlakatla",t.AmericaMexicoCity="america/mexico_city",t.AmericaMiquelon="america/miquelon",t.AmericaMoncton="america/moncton",t.AmericaMonterrey="america/monterrey",t.AmericaMontevideo="america/montevideo",t.AmericaMontserrat="america/montserrat",t.AmericaNassau="america/nassau",t.AmericaNewYork="america/new_york",t.AmericaNome="america/nome",t.AmericaNoronha="america/noronha",t.AmericaNorthDakotaBeulah="america/north_dakota/beulah",t.AmericaNorthDakotaCenter="america/north_dakota/center",t.AmericaNorthDakotaNewSalem="america/north_dakota/new_salem",t.AmericaNuuk="america/nuuk",t.AmericaOjinaga="america/ojinaga",t.AmericaPanama="america/panama",t.AmericaParamaribo="america/paramaribo",t.AmericaPhoenix="america/phoenix",t.AmericaPortauprince="america/port-au-prince",t.AmericaPortOfSpain="america/port_of_spain",t.AmericaPortoVelho="america/porto_velho",t.AmericaPuertoRico="america/puerto_rico",t.AmericaPuntaArenas="america/punta_arenas",t.AmericaRankinInlet="america/rankin_inlet",t.AmericaRecife="america/recife",t.AmericaRegina="america/regina",t.AmericaResolute="america/resolute",t.AmericaRioBranco="america/rio_branco",t.AmericaSantarem="america/santarem",t.AmericaSantiago="america/santiago",t.AmericaSantoDomingo="america/santo_domingo",t.AmericaSaoPaulo="america/sao_paulo",t.AmericaScoresbysund="america/scoresbysund",t.AmericaSitka="america/sitka",t.AmericaStBarthelemy="america/st_barthelemy",t.AmericaStJohns="america/st_johns",t.AmericaStKitts="america/st_kitts",t.AmericaStLucia="america/st_lucia",t.AmericaStThomas="america/st_thomas",t.AmericaStVincent="america/st_vincent",t.AmericaSwiftCurrent="america/swift_current",t.AmericaTegucigalpa="america/tegucigalpa",t.AmericaThule="america/thule",t.AmericaTijuana="america/tijuana",t.AmericaToronto="america/toronto",t.AmericaTortola="america/tortola",t.AmericaVancouver="america/vancouver",t.AmericaWhitehorse="america/whitehorse",t.AmericaWinnipeg="america/winnipeg",t.AmericaYakutat="america/yakutat",t.AntarcticaCasey="antarctica/casey",t.AntarcticaDavis="antarctica/davis",t.AntarcticaDumontdurville="antarctica/dumontdurville",t.AntarcticaMacquarie="antarctica/macquarie",t.AntarcticaMawson="antarctica/mawson",t.AntarcticaMcmurdo="antarctica/mcmurdo",t.AntarcticaPalmer="antarctica/palmer",t.AntarcticaRothera="antarctica/rothera",t.AntarcticaSyowa="antarctica/syowa",t.AntarcticaTroll="antarctica/troll",t.AntarcticaVostok="antarctica/vostok",t.ArcticLongyearbyen="arctic/longyearbyen",t.AsiaAden="asia/aden",t.AsiaAlmaty="asia/almaty",t.AsiaAmman="asia/amman",t.AsiaAnadyr="asia/anadyr",t.AsiaAqtau="asia/aqtau",t.AsiaAqtobe="asia/aqtobe",t.AsiaAshgabat="asia/ashgabat",t.AsiaAtyrau="asia/atyrau",t.AsiaBaghdad="asia/baghdad",t.AsiaBahrain="asia/bahrain",t.AsiaBaku="asia/baku",t.AsiaBangkok="asia/bangkok",t.AsiaBarnaul="asia/barnaul",t.AsiaBeirut="asia/beirut",t.AsiaBishkek="asia/bishkek",t.AsiaBrunei="asia/brunei",t.AsiaChita="asia/chita",t.AsiaColombo="asia/colombo",t.AsiaDamascus="asia/damascus",t.AsiaDhaka="asia/dhaka",t.AsiaDili="asia/dili",t.AsiaDubai="asia/dubai",t.AsiaDushanbe="asia/dushanbe",t.AsiaFamagusta="asia/famagusta",t.AsiaGaza="asia/gaza",t.AsiaHebron="asia/hebron",t.AsiaHoChiMinh="asia/ho_chi_minh",t.AsiaHongKong="asia/hong_kong",t.AsiaHovd="asia/hovd",t.AsiaIrkutsk="asia/irkutsk",t.AsiaJakarta="asia/jakarta",t.AsiaJayapura="asia/jayapura",t.AsiaJerusalem="asia/jerusalem",t.AsiaKabul="asia/kabul",t.AsiaKamchatka="asia/kamchatka",t.AsiaKarachi="asia/karachi",t.AsiaKathmandu="asia/kathmandu",t.AsiaKhandyga="asia/khandyga",t.AsiaKolkata="asia/kolkata",t.AsiaKrasnoyarsk="asia/krasnoyarsk",t.AsiaKualaLumpur="asia/kuala_lumpur",t.AsiaKuching="asia/kuching",t.AsiaKuwait="asia/kuwait",t.AsiaMacau="asia/macau",t.AsiaMagadan="asia/magadan",t.AsiaMakassar="asia/makassar",t.AsiaManila="asia/manila",t.AsiaMuscat="asia/muscat",t.AsiaNicosia="asia/nicosia",t.AsiaNovokuznetsk="asia/novokuznetsk",t.AsiaNovosibirsk="asia/novosibirsk",t.AsiaOmsk="asia/omsk",t.AsiaOral="asia/oral",t.AsiaPhnomPenh="asia/phnom_penh",t.AsiaPontianak="asia/pontianak",t.AsiaPyongyang="asia/pyongyang",t.AsiaQatar="asia/qatar",t.AsiaQostanay="asia/qostanay",t.AsiaQyzylorda="asia/qyzylorda",t.AsiaRiyadh="asia/riyadh",t.AsiaSakhalin="asia/sakhalin",t.AsiaSamarkand="asia/samarkand",t.AsiaSeoul="asia/seoul",t.AsiaShanghai="asia/shanghai",t.AsiaSingapore="asia/singapore",t.AsiaSrednekolymsk="asia/srednekolymsk",t.AsiaTaipei="asia/taipei",t.AsiaTashkent="asia/tashkent",t.AsiaTbilisi="asia/tbilisi",t.AsiaTehran="asia/tehran",t.AsiaThimphu="asia/thimphu",t.AsiaTokyo="asia/tokyo",t.AsiaTomsk="asia/tomsk",t.AsiaUlaanbaatar="asia/ulaanbaatar",t.AsiaUrumqi="asia/urumqi",t.AsiaUstnera="asia/ust-nera",t.AsiaVientiane="asia/vientiane",t.AsiaVladivostok="asia/vladivostok",t.AsiaYakutsk="asia/yakutsk",t.AsiaYangon="asia/yangon",t.AsiaYekaterinburg="asia/yekaterinburg",t.AsiaYerevan="asia/yerevan",t.AtlanticAzores="atlantic/azores",t.AtlanticBermuda="atlantic/bermuda",t.AtlanticCanary="atlantic/canary",t.AtlanticCapeVerde="atlantic/cape_verde",t.AtlanticFaroe="atlantic/faroe",t.AtlanticMadeira="atlantic/madeira",t.AtlanticReykjavik="atlantic/reykjavik",t.AtlanticSouthGeorgia="atlantic/south_georgia",t.AtlanticStHelena="atlantic/st_helena",t.AtlanticStanley="atlantic/stanley",t.AustraliaAdelaide="australia/adelaide",t.AustraliaBrisbane="australia/brisbane",t.AustraliaBrokenHill="australia/broken_hill",t.AustraliaDarwin="australia/darwin",t.AustraliaEucla="australia/eucla",t.AustraliaHobart="australia/hobart",t.AustraliaLindeman="australia/lindeman",t.AustraliaLordHowe="australia/lord_howe",t.AustraliaMelbourne="australia/melbourne",t.AustraliaPerth="australia/perth",t.AustraliaSydney="australia/sydney",t.EuropeAmsterdam="europe/amsterdam",t.EuropeAndorra="europe/andorra",t.EuropeAstrakhan="europe/astrakhan",t.EuropeAthens="europe/athens",t.EuropeBelgrade="europe/belgrade",t.EuropeBerlin="europe/berlin",t.EuropeBratislava="europe/bratislava",t.EuropeBrussels="europe/brussels",t.EuropeBucharest="europe/bucharest",t.EuropeBudapest="europe/budapest",t.EuropeBusingen="europe/busingen",t.EuropeChisinau="europe/chisinau",t.EuropeCopenhagen="europe/copenhagen",t.EuropeDublin="europe/dublin",t.EuropeGibraltar="europe/gibraltar",t.EuropeGuernsey="europe/guernsey",t.EuropeHelsinki="europe/helsinki",t.EuropeIsleOfMan="europe/isle_of_man",t.EuropeIstanbul="europe/istanbul",t.EuropeJersey="europe/jersey",t.EuropeKaliningrad="europe/kaliningrad",t.EuropeKirov="europe/kirov",t.EuropeKyiv="europe/kyiv",t.EuropeLisbon="europe/lisbon",t.EuropeLjubljana="europe/ljubljana",t.EuropeLondon="europe/london",t.EuropeLuxembourg="europe/luxembourg",t.EuropeMadrid="europe/madrid",t.EuropeMalta="europe/malta",t.EuropeMariehamn="europe/mariehamn",t.EuropeMinsk="europe/minsk",t.EuropeMonaco="europe/monaco",t.EuropeMoscow="europe/moscow",t.EuropeOslo="europe/oslo",t.EuropeParis="europe/paris",t.EuropePodgorica="europe/podgorica",t.EuropePrague="europe/prague",t.EuropeRiga="europe/riga",t.EuropeRome="europe/rome",t.EuropeSamara="europe/samara",t.EuropeSanMarino="europe/san_marino",t.EuropeSarajevo="europe/sarajevo",t.EuropeSaratov="europe/saratov",t.EuropeSimferopol="europe/simferopol",t.EuropeSkopje="europe/skopje",t.EuropeSofia="europe/sofia",t.EuropeStockholm="europe/stockholm",t.EuropeTallinn="europe/tallinn",t.EuropeTirane="europe/tirane",t.EuropeUlyanovsk="europe/ulyanovsk",t.EuropeVaduz="europe/vaduz",t.EuropeVatican="europe/vatican",t.EuropeVienna="europe/vienna",t.EuropeVilnius="europe/vilnius",t.EuropeVolgograd="europe/volgograd",t.EuropeWarsaw="europe/warsaw",t.EuropeZagreb="europe/zagreb",t.EuropeZurich="europe/zurich",t.IndianAntananarivo="indian/antananarivo",t.IndianChagos="indian/chagos",t.IndianChristmas="indian/christmas",t.IndianCocos="indian/cocos",t.IndianComoro="indian/comoro",t.IndianKerguelen="indian/kerguelen",t.IndianMahe="indian/mahe",t.IndianMaldives="indian/maldives",t.IndianMauritius="indian/mauritius",t.IndianMayotte="indian/mayotte",t.IndianReunion="indian/reunion",t.PacificApia="pacific/apia",t.PacificAuckland="pacific/auckland",t.PacificBougainville="pacific/bougainville",t.PacificChatham="pacific/chatham",t.PacificChuuk="pacific/chuuk",t.PacificEaster="pacific/easter",t.PacificEfate="pacific/efate",t.PacificFakaofo="pacific/fakaofo",t.PacificFiji="pacific/fiji",t.PacificFunafuti="pacific/funafuti",t.PacificGalapagos="pacific/galapagos",t.PacificGambier="pacific/gambier",t.PacificGuadalcanal="pacific/guadalcanal",t.PacificGuam="pacific/guam",t.PacificHonolulu="pacific/honolulu",t.PacificKanton="pacific/kanton",t.PacificKiritimati="pacific/kiritimati",t.PacificKosrae="pacific/kosrae",t.PacificKwajalein="pacific/kwajalein",t.PacificMajuro="pacific/majuro",t.PacificMarquesas="pacific/marquesas",t.PacificMidway="pacific/midway",t.PacificNauru="pacific/nauru",t.PacificNiue="pacific/niue",t.PacificNorfolk="pacific/norfolk",t.PacificNoumea="pacific/noumea",t.PacificPagoPago="pacific/pago_pago",t.PacificPalau="pacific/palau",t.PacificPitcairn="pacific/pitcairn",t.PacificPohnpei="pacific/pohnpei",t.PacificPortMoresby="pacific/port_moresby",t.PacificRarotonga="pacific/rarotonga",t.PacificSaipan="pacific/saipan",t.PacificTahiti="pacific/tahiti",t.PacificTarawa="pacific/tarawa",t.PacificTongatapu="pacific/tongatapu",t.PacificWake="pacific/wake",t.PacificWallis="pacific/wallis",t.Utc="utc"})(Hc||(Hc={}));var Vc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(Vc||(Vc={}));var In;(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.PATCH="PATCH",t.DELETE="DELETE",t.OPTIONS="OPTIONS",t.HEAD="HEAD"})(In||(In={}));var Wc;(function(t){t.Center="center",t.Topleft="top-left",t.Top="top",t.Topright="top-right",t.Left="left",t.Right="right",t.Bottomleft="bottom-left",t.Bottom="bottom",t.Bottomright="bottom-right"})(Wc||(Wc={}));var Gc;(function(t){t.Jpg="jpg",t.Jpeg="jpeg",t.Png="png",t.Webp="webp",t.Heic="heic",t.Avif="avif",t.Gif="gif"})(Gc||(Gc={}));var Qc;(function(t){t.Http="http",t.Schedule="schedule",t.Event="event"})(Qc||(Qc={}));var Jc;(function(t){t.Waiting="waiting",t.Processing="processing",t.Completed="completed",t.Failed="failed",t.Scheduled="scheduled"})(Jc||(Jc={}));const rt={endpoint:"https://aw.oupla.net/v1",projectId:"696b7acb0037bde79e3f",databaseId:"689d15b10003a5a13636",functions:{cmsAuth:"68976500002eb5c6ee4f",accessRequest:"689cdea5001a4d74549d",batchUpdate:"68f00487000c624533a3",usersTeamsManager:"692cb2cd000cbb24549c",enkaData:"68f00487000c624533a3"},collections:{events:"main",ingredients:"ingredients",main:"main",purchases:"purchases",products:"products",kteams:"kteams",locks:"locks",user_notifications:"user_notifications",materiel_loan:"materiel_loan",teamdocs:"teamdocs"}};let Tr=null;async function D(){if(Tr)return Tr;console.log("[appwrite] Initialisation des instances Appwrite...");const t=new Xt().setEndpoint(rt.endpoint).setProject(rt.projectId),e=new wp(t),r=new vp(t),s=new Ep(t),n=new bp(t),a=new Sp(t);return Tr={client:t,account:e,databases:r,tables:s,functions:n,teams:a,config:rt},console.log("[appwrite] Instances initialisÃ©es avec succÃ¨s"),Tr}function $u(){console.log("[appwrite] Cache rÃ©initialisÃ©"),Tr=null}function gs(){return{APPWRITE_ENDPOINT:rt.endpoint,APPWRITE_PROJECT_ID:rt.projectId,APPWRITE_DATABASE_ID:rt.databaseId,APPWRITE_FUNCTION_ID:rt.functions.batchUpdate,ACCESS_REQUEST_FUNCTION_ID:rt.functions.accessRequest,MANAGE_RECIPE_FUNCTION_ID:rt.functions.enkaData,APPWRITE_CONFIG:rt}}async function Ip(t,e){Tr||(console.log("[appwrite] Subscribe appelÃ© avant initialisation, initialisation forcÃ©e..."),await D());const r=Array.isArray(t)?t:[t];return console.log("[appwrite] Subscribe aux channels:",r),Tr.client.subscribe(t,n=>{n.event==="client.connected"&&console.log("[appwrite] â WebSocket connectÃ© avec succÃ¨s"),e(n)})}function Ap(){return Tr!==null}function ut(){return rt.databaseId}function wr(t){return rt.collections[t]}function ku(t){return rt.functions[t]}const ky=Object.freeze(Object.defineProperty({__proto__:null,clearAppwriteCache:$u,getAppwriteConfig:gs,getAppwriteInstances:D,getCollectionId:wr,getDatabaseId:ut,getFunctionId:ku,isInitialized:Ap,subscribe:Ip},Symbol.toStringTag,{value:"Module"}));let _p=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");function Rp(t,e){const r=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),s=e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"";let n;if(s){const a=r.slice(0,16),o=s.slice(0,5);n=`${a}-${o}`}else n=r.slice(0,22);return`${n}_${_p(12).toLowerCase()}`}const Pp=new Eu(()=>window.scrollY,t=>zs(window,"scroll",t)),Dp={loading:0,success:2e3,info:3e3,warning:5e3,error:5e3},Mp=2;var ue,hs,Cu,oo;class $p{constructor(){y(this,hs);y(this,ue,P(pe([])));N(this,"MAX_TOASTS",3)}get toasts(){return[...f(i(this,ue))].sort((e,r)=>r.timestamp-e.timestamp)}create(e){const r=e.id||crypto.randomUUID(),s={id:r,state:e.state,message:e.message,timestamp:Date.now(),source:e.source||"user",position:e.position,timeoutId:void 0,autoCloseDelay:e.autoCloseDelay,details:e.details,actions:e.actions||[]};return v(this,hs,Cu).call(this,s),r}update(e,r){const s=f(i(this,ue)).findIndex(a=>a.id===e);if(s===-1)return;const n=f(i(this,ue))[s];n.timeoutId&&clearTimeout(n.timeoutId),n.loadingTimeoutId&&clearTimeout(n.loadingTimeoutId),f(i(this,ue))[s]={...n,state:r.state||n.state,message:r.message||n.message,source:r.source||n.source,position:r.position||n.position,actions:r.actions||n.actions,autoCloseDelay:r.autoCloseDelay!==void 0?r.autoCloseDelay:n.autoCloseDelay,loadingTimeoutId:void 0},v(this,hs,oo).call(this,f(i(this,ue))[s])}async track(e,r){const s=this.create({id:r.id,state:"loading",message:r.loading,source:"user",position:r.position});try{const n=await e;return this.update(s,{state:"success",message:r.success||"OpÃ©ration rÃ©ussie",autoCloseDelay:r.successDelay}),n}catch(n){throw this.update(s,{state:"error",message:r.error||"Erreur lors de l'opÃ©ration",autoCloseDelay:r.errorDelay}),n}}dismiss(e){const r=f(i(this,ue)).findIndex(n=>n.id===e);if(r===-1)return;const s=f(i(this,ue))[r];s.timeoutId&&clearTimeout(s.timeoutId),s.loadingTimeoutId&&clearTimeout(s.loadingTimeoutId),f(i(this,ue)).splice(r,1)}dismissAll(){f(i(this,ue)).forEach(e=>{e.timeoutId&&clearTimeout(e.timeoutId),e.loadingTimeoutId&&clearTimeout(e.loadingTimeoutId)}),m(i(this,ue),[],!0)}success(e,r){return this.create({state:"success",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}error(e,r){return this.create({state:"error",message:e,details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}warning(e,r){return this.create({state:"warning",message:e,source:r?.source||"system",details:r?.details,actions:r?.actions,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}info(e,r){return this.create({state:"info",message:e,source:r?.source||"system",details:r?.details,autoCloseDelay:r?.autoCloseDelay,position:r?.position})}loading(e,r){const n=r?.autoCloseDelay??3e4,a=this.create({state:"loading",message:e,details:r?.details,autoCloseDelay:n,position:r?.position}),o=setTimeout(()=>{this.update(a,{state:"warning",message:"Ãchec, temps expirÃ©",autoCloseDelay:2e3})},n-2e3),c=f(i(this,ue)).findIndex(l=>l.id===a);return c!==-1&&(f(i(this,ue))[c].loadingTimeoutId=o),a}}ue=new WeakMap,hs=new WeakSet,Cu=function(e){const r=f(i(this,ue)).findIndex(s=>s.source===e.source);if(r>=0){const s=f(i(this,ue))[r];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,ue))[r]=e}else if(f(i(this,ue)).length<this.MAX_TOASTS)f(i(this,ue)).push(e);else{const s=f(i(this,ue))[0];s.timeoutId&&clearTimeout(s.timeoutId),f(i(this,ue)).shift(),f(i(this,ue)).push(e)}v(this,hs,oo).call(this,e)},oo=function(e){e.timeoutId&&clearTimeout(e.timeoutId);let r;if(e.autoCloseDelay!==void 0)r=e.autoCloseDelay===0?void 0:e.autoCloseDelay;else{const s=Dp[e.state];e.source==="realtime-other"&&s>0?r=s*Mp:r=s===0?void 0:s}r!==void 0&&(e.timeoutId=setTimeout(()=>{this.dismiss(e.id)},r))};const Je=new $p;async function kp(){const{teams:t}=await D();return await t.list()}async function Cp(t){const{teams:e}=await D();return await e.get({teamId:t})}async function Tp(t){const{teams:e}=await D();return await e.create({teamId:pt.unique(),name:t})}async function Np(t,e){const{teams:r}=await D();return await r.updateName({teamId:t,name:e})}async function Lp(t){const{teams:e}=await D();await e.delete({teamId:t})}async function jp(t){const{teams:e}=await D();return await e.listMemberships({teamId:t})}async function qp(t,e){const{teams:r}=await D();await r.deleteMembership({teamId:t,membershipId:e})}async function Op(t,e,r){const{functions:s}=await D(),n=ku("usersTeamsManager"),a={action:"native-invite",teamId:t,emails:e,message:r},o=await s.createExecution({functionId:n,body:JSON.stringify(a)});if(o.status!=="completed")throw new Error(`Erreur lors de l'invitation : ${o.errors}`);return JSON.parse(o.responseBody)}async function Kc(t,e){const{teams:r}=await D();return await r.updatePrefs({teamId:t,prefs:e})}var Tt,rs,tr,gi,Tu;class Up{constructor(){y(this,gi);y(this,Tt,[]);y(this,rs,null);y(this,tr,!1)}register(e,r){i(this,tr)&&console.warn("[RealtimeManager] Enregistrement aprÃ¨s initialisation. Utilisez registerDynamic() pour les inscriptions dynamiques."),i(this,Tt).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels enregistrÃ©s:",e)}registerDynamic(e,r){return i(this,Tt).push({channels:e,callback:r}),console.log("[RealtimeManager] Channels dynamiques enregistrÃ©s:",e),i(this,tr)&&v(this,gi,Tu).call(this,e,r),()=>{const s=i(this,Tt).findIndex(n=>n.channels===e&&n.callback===r);s!==-1&&(i(this,Tt).splice(s,1),console.log("[RealtimeManager] Channels dynamiques dÃ©senregistrÃ©s:",e))}}async initialize(){if(i(this,tr))return;const e=[...new Set(i(this,Tt).flatMap(r=>r.channels))];if(e.length===0){console.log("[RealtimeManager] Aucun channel Ã  souscrire."),_(this,tr,!0);return}try{console.log(`[RealtimeManager] Initialisation de la connexion unique avec ${e.length} channels...`);const{client:r}=await D();_(this,rs,r.subscribe(e,s=>{for(const n of i(this,Tt))s.channels.some(o=>n.channels.includes(o))&&n.callback(s)})),_(this,tr,!0),console.log("[RealtimeManager] â Connexion Realtime Ã©tablie.")}catch(r){throw console.error("[RealtimeManager] Erreur lors de l'initialisation:",r),r}}destroy(){i(this,rs)&&(i(this,rs).call(this),_(this,rs,null)),_(this,Tt,[]),_(this,tr,!1),console.log("[RealtimeManager] Connexion Realtime fermÃ©e.")}}Tt=new WeakMap,rs=new WeakMap,tr=new WeakMap,gi=new WeakSet,Tu=async function(e,r){try{console.log(`[RealtimeManager] Ajout de ${e.length} channels Ã  la connexion existante...`);const{client:s}=await D();s.subscribe(e,n=>{r(n)}),console.log("[RealtimeManager] â Channels dynamiques ajoutÃ©s:",e)}catch(s){console.error("[RealtimeManager] Erreur lors de l'ajout de channels dynamiques:",s)}};const Vt=new Up;var xe,Sr,ss,rr,Ls,Cn,qr,Va,Nu;class Bp{constructor(){y(this,qr);y(this,xe,new ht);y(this,Sr,P(!1));y(this,ss,P(null));y(this,rr,P(!1));y(this,Ls,!1);y(this,Cn,z(()=>Array.from(i(this,xe).values())))}get loading(){return f(i(this,Sr))}get error(){return f(i(this,ss))}get isInitialized(){return f(i(this,rr))}get count(){return i(this,xe).size}get teams(){return f(i(this,Cn))}isUserInAnyTeam(e){return Array.from(i(this,xe).values()).some(r=>r.members?.some(s=>s.id===e))}get myTeams(){return q.userId?f(i(this,Cn)):[]}async loadCache(){if(!f(i(this,rr))){if(!q.userId){m(i(this,rr),!0);return}m(i(this,rr),!0),console.log("[NativeTeamsStore] Cache chargÃ© : 0 Ã©quipes (pas de cache)")}}async syncFromRemote(){m(i(this,Sr),!0),m(i(this,ss),null);try{if(!q.userId)return;await v(this,qr,Va).call(this),console.log(`[NativeTeamsStore] Sync terminÃ© : ${i(this,xe).size} Ã©quipes`)}catch(e){throw m(i(this,ss),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[NativeTeamsStore] SyncFromRemote error:",e),e}finally{m(i(this,Sr),!1)}}async setupRealtime(){if(q.userId){if(i(this,Ls)){console.log("[NativeTeamsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,qr,Nu).call(this),_(this,Ls,!0),console.log("[NativeTeamsStore] Realtime configurÃ©")}catch(e){throw m(i(this,ss),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[NativeTeamsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async hardReset(){console.log("[NativeTeamsStore] Hard reset..."),i(this,xe).clear(),m(i(this,rr),!1),await this.initialize(),console.log("[NativeTeamsStore] Hard reset terminÃ©")}getTeamById(e){return i(this,xe).get(e)}getTeamMemberNames(e){const r=i(this,xe).get(e);return!r||!r.members?[]:r.members.map(s=>s.name?s.name:s.userEmail?s.userEmail.split("@")[0]:"Inconnu").filter(Boolean)}async fetchTeam(e){try{const r=await Cp(e),s=await jp(e),n={$id:r.$id,name:r.name,total:r.total,$createdAt:r.$createdAt,$updatedAt:r.$updatedAt,prefs:r.prefs,members:s.memberships.map(a=>({$id:a.$id,id:a.userId,name:a.userName,userEmail:a.userEmail,roles:a.roles,joinedAt:a.joined,confirmed:a.confirm}))};return i(this,xe).set(e,n),n}catch(r){return console.error(`[NativeTeamsStore] Error fetching team ${e}:`,r),null}}async createTeam(e,r){const s=await Tp(e);r&&Object.keys(r).length>0&&await Kc(s.$id,r);const n=await this.fetchTeam(s.$id);if(!n)throw new Error("Erreur aprÃ¨s crÃ©ation d'Ã©quipe");return n}async updateTeam(e,r,s){r&&await Np(e,r),s&&Object.keys(s).length>0&&await Kc(e,s),await this.fetchTeam(e)}async deleteTeam(e){await Lp(e),i(this,xe).delete(e)}async inviteTeamMember(e,r,s){await Op(e,r,s),await this.fetchTeam(e)}async removeMember(e,r){await qp(e,r),await this.fetchTeam(e)}async reload(){m(i(this,Sr),!0);try{i(this,xe).clear(),await v(this,qr,Va).call(this)}finally{m(i(this,Sr),!1)}}destroy(){i(this,xe).clear(),m(i(this,rr),!1),_(this,Ls,!1)}}xe=new WeakMap,Sr=new WeakMap,ss=new WeakMap,rr=new WeakMap,Ls=new WeakMap,Cn=new WeakMap,qr=new WeakSet,Va=async function(){const e=await kp();for(const r of e.teams)await this.fetchTeam(r.$id)},Nu=async function(){Vt.register(["teams","memberships"],async e=>{console.log("[NativeTeamsStore] â¡ï¸ Realtime RECEIVED:",e.events),await v(this,qr,Va).call(this)})};const yt=new Bp;async function Qt(t,e={}){const{maxAttempts:r=3,timeout:s=1e4,context:n="Operation",successMessage:a,errorMessage:o,retryDelay:c=1e3,silent:l=!1}=e;let u=null;for(let d=1;d<=r;d++)try{console.log(`[${n}] Tentative ${d}/${r}`);const h=await Promise.race([t(),xp(s)]);return d>1&&console.log(`[${n}] â SuccÃ¨s aprÃ¨s ${d} tentatives`),a&&!l&&Je.success(a),h}catch(h){if(u=h instanceof Error?h:new Error(String(h)),console.error(`[${n}] â Tentative ${d}/${r} Ã©chouÃ©e:`,u.message),d===r)throw console.error(`[${n}] â Ãchec aprÃ¨s ${r} tentatives`),o&&!l&&Je.error(o),u;const p=c*d;console.log(`[${n}] Nouvelle tentative dans ${p}ms...`),await Hp(p)}throw u||new Error(`${n}: Ãchec inconnu`)}function xp(t){return new Promise((e,r)=>{setTimeout(()=>{r(new Error(`Timeout aprÃ¨s ${t}ms`))},t)})}function Hp(t){return new Promise(e=>setTimeout(e,t))}function Ia(t,e={}){const{fallback:r=null,context:s="JSON.parse"}=e;try{return JSON.parse(t)}catch(n){return console.error(`[${s}] â JSON invalide:`,n instanceof Error?n.message:n),r}}function No(t,e={}){const{context:r="JSON.parseArray",itemFallback:s}=e;return!t||!Array.isArray(t)?(console.warn(`[${r}] Tableau vide ou invalide`),[]):t.map((n,a)=>{const o=Ia(n,{context:`${r}[${a}]`,fallback:void 0});return o===void 0&&s?s(n,a):o}).filter(n=>n!==null)}const{APPWRITE_CONFIG:Br}=gs(),nn="main";async function Yc(t,e=null){return Qt(async()=>{const{tables:r}=await D(),s=[S.orderDesc("dateStart")];return e&&s.push(S.greaterThanEqual("dateEnd",e)),{events:(await r.listRows({databaseId:Br.databaseId,tableId:nn,queries:s})).rows}},{context:"AppwriteEvents.listEvents",timeout:2e4,errorMessage:"Erreur lors du chargement des Ã©vÃ©nements"})}async function Vp(t){try{return await Qt(async()=>{const{tables:e}=await D();return await e.getRow({databaseId:Br.databaseId,tableId:nn,rowId:t})},{context:"AppwriteEvents.getEvent",timeout:1e4,errorMessage:"Erreur lors du chargement de l'Ã©vÃ©nement"})}catch(e){if(e.code===404)return null;throw e}}async function Wp(t,e){return Qt(async()=>{const{tables:r}=await D(),s=pt.unique(),n=await r.createRow({databaseId:Br.databaseId,tableId:nn,rowId:s,data:{name:t.name,dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(o=>JSON.stringify(o)):[],createdBy:e,teams:t.teams??[],contributors:t.contributors?t.contributors.map(o=>JSON.stringify(o)):[],todos:t.todos?t.todos.map(o=>JSON.stringify(o)):[]}});console.log(`[appwrite-events] Event created: ${s}`);const{functions:a}=await D();return await a.createExecution({functionId:Br.functions.usersTeamsManager,body:JSON.stringify({action:"add-label-to-user",mainId:s,userId:e}),async:!1}),console.log(`[appwrite-events] Label ${s} attribuÃ© au crÃ©ateur ${e}`),n},{context:"AppwriteEvents.createEvent",timeout:15e3,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function Gp(t,e,r=[],s=!0){return Qt(async()=>{const{functions:n}=await D(),a={name:t.name,description:t.description||"",dateStart:t.dateStart,dateEnd:t.dateEnd,allDates:t.allDates,meals:t.meals?t.meals.map(u=>JSON.stringify(u)):[],createdBy:e,teams:t.teams||[],teamsId:t.teamsId||[],contributors:t.contributors?t.contributors.map(u=>JSON.stringify(u)):[],todos:t.todos?t.todos.map(u=>JSON.stringify(u)):[],status:t.status||"proposition"};console.log(`[appwrite-events] CrÃ©ation Ã©vÃ©nement avec ${r.length} team(s)`);const o=await n.createExecution({functionId:Br.functions.usersTeamsManager,body:JSON.stringify({action:"create-event-with-teams",eventData:a,creatorId:e,teamIds:r,sendEmailToExistingMembers:s}),async:!1}),c=JSON.parse(o.responseBody);if(!c.success)throw new Error(c.error||"Erreur lors de la crÃ©ation");return console.log(`[appwrite-events] ÃvÃ©nement crÃ©Ã© avec teams: ${c.eventId}`),c.event},{context:"AppwriteEvents.createEventWithTeams",timeout:3e4,successMessage:"ÃvÃ©nement crÃ©Ã© avec succÃ¨s",errorMessage:"Erreur lors de la crÃ©ation de l'Ã©vÃ©nement"})}async function Xc(t,e){return Qt(async()=>{const{tables:r}=await D(),s={...e};e.meals&&(s.meals=e.meals.map(a=>JSON.stringify(a))),e.contributors&&(s.contributors=Array.isArray(e.contributors)?e.contributors.map(a=>JSON.stringify(a)):[]),e.todos&&(s.todos=e.todos.map(a=>JSON.stringify(a))),e.allDates&&(s.allDates=e.allDates);const n=await r.updateRow({databaseId:Br.databaseId,tableId:nn,rowId:t,data:s});return console.log(`[appwrite-events] Event updated: ${t}`),n},{context:"AppwriteEvents.updateEvent",timeout:1e4,successMessage:"ÃvÃ©nement mis Ã  jour",errorMessage:"Erreur lors de la mise Ã  jour"})}async function Qp(t){return Qt(async()=>{const{tables:e,functions:r}=await D();await e.deleteRow({databaseId:Br.databaseId,tableId:nn,rowId:t}),console.log(`[appwrite-events] Event deleted: ${t}`),await r.createExecution({functionId:Br.functions.usersTeamsManager,body:JSON.stringify({action:"delete-event-label",mainId:t}),async:!0}),console.log(`[appwrite-events] Label deletion initiated for event: ${t}`)},{context:"AppwriteEvents.deleteEvent",timeout:1e4,successMessage:"ÃvÃ©nement supprimÃ©",errorMessage:"Erreur lors de la suppression"})}function Jp(t){return No(t,{context:"parseEventMeals",itemFallback:(e,r)=>(console.warn(`[parseEventMeals] Meal ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,name:"Repas inconnu",date:new Date().toISOString(),guests:1,recipes:[]})})}function Kp(t){return No(t,{context:"parseEventContributors",itemFallback:(e,r)=>(console.warn(`[parseEventContributors] Contributor ${r} invalide, utilisation d'un fallback`,e),{id:typeof e=="string"?e:`unknown-${r}`,status:"accepted",invitedAt:new Date().toISOString()})})}function Yp(t){return No(t,{context:"parseEventTodos",itemFallback:(e,r)=>(console.warn(`[parseEventTodos] Todo ${r} invalide, utilisation d'un fallback`,e),{id:`unknown-${r}`,taskName:"TÃ¢che invalide",taskDescription:null,dueDate:null,priority:null,status:null,taskOn:null,requiredPeopleNb:1,assignedTo:null})})}async function Cy(){if(window.location.hash.startsWith("#/demo/event/")&&!Ne.isInitialized){console.log("[ensureDemoEventsLoaded] Route dÃ©mo dÃ©tectÃ©e > Auto-chargement events dÃ©mo");try{await Ne.initializeForPublic()}catch(e){throw console.error("[ensureDemoEventsLoaded] Erreur chargement events dÃ©mo:",e),e}}}async function Ty(t,e=20){let r=0;for(;r<e;){if(Ne.getEventById(t))return console.log(`[waitForEvent] Event ${t} trouvÃ© aprÃ¨s ${r*100}ms`),!0;await new Promise(n=>setTimeout(n,100)),r++}return console.warn(`[waitForEvent] Event ${t} non trouvÃ© aprÃ¨s ${e*100}ms`),!1}class Xp{constructor(){N(this,"dbName","events-cache");N(this,"db",null);N(this,"version",2);N(this,"EVENTS_STORE","events");N(this,"METADATA_STORE","metadata");N(this,"POSTER_CONFIGS_STORE","poster-configs");N(this,"LAST_SYNC_KEY","lastSync")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.EVENTS_STORE)||(d.createObjectStore(this.EVENTS_STORE,{keyPath:"$id"}),console.log("[EventsIDBCache] Object store 'events' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[EventsIDBCache] Object store 'metadata' crÃ©Ã©")),d.objectStoreNames.contains(this.POSTER_CONFIGS_STORE)||(d.createObjectStore(this.POSTER_CONFIGS_STORE,{keyPath:"eventId"}),console.log("[EventsIDBCache] Object store 'poster-configs' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.EVENTS_STORE),n=r.objectStoreNames.contains(this.METADATA_STORE),a=r.objectStoreNames.contains(this.POSTER_CONFIGS_STORE);(!s||!n||!a)&&(console.warn(`[EventsIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (events=${s}, metadata=${n}, posters=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[EventsIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[EventsIDBCache] Base ouverte: ${this.dbName}`)}async loadEvents(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.EVENTS_STORE,"readonly").objectStore(this.EVENTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[EventsIDBCache] ${o.size} Ã©vÃ©nements chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveEvents(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.EVENTS_STORE,"readwrite"),a=n.objectStore(this.EVENTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[EventsIDBCache] ${e.size} Ã©vÃ©nements sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).put(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteEvent(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.EVENTS_STORE,"readwrite").objectStore(this.EVENTS_STORE).delete(e);o.onsuccess=()=>{console.log(`[EventsIDBCache] ÃvÃ©nement ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadPosterConfig(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const a=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE),o=a.get(e);o.onsuccess=()=>{const c=o.result;if(!c){r(null);return}if(c.config&&!c.current){console.log(`[EventsIDBCache] Migration config affiche V1 -> V2 pour ${e}`);const l={current:c.config,versions:[]};a.put({eventId:e,...l,updatedAt:new Date().toISOString()}),r(l)}else c.current?r({current:c.current,versions:c.versions}):r(null)},o.onerror=()=>s(o.error)})}async savePosterConfig(e,r){if(!this.db)throw new Error("DB non ouverte");return new Promise((s,n)=>{const c=this.db.transaction(this.POSTER_CONFIGS_STORE,"readwrite").objectStore(this.POSTER_CONFIGS_STORE).put({eventId:e,...r,updatedAt:new Date().toISOString()});c.onsuccess=()=>{console.log(`[EventsIDBCache] Config affiche (container) pour ${e} sauvegardÃ©e`),s()},c.onerror=()=>n(c.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY&&(c.lastSync=l.value)}),console.log(`[EventsIDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite");n.objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e.lastSync}),n.oncomplete=()=>{console.log("[EventsIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.EVENTS_STORE,this.METADATA_STORE,this.POSTER_CONFIGS_STORE],"readwrite");s.objectStore(this.EVENTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.objectStore(this.POSTER_CONFIGS_STORE).clear(),s.oncomplete=()=>{console.log("[EventsIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[EventsIDBCache] Connexion fermÃ©e"))}}async function Zc(){const t=new Xp;return await t.open(),t}const Zp={name:"Rassemblement festif",description:"Exemple d'Ã©vÃ©nement sur plusieurs jours, avec plein de recettes...",durationDays:5,meals:[{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"houmous-pois-chiche_dw7yaqdlvjg9",plates:50,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"banoffee-vegan-et-sans_2h83u0xlel3u",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:0,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"falafel_n9qzdiwbz4dp",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tourte-betterave-lenti_c54ri2ggbvt2",plates:30,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"cheesecake-vegan-citro_lmvlf0ryne1v",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:0,time:"19:30"},{recipes:[{recipeUuid:"houmous-de-betterave-a_7c1hbo8nci50",plates:280,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"risotto-sarrasin-torre_0ay8dp7smyrw",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"blanquette-de-soja-tex_1oq9igtwzpr2",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"panna-cotta-vegan-vani_kytwplnialyp",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:1,time:"12:00"},{recipes:[{recipeUuid:"taboule-libanais-quino_0zgww2rc17i3",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"curry-veg_xnkksxn0t76q",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"escalope-de-seitan_ly3x5wxnq3ve",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"abricots-poches-vervei_izz7yef86m3j",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:1,time:"19:30"},{recipes:[{recipeUuid:"taboule-libanais_izh9n9l14w66",plates:200,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"loubia_5m8okqsbqk66",plates:200,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_do1dg0nokwpd",plates:25,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"lassi-vegan-a-la-mangu_szk3bdykgyra",plates:200,typeR:"dessert",hasOwnPlatesNb:!0}],guests:200,dayOffset:2,time:"12:00"},{recipes:[{recipeUuid:"tartinade-de-pois-cass_tgpoyg0cm317",plates:280,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"champignons-frits-et-s_j71g5m5afdob",plates:280,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"steak-vegetarien-champ_g288g77vujzb",plates:45,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"tarte-au-citron-vegane_mw6a5i2da5hf",plates:280,typeR:"dessert",hasOwnPlatesNb:!1}],guests:280,dayOffset:2,time:"19:30"},{recipes:[{recipeUuid:"soupe-froide-de-courge_nm0vvoqx6bbh",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"couscous-dautomne-vege_tntsav2ghe2f",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"jambalaya-vegan_jai01fvdixw5",plates:30,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-de-riz-libanaise_k00sjxzgi6ql",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:3,time:"12:00"},{recipes:[{recipeUuid:"gaspacho_cf5hqia64o1j",plates:250,typeR:"entree",hasOwnPlatesNb:!0},{recipeUuid:"pastilla-vegan-a-laube_fzejp2oz5xj2",plates:250,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"bahn-mi-a-la-proteine-_go4i0y6buluy",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"fondant-au-chocolat-ve_0vedt76modbc",plates:250,typeR:"dessert",hasOwnPlatesNb:!0}],guests:250,dayOffset:3,time:"19:30"},{recipes:[{recipeUuid:"tartinade-de-haricot-r_w8ympby8n43o",plates:300,typeR:"autre",hasOwnPlatesNb:!1},{recipeUuid:"risotto-torrefie-de-sa_slsqvoqaqra7",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"proteines-de-soja-mari_ggo9802gtbxq",plates:50,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"salami-au-chocolat-veg_gp22v4hamxcv",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"12:00"},{recipes:[{recipeUuid:"salade-thai-aux-nouill_qv7cxgmhdwiy",plates:300,typeR:"entree",hasOwnPlatesNb:!1},{recipeUuid:"mafe-vegetarien-et-riz_ij8i8degl1r6",plates:300,typeR:"plat",hasOwnPlatesNb:!1},{recipeUuid:"aubergines-grillees-ca_3y287nb3wv9b",plates:40,typeR:"plat",hasOwnPlatesNb:!0},{recipeUuid:"creme-vegan-au-sureau_lds9ghlhjlwn",plates:300,typeR:"dessert",hasOwnPlatesNb:!1}],guests:300,dayOffset:4,time:"20:00"}]},Na=[Zp];function zp(t=0){const e=new Date,r=new Date(e);r.setDate(e.getDate()+7+t);const n=(5-r.getDay()+7)%7;return r.setDate(r.getDate()+n),r.setHours(0,0,0,0),r}function zc(t,e){const r=new Date(t);return r.setDate(r.getDate()+e),r}function Fp(t){const e=new Set;return t.forEach(r=>{const s=r.date.split("T")[0];e.add(s)}),Array.from(e).sort()}function em(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function tm(t,e){const[r,s]=e.time.split(":"),n=new Date(t);n.setHours(parseInt(r),parseInt(s),0,0);const o=(await Promise.all(e.recipes.map(async c=>{if(!await li.getRecipeByUuid(c.recipeUuid))return console.error(`[DemoEvents] Recipe not found: ${c.recipeUuid}. Skipping.`),null;const u=c.hasOwnPlatesNb??!1,d={recipeUuid:c.recipeUuid,plates:c.plates,typeR:c.typeR};return u&&(d.hasOwnPlatesNb=u),d}))).filter(c=>c!==null);if(o.length===0)throw new Error(`No valid recipes found for meal at day ${e.dayOffset}, ${e.time}`);return{id:crypto.randomUUID(),date:n.toISOString(),guests:e.guests,recipes:o}}async function rm(t,e=0){console.log(`[DemoEvents] Generating event: ${t.name}`);const r=zp(e),s=zc(r,t.durationDays-1);s.setHours(23,59,59,999),console.log(`[DemoEvents] Event dates: ${r.toISOString()} â ${s.toISOString()}`);const n=[];for(const u of t.meals){const d=zc(r,u.dayOffset);try{const h=await tm(d,u);n.push(h)}catch(h){console.error("[DemoEvents] Error generating meal:",h)}}n.sort((u,d)=>new Date(u.date).getTime()-new Date(d.date).getTime()),console.log(`[DemoEvents] Generated ${n.length} meals`);const a=Fp(n);console.log(`[DemoEvents] Event covers ${a.length} days: ${a.join(", ")}`);const o=`demo-${em(t.name)}`,c={id:"guest",name:"Visiteur",email:"guest@demo.local",status:"accepted",invitedAt:new Date().toISOString(),respondedAt:new Date().toISOString()},l={$id:o,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],name:t.name,description:t.description,status:"local",dateStart:r.toISOString(),dateEnd:s.toISOString(),allDates:a,meals:n,contributors:[c],todos:[],teams:[],teamsId:[],createdBy:"demo-system",isActive:!0,originalDataHash:null,error:null,minContrib:1,$sequence:0,$tableId:"",$databaseId:""};return console.log(`[DemoEvents] Event generated: ${o}`),nm(l),l}async function sm(){console.log(`[DemoEvents] Generating ${Na.length} demo events`);const t=[],e=30;for(let r=0;r<Na.length;r++){const s=Na[r],n=r*e;try{const a=await rm(s,n);t.push(a)}catch(a){console.error(`[DemoEvents] Error generating event "${s.name}":`,a)}}return console.log(`[DemoEvents] Generated ${t.length}/${Na.length} events successfully`),t}function nm(t){console.log(`[DemoEvents] Validating event: ${t.$id}`);const e=[];t.status!=="local"&&e.push(`Event status should be "local", got: ${t.status}`);const r=new Set(t.meals.map(o=>o.date.split("T")[0])),s=new Set(t.allDates||[]),n=Array.from(r).filter(o=>!s.has(o));n.length>0&&e.push(`Dates missing in allDates: ${n.join(", ")}`);const a=Array.from(s).filter(o=>!r.has(o));if(a.length>0&&e.push(`Extra dates in allDates (no meals): ${a.join(", ")}`),!t.dateStart||!t.dateEnd)e.push("Event dateStart and dateEnd must be defined");else{const o=new Date(t.dateStart).getTime(),c=new Date(t.dateEnd).getTime();for(const l of t.meals){const u=new Date(l.date).getTime();(u<o||u>c)&&e.push(`Meal "${l.id}" date (${l.date}) is outside event range (${t.dateStart} â ${t.dateEnd})`)}}for(const o of t.meals)(!o.recipes||o.recipes.length===0)&&e.push(`Meal "${o.id}" has no recipes`);if(e.length>0)throw new Error(`Demo event validation failed:
  - ${e.join(`
  - `)}`);console.log(`[DemoEvents] â Validation passed for event: ${t.$id}`)}var R,Se,He,Nt,M,Ve,js,yi,C,Me,wi,Tn,Ir,qs,Wa,yr,Lu,ju,qu,Ou,Uu,Bu,xu,Hu,Vu,Wu,Gu,Qu,Ju;class am{constructor(){y(this,C);y(this,R,new ht);y(this,Se,P(!1));y(this,He,P(null));y(this,Nt,P(!1));y(this,M,null);y(this,Ve,null);y(this,js,[]);y(this,yi,null);y(this,wi,z(()=>{const e=new Date;return e.setHours(0,0,0,0),Array.from(i(this,R).values()).filter(r=>!r.dateStart||!r.dateEnd?!1:new Date(r.dateEnd)>=e).sort((r,s)=>{const n=new Date(r.dateStart),a=new Date(s.dateStart);return n.getTime()-a.getTime()})}));y(this,Tn,z(()=>{const e=new Date;return Array.from(i(this,R).values()).filter(r=>!r.dateStart||!r.dateEnd?!1:new Date(r.dateEnd)<e).sort((r,s)=>{const n=new Date(r.dateStart);return new Date(s.dateStart).getTime()-n.getTime()})}));y(this,Ir,null);y(this,qs,!1)}get loading(){return f(i(this,Se))}get error(){return f(i(this,He))}get isInitialized(){return f(i(this,Nt))}get events(){return Array.from(i(this,R).values())}get count(){return i(this,R).size}get currentEvents(){return f(i(this,wi))}get pastEvents(){return f(i(this,Tn))}get pastEventsCount(){return f(i(this,Tn)).length}async loadCache(){if(f(i(this,Nt))){console.log("[EventsStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[EventsStore] Chargement du cache..."),m(i(this,Se),!0),m(i(this,He),null);try{if(!q.isAuthenticated)throw new Error("Utilisateur non connectÃ©");_(this,Ve,q.userId),_(this,js,q.userTeams),_(this,M,await Zc());const e=await i(this,M).loadEvents();if(e.size>0){console.log(`[EventsStore] ${e.size} Ã©vÃ©nements chargÃ©s depuis le cache`),i(this,R).clear();for(const[r,s]of e)i(this,R).set(r,s)}m(i(this,Nt),!0),console.log(`[EventsStore] Cache chargÃ©: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw m(i(this,He),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Se),!1)}}async syncFromRemote(){if(!i(this,M)){console.warn("[EventsStore] Impossible de sync : cache non initialisÃ©");return}if(v(this,C,Me).call(this)){console.log("[EventsStore] Mode local: skip syncFromRemote");return}console.log("[EventsStore] Synchronisation depuis Appwrite..."),m(i(this,Se),!0);try{await v(this,C,Wa).call(this),await i(this,M).saveEvents(i(this,R)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log(`[EventsStore] Synchronisation terminÃ©e: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw m(i(this,He),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Se),!1)}}async setupRealtime(){if(!i(this,M)){console.warn("[EventsStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,qs)){console.log("[EventsStore] Realtime dÃ©jÃ  configurÃ©");return}console.log("[EventsStore] Configuration du realtime..."),await v(this,C,Ju).call(this),_(this,qs,!0)}async initialize(){if(f(i(this,Nt))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}return i(this,Ir)?(console.log("[EventsStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,Ir)):(console.log("[EventsStore] Initialisation complÃ¨te..."),m(i(this,Se),!0),m(i(this,He),null),_(this,Ir,(async()=>{try{await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),console.log(`[EventsStore] Initialisation complÃ©tÃ©e: ${i(this,R).size} Ã©vÃ©nements`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw m(i(this,He),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Se),!1),_(this,Ir,null)}})()),i(this,Ir))}async initializeForPublic(){if(f(i(this,Nt))){console.log("[EventsStore] DÃ©jÃ  initialisÃ©");return}console.log("[EventsStore] Initialisation mode public..."),m(i(this,Se),!0),m(i(this,He),null);try{_(this,M,await Zc()),await this.loadDemoEvents(),m(i(this,Nt),!0),_(this,Ve,"guest"),_(this,js,[]),console.log("[EventsStore] Mode public initialisÃ© : events dÃ©mo chargÃ©s")}catch(e){throw console.error("[EventsStore] Erreur init mode public:",e),e}finally{m(i(this,Se),!1)}}async loadDemoEvents(){console.log("[EventsStore] Loading demo events...");try{const e=await sm();console.log(`[EventsStore] Generated ${e.length} demo events`),e.forEach(r=>{i(this,R).set(r.$id,r)}),i(this,M)&&(await i(this,M).saveEvents(i(this,R)),console.log("[EventsStore] Demo events persisted to IDB")),console.log(`[EventsStore] Total events in store: ${i(this,R).size}`)}catch(e){throw console.error("[EventsStore] Error loading demo events:",e),e}}getEventById(e){return i(this,R).get(e)||null}async fetchEvent(e){try{const r=await Vp(e);if(r){const s=v(this,C,yr).call(this,r);return i(this,R).set(e,s),s}return null}catch(r){return console.error(`[EventsStore] Erreur lors du fetch de ${e}:`,r),null}}getEventsByDateRange(e,r){return this.events.filter(s=>s.dateStart&&s.dateEnd&&s.dateStart>=e&&s.dateEnd<=r)}canEditEvent(e){if(!i(this,Ve))return!1;const r=i(this,R).get(e);return r?!!(r.createdBy===i(this,Ve)||r.teams?.some(s=>i(this,js).includes(s))||r.contributors&&r.contributors.some(s=>s.id===i(this,Ve)&&s.status==="accepted")):!1}canUserEditEvent(e,r,s){const n=i(this,R).get(e);return n?n.status==="local"?!0:r?!!(n.createdBy===r||n.teams?.length&&s?.length&&n.teams.some(a=>s.includes(a))||n.contributors&&n.contributors.some(a=>a.id===r&&a.status==="accepted")):!1:!1}async createEvent(e){if(!q.userId)throw new Error("Utilisateur non connectÃ©");const r=await Wp(e,q.userId),s=v(this,C,yr).call(this,r);return i(this,R).set(r.$id,s),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã©: ${r.$id}`),s}async createEventWithTeams(e,r=[],s=!0){if(!q.userId)throw new Error("Utilisateur non connectÃ©");const n=await Gp(e,q.userId,r,s),a=v(this,C,yr).call(this,n);return i(this,R).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] ÃvÃ©nement crÃ©Ã© avec ${r.length} team(s): ${n.$id}`),a}async updateEvent(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,Lu).call(this,e,r);const s=await Xc(e,r),n=v(this,C,yr).call(this,s);return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] ÃvÃ©nement mis Ã  jour: ${e}`),n}async updateEventStatus(e,r){if(v(this,C,Me).call(this,e)){await v(this,C,ju).call(this,e,r);return}try{await Xc(e,{status:r});const s=i(this,R).get(e);s&&(s.status=r),console.log(`[EventsStore] Statut mis Ã  jour: ${e} -> ${r}`)}catch(s){throw console.error(`[EventsStore] Erreur mise Ã  jour statut ${e}:`,s),s}}async deleteEvent(e){await Qp(e),i(this,R).delete(e),i(this,M)&&await i(this,M).deleteEvent(e),console.log(`[EventsStore] ÃvÃ©nement supprimÃ©: ${e}`)}getContributors(e){const r=i(this,R).get(e);return r?r.contributors:[]}getContributorStatus(e){const r=i(this,R).get(e);if(!r)return"";const s=r.contributors.filter(n=>n.id===i(this,Ve));return s.length>0?s[0].status:""}async removeContributor(e,r){try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{removeUserFromEvent:n}=await V(async()=>{const{removeUserFromEvent:o}=await Promise.resolve().then(()=>Ki);return{removeUserFromEvent:o}},void 0);await n(e,r);const a=s.contributors.filter(o=>o.id!==r&&o.email!==r);return s.contributors.length===a.length?s:await this.updateEvent(e,{contributors:a})}catch(s){throw console.error("[EventsStore] Erreur suppression contributeur:",s),s}}async inviteParticipants(e,r){try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const{teamIds:n=[],emails:a=[],userIds:o=[],sendEmailToExistingMembers:c=!0}=r;if(n.length===0&&a.length===0&&o.length===0)return console.log("[EventsStore] Aucun participant Ã  inviter"),s;const{inviteParticipantsToEvent:l}=await V(async()=>{const{inviteParticipantsToEvent:p}=await Promise.resolve().then(()=>Ki);return{inviteParticipantsToEvent:p}},void 0),u=await l(e,s.name,{teamIds:n,emails:a,userIds:o,sendEmailToExistingMembers:c});console.log(`[EventsStore] Invitation result: ${u.processed} traitÃ©s`);const d=n.length>0?2e3:500;await new Promise(p=>setTimeout(p,d));const h=await this.fetchEvent(e);if(!h)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return h}catch(s){throw console.error("[EventsStore] Erreur invitation participants:",s),s}}async removeTeam(e,r){try{const{removeTeamFromEvent:s}=await V(async()=>{const{removeTeamFromEvent:a}=await Promise.resolve().then(()=>Ki);return{removeTeamFromEvent:a}},void 0);await s(e,r),await new Promise(a=>setTimeout(a,1e3));const n=await this.fetchEvent(e);if(!n)throw new Error("Impossible de recharger l'Ã©vÃ©nement");return console.log(`[EventsStore] Team ${r} retirÃ©e de l'Ã©vÃ©nement ${e}`),n}catch(s){throw console.error("[EventsStore] Erreur retrait team:",s),s}}async updateContributorStatus(e,r,s){if(v(this,C,Me).call(this,e))return await v(this,C,Qu).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(c=>c.id===r||c.email===r);if(o===-1)throw new Error("Contributeur introuvable");return a[o]={...a[o],status:s,respondedAt:new Date().toISOString()},await this.updateEvent(e,{contributors:a})}catch(n){throw console.error("[EventsStore] Erreur maj statut:",n),n}}getMeals(e){const r=i(this,R).get(e);return r?r.meals:[]}async addMeal(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,qu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals,r];return await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur ajout meal:",s),s}}async updateMeal(e,r,s){if(v(this,C,Me).call(this,e))return await v(this,C,Ou).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");return a[r]=s,await this.updateEvent(e,{meals:a})}catch(n){throw console.error("[EventsStore] Erreur maj meal:",n),n}}async deleteMeal(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,Uu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");return n.splice(r,1),await this.updateEvent(e,{meals:n})}catch(s){throw console.error("[EventsStore] Erreur suppression meal:",s),s}}getTodos(e){const r=i(this,R).get(e);return r?r.todos:[]}async addTodo(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,Bu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todo:",s),s}}async addTodos(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,xu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.todos,...r];return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur ajout todos:",s),s}}async updateTodoStatus(e,r,s){if(v(this,C,Me).call(this,e)){await v(this,C,Wu).call(this,e,r,s);return}try{const n=i(this,R).get(e);n&&(n.todos=n.todos.map(c=>c.id===r?{...c,status:s,updatedAt:new Date().toISOString()}:c));const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"update_todo_status",data:{eventId:e,todoId:r,status:s}}),!1,"/",In.POST)}catch(n){throw console.error("[EventsStore] Erreur updateTodoStatus:",n),n}}async toggleTodoAssignment(e,r){if(v(this,C,Me).call(this,e)){await v(this,C,Gu).call(this,e,r);return}try{const s=q.userId;if(!s)throw new Error("Utilisateur non connectÃ©");const n=i(this,R).get(e);if(n){const c=n.todos.find(l=>l.id===r);if(c){let l=[];Array.isArray(c.assignedTo)?l=[...c.assignedTo]:c.assignedTo&&(l=[c.assignedTo]),l.includes(s)?l=l.filter(u=>u!==s):l.push(s),n.todos=n.todos.map(u=>u.id===r?{...u,assignedTo:l.length>0?l:null,updatedAt:new Date().toISOString()}:u)}}const{functions:a,config:o}=await D();await a.createExecution(o.functions.enkaData,JSON.stringify({action:"toggle_todo_assignment",data:{eventId:e,todoId:r}}),!1,"/",In.POST)}catch(s){throw console.error("[EventsStore] Erreur toggleTodoAssignment:",s),s}}async updateTodo(e,r,s){if(v(this,C,Me).call(this,e))return await v(this,C,Hu).call(this,e,r,s);try{const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(o=>o.id===r?{...o,...s,updatedAt:new Date().toISOString()}:o);return await this.updateEvent(e,{todos:a})}catch(n){throw console.error("[EventsStore] Erreur maj todo:",n),n}}async deleteTodo(e,r){if(v(this,C,Me).call(this,e))return await v(this,C,Vu).call(this,e,r);try{const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(a=>a.id!==r);return await this.updateEvent(e,{todos:n})}catch(s){throw console.error("[EventsStore] Erreur suppression todo:",s),s}}async loadAllPastEvents(){try{if(console.log("[EventsStore] Chargement de TOUS les Ã©vÃ©nements..."),!i(this,Ve)){console.warn("[EventsStore] userId non dÃ©fini");return}m(i(this,Se),!0);const{events:e}=await Yc(i(this,Ve),null);e.forEach(r=>{i(this,R).set(r.$id,v(this,C,yr).call(this,r))}),console.log(`[EventsStore] ${e.length} Ã©vÃ©nements chargÃ©s (sans filtre de date, total: ${i(this,R).size})`)}catch(e){throw console.error("[EventsStore] Erreur lors du chargement:",e),e}finally{m(i(this,Se),!1)}}calculateScaleFactor(e,r){return e/r}async loadPosterConfig(e){return i(this,M)?await i(this,M).loadPosterConfig(e):null}async savePosterConfig(e,r){if(!i(this,M))return;const n=await i(this,M).loadPosterConfig(e)||{versions:[]};n.current=r,await i(this,M).savePosterConfig(e,n)}async createPosterVersion(e,r,s){if(!i(this,M))return;const a=await i(this,M).loadPosterConfig(e)||{current:r,versions:[]};if(a.versions||(a.versions=[]),a.versions.length>=3)throw new Error("Limite de 3 versions atteinte");const o={id:crypto.randomUUID(),name:s,config:JSON.parse(JSON.stringify(r)),createdAt:new Date().toISOString()};return a.versions.push(o),a.current=r,await i(this,M).savePosterConfig(e,a),o}async deletePosterVersion(e,r){if(!i(this,M))return;const s=await i(this,M).loadPosterConfig(e);!s||!s.versions||(s.versions=s.versions.filter(n=>n.id!==r),await i(this,M).savePosterConfig(e,s))}async reload(){console.log("[EventsStore] Rechargement..."),m(i(this,Se),!0),m(i(this,He),null);try{i(this,R).clear(),await v(this,C,Wa).call(this),console.log("[EventsStore] Rechargement complÃ©tÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw m(i(this,He),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Se),!1)}}async hardReset(){console.log("[EventsStore] ð HARD RESET - Vidage complet..."),m(i(this,Se),!0),m(i(this,He),null);try{i(this,R).clear(),i(this,M)&&(await i(this,M).clear(),console.log("[EventsStore] Cache IDB vidÃ©")),await v(this,C,Wa).call(this),i(this,M)&&(await i(this,M).saveEvents(i(this,R)),await i(this,M).saveMetadata({lastSync:new Date().toISOString()}),console.log("[EventsStore] Cache IDB recrÃ©Ã©")),console.log("[EventsStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,He),r,!0),console.error("[EventsStore]",r,e),e}finally{m(i(this,Se),!1)}}destroy(){i(this,M)&&(i(this,M).close(),_(this,M,null)),i(this,R).clear(),m(i(this,Nt),!1),_(this,qs,!1),console.log("[EventsStore] Ressources nettoyÃ©es")}}R=new WeakMap,Se=new WeakMap,He=new WeakMap,Nt=new WeakMap,M=new WeakMap,Ve=new WeakMap,js=new WeakMap,yi=new WeakMap,C=new WeakSet,Me=function(e){const r=e||i(this,yi);return r?i(this,R).get(r)?.status==="local":!1},wi=new WeakMap,Tn=new WeakMap,Ir=new WeakMap,qs=new WeakMap,Wa=async function(e=null){if(v(this,C,Me).call(this)){console.log("[EventsStore] Mode local: skip loadEvents from Appwrite");return}try{if(console.log("[EventsStore] Chargement des Ã©vÃ©nements..."),!i(this,Ve)){console.warn("[EventsStore] userId non dÃ©fini, impossible de charger les Ã©vÃ©nements");return}if(!e){const s=new Date;s.setHours(0,0,0,0);const n=new Date(s);n.setDate(n.getDate()-15),e=n.toISOString()}const{events:r}=await Yc(i(this,Ve),e);r.forEach(s=>{i(this,R).set(s.$id,v(this,C,yr).call(this,s))}),console.log(`[EventsStore] ${r.length} Ã©vÃ©nements chargÃ©s (filtrÃ©s pour userId: ${i(this,Ve)}, date >= ${e})`)}catch(r){throw console.error("[EventsStore] Erreur lors du chargement:",r),r}},yr=function(e){return{...e,meals:Jp(e.meals),contributors:Kp(e.contributors),todos:Yp(e.todos)}},Lu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,...r,$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Event mis Ã  jour: ${e}`),n},ju=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");s.status=r,s.$updatedAt=new Date().toISOString(),i(this,M)&&await i(this,M).saveEvent(s),console.log(`[EventsStore] Mode local: Status mis Ã  jour: ${e} -> ${r}`)},qu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,meals:[...s.meals,r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Meal ajoutÃ© Ã  ${e}`),n},Ou=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.meals];if(r<0||r>=a.length)throw new Error("Index invalide");a[r]=s;const o={...n,meals:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Meal mis Ã  jour dans ${e}`),o},Uu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=[...s.meals];if(r<0||r>=n.length)throw new Error("Index invalide");n.splice(r,1);const a={...s,meals:n,$updatedAt:new Date().toISOString()};return i(this,R).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Meal supprimÃ© de ${e}`),a},Bu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo ajoutÃ© Ã  ${e}`),n},xu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n={...s,todos:[...s.todos,...r],$updatedAt:new Date().toISOString()};return i(this,R).set(e,n),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: ${r.length} todos ajoutÃ©s Ã  ${e}`),n},Hu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.map(c=>c.id===r?{...c,...s,updatedAt:new Date().toISOString()}:c),o={...n,todos:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,o),i(this,M)&&await i(this,M).saveEvent(o),console.log(`[EventsStore] Mode local: Todo mis Ã  jour dans ${e}`),o},Vu=async function(e,r){const s=i(this,R).get(e);if(!s)throw new Error("ÃvÃ©nement introuvable");const n=s.todos.filter(o=>o.id!==r),a={...s,todos:n,$updatedAt:new Date().toISOString()};return i(this,R).set(e,a),i(this,M)&&await i(this,M).saveEvent(a),console.log(`[EventsStore] Mode local: Todo supprimÃ© de ${e}`),a},Wu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");n.todos=n.todos.map(a=>a.id===r?{...a,status:s,updatedAt:new Date().toISOString()}:a),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo status mis Ã  jour: ${r} -> ${s}`)},Gu=async function(e,r){const s=q.userId||"guest",n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=n.todos.find(c=>c.id===r);if(!a)throw new Error("Todo introuvable");let o=[];Array.isArray(a.assignedTo)?o=[...a.assignedTo]:a.assignedTo&&(o=[a.assignedTo]),o.includes(s)?o=o.filter(c=>c!==s):o.push(s),n.todos=n.todos.map(c=>c.id===r?{...c,assignedTo:o.length>0?o:null,updatedAt:new Date().toISOString()}:c),i(this,M)&&await i(this,M).saveEvent(n),console.log(`[EventsStore] Mode local: Todo assignment toggled: ${r} par ${s}`)},Qu=async function(e,r,s){const n=i(this,R).get(e);if(!n)throw new Error("ÃvÃ©nement introuvable");const a=[...n.contributors],o=a.findIndex(l=>l.id===r||l.email===r);if(o===-1)throw new Error("Contributeur introuvable");a[o]={...a[o],status:s,respondedAt:new Date().toISOString()};const c={...n,contributors:a,$updatedAt:new Date().toISOString()};return i(this,R).set(e,c),i(this,M)&&await i(this,M).saveEvent(c),console.log(`[EventsStore] Mode local: Contributor status mis Ã  jour: ${r} -> ${s}`),c},Ju=async function(){if(v(this,C,Me).call(this)){console.log("[EventsStore] Mode local: skip realtime setup");return}try{console.log("[EventsStore] Activation du Realtime...");const e=ut();Vt.register([`databases.${e}.collections.${nn}.documents`],async r=>{const s=r.events.some(a=>a.includes(".create"))?"create":r.events.some(a=>a.includes(".delete"))?"delete":"update",n=r.payload;if(console.log(`[EventsStore] â¡ï¸ Realtime RECEIVED: ${s} pour ${n.$id}`,{name:n.name,updatedAt:n.$updatedAt}),s==="create"||s==="update"){const a=v(this,C,yr).call(this,n);i(this,R).set(n.$id,a),i(this,M)&&await i(this,M).saveEvent(a)}else s==="delete"&&(i(this,R).delete(n.$id),i(this,M)&&await i(this,M).deleteEvent(n.$id))}),console.log("[EventsStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[EventsStore] Erreur lors de la configuration du realtime:",e)}};const Ne=new am,Aa=gs(),_a="materiel";async function Fc(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel] Error listing materiels:",e),e}}async function im(t,e){try{const{tables:r}=await D(),s=pt.unique();let n;try{n=typeof t.owner=="string"?JSON.parse(t.owner):t.owner}catch(c){throw console.error("[appwrite-materiel] Error parsing owner:",t.owner,c),new Error("Invalid owner format")}const a=[te.read(ae.user(e)),te.update(ae.user(e))];n.teamId?a.push(te.read(ae.team(n.teamId)),te.update(ae.team(n.teamId))):n.userId&&a.push(te.read(ae.user(n.userId)),te.update(ae.user(n.userId)));const o=await r.createRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:s,data:{name:t.name,description:t.description||null,type:t.type||null,quantity:t.quantity,status:t.status||"ok",location:t.location||null,shareableWith:t.shareableWith||null,owner:t.owner},permissions:a});return console.log(`[appwrite-materiel] Materiel created: ${s}`),o}catch(r){throw console.error("[appwrite-materiel] Error creating materiel:",r),r}}async function La(t,e){try{const{tables:r}=await D(),s=await r.updateRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:t,data:e});return console.log(`[appwrite-materiel] Materiel updated: ${t}`),s}catch(r){throw console.error(`[appwrite-materiel] Error updating materiel ${t}:`,r),r}}async function om(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:Aa.APPWRITE_CONFIG.databaseId,tableId:_a,rowId:t}),console.log(`[appwrite-materiel] Materiel deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel] Error deleting materiel ${t}:`,e),e}}function cm(){return[`databases.${Aa.APPWRITE_CONFIG.databaseId}.collections.${_a}.documents`]}const Ra=gs(),Pa="materiel_loan";async function el(t){try{const{tables:e}=await D();return(await e.listRows({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,queries:t||[]})).rows}catch(e){throw console.error("[appwrite-materiel-loan] Error listing loans:",e),e}}async function lm(t,e){try{const{tables:r}=await D(),s=pt.unique(),n=[te.read(ae.user(e)),te.update(ae.user(e)),te.read(ae.team(t.ownerId)),te.update(ae.team(t.ownerId))],a=await r.createRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:s,data:{startDate:t.startDate,endDate:t.endDate,responsibleId:t.responsibleId,responsibleName:t.responsibleName,ownerId:t.ownerId,ownerName:t.ownerName,materiels:t.materiels.map(o=>JSON.stringify(o)),notes:t.notes||null,status:t.status||"asked",completedAt:null,returnedAt:null,returnNotes:null},permissions:n});return console.log(`[appwrite-materiel-loan] Loan created: ${s}`),a}catch(r){throw console.error("[appwrite-materiel-loan] Error creating loan:",r),r}}async function um(t,e){try{const{tables:r}=await D(),s={};e.startDate!==void 0&&(s.startDate=e.startDate),e.endDate!==void 0&&(s.endDate=e.endDate),e.materiels!==void 0&&(s.materiels=e.materiels.map(a=>JSON.stringify(a))),e.status!==void 0&&(s.status=e.status),e.notes!==void 0&&(s.notes=e.notes),e.returnedAt!==void 0&&(s.returnedAt=e.returnedAt),e.returnNotes!==void 0&&(s.returnNotes=e.returnNotes);const n=await r.updateRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:t,data:s});return console.log(`[appwrite-materiel-loan] Loan updated: ${t}`),n}catch(r){throw console.error(`[appwrite-materiel-loan] Error updating loan ${t}:`,r),r}}async function dm(t){try{const{tables:e}=await D();await e.deleteRow({databaseId:Ra.APPWRITE_CONFIG.databaseId,tableId:Pa,rowId:t}),console.log(`[appwrite-materiel-loan] Loan deleted: ${t}`)}catch(e){throw console.error(`[appwrite-materiel-loan] Error deleting loan ${t}:`,e),e}}function fm(){return[`databases.${Ra.APPWRITE_CONFIG.databaseId}.collections.${Pa}.documents`]}class hm{constructor(){N(this,"dbName","materiel-cache");N(this,"db",null);N(this,"version",1);N(this,"MATERIELS_STORE","materiels");N(this,"LOANS_STORE","loans");N(this,"METADATA_STORE","metadata");N(this,"LAST_SYNC_MATERIEL_KEY","lastSyncMateriel");N(this,"LAST_SYNC_LOANS_KEY","lastSyncLoans")}async open(){if(this.db)return;const e=()=>new Promise((o,c)=>{const l=indexedDB.open(this.dbName,this.version);l.onerror=()=>c(l.error),l.onsuccess=()=>o(l.result),l.onupgradeneeded=u=>{const d=u.target.result;d.objectStoreNames.contains(this.MATERIELS_STORE)||(d.createObjectStore(this.MATERIELS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'materiels' crÃ©Ã©")),d.objectStoreNames.contains(this.LOANS_STORE)||(d.createObjectStore(this.LOANS_STORE,{keyPath:"$id"}),console.log("[MaterielIDBCache] Object store 'loans' crÃ©Ã©")),d.objectStoreNames.contains(this.METADATA_STORE)||(d.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[MaterielIDBCache] Object store 'metadata' crÃ©Ã©"))}});let r=await e();const s=r.objectStoreNames.contains(this.MATERIELS_STORE),n=r.objectStoreNames.contains(this.LOANS_STORE),a=r.objectStoreNames.contains(this.METADATA_STORE);(!s||!n||!a)&&(console.warn(`[MaterielIDBCache] Base incomplÃ¨te dÃ©tectÃ©e (materiels=${s}, loans=${n}, metadata=${a}), suppression et recrÃ©ation...`),r.close(),await new Promise((o,c)=>{const l=indexedDB.deleteDatabase(this.dbName);l.onsuccess=()=>o(),l.onerror=()=>c(l.error),l.onblocked=()=>{console.warn("[MaterielIDBCache] Suppression bloquÃ©e, rÃ©essai...")}}),r=await e()),this.db=r,console.log(`[MaterielIDBCache] Base ouverte: ${this.dbName}`)}async loadMateriels(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.MATERIELS_STORE,"readonly").objectStore(this.MATERIELS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} matÃ©riels chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveMateriels(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.MATERIELS_STORE,"readwrite"),a=n.objectStore(this.MATERIELS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} matÃ©riels sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteMateriel(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.MATERIELS_STORE,"readwrite").objectStore(this.MATERIELS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] MatÃ©riel ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadLoans(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.LOANS_STORE,"readonly").objectStore(this.LOANS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[MaterielIDBCache] ${o.size} emprunts chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async saveLoans(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.LOANS_STORE,"readwrite"),a=n.objectStore(this.LOANS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[MaterielIDBCache] ${e.size} emprunts sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async upsertLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).put(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e.$id} sauvegardÃ©`),r()},o.onerror=()=>s(o.error)})}async deleteLoan(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.LOANS_STORE,"readwrite").objectStore(this.LOANS_STORE).delete(e);o.onsuccess=()=>{console.log(`[MaterielIDBCache] Emprunt ${e} supprimÃ©`),r()},o.onerror=()=>s(o.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSyncMateriel:null,lastSyncLoans:null};o.forEach(l=>{l.key===this.LAST_SYNC_MATERIEL_KEY&&(c.lastSyncMateriel=l.value),l.key===this.LAST_SYNC_LOANS_KEY&&(c.lastSyncLoans=l.value)}),console.log(`[MaterielIDBCache] Metadata chargÃ©es: lastSyncMateriel=${c.lastSyncMateriel}, lastSyncLoans=${c.lastSyncLoans}`),e(c)},a.onerror=()=>r(a.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_MATERIEL_KEY,value:e.lastSyncMateriel}),a.put({key:this.LAST_SYNC_LOANS_KEY,value:e.lastSyncLoans}),n.oncomplete=()=>{console.log("[MaterielIDBCache] Metadata sauvegardÃ©es"),r()},n.onerror=()=>s(n.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.MATERIELS_STORE,this.LOANS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.MATERIELS_STORE).clear(),s.objectStore(this.LOANS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[MaterielIDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[MaterielIDBCache] Connexion fermÃ©e"))}}async function pm(){const t=new hm;return await t.open(),t}function Lo(t){const e={electronic:{label:"Ãlectronique",badgeClass:"badge-warning",textColor:"text-warning",bgColor:"bg-warning/10"},manual:{label:"Manuel",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},tools:{label:"Outils",badgeClass:"badge-secondary",textColor:"text-secondary",bgColor:"bg-secondary/10"},dish:{label:"Vaisselle",badgeClass:"badge-primary",textColor:"text-primary",bgColor:"bg-primary/10"},cooking:{label:"Cuisine",badgeClass:"badge-success",textColor:"text-success",bgColor:"bg-success/10"},gaz:{label:"Gaz",badgeClass:"badge-error",textColor:"text-error",bgColor:"bg-error/10"},hygiene:{label:"HygiÃ¨ne",badgeClass:"badge-info",textColor:"text-info",bgColor:"bg-info/10"},other:{label:"Autre",badgeClass:"badge-neutral",textColor:"text-neutral",bgColor:"bg-neutral/10"}};return e[t||"other"]||e.other}function Ny(t){return Lo(t).badgeClass}function Ly(t){return Lo(t).textColor}function jy(t){return Lo(t).bgColor}function qy(t){return{ok:"OK",lost:"Perdu",torepair:"Ã rÃ©parer"}[t||"ok"]||t||"OK"}const tl={userName:"",userId:"",teamName:"",teamId:""};function mm(t){if(!t)return tl;try{return typeof t=="string"?JSON.parse(t):t}catch(e){return console.error("[materiel.utils] Error parsing owner from Appwrite:",t,e),tl}}function jo(t){if(!t)return[];try{return Array.isArray(t)?t.map(e=>{try{return JSON.parse(e)}catch{return console.warn("[materiel.utils] Failed to parse loan item string:",e),null}}).filter(e=>e!==null):typeof t=="string"?JSON.parse(t):[]}catch(e){return console.error("[materiel.utils] Error parsing loan items from Appwrite:",t,e),[]}}function gm(t){return jo(t)}function dn(t){return{...t,materielItems:gm(t.materiels)}}function Ku(t,e,r=new Date){const s=mm(t.owner),n=[];let a=0;e.forEach(u=>{const h=jo(u.materiels).filter(I=>I.materielId===t.$id);if(h.length===0)return;const p=new Date(u.startDate),g=new Date(u.endDate),w=p<=r&&g>=r,A=p>r,E=["accepted","asked"].includes(u.status);(w||A)&&E&&h.forEach(I=>{n.push({loanId:u.$id,responsibleName:u.responsibleName||"",startDate:u.startDate,endDate:u.endDate,quantity:I.quantity,status:u.status})}),w&&E&&h.forEach(I=>{a+=I.quantity})});const c=n.some(u=>{const d=new Date(u.startDate),h=new Date(u.endDate);return d<=r&&h>=r})?"loan":t.status,l=t.quantity-a;return{...t,status:c,ownerData:s,loanDetails:n,availableQuantity:l,totalLoanedQuantity:a,isAvailable:l>0,isFullyLoaned:l===0}}function ym(t,e){const r={...t};return Ku(r,e)}function wm(t){return["asked","accepted"].includes(t.status)}function vm(t,e,r,s){return t<=s&&e>=r}function bm(t,e,r,s){let n=0;return e.forEach(a=>{if(!wm(a))return;const o=new Date(a.startDate),c=new Date(a.endDate);if(!vm(o,c,r,s))return;const u=jo(a.materiels).filter(d=>d.materielId===t);n+=u.reduce((d,h)=>d+h.quantity,0)}),n}var fe,ge,ne,he,de,ns,Nn,Os,Lt,jt,vi,sr,bi,Ei,Si,Ln,ie,Yu,Xu,Zu,zu,Fu,ed,As,_s;class Em{constructor(){y(this,ie);y(this,fe,new ht);y(this,ge,new ht);y(this,ne,null);y(this,he,P(!1));y(this,de,P(null));y(this,ns,P(!1));y(this,Nn,P(!1));y(this,Os,!1);y(this,Lt,P(null));y(this,jt,P(null));y(this,vi,null);y(this,sr,z(()=>Array.from(i(this,fe).values())));y(this,bi,z(()=>Array.from(i(this,ge).values())));y(this,Ei,z(()=>{if(!q.userId)return[];const e=yt.myTeams.map(r=>r.$id);return f(i(this,sr)).filter(r=>r.ownerData?.teamId&&e.includes(r.ownerData.teamId))}));y(this,Si,z(()=>{if(!q.userId)return[];const e=yt.myTeams.map(r=>r.$id);return f(i(this,sr)).filter(r=>r.shareableWith?.some(n=>e.includes(n))&&!(r.ownerData?.teamId&&e.includes(r.ownerData.teamId)))}));y(this,Ln,z(()=>f(i(this,sr)).filter(e=>e.isAvailable)))}get loading(){return f(i(this,he))}get error(){return f(i(this,de))}get isInitialized(){return f(i(this,ns))}get isRealtimeActive(){return f(i(this,Nn))}get count(){return i(this,fe).size}get materiels(){return f(i(this,sr))}get loans(){return f(i(this,bi))}get teamMateriels(){return f(i(this,Ei))}get shareableMateriels(){return f(i(this,Si))}get availableMateriels(){return f(i(this,Ln))}getAvailableMaterielsByOwner(e){return f(i(this,Ln)).filter(r=>r.ownerData?.teamId===e&&r.status!=="lost"&&r.status!=="torepair")}getMaterielsByOwner(e){return f(i(this,sr)).filter(r=>r.ownerData?.teamId===e)}getAvailableMaterielsForPeriod(e,r,s){const n=new Date(r),a=new Date(s),o=Array.from(i(this,ge).values());return f(i(this,sr)).filter(c=>c.ownerData?.teamId===e).filter(c=>c.status!=="lost"&&c.status!=="torepair").map(c=>{const l=bm(c.$id,o,n,a),u=c.quantity-l;return{...c,availableForPeriod:u}}).filter(c=>c.availableForPeriod>0)}async loadCache(){if(!f(i(this,ns))){m(i(this,he),!0),m(i(this,de),null);try{if(!q.userId){m(i(this,ns),!0);return}_(this,ne,await pm()),await v(this,ie,Yu).call(this),m(i(this,ns),!0),console.log(`[MaterielStore] Cache chargÃ© : ${i(this,fe).size} matÃ©riels, ${i(this,ge).size} emprunts`)}catch(e){throw m(i(this,de),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[MaterielStore] LoadCache error:",e),e}finally{m(i(this,he),!1)}}}async syncFromRemote(){m(i(this,he),!0),m(i(this,de),null);try{if(!q.userId)return;await v(this,ie,Xu).call(this),console.log(`[MaterielStore] Sync terminÃ© : ${i(this,fe).size} matÃ©riels, ${i(this,ge).size} emprunts`)}catch(e){throw m(i(this,de),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[MaterielStore] SyncFromRemote error:",e),e}finally{m(i(this,he),!1)}}async setupRealtime(){if(q.userId){if(i(this,Os)){console.log("[MaterielStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,ie,zu).call(this),m(i(this,Nn),!0),_(this,Os,!0),console.log("[MaterielStore] Realtime configurÃ©")}catch(e){throw m(i(this,de),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[MaterielStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}getMaterielById(e){return i(this,fe).get(e)}getLoanById(e){return i(this,ge).get(e)}async createMateriel(e){m(i(this,he),!0),m(i(this,de),null);try{if(!q.userId)throw new Error("Utilisateur non connectÃ©");const r=await im(e,q.userId),s=v(this,ie,As).call(this,r);return i(this,fe).set(r.$id,s),i(this,ne)?.upsertMateriel(s),s}catch(r){throw m(i(this,de),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{m(i(this,he),!1)}}async updateMateriel(e,r){m(i(this,he),!0),m(i(this,de),null);try{const s=await La(e,r),n=v(this,ie,As).call(this,s);i(this,fe).set(s.$id,n),i(this,ne)?.upsertMateriel(n)}catch(s){throw m(i(this,de),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{m(i(this,he),!1)}}async deleteMateriel(e){m(i(this,he),!0),m(i(this,de),null);try{await om(e),i(this,fe).delete(e),i(this,ne)?.deleteMateriel(e)}catch(r){throw m(i(this,de),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{m(i(this,he),!1)}}async createLoan(e){m(i(this,he),!0),m(i(this,de),null);try{if(!q.userId)throw new Error("Utilisateur non connectÃ©");const r=await lm(e,q.userId);return dn(r)}catch(r){throw m(i(this,de),r instanceof Error?r.message:"Erreur de crÃ©ation",!0),r}finally{m(i(this,he),!1)}}async updateLoan(e,r){m(i(this,he),!0),m(i(this,de),null);try{await um(e,r)}catch(s){throw m(i(this,de),s instanceof Error?s.message:"Erreur de mise Ã  jour",!0),s}finally{m(i(this,he),!1)}}async acceptLoan(e){await this.updateLoan(e,{status:"accepted"})}async refuseLoan(e){await this.updateLoan(e,{status:"refused"})}async cancelLoan(e){await this.updateLoan(e,{status:"canceled"})}async completeLoanWithReturn(e,r){for(const s of r.materiels){const n=s.lostQuantity||0,a=s.brokenQuantity||0;n+a>=s.quantity?await La(s.materielId,{status:"lost"}):a>0?await La(s.materielId,{status:"torepair"}):await La(s.materielId,{status:"ok"})}await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString(),returnNotes:r.returnNotes,materiels:r.materiels})}async completeLoan(e){await this.updateLoan(e,{status:"completed",returnedAt:new Date().toISOString()})}async deleteLoan(e){m(i(this,he),!0),m(i(this,de),null);try{const r=i(this,ge).get(e);r&&v(this,ie,_s).call(this,r),await dm(e)}catch(r){throw m(i(this,de),r instanceof Error?r.message:"Erreur de suppression",!0),r}finally{m(i(this,he),!1)}}async hardReset(){console.log("[MaterielStore] ð HARD RESET - Vidage complet..."),m(i(this,he),!0),m(i(this,de),null);try{if(i(this,fe).clear(),i(this,ge).clear(),i(this,ne)&&(await i(this,ne).clear(),console.log("[MaterielStore] Cache IDB vidÃ©")),await v(this,ie,Zu).call(this),i(this,ne)){for(const[,e]of i(this,fe))await i(this,ne).upsertMateriel(e);for(const[,e]of i(this,ge))await i(this,ne).upsertLoan(e);await i(this,ne).saveMetadata({lastSyncMateriel:f(i(this,Lt)),lastSyncLoans:f(i(this,jt))}),console.log("[MaterielStore] Cache IDB recrÃ©Ã©")}console.log("[MaterielStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,de),r,!0),console.error("[MaterielStore] Erreur hard reset:",e),e}finally{m(i(this,he),!1)}}destroy(){var e;(e=i(this,vi))==null||e.call(this),i(this,fe).clear(),i(this,ge).clear(),_(this,ne,null),_(this,Os,!1)}}fe=new WeakMap,ge=new WeakMap,ne=new WeakMap,he=new WeakMap,de=new WeakMap,ns=new WeakMap,Nn=new WeakMap,Os=new WeakMap,Lt=new WeakMap,jt=new WeakMap,vi=new WeakMap,sr=new WeakMap,bi=new WeakMap,Ei=new WeakMap,Si=new WeakMap,Ln=new WeakMap,ie=new WeakSet,Yu=async function(){if(i(this,ne))try{(await i(this,ne).loadMateriels()).forEach(n=>{i(this,fe).set(n.$id,n)}),(await i(this,ne).loadLoans()).forEach(n=>{const a=dn(n);i(this,ge).set(n.$id,a)});const s=await i(this,ne).loadMetadata();m(i(this,Lt),s.lastSyncMateriel,!0),m(i(this,jt),s.lastSyncLoans,!0),console.log(`[MaterielStore] ${i(this,fe).size} matÃ©riels et ${i(this,ge).size} emprunts chargÃ©s du cache IDB`)}catch(e){console.warn("[MaterielStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Xu=async function(){try{const e=f(i(this,Lt))?[S.greaterThan("$updatedAt",f(i(this,Lt)))]:[],r=await Fc(e);for(const a of r){const o=v(this,ie,As).call(this,a);i(this,fe).set(a.$id,o),i(this,ne)?.upsertMateriel(o)}m(i(this,Lt),new Date().toISOString(),!0);const s=f(i(this,jt))?[S.greaterThan("$updatedAt",f(i(this,jt))),S.limit(100)]:[],n=await el(s);for(const a of n){const o=dn(a);i(this,ge).set(a.$id,o),i(this,ne)?.upsertLoan(a),v(this,ie,_s).call(this,o)}m(i(this,jt),new Date().toISOString(),!0),await i(this,ne)?.saveMetadata({lastSyncMateriel:f(i(this,Lt)),lastSyncLoans:f(i(this,jt))}),console.log("[MaterielStore] Sync terminÃ©")}catch(e){throw console.error("[MaterielStore] Erreur sync:",e),e}},Zu=async function(){try{console.log("[MaterielStore] Chargement complet depuis Appwrite...");const e=await Fc([S.limit(1e3)]);for(const n of e){const a=v(this,ie,As).call(this,n);i(this,fe).set(n.$id,a)}const r=await el([S.limit(1e3)]),s=[];for(const n of r){const a=dn(n);i(this,ge).set(n.$id,a),s.push(a)}for(const n of s)v(this,ie,_s).call(this,n);m(i(this,Lt),new Date().toISOString(),!0),m(i(this,jt),new Date().toISOString(),!0),console.log(`[MaterielStore] ${e.length} matÃ©riels et ${r.length} emprunts chargÃ©s`)}catch(e){throw console.error("[MaterielStore] Erreur chargement complet:",e),e}},zu=async function(){Vt.register(cm(),async e=>{await v(this,ie,Fu).call(this,e)}),Vt.register(fm(),async e=>{await v(this,ie,ed).call(this,e)})},Fu=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Materiel : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Materiel RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=v(this,ie,As).call(this,s);i(this,fe).set(s.$id,a),i(this,ne)?.upsertMateriel(a)}else n==="delete"&&(i(this,fe).delete(s.$id),i(this,ne)?.deleteMateriel(s.$id))}catch(r){console.error("[MaterielStore] Erreur realtime Materiel:",r)}},ed=async function(e){try{const r=e.events,s=e.payload;if(!s){console.warn("[MaterielStore] Realtime Loan : pas de payload dans la rÃ©ponse");return}const n=r.some(a=>a.includes(".create"))?"create":r.some(a=>a.includes(".delete"))?"delete":"update";if(console.log(`[MaterielStore] â¡ï¸ Realtime Loan RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){const a=dn(s);i(this,ge).set(s.$id,a),i(this,ne)?.upsertLoan(s),v(this,ie,_s).call(this,a)}else if(n==="delete"){const a=i(this,ge).get(s.$id);a&&v(this,ie,_s).call(this,a),i(this,ge).delete(s.$id),i(this,ne)?.deleteLoan(s.$id)}}catch(r){console.error("[MaterielStore] Erreur realtime Loan:",r)}},As=function(e){const r=Array.from(i(this,ge).values());return Ku(e,r)},_s=function(e){const r=e.materielItems,s=Array.from(i(this,ge).values());for(const n of r){const a=i(this,fe).get(n.materielId);if(a){const o=ym(a,s);i(this,fe).set(n.materielId,o),i(this,ne)?.upsertMateriel(o)}}};const rl=new Em,Li="teamdocs";async function Sm(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:Li})).rows}catch(t){throw console.error("[appwrite-teamdocs] Error listing documents:",t),t}}async function Im(t,e,r,s){try{const{tables:n,config:a}=await D(),o=[te.read(ae.team(e)),te.update(ae.team(e)),te.delete(ae.team(e))],c=await n.createRow({databaseId:a.databaseId,tableId:Li,rowId:pt.unique(),data:{...t,teamId:e,createdBy:r},permissions:o});return console.log(`[appwrite-teamdocs] Document created: ${c.$id}`),c}catch(n){throw console.error("[appwrite-teamdocs] Error creating document:",n),n}}async function td(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow({databaseId:s.databaseId,tableId:Li,rowId:t,data:e});return console.log(`[appwrite-teamdocs] Document updated: ${t}`),n}catch(r){throw console.error(`[appwrite-teamdocs] Error updating document ${t}:`,r),r}}async function Am(t){try{const{tables:e,config:r}=await D();await e.deleteRow({databaseId:r.databaseId,tableId:Li,rowId:t}),console.log(`[appwrite-teamdocs] Document deleted: ${t}`)}catch(e){throw console.error(`[appwrite-teamdocs] Error deleting document ${t}:`,e),e}}async function _m(t,e){try{await td(t,{lockedBy:e}),console.log(`[appwrite-teamdocs] Lock ${t} mis Ã  jour: ${e||"libÃ©rÃ©"}`)}catch(r){throw console.error(`[appwrite-teamdocs] Erreur verrouillage ${t}:`,r),r}}var ke,Us,Ar,nr,_r,Bs,xs,jn,as,Hs,st,rd,sd,Gr;class Rm{constructor(){y(this,st);y(this,ke,new ht);y(this,Us,new ht);y(this,Ar,P(!1));y(this,nr,P(null));y(this,_r,P(!1));y(this,Bs,P(!1));y(this,xs,!1);y(this,jn,P(null));y(this,as,null);y(this,Hs,z(()=>Array.from(i(this,ke).values())))}get loading(){return f(i(this,Ar))}get error(){return f(i(this,nr))}get isInitialized(){return f(i(this,_r))}get isRealtimeActive(){return f(i(this,Bs))}get count(){return i(this,ke).size}get documents(){return f(i(this,Hs))}getTeamDocuments(e){return f(i(this,Hs)).filter(r=>r.teamId===e)}getTeamTags(e){return i(this,Us).get(e)||[]}async loadCache(){if(!f(i(this,_r))){m(i(this,Ar),!0),m(i(this,nr),null);try{if(!q.userId){m(i(this,_r),!0);return}m(i(this,_r),!0),console.log("[TeamdocsStore] Cache chargÃ© (sans IDB)")}catch(e){throw m(i(this,nr),e instanceof Error?e.message:"Erreur de chargement du cache",!0),console.error("[TeamdocsStore] LoadCache error:",e),e}finally{m(i(this,Ar),!1)}}}async syncFromRemote(){m(i(this,Ar),!0),m(i(this,nr),null);try{if(!q.userId)return;const e=await Sm();for(const r of e)i(this,ke).set(r.$id,r);await v(this,st,Gr).call(this),m(i(this,jn),new Date().toISOString(),!0),console.log(`[TeamdocsStore] Sync terminÃ© : ${i(this,ke).size} documents`)}catch(e){throw m(i(this,nr),e instanceof Error?e.message:"Erreur de synchronisation",!0),console.error("[TeamdocsStore] SyncFromRemote error:",e),e}finally{m(i(this,Ar),!1)}}async setupRealtime(){if(q.userId){if(i(this,xs)){console.log("[TeamdocsStore] Realtime dÃ©jÃ  configurÃ©");return}try{await v(this,st,rd).call(this),m(i(this,Bs),!0),_(this,xs,!0),console.log("[TeamdocsStore] Realtime configurÃ©")}catch(e){throw m(i(this,nr),e instanceof Error?e.message:"Erreur de configuration realtime",!0),console.error("[TeamdocsStore] SetupRealtime error:",e),e}}}async initialize(){await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime()}async createDocument(e,r){if(!q.userId||!q.userName)throw new Error("Utilisateur non connectÃ©");const s=await Im(e,r,q.userId,q.userName);return i(this,ke).set(s.$id,s),await v(this,st,Gr).call(this),console.log(`[TeamdocsStore] Document crÃ©Ã© : ${s.$id}`),s}async updateDocument(e,r){const s=await td(e,r);return i(this,ke).set(e,s),r.tags&&await v(this,st,Gr).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${e}`),s}async deleteDocument(e){await Am(e),i(this,ke).delete(e),await v(this,st,Gr).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${e}`)}getDocumentById(e){return i(this,ke).get(e)}async updateDocumentLock(e,r){if(q.userId)try{await _m(e,r);const s=i(this,ke).get(e);s&&i(this,ke).set(e,{...s,lockedBy:r}),console.log(`[TeamdocsStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`)}catch(s){throw console.error(`[TeamdocsStore] Erreur verrouillage ${e}:`,s),s}}destroy(){i(this,as)&&(i(this,as).call(this),_(this,as,null)),i(this,ke).clear(),i(this,Us).clear(),m(i(this,_r),!1),m(i(this,Bs),!1),_(this,xs,!1),console.log("[TeamdocsStore] Store dÃ©truit")}async hardReset(){this.destroy(),m(i(this,jn),null),console.log("[TeamdocsStore] Hard reset effectuÃ©")}}ke=new WeakMap,Us=new WeakMap,Ar=new WeakMap,nr=new WeakMap,_r=new WeakMap,Bs=new WeakMap,xs=new WeakMap,jn=new WeakMap,as=new WeakMap,Hs=new WeakMap,st=new WeakSet,rd=async function(){const e=["databases.*.collections.undefined"];Vt.register(e,async r=>{await v(this,st,sd).call(this,r)}),_(this,as,()=>{})},sd=async function(e){const{events:r,payload:s}=e,n=r?.[0];if(!n)return;const a=s;switch(n){case"databases.*.collections.*.documents.create":case"databases.*.collections.*.documents.update":a&&(i(this,ke).set(a.$id,a),await v(this,st,Gr).call(this),console.log(`[TeamdocsStore] Document mis Ã  jour : ${a.$id}`));break;case"databases.*.collections.*.documents.delete":a?.$id&&(i(this,ke).delete(a.$id),await v(this,st,Gr).call(this),console.log(`[TeamdocsStore] Document supprimÃ© : ${a.$id}`));break}},Gr=async function(){const e=new Map;for(const r of f(i(this,Hs))){const s=r.teamId;e.has(s)||e.set(s,new Set),r.tags&&r.tags.forEach(n=>{e.get(s).add(n)})}e.forEach((r,s)=>{i(this,Us).set(s,Array.from(r).sort())}),console.log(`[TeamdocsStore] Tags mis Ã  jour pour ${e.size} Ã©quipes`)};const sl=new Rm;var qn,Vs,Ws,xr,nd,ad,id;class Pm{constructor(){y(this,xr);y(this,qn,P(!1));y(this,Vs,!1);y(this,Ws,[])}async initialize(){const e=q.userId;if(!e){console.error("[NotificationStore] No userId found, cannot initialize");return}const r=ut();try{const n=await(await D()).tables.getRow({databaseId:r,tableId:"user_notifications",rowId:e});_(this,Ws,JSON.parse(n.notifications||"[]")),console.log(`[NotificationStore] User row found for ${e}`)}catch(s){if(s.code===404)console.log(`[NotificationStore] User row not found, creating lazy init for ${e}`),await v(this,xr,id).call(this,e),_(this,Ws,[]);else throw console.error("[NotificationStore] Error fetching user row:",s),s}await this.setupRealtime()}async setupRealtime(){if(i(this,Vs)){console.log("[NotificationStore] Already initialized, skipping.");return}try{console.log("[NotificationStore] Setting up realtime...");const e=ut();Vt.register([`databases.${e}.collections.user_notifications.documents`],async r=>await v(this,xr,nd).call(this,r)),m(i(this,qn),!0),_(this,Vs,!0),console.log("[NotificationStore] â Realtime configured (RealtimeManager)")}catch(e){throw console.error("[NotificationStore] Error configuring realtime:",e),e}}destroy(){m(i(this,qn),!1),_(this,Vs,!1),_(this,Ws,[]),console.log("[NotificationStore] Store destroyed")}}qn=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,xr=new WeakSet,nd=async function(e){console.log("[NotificationStore] ð¨ Raw realtime event:",{events:e.events,channels:e.channels,payload:e.payload});const r=e.payload,s=q.userId,n=q.currentMainId;if(console.log("[NotificationStore] ð Context check:",{payloadScope:r.scope,payloadId:r.$id,currentUserId:s,currentMainId:n}),r.scope==="event"&&!n){console.log("[NotificationStore] â ï¸ Ignored: event scope but no currentMainId");return}if(r.scope==="user"){if(r.$id!==s){console.log("[NotificationStore] â ï¸ Ignored: user ID mismatch");return}}else if(r.scope==="event"){if(r.$id!==n){console.log("[NotificationStore] â ï¸ Ignored: event ID mismatch");return}}else{console.log("[NotificationStore] â ï¸ Ignored: invalid scope");return}if(console.log("[NotificationStore] â Event passed filters, processing..."),e.events.some(a=>a.includes(".update"))){console.log("[NotificationStore] â Update event detected");const a=JSON.parse(r.notifications||"[]");console.log("[NotificationStore] ð Notifications to process:",a);for(const o of a)await v(this,xr,ad).call(this,o)}else console.log("[NotificationStore] â ï¸ Ignored: not an update event",e.events)},ad=async function(e){switch(console.log("[NotificationStore] ð Processing notification:",e),e.type){case"team_access_granted":await yt.reload(),Je.success("Nouvelle Ã©quipe ajoutÃ©e");break;case"event_access_granted":console.log("[NotificationStore] ð event_access_granted received");const r=e.targetDocumentId;await Ne.fetchEvent(r)?(console.log(`[NotificationStore] â Event ${r} fetched successfully`),Je.success("Nouvel Ã©vÃ©nement disponible")):(console.log(`[NotificationStore] â ï¸ Failed to fetch ${r}, falling back to reload()`),await Ne.reload(),Je.success("Nouvel Ã©vÃ©nement disponible"));break;case"batch_products_update":console.log("[NotificationStore] ð batch_products_update received"),e.targetDocumentId===q.currentMainId?(console.log("[NotificationStore] â Calling productsStore.syncFromAppwrite()"),await Od.syncFromAppwrite(),e.from&&e.from!==q.userId&&(e.from==="system"?Je.info("Produits mis Ã  jour",{source:"system"}):Je.info("Produits modifiÃ©s par un autre utilisateur",{source:"realtime-other"}))):console.log("[NotificationStore] â ï¸ Ignored: mainId mismatch",{notificationTarget:e.targetDocumentId,currentMain:q.currentMainId});break;default:console.log("[NotificationStore] â Unknown notification type:",e.type)}},id=async function(e){const r=ut();await(await D()).tables.createRow({databaseId:r,tableId:"user_notifications",rowId:e,data:{scope:"user",notifications:JSON.stringify([])},permissions:[te.read(ae.user(e)),te.update(ae.user(e))]}),console.log(`[NotificationStore] User row created for ${e}`)};const Dm=new Pm;function ii(t,e){if(e)for(const r in e)t=t.replace(`:${r}`,String(e[r]));return le.name==="#"?t==="/"?"/#/":oi("#",t):le.name?oi(le.name,t):t}function Mm(t,e){let r=ii(t,e?.params);return e?.search&&(r+=Uo(e.search)),e?.hash&&!e.hash.startsWith("#")&&(r+="#"+e.hash),r}function od(t){return Promise.all(t.map(e=>$m(e)))}function $m(t){return new Promise(e=>{km(t)?Promise.resolve(t()).then(r=>{e(r.default)}):e(t)})}function km(t){return typeof t=="function"&&!!/\(\)\s?=>\s?(import|__vite_ssr_dynamic_import__)\(.*\)/.test(String(t))}function oi(...t){let e="";for(let r of t)r.startsWith("/")||(e+="/"),r.endsWith("/")&&(r=r.slice(0,-1)),e+=r;return e}function qo(t){return le.name&&t.startsWith(le.name)&&(t=t.slice(le.name.length)||"/"),t}function Oo(){const t=le.name==="#"?globalThis.location.hash.slice(1):globalThis.location.pathname,e=le.name==="#"?"":globalThis.location.hash;return{pathname:t,search:globalThis.location.search,state:history.state,hash:e}}function Uo(t){if(!t)return;if(typeof t=="string")return t.startsWith("?")||(t="?"+t),t;const e=Object.fromEntries(Object.entries(t).map(([s,n])=>[s,String(n)]));return Object.keys(e).length===0?void 0:"?"+new URLSearchParams(e).toString()}function Bo(t){if(!t)return{};if(typeof t=="string"){const e=new URLSearchParams(t);return Object.fromEntries([...e.entries()].map(([r,s])=>[r,gn(s)]))}return t}function gn(t){if(t==="")return"";if(t==="true")return!0;if(t==="false")return!1;const e=Number(t);return Number.isNaN(e)?t:e}function co(t,e){return cd((r,s)=>r===s,t,e)}co.startsWith=(t,e)=>cd((r,s)=>r.startsWith(s),t,e);function cd(t,e,r){if(!e.includes(":"))return t(Ee.pathname,e);if(r)return le.name==="#"?t(Ee.pathname,ii(e,r).replace("/#","")):t(Ee.pathname,ii(e,r));const s=e.split("/").slice(1);let n=Ee.pathname.split("/").slice(1);if(s.length>n.length)return!1;for(const[a,o]of s.entries()){const c=n[a];if(!o.startsWith(":")&&o!==c)return!1}return!0}function xo(t,e){t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1));const r=t.split("/").slice(1),s=Cm(Object.keys(e));let n,a=[],o=[],c={},l={};const u=e["/"];u&&typeof u=="object"&&"meta"in u&&u.meta&&(l={...l,...u.meta});let d=!1;e:for(const h of s){const p=h.split("/");p[0]===""&&p.shift();for(let[g,w]of p.entries()){d=w.startsWith("(")&&w.endsWith(")"),d&&(w=w.slice(1,-1));const A=r[g];if(w.startsWith(":"))c[w.slice(1)]=decodeURIComponent(A);else if(w.startsWith("*")){const W=w.slice(1);W&&(c[W]=r.slice(g).map(decodeURIComponent).join("/")),d?(w=`(${w})`,a=[]):"layout"in e&&e.layout&&a.push(e.layout);const x=(g?"/":"")+p.join("/");n=e[x];break e}else if(w.toLowerCase()!==A?.toLowerCase())break;if(g!==p.length-1)continue;const E=e["/"+p.join("/")];if(typeof E=="function"&&p.length!==r.length)continue;if(!d&&"layout"in e&&e.layout&&a.push(e.layout),"hooks"in e&&e.hooks&&o.push(e.hooks),"meta"in e&&e.meta&&(l={...l,...e.meta}),typeof E=="function"){if(p.length===r.length){n=E;break e}continue}const I="/"+r.slice(g+1).join("/"),k=xo(I,E);if(k.match)n=k.match,c={...c,...k.params},o.push(...k.hooks),l={...l,...k.meta},k.breakFromLayouts?a=[]:a.push(...k.layouts);else continue;break e}}return{match:n,layouts:a,hooks:o,params:c,meta:l,breakFromLayouts:d}}function Cm(t){return t.toSorted((e,r)=>nl(e)-nl(r))}function nl(t){return t===""||t==="/"?1:t.includes("*")?4:t.includes(":")?3:2}const Tm=200,Nm=Math.PI/6,Lm=50;async function ld(t,e,r){const{match:s,layouts:n,hooks:a,meta:o}=xo(e,t);for(const{onPreload:c}of a)c?.({pathname:e,meta:o,...r,search:Bo(r?.search)});await od(s?[...n,s]:n)}const al=new Set,bs=new Set;function jm(t){function e(o){if(!o.getAttribute("href"))return;const l=new URL(o.href),u=qo(l.pathname),{replace:d,state:h}=o.dataset;ld(t,u,{replace:d===""||d==="true",search:l.search,state:h,hash:l.hash})}let r=null;function s(o){if(!o.getPredictedEvents||r)return;if(r=setTimeout(()=>{r=null},Lm),bs.size===0){document.removeEventListener("pointermove",s);return}const l=o.getPredictedEvents().at(-1);if(!l)return;const u=o.clientX,d=o.clientY,h=l.clientX-u,p=l.clientY-d,g=Math.hypot(h,p);if(g<2)return;const w=h/g,A=p/g;e:for(const E of bs){E.isConnected||bs.delete(E);const I=E.getBoundingClientRect(),k=[{x:I.left,y:I.top},{x:I.right,y:I.top},{x:I.left,y:I.bottom},{x:I.right,y:I.bottom},{x:I.left+I.width/2,y:I.top+I.height/2}];for(const W of k){const x=W.x-u,J=W.y-d,L=Math.hypot(x,J);if(L>Tm||L<.001)continue;const U=x/L,F=J/L,se=w*U+A*F;if(Math.acos(Math.max(-1,Math.min(1,se)))<=Nm){e(E),bs.delete(E);continue e}}}}const n=new IntersectionObserver(o=>{for(const c of o)c.isIntersecting&&(n.unobserve(c.target),e(c.target))});new MutationObserver(()=>{const o=document.querySelectorAll("a[data-preload]");for(const c of o)if(!al.has(c)){switch(al.add(c),c.dataset.preload){case"":case"hover":{c.addEventListener("mouseenter",function l(){c.removeEventListener("mouseenter",l),e(c)});break}case"predict":{bs.size===0&&document.addEventListener("pointermove",s),bs.add(c);break}case"viewport":{n.observe(c);break}default:{console.warn(`Unknown preload strategy \`${c.dataset.preload}\` on`,c,`
Available strategies are: hover, viewport, predict`);break}}c.addEventListener("focus",function l(){c.removeEventListener("focus",l),e(c)})}}).observe(document.body,{subtree:!0,childList:!0})}class il extends Error{constructor(e){super(`Navigating to: ${e}`),this.name="Redirect"}}let be=new Gh(globalThis.location.search);const qm={append(t,e,r){be.append(t,String(e)),ja(r)},delete(t,e,r){be.delete(t,e===void 0?void 0:String(e)),ja(r)},entries(){return[...be.entries()].map(([t,e])=>[t,gn(e)])},forEach(...t){return be.forEach(...t)},get(...t){const e=be.get(...t);return e===null?null:gn(e)},getAll(...t){return be.getAll(...t).map(gn)},has(...t){return be.has(...t)},keys(){return be.keys()},set(t,e,r){be.set(t,String(e)),ja(r)},sort(t){be.sort(),ja(t)},toString(){return be.toString()},values(){return[...be.values()].map(gn)},get size(){return be.size},[Symbol.iterator](){return be[Symbol.iterator]()}};function ol(t){if(be.toString()===t)return;const e=new URLSearchParams(t);for(const[r,s]of e)be.set(r,s);for(const r of be.keys())e.has(r)||be.delete(r)}function ja(t){const e=new URL(globalThis.location.toString());e.search=be.toString(),globalThis.history[t?.replace?"replaceState":"pushState"]({},"",e)}let bn;const le={name:void 0};let lo=pe({value:[]}),Ee=pe({pathname:"/",search:"",state:null,hash:""});queueMicrotask(()=>{const t=Oo();Ee.pathname=t.pathname,Ee.search=t.search,Ee.state=t.state,Ee.hash=t.hash});let uo=pe({value:{}}),ud=pe({value:{}}),Ga=null,Qi=0,cl=0;function Om(t){if(t){const e=new URL(globalThis.location.toString());t==="#"?(le.name="#",globalThis.location.href.includes("#")||(e.hash="/",history.replaceState(history.state||{},"",e.toString()))):(le.name=(t.startsWith("/")?"":"/")+t,e.pathname.startsWith(le.name)||(e.pathname=oi(le.name,e.pathname),history.replaceState(history.state||{},"",e.toString())))}Object.assign(Ee,Oo())}function Um(t){return bn=t,jm(bn),{p:Mm,navigate:Bm,isActive:co,async preload(e){await ld(bn,e)},route:{get params(){return uo.value},getParams(e){if(!co(e))throw new Error(`\`${e}\` does not match the current route`);return uo.value},get pathname(){return qo(Ee.pathname)},get search(){return Bo(Ee.search)},get state(){return Ee.state},get hash(){return Ee.hash},get meta(){return ud.value}}}}function Bm(t,e={}){return typeof t=="number"?(globalThis.history.go(t),new il(`History entry: ${t}`)):(t=ii(t,e.params),le.name==="#"?t=t.replace("/#",""):e.hash&&!e.hash.startsWith("#")&&(e.hash="#"+e.hash),ci(t,e),new il(`${t}${Uo(e?.search??"")}${e?.hash??""}`))}async function ci(t,e={}){if(!bn)throw new Error("Router not initialized: `createRouter` was not called.");if(Ga){if(!Ga()){const w=new URL(globalThis.location.toString());w.search=Ee.search,w.hash=Ee.hash,le.name==="#"?w.hash=Ee.pathname:w.pathname=Ee.pathname,globalThis.history.replaceState(Is(Ee.state)||{},"",w.toString());return}Ga=null}Qi++;const r=Qi,s=xm(t),{match:n,layouts:a,hooks:o,meta:c,params:l}=xo(s,bn),u=Bo(e.search),d={pathname:s,meta:c,...e,search:u};let h=[];for(const w of o)try{const{beforeLoad:A}=w;h.push(w),cl=r,await A?.(d)}catch(A){for(const{onError:E}of h)E?.(A,d);return}const p=new Error().stack?.includes("beforeLoad");let g;try{g=await od(n?[...a,n]:a)}catch(w){for(const{onError:A}of o)A?.(w,d);throw w}if(!(Qi!==r||p&&cl+1!==r)){if(t){const w=Uo(e.search),A=new URL(globalThis.location.toString());A.search=w||"",A.hash=e.hash||"",le.name==="#"?A.hash=t:le.name&&!t.startsWith(le.name)?A.pathname=oi(le.name,t):A.pathname=t;const E=e.replace?"replaceState":"pushState";globalThis.history[E](e.state||{},"",A.toString()),ol(w)}else ol(globalThis.location.search);e.viewTransition&&document.startViewTransition!==void 0?document.startViewTransition(()=>{lo.value=g}):lo.value=g,uo.value=l,ud.value=c,Object.assign(Ee,Oo()),e.scrollToTop!==!1&&window.scrollTo({top:0,left:0,behavior:e.scrollToTop});for(const{afterLoad:w}of o)w?.(d)}}function xm(t){let e;return t?e=t:le.name==="#"?e=globalThis.location.hash.slice(1):e=globalThis.location.pathname,le.name&&e.startsWith(le.name)&&(e=e.slice(le.name.length)||"/"),qo(e)}function Hm(t){const e=t.target.closest("a");if(!e||e.hasAttribute("target")||e.hasAttribute("download")||!e.hasAttribute("href")||e.getAttribute("href")?.startsWith("#"))return;const r=new URL(e.href),s=globalThis.location.origin;if(r.origin!==s)return;const n=le.name==="#"?r.hash:r.pathname,a=le.name==="#"?void 0:r.hash;t.preventDefault();const{replace:o,state:c,scrollToTop:l,viewTransition:u}=e.dataset;let d;if(c)try{d=JSON.parse(c)}catch{d=c}ci(n,{replace:o===""||o==="true",search:r.search,state:d,hash:a,scrollToTop:l==="false"?!1:l,viewTransition:u===""||u==="true"})}function Vm(t){Ga=t}function dd(t,e){Eo(e,!0);const r=z(()=>e.tree[0]),s=z(()=>e.tree.slice(1));var n=hc(),a=cc(n);wh(a,()=>f(r),(o,c)=>{c(o,{children:(l,u)=>{var d=hc(),h=cc(d);{var p=g=>{dd(g,{get tree(){return f(s)}})};ph(h,g=>{f(s).length>0&&g(p)})}pc(l,d)},$$slots:{default:!0}})}),pc(t,n),So()}function Wm(t,e){Eo(e,!0),Om(e.base),ci(),Or(()=>{const r=zs(globalThis,"popstate",()=>ci()),s=zs(globalThis,"click",Hm);return()=>{r(),s()}}),dd(t,{get tree(){return lo.value}}),So()}const Kt={async beforeLoad({pathname:t}){if(!q.isAuthenticated){console.log(`[AuthGuard] AccÃ¨s refusÃ© Ã  ${t} > Redirection /`);const{navigate:e}=await V(async()=>{const{navigate:r}=await Promise.resolve().then(()=>fd);return{navigate:r}},void 0);throw e("/",{replace:!0})}}},Gm={async beforeLoad({pathname:t}){const{navigate:e}=await V(async()=>{const{navigate:a}=await Promise.resolve().then(()=>fd);return{navigate:a}},void 0),r=t.match(/^\/demo\/event\/(?:recipes|products|posters)?\/?([^/]+)?$/);if(!r)throw console.log("[LocalEventGuard] Pattern invalide > Redirection /"),e("/",{replace:!0});const s=r[1];if(!s){console.log("[LocalEventGuard] Route de base sans ID > AccÃ¨s autorisÃ©");return}const n=30;for(let a=0;a<n;a++){const o=Ne.getEventById(s);if(o){if(o.status!=="local")throw console.log("[LocalEventGuard] Event non local > Redirection /"),e("/",{replace:!0});console.log("[LocalEventGuard] Event local validÃ©:",s);return}await new Promise(c=>setTimeout(c,100))}throw console.log("[LocalEventGuard] Event introuvable aprÃ¨s timeout > Redirection /"),e("/",{replace:!0})}},Qm={"/":()=>V(()=>import("./HomePage.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),"/verify-email":()=>V(()=>import("./VerifyEmailPage.js"),__vite__mapDeps([8,1,2,3])),"/recipe":()=>V(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3])),"/recipe/:uuid":()=>V(()=>import("./RecipeDetailPage.js"),__vite__mapDeps([18,15,19,20,2,10,21,5,22,23,1,3])),"/accept-invite":()=>V(()=>import("./AcceptInvite.js"),__vite__mapDeps([24,1,2,3])),"/reset-password":()=>V(()=>import("./ResetPassword.js"),__vite__mapDeps([25,2,26])),"/dashboard":{hooks:Kt,"/":()=>V(()=>import("./DashboardPage.js"),__vite__mapDeps([27,1,2,3,28,29,30,31,32,20,33,34,6])),"/teams":()=>V(()=>import("./TeamsManagement.js"),__vite__mapDeps([35,2,29,30,1,3,31])),"/eventCreate":()=>V(()=>import("./EventCreatePage.js"),__vite__mapDeps([36,37,12,2,30,1,3,20,28,4,10])),"/materiel":()=>V(()=>import("./MaterielPage.js"),__vite__mapDeps([38,1,2,3,28,14,13,10,16])),"/materiel/:teamId":()=>V(()=>import("./MaterielPage.js"),__vite__mapDeps([38,1,2,3,28,14,13,10,16])),"/loans":()=>V(()=>import("./LoansPage.js"),__vite__mapDeps([39,1,2,3,11,12,40,14,28])),"/loans/:teamId":()=>V(()=>import("./LoansPage.js"),__vite__mapDeps([39,1,2,3,11,12,40,14,28])),"/loans/return/:loanId":()=>V(()=>import("./LoanReturnPage.js"),__vite__mapDeps([41,1,2,3,28])),"/eventEdit":{"/:id":()=>V(()=>import("./EventEditPage.js"),__vite__mapDeps([42,37,12,2,30,1,3,20,28,4,10,43,33,44,14,40,45])),"/recipes/:id":()=>V(()=>import("./EventRecipesPage.js"),__vite__mapDeps([46,33,44,2,28,19,20,10,21,5,22,15,16,11,12,1,3,47])),"/products/:id":()=>V(()=>import("./EventProductsPage.js"),__vite__mapDeps([48,28,40,14,2,31,1,3,20,10,44,33,43,16,49])),"/posters/:id":()=>V(()=>import("./EventPosterPage.js"),__vite__mapDeps([50,1,2,3,43,10,30,16,51]))}},"/recipe/my":{hooks:Kt,"/":()=>V(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3])),"/draft":()=>V(()=>import("./RecipesListPage.js"),__vite__mapDeps([9,2,10,11,12,13,14,15,16,17,1,3]))},"/recipe/new":{hooks:Kt,"/":()=>V(()=>import("./RecipeCreatePage.js"),__vite__mapDeps([52,17,1,2,3,53,20,54,10,40,14,55,45]))},"/recipe/:uuid/edit":(()=>{const t=()=>V(()=>import("./RecipeEditPage.js"),__vite__mapDeps([56,17,1,2,3,53,20,54,10,40,14,55,11,12,30,45,23]));return t.hooks=Kt,t})(),"/recipe/:uuid/duplicate":(()=>{const t=()=>V(()=>import("./RecipeCreatePage.js"),__vite__mapDeps([52,17,1,2,3,53,20,54,10,40,14,55,45]));return t.hooks=Kt,t})(),"/eventList":{hooks:Kt,"/":()=>V(()=>import("./EventListPage.js"),__vite__mapDeps([57,1,2,3,32,20,33]))},"/createdocument/:teamId/new":(()=>{const t=()=>V(()=>import("./CreateDocumentPage.js"),__vite__mapDeps([58,1,2,3,59,54,60,40,14,61]));return t.hooks=Kt,t})(),"/editdocument/:teamId/:docId":(()=>{const t=()=>V(()=>import("./EditDocumentPage.js"),__vite__mapDeps([62,1,2,3,59,54,60,40,14,45,21,5,22,63]));return t.hooks=Kt,t})(),"/documents/:teamId":(()=>{const t=()=>V(()=>import("./DocumentListPage.js"),__vite__mapDeps([64,1,2,3,34,28]));return t.hooks=Kt,t})(),"/demo/event/:id":{hooks:Gm,"/":()=>V(()=>import("./EventEditPage.js"),__vite__mapDeps([42,37,12,2,30,1,3,20,28,4,10,43,33,44,14,40,45])),"/recipes":()=>V(()=>import("./EventRecipesPage.js"),__vite__mapDeps([46,33,44,2,28,19,20,10,21,5,22,15,16,11,12,1,3,47])),"/products":()=>V(()=>import("./EventProductsPage.js"),__vite__mapDeps([48,28,40,14,2,31,1,3,20,10,44,33,43,16,49])),"/posters":()=>V(()=>import("./EventPosterPage.js"),__vite__mapDeps([50,1,2,3,43,10,30,16,51]))},"(*)":()=>V(()=>import("./NotFoundPage.js"),__vite__mapDeps([65,5,1,2,3]))},{p:Jm,navigate:Km,preload:Ym,route:fo}=Um(Qm),Xm=Wm,fd=Object.freeze(Object.defineProperty({__proto__:null,Router:Xm,blockNavigation:Vm,navigate:Km,p:Jm,preload:Ym,route:fo,searchParams:qm},Symbol.toStringTag,{value:"Module"}));var oe,et,Rr,Pr,is,Ii,ar,os,Gs,On,Un,Bn,xn;class Zm{constructor(){N(this,"isMobileQuery",new Pc("max-width: 768px"));N(this,"isDesktopQuery",new Pc("min-width: 1024px"));y(this,oe,P(null));y(this,et,P(pe([])));y(this,Rr,P(!1));y(this,Pr,P(null));y(this,is,P(!1));y(this,Ii,z(()=>{const e=fo.pathname,r=fo.params.id;return e.includes("/eventEdit/")&&r?(console.log(`[GlobalState] â currentMainId dÃ©rivÃ©: ${r}`),r):(console.log(`[GlobalState] â ï¸ Pas de mainId: path=${e}, params.id=${r}`),null)}));y(this,ar,P(0));y(this,os,P(!0));y(this,Gs,P("down"));y(this,On,P(pe({isOpen:!1,conflicts:[]})));y(this,Un,P(pe({isOpen:!1})));y(this,Bn,P(pe({isRunning:!1,name:"",progress:0})));y(this,xn,P(pe({isOpen:!1,showLogin:!0})))}get user(){return f(i(this,oe))}get userId(){return f(i(this,oe))?.$id??null}get userEmail(){return f(i(this,oe))?.email??null}get userTeams(){return f(i(this,et))}get isAuthenticated(){return f(i(this,oe))!==null}get authLoading(){return f(i(this,Rr))}get authError(){return f(i(this,Pr))}get authInitialized(){return f(i(this,is))}async initializeAuth(){if(f(i(this,is))){console.log("[GlobalState] Authentification dÃ©jÃ  initialisÃ©e");return}console.log("[GlobalState] Initialisation de l'authentification..."),m(i(this,Rr),!0),m(i(this,Pr),null);try{const{account:e}=await D();m(i(this,oe),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,oe)).name),localStorage.setItem("appwrite-user-email",f(i(this,oe)).email),localStorage.setItem("appwrite-user-id",f(i(this,oe)).$id),await yt.initialize(),m(i(this,et),yt.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] AuthentifiÃ©: ${f(i(this,oe)).name} (${f(i(this,et)).length} Ã©quipes)`)}catch(e){m(i(this,oe),null),m(i(this,et),[],!0),m(i(this,Pr),e instanceof Error?e.message:"Erreur d'authentification",!0),console.log("[GlobalState] Utilisateur non connectÃ©")}finally{m(i(this,Rr),!1),m(i(this,is),!0)}}async refreshAuthAfterLogin(){console.log("[GlobalState] RÃ©initialisation aprÃ¨s login..."),m(i(this,Rr),!0),m(i(this,Pr),null);try{const{account:e}=await D();m(i(this,oe),await e.get(),!0),localStorage.setItem("appwrite-user-name",f(i(this,oe)).name),localStorage.setItem("appwrite-user-email",f(i(this,oe)).email),localStorage.setItem("appwrite-user-id",f(i(this,oe)).$id),await yt.initialize(),await Ne.syncFromRemote(),await Ne.setupRealtime(),await rl.syncFromRemote(),await rl.setupRealtime(),await sl.syncFromRemote(),await sl.setupRealtime(),await Dm.initialize(),await Vt.initialize(),m(i(this,et),yt.myTeams.map(r=>r.$id),!0),console.log(`[GlobalState] RÃ©initialisÃ© aprÃ¨s login: ${f(i(this,oe)).name} (${f(i(this,et)).length} Ã©quipes)`)}catch(e){console.error("[GlobalState] Erreur lors de la rÃ©initialisation:",e),m(i(this,Pr),e instanceof Error?e.message:"Erreur de rÃ©initialisation",!0)}finally{m(i(this,Rr),!1)}}async logout(){try{const{account:e}=await D();await e.deleteSession({sessionId:"current"}),$u(),localStorage.removeItem("appwrite-user-name"),localStorage.removeItem("appwrite-user-email"),localStorage.removeItem("appwrite-user-id"),m(i(this,oe),null),m(i(this,et),[],!0),m(i(this,is),!1),console.log("[GlobalState] DÃ©connexion rÃ©ussie")}catch(e){throw console.error("[GlobalState] Erreur lors de la dÃ©connexion:",e),e}}async refreshTeams(){if(!f(i(this,oe))){console.warn("[GlobalState] Impossible de rafraÃ®chir les Ã©quipes: utilisateur non connectÃ©");return}try{await yt.syncFromRemote();const e=yt.myTeams.map(r=>r.$id);(e.length>0||f(i(this,et)).length===0)&&(m(i(this,et),e,!0),console.log(`[GlobalState] Ãquipes rafraÃ®chies: ${f(i(this,et)).length}`))}catch(e){console.error("[GlobalState] Erreur lors du rafraÃ®chissement des Ã©quipes:",e)}}isTeamOwner(e){if(!f(i(this,oe)))return!1;const r=yt.myTeams.find(n=>n.$id===e);return r?r.members.find(n=>n.id===f(i(this,oe)).$id)?.roles?.includes("owner")??!1:!1}hasTeamRole(e,r){if(!f(i(this,oe)))return!1;const s=yt.myTeams.find(a=>a.$id===e);return s?s.members.find(a=>a.id===f(i(this,oe)).$id)?.roles?.includes(r)??!1:!1}get currentMainId(){return f(i(this,Ii))}get isMobile(){return this.isMobileQuery.current}get isDesktop(){return this.isDesktopQuery.current}get headerVisible(){return f(i(this,os))}get scrollDirection(){return f(i(this,Gs))}initializeScrollDirection(){Or(()=>{const e=Pp.current??0;if(e>f(i(this,ar))?m(i(this,Gs),"down"):e<f(i(this,ar))&&m(i(this,Gs),"up"),this.isDesktop){m(i(this,os),!0),m(i(this,ar),e,!0);return}e>f(i(this,ar))&&e>100?m(i(this,os),!1):e<f(i(this,ar))&&m(i(this,os),!0),m(i(this,ar),e,!0)})}get userName(){return f(i(this,oe))?.name||localStorage.getItem("appwrite-user-name")||""}get toasts(){return Je.toasts}get toast(){return Je}get modalOverride(){return f(i(this,On))}set modalOverride(e){m(i(this,On),e,!0)}get modal(){return f(i(this,Un))}set modal(e){m(i(this,Un),e,!0)}get backgroundOperation(){return f(i(this,Bn))}set backgroundOperation(e){m(i(this,Bn),e,!0)}get authModal(){return f(i(this,xn))}set authModal(e){m(i(this,xn),e,!0)}}oe=new WeakMap,et=new WeakMap,Rr=new WeakMap,Pr=new WeakMap,is=new WeakMap,Ii=new WeakMap,ar=new WeakMap,os=new WeakMap,Gs=new WeakMap,On=new WeakMap,Un=new WeakMap,Bn=new WeakMap,xn=new WeakMap;const q=new Zm;var Hn,Vn;class zm{constructor(){y(this,Hn,P("survolez des Ã©lÃ©ment pour obtenir de l'aide"));y(this,Vn,P(!0));N(this,"reset",()=>{this.msg="survolez des Ã©lÃ©ment pour obtenir de l'aide"});N(this,"toggle",()=>{this.isExpanded=!this.isExpanded});N(this,"expand",()=>{this.isExpanded=!0});N(this,"collapse",()=>{this.isExpanded=!1})}get msg(){return f(i(this,Hn))}set msg(e){m(i(this,Hn),e,!0)}get isExpanded(){return f(i(this,Vn))}set isExpanded(e){m(i(this,Vn),e,!0)}get help(){return this.msg}set help(e){this.msg=e}}Hn=new WeakMap,Vn=new WeakMap;const Oy=new zm;async function Uy(t,e,r,s,n=!1){try{const{functions:a,config:o}=await D(),c=o.functions.enkaData,l=JSON.stringify({action:t,recipeId:e,userId:r,data:s}),u=await a.createExecution({functionId:c,body:l,async:n});if(n){if(u.status==="failed")throw new Error(`Function execution failed to start: ${u.status}`);return{success:!0,executionId:u.$id}}if(u.status!=="completed")throw new Error(`Function execution failed: ${u.status} - ${u.responseBody}`);const d=JSON.parse(u.responseBody);if(!d.success)throw new Error(d.error||"Unknown error in manage_recipe");return d.data}catch(a){throw console.error(`[appwrite-recipes] Error executing manage_recipe (${t}):`,a),a}}const ys="recettes";async function ll(){try{const{tables:t,config:e}=await D();return(await t.listRows({databaseId:e.databaseId,tableId:ys})).rows}catch(t){throw console.error("[appwrite-recipes] Error listing all recipes:",t),t}}async function Fm(t){try{const{tables:e,config:r}=await D(),s=[S.greaterThan("$updatedAt",t)];return(await e.listRows({databaseId:r.databaseId,tableId:ys,queries:s})).rows}catch(e){throw console.error(`[appwrite-recipes] Error listing updated recipes since ${t}:`,e),e}}async function Ji(t){try{const{tables:e,config:r}=await D();return await e.getRow({databaseId:r.databaseId,tableId:ys,rowId:t})}catch(e){if(e.code===404)return null;throw console.error(`[appwrite-recipes] Error getting recipe ${t}:`,e),e}}async function By(t,e){try{const{tables:r,config:s,account:n}=await D(),a=Rp(t.title,t.versionLabel||void 0),o=[te.read(ae.users()),te.update(ae.user(e)),te.delete(ae.user(e))],l=(await n.get()).name,u={title:t.title,plate:t.plate,ingredients:t.ingredients,preparation:t.preparation,draft:t.draft??!0,typeR:t.typeR,categories:t.categories??[],regime:t.regime??[],check:t.check??!1,description:t.description??null,quantite_desc:t.quantite_desc??null,region:t.region??null,saison:t.saison??[],cuisson:t.cuisson??[],serveHot:t.serveHot??!0,auteur:l,preparation24h:t.preparation24h??null,astuces:t.astuces??null,publishedAt:t.publishedAt||new Date().toISOString().split("T")[0]+"T00:00:00Z",$id:a,createdBy:e,permissionWrite:t.permissionWrite||[e],rootRecipeId:t.rootRecipeId??null,versionLabel:t.versionLabel??null},d=await r.createRow({databaseId:s.databaseId,tableId:ys,rowId:a,data:u,permissions:o});return console.log(`[appwrite-recipes] Recipe created: ${a}`),d}catch(r){throw console.error("[appwrite-recipes] Error creating recipe:",r),r}}async function eg(t,e,r){try{const{tables:s,config:n}=await D(),a={...e,check:e.check??!1,...e.publishedAt&&{publishedAt:e.publishedAt}},o=await s.updateRow({databaseId:n.databaseId,tableId:ys,rowId:t,data:a});return console.log(`[appwrite-recipes] Recipe updated: ${t}`),o}catch(s){throw console.error(`[appwrite-recipes] Error updating recipe ${t}:`,s),s}}async function xy(t){try{const{tables:e,config:r}=await D();await e.updateRow({databaseId:r.databaseId,tableId:ys,rowId:t,data:{status:"deleted"}}),console.log(`[appwrite-recipes] Recipe soft deleted: ${t}`)}catch(e){throw console.error(`[appwrite-recipes] Error deleting recipe ${t}:`,e),e}}const tg="/api/data.json";var K,Ce,qe,Dr,Wn,H,qt,Mr,Qs,je,Qa,hd,pd,ho,po;class rg{constructor(){y(this,je);y(this,K,P(pe(new ht)));y(this,Ce,P(!1));y(this,qe,P(null));y(this,Dr,P(!1));y(this,Wn,P(null));y(this,H,null);y(this,qt,new Set);y(this,Mr,null);y(this,Qs,!1)}get loading(){return f(i(this,Ce))}get error(){return f(i(this,qe))}get isInitialized(){return f(i(this,Dr))}get recipesIndex(){return Array.from(f(i(this,K)).values())}get count(){return f(i(this,K)).size}getAllRecipes(){return Array.from(f(i(this,K)).values())}async loadCache(){if(f(i(this,Dr))){console.log("[RecipesStore] Cache dÃ©jÃ  chargÃ©");return}console.log("[RecipesStore] Chargement du cache..."),m(i(this,Ce),!0),m(i(this,qe),null);try{_(this,H,await fp());const e=await i(this,H).loadRecipesIndex(),r=await i(this,H).loadMetadata();e.size>0&&(console.log(`[RecipesStore] ${e.size} recettes (index) chargÃ©es depuis le cache`),m(i(this,K),new ht(e),!0)),m(i(this,Dr),!0),console.log(`[RecipesStore] Cache chargÃ©: ${f(i(this,K)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors du chargement du cache";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Ce),!1)}}async syncFromRemote(){if(!i(this,H)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation depuis sources distantes..."),m(i(this,Ce),!0);try{const e=await i(this,H).loadMetadata();try{await v(this,je,Qa).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,K)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}if(q.userId)try{await v(this,je,hd).call(this,e)}catch(r){console.warn("[RecipesStore] Erreur sync Appwrite:",r)}console.log(`[RecipesStore] Synchronisation terminÃ©e: ${f(i(this,K)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Ce),!1)}}async syncFromRemotePublicOnly(){if(!i(this,H)){console.warn("[RecipesStore] Impossible de sync : cache non initialisÃ©");return}console.log("[RecipesStore] Synchronisation publique (Hugo uniquement)..."),m(i(this,Ce),!0);try{const e=await i(this,H).loadMetadata();try{await v(this,je,Qa).call(this,e)}catch(r){if(console.error("[RecipesStore] Erreur chargement data.json:",r),f(i(this,K)).size===0)throw new Error("Aucun cache disponible et data.json inaccessible");console.log("[RecipesStore] Continuation avec les donnÃ©es du cache")}console.log(`[RecipesStore] Synchronisation publique terminÃ©e: ${f(i(this,K)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de la synchronisation publique";throw m(i(this,qe),r,!0),console.error("[RecipesStore]",r,e),e}finally{m(i(this,Ce),!1)}}async setupRealtime(){if(!i(this,H)){console.warn("[RecipesStore] Impossible de setup realtime : cache non initialisÃ©");return}if(i(this,Qs)){console.log("[RecipesStore] Realtime dÃ©jÃ  configurÃ©");return}if(console.log("[RecipesStore] Configuration du realtime..."),q.userId)try{v(this,je,pd).call(this),_(this,Qs,!0)}catch(e){console.warn("[RecipesStore] Erreur activation realtime:",e)}}async initialize(){if(f(i(this,Dr))){console.log("[RecipesStore] DÃ©jÃ  initialisÃ©");return}return i(this,Mr)?(console.log("[RecipesStore] Initialisation dÃ©jÃ  en cours, attente..."),i(this,Mr)):(console.log("[RecipesStore] Initialisation..."),m(i(this,Ce),!0),m(i(this,qe),null),_(this,Mr,(async()=>{try{if(await this.loadCache(),await this.syncFromRemote(),await this.setupRealtime(),f(i(this,K)).size===0){const e="Aucune recette disponible aprÃ¨s initialisation";m(i(this,qe),e),console.warn("[RecipesStore]",e)}console.log(`[RecipesStore] Initialisation complÃ©tÃ©e: ${f(i(this,K)).size} recettes`)}catch(e){const r=e instanceof Error?e.message:"Erreur lors de l'initialisation";throw m(i(this,qe),r,!0),console.error("[RecipesStore] ECHEC Initialisation:",r,e),e}finally{m(i(this,Ce),!1),_(this,Mr,null)}})()),i(this,Mr))}async forceReloadAllRecipes(){if(!q.userId)throw new Error("Utilisateur non connectÃ©");m(i(this,Ce),!0),m(i(this,qe),null);try{console.log("[RecipesStore] Rechargement forcÃ© des recettes Appwrite...");const e=await ll();let r=0,s=0;if(e.forEach(n=>{n.status==="deleted"?f(i(this,K)).has(n.$id)&&(f(i(this,K)).delete(n.$id),s++,console.log(`[RecipesStore] Recette ${n.$id} supprimÃ©e (status=deleted)`)):(f(i(this,K)).set(n.$id,Ta(n)),r++)}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es`),i(this,H)){const n=await i(this,H).loadMetadata(),a=new Date().toISOString();await i(this,H).saveRecipesIndex(f(i(this,K))),await i(this,H).saveMetadata({...n,lastAppwriteSync:a,recipesCount:f(i(this,K)).size,cacheVersion:1})}console.log("[RecipesStore] Rechargement forcÃ© terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du rechargement";throw m(i(this,qe),r,!0),console.error("[RecipesStore] Erreur rechargement forcÃ©:",e),e}finally{m(i(this,Ce),!1)}}async hardReset(){if(!q.userId)throw new Error("Utilisateur non connectÃ©");console.log("[RecipesStore] ð HARD RESET - Vidage complet..."),m(i(this,Ce),!0),m(i(this,qe),null);try{f(i(this,K)).clear(),i(this,H)&&(await i(this,H).clear(),console.log("[RecipesStore] Cache IDB vidÃ©")),await v(this,je,Qa).call(this,null);const e=await ll();let r=0,s=0;if(e.forEach(n=>{n.status!=="deleted"?(f(i(this,K)).set(n.$id,Ta(n)),r++):s++}),console.log(`[RecipesStore] ${r} recettes Appwrite chargÃ©es, ${s} supprimÃ©es ignorÃ©es`),i(this,H)){const n=new Date().toISOString();await i(this,H).saveRecipesIndex(f(i(this,K))),await i(this,H).saveMetadata({buildTimestamp:f(i(this,Wn)),lastAppwriteSync:n,recipesCount:f(i(this,K)).size,cacheVersion:1}),console.log("[RecipesStore] Cache IDB recrÃ©Ã©")}console.log("[RecipesStore] â HARD RESET terminÃ©")}catch(e){const r=e instanceof Error?e.message:"Erreur lors du hard reset";throw m(i(this,qe),r,!0),console.error("[RecipesStore] Erreur hard reset:",e),e}finally{m(i(this,Ce),!1)}}getRecipeIndexByUuid(e){return f(i(this,K)).get(e)||null}searchRecipes(e){if(!e.trim())return this.recipesIndex;const r=v(this,je,ho).call(this,e.trim()).split(/\s+/);return this.recipesIndex.filter(s=>{const a=v(this,je,ho).call(this,s.title).split(/[\s\-_]+/);return r.every(o=>a.some(c=>c.startsWith(o)))})}get availableTypes(){const e=new Set;return this.recipesIndex.forEach(r=>e.add(r.typeR)),Array.from(e).sort()}async canEditRecipe(e){if(!q.userId)return!1;try{const r=await Ji(e);return r?r.createdBy===q.userId||!!r.permissionWrite?.includes(q.userId)||!!r.teams?.some(s=>q.userTeams.includes(s)):!1}catch(r){return console.error(`[RecipesStore] Erreur lors de la vÃ©rification des permissions pour ${e}:`,r),!1}}getRecipeLockStatus(e){return f(i(this,K)).get(e)?.lockedBy||null}async updateRecipeLock(e,r){if(q.userId)try{await eg(e,{lockedBy:r},q.userId),console.log(`[RecipesStore] Verrou ${e} mis Ã  jour: ${r||"libÃ©rÃ©"}`);const s=f(i(this,K)).get(e);s&&f(i(this,K)).set(e,{...s,lockedBy:r})}catch(s){throw console.error(`[RecipesStore] Erreur verrouillage ${e}:`,s),s}}async getRecipeByUuid(e){if(i(this,qt).has(e)){for(console.log(`[RecipesStore] Chargement de ${e} dÃ©jÃ  en cours, attente...`);i(this,qt).has(e);)await new Promise(r=>setTimeout(r,50));return i(this,H)&&await i(this,H).loadRecipeDetail(e)||null}i(this,qt).add(e);try{if(i(this,H)){const s=await i(this,H).loadRecipeDetail(e);if(s)return s}let r=null;try{const s=`/recettes/${e}/recipe.json`,n=await fetch(s);if(n.ok){const a=await n.json();r=Cc(a),console.log(`[RecipesStore] ${e} chargÃ©e depuis Hugo`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Hugo`)}if(!r&&q.userId)try{const s=await Ji(e);if(s){const n=Ha(s.ingredients||[]);r={...s,ingredients:n,astuces:Wi(s.astuces),prepAlt:s.prepAlt||null,categories:s.categories,regime:s.regime,saison:s.saison,teams:s.teams,permissionWrite:s.permissionWrite},console.log(`[RecipesStore] ${e} chargÃ©e depuis Appwrite (fallback)`)}}catch{console.log(`[RecipesStore] ${e} non trouvÃ©e dans Appwrite`)}return r&&i(this,H)&&await i(this,H).saveRecipeDetail(r),r||console.warn(`[RecipesStore] ${e} non trouvÃ©e (Hugo ni Appwrite)`),r}catch(r){return console.error(`[RecipesStore] Erreur lors du chargement de ${e}:`,r),null}finally{i(this,qt).delete(e)}}async getRecipesByUuidsBulk(e){const r=performance.now(),s=[...new Set(e.filter(Boolean))];if(s.length===0)return new Map;console.log(`[RecipesStore] Chargement bulk de ${s.length} recettes...`);const n=new Map;i(this,H)&&(await i(this,H).loadRecipeDetailsBulk(s)).forEach((d,h)=>n.set(h,d));const a=s.filter(u=>!n.has(u));console.log(`[RecipesStore] Bulk: ${n.size} dans le cache, ${a.length} Ã  fetch`);const o=new Map;if(a.length>0){a.forEach(u=>i(this,qt).add(u));try{const u=a.map(async h=>{let p=null;try{const g=`/recettes/${h}/recipe.json`,w=await fetch(g);if(w.ok){const A=await w.json();p=Cc(A)}}catch{}if(!p&&q.userId)try{const g=await Ji(h);if(g){const w=Ha(g.ingredients||[]);p={...g,ingredients:w,astuces:Wi(g.astuces),prepAlt:g.prepAlt||null,categories:g.categories,regime:g.regime,saison:g.saison,teams:g.teams,permissionWrite:g.permissionWrite}}}catch{}return p?{uuid:h,recipe:p}:null});(await Promise.all(u)).forEach(h=>{h&&o.set(h.uuid,h.recipe)}),o.size>0&&i(this,H)&&await i(this,H).saveRecipeDetailsBulk(o),a.forEach(h=>i(this,qt).delete(h))}catch(u){console.error("[RecipesStore] Erreur lors du fetch bulk:",u),a.forEach(d=>i(this,qt).delete(d))}}const c=new Map([...n,...o]),l=performance.now()-r;return console.log(`[RecipesStore] Bulk terminÃ©: ${c.size}/${s.length} recettes en ${l.toFixed(0)}ms`),c}async preloadRecipes(e){console.log(`[RecipesStore] PrÃ©chargement de ${e.length} recettes...`);const r=e.map(s=>this.getRecipeByUuid(s));await Promise.all(r),console.log("[RecipesStore] PrÃ©chargement terminÃ©")}async getVariantGroup(e,r=2){const s=this.getRecipeIndexByUuid(e);if(!s)return{root:null,variants:[],isRoot:!1};const n=new Map,a=new Set;let o=s;for(;o.rootRecipeId&&!a.has(o.rootRecipeId);){a.add(o.$id);const l=this.getRecipeIndexByUuid(o.rootRecipeId);if(!l)break;o=l}const c=o;return n.set(c.$id,c),await v(this,je,po).call(this,c.$id,n,new Set([c.$id]),0,r),{root:c,variants:Array.from(n.values()),isRoot:!s.rootRecipeId||s.rootRecipeId===s.$id}}findRootRecipe(e){const r=new Set;let s=e,n=10;for(let a=0;a<n;a++){const o=this.getRecipeIndexByUuid(s);if(!o||!o.rootRecipeId)return s;if(r.has(s))return console.error("[RecipesStore] Cycle dÃ©tectÃ© dans rootRecipeId, retour Ã ",e),e;r.add(s),s=o.rootRecipeId}return e}destroy(){i(this,H)&&(i(this,H).close(),_(this,H,null)),f(i(this,K)).clear(),m(i(this,Dr),!1),_(this,Qs,!1),console.log("[RecipesStore] Ressources nettoyÃ©es")}}K=new WeakMap,Ce=new WeakMap,qe=new WeakMap,Dr=new WeakMap,Wn=new WeakMap,H=new WeakMap,qt=new WeakMap,Mr=new WeakMap,Qs=new WeakMap,je=new WeakSet,Qa=async function(e){try{console.log("[RecipesStore] Chargement data.json...");const r=await fetch(tg);if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);const s=await r.json();if(!Array.isArray(s.recipes))throw new Error("Format invalide: recipes n'est pas un tableau");const n=s.meta?.timestamp;if(m(i(this,Wn),n,!0),n&&e&&e.buildTimestamp&&e.buildTimestamp>=n){console.log(`[RecipesStore] Cache Ã  jour (Ts: ${e.buildTimestamp} >= ${n})`);return}console.log(`[RecipesStore] Nouvelle version dÃ©tectÃ©e ou cache manquant (Ts: ${n}), Traitement...`);const a=s.recipes.map(c=>gp(c));let o=0;a.forEach(c=>{const l=f(i(this,K)).get(c.$id);let u=!1;if(!l)u=!0;else{const d=new Date(c.$updatedAt).getTime(),h=new Date(l.$updatedAt).getTime();d>h&&(u=!0)}u&&(f(i(this,K)).set(c.$id,c),o++)}),console.log(`[RecipesStore] Smart Merge: ${o} recettes mises Ã  jour/ajoutÃ©es.`),i(this,H)&&(await i(this,H).saveRecipesIndex(f(i(this,K))),await i(this,H).saveMetadata({...e,buildTimestamp:n||Date.now()/1e3,recipesCount:f(i(this,K)).size,cacheVersion:1}))}catch(r){throw console.error("[RecipesStore] Erreur loadIndexFromDataJson:",r),r}},hd=async function(e){console.log("[RecipesStore] Sync incrÃ©mentiel Appwrite...");const r=e?.lastAppwriteSync||"1970-01-01T00:00:00.000Z";e?.buildTimestamp&&new Date(e.buildTimestamp*1e3).toISOString(),console.log(`[RecipesStore] Sync Appwrite: depuis ${r}`);const s=await Fm(r);if(s.length===0){console.log("[RecipesStore] Aucune mise Ã  jour Appwrite dÃ©tectÃ©e.");return}console.log(`[RecipesStore] ${s.length} recettes mises Ã  jour depuis Appwrite.`);let n=0,a=0;s.forEach(c=>{if(c.status==="deleted")f(i(this,K)).has(c.$id)&&(f(i(this,K)).delete(c.$id),a++,console.log(`[RecipesStore] Recette ${c.$id} supprimÃ©e (status=deleted)`));else{const l=Ta(c);f(i(this,K)).set(l.$id,l),n++}});const o=new Date().toISOString();i(this,H)&&(await i(this,H).saveRecipesIndex(f(i(this,K))),await i(this,H).saveMetadata({...e,lastAppwriteSync:o})),console.log(`[RecipesStore] Sync incrÃ©mentiel terminÃ© (${n} mises Ã  jour, ${a} supprimÃ©es).`)},pd=async function(){try{console.log("[RecipesStore] Configuration du Realtime...");const e=ut();Vt.register([`databases.${e}.collections.${ys}.documents`],async r=>{const s=r.payload;let n="update";if(r.events.some(a=>a.includes(".create"))?n="create":r.events.some(a=>a.includes(".delete"))&&(n="delete"),console.log(`[RecipesStore] â¡ï¸ Realtime RECEIVED: ${n} pour ${s.$id}`),n==="create"||n==="update"){if(s.status==="deleted"){if(f(i(this,K)).delete(s.$id),i(this,H))try{await i(this,H).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e de l'index (status=deleted)`)}catch(l){console.warn(`[RecipesStore] Erreur suppression index ${s.$id}:`,l)}return}const a=Ta(s);f(i(this,K)).set(s.$id,a);const o=Ha(s.ingredients),c={...s,ingredients:o,astuces:Wi(s.astuces)};if(i(this,H))try{await i(this,H).saveRecipeDetail(c),console.log(`[RecipesStore] DÃ©tails de ${s.$id} mis Ã  jour dans le cache`)}catch(l){console.warn(`[RecipesStore] Erreur mise Ã  jour cache dÃ©tails ${s.$id}:`,l)}}else if(n==="delete"&&(f(i(this,K)).delete(s.$id),i(this,H)))try{await i(this,H).deleteRecipeFromIndex(s.$id),console.log(`[RecipesStore] Recette ${s.$id} supprimÃ©e du cache`)}catch(a){console.warn(`[RecipesStore] Erreur suppression cache ${s.$id}:`,a)}}),console.log("[RecipesStore] Realtime enregistrÃ© auprÃ¨s du manager")}catch(e){console.error("[RecipesStore] Erreur lors de la configuration du realtime:",e)}},ho=function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},po=async function(e,r,s,n,a){if(!(n>a))for(const[o,c]of f(i(this,K)))r.has(o)||c.rootRecipeId===e&&(r.set(o,c),c.rootRecipeId&&c.rootRecipeId!==e&&!s.has(c.rootRecipeId)&&(s.add(c.rootRecipeId),await v(this,je,po).call(this,c.rootRecipeId,r,s,n+1,a)))};const li=new rg;function sg(t){const e=Cr(t.specs)??null,r=Co(ko(t.purchases??[]));let s=[];e?.quantity&&(s=[e.quantity]);const n=Cr(t.totalNeededOverride),a=n?[n.totalOverride]:s,{numeric:o,display:c}=Ni(a,r);let l=Cr(t.stockReel)??null;if(l&&l.quantity&&l.unit){const p=To.normalize(parseFloat(l.quantity),l.unit);l={...l,quantity:p.quantity,unit:p.unit}}const u=dt(r),d=t.store?Cr(t.store):null,h=l?`${l.quantity} ${l.unit}`:u;return{$id:t.$id,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,productHugoUuid:t.productHugoUuid||"",productName:t.productName,productType:t.productType||"none",pF:e?.pF??!1,pS:e?.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:t.isSynced,mainId:t.mainId,totalNeededRaw:[],status:t.status,who:t.who,store:t.store,stockReel:t.stockReel,previousNames:t.previousNames,isMerged:t.isMerged,mergedFrom:t.mergedFrom,mergeDate:t.mergeDate,mergeReason:t.mergeReason,mergedInto:t.mergedInto,totalNeededOverride:t.totalNeededOverride,purchases:t.purchases,specs:t.specs,byDate:{},storeInfo:d,stockParsed:l,specsParsed:e,totalNeededArray:s,totalPurchasesArray:r,missingQuantityArray:o,stockOrTotalPurchases:h,displayTotalNeeded:dt(s),displayTotalPurchases:u,displayMissingQuantity:c,totalNeededOverrideParsed:n,displayTotalOverride:n?dt([n.totalOverride]):"",dateDisplayInfo:{}}}function qa(t,e){const r=t.purchases??e.purchases,s=t.specs??e.specs,n=s?Cr(s):e.specsParsed,a=Co(ko(r??[])),o=dt(a);let c=e.totalNeededArray;!e.productHugoUuid&&n?.quantity&&(c=[n.quantity]);const l=Cr(t.totalNeededOverride??e.totalNeededOverride),u=l?[l.totalOverride]:c,{numeric:d,display:h}=Ni(u,a),p=t.stockReel??e.stockReel;let g=p?Cr(p):e.stockParsed;if(g&&g.quantity&&g.unit){const I=To.normalize(parseFloat(g.quantity),g.unit);g={...g,quantity:I.quantity,unit:I.unit}}const w=t.store??e.store,A=w?Cr(w):e.storeInfo,E=g?`${g.quantity} ${g.unit}`:o;return t.purchases===void 0&&e.purchases?.length&&console.log(`[ProductsStore] Fusion intelligente : prÃ©servation de ${e.purchases.length} purchases pour ${e.productName}`),{...e,$updatedAt:t.$updatedAt,productName:t.productName??e.productName,productType:t.productType??e.productType,isSynced:t.isSynced??e.isSynced,mainId:t.mainId??e.mainId,pF:n?.pF??e.pF,pS:n?.pS??e.pS,status:t.status??e.status,who:t.who??e.who,store:w,stockReel:p,specs:s,purchases:r,previousNames:t.previousNames??e.previousNames,isMerged:t.isMerged??e.isMerged,mergedFrom:t.mergedFrom??e.mergedFrom,mergeDate:t.mergeDate??e.mergeDate,mergeReason:t.mergeReason??e.mergeReason,mergedInto:t.mergedInto??e.mergedInto,totalNeededOverride:t.totalNeededOverride??e.totalNeededOverride,storeInfo:A,stockParsed:g,specsParsed:n,totalNeededArray:c,totalPurchasesArray:a,missingQuantityArray:d,stockOrTotalPurchases:E,displayTotalPurchases:o,displayMissingQuantity:h,displayTotalNeeded:dt(c),totalNeededOverrideParsed:l,displayTotalOverride:l?dt([l.totalOverride]):""}}function ng(t){t.totalPurchasesArray=Co(ko(t.purchases??[]));const e=t.totalNeededOverrideParsed?[t.totalNeededOverrideParsed.totalOverride]:t.totalNeededArray,{numeric:r,display:s}=Ni(e,t.totalPurchasesArray);t.missingQuantityArray=r,t.displayMissingQuantity=s}async function ul(t,e,r){console.log(`[productEnrichment] Calcul pour Ã©vÃ©nement ${t.$id} avec ${t.meals.length} repas`);const s=new Set;for(const l of t.meals)for(const u of l.recipes)s.add(u.recipeUuid);console.log(`[productEnrichment] ${s.size} recettes uniques identifiÃ©es`);const n=await li.getRecipesByUuidsBulk([...s]);console.log(`[productEnrichment] ${n.size}/${s.size} recettes chargÃ©es`);const a=l=>Promise.resolve(n.get(l)||null),o=new Map;for(const l of t.meals)await ag(l,a,o);const c=[];for(const[l,u]of o)c.push(og(u,r));return console.log(`[productEnrichment] ${c.length} produits calculÃ©s`),c}async function ag(t,e,r){const s=t.date;for(const n of t.recipes){const a=await e(n.recipeUuid);if(!a){console.warn(`[processMeal] Recette ${n.recipeUuid} introuvable`);continue}const o=n.plates/a.plate;for(const c of a.ingredients)ig(c,o,s,r,a.title,n.plates)}}function ig(t,e,r,s,n,a){const o=t.uuid;s.has(o)||s.set(o,{productHugoUuid:o,productName:t.name,productType:t.type,pF:t.pF??!1,pS:t.pS??!1,byDate:{},allergens:new Set(t.allergens||[])});const c=s.get(o),l=t.normalizedUnit==="au goÃ»t"?t.normalizedQuantity:t.normalizedQuantity*e,u=t.normalizedUnit==="au goÃ»t"?t.originalQuantity:t.originalQuantity*e;c.byDate[r]||(c.byDate[r]={quantities:[],recipes:[],totalAssiettes:0});const d=c.byDate[r];d.quantities.push({q:l,u:t.normalizedUnit}),d.recipes.push({r:n,q:u,u:t.originalUnit,qEq:l,uEq:t.normalizedUnit,a}),d.totalAssiettes+=a,t.allergens&&t.allergens.forEach(h=>c.allergens.add(h))}function og(t,e){const r=Ru(t.productName).substring(0,20),s=e.slice(-10),n=`${r}_${s}`,a={};for(const[I,k]of Object.entries(t.byDate))a[I]={totalConsolidated:io(k.quantities),recipes:k.recipes,totalAssiettes:k.totalAssiettes,recipeCount:k.recipes.length};const o=Object.values(a).flatMap(I=>I.totalConsolidated),c=io(o),l=[],u=[],d=c,{numeric:h,display:p}=Ni(d,l),g=Object.values(a).reduce((I,k)=>I+k.recipeCount,0),w=Object.values(a).reduce((I,k)=>I+k.totalAssiettes,0),A=cp(Object.keys(a));return{$id:n,mainId:e,productHugoUuid:t.productHugoUuid,productName:t.productName,productType:t.productType,byDate:a,totalNeededArray:c,totalPurchasesArray:l,missingQuantityArray:h,displayTotalNeeded:dt(c),displayTotalPurchases:dt(l),displayMissingQuantity:p,isSynced:!1,status:"active",who:[],store:"",storeInfo:null,purchases:u,stockReel:"",stockParsed:null,totalNeededOverride:null,totalNeededOverrideParsed:null,displayTotalOverride:"",stockOrTotalPurchases:"",previousNames:null,isMerged:!1,mergedFrom:[],mergeDate:null,mergeReason:null,mergedInto:null,specs:null,specsParsed:null,pF:t.pF??!1,pS:t.pS??!1,nbRecipes:g,totalAssiettes:w,totalNeededRaw:c,dateDisplayInfo:A,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],$databaseId:"",$tableId:""}}function md(t,e){const{operationName:r,maxAutoRetries:s=1,autoRetryDelay:n=1e3}=e;let a=1;return new Promise((o,c)=>{const l=async()=>{try{console.log(`[RetryUtils] ${r} - Tentative ${a}/${s+1}`);const u=await t();console.log(`[RetryUtils] ${r} - SuccÃ¨s`),e.onSuccess?.(u),o(u)}catch(u){if(console.error(`[RetryUtils] Erreur ${r} (Tentative ${a}):`,u),u instanceof Error&&u.message,a<=s){a++,console.log(`[RetryUtils] Nouvelle tentative dans ${n/1e3}s...`),setTimeout(()=>l(),n);return}console.error(`[RetryUtils] ${r} - Ãchec aprÃ¨s ${a} tentatives`),e.onError?.(u),c(u)}};l()})}function Da(t){if(!t)return[];const e=[],r=t.$id;return e.push(te.read(ae.label(r)),te.update(ae.label(r))),e}function cg(t,e,r,s){let n=t.who,a=t.store;return r==="who"?n=e.names||null:r==="store"&&(a=JSON.stringify(e)),{$id:t.$id,productHugoUuid:t.productHugoUuid,productName:t.productName,mainId:t.mainId,status:t.status||null,who:n,store:a,stockReel:t.stockReel||null,previousNames:t.previousNames||null,isMerged:t.isMerged||!1,mergedFrom:t.mergedFrom||null,mergeDate:t.mergeDate||null,mergeReason:t.mergeReason||null,mergedInto:t.mergedInto||null,totalNeededOverride:t.totalNeededOverride||null,$permissions:[te.read(ae.label(s)),te.update(ae.label(s))]}}function gd(t,e){return{$id:t.$id,mainId:t.mainId,productHugoUuid:t.productHugoUuid,productName:t.productName,...e}}async function lg(t){const{account:e}=await D(),r=await e.get();return{...t,updatedBy:r.name}}function yd(){return localStorage.getItem("appwrite-user-name")||""}async function wd(t,e,r=100){try{const{tables:s,config:n}=await D(),a=await s.listRows({databaseId:n.databaseId,tableId:n.collections.purchases,queries:[S.greaterThan("$updatedAt",e),S.equal("mainId",t),S.limit(r)]});return console.log(`[Appwrite product] ${a.rows.length} purchases modifiÃ©s chargÃ©s`),a.rows}catch(s){return console.error("[Appwrite product] Erreur chargement purchases modifiÃ©s:",s),[]}}async function vd(t,e){const{lastSync:r,limit:s=1e3}=e;try{const{tables:n,config:a}=await D();if(!r){console.log("[Appwrite product] Chargement complet des produits et achats");const p=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[S.equal("mainId",t),S.limit(s)]})).rows,w=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[S.equal("mainId",t),S.limit(s*2)]})).rows,A=new Map;return p.forEach(E=>{A.set(E.$id,{...E,purchases:[]})}),w.forEach(E=>{E.products?.forEach(I=>{const k=A.get(I);k&&(k.purchases||(k.purchases=[]),k.purchases.push(E))})}),console.log(`[Appwrite product] ${p.length} produits chargÃ©s avec ${w.length} achats`),Array.from(A.values())}const o=await n.listRows({databaseId:a.databaseId,tableId:a.collections.products,queries:[S.greaterThan("$updatedAt",r),S.equal("mainId",t),S.limit(s)]}),c=o.rows,u=(await n.listRows({databaseId:a.databaseId,tableId:a.collections.purchases,queries:[S.greaterThan("$updatedAt",r),S.equal("mainId",t),S.limit(s*2)]})).rows,d=new Map;return c.forEach(h=>{d.set(h.$id,{...h,purchases:[]})}),u.forEach(h=>{h.products?.forEach(p=>{const g=d.get(p);g&&(g.purchases||(g.purchases=[]),g.purchases.push(h))})}),o.rows.length>0&&console.log(`[Appwrite product] ${o.rows.length} produits synchronisÃ©s (delta)`),Array.from(d.values())}catch(n){console.error(`[Appwrite product] Erreur sync produits avec purchases pour mainId ${t}:`,n);const a=n instanceof Error?n.message:"Erreur lors de la synchronisation";throw new Error(`Ãchec de la synchronisation: ${a}`)}}async function bd(t,e,r=!0){const{tables:s,config:n}=await D();return r&&(e.updatedBy=yd()),await s.updateRow({databaseId:n.databaseId,tableId:n.collections.products,rowId:t,data:e})}async function Ed(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour crÃ©ation`);console.log(`[Appwrite product] CrÃ©ation produit ${t} sur Appwrite...`);const n=gd(s,e),a=await lg(n),{tables:o,config:c}=await D(),l=Ne.getEventById(a.mainId),u=Da(l),d=await o.createRow({databaseId:c.databaseId,tableId:c.collections.products,rowId:t,data:a,permissions:u});return console.log(`[Appwrite product] Produit ${t} crÃ©Ã© avec permissions (labels + teams)`),d}catch(s){console.error(`[Appwrite product] Erreur crÃ©ation produit ${t}:`,s);const n=s instanceof Error?s.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation du produit: ${n}`)}}async function ug(t,e){try{const{tables:r,config:s}=await D(),a=`${Ru(t.productName).substring(0,10)}_${Date.now().toString(36)}`,o={quantity:t.quantity,pF:t.pF||!1,pS:t.pS||!1},c={productHugoUuid:null,productName:t.productName,productType:t.productType||"Autre",store:t.store?JSON.stringify(t.store):null,who:t.who||[],isSynced:!0,mainId:e,status:"active",updatedBy:yd(),stockReel:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,mergedInto:null,totalNeededOverride:null,specs:JSON.stringify(o)};console.log(`[Appwrite product] CrÃ©ation produit manuel ${a}...`,c);const l=Ne.getEventById(e),u=Da(l),d=await r.createRow({databaseId:s.databaseId,tableId:s.collections.products,rowId:a,data:c,permissions:u});return console.log(`[Appwrite product] Produit manuel ${a} crÃ©Ã© avec permissions Label`),d}catch(r){throw console.error("[Appwrite product] Erreur crÃ©ation produit manuel:",r),r}}async function dg(t,e,r){try{const s=r(t);if(!s)throw new Error(`Produit ${t} non trouvÃ© localement pour mise Ã  jour batch`);const n={};return e.stockReel!==void 0&&(n.stockReel=e.stockReel),e.who!==void 0&&(n.who=e.who),e.storeInfo!==void 0&&(n.store=JSON.stringify(e.storeInfo)),s.isSynced?(console.log(`[Appwrite product] Produit ${t} dÃ©jÃ  sync, update batch normal...`),await bd(t,n)):(console.log(`[Appwrite product] Produit ${t} local, crÃ©ation batch avec upsert...`),await Ed(t,n,r))}catch(s){throw console.error(`[Appwrite product] Erreur lors de la mise Ã  jour batch du produit ${t}:`,s),s}}async function fg(t,e){try{const{tables:r,config:s}=await D(),n=await r.updateRow(s.databaseId,s.collections.purchases,t,e);return console.log(`[Appwrite product] Achat ${t} mis Ã  jour:`,e),n}catch(r){console.error(`[Appwrite product] Erreur mise Ã  jour achat ${t}:`,r);const s=r instanceof Error?r.message:"Erreur inconnue";throw new Error(`Ãchec de la mise Ã  jour de l'achat: ${s}`)}}async function hg(t){try{const{tables:e,config:r}=await D();await e.deleteRow(r.databaseId,r.collections.purchases,t),console.log(`[Appwrite product] Achat ${t} supprimÃ©`)}catch(e){console.error(`[Appwrite product] Erreur suppression achat ${t}:`,e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec de la suppression de l'achat: ${r}`)}}async function Sd(t){if(!t?.length)return[];try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[S.equal("$id",t)]);return console.log(`[Appwrite product] ${s.rows.length} purchases chargÃ©s avec relations products`),s.rows}catch(e){console.error("[Appwrite product] Erreur chargement purchases avec relations:",e);const r=e instanceof Error?e.message:"Erreur inconnue";throw new Error(`Ãchec du chargement des purchases: ${r}`)}}async function pg(t,e,r,s){try{const{functions:n,config:a,account:o}=await D(),c=Od.currentMainId;if(!c)throw new Error("No current event - cannot determine mainId for permissions");const l=await o.get(),u=t.map(g=>{const w=e.find(A=>A.$id===g);if(!w)throw new Error(`Product ${g} not found in products data`);return cg(w,s,r,c)});console.log(`[Appwrite product] Lancement mise Ã  jour groupÃ©e OPTIMISÃE: ${u.length} produits, type: ${r}`);const d={operation:"batchUpdateProductsOptimized",data:{rows:u,fromUserId:l.$id}},h=await md(()=>n.createExecution(a.functions.batchUpdate,JSON.stringify(d),!1,"/",In.POST),{operationName:`batchUpdateProductsOptimized (${u.length} products, type: ${r})`,maxAutoRetries:1,autoRetryDelay:2e3});if(!h)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives de mise Ã  jour groupÃ©e optimisÃ©e");if(h.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${h.status}. Erreur: ${h.stderr||h.responseBody}`);const p=JSON.parse(h.responseBody);return p.success?console.log(`[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e rÃ©ussie: ${p.updatedCount} produits mis Ã  jour`):console.error("[Appwrite product] Mise Ã  jour groupÃ©e optimisÃ©e Ã©chouÃ©e:",p.error),p}catch(n){console.error("[Appwrite products] Erreur mise Ã  jour groupÃ©e optimisÃ©e:",n);const a=n instanceof Error?n.message:"Erreur inconnue";return{success:!1,updatedCount:t.length,updateType:r,error:a,timestamp:new Date().toISOString()}}}async function mg(t,e,r,s={}){try{const{tables:n,config:a,account:o}=await D(),c=await o.get(),l=Ne.getEventById(t),u=Da(l),d=[];console.log("[Appwrite product] Debug createQuickValidationPurchases:",{mainId:t,productId:e,productIdType:typeof e,quantities:r,options:s});const h=s.status||"delivered";let p=s.deliveryDate||null;h==="delivered"&&!p&&(p=new Date().toISOString());for(const g of r){const w={products:[e],mainId:t,quantity:g.q,unit:g.u,status:h,notes:s.notes||`Validation rapide ${new Date().toLocaleDateString("fr-FR")}`,store:s.store??null,who:s.who||c.name,price:s.price||null,orderDate:s.orderDate||null,deliveryDate:p,createdBy:c.$id,invoiceId:s.invoiceId,invoiceTotal:null},A=await n.createRow(a.databaseId,a.collections.purchases,pt.unique(),w,u);d.push(A)}return console.log(`[Appwrite product] ${d.length} validations rapides crÃ©Ã©es avec permissions (labels + teams) pour produit ${e}`),d}catch(n){console.error("[Appwrite product] Erreur crÃ©ation validation rapide:",n);const a=n instanceof Error?n.message:"Erreur inconnue";throw new Error(`Ãchec de la validation rapide: ${a}`)}}async function gg(t,e,r,s,n,a){try{const{tables:o,config:c,account:l}=await D(),u=await l.get(),d=e||pt.unique(),h=u.name;if(!r)throw new Error("invoiceTotal est requis pour une dÃ©pense");const p=Ne.getEventById(t),g=Da(p),w={products:[],mainId:t,quantity:1,unit:"global",status:"expense",notes:n||"",store:s??null,who:h||u.name,price:r,invoiceId:d,invoiceTotal:r,orderDate:null,deliveryDate:new Date().toISOString(),createdBy:u.$id},A=await o.createRow(c.databaseId,c.collections.purchases,pt.unique(),w,g);return console.log("[Appwrite product] DÃ©pense crÃ©Ã©e avec permissions (labels + teams):",A),A}catch(o){console.error("[Appwrite product] Erreur crÃ©ation dÃ©pense:",o);const c=o instanceof Error?o.message:"Erreur inconnue";throw new Error(`Ãchec de la crÃ©ation de la dÃ©pense: ${c}`)}}async function Id(t){try{const{tables:e,config:r}=await D(),s=await e.listRows(r.databaseId,r.collections.purchases,[S.equal("mainId",t),S.equal("status","expense"),S.limit(1e3)]);return console.log(`[Appwrite product] ${s.rows.length} dÃ©penses globales chargÃ©es`),s.rows}catch(e){return console.error("[Appwrite product] Erreur chargement dÃ©penses globales:",e),[]}}const Wr=Object.freeze(Object.defineProperty({__proto__:null,batchUpdateProductsOptimized:pg,createExpensePurchase:gg,createManualProduct:ug,createQuickValidationPurchases:mg,deletePurchase:hg,enrichedProductToAppwriteProduct:gd,getEventPermissionsFromEvent:Da,loadOrphanPurchases:Id,loadPurchasesListByIds:Sd,loadUpdatedPurchases:wd,syncProductsWithPurchases:vd,updateProduct:bd,updateProductBatch:dg,updatePurchase:fg,upsertProduct:Ed},Symbol.toStringTag,{value:"Module"}));class yg{constructor(e){N(this,"dbName");N(this,"db",null);N(this,"version",1);N(this,"PRODUCTS_STORE","products");N(this,"METADATA_STORE","metadata");N(this,"LAST_SYNC_KEY","lastSync");N(this,"ALL_DATES_KEY","allDates");N(this,"HUGO_HASH_KEY","hugoContentHash");this.dbName=`products-cache-${e}`}async open(){if(!this.db)return new Promise((e,r)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>r(s.error),s.onsuccess=()=>{this.db=s.result,console.log(`[IDBCache] Base ouverte: ${this.dbName}`),e()},s.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(this.PRODUCTS_STORE)||(a.createObjectStore(this.PRODUCTS_STORE,{keyPath:"$id"}),console.log("[IDBCache] Object store 'products' crÃ©Ã©")),a.objectStoreNames.contains(this.METADATA_STORE)||(a.createObjectStore(this.METADATA_STORE,{keyPath:"key"}),console.log("[IDBCache] Object store 'metadata' crÃ©Ã© avec keyPath"))}})}async loadProducts(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.PRODUCTS_STORE,"readonly").objectStore(this.PRODUCTS_STORE).getAll();a.onsuccess=()=>{const o=new Map;a.result.forEach(c=>{o.set(c.$id,c)}),console.log(`[IDBCache] ${o.size} produits chargÃ©s`),e(o)},a.onerror=()=>r(a.error)})}async loadMetadata(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const a=this.db.transaction(this.METADATA_STORE,"readonly").objectStore(this.METADATA_STORE).getAll();a.onsuccess=()=>{const o=a.result,c={lastSync:null,allDates:[],hugoContentHash:null};o.forEach(l=>{l.key===this.LAST_SYNC_KEY?c.lastSync=l.value:l.key===this.ALL_DATES_KEY?c.allDates=l.value||[]:l.key===this.HUGO_HASH_KEY&&(c.hugoContentHash=l.value)}),console.log(`[IDBCache] Metadata chargÃ©es: lastSync=${c.lastSync}, dates=${c.allDates?.length||0}, hash=${c.hugoContentHash}`),e(c)},a.onerror=()=>r(a.error)})}async saveProducts(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.PRODUCTS_STORE,"readwrite"),a=n.objectStore(this.PRODUCTS_STORE);a.clear(),e.forEach(o=>{a.put(o)}),n.oncomplete=()=>{console.log(`[IDBCache] ${e.size} produits sauvegardÃ©s`),r()},n.onerror=()=>s(n.error)})}async saveMetadata(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const n=this.db.transaction(this.METADATA_STORE,"readwrite"),a=n.objectStore(this.METADATA_STORE);a.put({key:this.LAST_SYNC_KEY,value:e.lastSync}),a.put({key:this.ALL_DATES_KEY,value:e.allDates}),e.hugoContentHash!==void 0&&a.put({key:this.HUGO_HASH_KEY,value:e.hugoContentHash}),n.oncomplete=()=>{console.log("[IDBCache] Metadata sauvegardÃ©es (objets {key, value})"),r()},n.onerror=()=>s(n.error)})}async updateLastSync(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.LAST_SYNC_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] lastSync mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateAllDates(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.ALL_DATES_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] allDates mis Ã  jour: ${e.length} dates`),r()},o.onerror=()=>s(o.error)})}async updateHugoContentHash(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:this.HUGO_HASH_KEY,value:e});o.onsuccess=()=>{console.log(`[IDBCache] hugoContentHash mis Ã  jour: ${e}`),r()},o.onerror=()=>s(o.error)})}async updateLastHugoMenuUpdate(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.METADATA_STORE,"readwrite").objectStore(this.METADATA_STORE).put({key:"lastHugoMenuUpdate",value:e});o.onsuccess=()=>{console.log("[IDBCache] lastHugoMenuUpdate sauvegardÃ©"),r()},o.onerror=()=>s(o.error)})}async upsertProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).put(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async deleteProduct(e){if(!this.db)throw new Error("DB non ouverte");return new Promise((r,s)=>{const o=this.db.transaction(this.PRODUCTS_STORE,"readwrite").objectStore(this.PRODUCTS_STORE).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}async clear(){if(!this.db)throw new Error("DB non ouverte");return new Promise((e,r)=>{const s=this.db.transaction([this.PRODUCTS_STORE,this.METADATA_STORE],"readwrite");s.objectStore(this.PRODUCTS_STORE).clear(),s.objectStore(this.METADATA_STORE).clear(),s.oncomplete=()=>{console.log("[IDBCache] Cache vidÃ©"),e()},s.onerror=()=>r(s.error)})}close(){this.db&&(this.db.close(),this.db=null,console.log("[IDBCache] Connexion fermÃ©e"))}}async function wg(t){const e=new yg(t);return await e.open(),e}var Gn,Qn;class Es{constructor(e,r){y(this,Gn,P(pe({})));N(this,"dateStore");y(this,Qn,z(()=>{const e=this.dateStore.current;this.dateStore.dates;let r;if(e.start&&e.end)r=lp(this.data,e.start,e.end);else return{quantities:[],formattedQuantities:"",nbRecipes:0,totalAssiettes:0,stockResult:[],availableQuantities:[],missingQuantities:[],formattedMissingQuantities:"",formattedAvailableQuantities:"En attente",hasAvailable:!1,hasMissing:!1,concernedDates:[],recipesByDate:new Map};return{quantities:r.requiredQuantities,formattedQuantities:r.requiredQuantitiesFormatted,nbRecipes:r.totalRecipesInRange,totalAssiettes:r.totalPortionsInRange,stockResult:r.stockBalance,availableQuantities:r.availableStockQuantities,missingQuantities:r.missingStockQuantities,formattedMissingQuantities:r.missingStockFormatted,formattedAvailableQuantities:r.availableStockFormatted,hasAvailable:r.hasAvailableStock,hasMissing:r.hasMissingStock,concernedDates:r.datesInSelectedRange,recipesByDate:r.recipesByDate}}));this.data=e,this.dateStore=r}get data(){return f(i(this,Gn))}set data(e){m(i(this,Gn),e,!0)}update(e){this.data=e}get $id(){return this.data.$id}get productName(){return this.data.productName}get productType(){return this.data.productType}get storeInfo(){return this.data.storeInfo}get who(){return this.data.who}get pF(){return this.data.pF}get pS(){return this.data.pS}get status(){return this.data.status}get previousNames(){return this.data.previousNames}get purchases(){return this.data.purchases}get totalNeededOverrideParsed(){return this.data.totalNeededOverrideParsed}get displayMissingQuantity(){return this.data.displayMissingQuantity}get missingQuantityArray(){return this.data.missingQuantityArray}get isSynced(){return this.data.isSynced}get byDate(){return this.data.byDate}get stats(){return f(i(this,Qn))}set stats(e){m(i(this,Qn),e)}}Gn=new WeakMap,Qn=new WeakMap;var ce,ye,ve,Jn,Kn,Yn,Xn,Zn,zn,Fn,ea,ta;class vg{constructor(e=[]){y(this,ce,P(pe([])));y(this,ye,P(null));y(this,ve,P(null));y(this,Jn,z(()=>[...f(i(this,ce))].sort()[0]));y(this,Kn,z(()=>[...f(i(this,ce))].sort()[f(i(this,ce)).length-1]));y(this,Yn,z(()=>{if(f(i(this,ce)).length===0)return!0;const e=this.lastAvailableDate?new Date(this.lastAvailableDate):new Date;return e.setHours(23,59,59,999),e<new Date}));y(this,Xn,z(()=>{if(f(i(this,ce)).length===0)return!1;const e=new Date;return e.setHours(0,0,0,0),f(i(this,ce)).some(r=>new Date(r)>=e)}));y(this,Zn,z(()=>f(i(this,ye))===this.firstAvailableDate&&f(i(this,ve))===this.lastAvailableDate));y(this,zn,z(()=>{if(f(i(this,ce)).length===0)return!1;const e=[...f(i(this,ce))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(o=>new Date(o)>=r)||null;let n,a;if(s)n=s,a=e[e.length-1];else{const o=e[e.length-1];n=o,a=o}return f(i(this,ye))===n&&f(i(this,ve))===a}));y(this,Fn,z(()=>f(i(this,ce)).length===1));y(this,ea,z(()=>!!(f(i(this,ye))&&f(i(this,ye))===f(i(this,ve)))));y(this,ta,z(()=>{if(!f(i(this,ye))||!f(i(this,ve))||this.isEventPassed)return!1;const e=new Date(f(i(this,ye)));return e.setHours(e.getHours()+Pu),e<new Date}));m(i(this,ce),e,!0),this.initializeSmartRange()}get start(){return f(i(this,ye))}get end(){return f(i(this,ve))}get dates(){return f(i(this,ce))}get firstAvailableDate(){return f(i(this,Jn))}set firstAvailableDate(e){m(i(this,Jn),e)}get lastAvailableDate(){return f(i(this,Kn))}set lastAvailableDate(e){m(i(this,Kn),e)}get current(){return{start:f(i(this,ye)),end:f(i(this,ve))}}get isEventPassed(){return f(i(this,Yn))}set isEventPassed(e){m(i(this,Yn),e)}get hasUpcomingDates(){return f(i(this,Xn))}set hasUpcomingDates(e){m(i(this,Xn),e)}get isFullRange(){return f(i(this,Zn))}set isFullRange(e){m(i(this,Zn),e)}get isUpcomingRange(){return f(i(this,zn))}set isUpcomingRange(e){m(i(this,zn),e)}get hasSingleDateEvent(){return f(i(this,Fn))}set hasSingleDateEvent(e){m(i(this,Fn),e)}get hasSingleDateInRange(){return f(i(this,ea))}set hasSingleDateInRange(e){m(i(this,ea),e)}get hasPastDatesInRange(){return f(i(this,ta))}set hasPastDatesInRange(e){m(i(this,ta),e)}setAvailableDates(e){m(i(this,ce),e,!0),this.initializeSmartRange()}setRange(e,r){if(!e&&!r){m(i(this,ye),null),m(i(this,ve),null);return}if(!e||!r){const a=e||r;m(i(this,ye),a,!0),m(i(this,ve),a,!0);return}const s=new Date(e)<=new Date(r)?e:r,n=new Date(e)>=new Date(r)?e:r;m(i(this,ye),s,!0),m(i(this,ve),n,!0)}selectAll(){f(i(this,ce)).length!==0&&(m(i(this,ye),f(i(this,ce))[0],!0),m(i(this,ve),f(i(this,ce))[f(i(this,ce)).length-1],!0))}selectUpcoming(){if(f(i(this,ce)).length===0)return;const e=[...f(i(this,ce))].sort(),r=new Date;r.setHours(0,0,0,0);const s=e.find(n=>new Date(n)>=r)||null;if(s)m(i(this,ye),s,!0),m(i(this,ve),e[e.length-1],!0);else{const n=e[e.length-1];m(i(this,ye),n,!0),m(i(this,ve),n,!0)}}selectFutureDatesOnly(){const e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const r=f(i(this,ce)).filter(s=>new Date(s)>=e);r.length>0&&(m(i(this,ye),r[0],!0),m(i(this,ve),r[r.length-1],!0))}initializeSmartRange(){if(f(i(this,ce)).length===0)return;const e=[...f(i(this,ce))].sort(),r=this.isEventPassed,s=new Date(e[0])<new Date,n=new Date;let a;r?a=e[0]:s?a=n.toISOString().slice(0,19)+"Z":a=e[0],m(i(this,ye),a,!0),m(i(this,ve),e[e.length-1],!0),console.log(`[DateRangeStore] Initialized: ${f(i(this,ye))} - ${f(i(this,ve))}`)}reset(){m(i(this,ce),[],!0),m(i(this,ye),null),m(i(this,ve),null),console.log("[DateRangeStore] Reset")}}ce=new WeakMap,ye=new WeakMap,ve=new WeakMap,Jn=new WeakMap,Kn=new WeakMap,Yn=new WeakMap,Xn=new WeakMap,Zn=new WeakMap,zn=new WeakMap,Fn=new WeakMap,ea=new WeakMap,ta=new WeakMap;function bg(t,e={}){const{showOtherUserToasts:r=!0}=e;return s=>{const{events:n,payload:a}=s;if(!a)return;if(s.event==="client.connected"){t.onConnect?.();return}const o=n.some(h=>h.includes("products.")),c=n.some(h=>h.includes("purchases.")),l=n.some(h=>h.includes(".create")),u=n.some(h=>h.includes(".update")),d=n.some(h=>h.includes(".delete"));o?Eg(a,{isCreate:l,isUpdate:u,isDelete:d},t,r):c&&Sg(a,{isCreate:l,isUpdate:u,isDelete:d},t,r)}}function Eg(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;s&&t.updatedBy&&t.updatedBy!==q.userName&&(n||a?Je.info(`${t.updatedBy} a modifiÃ© le produit "${t.productName}"`,{source:"realtime-other"}):o&&Je.info(`${t.updatedBy} a supprimÃ© un produit`,{source:"realtime-other"})),n?r.onProductCreate(t):a?r.onProductUpdate(t):o&&r.onProductDelete(t.$id)}function Sg(t,e,r,s){const{isCreate:n,isUpdate:a,isDelete:o}=e;if(s&&t.createdBy&&t.createdBy!==q.userName){const c="un produit";n&&t.who!==q.userName?Je.info(`${t.who} a ajoutÃ© un achat pour ${c}`,{source:"realtime-other"}):a&&t.who!==q.userName?Je.info(`${t.who} a modifiÃ© un achat pour ${c}`,{source:"realtime-other"}):o&&Je.info(`${t.who} a supprimÃ© un achat pour ${c}`,{source:"realtime-other"})}n?r.onPurchaseCreate(t):a?r.onPurchaseUpdate(t):o&&r.onPurchaseDelete(t.$id)}function Ig(t,e={}){const r=ut(),s=wr("products"),n=wr("purchases"),a=[`databases.${r}.collections.${s}.documents`,`databases.${r}.collections.${n}.documents`],o=bg(t,e),c=Vt.registerDynamic(a,o);return console.log(`[ProductsRealtimeHandler] â Realtime configurÃ© (${a.length} channels)`),c}const dl=1e3;var B,tt,Te,Oe,$r,ra,Js,cs,ls,We,re,kr,sa,$,it,O,na,aa,ia,oa,ca,Ai,la,ua,_i,Ad,Ks,ir,_d,Rd,Ja,Ka,Pd,mo,_g,Ya,Dd,Md,$d,kd,Cd,Xa,go,Td,Nd,Ld,jd,qd,da,fa;class Ag{constructor(){y(this,$);y(this,B,new ht);y(this,tt,new ht);y(this,Te,P(null));y(this,Oe,P(null));y(this,$r,P(!1));y(this,ra,P(!1));y(this,Js,P(null));y(this,cs,P(!1));y(this,ls,P(!1));y(this,We,P(null));N(this,"dateStore",new vg);y(this,re,null);y(this,kr,null);y(this,sa,P(pe([])));y(this,O,P(pe({searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"})));y(this,na,z(()=>{const e=Array.from(i(this,B).values()).map(r=>r.data);return console.log(`[ProductsStore] enrichedProducts recalculated: ${e.length} products`),e}));y(this,aa,z(()=>{if(console.log("[Store] Filtering products by date range (Map)"),!this.dateRange.start||!this.dateRange.end)return new Map;new Date(this.dateRange.start),new Date(this.dateRange.end);const e=new Map,r=this.dateRange.start,s=this.dateRange.end;for(const[n,a]of i(this,B)){const o=a.data,c=!o.productHugoUuid;if(!o.byDate&&!c||!np(o,f(i(this,O))))continue;if(f(i(this,O)).completionStatus!=="all"){const d=a.stats.hasMissing;if(f(i(this,O)).completionStatus==="completed"&&d||f(i(this,O)).completionStatus==="incomplete"&&!d)continue}let u=!1;o.byDate&&(u=Object.keys(o.byDate).some(d=>d>=r&&d<=s)),(u||c)&&e.set(n,a)}return e}));y(this,ia,z(()=>({total:i(this,B).size,frais:Array.from(i(this,B).values()).filter(e=>e.pF).length,surgel:Array.from(i(this,B).values()).filter(e=>e.pS).length,merged:Array.from(i(this,B).values()).filter(e=>e.data.isMerged).length})));y(this,oa,z(()=>{const e=Array.from(i(this,B).values()).map(r=>r.storeInfo?.storeName).filter(Boolean);return[...new Set(e)]}));y(this,ca,z(()=>{if(!f(i(this,Oe)))return[];const e=Ne.getEventById(f(i(this,Oe)));return e?.contributors?e.contributors.filter(r=>r.status==="accepted"&&r.name?.trim()).map(r=>r.name.trim()).sort():[]}));y(this,Ai,z(()=>{const e=Array.from(i(this,B).values()).flatMap(r=>r.who||[]);return[...new Set(e)].sort()}));y(this,la,z(()=>{const e=new Set([...this.eventContributors,...f(i(this,Ai))]);return Array.from(e).sort()}));y(this,ua,z(()=>{const e=Array.from(i(this,B).values()).map(r=>r.productType).filter(Boolean);return[...new Set(e)]}));y(this,_i,z(()=>{const r=Array.from(this.filteredProductsMap.values()).sort((o,c)=>o.$id.localeCompare(c.$id));if(f(i(this,O)).groupBy==="none")return{"":r};const s=Object.groupBy(r,o=>f(i(this,O)).groupBy==="store"?o.storeInfo?.storeName||"Non dÃ©fini":o.productType||"Non dÃ©fini"),n=Object.keys(s).sort((o,c)=>o===""?1:c===""?-1:o.localeCompare(c)),a={};return n.forEach(o=>{a[o]=s[o]}),a}));y(this,Ks,"");y(this,ir,null);N(this,"setSearchQuery",zh(e=>{f(i(this,O)).searchQuery=e,e.trim().length>0&&(f(i(this,O)).selectedStores=[],f(i(this,O)).selectedWho=[],f(i(this,O)).selectedProductTypes=[],f(i(this,O)).selectedTemperatures=[],f(i(this,O)).temperatureFilter="all",f(i(this,O)).completionStatus="all")},()=>500));y(this,da,z(()=>{let e=0,r=0;for(const s of i(this,B).values())s.stats.hasMissing?r++:e++;return{completed:e,missing:r,total:e+r}}));y(this,fa,z(()=>{let e=0;const r={},s={},n=[];for(const a of i(this,tt).values()){const o=a.invoiceTotal||a.price||0;e+=o;const c=a.store||"Non dÃ©fini";r[c]=(r[c]||0)+o;const l=a.who||"Non dÃ©fini";s[l]=(s[l]||0)+o,n.push(a)}for(const a of i(this,B).values()){const o=a.data;if(o.purchases&&o.purchases.length>0){for(const c of o.purchases)if(c.price){e+=c.price;const l=c.store||"Non dÃ©fini";r[l]=(r[l]||0)+c.price;const u=c.who||"Non dÃ©fini";s[u]=(s[u]||0)+c.price;const d={...c,_productName:o.productName};n.push(d)}}}return n.sort((a,o)=>{const c=new Date(a.orderDate||a.$createdAt).getTime();return new Date(o.orderDate||o.$createdAt).getTime()-c}),{totalGlobal:e,byStore:r,byWho:s,allPurchases:n}}))}get currentMainId(){return f(i(this,Te))}get dateRange(){return this.dateStore.current}get availableDates(){return this.dateStore.dates}get isEventPassed(){return this.dateStore.isEventPassed}get hasSingleDateEvent(){return this.dateStore.hasSingleDateEvent}get hasSingleDateInRange(){return this.dateStore.hasSingleDateInRange}get hasPastDatesInRange(){return this.dateStore.hasPastDatesInRange}get hasPendingConflicts(){return f(i(this,sa)).length>0}get pendingConflicts(){return f(i(this,sa))}get filters(){return f(i(this,O))}get hasFilters(){return this.filters.searchQuery!==""||this.filters.selectedStores.length>0||this.filters.selectedWho.length>0||this.filters.selectedProductTypes.length>0||this.filters.selectedTemperatures.length>0||this.filters.temperatureFilter!=="all"||this.filters.completionStatus!=="all"}get isSearchActive(){return this.filters.searchQuery.trim().length>0}get activeFiltersDescription(){const e=[];if(this.filters.completionStatus==="incomplete"?e.push("Manquants"):this.filters.completionStatus==="completed"&&e.push("Complets"),this.filters.temperatureFilter!=="all"){const r={frais:"Frais","not-frais":"Sans frais",surgele:"SurgelÃ©s","not-surgele":"Sans surgelÃ©s"};e.push(r[this.filters.temperatureFilter]||"")}return this.filters.selectedProductTypes.length>0&&e.push(`Types: ${this.filters.selectedProductTypes.length}`),this.filters.selectedStores.length>0&&e.push(`Magasins: ${this.filters.selectedStores.length}`),this.filters.selectedWho.length>0&&e.push(`Qui: ${this.filters.selectedWho.length}`),e}get groupedFilteredProducts(){return f(i(this,_i))}get loading(){return f(i(this,ra))}get error(){return f(i(this,Js))}get lastSync(){return f(i(this,We))}get syncing(){return f(i(this,cs))}setDateRange(e,r){this.dateStore.setRange(e,r)}isFullRange(){return this.dateStore.isFullRange}initializeDateRange(){this.dateStore.initializeSmartRange()}selectUpcomingDates(){this.dateStore.selectUpcoming()}isUpcomingRange(){return this.dateStore.isUpcomingRange}get firstAvailableDate(){return this.dateStore.firstAvailableDate}get lastAvailableDate(){return this.dateStore.lastAvailableDate}selectFutureDatesOnly(){this.dateStore.selectFutureDatesOnly()}get realtimeConnected(){return f(i(this,ls))}get enrichedProducts(){return f(i(this,na))}set enrichedProducts(e){m(i(this,na),e)}get filteredProductsMap(){return f(i(this,aa))}set filteredProductsMap(e){m(i(this,aa),e)}get stats(){return f(i(this,ia))}set stats(e){m(i(this,ia),e)}get uniqueStores(){return f(i(this,oa))}set uniqueStores(e){m(i(this,oa),e)}get eventContributors(){return f(i(this,ca))}set eventContributors(e){m(i(this,ca),e)}get uniqueWho(){return f(i(this,la))}set uniqueWho(e){m(i(this,la),e)}get uniqueProductTypes(){return f(i(this,ua))}set uniqueProductTypes(e){m(i(this,ua),e)}async initialize(e){if(!e?.trim())throw new Error("eventId invalide fourni");if(f(i(this,$r))&&f(i(this,Oe))===e){console.log(`[ProductsStore] DÃ©jÃ  initialisÃ© pour eventId: ${e}`);return}f(i(this,$r))&&f(i(this,Oe))!==e&&(console.log(`[ProductsStore] Changement d'Ã©vÃ©nement: ${f(i(this,Oe))} â ${e}, reset...`),this.reset()),console.log(`[ProductsStore] Initialisation avec eventId: ${e}`);const r=Ne.getEventById(e);if(!r)throw new Error(`ÃvÃ©nement ${e} introuvable dans EventsStore`);try{m(i(this,Oe),r.$id,!0),m(i(this,Te),r.$id,!0),console.log(`[ProductsStore] Initialisation du cache IDB pour mainId: ${f(i(this,Te))}`),_(this,re,await wg(f(i(this,Te)))),await v(this,$,Rd).call(this),i(this,B).size===0&&(console.log("[ProductsStore] Cache vide, calcul depuis event.meals..."),await v(this,$,_d).call(this,r),await v(this,$,Ja).call(this)),this.dateStore.setAvailableDates([...r.allDates||[]]),this.initializeDateRange(),await this.syncFromAppwrite(),await v(this,$,qd).call(this),m(i(this,$r),!0),v(this,$,Nd).call(this),i(this,ir)&&i(this,ir).call(this),_(this,ir,Yl(()=>{Or(()=>{const s=Ne.getEventById(e);s&&v(this,$,Ad).call(this,s)})})),console.log(`[ProductsStore] Initialisation complÃ©tÃ©e: ${i(this,B).size} produits`)}catch(s){const n=s instanceof Error?s.message:"Erreur lors de l'initialisation";throw m(i(this,Js),n,!0),console.error("[ProductsStore]",n,s),s}}async syncFromAppwrite(){if(v(this,$,it).call(this)){console.log("[ProductsStore] Mode local: skip syncFromAppwrite");return}if(f(i(this,Te))){m(i(this,cs),!0),console.log(`[ProductsStore] DÃ©but syncFromAppwrite pour mainId: ${f(i(this,Te))}`);try{console.log(`[ProductsStore] RÃ©cupÃ©ration des produits modifiÃ©s depuis lastSync: ${f(i(this,We))}`);const e=await vd(f(i(this,Te)),{lastSync:f(i(this,We)),limit:dl});if(console.log(`[ProductsStore] ${e.length} produits rÃ©cupÃ©rÃ©s depuis Appwrite`),e.forEach(r=>{const s=i(this,B).get(r.$id);console.log(`[ProductsStore] Sync produit ${r.$id}: existing=${!!s}, who=${r.who}, store=${r.store}`);const n=v(this,$,mo).call(this,r,s?.data);n.isSynced=!0,n.status="active",s?s.update(n):i(this,B).set(r.$id,new Es(n,this.dateStore))}),f(i(this,We))){console.log(`[ProductsStore] RÃ©cupÃ©ration des purchases modifiÃ©s depuis lastSync: ${f(i(this,We))}`);const r=await wd(f(i(this,Te)),f(i(this,We)),dl);console.log(`[ProductsStore] ${r.length} purchases modifiÃ©s rÃ©cupÃ©rÃ©s`),r.forEach(s=>{if(s.status==="expense")i(this,tt).set(s.$id,s);else if(s.products?.length){const n=s.products.map(a=>typeof a=="string"?a:a.$id);v(this,$,Xa).call(this,n,s)}})}v(this,$,Pd).call(this),await v(this,$,Ja).call(this),console.log("[ProductsStore] SyncFromAppwrite terminÃ© avec succÃ¨s")}catch(e){throw console.error("[ProductsStore] Erreur lors du sync:",e),e}finally{m(i(this,cs),!1)}}}toggleProductType(e){const r=f(i(this,O)).selectedProductTypes.indexOf(e);r>-1?f(i(this,O)).selectedProductTypes.splice(r,1):f(i(this,O)).selectedProductTypes.push(e)}toggleTemperature(e){const r=f(i(this,O)).selectedTemperatures.indexOf(e);r>-1?f(i(this,O)).selectedTemperatures.splice(r,1):f(i(this,O)).selectedTemperatures.push(e)}setTemperatureFilter(e){f(i(this,O)).temperatureFilter=e}clearTypeAndTemperatureFilters(){f(i(this,O)).selectedProductTypes=[],f(i(this,O)).selectedTemperatures=[],f(i(this,O)).temperatureFilter="all"}setGroupBy(e){f(i(this,O)).groupBy=e}toggleStore(e){const r=f(i(this,O)).selectedStores.indexOf(e);r>-1?f(i(this,O)).selectedStores.splice(r,1):f(i(this,O)).selectedStores.push(e)}toggleWho(e){const r=f(i(this,O)).selectedWho.indexOf(e);r>-1?f(i(this,O)).selectedWho.splice(r,1):f(i(this,O)).selectedWho.push(e)}clearStoreFilters(){f(i(this,O)).selectedStores=[]}clearWhoFilters(){f(i(this,O)).selectedWho=[]}setCompletionStatus(e){f(i(this,O)).completionStatus=e}handleSort(e){f(i(this,O)).sortColumn===e?f(i(this,O)).sortDirection=f(i(this,O)).sortDirection==="asc"?"desc":"asc":(f(i(this,O)).sortColumn=e,f(i(this,O)).sortDirection="asc")}clearFilters(){m(i(this,O),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0)}sortProducts(e){return f(i(this,O)).sortColumn?[...e].sort((r,s)=>{let n=r[f(i(this,O)).sortColumn],a=s[f(i(this,O)).sortColumn];return f(i(this,O)).sortColumn==="totalNeededConsolidated"?(n=parseFloat(n)||0,a=parseFloat(a)||0):f(i(this,O)).sortColumn==="purchases"&&(n=r.purchases?.length||0,a=s.purchases?.length||0),n<a?f(i(this,O)).sortDirection==="asc"?-1:1:n>a?f(i(this,O)).sortDirection==="asc"?1:-1:0}):e}getEnrichedProductById(e){return i(this,B).get(e)?.data??null}getProductModelById(e){return i(this,B).get(e)??null}hasConversions(e){const r=i(this,B).get(e)?.data;return r?.byDate?sp(r.byDate):!1}async forceReload(e){await this.clearCache(),await this.initialize(e)}async clearCache(){i(this,B).clear(),m(i(this,We),null),i(this,re)&&await i(this,re).clear(),console.log("[ProductsStore] Cache vidÃ©")}setSyncStatus(e,r){const s=r?"isSyncing":"active";e.forEach(n=>{const a=i(this,B).get(n);if(a){const o={...a.data,status:s};a.update(o)}}),console.log(`[ProductsStore] Statut de synchronisation mis Ã  jour: ${e.length} produits â ${s}`)}clearSyncStatus(){const e=[];for(const[r,s]of i(this,B))s.status==="isSyncing"&&e.push(r);e.length>0&&(this.setSyncStatus(e,!1),console.log(`[ProductsStore] Nettoyage de ${e.length} produits en statut "isSyncing"`))}reset(){var e;console.log(`[ProductsStore] Reset pour eventId: ${f(i(this,Oe))}`),(e=i(this,kr))==null||e.call(this),_(this,kr,null),i(this,ir)&&(i(this,ir).call(this),_(this,ir,null)),i(this,re)&&(i(this,re).close(),_(this,re,null)),i(this,B).clear(),i(this,tt).clear(),m(i(this,Te),null),m(i(this,Oe),null),m(i(this,$r),!1),m(i(this,ra),!1),m(i(this,Js),null),m(i(this,cs),!1),m(i(this,ls),!1),m(i(this,We),null),_(this,Ks,""),this.dateStore.reset(),m(i(this,O),{searchQuery:"",selectedStores:[],selectedWho:[],selectedProductTypes:[],selectedTemperatures:[],temperatureFilter:"all",completionStatus:"all",groupBy:"productType",sortColumn:"",sortDirection:"asc"},!0),console.log("[ProductsStore] Reset terminÃ©")}async createPurchaseLocal(e,r,s){const n=i(this,B).get(e);if(!n)throw new Error(`Produit ${e} introuvable`);const a=s.status||"delivered";let o=s.deliveryDate||null;a==="delivered"&&!o&&(o=new Date().toISOString());const c={$id:crypto.randomUUID(),$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$databaseId:"localDemo",$tableId:"localDemo",$permissions:[],$sequence:0,invoiceId:s.invoiceId||null,notes:s.notes||"",store:s.store||null,mainId:f(i(this,Oe)),unit:r[0]?.u||"",quantity:r.reduce((d,h)=>d+h.q,0),price:s.price||null,status:a,who:s.who||null,createdBy:"guest",orderDate:s.orderDate||new Date().toISOString(),deliveryDate:o,invoiceTotal:null,products:[e]},l=Is(n.data),u={...l,purchases:[...l.purchases||[],c],$updatedAt:new Date().toISOString()};i(this,re)&&await i(this,re).upsertProduct(u),n.update(u),console.log(`[ProductsStore] Mode local: purchase crÃ©Ã© pour ${e}`)}async createProductLocal(e){const r=crypto.randomUUID(),s={$id:r,$createdAt:new Date().toISOString(),$updatedAt:new Date().toISOString(),$permissions:[],productHugoUuid:null,productName:e.productName,productType:e.productType||"ingredient",pF:e.pF??!1,pS:e.pS??!1,nbRecipes:0,totalAssiettes:0,isSynced:!1,mainId:f(i(this,Oe)),totalNeededRaw:[],status:e.status||"ok",who:e.who||null,store:e.store||"",stockReel:e.stockReel||null,previousNames:null,isMerged:!1,mergedFrom:null,mergeDate:null,mergeReason:null,isLocal:!0,mergedInto:null,totalNeededOverride:null,updatedBy:null,specs:null,purchases:[],pL:null,byDate:{},storeInfo:null,totalNeededOverrideParsed:null,displayMissingQuantity:null,missingQuantityArray:null},n=new Es(s,this.dateStore);return i(this,B).set(r,n),i(this,re)&&await i(this,re).upsertProduct(s),console.log(`[ProductsStore] Mode local: produit crÃ©Ã© ${r}`),r}async updateProductLocal(e,r){const s=i(this,B).get(e);if(!s)throw new Error(`Produit ${e} introuvable`);const n={...s.data,...r,$updatedAt:new Date().toISOString()};if(s.update(n),i(this,re)){const a=Is(s.data);await i(this,re).upsertProduct(a)}console.log(`[ProductsStore] Mode local: produit mis Ã  jour ${e}`)}async addPurchaseToLocal(e,r,s){return await this.createPurchaseLocal(e,r,s)}async updatePurchaseLocal(e,r){let s=null;for(const[o,c]of i(this,B))if(c.data.purchases?.some(l=>l.$id===e)){s=o;break}if(!s)throw new Error(`Purchase ${e} introuvable`);const a=i(this,B).get(s).data.purchases.map(o=>o.$id===e?{...o,...r,$updatedAt:new Date().toISOString()}:o);await this.updateProductLocal(s,{purchases:a})}async deletePurchaseLocal(e){let r=null;for(const[a,o]of i(this,B))if(o.data.purchases?.some(c=>c.$id===e)){r=a;break}if(!r)throw new Error(`Purchase ${e} introuvable`);const n=i(this,B).get(r).data.purchases.filter(a=>a.$id!==e);await this.updateProductLocal(r,{purchases:n})}async createPurchase(e,r,s){if(v(this,$,it).call(this))return await this.createPurchaseLocal(e,r,s);{const{createQuickValidationPurchases:n}=await V(async()=>{const{createQuickValidationPurchases:a}=await Promise.resolve().then(()=>Wr);return{createQuickValidationPurchases:a}},void 0);await n(f(i(this,Te)),e,r,s)}}async updatePurchase(e,r){if(v(this,$,it).call(this))return await this.updatePurchaseLocal(e,r);{const{updatePurchase:s}=await V(async()=>{const{updatePurchase:n}=await Promise.resolve().then(()=>Wr);return{updatePurchase:n}},void 0);await s(e,r)}}async deletePurchase(e){if(v(this,$,it).call(this))return await this.deletePurchaseLocal(e);{const{deletePurchase:r}=await V(async()=>{const{deletePurchase:s}=await Promise.resolve().then(()=>Wr);return{deletePurchase:s}},void 0);await r(e)}}async createProduct(e){if(v(this,$,it).call(this))return await this.createProductLocal(e);{const{upsertProduct:r}=await V(async()=>{const{upsertProduct:n}=await Promise.resolve().then(()=>Wr);return{upsertProduct:n}},void 0);return(await r(crypto.randomUUID(),e,n=>this.getEnrichedProductById(n))).$id}}async updateProduct(e,r){if(v(this,$,it).call(this))return await this.updateProductLocal(e,r);{const{updateProduct:s}=await V(async()=>{const{updateProduct:n}=await Promise.resolve().then(()=>Wr);return{updateProduct:n}},void 0);await s(e,r)}}async updateProductBatch(e,r,s){if(v(this,$,it).call(this))for(const[n,a]of Object.entries(r))await this.updateProductLocal(e,{[n]:a});else{const{updateProductBatch:n}=await V(async()=>{const{updateProductBatch:a}=await Promise.resolve().then(()=>Wr);return{updateProductBatch:a}},void 0);await n(e,r,s||(a=>this.getEnrichedProductById(a)))}}async batchUpdateProducts(e,r,s,n){if(v(this,$,it).call(this))return await v(this,$,Ld).call(this,e,s,n);{const{batchUpdateProductsOptimized:a}=await V(async()=>{const{batchUpdateProductsOptimized:o}=await Promise.resolve().then(()=>Wr);return{batchUpdateProductsOptimized:o}},void 0);return await a(e,r,s,n)}}async createGroupPurchase(e,r){if(v(this,$,it).call(this))return await v(this,$,jd).call(this,e,r);{const{createGroupPurchaseWithSync:s}=await V(async()=>{const{createGroupPurchaseWithSync:n}=await Promise.resolve().then(()=>Ug);return{createGroupPurchaseWithSync:n}},void 0);return await s(f(i(this,Te)),e,r)}}destroy(){var e;(e=i(this,kr))==null||e.call(this),_(this,kr,null),i(this,re)&&(i(this,re).close(),_(this,re,null)),console.log("[ProductsStore] Ressources nettoyÃ©es")}get completionStats(){return f(i(this,da))}set completionStats(e){m(i(this,da),e)}get financialStats(){return f(i(this,fa))}set financialStats(e){m(i(this,fa),e)}}B=new WeakMap,tt=new WeakMap,Te=new WeakMap,Oe=new WeakMap,$r=new WeakMap,ra=new WeakMap,Js=new WeakMap,cs=new WeakMap,ls=new WeakMap,We=new WeakMap,re=new WeakMap,kr=new WeakMap,sa=new WeakMap,$=new WeakSet,it=function(){return f(i(this,Oe))?Ne.getEventById(f(i(this,Oe)))?.status==="local":!1},O=new WeakMap,na=new WeakMap,aa=new WeakMap,ia=new WeakMap,oa=new WeakMap,ca=new WeakMap,Ai=new WeakMap,la=new WeakMap,ua=new WeakMap,_i=new WeakMap,Ad=async function(e){if(!f(i(this,$r))){console.warn("[ProductsStore] Sync ignorÃ© car store non initialisÃ©");return}const r=JSON.stringify(e.meals);if(i(this,Ks)===r)return;console.log(`[ProductsStore] â¡ï¸ CHANGEMENT REPAS DÃTECTÃ pour ${e.$id} (Hash: ${r.substring(0,10)}...), recalcul...`),_(this,Ks,r);const n=await ul(e,async o=>await li.getRecipeByUuid(o),e.$id);n.forEach(o=>{const c=i(this,B).get(o.$id);if(c){const u={...c.data,byDate:o.byDate,totalNeededArray:o.totalNeededArray,totalNeededRaw:o.totalNeededRaw,nbRecipes:o.nbRecipes,totalAssiettes:o.totalAssiettes};ng(u),c.update(u)}else i(this,B).set(o.$id,new Es(o,this.dateStore))});const a=new Set(n.map(o=>o.$id));for(const[o,c]of i(this,B))a.has(o)||!c.data.isSynced&&!c.data.purchases?.length&&i(this,B).delete(o);this.dateStore.setAvailableDates([...e.allDates||[]]),v(this,$,Ja).call(this)},Ks=new WeakMap,ir=new WeakMap,_d=async function(e){const s=await ul(e,async n=>await li.getRecipeByUuid(n),e.$id);s.forEach(n=>{i(this,B).set(n.$id,new Es(n,this.dateStore))}),console.log(`[ProductsStore] ${s.length} produits calculÃ©s depuis ${e.meals.length} repas`)},Rd=async function(){if(i(this,re))try{const e=await i(this,re).loadProducts();e.forEach((s,n)=>{s.status==="isSyncing"&&(s.status="active"),i(this,B).set(n,new Es(s,this.dateStore))});const r=await i(this,re).loadMetadata();m(i(this,We),r.lastSync,!0),this.dateStore.setAvailableDates([...r.allDates]),console.log(`[ProductsStore] ${e.size} produits chargÃ©s du cache IDB, lastSync: ${r.lastSync}`)}catch(e){console.warn("[ProductsStore] Erreur lecture cache IDB, ignorÃ©:",e)}},Ja=async function(){if(i(this,re))try{const e=new Map;i(this,B).forEach((r,s)=>{const n=Is(r.data);n.status==="isSyncing"&&(n.status="active"),e.set(s,n)}),await i(this,re).saveProducts(e),await i(this,re).saveMetadata({lastSync:f(i(this,We)),allDates:[...this.dateStore.dates]}),console.log("[ProductsStore] Cache IDB persistÃ©")}catch(e){console.error("[ProductsStore] Erreur persist cache IDB:",e)}},Ka=async function(e){if(!(!i(this,re)||e.length===0))try{const r=e.map(s=>i(this,B).get(s)?.data).filter(s=>s!=null).map(s=>{const n=Is(s);return n.status==="isSyncing"&&(n.status="active"),i(this,re).upsertProduct(n)});r.length>0&&(await Promise.all(r),console.log(`[ProductsStore] ${r.length} produits affectÃ©s persistÃ©s`))}catch(r){console.error("[ProductsStore] Erreur persistence produits affectÃ©s:",r)}},Pd=function(){m(i(this,We),new Date().toISOString(),!0)},mo=function(e,r){return r?qa(e,r):sg(e)},_g=function(e){e.length&&(e.forEach(r=>v(this,$,Ya).call(this,r)),console.log(`[ProductsStore] ${e.length} produits upserted`))},Ya=function(e){const r=i(this,B).get(e.$id),s=v(this,$,mo).call(this,e,r?.data);r?r.update(s):(this.dateStore.dates,i(this,B).set(e.$id,new Es(s,this.dateStore)))},Dd=function(e){i(this,B).delete(e)},Md=async function(e){if(!e.products?.length)return console.warn("[ProductsStore] Purchase crÃ©Ã© sans products:",e.$id),[];const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return v(this,$,Cd).call(this,r,e),r},$d=async function(e){if(e.products?.length){const r=e.products.map(s=>typeof s=="string"?s:s.$id).filter(Boolean);return v(this,$,Xa).call(this,r,e),r}console.log("[ProductsStore] Purchase update sans products[], rechargement...");try{const[r]=await Sd([e.$id]);if(r?.products?.length){const s=r.products.map(n=>typeof n=="string"?n:n.$id).filter(Boolean);return v(this,$,Xa).call(this,s,r),s}return[]}catch(r){return console.error("[ProductsStore] Erreur rechargement purchase:",r),[]}},kd=async function(e){const r=Array.from(i(this,B).values()).map(s=>s.data).filter(s=>s.purchases?.some(n=>n.$id===e));return r.forEach(s=>{v(this,$,Ya).call(this,s)}),r.map(s=>s.$id)},Cd=function(e,r){const s=Mc(r),n=[];e.forEach(a=>{const o=i(this,B).get(a);if(o){const c=o.data,l=c.purchases||[];if(!l.some(u=>u.$id===s.$id)){const u=qa({...c,purchases:[...l,s],status:"active"},c);n.push(u)}}}),n.forEach(a=>{const o=i(this,B).get(a.$id);o&&o.update(a)})},Xa=function(e,r){const s=Mc(r),n=[];e.forEach(a=>{const o=i(this,B).get(a);if(o){const c=o.data,l=c.purchases||[],u=l.findIndex(d=>d.$id===s.$id);if(u>=0){const d=[...l];d[u]=s;const h=qa({...c,purchases:d,status:"active"},c);n.push(h)}else{const d=qa({...c,purchases:[...l,r],status:"active"},c);n.push(d)}}}),n.forEach(a=>{const o=i(this,B).get(a.$id);o&&o.update(a)})},go=function(e){if(v(this,$,Ya).call(this,e),i(this,re)){const r=i(this,B).get(e.$id);r&&i(this,re).upsertProduct(Is(r.data)).catch(s=>console.error("[ProductsStore] Erreur persistence produit:",s))}},Td=function(){return{onProductCreate:e=>v(this,$,go).call(this,e),onProductUpdate:e=>v(this,$,go).call(this,e),onProductDelete:e=>{v(this,$,Dd).call(this,e),i(this,re)&&i(this,re).deleteProduct(e).catch(r=>console.error("[ProductsStore] Erreur suppression produit:",r))},onPurchaseCreate:async e=>{if(e.status==="expense"){i(this,tt).set(e.$id,e);return}const r=await v(this,$,Md).call(this,e);await v(this,$,Ka).call(this,r)},onPurchaseUpdate:async e=>{if(e.status==="expense"){i(this,tt).set(e.$id,e);return}i(this,tt).has(e.$id)&&i(this,tt).delete(e.$id);const r=await v(this,$,$d).call(this,e);await v(this,$,Ka).call(this,r)},onPurchaseDelete:async e=>{if(i(this,tt).has(e)){i(this,tt).delete(e);return}const r=await v(this,$,kd).call(this,e);await v(this,$,Ka).call(this,r)},onConnect:()=>{m(i(this,ls),!0)},onDisconnect:()=>{m(i(this,ls),!1)},onError:e=>{console.error("[ProductsStore] Erreur realtime:",e)}}},Nd=function(){if(v(this,$,it).call(this)){console.log("[ProductsStore] Mode local: skip realtime setup");return}const e=v(this,$,Td).call(this);_(this,kr,Ig(e))},Ld=async function(e,r,s){try{let n=0;for(const a of e){if(r==="who"){const o=s.names||[];await this.updateProductLocal(a,{who:o})}else if(r==="store"){const o=s;await this.updateProductLocal(a,{storeInfo:o})}n++}return{success:!0,updatedCount:n,updateType:r,timestamp:new Date().toISOString()}}catch(n){return{success:!1,updatedCount:0,updateType:r,error:n instanceof Error?n.message:"Erreur inconnue",timestamp:new Date().toISOString()}}},jd=async function(e,r){try{if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};let s=0;for(const n of e)await this.createPurchaseLocal(n.productId,n.missingQuantities,{invoiceId:r.invoiceId,notes:r.notes,store:r.store}),s++;return{success:!0,results:[],totalProductsCreated:e.length,totalPurchasesCreated:s,totalExpensesCreated:0}}catch(s){return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:s instanceof Error?s.message:"Erreur inconnue"}}},qd=async function(){if(v(this,$,it).call(this)){console.log("[ProductsStore] Mode local: skip loadOrphanPurchases");return}if(f(i(this,Te)))try{const e=await Id(f(i(this,Te)));e.forEach(r=>{i(this,tt).set(r.$id,r)}),console.log(`[ProductsStore] ${e.length} dÃ©penses globales chargÃ©es`)}catch(e){console.error("[ProductsStore] Erreur chargement dÃ©penses globales:",e)}},da=new WeakMap,fa=new WeakMap;const Od=new Ag,{APPWRITE_CONFIG:ji}=gs();async function Rg(t,e){return Qt(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:ji.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,teamId:e}),async:!1}),n=Ia(s.responseBody,{context:"removeTeamFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de la team");console.log(`[appwrite-functions] Team ${e} retirÃ©e de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeTeamFromEvent",timeout:6e4,errorMessage:"Erreur lors du retrait de la team"})}async function Pg(t){return Qt(async()=>{const{functions:e}=await D(),r=await e.createExecution({functionId:ji.functions.usersTeamsManager,body:JSON.stringify({action:"checkEmails",emails:t}),async:!1}),s=Ia(r.responseBody,{context:"checkUserEmails",fallback:null});if(!s||!s.success)throw new Error(s?.error||"Erreur lors de la vÃ©rification des emails");return s.data},{context:"AppwriteFunctions.checkUserEmails",timeout:15e3,errorMessage:"Erreur lors de la vÃ©rification des emails"})}async function Dg(t,e,r){const{teamIds:s=[],emails:n=[],userIds:a=[],message:o,sendEmailToExistingMembers:c=!0}=r;return Qt(async()=>{const{functions:l}=await D(),u=await l.createExecution({functionId:ji.functions.usersTeamsManager,body:JSON.stringify({action:"invite",context:{type:"event",id:t,name:e},teamIds:s,emails:n,userIds:a,message:o,sendEmailToExistingMembers:c}),async:!1}),d=Ia(u.responseBody,{context:"inviteParticipantsToEvent",fallback:null});if(!d||!d.success)throw new Error(d?.error||"Erreur lors de l'invitation");return console.log(`[appwrite-functions] ${d.processed} invitations traitÃ©es pour ${e}`),d},{context:"AppwriteFunctions.inviteParticipantsToEvent",timeout:6e4,errorMessage:"Erreur lors de l'invitation"})}async function Mg(t,e){return Qt(async()=>{const{functions:r}=await D(),s=await r.createExecution({functionId:ji.functions.usersTeamsManager,body:JSON.stringify({action:"remove-user-from-event",mainId:t,userId:e}),async:!1}),n=Ia(s.responseBody,{context:"removeUserFromEvent",fallback:null});if(!n||!n.success)throw new Error(n?.error||"Erreur lors du retrait de l'utilisateur");console.log(`[appwrite-functions] Utilisateur ${e} retirÃ© de l'Ã©vÃ©nement ${t}`)},{context:"AppwriteFunctions.removeUserFromEvent",timeout:1e4,errorMessage:"Erreur lors du retrait de l'utilisateur"})}const Ki=Object.freeze(Object.defineProperty({__proto__:null,checkUserEmails:Pg,inviteParticipantsToEvent:Dg,removeTeamFromEvent:Rg,removeUserFromEvent:Mg},Symbol.toStringTag,{value:"Module"})),$g=gs().APPWRITE_CONFIG;async function Hy(t,e,r){try{const{functions:s}=await D(),n=await s.createExecution({functionId:$g.functions.usersTeamsManager,body:JSON.stringify({action:"exchange-invite",userId:t,eventId:e,teamId:r})}),a=JSON.parse(n.responseBody);if(!a.success)throw new Error(a.error||"L'invitation est invalide.");return{token:a.token,userId:a.userId}}catch(s){throw console.error("[invitations] Error validating invitation:",s),s}}const kg=7,Vy={async getLock(t){const{tables:e}=await D();try{const r=await e.getRow({databaseId:ut(),tableId:wr("locks"),rowId:t});return!r.userId||new Date(r.expiresAt)<new Date?null:r}catch(r){if(r.code===404)return null;throw r}},async acquireLock(t,e,r){const{tables:s}=await D(),n=new Date(Date.now()+kg*60*1e3).toISOString(),a={userId:e,userName:r,expiresAt:n},o=[te.read(ae.any()),te.update(ae.user(e))];try{return await s.updateRow({databaseId:ut(),tableId:wr("locks"),rowId:t,data:a,permissions:o}),!0}catch(c){if(c.code===404)try{return await s.createRow({databaseId:ut(),tableId:wr("locks"),rowId:t,data:a,permissions:o}),!0}catch(l){return console.error("[locksService] Erreur crÃ©ation verrou:",l),!1}return console.warn("[locksService] Acquisition refusÃ©e (peut-Ãªtre dÃ©jÃ  verrouillÃ©):",c.message),!1}},async releaseLock(t,e){const{tables:r}=await D();try{await r.updateRow({databaseId:ut(),tableId:wr("locks"),rowId:t,data:{userId:"",userName:"",expiresAt:new Date(0).toISOString()},permissions:[te.read(ae.any()),te.update(ae.any())]}),console.log(`[locksService] Verrou libÃ©rÃ© (rÃ©initialisÃ©) pour ${t}`)}catch(s){if(s.code===404){console.log(`[locksService] Verrou dÃ©jÃ  libÃ©rÃ© pour ${t}`);return}console.warn("[locksService] Impossible de libÃ©rer le verrou sur le serveur:",s.message)}},subscribeToLock(t,e){const r=ut(),s=wr("locks"),n=`databases.${r}.collections.${s}.documents.${t}`;return console.log("[locksService] Enregistrement du channel de lock:",n),Vt.registerDynamic([n],a=>{if(a.events?.some(c=>c.endsWith(".delete"))){e(null);return}if(!a.payload)return;const o=a.payload;!o.userId||new Date(o.expiresAt)<new Date?e(null):e(o)})}};var Cg=(t=>(t.ENTREE="entree",t.PLAT="plat",t.DESSERT="dessert",t.AUTRE="autre",t))(Cg||{}),Tg=(t=>(t.PUBLIC="public",t.PRIVATE="private",t.DELETED="deleted",t))(Tg||{});function Ng(t,e){const r=t.reduce((n,a)=>n+a.missingQuantities.length,0),s=e.invoiceTotal?1:0;return r+s}async function Lg(t,e,r){let s=null;try{const{account:c}=await D();s=(await c.get()).$id}catch(c){console.warn("[Appwrite Transaction] Impossible de rÃ©cupÃ©rer l'utilisateur connectÃ©:",c)}const n=e.purchaseStatus||"delivered";let a=e.purchaseDeliveryDate||null;n==="delivered"&&!a&&(a=new Date().toISOString());const o=t.flatMap(c=>c.missingQuantities.map(l=>({productId:c.productId,quantity:l.q,unit:l.u,status:n,notes:e.notes||"",store:e.store||"",who:e.who||void 0,price:void 0,orderDate:null,deliveryDate:a,createdBy:s})));return{mainId:r,purchasesData:o,invoiceData:e,fromUserId:s||""}}function jg(t,e,r=98){const s=[];let n=[],a=0;const o=!!e.invoiceTotal;let c=!1;for(const l of t){const u=l.missingQuantities.length;let d=a+u>r;o&&!c&&n.length>0&&(d=a+u+1>r),d&&n.length>0?(s.push(n),n=[l],a=u,c=!1):(n.push(l),a+=u)}return n.length>0&&s.push(n),s}async function qg(t){try{const e=gs(),{functions:r}=await D(),s={operation:"createGroupPurchaseWithSync",data:t};console.log(`[Appwrite Interactions] ExÃ©cution du lot: ${t.purchasesData.length} achats Ã  crÃ©er`);const n=await r.createExecution(e.APPWRITE_CONFIG.functions.batchUpdate,JSON.stringify(s),!1,"/","POST");if(n.status!=="completed")throw new Error(`ExÃ©cution Ã©chouÃ©e avec statut: ${n.status}.`);const a=JSON.parse(n.responseBody);return a.success?console.log(`[Appwrite Interactions] Lot exÃ©cutÃ© avec succÃ¨s: ${a.purchasesCreated} achats crÃ©Ã©s`):console.error("[Appwrite Interactions] Lot Ã©chouÃ©:",a.error),a}catch(e){console.error("[Appwrite Interactions] Erreur exÃ©cution lot:",e);const r=e instanceof Error?e.message:"Erreur inconnue";return{success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:t.invoiceData.invoiceId,error:r,timestamp:new Date().toISOString()}}}async function Og(t,e,r){if(!e?.length)return{success:!1,results:[],totalProductsCreated:0,totalPurchasesCreated:0,totalExpensesCreated:0,error:"Aucun produit Ã  traiter"};const s=Ng(e,r);console.log(`[Appwrite Interactions] Achat groupÃ©: ${e.length} produits, ${s} achats Ã  crÃ©er`);const n=jg(e,r,98);console.log(`[Appwrite Interactions] DÃ©coupage en ${n.length} lot(s) pour respecter la limite de 100 achats par lot`);const a=[];let o=0,c=0,l=0;for(let h=0;h<n.length;h++){const p=n[h];console.log(`[Appwrite Interactions] ExÃ©cution du lot ${h+1}/${n.length} (${p.length} produits)`);try{const g=await Lg(p,r,t),w=await md(()=>qg(g),{operationName:`Lot ${h+1}/${n.length}`,maxAutoRetries:1,autoRetryDelay:2e3});if(!w)throw new Error("OpÃ©ration annulÃ©e ou Ã©chouÃ©e aprÃ¨s tentatives");if(a.push(w),w.success)o+=w.productsCreated,c+=w.purchasesCreated,l+=w.expenseCreated?1:0;else{console.error(`[Appwrite Interactions] Erreur sur le lot ${h+1}: ${w.error}`);break}}catch(g){const w=g instanceof Error?g.message:"Erreur inconnue";console.error(`[Appwrite Interactions] Erreur lors de l'exÃ©cution du lot ${h+1}:`,g),a.push({success:!1,productsCreated:0,purchasesCreated:0,expenseCreated:!1,totalOperations:0,invoiceId:r.invoiceId,error:w,timestamp:new Date().toISOString()});break}}const u=a.every(h=>h.success),d=a.some(h=>!h.success);return{success:u,results:a,totalProductsCreated:o,totalPurchasesCreated:c,totalExpensesCreated:l,error:d?"Un ou plusieurs lots ont Ã©chouÃ©":void 0}}const Ug=Object.freeze(Object.defineProperty({__proto__:null,createGroupPurchaseWithSync:Og},Symbol.toStringTag,{value:"Module"}));export{rl as $,m as A,uh as B,Dh as C,fo as D,Km as E,yt as F,Pf as G,qm as H,q as I,Or as J,ph as K,Jm as L,ai as M,li as N,Je as O,cy as P,Pp as Q,wy as R,Xg as S,my as T,Fg as U,D as V,$h as W,qh as X,Iy as Y,Dm as Z,Ne as _,hy as a,Tg as a$,sl as a0,Vt as a1,Ym as a2,Od as a3,Xm as a4,ty as a5,Mh as a6,V as a7,My as a8,_h as a9,Ry as aA,ep as aB,To as aC,Kr as aD,tp as aE,_u as aF,Py as aG,dt as aH,ip as aI,Pu as aJ,Oy as aK,op as aL,Ay as aM,fg as aN,gg as aO,_o as aP,xg as aQ,Rc as aR,ht as aS,Ff as aT,Rp as aU,$y as aV,Dy as aW,By as aX,Uy as aY,eg as aZ,Cg as a_,wh as aa,Gg as ab,dy as ac,Hy as ad,Kg as ae,uy as af,ry as ag,mr as ah,gy as ai,_p as aj,yy as ak,fy as al,oy as am,jy as an,Ny as ao,Lo as ap,Ly as aq,qy as ar,Is as as,Cy as at,Ty as au,Vy as av,Ih as aw,_y as ax,ay,ug as az,pc as b,xy as b0,Yg as b1,py as b2,Vm as b3,vy as b4,Wg as b5,ky as b6,Ki as b7,So as c,Eo as d,ny as e,zg as f,Jg as g,Qg as h,sy as i,hc as j,cc as k,ly as l,f as m,cn as n,Rf as o,Sy as p,Ey as q,by as r,iy as s,Hg as t,z as u,Zg as v,Yf as w,ey as x,P as y,pe as z};
