var is=Object.defineProperty;var $a=oe=>{throw TypeError(oe)};var ls=(oe,n,r)=>n in oe?is(oe,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):oe[n]=r;var ba=(oe,n,r)=>ls(oe,typeof n!="symbol"?n+"":n,r),ds=(oe,n,r)=>n.has(oe)||$a("Cannot "+r);var Ne=(oe,n,r)=>(ds(oe,n,"read from private field"),r?r.call(oe):n.get(oe)),nt=(oe,n,r)=>n.has(oe)?$a("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(oe):n.set(oe,r);import{d as Be,p as De,v as i,g as s,h as a,a as Va,r as Ua,K as d,w as g,C as Ce,T as ut,b as o,c as Re,m as e,u as Q,o as t,B as st,W as vt,M as Mt,ae as vs,af as Ga,z as Ze,y as qe,J as mt,A as $,k as xe,a3 as A,x as f,I as We,O as $t,G as Te,e as He,i as xt,S as $e,ak as za,az as cs,aA as us,aB as It,aC as Et,aD as la,U as at,j as Le,aE as ja,aF as ms,aG as Wa,aH as Na,P as yt,aI as Pt,ag as ps,aJ as fs,ac as _s,aK as Ie,aa as da,f as Ha,aL as Fa,aM as gs,R as bs,t as va,aN as hs,aO as xs,X as ys,at as ws,au as ks,_ as ra,Y as Ss,D as Ps}from"./appwrite.js";import{c as _t,a as ta,b as Ms,D as St}from"./date-helpers.js";import{B as zt}from"./BtnGroupCheck.js";import{S as ka,I as Sa}from"./InfoCollapse.js";import{ay as ct,j as aa,az as Ja,T as ca,aA as ht,ab as Pa,aB as qs,aC as Ma,c as Ot,b as Cs,aa as gt,aD as Ds,t as jt,aE as Ka,X as ua,ak as As,ah as Xa,a2 as Ya,a as ma,a7 as qa,x as Ca,am as Ts,aF as Is,au as Da,av as Aa,s as Ta,U as Nt,G as pa,w as Za,F as Tt,S as Es,aG as xa,aH as ya,aI as Os,aJ as La,f as es,aK as $s,aL as ts,aM as zs,C as js,i as Ns,an as as,ag as ss,aN as Fs,P as Ls,aO as rs,_ as Ba}from"./icons.js";import{M as qt,b as wt,c as Ct,d as fa,s as wa,f as Ia,e as Bs,n as Ra}from"./index.js";import{a as Rs,b as na,c as oa,g as Ea,d as Qs,f as ha}from"./products-display.js";import{F as ia}from"./Fieldset.js";import{E as Vs}from"./EventStats.js";import{E as Us}from"./EventInvitationAlert.js";import{L as Gs}from"./LeftPanel.js";import"./CheckboxBadge.js";import"./event-stats-helpers.js";var Ws=i('<div><label class="input w-72"><!> <input/></label> <!></div>');function Dt(oe,n){Be(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),D=De(n,"flexCol",3,!1),m=Ua(n,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const K=Q(()=>l().map(q=>({id:q,label:q,disabled:q===r()})));var V=Ws(),F=a(V),j=a(F);ct(j,{class:"h-4 w-4 opacity-50"});var ne=s(j,2);Va(ne,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:v(),...m}),void 0,void 0,void 0,void 0,!0),t(F);var I=s(F,2);{var h=q=>{ka(q,{get suggestions(){return e(K)},onSuggestionClick:B=>r(B.label),buttonSize:"btn-xs"})};d(I,q=>{l().length>0&&q(h)})}t(V),g(()=>Ce(V,1,`flex ${D()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),ut(ne,r),o(oe,V),Re()}var Hs=i('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function sa(oe,n){Be(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),D=De(n,"flexCol",3,!1);const m=Q(()=>l().map(h=>({id:h,label:h,disabled:h===r()})));var K=Hs(),V=a(K),F=a(V);aa(F,{class:"h-4 w-4 opacity-50"});var j=s(F,2);vt(j),j.__keydown=function(...h){n.onkeydown?.apply(this,h)},t(V);var ne=s(V,2);{var I=h=>{ka(h,{get suggestions(){return e(m)},onSuggestionClick:q=>r(q.label),buttonSize:"btn-xs"})};d(ne,h=>{l().length>0&&h(I)})}t(K),g(()=>{Ce(K,1,`flex ${D()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),j.disabled=v()}),ut(j,r),o(oe,K),Re()}st(["keydown"]);var Js=i('<textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea>');function At(oe,n){Be(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Js();vs(v),g(()=>{v.disabled=l(),Mt(v,"id",n.id)}),ut(v,r),o(oe,v),Re()}var Ks=i('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function Oa(oe,n){Be(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Ks(),D=a(v);Ja(D,{class:"h-4 w-4 opacity-50"});var m=s(D,2);vt(m),t(v),g(()=>m.disabled=l()),ut(m,r),o(oe,v),Re()}var Xs=i('<label class="input w-fit"><span class="label">Date de livraison</span> <input type="date"/></label>'),Ys=i(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function ns(oe,n){Be(n,!0);let r=De(n,"status",15),l=De(n,"deliveryDate",15),v=De(n,"disabled",3,!1);var D=Ys(),m=a(D),K=a(m),V=a(K);V.value=V.__value="delivered";var F=s(V);F.value=F.__value="ordered",t(K);var j=s(K,2);t(m);var ne=s(m,2);{var I=h=>{var q=Xs(),B=s(a(q),2);vt(B),t(q),g(()=>B.disabled=v()),ut(B,l),o(h,q)};d(ne,h=>{r()==="ordered"&&h(I)})}t(D),g(()=>{K.disabled=v(),Ce(j,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),Ga(K,r),o(oe,D),Re()}var Zs=i('<div class="alert alert-error"><!> <span> </span></div>'),er=i(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),tr=i('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),ar=i('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),sr=i(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),rr=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),nr=i('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),or=i('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),ir=i("<!> <!> <!>",1);function lr(oe,n){Be(n,!0);let r=qe(!1),l=qe(null),v=Ze({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),D=qe(Ze(new Set));mt(()=>{$(D,new Set(n.products.map(I=>I.$id)),!0)});const m=Q(()=>n.products.filter(I=>e(D).has(I.$id))),K=Q(()=>e(m).length!==0),V=Q(()=>{const I=A.dateRange;let h="";return I?.start&&I?.end&&(I.start===I.end?h=` - ${_t(I.start)}`:h=` - Du ${_t(I.start)} au ${_t(I.end)}`),`Achat groupé (${e(m).length} produit${e(m).length>1?"s":""})${h}`});async function F(){if(!e(K)||e(r))return;$(r,!0),$(l,null);const I=`FACTURE_${Date.now()}`,h=e(m).map(U=>U.$id);A.setSyncStatus(h,!0),We.backgroundOperation={isRunning:!0,name:`Achat groupé (${e(m).length} produits)`,progress:0};const q=[];for(const U of e(m)){const ae=(A.getProductModelById(U.$id)?.stats.missingQuantities||[]).filter(w=>w.q<0).map(w=>({q:Math.abs(w.q),u:w.u}));q.push({productId:U.$id,isSynced:U.isSynced,missingQuantities:ae})}const B={invoiceId:I,invoiceTotal:v.expense||void 0,store:v.store.trim()||void 0,notes:v.notes||`Achat groupé pour ${e(m).length} produits`,who:v.who.trim()||void 0,purchaseStatus:v.status||"delivered",purchaseDeliveryDate:v.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${q.length} produits...`),n.onClose();try{await $t.track(A.createGroupPurchase(q,B).then(U=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${U.success?"succès":"échec"}, ${U.totalProductsCreated} produits synchronisés, ${U.totalPurchasesCreated} achats créés, ${U.totalExpensesCreated} dépenses globales`),!U.success)throw new Error(U.error||"Erreur lors de la création de l'achat groupé");return A.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),n.onSuccess?.(),U}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(U){console.error("[GroupPurchaseModal] Erreur création achat groupé:",U),A.clearSyncStatus()}finally{$(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function j(I){const h=new Set(e(D));h.has(I)?h.delete(I):h.add(I),$(D,h,!0)}const ne=Q(()=>n.products.map(I=>{const h=A.getProductModelById(I.$id);return{id:I.$id,label:I.productName,title:`${I.productName} - Manque: ${h?.stats.formattedMissingQuantities||"-"}`,badge:h?.stats.formattedMissingQuantities||"-"}}));qt(oe,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(I,h)=>{var q=ir(),B=xe(q);wt(B,{get title(){return e(V)},showBackButton:!0,get onClose(){return n.onClose}});var U=s(B,2);Ct(U,{children:(ae,w)=>{var k=sr(),b=a(k);{var L=O=>{var re=Zs(),be=a(re);ca(be,{class:"h-4 w-4"});var ee=s(be,2),ie=a(ee,!0);t(ee),t(re),g(()=>f(ie,e(l))),o(O,re)};d(b,O=>{e(l)&&O(L)})}var X=s(b,2),H=a(X);Sa(H,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:(O,re)=>{var be=er();Te(2),o(O,be)},$$slots:{default:!0}}),t(X);var ue=s(X,2),W=s(a(ue),2),ce=a(W),le=a(ce);Dt(le,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},get value(){return v.store},set value(O){v.store=O}}),t(ce);var J=s(ce,2),de=a(J);sa(de,{get suggestions(){return A.uniqueWho},get disabled(){return e(r)},get value(){return v.who},set value(O){v.who=O}}),t(J),t(W);var _e=s(W,2);Oa(_e,{get disabled(){return e(r)},get value(){return v.expense},set value(O){v.expense=O}});var me=s(_e,2);ns(me,{get disabled(){return e(r)},get status(){return v.status},set status(O){v.status=O},get deliveryDate(){return v.deliveryDate},set deliveryDate(O){v.deliveryDate=O}});var ve=s(me,2);At(ve,{get disabled(){return e(r)},get value(){return v.notes},set value(O){v.notes=O}}),t(ue);var R=s(ue,2);{var se=O=>{var re=tr(),be=s(a(re),2),ee=s(a(be)),ie=a(ee,!0);t(ee);var P=s(ee,2),T=a(P,!0);t(P),Te(),t(be);var fe=s(be,2);zt(fe,{get items(){return e(ne)},onToggleItem:j,size:"sm",color:"success"}),t(re),g((ge,te)=>{f(ie,ge),f(T,te)},[()=>_t(A.dateRange.start),()=>_t(A.dateRange.end)]),o(O,re)},Z=O=>{var re=ar();o(O,re)};d(R,O=>{e(ne).length>0?O(se):O(Z,!1)})}t(k),o(ae,k)}});var G=s(U,2);fa(G,{children:(ae,w)=>{var k=or(),b=a(k);b.__click=function(...W){n.onClose?.apply(this,W)};var L=s(b,2);L.__click=F;var X=a(L);{var H=W=>{var ce=rr();Te(),o(W,ce)},ue=W=>{var ce=nr(),le=xe(ce);ht(le,{class:"h-4 w-4"});var J=s(le,2),de=s(a(J)),_e=a(de);t(de),t(J),g(()=>f(_e,`${e(m).length??""} produit${e(m).length>1?"s":""}`)),o(W,ce)};d(X,W=>{e(r)?W(H):W(ue,!1)})}t(L),t(k),g(()=>{b.disabled=e(r),L.disabled=e(r)||!e(K)}),o(ae,k)}}),o(I,q)},$$slots:{default:!0}}),Re()}st(["click"]);const dr=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var vr=i("<option> </option>"),cr=i('<fieldset class="fieldset"><legend>Quantité</legend> <div class="flex gap-2"><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité"/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end"><option disabled selected>-</option><!></select></label></div></fieldset>');function _a(oe,n){Be(n,!0);let r=De(n,"quantity",15),l=De(n,"unit",15),v=De(n,"disabled",3,!1),D=De(n,"required",3,!0);var m=cr(),K=a(m),V=s(K,2),F=a(V),j=a(F);Pa(j,{class:"h-4 w-4 opacity-50"});var ne=s(j,2);vt(ne),t(F);var I=s(F,2),h=s(a(I),2),q=a(h);q.value=q.__value="";var B=s(q);He(B,17,()=>dr,xt,(U,G)=>{let ae=()=>e(G).value,w=()=>e(G).label;var k=vr(),b=a(k,!0);t(k);var L={};g(()=>{f(b,w()),L!==(L=ae())&&(k.value=(k.__value=ae())??"")}),o(U,k)}),t(h),t(I),t(V),t(m),g(()=>{Ce(K,1,`fieldset-legend ${D()?"required":""}`),ne.disabled=v(),ne.required=D(),Mt(ne,"aria-required",D()?"true":void 0),h.disabled=v(),h.required=D(),Mt(h,"aria-required",D()?"true":void 0)}),ut(ne,r),Ga(h,l),o(oe,m),Re()}var ur=i('<div class="alert alert-error text-sm"><!> <span> </span></div>'),mr=i('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),pr=i('<span class="loading loading-spinner"></span>'),fr=i('<span class="loading loading-spinner"></span>'),_r=i('<form class="flex h-full flex-col space-y-4"><!> <!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),gr=i("<!> <!>",1);function br(oe,n){Be(n,!0);let r=De(n,"open",15,!1),l=qe(!1),v=qe(null),D=qe(!1),m=qe(Ze({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const K=Q(()=>e(m).productName.trim().length>0&&e(m).productType.trim().length>0),V=Q(()=>A.uniqueProductTypes.map(I=>({id:I,label:I})));let F=Q(()=>A.isEventPassed);async function j(I=!1){if(!(!e(K)||e(l))){$(l,!0),$(v,null),$(D,!1);try{if(!A.currentMainId)throw new Error("Aucun événement principal sélectionné");const h={productName:e(m).productName.trim(),productType:e(m).productType.trim(),store:e(m).store.trim()?{storeName:e(m).store.trim()}:void 0,who:e(m).who.trim()?[e(m).who.trim()]:void 0,pF:e(m).pF,pS:e(m).pS,quantity:e(m).quantity?{q:e(m).quantity,u:e(m).unit.trim()||"pièces"}:void 0};await cs(h,A.currentMainId),$(D,!0),I?(e(m).productName="",e(m).quantity=null,e(m).unit="",e(m).pF=!1,e(m).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),$(m,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(h){console.error("Error creating product:",h),$(v,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{$(l,!1)}}}function ne(){r(!1),$(m,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),$(v,null)}mt(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),qt(oe,{get isOpen(){return r()},onClose:ne,children:(I,h)=>{var q=gr(),B=xe(q);wt(B,{title:"Ajouter un produit",onClose:ne});var U=s(B,2);Ct(U,{children:(G,ae)=>{var w=_r(),k=a(w);{var b=M=>{var Y=ur(),ye=a(Y);ca(ye,{size:18});var ke=s(ye,2),c=a(ke,!0);t(ke),t(Y),g(()=>f(c,e(v))),o(M,Y)};d(k,M=>{e(v)&&M(b)})}var L=s(k,2);{var X=M=>{var Y=mr(),ye=a(Y);Ma(ye,{class:"h-4 w-4"}),Te(4),t(Y),o(M,Y)};d(L,M=>{e(F)&&M(X)})}var H=s(L,2),ue=a(H),W=a(ue),ce=a(W),le=a(ce);qs(le,{class:"text-base-content/50 h-5 w-5"});var J=s(le,2);vt(J),t(ce),t(W);var de=s(W,2);_a(de,{get disabled(){return e(l)},get quantity(){return e(m).quantity},set quantity(M){e(m).quantity=M},get unit(){return e(m).unit},set unit(M){e(m).unit=M}}),t(ue);var _e=s(ue,2),me=a(_e),ve=a(me),R=a(ve);vt(R),t(ve);var se=s(ve,2);ka(se,{get suggestions(){return e(V)},onSuggestionClick:M=>e(m).productType=M.label,get disabled(){return e(l)}}),t(me),t(_e);var Z=s(_e,2);Dt(Z,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(m).store},set value(M){e(m).store=M}});var O=s(Z,2);sa(O,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(m).who},set value(M){e(m).who=M}});var re=s(O,2),be=a(re),ee=a(be),ie=a(ee);vt(ie),Te(2),t(ee),t(be);var P=s(be,2),T=a(P),fe=a(T);vt(fe),Te(2),t(T),t(P),t(re);var ge=s(re,2),te=a(ge);te.__click=ne;var C=s(te,2),N=a(C);N.__click=()=>j(!0);var he=a(N);{var S=M=>{var Y=pr();o(M,Y)},p=M=>{Ot(M,{size:18})};d(he,M=>{e(l)?M(S):M(p,!1)})}Te(),t(N);var _=s(N,2),x=a(_);{var z=M=>{var Y=fr();o(M,Y)};d(x,M=>{e(l)&&M(z)})}Te(),t(_),t(C),t(ge),t(H),t(w),g(()=>{H.disabled=e(l),J.disabled=e(l),R.disabled=e(l),ie.disabled=e(l),fe.disabled=e(l),te.disabled=e(l),N.disabled=e(l)||!e(m).productName||e(F),_.disabled=e(l)||!e(m).productName||e(F)}),$e("submit",w,M=>{M.preventDefault(),j(!1)}),ut(J,()=>e(m).productName,M=>e(m).productName=M),ut(R,()=>e(m).productType,M=>e(m).productType=M),za(ie,()=>e(m).pF,M=>e(m).pF=M),za(fe,()=>e(m).pS,M=>e(m).pS=M),o(G,w)}}),o(I,q)},$$slots:{default:!0}}),Re()}st(["click"]);var Ft,Lt,Bt,Rt,Qt,Vt,Ut,Gt,Wt,Ht,Jt,Kt,Xt,Yt,Zt,ea;class hr{constructor(n,r="recettes"){nt(this,Ft,qe(!1));nt(this,Lt,qe(null));nt(this,Bt,qe("recettes"));nt(this,Rt,Q(()=>A.getProductModelById(this.productId)));nt(this,Qt,Q(()=>this.productModel?.data??null));nt(this,Vt,Q(()=>this.product?.who??[]));nt(this,Ut,Q(()=>this.product?.stockParsed??null));nt(this,Gt,Q(()=>this.product?.purchases??[]));nt(this,Wt,Q(()=>this.product?.byDate?us(this.product.byDate):[]));nt(this,Ht,qe(Ze({purchase:{quantity:null,unit:"",store:"",who:We.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));nt(this,Jt,qe(Ze({overrideManagerEditMode:!1})));nt(this,Kt,qe(null));nt(this,Xt,Q(()=>this.editingPurchaseId?this.purchasesList.find(n=>n.$id===this.editingPurchaseId)??null:null));nt(this,Yt,qe(null));nt(this,Zt,Q(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));nt(this,ea,Q(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));ba(this,"formatQuantity",(n,r)=>la(n,r));ba(this,"formatDate",Rs);this.productId=n,this.currentTab=r,this.initForms()}get loading(){return e(Ne(this,Ft))}set loading(n){$(Ne(this,Ft),n,!0)}get error(){return e(Ne(this,Lt))}set error(n){$(Ne(this,Lt),n,!0)}get currentTab(){return e(Ne(this,Bt))}set currentTab(n){$(Ne(this,Bt),n,!0)}get productModel(){return e(Ne(this,Rt))}set productModel(n){$(Ne(this,Rt),n)}get product(){return e(Ne(this,Qt))}set product(n){$(Ne(this,Qt),n)}get whoList(){return e(Ne(this,Vt))}set whoList(n){$(Ne(this,Vt),n)}get stockParsed(){return e(Ne(this,Ut))}set stockParsed(n){$(Ne(this,Ut),n)}get purchasesList(){return e(Ne(this,Gt))}set purchasesList(n){$(Ne(this,Gt),n)}get recipes(){return e(Ne(this,Wt))}set recipes(n){$(Ne(this,Wt),n)}get forms(){return e(Ne(this,Ht))}set forms(n){$(Ne(this,Ht),n,!0)}get uiStates(){return e(Ne(this,Jt))}set uiStates(n){$(Ne(this,Jt),n,!0)}get editingPurchaseId(){return e(Ne(this,Kt))}set editingPurchaseId(n){$(Ne(this,Kt),n,!0)}get editingPurchaseData(){return e(Ne(this,Xt))}set editingPurchaseData(n){$(Ne(this,Xt),n)}get originalFormsSnapshot(){return e(Ne(this,Yt))}set originalFormsSnapshot(n){$(Ne(this,Yt),n,!0)}initForms(){const n=A.getProductModelById(this.productId);if(!n||!n.data)return;const r=n.stats.missingQuantities[0];if(r){const{value:l,unit:v}=It(Math.abs(r.q),r.u);this.forms.purchase.quantity=l,this.forms.purchase.unit=v}else this.forms.purchase.quantity=null,this.forms.purchase.unit=n.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=n.data.storeInfo?.storeName??"",this.forms.purchase.who=We.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=n.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=n.data.storeInfo?.storeName??"",this.forms.store.comment=n.data.storeInfo?.storeComment??null,this.forms.who=n.data.who?[...n.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return e(Ne(this,Zt))}set hasChanges(n){$(Ne(this,Zt),n)}get hasAnyChanges(){return e(Ne(this,ea))}set hasAnyChanges(n){$(Ne(this,ea),n)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(n){this.currentTab=n}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");const{value:n,unit:r}=It(this.forms.purchase.quantity,this.forms.purchase.unit),l=this.forms.purchase.status||"delivered";let v=this.forms.purchase.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString());const D=Et.normalize(n,r),m=D.quantity,K=D.unit;await A.createPurchase(this.product.$id,[{q:m,u:K}],{store:this.forms.purchase.store||void 0,who:this.forms.purchase.who||void 0,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:l,orderDate:this.forms.purchase.orderDate||null,deliveryDate:v,invoiceId:void 0});const V=this.product.missingQuantityArray[0];let F=null,j=this.product.totalNeededArray[0]?.u??"";if(V){const{value:ne,unit:I}=It(Math.abs(V.q),V.u);F=ne,j=I}this.forms.purchase={quantity:F,unit:j,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(n){this.editingPurchaseId=n.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(n){n.$id&&await this.withLoading(async()=>{const r=Et.normalize(n.quantity,n.unit),l=n.status||null;let v=n.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString()),await A.updatePurchase(n.$id,{unit:r.unit,quantity:r.quantity,store:n.store||null,who:n.who||null,notes:n.notes||"",price:n.price||null,status:l,orderDate:n.orderDate||null,deliveryDate:v}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(n){const r=this.purchasesList.find(l=>l.$id===n);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await A.deletePurchase(n)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const n=Et.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:n.quantity.toString(),unit:n.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};await A.updateProduct(this.product.$id,{stockReel:JSON.stringify(r)}),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{stockReel:null})},"Stock supprimé")}async setWho(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{who:n})},"Volontaires mis à jour")}async updateStore(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{storeInfo:n})},"Magasin mis à jour")}async setOverride(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:JSON.stringify(n)})},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:null})},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const n={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};n.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(n.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};n.storeInfo=r}Object.keys(n).length>0&&(await A.updateProductBatch(this.product.$id,n,r=>A.getEnrichedProductById(r)??void 0),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(n,r){this.loading=!0,this.error=null;try{const l=await n();return r&&this.showToast("success",r),l}catch(l){const v=l instanceof Error?l.message:"Une erreur est survenue";return this.error=v,this.showToast("error",v),console.error("[ProductModalState]",l),null}finally{this.loading=!1}}showToast(n,r){const l=new CustomEvent("toast",{detail:{type:n,message:r}});window.dispatchEvent(l)}}Ft=new WeakMap,Lt=new WeakMap,Bt=new WeakMap,Rt=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Zt=new WeakMap,ea=new WeakMap;var xr=i('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),yr=i('<div class="text-base-content/60 mt-1 text-xs"> </div>'),wr=i('<div class="font-medium"> </div> <!>',1),kr=i('<pre class="text-xs"> </pre>'),Sr=i('<span class="text-base-content/50 italic">Non défini</span>'),Pr=i('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),Mr=i('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function ga(oe,n){Be(n,!0);let r=De(n,"title",3,"Événement terminé"),l=De(n,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),v=De(n,"showData",3,!0),D=De(n,"data",3,null),m=De(n,"dataLabel",3,"");var K=Mr(),V=a(K),F=a(V);Ma(F,{class:"text-warning h-5 w-5"});var j=s(F,2);Cs(j,{class:"text-warning/70 h-4 w-4"});var ne=s(j,2),I=a(ne,!0);t(ne),t(V);var h=s(V,2),q=a(h,!0);t(h);var B=s(h,2);{var U=G=>{var ae=Pr(),w=a(ae);{var k=ue=>{var W=xr(),ce=a(W);t(W),g(()=>f(ce,`${m()??""} :`)),o(ue,W)};d(w,ue=>{m()&&ue(k)})}var b=s(w,2),L=a(b);{var X=ue=>{var W=at();g(()=>f(W,D())),o(ue,W)},H=ue=>{var W=Le(),ce=xe(W);{var le=de=>{var _e=at();g(me=>f(_e,me),[()=>D().join(", ")]),o(de,_e)},J=de=>{var _e=Le(),me=xe(_e);{var ve=se=>{var Z=Le(),O=xe(Z);{var re=ee=>{var ie=wr(),P=xe(ie),T=a(P,!0);t(P);var fe=s(P,2);{var ge=te=>{var C=yr(),N=a(C,!0);t(C),g(()=>f(N,D().storeComment)),o(te,C)};d(fe,te=>{D().storeComment&&te(ge)})}g(()=>f(T,D().storeName)),o(ee,ie)},be=ee=>{var ie=kr(),P=a(ie,!0);t(ie),g(T=>f(P,T),[()=>JSON.stringify(D(),null,2)]),o(ee,ie)};d(O,ee=>{D().storeName?ee(re):ee(be,!1)})}o(se,Z)},R=se=>{var Z=Sr();o(se,Z)};d(me,se=>{typeof D()=="object"&&D()!==null?se(ve):se(R,!1)},!0)}o(de,_e)};d(ce,de=>{Array.isArray(D())&&D().length>0?de(le):de(J,!1)},!0)}o(ue,W)};d(L,ue=>{typeof D()=="string"||typeof D()=="number"?ue(X):ue(H,!1)})}t(b),t(ae),o(G,ae)};d(B,G=>{v()&&D()&&G(U)})}t(K),g(()=>{f(I,r()),f(q,l())}),o(oe,K),Re()}var qr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Cr=i('<span class="loading loading-spinner loading-sm"></span>'),Dr=i('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-6"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Ar=i('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),Tr=i("<th>Actions</th>"),Ir=i('<span class="loading loading-spinner loading-sm"></span>'),Er=i('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),Or=i('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),$r=i('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),zr=i('<span class="loading loading-spinner loading-xs"></span>'),jr=i('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),Nr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Fr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Lr=i('<div class="mt-2 text-sm opacity-70"><!> </div>'),Br=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-37.5 truncate"> </span></div>'),Rr=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-25 truncate"> </span></div>'),Qr=i('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),Vr=i('<div class="card bg-base-100 border-neutral/40 card-xs border shadow-sm"><div class="card-body p-4"><div class="flex items-center justify-between gap-3"><div class="flex flex-wrap items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span class="font-medium"> </span></div> <div> <!></div> <div> </div></div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-sm"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),Ur=i('<div class="mt-4 space-y-3"></div>'),Gr=i('<div class="space-y-4"><!></div> <!>',1);function Wr(oe,n){Be(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);function v(b){return b.quantity!==null&&b.quantity!==0&&b.unit?.trim()!==""}function D(b){if(l())return;const{value:L,unit:X}=It(b.quantity,b.unit);r().forms.purchase.quantity=L,r().forms.purchase.unit=X,r().forms.purchase.price=b.price,r().forms.purchase.store=b.store||"",r().forms.purchase.who=b.who||"",r().forms.purchase.notes=b.notes||"",r().forms.purchase.status=b.status||null,r().forms.purchase.orderDate=b.orderDate||null,r().forms.purchase.deliveryDate=b.deliveryDate||null,r().startEditPurchase(b),setTimeout(()=>{const H=document.querySelector("#purchase-form-card");H?.scrollIntoView({behavior:"smooth",block:"center"}),H?.querySelector('input[type="number"]')?.focus()},100)}function m(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function K(){if(r().isPurchaseFormValid)if(r().editingPurchaseId){const b=r().editingPurchaseData;if(!b||!v(b))return;const L=r().forms.purchase.quantity??0,X=r().forms.purchase.unit,H=Et.normalize(L,X);b.quantity=H.quantity,b.unit=H.unit,b.price=r().forms.purchase.price,b.store=r().forms.purchase.store,b.who=r().forms.purchase.who,b.notes=r().forms.purchase.notes,b.status=r().forms.purchase.status,b.orderDate=r().forms.purchase.orderDate,b.deliveryDate=r().forms.purchase.deliveryDate,r().updateEditedPurchase(b),r().cancelEditPurchase()}else r().forms.purchase.status==="ordered"&&!r().forms.purchase.orderDate&&(r().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),r().addPurchase()}function V(b){r().removePurchase(b)}function F(b){D(b)}let j=Q(()=>r().editingPurchaseId!==null),ne=Q(()=>e(j)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),I=Q(()=>e(j)?"Enregistrer les modifications":"Ajouter l'achat");var h=Gr(),q=xe(h),B=a(q);{var U=b=>{ga(b,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},G=b=>{var L=Dr(),X=a(L),H=a(X),ue=a(H,!0);t(H);var W=s(H,2),ce=a(W),le=a(ce);_a(le,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(P){r().forms.purchase.quantity=P},get unit(){return r().forms.purchase.unit},set unit(P){r().forms.purchase.unit=P}});var J=s(le,2);Oa(J,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(P){r().forms.purchase.price=P}});var de=s(J,2);Dt(de,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(P){r().forms.purchase.store=P}});var _e=s(de,2);sa(_e,{get suggestions(){return A.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(P){r().forms.purchase.who=P}}),t(ce);var me=s(ce,2),ve=a(me);At(ve,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(P){r().forms.purchase.notes=P}}),t(me);var R=s(me,2);ns(R,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(P){r().forms.purchase.status=P},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(P){r().forms.purchase.deliveryDate=P}}),t(W);var se=s(W,2),Z=a(se);{var O=P=>{var T=qr();T.__click=m,o(P,T)};d(Z,P=>{e(j)&&P(O)})}var re=s(Z,2);re.__click=K;var be=a(re);{var ee=P=>{var T=Cr();o(P,T)},ie=P=>{var T=at();g(()=>f(T,e(I))),o(P,T)};d(be,P=>{r().loading?P(ee):P(ie,!1)})}t(re),t(se),t(X),t(L),g(()=>{Ce(L,1,`card bg-base-200 ${e(j)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,e(ne)),re.disabled=r().loading||!r().isPurchaseFormValid}),o(b,L)};d(B,b=>{l()?b(U):b(G,!1)})}t(q);var ae=s(q,2);{var w=b=>{var L=Ar(),X=a(L);ht(X,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(L),o(b,L)},k=b=>{var L=Le(),X=xe(L);{var H=W=>{var ce=$r(),le=a(ce),J=a(le),de=a(J),_e=s(a(de),8);{var me=R=>{var se=Tr();o(R,se)};d(_e,R=>{l()||R(me)})}t(de),t(J);var ve=s(J);He(ve,21,()=>r().purchasesList,R=>R.$id,(R,se)=>{var Z=Or(),O=a(Z),re=a(O,!0);t(O);var be=s(O),ee=a(be,!0);t(be);var ie=s(be),P=a(ie,!0);t(ie);var T=s(ie),fe=a(T),ge=a(fe,!0);t(fe),t(T);var te=s(T),C=a(te,!0);t(te);var N=s(te),he=a(N,!0);t(N);var S=s(N),p=a(S,!0);t(S);var _=s(S),x=a(_,!0);t(_);var z=s(_);{var M=Y=>{var ye=Er(),ke=a(ye),c=a(ke);c.__click=()=>F(e(se));var u=a(c);gt(u,{class:"h-4 w-4"}),t(c);var y=s(c,2);y.__click=()=>V(e(se).$id);var E=a(y);{var pe=we=>{var Me=Ir();o(we,Me)},Se=we=>{ua(we,{class:"h-4 w-4"})};d(E,we=>{r().loading?we(pe):we(Se,!1)})}t(y),t(ke),t(ye),g(()=>y.disabled=r().loading),o(Y,ye)};d(z,Y=>{l()||Y(M)})}t(Z),g((Y,ye,ke,c,u)=>{f(re,Y),f(ee,e(se).store||"-"),f(P,e(se).who||"-"),Ce(fe,1,`badge badge-sm ${ye??""}`),f(ge,ke),f(C,c),f(he,u),f(p,e(se).price?`${e(se).price}€`:"-"),f(x,e(se).notes||"-")},[()=>la(e(se).quantity,e(se).unit),()=>na(e(se).status).class,()=>na(e(se).status).text,()=>oa(e(se).orderDate),()=>oa(e(se).deliveryDate)]),o(R,Z)}),t(ve),t(le),t(ce),o(W,ce)},ue=W=>{var ce=Ur();He(ce,21,()=>r().purchasesList,le=>le.$id,(le,J)=>{var de=Vr(),_e=a(de),me=a(_e),ve=a(me),R=a(ve),se=a(R);Ds(se,{class:"size-4"});var Z=s(se,2),O=a(Z,!0);t(Z),t(R);var re=s(R,2),be=a(re),ee=s(be);Ja(ee,{class:"me-1 inline size-4"}),t(re);var ie=s(re,2),P=a(ie,!0);t(ie),t(ve);var T=s(ve,2);{var fe=c=>{var u=jr();u.__click=()=>V(e(J).$id);var y=a(u);{var E=Se=>{var we=zr();o(Se,we)},pe=Se=>{As(Se,{size:16})};d(y,Se=>{r().loading?Se(E):Se(pe,!1)})}t(u),g(()=>u.disabled=r().loading),o(c,u)};d(T,c=>{l()||c(fe)})}t(me);var ge=s(me,2),te=a(ge);{var C=c=>{var u=Nr(),y=a(u);jt(y,{class:"size-3.5"});var E=s(y,2),pe=a(E);t(E),t(u),g(Se=>f(pe,`Commande: ${Se??""}`),[()=>oa(e(J).orderDate)]),o(c,u)};d(te,c=>{e(J).orderDate&&c(C)})}var N=s(te,2);{var he=c=>{var u=Fr(),y=a(u);jt(y,{class:"size-3.5"});var E=s(y,2),pe=a(E);t(E),t(u),g(Se=>f(pe,`Livraison: ${Se??""}`),[()=>e(J).deliveryDate?oa(e(J).deliveryDate):"non renseigné"]),o(c,u)};d(N,c=>{e(J).status==="ordered"&&c(he)})}t(ge);var S=s(ge,2);{var p=c=>{var u=Lr(),y=a(u);Ka(y,{class:"me-1 inline size-3.5"});var E=s(y);t(u),g(()=>f(E,` ${e(J).notes??""}`)),o(c,u)};d(S,c=>{e(J).notes&&c(p)})}var _=s(S,2),x=a(_);{var z=c=>{var u=Br(),y=a(u);ct(y,{class:"h-3 w-3"});var E=s(y,2),pe=a(E,!0);t(E),t(u),g(()=>f(pe,e(J).store)),o(c,u)};d(x,c=>{e(J).store&&c(z)})}var M=s(x,2);{var Y=c=>{var u=Rr(),y=a(u);aa(y,{class:"size-3.5"});var E=s(y,2),pe=a(E,!0);t(E),t(u),g(()=>f(pe,e(J).who)),o(c,u)};d(M,c=>{e(J).who&&c(Y)})}t(_);var ye=s(_,2);{var ke=c=>{var u=Qr(),y=a(u);y.__click=()=>F(e(J));var E=a(y);gt(E,{size:16,class:"mr-1"}),Te(),t(y),t(u),o(c,u)};d(ye,c=>{l()||c(ke)})}t(_e),t(de),g((c,u,y)=>{f(O,c),f(be,`${(e(J).price?e(J).price:"?")??""} `),Ce(ie,1,`badge ${u??""}`),f(P,y)},[()=>la(e(J).quantity,e(J).unit),()=>na(e(J).status).class,()=>na(e(J).status).text]),o(le,de)}),t(ce),o(W,ce)};d(X,W=>{We.isMobile?W(ue,!1):W(H)},!0)}o(b,L)};d(ae,b=>{r().purchasesList.length===0?b(w):b(k,!1)})}o(oe,h),Re()}st(["click"]);var Hr=i(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),Jr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Kr=i('<span class="loading loading-spinner loading-xs"></span>'),Xr=i('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Yr=i('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),Zr=i('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),en=i('<span class="loading loading-spinner loading-xs"></span>'),tn=i('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),an=i('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),sn=i('<div class="space-y-4"><!></div> <!>',1);function rn(oe,n){Be(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=qe(!1);async function D(){await r()?.setStock(),$(v,!1)}async function m(){await r()?.removeStock()}function K(){if(!r().stockParsed)return;const{value:G,unit:ae}=It(r().stockParsed.quantity,r().stockParsed.unit);r().forms.stock.quantity=G,r().forms.stock.unit=ae,r().forms.stock.notes=r().stockParsed.notes??"",r().forms.stock.dateTime=r().stockParsed.dateTime,$(v,!0)}function V(){$(v,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var F=sn(),j=xe(F),ne=a(j);{var I=G=>{ga(G,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},h=G=>{var ae=Le(),w=xe(ae);{var k=b=>{var L=Xr(),X=a(L),H=a(X),ue=a(H,!0);t(H);var W=s(H,2),ce=a(W);Sa(ce,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(ee,ie)=>{Te();var P=Hr();Te(4),o(ee,P)},$$slots:{default:!0}}),t(W);var le=s(W,2),J=a(le);_a(J,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(ee){r().forms.stock.quantity=ee},get unit(){return r().forms.stock.unit},set unit(ee){r().forms.stock.unit=ee}}),t(le);var de=s(le,2),_e=a(de);At(_e,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(ee){r().forms.stock.notes=ee}}),t(de);var me=s(de,2),ve=a(me);{var R=ee=>{var ie=Jr();ie.__click=V,g(()=>ie.disabled=r().loading),o(ee,ie)};d(ve,ee=>{e(v)&&ee(R)})}var se=s(ve,2);se.__click=()=>{r().forms.stock.quantity=null,r().forms.stock.notes=""};var Z=s(se,2);Z.__click=D;var O=a(Z);{var re=ee=>{var ie=Kr();o(ee,ie)},be=ee=>{var ie=at();g(()=>f(ie,e(v)?"Enregistrer les modifications":"Déclarer le stock")),o(ee,ie)};d(O,ee=>{r().loading?ee(re):ee(be,!1)})}t(Z),t(me),t(X),t(L),g(ee=>{Ce(L,1,`card bg-base-200 ${e(v)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,ee),Ce(se,1,`btn btn-ghost btn-sm ${e(v)?"hidden":""}`),se.disabled=r().loading,Z.disabled=r().loading||!r().forms.stock.quantity},[()=>e(v)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),o(b,L)};d(w,b=>{(!r().stockParsed||e(v))&&b(k)})}o(G,ae)};d(ne,G=>{l()?G(I):G(h,!1)})}t(j);var q=s(j,2);{var B=G=>{var ae=Yr(),w=a(ae);Xa(w,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(ae),o(G,ae)},U=G=>{var ae=Le(),w=xe(ae);{var k=b=>{var L=an(),X=a(L),H=a(X),ue=s(a(H),2),W=a(ue);t(ue);var ce=s(ue,2),le=s(a(ce),2),J=a(le,!0);t(le),t(ce);var de=s(ce,2);{var _e=R=>{var se=Zr(),Z=s(a(se),2),O=a(Z,!0);t(Z),t(se),g(()=>f(O,r().stockParsed.notes)),o(R,se)};d(de,R=>{r().stockParsed.notes&&R(_e)})}t(H);var me=s(H,2);{var ve=R=>{var se=tn(),Z=a(se);Z.__click=m;var O=a(Z);{var re=P=>{var T=en();o(P,T)},be=P=>{var T=at("Supprimer le stock");o(P,T)};d(O,P=>{r().loading?P(re):P(be,!1)})}t(Z);var ee=s(Z,2);ee.__click=K;var ie=a(ee);gt(ie,{class:"mr-1 h-4 w-4"}),Te(),t(ee),t(se),g(()=>{Z.disabled=r().loading,ee.disabled=r().loading}),o(R,se)};d(me,R=>{l()||R(ve)})}t(X),t(L),g(R=>{f(W,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),f(J,R)},[()=>ta(r().stockParsed.dateTime)]),o(b,L)};d(w,b=>{e(v)||b(k)})}o(G,ae)};d(q,G=>{r().stockParsed?G(U,!1):G(B)})}o(oe,F),Re()}st(["click"]);var nn=i('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),on=i('<div class="space-y-4"><!></div>');function ln(oe,n){Be(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=qe("");const D=Q(()=>{const q=A.uniqueWho,B=new Set([...q,...r().forms.who]);return Array.from(B).map(U=>({id:U,label:U,selected:r().forms.who.includes(U)}))});function m(q){const B=q.trim();B&&!r().forms.who.includes(B)&&(r().forms.who=[...r().forms.who,B])}function K(q){r().forms.who=r().forms.who.filter(B=>B!==q)}function V(q){r().forms.who.includes(q)?K(q):m(q)}function F(){e(v).trim()&&(m(e(v)),$(v,""))}var j=on(),ne=a(j);{var I=q=>{ga(q,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},h=q=>{var B=nn(),U=a(B),G=s(a(U),4),ae=a(G),w=a(ae),k=a(w);aa(k,{class:"h-4 w-4 opacity-50"});var b=s(k,2);vt(b),b.__keydown=W=>{W.key==="Enter"&&(W.preventDefault(),F())},t(w);var L=s(w,2);L.__click=F;var X=a(L);Ya(X,{size:16}),t(L),t(ae);var H=s(ae,2),ue=s(a(H),2);zt(ue,{get items(){return e(D)},onToggleItem:V,size:"sm",color:"info"}),t(H),t(G),t(U),t(B),g(W=>{b.disabled=r().loading,L.disabled=W},[()=>r().loading||!e(v).trim()]),ut(b,()=>e(v),W=>$(v,W)),o(q,B)};d(ne,q=>{l()?q(I):q(h,!1)})}t(j),o(oe,j),Re()}st(["keydown","click"]);var dn=i(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),vn=i('<div class="space-y-4"><!></div>');function cn(oe,n){Be(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);const v=Q(()=>r()?.hasChanges?.store||!1);async function D(){if(!e(v))return;const j={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(j)}var m=vn(),K=a(m);{var V=j=>{{let ne=Q(()=>r().product?.storeInfo);ga(j,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return e(ne)},dataLabel:"Magasin actuel"})}},F=j=>{var ne=dn(),I=a(ne),h=s(a(I),4),q=a(h),B=a(q);Dt(B,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},onkeydown:w=>{w.key==="Enter"&&D()},get value(){return r().forms.store.name},set value(w){r().forms.store.name=w}}),t(q);var U=s(q,2);At(U,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(w){r().forms.store.comment=w}}),t(h);var G=s(h,2),ae=a(G);ae.__click=()=>{r().forms.store.name="",r().forms.store.comment=""},t(G),t(I),t(ne),g(()=>ae.disabled=r().loading),o(j,ne)};d(K,j=>{l()?j(V):j(F,!1)})}t(m),o(oe,m),Re()}st(["click"]);var un=i('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function mn(oe,n){Be(n,!0);let r=De(n,"value",15);De(n,"disabled",3,!1);var l=un(),v=a(l);Ka(v,{size:20,class:"text-base-centent/70"});var D=s(v,2);vt(D),t(l),ut(D,r),o(oe,l),Re()}var pn=i(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),fn=i('<span class="loading loading-spinner loading-sm"></span>'),_n=i('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),gn=i('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),bn=i('<div class="chat-bubble relative text-sm"> <!></div>'),hn=i('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),xn=i('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),yn=i('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function wn(oe,n){Be(n,!0);let r=De(n,"modalState",7);const l=Q(()=>r().product?.totalNeededOverrideParsed),v=Q(()=>r().product?.displayTotalOverride),D=Q(()=>r().product?Wa(r().product):null);let m=Q(()=>r().uiStates.overrideManagerEditMode),K=Q(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),V=Q(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function F(){if(!e(K)||!e(V))return{quantity:0,unit:""};const{q:w,u:k}=ja(e(K),e(V));return{quantity:ms(w,k),unit:k}}let j=qe(Ze(F().quantity)),ne=qe(Ze(F().unit)),I=qe(Ze(r().product?.totalNeededOverrideParsed?.comment||""));mt(()=>{if(e(m)){const w=F();$(j,w.quantity,!0),$(ne,w.unit,!0),$(I,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let h=Q(()=>e(j)>0&&e(ne).trim()!=="");async function q(){if(!r())return;const{q:w,u:k}=ja(e(j),e(ne)),b=r().product?.totalNeededOverrideParsed?.totalOverride,L=r().product?.totalNeededOverrideParsed?.comment||"";if(w!==b?.q||k!==b?.u||e(I)!==L){const H={totalOverride:{q:w,u:k},comment:e(I),totalComputedWhenOverride:r().product.totalNeededArray,platesNbWhenOverride:r().product.totalAssiettes,recipesNbWhenOverride:r().product.nbRecipes};await r().setOverride(H)}r().uiStates.overrideManagerEditMode=!1}async function B(){r()&&(await r().removeOverride(),r().uiStates.overrideManagerEditMode=!1)}var U=Le(),G=xe(U);{var ae=w=>{var k=yn(),b=a(k);{var L=Z=>{var O=pn(),re=a(O);Ca(re,{size:18});var be=s(re,2),ee=s(a(be),2),ie=a(ee),P=a(ie),T=s(a(P)),fe=a(T);t(T);var ge=s(T,2),te=a(ge,!0);t(ge),t(P),t(ie);var C=s(ie,2),N=a(C),he=s(a(N)),S=a(he);t(he);var p=s(he,2),_=a(p,!0);t(p),t(N),t(C);var x=s(C,2),z=a(x),M=a(z);t(z),t(x),t(ee),t(be),t(O),g((Y,ye)=>{f(fe,`${e(D).details.oldPlates??""} couverts,
                  ${e(D).details.oldRecipes??""} recettes`),f(te,Y),f(S,`${e(D).details.newPlates??""} couverts,
                  ${e(D).details.newRecipes??""} recettes`),f(_,ye),f(M,`Votre override : ${e(v)??""}`)},[()=>Na(e(D).details.oldComputed),()=>Na(e(D).details.newComputed)]),o(Z,O)};d(b,Z=>{e(D)?.hasMismatch&&e(D)?.details&&Z(L)})}var X=s(b,2),H=s(a(X),2),ue=a(H),W=a(ue),ce=s(W);ma(ce,{class:"h-3 w-3"}),t(ue);var le=s(ue,2),J=a(le),de=s(J);qa(de,{class:"h-3 w-3"}),t(le);var _e=s(le,2),me=a(_e,!0);t(_e),t(H),t(X);var ve=s(X,2);{var R=Z=>{var O=_n(),re=s(a(O),2);_a(re,{get quantity(){return e(j)},set quantity(te){$(j,te,!0)},get unit(){return e(ne)},set unit(te){$(ne,te,!0)}});var be=s(re,2);mn(be,{get value(){return e(I)},set value(te){$(I,te,!0)}});var ee=s(be,2),ie=a(ee);ie.__click=B;var P=s(ie,2);P.__click=q;var T=a(P);{var fe=te=>{var C=fn();o(te,C)},ge=te=>{var C=at("✓");o(te,C)};d(T,te=>{r().loading?te(fe):te(ge,!1)})}t(P),t(ee),t(O),g(()=>P.disabled=r().loading||!e(h)),yt(1,O,()=>wa),o(Z,O)},se=Z=>{var O=Le(),re=xe(O);{var be=ie=>{var P=hn(),T=a(P),fe=s(a(T),2);{var ge=p=>{var _=gn();_.__click=()=>r().uiStates.overrideManagerEditMode=!0;var x=a(_);Ts(x,{size:16}),t(_),o(p,_)};d(fe,p=>{n.isArchiveMode||p(ge)})}var te=s(fe,2);{var C=p=>{var _=bn(),x=a(_),z=s(x);Is(z,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),t(_),g(()=>f(x,`${e(l).comment??""} `)),o(p,_)};d(te,p=>{e(l).comment&&p(C)})}t(T);var N=s(T,2),he=a(N),S=a(he,!0);t(he),t(N),t(P),g(()=>f(S,e(v))),o(ie,P)},ee=ie=>{var P=Le(),T=xe(P);{var fe=ge=>{var te=xn(),C=a(te);C.__click=()=>r().uiStates.overrideManagerEditMode=!0;var N=s(a(C));gt(N,{size:16}),t(C),t(te),o(ge,te)};d(T,ge=>{n.isArchiveMode||ge(fe)},!0)}o(ie,P)};d(re,ie=>{e(v)&&e(l)?ie(be):ie(ee,!1)})}o(Z,O)};d(ve,Z=>{e(m)?Z(R):Z(se,!1)})}t(k),g(()=>{f(W,`${r().product.nbRecipes??""} `),f(J,`${r().product.totalAssiettes??""} `),f(me,r().product.displayTotalNeeded)}),o(w,k)};d(G,w=>{r().product&&w(ae)})}o(oe,U),Re()}st(["click"]);var kn=i('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),Sn=i('<span class="text-base-content/70"> </span>'),Pn=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-primary text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),Mn=i('<div class="mt-4 space-y-3"></div>'),qn=i('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function Cn(oe,n){Be(n,!0);const r=Q(()=>n.modalState.recipes);function l(I,h){return!I||!h?"-":la(I,h)}var v=qn(),D=xe(v);wn(D,{get modalState(){return n.modalState},get isArchiveMode(){return n.isArchiveMode}});var m=s(D,2),K=s(a(m),2),V=a(K);ma(V,{class:"h-5 w-5"}),Te(),t(K);var F=s(K,2);{var j=I=>{var h=kn(),q=a(h);Pa(q,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(h),o(I,h)},ne=I=>{var h=Mn();He(h,21,()=>e(r),xt,(q,B)=>{const U=Q(()=>l(e(B).q,e(B).u)),G=Q(()=>l(e(B).qEq,e(B).uEq));var ae=Pn(),w=a(ae),k=a(w),b=a(k),L=a(b),X=a(L,!0);t(L);var H=s(L,2),ue=a(H),W=s(ue);{var ce=O=>{Da(O,{class:"h-4 w-4 text-amber-500"})},le=O=>{var re=Le(),be=xe(re);{var ee=P=>{Aa(P,{class:"h-4 w-4 text-indigo-500"})},ie=P=>{var T=Le(),fe=xe(T);{var ge=te=>{Ta(te,{class:"h-4 w-4 text-sky-500"})};d(fe,te=>{Pt(e(B).dateTimeService)==="cloud"&&te(ge)},!0)}o(P,T)};d(be,P=>{Pt(e(B).dateTimeService)==="moon"?P(ee):P(ie,!1)},!0)}o(O,re)};d(W,O=>{Pt(e(B).dateTimeService)==="sun"?O(ce):O(le,!1)})}t(H),t(b);var J=s(b,2),de=a(J),_e=a(de);qa(_e,{class:" me-1 h-3 w-3 stroke-2"});var me=s(_e);t(de);var ve=s(de,2),R=a(ve,!0);t(ve);var se=s(ve,2);{var Z=O=>{var re=Sn(),be=a(re);t(re),g(ee=>f(be,`(${ee??""})`),[()=>l(e(B).q,e(B).u)]),o(O,re)};d(se,O=>{e(U)!==e(G)&&O(Z)})}t(J),t(k),t(w),t(ae),g((O,re,be)=>{f(X,e(B).r),f(ue,`${O??""} - ${re??""} `),f(me,` ${(e(B).a||0)??""} c.`),f(R,be)},[()=>_t(e(B).date),()=>Ms(e(B).date),()=>l(e(B).qEq,e(B).uEq)]),o(q,ae)}),t(h),o(I,h)};d(F,I=>{e(r).length===0?I(j):I(ne,!1)})}t(m),o(oe,v),Re()}var Dn=i('<div class="alert alert-warning border-warning/20 m-4 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),An=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Tn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),In=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),En=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),On=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),$n=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),zn=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),jn=i('<span class="badge badge-sm badge-secondary ml-1">1</span>'),Nn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Fn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Ln=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Bn=i('<div class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Rn=i("<!> <div><!></div>",1),Qn=i('<span class="loading loading-spinner loading-sm"></span>'),Vn=i("<!> Tout enregistrer",1),Un=i('<button class="btn btn-primary"><!></button>'),Gn=i('<button class="btn btn-ghost"> </button> <!>',1),Wn=i('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Hn(oe,n){Be(n,!0);let r=De(n,"initialTab",3,"recettes"),l=qe(null);mt(()=>{$(l,new hr(n.productId,r()),!0)});let v=Q(()=>A.isEventPassed),D=Q(()=>e(l)===null||e(l).product===null);function m(j){e(l)?.setCurrentTab(j)}function K(){e(l)?.saveAllChanges().then(()=>{e(l)?.resetForms(),n.onClose()})}function V(){e(l)?.resetForms(),n.onClose()}let F=Q(()=>e(l)?.hasAnyChanges??!1);{let j=Q(()=>!!n.productId);qt(oe,{get isOpen(){return e(j)},onClose:V,get hasUnsavedChanges(){return e(F)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(ne,I)=>{var h=Le(),q=xe(h);{var B=G=>{wt(G,{title:"Chargement...",showBackButton:!0,onClose:V})},U=G=>{var ae=Wn(),w=xe(ae);{let S=Q(()=>e(l)?.product?.productName||"Produit");wt(w,{get title(){return e(S)},showBackButton:!0,onClose:V})}var k=s(w,2);{var b=S=>{var p=Dn(),_=a(p);Ma(_,{class:"h-4 w-4"}),Te(4),t(p),o(S,p)};d(k,S=>{e(v)&&S(b)})}var L=s(k,2),X=a(L),H=a(X);H.__click=()=>m("recettes");var ue=a(H);ma(ue,{class:"mr-1 h-4 w-4"});var W=s(ue,4);{var ce=S=>{var p=An(),_=a(p,!0);t(p),g(()=>f(_,e(l).product.nbRecipes)),o(S,p)},le=S=>{var p=Tn();o(S,p)};d(W,S=>{e(l)?.product?.nbRecipes&&e(l).product.nbRecipes>0?S(ce):S(le,!1)})}t(H);var J=s(H,2);J.__click=()=>m("magasins");var de=a(J);ct(de,{class:"mr-1 h-4 w-4"});var _e=s(de,4);{var me=S=>{var p=In();o(S,p)};d(_e,S=>{e(l)?.hasChanges?.store&&S(me)})}t(J);var ve=s(J,2);ve.__click=()=>m("volontaires");var R=a(ve);Nt(R,{class:"mr-1 h-4 w-4"});var se=s(R,4);{var Z=S=>{var p=En();o(S,p)},O=S=>{var p=Le(),_=xe(p);{var x=M=>{var Y=On(),ye=a(Y,!0);t(Y),g(()=>f(ye,e(l).product.who.length)),o(M,Y)},z=M=>{var Y=$n();o(M,Y)};d(_,M=>{e(l)?.product?.who&&e(l).product.who.length>0?M(x):M(z,!1)},!0)}o(S,p)};d(se,S=>{e(l)?.hasChanges?.who?S(Z):S(O,!1)})}t(ve);var re=s(ve,2);re.__click=()=>m("stock");var be=a(re);Xa(be,{class:"mr-1 h-4 w-4"});var ee=s(be,4);{var ie=S=>{var p=zn();o(S,p)},P=S=>{var p=Le(),_=xe(p);{var x=M=>{var Y=jn();o(M,Y)},z=M=>{var Y=Nn();o(M,Y)};d(_,M=>{e(l)?.stockParsed?M(x):M(z,!1)},!0)}o(S,p)};d(ee,S=>{e(l)?.hasChanges?.stock?S(ie):S(P,!1)})}t(re);var T=s(re,2);T.__click=()=>m("achats");var fe=a(T);ht(fe,{class:"mr-1 h-4 w-4"});var ge=s(fe,4);{var te=S=>{var p=Fn(),_=a(p,!0);t(p),g(()=>f(_,e(l).purchasesList.length)),o(S,p)},C=S=>{var p=Ln();o(S,p)};d(ge,S=>{e(l)?.purchasesList&&e(l).purchasesList.length>0?S(te):S(C,!1)})}t(T),t(X),t(L);var N=s(L,2);Ct(N,{children:(S,p)=>{var _=Rn(),x=xe(_);{var z=ye=>{var ke=Bn(),c=a(ke);ua(c,{class:"h-4 w-4"});var u=s(c,2),y=a(u);t(u),t(ke),g(()=>f(y,`Erreur : ${e(l).error??""}`)),o(ye,ke)};d(x,ye=>{e(l)?.error&&ye(z)})}var M=s(x,2),Y=a(M);ps(Y,()=>e(l)?.currentTab,ye=>{var ke=Le(),c=xe(ke);{var u=E=>{Cn(E,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},y=E=>{var pe=Le(),Se=xe(pe);{var we=Pe=>{Wr(Pe,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Me=Pe=>{var Qe=Le(),Je=xe(Qe);{var rt=Ue=>{rn(Ue,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Fe=Ue=>{var et=Le(),tt=xe(et);{var ze=Oe=>{ln(Oe,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Ee=Oe=>{var Ge=Le(),Xe=xe(Ge);{var je=Ae=>{cn(Ae,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})};d(Xe,Ae=>{e(l)?.currentTab==="magasins"&&Ae(je)},!0)}o(Oe,Ge)};d(tt,Oe=>{e(l)?.currentTab==="volontaires"?Oe(ze):Oe(Ee,!1)},!0)}o(Ue,et)};d(Je,Ue=>{e(l)?.currentTab==="stock"?Ue(rt):Ue(Fe,!1)},!0)}o(Pe,Qe)};d(Se,Pe=>{e(l)?.currentTab==="achats"?Pe(we):Pe(Me,!1)},!0)}o(E,pe)};d(c,E=>{e(l)?.currentTab==="recettes"?E(u):E(y,!1)})}o(ye,ke)}),t(M),o(S,_)}});var he=s(N,2);fa(he,{children:(S,p)=>{var _=Gn(),x=xe(_);x.__click=V;var z=a(x,!0);t(x);var M=s(x,2);{var Y=ye=>{var ke=Un();ke.__click=K;var c=a(ke);{var u=E=>{var pe=Qn();o(E,pe)},y=E=>{var pe=Vn(),Se=xe(pe);pa(Se,{class:"h-4 w-4"}),Te(),o(E,pe)};d(c,E=>{e(l).loading?E(u):E(y,!1)})}t(ke),g(()=>ke.disabled=e(l).loading),o(ye,ke)};d(M,ye=>{e(l)?.hasAnyChanges&&ye(Y)})}g(()=>f(z,e(l)?.hasAnyChanges?"Annuler":"Fermer")),o(S,_)}}),g(()=>{Ce(H,1,`tab ${e(l)?.currentTab==="recettes"?"tab-active":""}`),Ce(J,1,`tab ${e(l)?.currentTab==="magasins"?"tab-active":""}`),Ce(ve,1,`tab ${e(l)?.currentTab==="volontaires"?"tab-active":""}`),Ce(re,1,`tab ${e(l)?.currentTab==="stock"?"tab-active":""}`),Ce(T,1,`tab ${e(l)?.currentTab==="achats"?"tab-active":""}`)}),o(G,ae)};d(q,G=>{e(D)?G(B):G(U,!1)})}o(ne,h)},$$slots:{default:!0}})}Re()}st(["click"]);var Jn=i("<button><span> </span> <!></button>"),Kn=i('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),Xn=i('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),Yn=i('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function Zn(oe,n){Be(n,!0);let r=Q(()=>n.dateStore.start),l=Q(()=>n.dateStore.end),v=qe(null);function D(h){e(r)&&new Date(h)<new Date(e(r))?n.dateStore.setRange(h,e(l)):e(l)&&new Date(h)>new Date(e(l))?n.dateStore.setRange(e(r),h):n.dateStore.setRange(h,h)}function m(h){return!e(r)||!e(l)?{start:null,end:null}:e(r)&&new Date(h)<new Date(e(r))?{start:h,end:e(l)}:e(l)&&new Date(h)>new Date(e(l))?{start:e(r),end:h}:{start:h,end:h}}function K(h){let q="";if(!e(r)||!e(l))return;const B=new Date(h)>=new Date(e(r))&&new Date(h)<=new Date(e(l)),U=new Date(h);U.setHours(U.getHours()+fs);const G=U<new Date;let ae=!1;if(e(v)){const w=m(e(v));w.start&&w.end&&(ae=new Date(h)>=new Date(w.start)&&new Date(h)<=new Date(w.end))}return G&&(q+=" opacity-70 italic"),B||(q+=" btn-dash"),ae&&!B&&(q+=" btn-soft"),q}var V=Yn(),F=xe(V);He(F,20,()=>n.dateStore.dates,h=>h,(h,q)=>{var B=Jn();B.__click=()=>D(q);var U=a(B),G=a(U,!0);t(U);var ae=s(U,2);{var w=b=>{Da(b,{size:16})},k=b=>{var L=Le(),X=xe(L);{var H=W=>{Aa(W,{size:16})},ue=W=>{var ce=Le(),le=xe(ce);{var J=de=>{Ta(de,{size:16})};d(le,de=>{Pt(q)==="cloud"&&de(J)},!0)}o(W,ce)};d(X,W=>{Pt(q)==="moon"?W(H):W(ue,!1)},!0)}o(b,L)};d(ae,b=>{Pt(q)==="sun"?b(w):b(k,!1)})}t(B),g((b,L)=>{Ce(B,1,`btn btn-sm btn-secondary ${b??""}`),f(G,L)},[()=>K(q),()=>ta(q)]),$e("mouseenter",B,()=>$(v,q,!0)),$e("mouseleave",B,()=>$(v,null)),o(h,B)}),t(F);var j=s(F,2);{var ne=h=>{var q=Kn();o(h,q)},I=h=>{var q=Xn(),B=a(q);B.__click=()=>n.dateStore.selectUpcoming();var U=s(B,2);U.__click=()=>n.dateStore.selectAll(),t(q),g(()=>{Ce(B,1,`join-item btn btn-sm ${n.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),Ce(U,1,`join-item btn btn-sm ${n.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),o(h,q)};d(j,h=>{n.dateStore.isEventPassed?h(ne):h(I,!1)})}o(oe,V),Re()}st(["click"]);var eo=i(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),to=i("<!> <!>",1),ao=i('<div class="alert alert-warning text-sm"><span>🔎 Les filtres sont désactivés pendant une recherche par nom.</span></div>'),so=i("<button><!> </button>"),ro=i('<button class="btn btn-sm btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),no=i('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),oo=i('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),io=i("<button> </button>"),lo=i('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),vo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),co=i("<button> </button>"),uo=i('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),mo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),po=i('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <!> <!> <div><div><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!></div></div>',1);function fo(oe,n){Be(n,!0);const r=Q(()=>A.filters),l=Q(()=>A.uniqueStores),v=Q(()=>A.uniqueWho),D=Q(()=>A.uniqueProductTypes),m=Q(()=>A.isSearchActive);var K=po(),V=xe(K),F=a(V),j=a(F);Za(j,{class:"h-5 w-5"}),Te(),t(F);var ne=s(F,2);ne.__click=()=>A.clearFilters();var I=a(ne);Tt(I,{class:"h-4 w-4"}),Te(),t(ne),t(V);var h=s(V,2),q=a(h),B=s(a(q),2),U=a(B);Es(U,{class:"h-4 w-4"});var G=s(U,2);vt(G),G.__input=T=>A.setSearchQuery(T.currentTarget.value);var ae=s(G,2);ae.__click=()=>A.setSearchQuery("");var w=a(ae);ua(w,{class:"h-4 w-4"}),t(ae),t(B),t(q);var k=s(q,2);{var b=T=>{ia(T,{legend:"Date incluses",bgClass:"bg-base-100",children:(fe,ge)=>{var te=to(),C=xe(te);Zn(C,{get dateStore(){return A.dateStore}});var N=s(C,2);{var he=S=>{var p=eo();yt(3,p,()=>wa),o(S,p)};d(N,S=>{A.hasPastDatesInRange&&S(he)})}o(fe,te)},$$slots:{default:!0}})};d(k,T=>{A.hasSingleDateEvent||T(b)})}var L=s(k,2);{var X=T=>{var fe=ao();yt(3,fe,()=>wa),o(T,fe)};d(L,T=>{e(m)&&T(X)})}var H=s(L,2);let ue;var W=a(H);let ce;var le=s(a(W),2),J=a(le);J.__click=()=>A.setCompletionStatus("all");var de=s(J,2);de.__click=()=>A.setCompletionStatus("incomplete");var _e=s(de,2);_e.__click=()=>A.setCompletionStatus("completed"),t(le),t(W);var me=s(W,2),ve=s(a(me),2),R=a(ve);R.__click=()=>A.setGroupBy("none");var se=s(R,2);se.__click=()=>A.setGroupBy("store");var Z=s(se,2);Z.__click=()=>A.setGroupBy("productType"),t(ve),t(me);var O=s(me,2);{var re=T=>{ia(T,{legend:"Types & Température",get iconComponent(){return Os},children:(fe,ge)=>{var te=oo(),C=xe(te);He(C,20,()=>e(D),y=>y,(y,E)=>{const pe=Q(()=>Ea(E));var Se=so();Se.__click=()=>A.toggleProductType(E);var we=a(Se);da(we,()=>e(pe).icon,(Pe,Qe)=>{Qe(Pe,{class:"mr-1 h-5 w-5"})});var Me=s(we);t(Se),g(Pe=>{Ce(Se,1,`btn btn-sm ${Pe??""}`),f(Me,` ${e(pe).displayName??""}`)},[()=>e(r).selectedProductTypes.length===0?"btn-soft btn-secondary":e(r).selectedProductTypes.includes(E)?"btn-secondary":"btn-dash btn-secondary"]),o(y,Se)}),t(C);var N=s(C,2),he=a(N);he.__click=()=>A.setTemperatureFilter("all");var S=s(he,2);S.__click=()=>A.setTemperatureFilter("frais");var p=a(S);xa(p,{class:"h-4 w-4"}),Te(),t(S);var _=s(S,2);_.__click=()=>A.setTemperatureFilter("not-frais");var x=a(_);xa(x,{class:"h-4 w-4"}),Te(2),t(_);var z=s(_,2);z.__click=()=>A.setTemperatureFilter("surgele");var M=a(z);ya(M,{class:"h-4 w-4"}),Te(),t(z);var Y=s(z,2);Y.__click=()=>A.setTemperatureFilter("not-surgele");var ye=a(Y);ya(ye,{class:"h-4 w-4"}),Te(2),t(Y),t(N);var ke=s(N,2);{var c=y=>{var E=ro();E.__click=()=>A.clearTypeAndTemperatureFilters();var pe=a(E);Tt(pe,{size:16}),t(E),o(y,E)},u=y=>{var E=no();o(y,E)};d(ke,y=>{e(r).selectedProductTypes.length>0||e(r).selectedTemperatures.length>0||e(r).temperatureFilter!=="all"?y(c):y(u,!1)})}g(()=>{Ce(he,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),Ce(S,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),Ce(_,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),Ce(z,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),Ce(Y,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),$e("mouseenter",he,()=>Ie.msg="Ne pas filter en fonction des températures"),$e("mouseleave",he,()=>Ie.reset()),$e("mouseenter",S,()=>Ie.msg="Afficher les produits frais uniquement"),$e("mouseleave",S,()=>Ie.reset()),$e("mouseenter",_,()=>Ie.msg="Exclure les produits frais"),$e("mouseleave",_,()=>Ie.reset()),$e("mouseenter",z,()=>Ie.msg="Afficher les produits surgelés uniquement"),$e("mouseleave",z,()=>Ie.reset()),$e("mouseenter",Y,()=>Ie.msg="Exclure les produits surgelé"),$e("mouseleave",Y,()=>Ie.reset()),o(fe,te)},$$slots:{default:!0}})};d(O,T=>{e(D).length>0&&T(re)})}var be=s(O,2);{var ee=T=>{ia(T,{legend:"Magasins",get iconComponent(){return ct},children:(fe,ge)=>{var te=vo(),C=a(te);He(C,16,()=>e(l),S=>S,(S,p)=>{var _=io();_.__click=()=>A.toggleStore(p);var x=a(_,!0);t(_),g(z=>{Ce(_,1,`btn btn-sm ${z??""}`),f(x,p)},[()=>e(r).selectedStores.length===0?"btn-soft btn-secondary":e(r).selectedStores.includes(p)?"btn-secondary":"btn-dash btn-secondary"]),o(S,_)});var N=s(C,2);{var he=S=>{var p=lo();p.__click=()=>A.clearStoreFilters();var _=a(p);Tt(_,{size:16}),t(p),o(S,p)};d(N,S=>{e(r).selectedStores.length>0&&S(he)})}t(te),o(fe,te)},$$slots:{default:!0}})};d(be,T=>{e(l).length>0&&T(ee)})}var ie=s(be,2);{var P=T=>{ia(T,{legend:"Qui",get iconComponent(){return aa},children:(fe,ge)=>{var te=mo(),C=a(te);He(C,16,()=>e(v),S=>S,(S,p)=>{var _=co();_.__click=()=>A.toggleWho(p);var x=a(_,!0);t(_),g(z=>{Ce(_,1,`btn btn-sm ${z??""}`),f(x,p)},[()=>e(r).selectedWho.length===0?" btn-soft btn-secondary":e(r).selectedWho.includes(p)?" btn-secondary":"btn-dash btn-secondary"]),o(S,_)});var N=s(C,2);{var he=S=>{var p=uo();p.__click=()=>A.clearWhoFilters();var _=a(p);Tt(_,{size:16}),t(p),o(S,p)};d(N,S=>{e(r).selectedWho.length>0&&S(he)})}t(te),o(fe,te)},$$slots:{default:!0}})};d(ie,T=>{e(v).length>0&&T(P)})}t(H),t(h),g(()=>{ne.disabled=!A.hasFilters,_s(G,e(r).searchQuery),ae.disabled=!e(r).searchQuery,ue=Ce(H,1,`space-y-4 ${e(m)?"pointer-events-none opacity-50":""}`,null,ue,{"transition-opacity":!0}),ce=Ce(W,1,"flex flex-col",null,ce,{"disabled-look":e(m)}),Ce(J,1,`btn flex-1 ${e(r).completionStatus==="all"&&"btn-primary"}`),Ce(de,1,`btn flex-1 ${e(r).completionStatus==="incomplete"&&"btn-warning"}`),Ce(_e,1,`btn flex-1 ${e(r).completionStatus==="completed"&&"btn-success"}`),Ce(R,1,`btn flex-1 ${e(r).groupBy==="none"&&"btn-secondary"}`),Ce(se,1,`btn flex-1 ${e(r).groupBy==="store"&&"btn-secondary"}`),Ce(Z,1,`btn flex-1 ${e(r).groupBy==="productType"&&"btn-secondary"}`)}),o(oe,K),Re()}st(["click","input"]);var _o=i('<div class="tooltip text-xs font-normal"><!></div>');function go(oe,n){let r=De(n,"iconSize",3,24),l=n.icon||void 0;var v=_o(),D=a(v);{var m=K=>{l(K,{get size(){return r()},class:`align-top
`})};d(D,K=>{n.icon&&K(m)})}t(v),g(()=>Mt(v,"data-tip",n.tip)),o(oe,v)}var bo=i('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function Qa(oe,n){Be(n,!0);let r=De(n,"recipes",19,()=>[]);const l=n.dateDisplayInfo.timeIcon==="sun"?Da:n.dateDisplayInfo.timeIcon==="moon"?Aa:n.dateDisplayInfo.timeIcon==="cloud"?Ta:null;var v=bo(),D=a(v),m=a(D),K=a(m,!0);t(m);var V=s(m,2);{var F=j=>{l(j,{class:"h-3 w-3 stroke-3"})};d(V,j=>{l&&j(F)})}t(D),t(v),g(j=>{Mt(v,"data-tip",j),f(K,n.dateDisplayInfo.formattedDate)},[()=>r().map(j=>j.r).join(", ")]),o(oe,v),Re()}var ho=Ha("<title> </title>"),xo=Ha("<svg><!><use></use></svg>");function yo(oe,n){let r=De(n,"size",3,24),l=De(n,"class",3,""),v=Ua(n,["$$slots","$$events","$$legacy","name","size","title","class"]);var D=xo();Va(D,()=>({width:r(),height:r(),class:l(),"aria-hidden":n.title?void 0:"true",...v}));var m=a(D);{var K=F=>{var j=ho(),ne=a(j,!0);t(j),g(()=>f(ne,n.title)),o(F,j)};d(m,F=>{n.title&&F(K)})}var V=s(m);t(D),g(()=>Mt(V,"href",`/icons/sprite.svg#${n.name??""}`)),o(oe,D)}var wo=i('<div class="text-base-content/60 text-sm font-normal"> </div>'),ko=i('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),So=i('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),Po=i('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),Mo=i('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),qo=i('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),Co=i('<div class="ml-1"><!></div>'),Do=i('<div class="ml-1"> </div> <!>',1),Ao=i('<div class="ml-1 text-sm font-medium">?</div>'),To=i('<span class="text-base-content/50 text-xs"> </span>'),Io=i('<div class="ml-1 flex gap-1"> <!></div>'),Eo=i('<div class="ml-1 text-sm font-medium">?</div>'),Oo=i('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),$o=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),zo=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),jo=i('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),No=i('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),Fo=i('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),Lo=i("<span> </span>"),Bo=i('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),Ro=i('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),Qo=i(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle des
                besoins: <!> <!></span></div>`),Vo=i('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Uo=i('<span class="text-xs opacity-75"><!></span>'),Go=i('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Wo=i('<div class="text-base-content/50 text-xs italic">aucun</div>'),Ho=i('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-75 flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 group hover:ring-accent/60 relative flex flex-1 cursor-pointer flex-wrap items-center justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm hover:ring-2"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>');function Jo(oe,n){Be(n,!0);const r={Package:Pa,MessageCircleQuestionMark:ht,ShoppingCart:ht,Clock:as,CircleCheck:Ns,CircleX:js,ClipboardCheck:zs,PackageCheck:ts,Check:pa},l=Q(()=>n.productModel.data),v=Q(()=>n.productModel.stats),D=Q(()=>Ea(e(l).productType)),m=Q(()=>Qs(e(l).purchases||[])),K=Q(()=>e(l).totalNeededOverrideParsed),V=Q(()=>Wa(e(l)));var F=Ho(),j=a(F),ne=a(j),I=a(ne);I.__click=()=>n.onOpenModal(e(l).$id,"recettes"),I.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var h=a(I),q=a(h);da(q,()=>e(D).icon,(c,u)=>{u(c,{class:"h-4 w-4"})});var B=s(q),U=s(B);{var G=c=>{var u=wo(),y=a(u);t(u),g(()=>f(y,`Ancien: ${e(l).previousNames[0]??""}`)),o(c,u)};d(U,c=>{e(l).previousNames&&e(l).previousNames.length>0&&c(G)})}var ae=s(U,2);{var w=c=>{var u=ko(),y=a(u);La(y,{class:"text-warning h-4 w-4"}),t(u),o(c,u)};d(ae,c=>{e(l).productHugoUuid||c(w)})}t(h);var k=s(h,2),b=a(k);{var L=c=>{var u=So(),y=a(u);xa(y,{class:"text-success h-4 w-4"}),t(u),o(c,u)};d(b,c=>{e(l).pF&&c(L)})}var X=s(b,2);{var H=c=>{var u=Po(),y=a(u);ya(y,{class:"text-info h-4 w-4"}),t(u),o(c,u)};d(X,c=>{e(l).pS&&c(H)})}t(k);var ue=s(k,2);{var W=c=>{var u=Mo(),y=a(u);es(y,{class:"h-4 w-4 animate-spin"}),t(u),o(c,u)};d(ue,c=>{e(l).status==="isSyncing"&&c(W)})}var ce=s(ue,2);{var le=c=>{var u=qo(),y=a(u);He(y,20,()=>e(v).concernedDates,E=>E,(E,pe)=>{const Se=Q(()=>e(v).recipesByDate.get(pe)||[]),we=Q(()=>n.productModel.data.dateDisplayInfo[pe]||Fa(pe));Qa(E,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(y),t(u),o(c,u)};d(ce,c=>{!We.isMobile&&e(v).concernedDates.length>0&&c(le)})}t(I);var J=s(I,2);{var de=c=>{var u=Oo(),y=a(u);y.__click=()=>n.onOpenModal(e(l).$id,"magasins"),y.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"magasins");var E=a(y);ct(E,{size:18});var pe=s(E,2);{var Se=Fe=>{var Ue=Do(),et=xe(Ue),tt=a(et,!0);t(et);var ze=s(et,2);{var Ee=Oe=>{var Ge=Co(),Xe=a(Ge);go(Xe,{get tip(){return e(l).storeInfo.storeComment},get icon(){return Fs},iconSize:14}),t(Ge),o(Oe,Ge)};d(ze,Oe=>{e(l).storeInfo?.storeComment&&Oe(Ee)})}g(()=>f(tt,e(l).storeInfo.storeName)),o(Fe,Ue)},we=Fe=>{var Ue=Ao();o(Fe,Ue)};d(pe,Fe=>{e(l).storeInfo?.storeName?Fe(Se):Fe(we,!1)})}t(y);var Me=s(y,2);Me.__click=()=>n.onOpenModal(e(l).$id,"volontaires"),Me.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"volontaires");var Pe=a(Me);Nt(Pe,{size:18});var Qe=s(Pe,2);{var Je=Fe=>{var Ue=Le(),et=xe(Ue);{var tt=Ee=>{var Oe=Io(),Ge=a(Oe),Xe=s(Ge);{var je=Ae=>{var Ve=To(),ot=a(Ve);t(Ve),g(()=>f(ot,`+${e(l).who.length-2}`)),o(Ae,Ve)};d(Xe,Ae=>{e(l).who.length>2&&Ae(je)})}t(Oe),g(Ae=>f(Ge,`${Ae??""}... `),[()=>e(l).who.slice(0,2).map(Ae=>Ae.slice(0,5)).join(" | ")]),o(Ee,Oe)},ze=Ee=>{var Oe=Le(),Ge=xe(Oe);{var Xe=je=>{var Ae=at();g(()=>f(Ae,e(l).who)),o(je,Ae)};d(Ge,je=>{e(l).who.length===1&&je(Xe)},!0)}o(Ee,Oe)};d(et,Ee=>{e(l).who.length>1?Ee(tt):Ee(ze,!1)})}o(Fe,Ue)},rt=Fe=>{var Ue=Eo();o(Fe,Ue)};d(Qe,Fe=>{e(l).who&&e(l).who.length?Fe(Je):Fe(rt,!1)})}t(Me),t(u),g(()=>{Ce(y,1,`btn btn-soft btn-xs sm:btn-sm group relative ${e(l).storeInfo?.storeName?"btn-success":""}`),Ce(Me,1,`btn btn-xs sm:btn-sm btn-soft group relative ${e(l).who&&e(l).who?.length>0?"btn-success":""}`)}),$e("mouseenter",y,()=>Ie.msg="Définissez le magasin où acheter le produit"),$e("mouseleave",y,()=>Ie.reset()),$e("mouseenter",Me,()=>Ie.msg="Déclarez qui est responsable de l'achat de ce produit"),$e("mouseleave",Me,()=>Ie.reset()),o(c,u)},_e=c=>{var u=jo(),y=a(u);{var E=we=>{var Me=$o(),Pe=a(Me);ct(Pe,{size:16});var Qe=s(Pe);t(Me),g(()=>f(Qe,` ${e(l).storeInfo.storeName??""}`)),o(we,Me)};d(y,we=>{e(l).storeInfo?.storeName&&we(E)})}var pe=s(y,2);{var Se=we=>{var Me=zo(),Pe=a(Me);Nt(Pe,{size:16});var Qe=s(Pe);t(Me),g(Je=>f(Qe,` ${Je??""}`),[()=>e(l).who.join(", ")]),o(we,Me)};d(pe,we=>{e(l).who&&e(l).who.length>0&&we(Se)})}t(u),o(c,u)};d(J,c=>{n.shouldShowActionButtons?c(de):c(_e,!1)})}t(ne);var me=s(ne,2);{var ve=c=>{var u=No(),y=a(u);He(y,20,()=>e(v).concernedDates,E=>E,(E,pe)=>{const Se=Q(()=>e(v).recipesByDate.get(pe)||[]),we=Q(()=>n.productModel.data.dateDisplayInfo[pe]||Fa(pe));Qa(E,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(y),t(u),o(c,u)};d(me,c=>{We.isMobile&&e(v).concernedDates.length>0&&c(ve)})}var R=s(me,2),se=a(R),Z=s(a(se),2);Z.__click=()=>n.onOpenModal(e(l).$id,"recettes"),Z.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var O=a(Z),re=a(O),be=a(re);{var ee=c=>{var u=Fo(),y=a(u),E=a(y,!0);t(y);var pe=s(y,2);La(pe,{class:"h-4 w-4"});var Se=s(pe);t(u),g(()=>{f(E,e(v).formattedQuantities),f(Se,` ${e(K).totalOverride.q??""}
                  ${e(K).totalOverride.u??""}`)}),o(c,u)},ie=c=>{var u=Lo(),y=a(u,!0);t(u),g(()=>f(y,e(v).formattedQuantities)),o(c,u)};d(be,c=>{e(K)?.totalOverride?c(ee):c(ie,!1)})}t(re);var P=s(re,2);{var T=c=>{var u=Bo(),y=a(u),E=a(y),pe=s(E);ma(pe,{class:"h-3 w-3"}),t(y);var Se=s(y,2),we=a(Se),Me=s(we);qa(Me,{class:"h-3 w-3"}),t(Se),t(u),g(()=>{f(E,`${e(v).nbRecipes??""} `),f(we,`${e(v).totalAssiettes??""} `)}),o(c,u)};d(P,c=>{(e(v).nbRecipes||e(v).totalAssiettes)&&c(T)})}t(O);var fe=s(O,2);{var ge=c=>{var u=Ro();u.__click=we=>{we.stopPropagation(),n.onQuickValidation(e(l),e(v))};var y=a(u),E=s(a(y));t(y);var pe=s(y,2),Se=a(pe);yo(Se,{name:"add-to-cart",size:16}),t(pe),t(u),g(()=>f(E,` ${e(v).formattedMissingQuantities??""}`)),$e("mouseenter",u,()=>Ie.msg="Ajouter aux achats effectués"),$e("mouseleave",u,()=>Ie.reset()),o(c,u)},te=c=>{var u=Le(),y=xe(u);{var E=pe=>{ss(pe,{size:24,class:"text-success ms-auto"})};d(y,pe=>{n.shouldShowActionButtons&&pe(E)},!0)}o(c,u)};d(fe,c=>{n.shouldShowActionButtons&&e(v).hasMissing?c(ge):c(te,!1)})}var C=s(fe,2);{var N=c=>{var u=Qo(),y=a(u);Ca(y,{size:18});var E=s(y,2),pe=s(a(E));{var Se=Pe=>{var Qe=at();g(()=>f(Qe,`${e(V).details?.oldPlates??""}→${e(V).details?.newPlates??""} couverts`)),o(Pe,Qe)};d(pe,Pe=>{e(V).platesChanged&&Pe(Se)})}var we=s(pe,2);{var Me=Pe=>{var Qe=at();g(()=>f(Qe,`${e(V).details?.oldRecipes??""}→${e(V).details?.newRecipes??""}
                  recettes`)),o(Pe,Qe)};d(we,Pe=>{e(V).recipesChanged&&Pe(Me)})}t(E),t(u),o(c,u)};d(C,c=>{n.shouldShowActionButtons&&e(V)?.hasMismatch&&c(N)})}t(Z),t(se);var he=s(se,2),S=s(a(he),2);S.__click=()=>n.onOpenModal(e(l).$id,"achats"),S.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"achats");var p=a(S);ht(p,{class:"h-4 w-4 opacity-60"});var _=s(p,2),x=s(_,2),z=a(x);{var M=c=>{var u=Vo(),y=a(u),E=a(y);$s(E,{class:"text-secondary h-4 w-4"});var pe=s(E,2),Se=a(pe);t(pe),t(y);var we=s(y,2),Me=a(we);t(we),t(u),g(Pe=>{f(Se,`${e(l).stockParsed.quantity??""}
                    ${e(l).stockParsed.unit??""}`),f(Me,`stock: ${Pe??""}`)},[()=>ta(e(l).stockParsed.dateTime)]),o(c,u)};d(z,c=>{e(l).stockParsed&&c(M)})}var Y=s(z,2);He(Y,17,()=>e(m),xt,(c,u)=>{const y=Q(()=>r[e(u).icon]);var E=Go(),pe=a(E),Se=a(pe);da(Se,()=>e(y),(Je,rt)=>{rt(Je,{class:"h-4 w-4"})});var we=s(Se,2),Me=a(we);t(we),t(pe);var Pe=s(pe,2);{var Qe=Je=>{var rt=Uo(),Fe=a(rt);{var Ue=tt=>{var ze=at();g(()=>f(ze,`livré le: ${e(u).deliveryDate??""}`)),o(tt,ze)},et=tt=>{var ze=at("livraison ?");o(tt,ze)};d(Fe,tt=>{e(u).deliveryDate?tt(Ue):tt(et,!1)})}t(rt),o(Je,rt)};d(Pe,Je=>{e(u).status==="ordered"&&Je(Qe)})}t(E),g(()=>{Ce(E,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${e(u).badgeClass??""}`),f(Me,`${e(u).quantity??""}
                    ${e(u).unit??""}`)}),o(c,E)});var ye=s(Y,2);{var ke=c=>{var u=Wo();o(c,u)};d(ye,c=>{e(m).length===0&&!e(l)?.stockParsed&&c(ke)})}t(x),t(S),t(he),t(R),t(j),t(F),g(()=>{Ce(F,1,`card bg-base-100 ${(We.isMobile&&"border-base-300 border shadow")??""} ${e(l).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),f(B,`${e(l).productName??""} `),Ce(re,1,`text-base font-bold ${e(v).hasMissing&&n.shouldShowActionButtons?"text-error":"text-success"}`),Ce(_,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${n.shouldShowActionButtons?"group-hover:block":"hidden"} sm:hidden`)}),$e("mouseenter",I,()=>Ie.msg="Afficher les informations sur ce produit"),$e("mouseleave",I,()=>Ie.reset()),$e("mouseenter",Z,()=>Ie.msg="Afficher les informations sur ce produit"),$e("mouseleave",Z,()=>Ie.reset()),$e("mouseenter",S,()=>Ie.msg="Déclarez des achats effectués"),$e("mouseleave",S,()=>Ie.reset()),yt(3,F,()=>Ia),o(oe,F),Re()}st(["click","keydown"]);var Ko=i('<div class="text-primary-content flex items-center gap-2"><!> </div>'),Xo=i('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),Yo=i('<div class="font-semibold">Sur toute la période</div>'),Zo=i('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),ei=i('le <span class="font-semibold"> </span>',1),ti=i('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),ai=i('<span class="font-semibold"> </span>'),si=i('le <span class="font-semibold"> </span>',1),ri=i('<div class="text-primary-content"><!></div>'),ni=i(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),oi=i('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),ii=i('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),li=i('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),di=i('<div><!> <div class="mt-4 mb-8 space-y-4 sm:space-y-2"></div></div>'),vi=i('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),ci=i('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),ui=i('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),mi=i('<span class="block text-[9pt] font-normal opacity-60"> </span>'),pi=i('<div class="font-medium"> </div>'),fi=i('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),_i=i('<div class="font-medium"> </div>'),gi=i('<div class="text-[9pt] opacity-70"> </div>'),bi=i('<div class="flex gap-6"><!> <!></div>'),hi=i('<span class="text-xs opacity-70"> </span>'),xi=i('<div class="text-nowrap"> </div>'),yi=i('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),wi=i('<div class="text-nowrap"> </div>'),ki=i('<div class="flex flex-col items-end gap-0.5"></div>'),Si=i('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),Pi=i('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),Mi=i("<span>Aucune recette pour le moment</span>"),qi=i("<span>Aucun produit trouvé avec les filtres actuels</span>"),Ci=i('<div class="py-8 text-center"><div class="alert alert-info max-md:alert-vertical"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Di=i('<div><!> <div class="hidden w-full print:block"></div></div> <!>',1);function Ai(oe,n){Be(n,!0);let r=De(n,"disabled",3,!1);const l=Q(()=>A.groupedFilteredProducts),v=A.filters,D=_t(A.dateStore.start),m=_t(A.dateStore.end),K=Q(()=>!A.dateStore.isEventPassed&&!A.dateStore.hasPastDatesInRange),V=Q(()=>v.completionStatus==="completed"?"bg-emerald-800":v.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");let F=Ze([]),j=qe(Ze(new Map));mt(()=>{const G=Object.keys(e(l));F.forEach((ae,w)=>{if(!ae)return;const k=G[w];k&&gs(()=>ae,b=>{const L=b[0];if(!L)return;const X=L.intersectionRatio>=.05;$(j,new Map(e(j)).set(k,X),!0)},{threshold:[0,.05,1]})})});var ne=Di(),I=xe(ne),h=a(I);He(h,19,()=>Object.entries(e(l)),([G,ae])=>G,(G,ae,w)=>{var k=Q(()=>va(e(ae),2));let b=()=>e(k)[0];const X=Q(()=>e(k)[1]);var H=di(),ue=a(H);{var W=le=>{const J=Q(()=>Ea(b())),de=Q(()=>e(j).get(b())??!0);var _e=li(),me=a(_e),ve=a(me);{var R=P=>{var T=Ko(),fe=a(T);ct(fe,{class:"size-4 md:size-5"});var ge=s(fe);t(T),g(()=>f(ge,` ${b()??""} (${e(X).length??""})`)),o(P,T)},se=P=>{var T=Le(),fe=xe(T);{var ge=C=>{var N=Xo(),he=a(N);da(he,()=>e(J).icon,(z,M)=>{M(z,{class:"size-4 md:size-5"})});var S=s(he,2),p=a(S,!0);t(S);var _=s(S,2),x=a(_);t(_),t(N),g(()=>{f(p,e(J).displayName),f(x,`(${e(X).length??""})`)}),o(C,N)},te=C=>{var N=at();g(()=>f(N,`📦 ${b()??""} (${e(X).length??""})`)),o(C,N)};d(fe,C=>{v.groupBy==="productType"?C(ge):C(te,!1)},!0)}o(P,T)};d(ve,P=>{v.groupBy==="store"?P(R):P(se,!1)})}t(me);var Z=s(me,2);{var O=P=>{var T=ti(),fe=a(T);{var ge=C=>{var N=Yo();o(C,N)},te=C=>{var N=Le(),he=xe(N);{var S=_=>{var x=Zo(),z=s(xe(x)),M=a(z,!0);t(z);var Y=s(z,2),ye=a(Y,!0);t(Y),g((ke,c)=>{f(M,ke),f(ye,c)},[()=>St(A.dateStore.start),()=>St(A.dateStore.end)]),o(_,x)},p=_=>{var x=ei(),z=s(xe(x)),M=a(z,!0);t(z),g(Y=>f(M,Y),[()=>St(A.dateStore.start)]),o(_,x)};d(he,_=>{A.dateStore.start!==A.dateStore.end?_(S):_(p,!1)},!0)}o(C,N)};d(fe,C=>{A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?C(ge):C(te,!1)})}t(T),o(P,T)},re=P=>{var T=ri(),fe=a(T);{var ge=C=>{var N=ai(),he=a(N);t(N),g((S,p)=>f(he,`${S??""} → ${p??""}`),[()=>St(A.dateStore.start),()=>St(A.dateStore.end)]),o(C,N)},te=C=>{var N=si(),he=s(xe(N)),S=a(he,!0);t(he),g(p=>f(S,p),[()=>St(A.dateStore.start,!0)]),o(C,N)};d(fe,C=>{!A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?C(ge):C(te,!1)})}t(T),o(P,T)};d(Z,P=>{We.isMobile?P(re,!1):P(O)})}var be=s(Z,2);{var ee=P=>{var T=oi(),fe=a(T);fe.__click=()=>n.onOpenGroupEditModal("store",e(X).map(_=>_.data.$id),e(X).map(_=>_.data));var ge=a(fe);ct(ge,{size:16});var te=s(ge,4);gt(te,{size:16}),t(fe);var C=s(fe,2);C.__click=()=>n.onOpenGroupEditModal("who",e(X).map(_=>_.data.$id),e(X).map(_=>_.data));var N=a(C);Nt(N,{size:16});var he=s(N,4);gt(he,{size:16}),t(C);var S=s(C,2);{var p=_=>{var x=ni();x.__click=()=>n.onOpenGroupPurchaseModal(e(X).map(Y=>Y.data));var z=a(x);ht(z,{size:16});var M=s(z,4);ss(M,{size:16}),t(x),$e("mouseenter",x,()=>Ie.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),$e("mouseleave",x,()=>Ie.reset()),o(_,x)};d(S,_=>{e(X).some(x=>x.data.displayMissingQuantity!=="✅ Complet")&&_(p)})}t(T),$e("mouseenter",fe,()=>Ie.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),$e("mouseleave",fe,()=>Ie.reset()),$e("mouseenter",C,()=>Ie.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),$e("mouseleave",C,()=>Ie.reset()),o(P,T)},ie=P=>{var T=Le(),fe=xe(T);{var ge=te=>{var C=ii(),N=a(C),he=a(N);as(he,{size:16}),Te(2),t(N),t(C),o(te,C)};d(fe,te=>{A.dateStore.hasPastDatesInRange&&te(ge)},!0)}o(P,T)};d(be,P=>{e(K)?P(ee):P(ie,!1)})}t(_e),g(()=>Ce(_e,1,`${e(V)??""} @container sticky ${We.isMobile?We.headerVisible?"top-12":"top-0":"top-13 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md transition-all duration-300 @md:flex-nowrap print:shadow-none ${e(de)?"opacity-100":"pointer-events-none opacity-0"}`)),o(le,_e)};d(ue,le=>{b()!==""&&le(W)})}var ce=s(ue,2);He(ce,21,()=>e(X),le=>le.data.$id,(le,J)=>{Jo(le,{get productModel(){return e(J)},get shouldShowActionButtons(){return e(K)},get onOpenModal(){return n.onOpenModal},get onQuickValidation(){return n.onQuickValidation}})}),t(ce),t(H),bs(H,(le,J)=>F[J]=le,le=>F?.[le],()=>[e(w)]),yt(3,ce,()=>Ia),o(G,H)});var q=s(h,2);He(q,21,()=>Object.entries(e(l)),([G,ae])=>G,(G,ae)=>{var w=Q(()=>va(e(ae),2));let k=()=>e(w)[0],b=()=>e(w)[1];var L=Pi(),X=a(L);{var H=me=>{var ve=vi(),R=a(ve),se=a(R),Z=s(se),O=a(Z);t(Z);var re=s(Z,2),be=a(re);{var ee=P=>{var T=at("Toute la période");o(P,T)},ie=P=>{var T=Le(),fe=xe(T);{var ge=C=>{var N=at();g(()=>f(N,`du ${D??""} au ${m??""}`)),o(C,N)},te=C=>{var N=at();g(()=>f(N,`le ${D??""}`)),o(C,N)};d(fe,C=>{A.dateStore.start!==A.dateStore.end?C(ge):C(te,!1)},!0)}o(P,T)};d(be,P=>{A.dateStore.isFullRange?P(ee):P(ie,!1)})}t(re),t(R),t(ve),g(()=>{f(se,`${(k()==="Non défini"?"Groupe inconnu":k())??""} `),f(O,`(${b().length??""} produits)`)}),o(me,ve)};d(X,me=>{k()!==""&&me(H)})}var ue=s(X,2),W=a(ue),ce=a(W),le=s(a(ce),3);{var J=me=>{var ve=ci();o(me,ve)},de=me=>{var ve=ui();o(me,ve)};d(le,me=>{v.groupBy==="store"?me(J):me(de,!1)})}Te(),t(ce),t(W);var _e=s(W);He(_e,21,b,me=>me.data.$id,(me,ve)=>{const R=Q(()=>e(ve).data),se=Q(()=>e(ve).stats);var Z=Si(),O=s(a(Z)),re=a(O),be=s(re);{var ee=x=>{var z=mi(),M=a(z);t(z),g(()=>f(M,`(Ancien: ${e(R).previousNames[0]??""})`)),o(x,z)};d(be,x=>{e(R).previousNames&&e(R).previousNames.length>0&&x(ee)})}t(O);var ie=s(O),P=a(ie);{var T=x=>{var z=at();g(()=>f(z,`${e(R).totalNeededOverrideParsed.totalOverride.q??""}
                    ${e(R).totalNeededOverrideParsed.totalOverride.u??""}`)),o(x,z)},fe=x=>{var z=at();g(()=>f(z,e(se).formattedQuantities)),o(x,z)};d(P,x=>{e(R).totalNeededOverrideParsed?.totalOverride?x(T):x(fe,!1)})}t(ie);var ge=s(ie),te=a(ge);{var C=x=>{var z=fi(),M=a(z);{var Y=c=>{var u=pi(),y=a(u,!0);t(u),g(E=>f(y,E),[()=>e(R).who.join(", ")]),o(c,u)};d(M,c=>{e(R).who?.length&&c(Y)})}var ye=s(M,2),ke=a(ye,!0);t(ye),t(z),g(()=>f(ke,e(R).productType||"Autre")),o(x,z)},N=x=>{var z=bi(),M=a(z);{var Y=c=>{var u=_i(),y=a(u,!0);t(u),g(()=>f(y,e(R).storeInfo.storeName)),o(c,u)};d(M,c=>{e(R).storeInfo?.storeName&&c(Y)})}var ye=s(M,2);{var ke=c=>{var u=gi(),y=a(u,!0);t(u),g(E=>f(y,E),[()=>e(R).who.join(", ")]),o(c,u)};d(ye,c=>{e(R).who?.length&&c(ke)})}t(z),o(x,z)};d(te,x=>{v.groupBy==="store"?x(C):x(N,!1)})}t(ge);var he=s(ge),S=a(he);{var p=x=>{var z=yi(),M=a(z),Y=a(M),ye=s(Y);{var ke=y=>{var E=hi(),pe=a(E);t(E),g(Se=>f(pe,`(${Se??""})`),[()=>ta(e(R).stockParsed.dateTime)]),o(y,E)};d(ye,y=>{e(R).stockParsed?.dateTime&&y(ke)})}t(M);var c=s(M,2);{var u=y=>{var E=Le(),pe=xe(E);He(pe,17,()=>e(R).purchases,xt,(Se,we)=>{var Me=xi(),Pe=a(Me);t(Me),g(()=>f(Pe,`${e(we).quantity??""} ${e(we).unit??""}`)),o(Se,Me)}),o(y,E)};d(c,y=>{e(R).purchases?.length&&y(u)})}t(z),g(()=>f(Y,`📦 ${e(R).stockParsed.quantity??""} `)),o(x,z)},_=x=>{var z=Le(),M=xe(z);{var Y=ye=>{var ke=ki();He(ke,21,()=>e(R).purchases,xt,(c,u)=>{var y=wi(),E=a(y);t(y),g(()=>f(E,`${e(u).quantity??""} ${e(u).unit??""}`)),o(c,y)}),t(ke),o(ye,ke)};d(M,ye=>{e(R).purchases?.length&&ye(Y)},!0)}o(x,z)};d(S,x=>{e(R).stockParsed?x(p):x(_,!1)})}t(he),t(Z),g(()=>f(re,`${e(R).productName??""} `)),o(me,Z)}),t(_e),t(ue),t(L),o(G,L)}),t(q),t(I);var B=s(I,2);{var U=G=>{var ae=Ci(),w=a(ae),k=s(a(w),2);{var b=X=>{var H=Mi();o(X,H)},L=X=>{var H=qi();o(X,H)};d(k,X=>{n.currentEvent&&n.currentEvent.meals&&n.currentEvent.meals.length>0&&n.currentEvent.meals.every(H=>!H.recipes||H.recipes.length===0)?X(b):X(L,!1)})}t(w),t(ae),o(G,ae)};d(B,G=>{Object.values(e(l)).flat().length===0&&G(U)})}g(()=>Ce(I,1,`space-y-4 rounded-lg print:hidden ${r()?"pointer-events-none opacity-60":""}`)),o(oe,ne),Re()}st(["click"]);var Ti=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Ii=i('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),Ei=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Oi=i("<!> ",1),$i=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),zi=i("<!> <!> <!>",1);function ji(oe,n){Be(n,!0);let r=qe(!1),l=qe(null),v=qe(null),D=qe(Ze(n.products.length>0&&n.products[0].storeInfo?n.products[0].storeInfo.storeName:"")),m=qe(Ze(n.products.length>0&&n.products[0].storeInfo&&n.products[0].storeInfo.storeComment||"")),K=qe(Ze({})),V=qe("empty");mt(()=>{const U={};n.products.forEach(G=>{n.productIds.includes(G.$id)&&(e(V)==="empty"?U[G.$id]=!G.storeInfo||!G.storeInfo.storeName:U[G.$id]=!0)}),$(K,U,!0)});const F=Q(()=>n.products.map(U=>({id:U.$id,label:U.productName,title:U.productName,selected:e(K)[U.$id]}))),j=Q(()=>e(F).filter(U=>U.selected)),ne=Q(()=>`Attribuer un magasin (${e(j).length} produits sélectionnés)`),I=Q(()=>e(j).length===0?!1:e(D).trim().length>0);async function h(){if(!e(I)||e(r))return;$(l,null),$(v,null);const U=e(j).map(w=>w.id),G=n.products.filter(w=>U.includes(w.$id));A.setSyncStatus(U,!0),We.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${U.length} produits)`,progress:0},n.onClose();const ae={storeName:e(D).trim(),storeComment:e(m).trim()};try{const w=await $t.track(A.batchUpdateProducts(U,G,"store",ae).then(k=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${k.success?"succès":"échec"}, ${k.updatedCount} produits modifiés`),!k.success)throw new Error(k.error||"Erreur lors de la mise à jour");return k}),{loading:`Mise à jour du magasin pour ${U.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});n.onSuccess?.(w)}catch(w){console.error("[StoreEditModal] Erreur mise à jour:",w),A.clearSyncStatus()}finally{$(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function q(){e(r)||n.onClose()}function B(U){e(K)[U]=!e(K)[U]}qt(oe,{isOpen:!0,onClose:q,children:(U,G)=>{var ae=zi(),w=xe(ae);wt(w,{get title(){return e(ne)},onClose:q,children:(L,X)=>{ct(L,{class:"text-secondary"})},$$slots:{default:!0}});var k=s(w,2);Ct(k,{children:(L,X)=>{var H=Ii(),ue=a(H);{var W=O=>{var re=Ti(),be=a(re);ca(be,{class:"h-4 w-4"});var ee=s(be,2),ie=a(ee,!0);t(ee),t(re),g(()=>f(ie,e(l))),o(O,re)};d(ue,O=>{e(l)&&O(W)})}var ce=s(ue,2),le=a(ce),J=a(le);Dt(J,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},id:"store-name-input",get value(){return e(D)},set value(O){$(D,O,!0)}}),t(le);var de=s(le,2),_e=a(de);At(_e,{get disabled(){return e(r)},id:"store-comment-textarea",get value(){return e(m)},set value(O){$(m,O,!0)}}),t(de),t(ce);var me=s(ce,2),ve=s(a(me),2),R=a(ve);R.__click=()=>$(V,"empty");var se=s(R,2);se.__click=()=>$(V,"all"),t(ve);var Z=s(ve,2);zt(Z,{get items(){return e(F)},onToggleItem:B,size:"sm",color:"success"}),t(me),t(H),g(()=>{Ce(R,1,`tab ${e(V)==="empty"?"tab-active":""}`),Ce(se,1,`tab ${e(V)==="all"?"tab-active":""}`)}),o(L,H)}});var b=s(k,2);fa(b,{children:(L,X)=>{var H=$i(),ue=xe(H);ue.__click=q;var W=s(ue,2);W.__click=h;var ce=a(W);{var le=de=>{var _e=Ei();Te(),o(de,_e)},J=de=>{var _e=Oi(),me=xe(_e);pa(me,{class:"h-4 w-4"});var ve=s(me);g(()=>f(ve,` Appliquer à ${e(j).length??""} produit(s)`)),o(de,_e)};d(ce,de=>{e(r)?de(le):de(J,!1)})}t(W),g(()=>{ue.disabled=e(r),W.disabled=e(r)||!e(I)}),o(L,H)}}),o(U,ae)},$$slots:{default:!0}}),Re()}st(["click"]);var Ni=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Fi=i(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),Li=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Bi=i("<!> ",1),Ri=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Qi=i("<!> <!> <!>",1);function Vi(oe,n){Be(n,!0);let r=qe(!1),l=qe(null),v=qe(Ze([])),D=qe(""),m=qe("empty"),K=qe(Ze({}));mt(()=>{const w={};n.products.forEach(k=>{n.productIds.includes(k.$id)&&(e(m)==="empty"?w[k.$id]=!k.who||k.who.length===0:w[k.$id]=!0)}),$(K,w,!0)});const V=Q(()=>n.products.map(w=>({id:w.$id,label:w.productName,title:w.productName,selected:e(K)[w.$id]}))),F=Q(()=>e(V).filter(w=>w.selected)),j=Q(()=>{const w=new Set([...A.uniqueWho,...e(v)]);return Array.from(w).map(k=>({id:k,label:k,selected:e(v).includes(k)}))}),ne=Q(()=>`Gérer les volontaires (${e(F).length} produit${e(F).length>1?"s":""})`),I=Q(()=>e(F).length===0?!1:e(v).length>0);async function h(){if(!e(I)||e(r))return;$(l,null);const w=e(F).map(b=>b.id),k=n.products.filter(b=>w.includes(b.$id));A.setSyncStatus(w,!0),We.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${w.length} produits)`,progress:0},n.onClose();try{await $t.track(A.batchUpdateProducts(w,k,"who",{names:e(v)}).then(b=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${b.success?"succès":"échec"}, ${b.updatedCount} produits modifiés`),!b.success)throw new Error(b.error||"Erreur lors de la mise à jour");return A.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),n.onSuccess?.(b),b}),{loading:`Mise à jour des mandatés pour ${w.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(b){console.error("[WhoEditModal] Erreur mise à jour:",b),A.clearSyncStatus()}finally{$(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function q(w){const k=w.trim();k&&!e(v).includes(k)&&$(v,[...e(v),k],!0)}function B(w){$(v,e(v).filter(k=>k!==w),!0)}function U(w){e(v).includes(w)?B(w):q(w)}function G(){e(D).trim()&&(q(e(D)),$(D,""))}function ae(w){e(K)[w]=!e(K)[w]}qt(oe,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(w,k)=>{var b=Qi(),L=xe(b);wt(L,{get title(){return e(ne)},showBackButton:!0,get onClose(){return n.onClose}});var X=s(L,2);Ct(X,{children:(ue,W)=>{var ce=Fi(),le=a(ce);{var J=ge=>{var te=Ni(),C=a(te);ca(C,{class:"h-4 w-4"});var N=s(C,2),he=a(N,!0);t(N),t(te),g(()=>f(he,e(l))),o(ge,te)};d(le,ge=>{e(l)&&ge(J)})}var de=s(le,2),_e=s(a(de),2),me=a(_e),ve=a(me);sa(ve,{get disabled(){return e(r)},onkeydown:ge=>{ge.key==="Enter"&&(ge.preventDefault(),G())},get value(){return e(D)},set value(ge){$(D,ge,!0)}}),t(me);var R=s(me,2);R.__click=G;var se=a(R);Ya(se,{size:16}),t(R),t(_e);var Z=s(_e,2),O=a(Z),re=s(O,2);zt(re,{get items(){return e(j)},onToggleItem:U,size:"lg",color:"info"}),t(Z),t(de);var be=s(de,2),ee=a(be),ie=s(a(ee),2),P=a(ie);P.__click=()=>$(m,"empty");var T=s(P,2);T.__click=()=>$(m,"all"),t(ie),t(ee);var fe=s(ee,2);zt(fe,{get items(){return e(V)},onToggleItem:ae,size:"sm",color:"success"}),t(be),t(ce),g(ge=>{R.disabled=ge,Ce(O,1,`text-base-content/70 mb-2 hidden text-sm ${(e(j).length&&"inline")??""}`),Ce(P,1,`btn btn-sm ${e(m)==="empty"&&"btn-secondary"}`),Ce(T,1,`btn btn-sm ${e(m)==="all"&&"btn-secondary"}`)},[()=>e(r)||!e(D).trim()]),o(ue,ce)}});var H=s(X,2);fa(H,{children:(ue,W)=>{var ce=Ri(),le=xe(ce);le.__click=function(...ve){n.onClose?.apply(this,ve)};var J=s(le,2);J.__click=h;var de=a(J);{var _e=ve=>{var R=Li();Te(),o(ve,R)},me=ve=>{var R=Bi(),se=xe(R);pa(se,{class:"h-4 w-4"});var Z=s(se);g(()=>f(Z,` Appliquer à ${e(F).length??""} produit${e(F).length>1?"s":""}`)),o(ve,R)};d(de,ve=>{e(r)?ve(_e):ve(me,!1)})}t(J),g(()=>{le.disabled=e(r),J.disabled=e(r)||!e(I)}),o(ue,ce)}}),o(w,b)},$$slots:{default:!0}}),Re()}st(["click"]);var Ui=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Gi=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Wi=i('<button class="btn btn-primary btn-sm"><!> Ajouter une dépense</button>'),Hi=i('<span class="loading loading-spinner loading-xs"></span>'),Ji=i('<div class="text-error mt-2 text-xs"> </div>'),Ki=i('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),Xi=i('<span class="text-base-content/70 italic"> </span>'),Yi=i('<span class="text-base-content/50 ml-1 text-xs"> </span>'),Zi=i('<span class="font-medium"> </span> <!>',1),el=i('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),tl=i('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),al=i('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),sl=i('<div class="text-sm italic opacity-70"> </div>'),rl=i('<div class="text-xs opacity-60"> </div>'),nl=i('<div class="text-sm font-medium"> </div> <!>',1),ol=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),il=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),ll=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),dl=i('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),vl=i('<div class="space-y-3"><!> <!></div>'),cl=i('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),ul=i("<!> <!>",1);function ml(oe,n){Be(n,!0);let r=De(n,"isOpen",15,!1),l=qe(!1),v=qe(null),D=qe(!1),m=qe(Ze({invoiceTotal:0,store:"",notes:"",who:""})),K=qe(null);mt(()=>{if(r()&&!e(K)){const k=localStorage.getItem("appwrite-user-name");k&&(e(m).who=k)}});let V=qe("date"),F=qe("desc"),j=Q(()=>A.financialStats),ne=Q(()=>e(j).allPurchases),I=Q(()=>{let k=[...e(ne)];return k.sort((b,L)=>{let X,H;switch(e(V)){case"date":X=new Date(b.orderDate||b.$createdAt).getTime(),H=new Date(L.orderDate||L.$createdAt).getTime();break;case"amount":X=b.invoiceTotal||b.price||0,H=L.invoiceTotal||L.price||0;break;case"store":X=(b.store||"").toLowerCase(),H=(L.store||"").toLowerCase();break;case"who":X=(b.who||"").toLowerCase(),H=(L.who||"").toLowerCase();break}return X<H?e(F)==="asc"?-1:1:X>H?e(F)==="asc"?1:-1:0}),k});function h(k){e(V)===k?$(F,e(F)==="asc"?"desc":"asc",!0):($(V,k,!0),$(F,"desc"))}async function q(){if(!e(m).invoiceTotal||e(m).invoiceTotal<=0){$(v,"Le montant doit être supérieur à 0");return}$(l,!0),$(v,null);try{const k=A.currentMainId;if(!k)throw new Error("Aucun événement principal actif");e(K)?await hs(e(K),{price:e(m).invoiceTotal,invoiceTotal:e(m).invoiceTotal,store:e(m).store,notes:e(m).notes,who:e(m).who}):await xs(k,void 0,e(m).invoiceTotal,e(m).store,e(m).notes,e(m).who),B()}catch(k){console.error("Erreur sauvegarde dépense:",k),$(v,k.message,!0)}finally{$(l,!1)}}function B(){const k=localStorage.getItem("appwrite-user-name")||"";$(m,{invoiceTotal:0,store:"",notes:"",who:k},!0),$(K,null),$(D,!1)}function U(k){$(m,{invoiceTotal:k.invoiceTotal||k.price||0,store:k.store||"",notes:k.notes||"",who:k.who||""},!0),$(K,k.$id,!0),$(D,!0)}function G(){r(!1),B(),$(v,null)}function ae(k){return k?new Date(k).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function w(k){return(k||0).toFixed(2)+" €"}qt(oe,{get isOpen(){return r()},onClose:G,maxWidth:"lg",children:(k,b)=>{var L=ul(),X=xe(L);wt(X,{title:"Gestion des Dépenses",onClose:G});var H=s(X,2);Ct(H,{children:(ue,W)=>{var ce=cl(),le=a(ce),J=a(le),de=a(J),_e=s(a(de),2),me=a(_e,!0);t(_e);var ve=s(_e,2),R=a(ve);t(ve),t(de),t(J);var se=s(J,2),Z=s(a(se),2);He(Z,21,()=>Object.entries(e(j).byStore).sort((C,N)=>N[1]-C[1]),xt,(C,N)=>{var he=Q(()=>va(e(N),2));let S=()=>e(he)[0],p=()=>e(he)[1];var _=Ui(),x=a(_),z=a(x,!0);t(x);var M=s(x,2),Y=a(M,!0);t(M),t(_),g(ye=>{f(z,S()),f(Y,ye)},[()=>w(p())]),o(C,_)}),t(Z),t(se);var O=s(se,2),re=s(a(O),2);He(re,21,()=>Object.entries(e(j).byWho).sort((C,N)=>N[1]-C[1]),xt,(C,N)=>{var he=Q(()=>va(e(N),2));let S=()=>e(he)[0],p=()=>e(he)[1];var _=Gi(),x=a(_),z=a(x,!0);t(x);var M=s(x,2),Y=a(M,!0);t(M),t(_),g(ye=>{f(z,S()),f(Y,ye)},[()=>w(p())]),o(C,_)}),t(re),t(O),t(le);var be=s(le,2),ee=s(a(be),2);{var ie=C=>{var N=Wi();N.__click=()=>$(D,!0);var he=a(N);Ot(he,{class:"mr-1 h-4 w-4"}),Te(),t(N),o(C,N)};d(ee,C=>{e(D)||C(ie)})}t(be);var P=s(be,2);{var T=C=>{var N=Ki(),he=a(N),S=a(he),p=a(S,!0);t(S);var _=s(S,2),x=a(_);Oa(x,{get disabled(){return e(l)},get value(){return e(m).invoiceTotal},set value(we){e(m).invoiceTotal=we}});var z=s(x,2);Dt(z,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(m).store},set value(we){e(m).store=we}});var M=s(z,2);sa(M,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(m).who},set value(we){e(m).who=we}});var Y=s(M,2);At(Y,{get disabled(){return e(l)},get value(){return e(m).notes},set value(we){e(m).notes=we}}),t(_);var ye=s(_,2),ke=a(ye);ke.__click=B;var c=s(ke,2);c.__click=q;var u=a(c);{var y=we=>{var Me=Hi();o(we,Me)};d(u,we=>{e(l)&&we(y)})}var E=s(u);t(c),t(ye);var pe=s(ye,2);{var Se=we=>{var Me=Ji(),Pe=a(Me,!0);t(Me),g(()=>f(Pe,e(v))),o(we,Me)};d(pe,we=>{e(v)&&we(Se)})}t(he),t(N),g(()=>{f(p,e(K)?"Modifier la dépense":"Nouvelle Dépense"),c.disabled=e(l),f(E,` ${e(K)?"Enregistrer":"Ajouter"}`)}),o(C,N)};d(P,C=>{e(D)&&C(T)})}var fe=s(P,2);{var ge=C=>{var N=al(),he=a(N),S=a(he),p=a(S),_=a(p);_.__click=()=>h("date");var x=a(_);t(_);var z=s(_,2);z.__click=()=>h("store");var M=a(z);t(z);var Y=s(z);Y.__click=()=>h("who");var ye=a(Y);t(Y);var ke=s(Y);ke.__click=()=>h("amount");var c=a(ke);t(ke);var u=s(ke),y=a(u);Ls(y,{size:14}),t(u),t(p),t(S);var E=s(S),pe=a(E);He(pe,17,()=>e(I),Me=>Me.$id,(Me,Pe)=>{var Qe=el(),Je=a(Qe),rt=a(Je,!0);t(Je);var Fe=s(Je),Ue=a(Fe);{var et=Ke=>{var Ye=Xi(),it=a(Ye,!0);t(Ye),g(()=>f(it,e(Pe).notes||"-")),o(Ke,Ye)},tt=Ke=>{var Ye=Zi(),it=xe(Ye),pt=a(it,!0);t(it);var ft=s(it,2);{var bt=lt=>{var dt=Yi(),kt=a(dt);t(dt),g(()=>f(kt,`- ${e(Pe).notes??""}`)),o(lt,dt)};d(ft,lt=>{e(Pe).notes&&lt(bt)})}g(()=>f(pt,e(Pe)._productName||"Produit inconnu")),o(Ke,Ye)};d(Ue,Ke=>{e(Pe).status==="expense"?Ke(et):Ke(tt,!1)})}t(Fe);var ze=s(Fe),Ee=a(ze,!0);t(ze);var Oe=s(ze),Ge=a(Oe,!0);t(Oe);var Xe=s(Oe),je=a(Xe,!0);t(Xe);var Ae=s(Xe),Ve=a(Ae);Ve.__click=()=>U(e(Pe));var ot=a(Ve);gt(ot,{size:14}),t(Ve),t(Ae),t(Qe),g((Ke,Ye)=>{f(rt,Ke),f(Ee,e(Pe).store||"-"),f(Ge,e(Pe).who||"-"),f(je,Ye)},[()=>ae(e(Pe).orderDate||e(Pe).$createdAt),()=>w(e(Pe).invoiceTotal||e(Pe).price)]),o(Me,Qe)});var Se=s(pe);{var we=Me=>{var Pe=tl();o(Me,Pe)};d(Se,Me=>{e(I).length===0&&Me(we)})}t(E),t(he),t(N),g(()=>{f(x,`Date ${e(V)==="date"?e(F)==="asc"?"↑":"↓":""}`),f(M,`Magasin ${e(V)==="store"?e(F)==="asc"?"↑":"↓":""}`),f(ye,`Qui ${e(V)==="who"?e(F)==="asc"?"↑":"↓":""}`),f(c,`Montant ${e(V)==="amount"?e(F)==="asc"?"↑":"↓":""}`)}),o(C,N)},te=C=>{var N=vl(),he=a(N);He(he,17,()=>e(I),_=>_.$id,(_,x)=>{var z=ll(),M=a(z),Y=a(M),ye=a(Y),ke=a(ye),c=a(ke);jt(c,{class:"h-3.5 w-3.5"});var u=s(c,2),y=a(u,!0);t(u),t(ke);var E=s(ke,2),pe=a(E,!0);t(E),t(ye);var Se=s(ye,2);Se.__click=()=>U(e(x));var we=a(Se);gt(we,{size:16}),t(Se),t(Y);var Me=s(Y,2),Pe=a(Me);{var Qe=ze=>{var Ee=sl(),Oe=a(Ee,!0);t(Ee),g(()=>f(Oe,e(x).notes)),o(ze,Ee)},Je=ze=>{var Ee=nl(),Oe=xe(Ee),Ge=a(Oe,!0);t(Oe);var Xe=s(Oe,2);{var je=Ae=>{var Ve=rl(),ot=a(Ve,!0);t(Ve),g(()=>f(ot,e(x).notes)),o(Ae,Ve)};d(Xe,Ae=>{e(x).notes&&Ae(je)})}g(()=>f(Ge,e(x)._productName||"Produit inconnu")),o(ze,Ee)};d(Pe,ze=>{e(x).status==="expense"&&e(x).notes?ze(Qe):ze(Je,!1)})}t(Me);var rt=s(Me,2),Fe=a(rt);{var Ue=ze=>{var Ee=ol(),Oe=a(Ee);ct(Oe,{class:"h-3 w-3"});var Ge=s(Oe,2),Xe=a(Ge,!0);t(Ge),t(Ee),g(()=>f(Xe,e(x).store)),o(ze,Ee)};d(Fe,ze=>{e(x).store&&ze(Ue)})}var et=s(Fe,2);{var tt=ze=>{var Ee=il(),Oe=a(Ee);aa(Oe,{class:"h-3 w-3"});var Ge=s(Oe,2),Xe=a(Ge,!0);t(Ge),t(Ee),g(()=>f(Xe,e(x).who)),o(ze,Ee)};d(et,ze=>{e(x).who&&ze(tt)})}t(rt),t(M),t(z),g((ze,Ee)=>{f(y,ze),f(pe,Ee)},[()=>ta(e(x).orderDate||e(x).$createdAt),()=>w(e(x).invoiceTotal||e(x).price)]),o(_,z)});var S=s(he,2);{var p=_=>{var x=dl(),z=a(x);rs(z,{class:"mx-auto mb-3 h-12 w-12"}),Te(2),t(x),o(_,x)};d(S,_=>{e(I).length===0&&_(p)})}t(N),o(C,N)};d(fe,C=>{We.isMobile?C(te,!1):C(ge)})}t(ce),g(C=>{f(me,C),f(R,`${e(ne).length??""} transactions`)},[()=>w(e(j).totalGlobal)]),o(ue,ce)}}),o(k,L)},$$slots:{default:!0}}),Re()}st(["click"]);var pl=i('<div class="fixed right-24 bottom-6 z-50 print:hidden"><div class="alert alert-soft bg-secondary/90 text-secondary-content flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg backdrop-blur-sm"><span class="max-w-32 truncate text-xs font-medium"> </span> <button class="btn btn-xs btn-circle btn-ghost" title="Effacer tous les filtres"><!></button></div></div>');function fl(oe,n){Be(n,!0);const r=Q(()=>A.activeFiltersDescription),l=Q(()=>e(r).length>0),v=Q(()=>e(r).length>2?`${e(r).slice(0,2).join(", ")}...`:e(r).join(", "));var D=Le(),m=xe(D);{var K=V=>{var F=pl(),j=a(F),ne=a(j),I=a(ne,!0);t(ne);var h=s(ne,2);h.__click=()=>A.clearFilters();var q=a(h);Tt(q,{class:"size-4"}),t(h),t(j),t(F),g(()=>f(I,e(v))),yt(3,F,()=>Bs,()=>({duration:200,start:.8})),o(V,F)};d(m,V=>{e(l)&&V(K)})}o(oe,D),Re()}st(["click"]);var _l=i('<div class="flex gap-2"><button class="btn btn-primary btn-sm" title="Ajouter un produit manuellement"><!> Produit</button></div>'),gl=i('<div class="flex min-h-96 items-center justify-center"><div class="flex flex-col items-center gap-4"><!> <p class="text-base-content/60 text-sm">Chargement des produits...</p></div></div>'),bl=i("<!> ",1),hl=i("<!> ",1),xl=i('<div class="grow py-4 print:hidden"><!></div>'),yl=i(`<div class="alert alert-warning alert-soft max-sm:alert-vertical self-center" id="info-past-event"><!> Toutes les dates de cet événement sont passées. Il n'est plus possible
            de modifier les produits.</div>`),wl=i('<div class="card card-xs sm:card-sm border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div> <div class="card-action mt-auto"><button class="btn btn-primary btn-soft w-full" title="Ajouter un produit manuellement"><!> Produit</button></div></div></div>'),kl=i("grace au bouton en bas à gauche <!>",1),Sl=i(`<p>Cette page liste l'ensemble des produits présent dans les recettes de
        l'événement. La liste est <span class="font-semibold">mise à jour dès que les menus sont modifiés</span> (recettes ajoutées, supprimées, nombre de couvert modifié, etc.) Vous pouvez
        :</p> <ul class="svelte-1mshqfh"><li class="svelte-1mshqfh">Ajouter des produits non présent dans les recettes grace au bouton <kbd class="kbd kbd-sm">+ Produit</kbd> en haut à gauche</li> <li class="svelte-1mshqfh">Filtrer les produits par type, température, date, manquant etc. <!></li> <li class="svelte-1mshqfh">Déclarer des achats soit en cliquant dans la zone d'achat d'un
          produit, soit via le bouton <kbd class="kbd kbd-sm">manque ...</kbd> dans
          la colonne des besoins (déclare acheté la quantité manquante). Les achats
          peuvent être déclarés comme des 'commandes', et vous pouvez préciser la
          date de réception</li> <li class="svelte-1mshqfh">Déclarer tout un groupe de produit acheté via le bouton <kbd class="kbd kbd-sm">Achat groupé</kbd> dans l'entête de chaque groupe</li> <li class="svelte-1mshqfh">Définir des magasins ou vous mandater pour l'achat de produit
          (individuel ou par groupe) → <!> <!></li> <li class="svelte-1mshqfh">Modifier la quantité réclamée pour un produit. Si les recettes et
          menus sont modifié entre temps, la carte des besoin du produit
          indiquera que les quantités calculé ont changé depuis la modification
          manuelle des besoins déclarés pour ce produit. <p>Cela peut aussi servir a <span class="font-semibold">remplacer un produit par un autre</span> sans modifier les recettes</p></li> <li class="svelte-1mshqfh">Déclarer des dépenses indépendamment des achats (possible y compris
          après que l'événement soit fini)</li> <li class="svelte-1mshqfh">Visualiser l'ensemble des dépenses effectué, et par qui, en cliquant
          sur <kbd class="kbd">Dépenses</kbd> dans l'entête</li></ul> <p>Tous les membres des équipes ou individus invité à participer à
        l'événement peuvent modifier les produits, ajouter des achats, dépenses,
        etc.</p>`,1),Pl=i('<!> <div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><h1> </h1> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-center gap-10 md:justify-end"><!> <!> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow"><div class="card-body"><div class="card-title text-orange-800"><!> Dépenses</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <div class="card-action mt-auto"><button class="btn btn-soft btn-primary" title="Ajouter une dépense générale"><!> Voir, ajouter</button></div></div></div></div></div> <!> <!>',1),Ml=i('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),ql=i('<div class="flex items-center justify-center"><!></div>'),Cl=i('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),Dl=i("<!> <!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function Vl(oe,n){Be(n,!0);const r=p=>{var _=_l(),x=a(_);x.__click=le;var z=a(x);Ot(z,{class:"mr-1 h-4 w-4"}),Te(),t(x),t(_),g(()=>x.disabled=!e(_e)),o(p,_)},l="100";let v=qe(null),D=qe("recettes"),m=qe(!1),K=qe(!1),V=qe(Ze([])),F=qe(Ze([])),j=qe(!1),ne=qe(Ze([])),I=qe(!1),h=qe(!0),q=Q(()=>Ps.params.id);const B=Q(()=>e(q)?ra.getEventById(e(q)):null),U=Q(()=>e(B)?.name??""),G=Q(()=>e(B)?.dateStart??null),ae=Q(()=>e(B)?.dateEnd??null),w=Q(()=>e(ae)&&new Date>new Date(e(ae)));ys(async()=>{try{if(!e(q)){console.error("[EventProductsPage] eventId est requis"),$(h,!1);return}if(await ws(),!await ks(e(q))){console.error(`[EventProductsPage] Événement ${e(q)} introuvable`),$(h,!1);return}const _=ra.getEventById(e(q));console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${_?.name}`),await A.initialize(e(q))}catch(p){console.error("[EventProductsPage] Erreur lors de l'initialisation:",p)}finally{$(h,!1)}});function k(p,_="recettes"){$(D,_,!0),$(v,p,!0)}function b(){$(v,null)}function L(p,_,x){$(V,_,!0),$(F,x,!0),p==="who"?$(m,!0):$(K,!0)}function X(p){(!p||p==="who")&&$(m,!1),(!p||p==="store")&&$(K,!1),$(V,[],!0),$(F,[],!0)}function H(p){console.log(`[ProductsTable] Modification groupée réussie: ${p.updatedCount} produits`)}function ue(p){const _=p.filter(x=>A.getProductModelById(x.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${p.length} produits reçus → ${_.length} produits avec quantités manquantes`),$(ne,_,!0),$(j,!0)}function W(){$(j,!1),$(ne,[],!0)}function ce(){console.log("[ProductsTable] Achat groupé créé avec succès"),W()}function le(){$(I,!0)}async function J(p,_){try{const x=_.missingQuantities||[];if(x.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const z=x.filter(M=>M.q<0).map(M=>({...M,q:Math.abs(M.q)})).map(M=>{const Y=Et.normalize(M.q,M.u);return{q:Y.quantity,u:Y.unit}});await A.createPurchase(p.$id,z,{store:p.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${p.productName}`)}catch(x){console.error("[ProductsTable] Erreur validation rapide:",x),alert("Erreur lors de la validation rapide: "+x.message)}}let de=qe(!1);const _e=Q(()=>ra.canUserEditEvent(e(q)||"",We.userId||""));async function me(p){if(!(!e(q)||!We.userId))try{$(h,!0);const _=p?"accepted":"declined";await ra.updateContributorStatus(e(q),We.userId,_),$t.success(p?"Invitation acceptée":"Invitation déclinée")}catch(_){console.error("Erreur réponse invitation:",_),$t.error("Erreur lors de la réponse")}finally{$(h,!1)}}mt(()=>{Ra.setConfig({actions:r})}),Ss(()=>{Ra.reset()});var ve=Dl(),R=xe(ve);Gs(R,{width:l,children:(p,_)=>{fo(p,{})},$$slots:{default:!0}});var se=s(R,2);fl(se,{});var Z=s(se,2),O=a(Z);{var re=p=>{var _=gl(),x=a(_),z=a(x);es(z,{class:"text-primary h-12 w-12 animate-spin"}),Te(2),t(x),t(_),o(p,_)},be=p=>{var _=Pl(),x=xe(_);Us(x,{get currentEvent(){return e(B)},get isBusy(){return e(h)},onRespond:me});var z=s(x,2),M=a(z),Y=a(M),ye=a(Y,!0);t(Y);var ke=s(Y,2),c=a(ke);{var u=je=>{var Ae=bl(),Ve=xe(Ae);jt(Ve,{class:"inline h-4 w-4"});var ot=s(Ve);g((Ke,Ye)=>f(ot,` ${Ke??""} au ${Ye??""}`),[()=>ha(e(G)),()=>ha(e(ae))]),o(je,Ae)},y=je=>{var Ae=Le(),Ve=xe(Ae);{var ot=Ke=>{var Ye=hl(),it=xe(Ye);jt(it,{class:"inline h-4 w-4"});var pt=s(it);g(ft=>f(pt,` ${ft??""}`),[()=>ha(e(G))]),o(Ke,Ye)};d(Ve,Ke=>{e(G)&&Ke(ot)},!0)}o(je,Ae)};d(c,je=>{e(G)&&e(ae)?je(u):je(y,!1)})}t(ke),t(M);var E=s(M,2);{var pe=je=>{var Ae=xl(),Ve=a(Ae);Vs(Ve,{get currentEvent(){return e(B)}}),t(Ae),o(je,Ae)};d(E,je=>{e(B)&&je(pe)})}var Se=s(E,2),we=a(Se);{var Me=je=>{var Ae=yl(),Ve=a(Ae);Ca(Ve,{size:20,class:"shrink-0"}),Te(),t(Ae),o(je,Ae)};d(we,je=>{e(w)&&je(Me)})}var Pe=s(we,2);{var Qe=je=>{var Ae=wl(),Ve=a(Ae),ot=a(Ve),Ke=a(ot);ts(Ke,{class:"text-orange-800 opacity-60"}),Te(),t(ot);var Ye=s(ot,2),it=a(Ye),pt=a(it),ft=a(pt,!0);t(pt),Te(2),t(it),t(Ye);var bt=s(Ye,2),lt=a(bt);lt.__click=le;var dt=a(lt);Ot(dt,{class:"mr-1 h-4 w-4"}),Te(),t(lt),t(bt),t(Ve),t(Ae),g(()=>{f(ft,A.completionStats.missing),lt.disabled=!e(_e)}),$e("mouseenter",lt,()=>Ie.msg="Ajouter un produit manuellement"),$e("mouseleave",lt,()=>Ie.reset()),o(je,Ae)};d(Pe,je=>{e(w)||je(Qe)})}var Je=s(Pe,2),rt=a(Je),Fe=a(rt),Ue=a(Fe);rs(Ue,{class:"text-orange-800 opacity-60"}),Te(),t(Fe);var et=s(Fe,2),tt=a(et);t(et);var ze=s(et,2),Ee=a(ze);Ee.__click=()=>$(de,!0);var Oe=a(Ee);Ot(Oe,{class:"size-4"}),Te(),t(Ee),t(ze),t(rt),t(Je),t(Se),t(z);var Ge=s(z,2);Sa(Ge,{title:"Aide",contentVisible:"Page de gestion des produits nécéssaire pour l'événement. Cliquer pour découvrir ce que vous pouvez y faire...",class:"shadow-info shadow",children:(je,Ae)=>{var Ve=Sl(),ot=s(xe(Ve),2),Ke=s(a(ot),2),Ye=s(a(Ke));{var it=dt=>{var kt=kl(),os=s(xe(kt));Za(os,{size:14}),o(dt,kt)},pt=dt=>{var kt=at("grace au menu de droite");o(dt,kt)};d(Ye,dt=>{We.isMobile?dt(it):dt(pt,!1)})}t(Ke);var ft=s(Ke,6),bt=s(a(ft));ct(bt,{size:14,class:"text-primary inline"});var lt=s(bt,2);Nt(lt,{size:14,class:"text-primary inline"}),t(ft),Te(6),t(ot),Te(2),o(je,Ve)},$$slots:{default:!0}});var Xe=s(Ge,2);{let je=Q(()=>!e(_e));Ai(Xe,{get currentEvent(){return e(B)},onOpenModal:k,onOpenGroupEditModal:L,onOpenGroupPurchaseModal:ue,onQuickValidation:J,get disabled(){return e(je)}})}g(()=>{f(ye,e(U)),f(tt,`${A.financialStats.totalGlobal??""} €`),Ee.disabled=!e(_e)}),$e("mouseenter",Ee,()=>Ie.msg="Consulter ou modifie le détail des dépenses"),$e("mouseleave",Ee,()=>Ie.reset()),o(p,_)};d(O,p=>{e(h)?p(re):p(be,!1)})}var ee=s(O,2);{let p=Q(()=>e(v)||"");Hn(ee,{get productId(){return e(p)},get initialTab(){return e(D)},onClose:b})}var ie=s(ee,2);{var P=p=>{Vi(p,{get productIds(){return e(V)},get products(){return e(F)},onClose:()=>X("who"),onSuccess:H})};d(ie,p=>{e(m)&&p(P)})}var T=s(ie,2);{var fe=p=>{ji(p,{get productIds(){return e(V)},get products(){return e(F)},onClose:()=>X("store"),onSuccess:H})};d(T,p=>{e(K)&&p(fe)})}var ge=s(T,2);{var te=p=>{lr(p,{get products(){return e(ne)},onClose:W,onSuccess:ce})};d(ge,p=>{e(j)&&p(te)})}var C=s(ge,2);br(C,{get open(){return e(I)},set open(p){$(I,p,!0)}});var N=s(C,2);ml(N,{get isOpen(){return e(de)},set isOpen(p){$(de,p,!0)}});var he=s(N,2);{var S=p=>{var _=Cl(),x=a(_),z=a(x);{var M=ye=>{var ke=Ml(),c=a(ke);Ba(c,{class:"me-2 size-5"});var u=s(c),y=s(u);y.__click=()=>Ie.collapse();var E=a(y);ua(E,{class:"h-4 w-4"}),t(y),t(ke),g(()=>f(u,` ${Ie.msg??""} `)),o(ye,ke)},Y=ye=>{var ke=ql();ke.__click=()=>Ie.expand();var c=a(ke);Ba(c,{class:"size-6"}),t(ke),o(ye,ke)};d(z,ye=>{Ie.isExpanded?ye(M):ye(Y,!1)})}t(x),t(_),g(()=>Ce(x,1,`rounded-tr-box bg-blue-100 text-blue-800 ${Ie.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),o(p,_)};d(he,p=>{We.isDesktop&&p(S)})}t(Z),g(()=>Ce(Z,1,`space-y-6 pt-6 md:px-16 ${(We.isDesktop&&"ml-110 print:ml-0")??""} `)),yt(3,Z,()=>Ia),o(oe,ve),Re()}st(["click"]);export{Vl as default};
