var ls=Object.defineProperty;var $a=ne=>{throw TypeError(ne)};var ds=(ne,n,r)=>n in ne?ls(ne,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):ne[n]=r;var ha=(ne,n,r)=>ds(ne,typeof n!="symbol"?n+"":n,r),vs=(ne,n,r)=>n.has(ne)||$a("Cannot "+r);var ze=(ne,n,r)=>(vs(ne,n,"read from private field"),r?r.call(ne):n.get(ne)),rt=(ne,n,r)=>n.has(ne)?$a("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(ne):n.set(ne,r);import{au as vt,i as ea,av as Va,Q as ca,aw as xt,ax as Sa,K as cs,ay as Pa,P as Tt,b as us,az as ht,aA as ms,t as Ot,aB as Ua,X as ua,T as ps,aC as Ga,a2 as Wa,a as ma,D as Ma,n as qa,aj as fs,aD as _s,ar as Ca,as as Da,s as Aa,U as $t,z as pa,w as Ha,F as At,S as bs,aE as ya,O as wa,I as gs,aF as za,e as Ja,aG as hs,aH as Ka,aI as xs,C as ys,h as ws,ak as Xa,aJ as Ya,aK as ks,aL as Ss,aM as Za,a1 as ja}from"./icons.js";import{d as Re,p as Ae,v as i,g as a,h as s,a as es,r as ts,I as d,w as b,C as Ce,R as ut,b as o,c as Qe,m as e,u as Q,o as t,B as at,U as dt,L as fa,aq as Ps,al as as,z as Ye,y as qe,H as ft,A as $,k as xe,a7 as A,x as f,G as Ge,M as zt,K as Ie,e as We,i as yt,Q as Oe,am as Na,aH as Ms,aI as qs,aJ as It,ap as Et,aK as la,S as tt,j as Ne,aL as Fa,aM as Cs,aN as ss,aO as La,O as Pt,aP as St,ax as Ds,aQ as As,an as Ts,a6 as da,aR as Ee,f as rs,aS as Ba,aT as Is,P as Es,t as va,aU as Os,aV as $s,Z as zs,$ as js,aC as Ns,aD as Fs,W as ra}from"./appwrite.js";import{b as gt,g as ta,a as Ls,D as kt}from"./date-helpers.js";import{B as jt}from"./BtnGroupCheck.js";import{S as Ta,I as Ia}from"./InfoCollapse.js";import{M as Mt,a as wt,b as qt,c as _a,s as ka,f as ns,e as Bs,n as Ra}from"./index.js";import{a as Rs,b as na,c as oa,g as Ea,d as Qs,f as xa}from"./products-display.js";import{F as ia}from"./Fieldset.js";import{E as Vs}from"./EventStats.js";import{E as Us}from"./EventInvitationAlert.js";import{L as Gs}from"./LeftPanel.js";import"./CheckboxBadge.js";import"./event-stats-helpers.js";var Ws=i('<div><label class="input w-72"><!> <input/></label> <!></div>');function Ct(ne,n){Re(n,!0);let r=Ae(n,"value",15),l=Ae(n,"suggestions",19,()=>[]),c=Ae(n,"disabled",3,!1),D=Ae(n,"flexCol",3,!1),p=ts(n,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const K=Q(()=>l().map(M=>({id:M,label:M,disabled:M===r()})));var V=Ws(),N=a(V),z=a(N);vt(z,{class:"h-4 w-4 opacity-50"});var oe=s(z,2);es(oe,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:c(),...p}),void 0,void 0,void 0,void 0,!0),t(N);var I=s(N,2);{var h=M=>{Ta(M,{get suggestions(){return e(K)},onSuggestionClick:L=>r(L.label),buttonSize:"btn-xs"})};d(I,M=>{l().length>0&&M(h)})}t(V),b(()=>Ce(V,1,`flex ${D()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),ut(oe,r),o(ne,V),Qe()}var Hs=i('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function aa(ne,n){Re(n,!0);let r=Ae(n,"value",15),l=Ae(n,"suggestions",19,()=>[]),c=Ae(n,"disabled",3,!1),D=Ae(n,"flexCol",3,!1);const p=Q(()=>l().map(h=>({id:h,label:h,disabled:h===r()})));var K=Hs(),V=a(K),N=a(V);ea(N,{class:"h-4 w-4 opacity-50"});var z=s(N,2);dt(z),z.__keydown=function(...h){n.onkeydown?.apply(this,h)},t(V);var oe=s(V,2);{var I=h=>{Ta(h,{get suggestions(){return e(p)},onSuggestionClick:M=>r(M.label),buttonSize:"btn-xs"})};d(oe,h=>{l().length>0&&h(I)})}t(K),b(()=>{Ce(K,1,`flex ${D()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),z.disabled=c()}),ut(z,r),o(ne,K),Qe()}at(["keydown"]);var Js=i('<textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea>');function Dt(ne,n){Re(n,!0);let r=Ae(n,"value",15),l=Ae(n,"disabled",3,!1);var c=Js();Ps(c),b(()=>{c.disabled=l(),fa(c,"id",n.id)}),ut(c,r),o(ne,c),Qe()}var Ks=i('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function Oa(ne,n){Re(n,!0);let r=Ae(n,"value",15),l=Ae(n,"disabled",3,!1);var c=Ks(),D=a(c);Va(D,{class:"h-4 w-4 opacity-50"});var p=s(D,2);dt(p),t(c),b(()=>p.disabled=l()),ut(p,r),o(ne,c),Qe()}var Xs=i('<label class="input w-fit"><span class="label">Date de livraison</span> <input type="date"/></label>'),Ys=i(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function os(ne,n){Re(n,!0);let r=Ae(n,"status",15),l=Ae(n,"deliveryDate",15),c=Ae(n,"disabled",3,!1);var D=Ys(),p=a(D),K=a(p),V=a(K);V.value=V.__value="delivered";var N=s(V);N.value=N.__value="ordered",t(K);var z=s(K,2);t(p);var oe=s(p,2);{var I=h=>{var M=Xs(),L=s(a(M),2);dt(L),t(M),b(()=>L.disabled=c()),ut(L,l),o(h,M)};d(oe,h=>{r()==="ordered"&&h(I)})}t(D),b(()=>{K.disabled=c(),Ce(z,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),as(K,r),o(ne,D),Qe()}var Zs=i('<div class="alert alert-error"><!> <span> </span></div>'),er=i(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),tr=i('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),ar=i('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),sr=i(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),rr=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),nr=i('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),or=i('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),ir=i("<!> <!> <!>",1);function lr(ne,n){Re(n,!0);let r=qe(!1),l=qe(null),c=Ye({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),D=qe(Ye(new Set));ft(()=>{$(D,new Set(n.products.map(I=>I.$id)),!0)});const p=Q(()=>n.products.filter(I=>e(D).has(I.$id))),K=Q(()=>e(p).length!==0),V=Q(()=>{const I=A.dateRange;let h="";return I?.start&&I?.end&&(I.start===I.end?h=` - ${gt(I.start)}`:h=` - Du ${gt(I.start)} au ${gt(I.end)}`),`Achat groupé (${e(p).length} produit${e(p).length>1?"s":""})${h}`});async function N(){if(!e(K)||e(r))return;$(r,!0),$(l,null);const I=`FACTURE_${Date.now()}`,h=e(p).map(U=>U.$id);A.setSyncStatus(h,!0),Ge.backgroundOperation={isRunning:!0,name:`Achat groupé (${e(p).length} produits)`,progress:0};const M=[];for(const U of e(p)){const Y=(A.getProductModelById(U.$id)?.stats.missingQuantities||[]).filter(x=>x.q<0).map(x=>({q:Math.abs(x.q),u:x.u}));M.push({productId:U.$id,isSynced:U.isSynced,missingQuantities:Y})}const L={invoiceId:I,invoiceTotal:c.expense||void 0,store:c.store.trim()||void 0,notes:c.notes||`Achat groupé pour ${e(p).length} produits`,who:c.who.trim()||void 0,purchaseStatus:c.status||"delivered",purchaseDeliveryDate:c.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${M.length} produits...`),n.onClose();try{await zt.track(A.createGroupPurchase(M,L).then(U=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${U.success?"succès":"échec"}, ${U.totalProductsCreated} produits synchronisés, ${U.totalPurchasesCreated} achats créés, ${U.totalExpensesCreated} dépenses globales`),!U.success)throw new Error(U.error||"Erreur lors de la création de l'achat groupé");return A.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),n.onSuccess?.(),U}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(U){console.error("[GroupPurchaseModal] Erreur création achat groupé:",U),A.clearSyncStatus()}finally{$(r,!1),Ge.backgroundOperation={isRunning:!1,name:"",progress:0}}}function z(I){const h=new Set(e(D));h.has(I)?h.delete(I):h.add(I),$(D,h,!0)}const oe=Q(()=>n.products.map(I=>{const h=A.getProductModelById(I.$id);return{id:I.$id,label:I.productName,title:`${I.productName} - Manque: ${h?.stats.formattedMissingQuantities||"-"}`,badge:h?.stats.formattedMissingQuantities||"-"}}));Mt(ne,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(I,h)=>{var M=ir(),L=xe(M);wt(L,{get title(){return e(V)},showBackButton:!0,get onClose(){return n.onClose}});var U=s(L,2);qt(U,{children:(Y,x)=>{var w=sr(),g=a(w);{var B=O=>{var re=Zs(),ge=a(re);ca(ge,{class:"h-4 w-4"});var te=s(ge,2),ie=a(te,!0);t(te),t(re),b(()=>f(ie,e(l))),o(O,re)};d(g,O=>{e(l)&&O(B)})}var Z=s(g,2),W=a(Z);Ia(W,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:(O,re)=>{var ge=er();Ie(2),o(O,ge)},$$slots:{default:!0}}),t(Z);var ue=s(Z,2),H=s(a(ue),2),de=a(H),ve=a(de);Ct(ve,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},get value(){return c.store},set value(O){c.store=O}}),t(de);var J=s(de,2),me=a(J);aa(me,{get suggestions(){return A.uniqueWho},get disabled(){return e(r)},get value(){return c.who},set value(O){c.who=O}}),t(J),t(H);var be=s(H,2);Oa(be,{get disabled(){return e(r)},get value(){return c.expense},set value(O){c.expense=O}});var le=s(be,2);os(le,{get disabled(){return e(r)},get status(){return c.status},set status(O){c.status=O},get deliveryDate(){return c.deliveryDate},set deliveryDate(O){c.deliveryDate=O}});var pe=s(le,2);Dt(pe,{get disabled(){return e(r)},get value(){return c.notes},set value(O){c.notes=O}}),t(ue);var R=s(ue,2);{var se=O=>{var re=tr(),ge=s(a(re),2),te=s(a(ge)),ie=a(te,!0);t(te);var k=s(te,2),T=a(k,!0);t(k),Ie(),t(ge);var fe=s(ge,2);jt(fe,{get items(){return e(oe)},onToggleItem:z,size:"sm",color:"success"}),t(re),b((he,ee)=>{f(ie,he),f(T,ee)},[()=>gt(A.dateRange.start),()=>gt(A.dateRange.end)]),o(O,re)},ae=O=>{var re=ar();o(O,re)};d(R,O=>{e(oe).length>0?O(se):O(ae,!1)})}t(w),o(Y,w)}});var X=s(U,2);_a(X,{children:(Y,x)=>{var w=or(),g=a(w);g.__click=function(...H){n.onClose?.apply(this,H)};var B=s(g,2);B.__click=N;var Z=a(B);{var W=H=>{var de=rr();Ie(),o(H,de)},ue=H=>{var de=nr(),ve=xe(de);xt(ve,{class:"h-4 w-4"});var J=s(ve,2),me=s(a(J)),be=a(me);t(me),t(J),b(()=>f(be,`${e(p).length??""} produit${e(p).length>1?"s":""}`)),o(H,de)};d(Z,H=>{e(r)?H(W):H(ue,!1)})}t(B),t(w),b(()=>{g.disabled=e(r),B.disabled=e(r)||!e(K)}),o(Y,w)}}),o(I,M)},$$slots:{default:!0}}),Qe()}at(["click"]);const dr=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var vr=i("<option> </option>"),cr=i('<fieldset class="fieldset"><div class="flex gap-2"><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité" required/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end" required><option disabled selected>-</option><!></select></label></div></fieldset>');function ba(ne,n){Re(n,!0);let r=Ae(n,"quantity",15),l=Ae(n,"unit",15),c=Ae(n,"disabled",3,!1);var D=cr(),p=a(D),K=a(p),V=a(K);Sa(V,{class:"h-4 w-4 opacity-50"});var N=s(V,2);dt(N),t(K);var z=s(K,2),oe=s(a(z),2),I=a(oe);I.value=I.__value="";var h=s(I);We(h,17,()=>dr,yt,(M,L)=>{let U=()=>e(L).value,X=()=>e(L).label;var Y=vr(),x=a(Y,!0);t(Y);var w={};b(()=>{f(x,X()),w!==(w=U())&&(Y.value=(Y.__value=U())??"")}),o(M,Y)}),t(oe),t(z),t(p),t(D),b(()=>{N.disabled=c(),oe.disabled=c()}),ut(N,r),as(oe,l),o(ne,D),Qe()}var ur=i('<div class="alert alert-error text-sm"><!> <span> </span></div>'),mr=i('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),pr=i('<span class="loading loading-spinner"></span>'),fr=i('<span class="loading loading-spinner"></span>'),_r=i('<form class="flex h-full flex-col space-y-4"><!> <!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),br=i("<!> <!>",1);function gr(ne,n){Re(n,!0);let r=Ae(n,"open",15,!1),l=qe(!1),c=qe(null),D=qe(!1),p=qe(Ye({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const K=Q(()=>e(p).productName.trim().length>0&&e(p).productType.trim().length>0),V=Q(()=>A.uniqueProductTypes.map(I=>({id:I,label:I})));let N=Q(()=>A.isEventPassed);async function z(I=!1){if(!(!e(K)||e(l))){$(l,!0),$(c,null),$(D,!1);try{if(!A.currentMainId)throw new Error("Aucun événement principal sélectionné");const h={productName:e(p).productName.trim(),productType:e(p).productType.trim(),store:e(p).store.trim()?{storeName:e(p).store.trim()}:void 0,who:e(p).who.trim()?[e(p).who.trim()]:void 0,pF:e(p).pF,pS:e(p).pS,quantity:e(p).quantity?{q:e(p).quantity,u:e(p).unit.trim()||"pièces"}:void 0};await Ms(h,A.currentMainId),$(D,!0),I?(e(p).productName="",e(p).quantity=null,e(p).unit="",e(p).pF=!1,e(p).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),$(p,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(h){console.error("Error creating product:",h),$(c,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{$(l,!1)}}}function oe(){r(!1),$(p,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),$(c,null)}ft(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),Mt(ne,{get isOpen(){return r()},onClose:oe,children:(I,h)=>{var M=br(),L=xe(M);wt(L,{title:"Ajouter un produit",onClose:oe});var U=s(L,2);qt(U,{children:(X,Y)=>{var x=_r(),w=a(x);{var g=P=>{var G=ur(),ye=a(G);ca(ye,{size:18});var ke=s(ye,2),u=a(ke,!0);t(ke),t(G),b(()=>f(u,e(c))),o(P,G)};d(w,P=>{e(c)&&P(g)})}var B=s(w,2);{var Z=P=>{var G=mr(),ye=a(G);Pa(ye,{class:"h-4 w-4"}),Ie(4),t(G),o(P,G)};d(B,P=>{e(N)&&P(Z)})}var W=s(B,2),ue=a(W),H=a(ue),de=a(H),ve=a(de);cs(ve,{class:"text-base-content/50 h-5 w-5"});var J=s(ve,2);dt(J),t(de),t(H);var me=s(H,2);ba(me,{get disabled(){return e(l)},get quantity(){return e(p).quantity},set quantity(P){e(p).quantity=P},get unit(){return e(p).unit},set unit(P){e(p).unit=P}}),t(ue);var be=s(ue,2),le=a(be),pe=a(le),R=a(pe);dt(R),t(pe);var se=s(pe,2);Ta(se,{get suggestions(){return e(V)},onSuggestionClick:P=>e(p).productType=P.label,get disabled(){return e(l)}}),t(le),t(be);var ae=s(be,2);Ct(ae,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(p).store},set value(P){e(p).store=P}});var O=s(ae,2);aa(O,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(p).who},set value(P){e(p).who=P}});var re=s(O,2),ge=a(re),te=a(ge),ie=a(te);dt(ie),Ie(2),t(te),t(ge);var k=s(ge,2),T=a(k),fe=a(T);dt(fe),Ie(2),t(T),t(k),t(re);var he=s(re,2),ee=a(he);ee.__click=oe;var C=s(ee,2),j=a(C);j.__click=()=>z(!0);var _e=a(j);{var S=P=>{var G=pr();o(P,G)},F=P=>{Tt(P,{size:18})};d(_e,P=>{e(l)?P(S):P(F,!1)})}Ie(),t(j);var v=s(j,2),_=a(v);{var q=P=>{var G=fr();o(P,G)};d(_,P=>{e(l)&&P(q)})}Ie(),t(v),t(C),t(he),t(W),t(x),b(()=>{W.disabled=e(l),J.disabled=e(l),R.disabled=e(l),ie.disabled=e(l),fe.disabled=e(l),ee.disabled=e(l),j.disabled=e(l)||!e(p).productName||e(N),v.disabled=e(l)||!e(p).productName||e(N)}),Oe("submit",x,P=>{P.preventDefault(),z(!1)}),ut(J,()=>e(p).productName,P=>e(p).productName=P),ut(R,()=>e(p).productType,P=>e(p).productType=P),Na(ie,()=>e(p).pF,P=>e(p).pF=P),Na(fe,()=>e(p).pS,P=>e(p).pS=P),o(X,x)}}),o(I,M)},$$slots:{default:!0}}),Qe()}at(["click"]);var Nt,Ft,Lt,Bt,Rt,Qt,Vt,Ut,Gt,Wt,Ht,Jt,Kt,Xt,Yt,Zt;class hr{constructor(n,r="recettes"){rt(this,Nt,qe(!1));rt(this,Ft,qe(null));rt(this,Lt,qe("recettes"));rt(this,Bt,Q(()=>A.getProductModelById(this.productId)));rt(this,Rt,Q(()=>this.productModel?.data??null));rt(this,Qt,Q(()=>this.product?.who??[]));rt(this,Vt,Q(()=>this.product?.stockParsed??null));rt(this,Ut,Q(()=>this.product?.purchases??[]));rt(this,Gt,Q(()=>this.product?.byDate?qs(this.product.byDate):[]));rt(this,Wt,qe(Ye({purchase:{quantity:null,unit:"",store:"",who:Ge.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));rt(this,Ht,qe(Ye({overrideManagerEditMode:!1})));rt(this,Jt,qe(null));rt(this,Kt,Q(()=>this.editingPurchaseId?this.purchasesList.find(n=>n.$id===this.editingPurchaseId)??null:null));rt(this,Xt,qe(null));rt(this,Yt,Q(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));rt(this,Zt,Q(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));ha(this,"formatQuantity",(n,r)=>la(n,r));ha(this,"formatDate",Rs);this.productId=n,this.currentTab=r,this.initForms()}get loading(){return e(ze(this,Nt))}set loading(n){$(ze(this,Nt),n,!0)}get error(){return e(ze(this,Ft))}set error(n){$(ze(this,Ft),n,!0)}get currentTab(){return e(ze(this,Lt))}set currentTab(n){$(ze(this,Lt),n,!0)}get productModel(){return e(ze(this,Bt))}set productModel(n){$(ze(this,Bt),n)}get product(){return e(ze(this,Rt))}set product(n){$(ze(this,Rt),n)}get whoList(){return e(ze(this,Qt))}set whoList(n){$(ze(this,Qt),n)}get stockParsed(){return e(ze(this,Vt))}set stockParsed(n){$(ze(this,Vt),n)}get purchasesList(){return e(ze(this,Ut))}set purchasesList(n){$(ze(this,Ut),n)}get recipes(){return e(ze(this,Gt))}set recipes(n){$(ze(this,Gt),n)}get forms(){return e(ze(this,Wt))}set forms(n){$(ze(this,Wt),n,!0)}get uiStates(){return e(ze(this,Ht))}set uiStates(n){$(ze(this,Ht),n,!0)}get editingPurchaseId(){return e(ze(this,Jt))}set editingPurchaseId(n){$(ze(this,Jt),n,!0)}get editingPurchaseData(){return e(ze(this,Kt))}set editingPurchaseData(n){$(ze(this,Kt),n)}get originalFormsSnapshot(){return e(ze(this,Xt))}set originalFormsSnapshot(n){$(ze(this,Xt),n,!0)}initForms(){const n=A.getProductModelById(this.productId);if(!n||!n.data)return;const r=n.stats.missingQuantities[0];if(r){const{value:l,unit:c}=It(Math.abs(r.q),r.u);this.forms.purchase.quantity=l,this.forms.purchase.unit=c}else this.forms.purchase.quantity=null,this.forms.purchase.unit=n.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=n.data.storeInfo?.storeName??"",this.forms.purchase.who=Ge.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=n.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=n.data.storeInfo?.storeName??"",this.forms.store.comment=n.data.storeInfo?.storeComment??null,this.forms.who=n.data.who?[...n.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return e(ze(this,Yt))}set hasChanges(n){$(ze(this,Yt),n)}get hasAnyChanges(){return e(ze(this,Zt))}set hasAnyChanges(n){$(ze(this,Zt),n)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(n){this.currentTab=n}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");const{value:n,unit:r}=It(this.forms.purchase.quantity,this.forms.purchase.unit),l=this.forms.purchase.status||"delivered";let c=this.forms.purchase.deliveryDate||null;l==="delivered"&&!c&&(c=new Date().toISOString());const D=Et.normalize(n,r),p=D.quantity,K=D.unit;await A.createPurchase(this.product.$id,[{q:p,u:K}],{store:this.forms.purchase.store||void 0,who:this.forms.purchase.who||void 0,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:l,orderDate:this.forms.purchase.orderDate||null,deliveryDate:c,invoiceId:void 0});const V=this.product.missingQuantityArray[0];let N=null,z=this.product.totalNeededArray[0]?.u??"";if(V){const{value:oe,unit:I}=It(Math.abs(V.q),V.u);N=oe,z=I}this.forms.purchase={quantity:N,unit:z,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(n){this.editingPurchaseId=n.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(n){n.$id&&await this.withLoading(async()=>{const r=Et.normalize(n.quantity,n.unit),l=n.status||null;let c=n.deliveryDate||null;l==="delivered"&&!c&&(c=new Date().toISOString()),await A.updatePurchase(n.$id,{unit:r.unit,quantity:r.quantity,store:n.store||null,who:n.who||null,notes:n.notes||"",price:n.price||null,status:l,orderDate:n.orderDate||null,deliveryDate:c}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(n){const r=this.purchasesList.find(l=>l.$id===n);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await A.deletePurchase(n)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const n=Et.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:n.quantity.toString(),unit:n.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};await A.updateProduct(this.product.$id,{stockReel:JSON.stringify(r)}),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{stockReel:null})},"Stock supprimé")}async setWho(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{who:n})},"Volontaires mis à jour")}async updateStore(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{storeInfo:n})},"Magasin mis à jour")}async setOverride(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:JSON.stringify(n)})},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:null})},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const n={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};n.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(n.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};n.storeInfo=r}Object.keys(n).length>0&&(await A.updateProductBatch(this.product.$id,n,r=>A.getEnrichedProductById(r)),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(n,r){this.loading=!0,this.error=null;try{const l=await n();return r&&this.showToast("success",r),l}catch(l){const c=l instanceof Error?l.message:"Une erreur est survenue";return this.error=c,this.showToast("error",c),console.error("[ProductModalState]",l),null}finally{this.loading=!1}}showToast(n,r){const l=new CustomEvent("toast",{detail:{type:n,message:r}});window.dispatchEvent(l)}}Nt=new WeakMap,Ft=new WeakMap,Lt=new WeakMap,Bt=new WeakMap,Rt=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Zt=new WeakMap;var xr=i('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),yr=i('<div class="text-base-content/60 mt-1 text-xs"> </div>'),wr=i('<div class="font-medium"> </div> <!>',1),kr=i('<pre class="text-xs"> </pre>'),Sr=i('<span class="text-base-content/50 italic">Non défini</span>'),Pr=i('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),Mr=i('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function ga(ne,n){Re(n,!0);let r=Ae(n,"title",3,"Événement terminé"),l=Ae(n,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),c=Ae(n,"showData",3,!0),D=Ae(n,"data",3,null),p=Ae(n,"dataLabel",3,"");var K=Mr(),V=a(K),N=a(V);Pa(N,{class:"text-warning h-5 w-5"});var z=s(N,2);us(z,{class:"text-warning/70 h-4 w-4"});var oe=s(z,2),I=a(oe,!0);t(oe),t(V);var h=s(V,2),M=a(h,!0);t(h);var L=s(h,2);{var U=X=>{var Y=Pr(),x=a(Y);{var w=ue=>{var H=xr(),de=a(H);t(H),b(()=>f(de,`${p()??""} :`)),o(ue,H)};d(x,ue=>{p()&&ue(w)})}var g=s(x,2),B=a(g);{var Z=ue=>{var H=tt();b(()=>f(H,D())),o(ue,H)},W=ue=>{var H=Ne(),de=xe(H);{var ve=me=>{var be=tt();b(le=>f(be,le),[()=>D().join(", ")]),o(me,be)},J=me=>{var be=Ne(),le=xe(be);{var pe=se=>{var ae=Ne(),O=xe(ae);{var re=te=>{var ie=wr(),k=xe(ie),T=a(k,!0);t(k);var fe=s(k,2);{var he=ee=>{var C=yr(),j=a(C,!0);t(C),b(()=>f(j,D().storeComment)),o(ee,C)};d(fe,ee=>{D().storeComment&&ee(he)})}b(()=>f(T,D().storeName)),o(te,ie)},ge=te=>{var ie=kr(),k=a(ie,!0);t(ie),b(T=>f(k,T),[()=>JSON.stringify(D(),null,2)]),o(te,ie)};d(O,te=>{D().storeName?te(re):te(ge,!1)})}o(se,ae)},R=se=>{var ae=Sr();o(se,ae)};d(le,se=>{typeof D()=="object"&&D()!==null?se(pe):se(R,!1)},!0)}o(me,be)};d(de,me=>{Array.isArray(D())&&D().length>0?me(ve):me(J,!1)},!0)}o(ue,H)};d(B,ue=>{typeof D()=="string"||typeof D()=="number"?ue(Z):ue(W,!1)})}t(g),t(Y),o(X,Y)};d(L,X=>{c()&&D()&&X(U)})}t(K),b(()=>{f(I,r()),f(M,l())}),o(ne,K),Qe()}var qr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Cr=i('<span class="loading loading-spinner loading-sm"></span>'),Dr=i('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-6"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Ar=i('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),Tr=i("<th>Actions</th>"),Ir=i('<span class="loading loading-spinner loading-sm"></span>'),Er=i('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),Or=i('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),$r=i('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),zr=i('<span class="loading loading-spinner loading-xs"></span>'),jr=i('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),Nr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Fr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Lr=i('<div class="mt-2 text-sm opacity-70"><!> </div>'),Br=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-37.5 truncate"> </span></div>'),Rr=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-25 truncate"> </span></div>'),Qr=i('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),Vr=i('<div class="card bg-base-100 border-neutral/40 card-xs border shadow-sm"><div class="card-body p-4"><div class="flex items-center justify-between gap-3"><div class="flex flex-wrap items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span class="font-medium"> </span></div> <div> <!></div> <div> </div></div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-sm"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),Ur=i('<div class="mt-4 space-y-3"></div>'),Gr=i('<div class="space-y-4"><!></div> <!>',1);function Wr(ne,n){Re(n,!0);let r=Ae(n,"modalState",7),l=Ae(n,"isArchiveMode",3,!1);function c(g){return g.quantity!==null&&g.quantity!==0&&g.unit?.trim()!==""}function D(g){if(l())return;const{value:B,unit:Z}=It(g.quantity,g.unit);r().forms.purchase.quantity=B,r().forms.purchase.unit=Z,r().forms.purchase.price=g.price,r().forms.purchase.store=g.store||"",r().forms.purchase.who=g.who||"",r().forms.purchase.notes=g.notes||"",r().forms.purchase.status=g.status||null,r().forms.purchase.orderDate=g.orderDate||null,r().forms.purchase.deliveryDate=g.deliveryDate||null,r().startEditPurchase(g),setTimeout(()=>{const W=document.querySelector("#purchase-form-card");W?.scrollIntoView({behavior:"smooth",block:"center"}),W?.querySelector('input[type="number"]')?.focus()},100)}function p(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function K(){if(r().isPurchaseFormValid)if(r().editingPurchaseId){const g=r().editingPurchaseData;if(!g||!c(g))return;const B=r().forms.purchase.quantity??0,Z=r().forms.purchase.unit,W=Et.normalize(B,Z);g.quantity=W.quantity,g.unit=W.unit,g.price=r().forms.purchase.price,g.store=r().forms.purchase.store,g.who=r().forms.purchase.who,g.notes=r().forms.purchase.notes,g.status=r().forms.purchase.status,g.orderDate=r().forms.purchase.orderDate,g.deliveryDate=r().forms.purchase.deliveryDate,r().updateEditedPurchase(g),r().cancelEditPurchase()}else r().forms.purchase.status==="ordered"&&!r().forms.purchase.orderDate&&(r().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),r().addPurchase()}function V(g){r().removePurchase(g)}function N(g){D(g)}let z=Q(()=>r().editingPurchaseId!==null),oe=Q(()=>e(z)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),I=Q(()=>e(z)?"Enregistrer les modifications":"Ajouter l'achat");var h=Gr(),M=xe(h),L=a(M);{var U=g=>{ga(g,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},X=g=>{var B=Dr(),Z=a(B),W=a(Z),ue=a(W,!0);t(W);var H=s(W,2),de=a(H),ve=a(de);ba(ve,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(k){r().forms.purchase.quantity=k},get unit(){return r().forms.purchase.unit},set unit(k){r().forms.purchase.unit=k}});var J=s(ve,2);Oa(J,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(k){r().forms.purchase.price=k}});var me=s(J,2);Ct(me,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(k){r().forms.purchase.store=k}});var be=s(me,2);aa(be,{get suggestions(){return A.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(k){r().forms.purchase.who=k}}),t(de);var le=s(de,2),pe=a(le);Dt(pe,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(k){r().forms.purchase.notes=k}}),t(le);var R=s(le,2);os(R,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(k){r().forms.purchase.status=k},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(k){r().forms.purchase.deliveryDate=k}}),t(H);var se=s(H,2),ae=a(se);{var O=k=>{var T=qr();T.__click=p,o(k,T)};d(ae,k=>{e(z)&&k(O)})}var re=s(ae,2);re.__click=K;var ge=a(re);{var te=k=>{var T=Cr();o(k,T)},ie=k=>{var T=tt();b(()=>f(T,e(I))),o(k,T)};d(ge,k=>{r().loading?k(te):k(ie,!1)})}t(re),t(se),t(Z),t(B),b(()=>{Ce(B,1,`card bg-base-200 ${e(z)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,e(oe)),re.disabled=r().loading||!r().isPurchaseFormValid}),o(g,B)};d(L,g=>{l()?g(U):g(X,!1)})}t(M);var Y=s(M,2);{var x=g=>{var B=Ar(),Z=a(B);xt(Z,{class:"mx-auto mb-2 h-12 w-12"}),Ie(2),t(B),o(g,B)},w=g=>{var B=Ne(),Z=xe(B);{var W=H=>{var de=$r(),ve=a(de),J=a(ve),me=a(J),be=s(a(me),8);{var le=R=>{var se=Tr();o(R,se)};d(be,R=>{l()||R(le)})}t(me),t(J);var pe=s(J);We(pe,21,()=>r().purchasesList,R=>R.$id,(R,se)=>{var ae=Or(),O=a(ae),re=a(O,!0);t(O);var ge=s(O),te=a(ge,!0);t(ge);var ie=s(ge),k=a(ie,!0);t(ie);var T=s(ie),fe=a(T),he=a(fe,!0);t(fe),t(T);var ee=s(T),C=a(ee,!0);t(ee);var j=s(ee),_e=a(j,!0);t(j);var S=s(j),F=a(S,!0);t(S);var v=s(S),_=a(v,!0);t(v);var q=s(v);{var P=G=>{var ye=Er(),ke=a(ye),u=a(ke);u.__click=()=>N(e(se));var m=a(u);ht(m,{class:"h-4 w-4"}),t(u);var y=s(u,2);y.__click=()=>V(e(se).$id);var E=a(y);{var ce=we=>{var Pe=Ir();o(we,Pe)},Se=we=>{ua(we,{class:"h-4 w-4"})};d(E,we=>{r().loading?we(ce):we(Se,!1)})}t(y),t(ke),t(ye),b(()=>y.disabled=r().loading),o(G,ye)};d(q,G=>{l()||G(P)})}t(ae),b((G,ye,ke,u,m)=>{f(re,G),f(te,e(se).store||"-"),f(k,e(se).who||"-"),Ce(fe,1,`badge badge-sm ${ye??""}`),f(he,ke),f(C,u),f(_e,m),f(F,e(se).price?`${e(se).price}€`:"-"),f(_,e(se).notes||"-")},[()=>la(e(se).quantity,e(se).unit),()=>na(e(se).status).class,()=>na(e(se).status).text,()=>oa(e(se).orderDate),()=>oa(e(se).deliveryDate)]),o(R,ae)}),t(pe),t(ve),t(de),o(H,de)},ue=H=>{var de=Ur();We(de,21,()=>r().purchasesList,ve=>ve.$id,(ve,J)=>{var me=Vr(),be=a(me),le=a(be),pe=a(le),R=a(pe),se=a(R);ms(se,{class:"size-4"});var ae=s(se,2),O=a(ae,!0);t(ae),t(R);var re=s(R,2),ge=a(re),te=s(ge);Va(te,{class:"me-1 inline size-4"}),t(re);var ie=s(re,2),k=a(ie,!0);t(ie),t(pe);var T=s(pe,2);{var fe=u=>{var m=jr();m.__click=()=>V(e(J).$id);var y=a(m);{var E=Se=>{var we=zr();o(Se,we)},ce=Se=>{ps(Se,{size:16})};d(y,Se=>{r().loading?Se(E):Se(ce,!1)})}t(m),b(()=>m.disabled=r().loading),o(u,m)};d(T,u=>{l()||u(fe)})}t(le);var he=s(le,2),ee=a(he);{var C=u=>{var m=Nr(),y=a(m);Ot(y,{class:"size-3.5"});var E=s(y,2),ce=a(E);t(E),t(m),b(Se=>f(ce,`Commande: ${Se??""}`),[()=>oa(e(J).orderDate)]),o(u,m)};d(ee,u=>{e(J).orderDate&&u(C)})}var j=s(ee,2);{var _e=u=>{var m=Fr(),y=a(m);Ot(y,{class:"size-3.5"});var E=s(y,2),ce=a(E);t(E),t(m),b(Se=>f(ce,`Livraison: ${Se??""}`),[()=>e(J).deliveryDate?oa(e(J).deliveryDate):"non renseigné"]),o(u,m)};d(j,u=>{e(J).status==="ordered"&&u(_e)})}t(he);var S=s(he,2);{var F=u=>{var m=Lr(),y=a(m);Ua(y,{class:"me-1 inline size-3.5"});var E=s(y);t(m),b(()=>f(E,` ${e(J).notes??""}`)),o(u,m)};d(S,u=>{e(J).notes&&u(F)})}var v=s(S,2),_=a(v);{var q=u=>{var m=Br(),y=a(m);vt(y,{class:"h-3 w-3"});var E=s(y,2),ce=a(E,!0);t(E),t(m),b(()=>f(ce,e(J).store)),o(u,m)};d(_,u=>{e(J).store&&u(q)})}var P=s(_,2);{var G=u=>{var m=Rr(),y=a(m);ea(y,{class:"size-3.5"});var E=s(y,2),ce=a(E,!0);t(E),t(m),b(()=>f(ce,e(J).who)),o(u,m)};d(P,u=>{e(J).who&&u(G)})}t(v);var ye=s(v,2);{var ke=u=>{var m=Qr(),y=a(m);y.__click=()=>N(e(J));var E=a(y);ht(E,{size:16,class:"mr-1"}),Ie(),t(y),t(m),o(u,m)};d(ye,u=>{l()||u(ke)})}t(be),t(me),b((u,m,y)=>{f(O,u),f(ge,`${(e(J).price?e(J).price:"?")??""} `),Ce(ie,1,`badge ${m??""}`),f(k,y)},[()=>la(e(J).quantity,e(J).unit),()=>na(e(J).status).class,()=>na(e(J).status).text]),o(ve,me)}),t(de),o(H,de)};d(Z,H=>{Ge.isMobile?H(ue,!1):H(W)},!0)}o(g,B)};d(Y,g=>{r().purchasesList.length===0?g(x):g(w,!1)})}o(ne,h),Qe()}at(["click"]);var Hr=i(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),Jr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Kr=i('<span class="loading loading-spinner loading-xs"></span>'),Xr=i('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Yr=i('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),Zr=i('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),en=i('<span class="loading loading-spinner loading-xs"></span>'),tn=i('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),an=i('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),sn=i('<div class="space-y-4"><!></div> <!>',1);function rn(ne,n){Re(n,!0);let r=Ae(n,"modalState",7),l=Ae(n,"isArchiveMode",3,!1),c=qe(!1);async function D(){await r()?.setStock(),$(c,!1)}async function p(){await r()?.removeStock()}function K(){if(!r().stockParsed)return;const{value:X,unit:Y}=It(r().stockParsed.quantity,r().stockParsed.unit);r().forms.stock.quantity=X,r().forms.stock.unit=Y,r().forms.stock.notes=r().stockParsed.notes??"",r().forms.stock.dateTime=r().stockParsed.dateTime,$(c,!0)}function V(){$(c,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var N=sn(),z=xe(N),oe=a(z);{var I=X=>{ga(X,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},h=X=>{var Y=Ne(),x=xe(Y);{var w=g=>{var B=Xr(),Z=a(B),W=a(Z),ue=a(W,!0);t(W);var H=s(W,2),de=a(H);Ia(de,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(te,ie)=>{Ie();var k=Hr();Ie(4),o(te,k)},$$slots:{default:!0}}),t(H);var ve=s(H,2),J=a(ve);ba(J,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(te){r().forms.stock.quantity=te},get unit(){return r().forms.stock.unit},set unit(te){r().forms.stock.unit=te}}),t(ve);var me=s(ve,2),be=a(me);Dt(be,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(te){r().forms.stock.notes=te}}),t(me);var le=s(me,2),pe=a(le);{var R=te=>{var ie=Jr();ie.__click=V,b(()=>ie.disabled=r().loading),o(te,ie)};d(pe,te=>{e(c)&&te(R)})}var se=s(pe,2);se.__click=()=>{r().forms.stock.quantity=null,r().forms.stock.notes=""};var ae=s(se,2);ae.__click=D;var O=a(ae);{var re=te=>{var ie=Kr();o(te,ie)},ge=te=>{var ie=tt();b(()=>f(ie,e(c)?"Enregistrer les modifications":"Déclarer le stock")),o(te,ie)};d(O,te=>{r().loading?te(re):te(ge,!1)})}t(ae),t(le),t(Z),t(B),b(te=>{Ce(B,1,`card bg-base-200 ${e(c)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,te),Ce(se,1,`btn btn-ghost btn-sm ${e(c)?"hidden":""}`),se.disabled=r().loading,ae.disabled=r().loading||!r().forms.stock.quantity},[()=>e(c)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),o(g,B)};d(x,g=>{(!r().stockParsed||e(c))&&g(w)})}o(X,Y)};d(oe,X=>{l()?X(I):X(h,!1)})}t(z);var M=s(z,2);{var L=X=>{var Y=Yr(),x=a(Y);Ga(x,{class:"mx-auto mb-2 h-12 w-12"}),Ie(2),t(Y),o(X,Y)},U=X=>{var Y=Ne(),x=xe(Y);{var w=g=>{var B=an(),Z=a(B),W=a(Z),ue=s(a(W),2),H=a(ue);t(ue);var de=s(ue,2),ve=s(a(de),2),J=a(ve,!0);t(ve),t(de);var me=s(de,2);{var be=R=>{var se=Zr(),ae=s(a(se),2),O=a(ae,!0);t(ae),t(se),b(()=>f(O,r().stockParsed.notes)),o(R,se)};d(me,R=>{r().stockParsed.notes&&R(be)})}t(W);var le=s(W,2);{var pe=R=>{var se=tn(),ae=a(se);ae.__click=p;var O=a(ae);{var re=k=>{var T=en();o(k,T)},ge=k=>{var T=tt("Supprimer le stock");o(k,T)};d(O,k=>{r().loading?k(re):k(ge,!1)})}t(ae);var te=s(ae,2);te.__click=K;var ie=a(te);ht(ie,{class:"mr-1 h-4 w-4"}),Ie(),t(te),t(se),b(()=>{ae.disabled=r().loading,te.disabled=r().loading}),o(R,se)};d(le,R=>{l()||R(pe)})}t(Z),t(B),b(R=>{f(H,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),f(J,R)},[()=>ta(r().stockParsed.dateTime)]),o(g,B)};d(x,g=>{e(c)||g(w)})}o(X,Y)};d(M,X=>{r().stockParsed?X(U,!1):X(L)})}o(ne,N),Qe()}at(["click"]);var nn=i('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),on=i('<div class="space-y-4"><!></div>');function ln(ne,n){Re(n,!0);let r=Ae(n,"modalState",7),l=Ae(n,"isArchiveMode",3,!1),c=qe("");const D=Q(()=>{const M=A.uniqueWho,L=new Set([...M,...r().forms.who]);return Array.from(L).map(U=>({id:U,label:U,selected:r().forms.who.includes(U)}))});function p(M){const L=M.trim();L&&!r().forms.who.includes(L)&&(r().forms.who=[...r().forms.who,L])}function K(M){r().forms.who=r().forms.who.filter(L=>L!==M)}function V(M){r().forms.who.includes(M)?K(M):p(M)}function N(){e(c).trim()&&(p(e(c)),$(c,""))}var z=on(),oe=a(z);{var I=M=>{ga(M,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},h=M=>{var L=nn(),U=a(L),X=s(a(U),4),Y=a(X),x=a(Y),w=a(x);ea(w,{class:"h-4 w-4 opacity-50"});var g=s(w,2);dt(g),g.__keydown=H=>{H.key==="Enter"&&(H.preventDefault(),N())},t(x);var B=s(x,2);B.__click=N;var Z=a(B);Wa(Z,{size:16}),t(B),t(Y);var W=s(Y,2),ue=s(a(W),2);jt(ue,{get items(){return e(D)},onToggleItem:V,size:"sm",color:"info"}),t(W),t(X),t(U),t(L),b(H=>{g.disabled=r().loading,B.disabled=H},[()=>r().loading||!e(c).trim()]),ut(g,()=>e(c),H=>$(c,H)),o(M,L)};d(oe,M=>{l()?M(I):M(h,!1)})}t(z),o(ne,z),Qe()}at(["keydown","click"]);var dn=i(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),vn=i('<div class="space-y-4"><!></div>');function cn(ne,n){Re(n,!0);let r=Ae(n,"modalState",7),l=Ae(n,"isArchiveMode",3,!1);const c=Q(()=>r()?.hasChanges?.store||!1);async function D(){if(!e(c))return;const z={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(z)}var p=vn(),K=a(p);{var V=z=>{{let oe=Q(()=>r().product?.storeInfo);ga(z,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return e(oe)},dataLabel:"Magasin actuel"})}},N=z=>{var oe=dn(),I=a(oe),h=s(a(I),4),M=a(h),L=a(M);Ct(L,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},onkeydown:x=>{x.key==="Enter"&&D()},get value(){return r().forms.store.name},set value(x){r().forms.store.name=x}}),t(M);var U=s(M,2);Dt(U,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(x){r().forms.store.comment=x}}),t(h);var X=s(h,2),Y=a(X);Y.__click=()=>{r().forms.store.name="",r().forms.store.comment=""},t(X),t(I),t(oe),b(()=>Y.disabled=r().loading),o(z,oe)};d(K,z=>{l()?z(V):z(N,!1)})}t(p),o(ne,p),Qe()}at(["click"]);var un=i('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function mn(ne,n){Re(n,!0);let r=Ae(n,"value",15);Ae(n,"disabled",3,!1);var l=un(),c=a(l);Ua(c,{size:20,class:"text-base-centent/70"});var D=s(c,2);dt(D),t(l),ut(D,r),o(ne,l),Qe()}var pn=i(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),fn=i('<span class="loading loading-spinner loading-sm"></span>'),_n=i('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),bn=i('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),gn=i('<div class="chat-bubble relative text-sm"> <!></div>'),hn=i('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),xn=i('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),yn=i('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function wn(ne,n){Re(n,!0);let r=Ae(n,"modalState",7);const l=Q(()=>r().product?.totalNeededOverrideParsed),c=Q(()=>r().product?.displayTotalOverride),D=Q(()=>r().product?ss(r().product):null);let p=Q(()=>r().uiStates.overrideManagerEditMode),K=Q(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),V=Q(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function N(){if(!e(K)||!e(V))return{quantity:0,unit:""};const{q:x,u:w}=Fa(e(K),e(V));return{quantity:Cs(x,w),unit:w}}let z=qe(Ye(N().quantity)),oe=qe(Ye(N().unit)),I=qe(Ye(r().product?.totalNeededOverrideParsed?.comment||""));ft(()=>{if(e(p)){const x=N();$(z,x.quantity,!0),$(oe,x.unit,!0),$(I,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let h=Q(()=>e(z)>0&&e(oe).trim()!=="");async function M(){if(!r())return;const{q:x,u:w}=Fa(e(z),e(oe)),g=r().product?.totalNeededOverrideParsed?.totalOverride,B=r().product?.totalNeededOverrideParsed?.comment||"";if(x!==g?.q||w!==g?.u||e(I)!==B){const W={totalOverride:{q:x,u:w},comment:e(I),totalComputedWhenOverride:r().product.totalNeededArray,platesNbWhenOverride:r().product.totalAssiettes,recipesNbWhenOverride:r().product.nbRecipes};await r().setOverride(W)}r().uiStates.overrideManagerEditMode=!1}async function L(){r()&&(await r().removeOverride(),r().uiStates.overrideManagerEditMode=!1)}var U=Ne(),X=xe(U);{var Y=x=>{var w=yn(),g=a(w);{var B=ae=>{var O=pn(),re=a(O);qa(re,{size:18});var ge=s(re,2),te=s(a(ge),2),ie=a(te),k=a(ie),T=s(a(k)),fe=a(T);t(T);var he=s(T,2),ee=a(he,!0);t(he),t(k),t(ie);var C=s(ie,2),j=a(C),_e=s(a(j)),S=a(_e);t(_e);var F=s(_e,2),v=a(F,!0);t(F),t(j),t(C);var _=s(C,2),q=a(_),P=a(q);t(q),t(_),t(te),t(ge),t(O),b((G,ye)=>{f(fe,`${e(D).details.oldPlates??""} couverts,
                  ${e(D).details.oldRecipes??""} recettes`),f(ee,G),f(S,`${e(D).details.newPlates??""} couverts,
                  ${e(D).details.newRecipes??""} recettes`),f(v,ye),f(P,`Votre override : ${e(c)??""}`)},[()=>La(e(D).details.oldComputed),()=>La(e(D).details.newComputed)]),o(ae,O)};d(g,ae=>{e(D)?.hasMismatch&&e(D)?.details&&ae(B)})}var Z=s(g,2),W=s(a(Z),2),ue=a(W),H=a(ue),de=s(H);ma(de,{class:"h-3 w-3"}),t(ue);var ve=s(ue,2),J=a(ve),me=s(J);Ma(me,{class:"h-3 w-3"}),t(ve);var be=s(ve,2),le=a(be,!0);t(be),t(W),t(Z);var pe=s(Z,2);{var R=ae=>{var O=_n(),re=s(a(O),2);ba(re,{get quantity(){return e(z)},set quantity(ee){$(z,ee,!0)},get unit(){return e(oe)},set unit(ee){$(oe,ee,!0)}});var ge=s(re,2);mn(ge,{get value(){return e(I)},set value(ee){$(I,ee,!0)}});var te=s(ge,2),ie=a(te);ie.__click=L;var k=s(ie,2);k.__click=M;var T=a(k);{var fe=ee=>{var C=fn();o(ee,C)},he=ee=>{var C=tt("✓");o(ee,C)};d(T,ee=>{r().loading?ee(fe):ee(he,!1)})}t(k),t(te),t(O),b(()=>k.disabled=r().loading||!e(h)),Pt(1,O,()=>ka),o(ae,O)},se=ae=>{var O=Ne(),re=xe(O);{var ge=ie=>{var k=hn(),T=a(k),fe=s(a(T),2);{var he=F=>{var v=bn();v.__click=()=>r().uiStates.overrideManagerEditMode=!0;var _=a(v);fs(_,{size:16}),t(v),o(F,v)};d(fe,F=>{n.isArchiveMode||F(he)})}var ee=s(fe,2);{var C=F=>{var v=gn(),_=a(v),q=s(_);_s(q,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),t(v),b(()=>f(_,`${e(l).comment??""} `)),o(F,v)};d(ee,F=>{e(l).comment&&F(C)})}t(T);var j=s(T,2),_e=a(j),S=a(_e,!0);t(_e),t(j),t(k),b(()=>f(S,e(c))),o(ie,k)},te=ie=>{var k=Ne(),T=xe(k);{var fe=he=>{var ee=xn(),C=a(ee);C.__click=()=>r().uiStates.overrideManagerEditMode=!0;var j=s(a(C));ht(j,{size:16}),t(C),t(ee),o(he,ee)};d(T,he=>{n.isArchiveMode||he(fe)},!0)}o(ie,k)};d(re,ie=>{e(c)&&e(l)?ie(ge):ie(te,!1)})}o(ae,O)};d(pe,ae=>{e(p)?ae(R):ae(se,!1)})}t(w),b(()=>{f(H,`${r().product.nbRecipes??""} `),f(J,`${r().product.totalAssiettes??""} `),f(le,r().product.displayTotalNeeded)}),o(x,w)};d(X,x=>{r().product&&x(Y)})}o(ne,U),Qe()}at(["click"]);var kn=i('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),Sn=i('<span class="text-base-content/70"> </span>'),Pn=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-primary text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),Mn=i('<div class="mt-4 space-y-3"></div>'),qn=i('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function Cn(ne,n){Re(n,!0);const r=Q(()=>n.modalState.recipes);function l(I,h){return!I||!h?"-":la(I,h)}var c=qn(),D=xe(c);wn(D,{get modalState(){return n.modalState},get isArchiveMode(){return n.isArchiveMode}});var p=s(D,2),K=s(a(p),2),V=a(K);ma(V,{class:"h-5 w-5"}),Ie(),t(K);var N=s(K,2);{var z=I=>{var h=kn(),M=a(h);Sa(M,{class:"mx-auto mb-2 h-12 w-12"}),Ie(2),t(h),o(I,h)},oe=I=>{var h=Mn();We(h,21,()=>e(r),yt,(M,L)=>{const U=Q(()=>l(e(L).q,e(L).u)),X=Q(()=>l(e(L).qEq,e(L).uEq));var Y=Pn(),x=a(Y),w=a(x),g=a(w),B=a(g),Z=a(B,!0);t(B);var W=s(B,2),ue=a(W),H=s(ue);{var de=O=>{Ca(O,{class:"h-4 w-4 text-amber-500"})},ve=O=>{var re=Ne(),ge=xe(re);{var te=k=>{Da(k,{class:"h-4 w-4 text-indigo-500"})},ie=k=>{var T=Ne(),fe=xe(T);{var he=ee=>{Aa(ee,{class:"h-4 w-4 text-sky-500"})};d(fe,ee=>{St(e(L).dateTimeService)==="cloud"&&ee(he)},!0)}o(k,T)};d(ge,k=>{St(e(L).dateTimeService)==="moon"?k(te):k(ie,!1)},!0)}o(O,re)};d(H,O=>{St(e(L).dateTimeService)==="sun"?O(de):O(ve,!1)})}t(W),t(g);var J=s(g,2),me=a(J),be=a(me);Ma(be,{class:" me-1 h-3 w-3 stroke-2"});var le=s(be);t(me);var pe=s(me,2),R=a(pe,!0);t(pe);var se=s(pe,2);{var ae=O=>{var re=Sn(),ge=a(re);t(re),b(te=>f(ge,`(${te??""})`),[()=>l(e(L).q,e(L).u)]),o(O,re)};d(se,O=>{e(U)!==e(X)&&O(ae)})}t(J),t(w),t(x),t(Y),b((O,re,ge)=>{f(Z,e(L).r),f(ue,`${O??""} - ${re??""} `),f(le,` ${(e(L).a||0)??""} c.`),f(R,ge)},[()=>gt(e(L).date),()=>Ls(e(L).date),()=>l(e(L).qEq,e(L).uEq)]),o(M,Y)}),t(h),o(I,h)};d(N,I=>{e(r).length===0?I(z):I(oe,!1)})}t(p),o(ne,c),Qe()}var Dn=i('<div class="alert alert-warning border-warning/20 m-4 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),An=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Tn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),In=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),En=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),On=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),$n=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),zn=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),jn=i('<span class="badge badge-sm badge-secondary ml-1">1</span>'),Nn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Fn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Ln=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Bn=i('<div class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Rn=i("<!> <div><!></div>",1),Qn=i('<span class="loading loading-spinner loading-sm"></span>'),Vn=i("<!> Tout enregistrer",1),Un=i('<button class="btn btn-primary"><!></button>'),Gn=i('<button class="btn btn-ghost"> </button> <!>',1),Wn=i('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Hn(ne,n){Re(n,!0);let r=Ae(n,"initialTab",3,"recettes"),l=qe(null);ft(()=>{$(l,new hr(n.productId,r()),!0)});let c=Q(()=>A.isEventPassed),D=Q(()=>e(l)===null||e(l).product===null);function p(z){e(l)?.setCurrentTab(z)}function K(){e(l)?.saveAllChanges().then(()=>{e(l)?.resetForms(),n.onClose()})}function V(){e(l)?.resetForms(),n.onClose()}let N=Q(()=>e(l)?.hasAnyChanges??!1);{let z=Q(()=>!!n.productId);Mt(ne,{get isOpen(){return e(z)},onClose:V,get hasUnsavedChanges(){return e(N)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(oe,I)=>{var h=Ne(),M=xe(h);{var L=X=>{wt(X,{title:"Chargement...",showBackButton:!0,onClose:V})},U=X=>{var Y=Wn(),x=xe(Y);{let S=Q(()=>e(l)?.product?.productName||"Produit");wt(x,{get title(){return e(S)},showBackButton:!0,onClose:V})}var w=s(x,2);{var g=S=>{var F=Dn(),v=a(F);Pa(v,{class:"h-4 w-4"}),Ie(4),t(F),o(S,F)};d(w,S=>{e(c)&&S(g)})}var B=s(w,2),Z=a(B),W=a(Z);W.__click=()=>p("recettes");var ue=a(W);ma(ue,{class:"mr-1 h-4 w-4"});var H=s(ue,4);{var de=S=>{var F=An(),v=a(F,!0);t(F),b(()=>f(v,e(l).product.nbRecipes)),o(S,F)},ve=S=>{var F=Tn();o(S,F)};d(H,S=>{e(l)?.product?.nbRecipes&&e(l).product.nbRecipes>0?S(de):S(ve,!1)})}t(W);var J=s(W,2);J.__click=()=>p("magasins");var me=a(J);vt(me,{class:"mr-1 h-4 w-4"});var be=s(me,4);{var le=S=>{var F=In();o(S,F)};d(be,S=>{e(l)?.hasChanges?.store&&S(le)})}t(J);var pe=s(J,2);pe.__click=()=>p("volontaires");var R=a(pe);$t(R,{class:"mr-1 h-4 w-4"});var se=s(R,4);{var ae=S=>{var F=En();o(S,F)},O=S=>{var F=Ne(),v=xe(F);{var _=P=>{var G=On(),ye=a(G,!0);t(G),b(()=>f(ye,e(l).product.who.length)),o(P,G)},q=P=>{var G=$n();o(P,G)};d(v,P=>{e(l)?.product?.who&&e(l).product.who.length>0?P(_):P(q,!1)},!0)}o(S,F)};d(se,S=>{e(l)?.hasChanges?.who?S(ae):S(O,!1)})}t(pe);var re=s(pe,2);re.__click=()=>p("stock");var ge=a(re);Ga(ge,{class:"mr-1 h-4 w-4"});var te=s(ge,4);{var ie=S=>{var F=zn();o(S,F)},k=S=>{var F=Ne(),v=xe(F);{var _=P=>{var G=jn();o(P,G)},q=P=>{var G=Nn();o(P,G)};d(v,P=>{e(l)?.stockParsed?P(_):P(q,!1)},!0)}o(S,F)};d(te,S=>{e(l)?.hasChanges?.stock?S(ie):S(k,!1)})}t(re);var T=s(re,2);T.__click=()=>p("achats");var fe=a(T);xt(fe,{class:"mr-1 h-4 w-4"});var he=s(fe,4);{var ee=S=>{var F=Fn(),v=a(F,!0);t(F),b(()=>f(v,e(l).purchasesList.length)),o(S,F)},C=S=>{var F=Ln();o(S,F)};d(he,S=>{e(l)?.purchasesList&&e(l).purchasesList.length>0?S(ee):S(C,!1)})}t(T),t(Z),t(B);var j=s(B,2);qt(j,{children:(S,F)=>{var v=Rn(),_=xe(v);{var q=ye=>{var ke=Bn(),u=a(ke);ua(u,{class:"h-4 w-4"});var m=s(u,2),y=a(m);t(m),t(ke),b(()=>f(y,`Erreur : ${e(l).error??""}`)),o(ye,ke)};d(_,ye=>{e(l)?.error&&ye(q)})}var P=s(_,2),G=a(P);Ds(G,()=>e(l)?.currentTab,ye=>{var ke=Ne(),u=xe(ke);{var m=E=>{Cn(E,{get modalState(){return e(l)},get isArchiveMode(){return e(c)}})},y=E=>{var ce=Ne(),Se=xe(ce);{var we=Me=>{Wr(Me,{get modalState(){return e(l)},get isArchiveMode(){return e(c)}})},Pe=Me=>{var Be=Ne(),Ze=xe(Be);{var st=Ve=>{rn(Ve,{get modalState(){return e(l)},get isArchiveMode(){return e(c)}})},Fe=Ve=>{var nt=Ne(),He=xe(nt);{var $e=Te=>{ln(Te,{get modalState(){return e(l)},get isArchiveMode(){return e(c)}})},je=Te=>{var Ue=Ne(),Je=xe(Ue);{var it=De=>{cn(De,{get modalState(){return e(l)},get isArchiveMode(){return e(c)}})};d(Je,De=>{e(l)?.currentTab==="magasins"&&De(it)},!0)}o(Te,Ue)};d(He,Te=>{e(l)?.currentTab==="volontaires"?Te($e):Te(je,!1)},!0)}o(Ve,nt)};d(Ze,Ve=>{e(l)?.currentTab==="stock"?Ve(st):Ve(Fe,!1)},!0)}o(Me,Be)};d(Se,Me=>{e(l)?.currentTab==="achats"?Me(we):Me(Pe,!1)},!0)}o(E,ce)};d(u,E=>{e(l)?.currentTab==="recettes"?E(m):E(y,!1)})}o(ye,ke)}),t(P),o(S,v)}});var _e=s(j,2);_a(_e,{children:(S,F)=>{var v=Gn(),_=xe(v);_.__click=V;var q=a(_,!0);t(_);var P=s(_,2);{var G=ye=>{var ke=Un();ke.__click=K;var u=a(ke);{var m=E=>{var ce=Qn();o(E,ce)},y=E=>{var ce=Vn(),Se=xe(ce);pa(Se,{class:"h-4 w-4"}),Ie(),o(E,ce)};d(u,E=>{e(l).loading?E(m):E(y,!1)})}t(ke),b(()=>ke.disabled=e(l).loading),o(ye,ke)};d(P,ye=>{e(l)?.hasAnyChanges&&ye(G)})}b(()=>f(q,e(l)?.hasAnyChanges?"Annuler":"Fermer")),o(S,v)}}),b(()=>{Ce(W,1,`tab ${e(l)?.currentTab==="recettes"?"tab-active":""}`),Ce(J,1,`tab ${e(l)?.currentTab==="magasins"?"tab-active":""}`),Ce(pe,1,`tab ${e(l)?.currentTab==="volontaires"?"tab-active":""}`),Ce(re,1,`tab ${e(l)?.currentTab==="stock"?"tab-active":""}`),Ce(T,1,`tab ${e(l)?.currentTab==="achats"?"tab-active":""}`)}),o(X,Y)};d(M,X=>{e(D)?X(L):X(U,!1)})}o(oe,h)},$$slots:{default:!0}})}Qe()}at(["click"]);var Jn=i("<button><span> </span> <!></button>"),Kn=i('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),Xn=i('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),Yn=i('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function Zn(ne,n){Re(n,!0);let r=Q(()=>n.dateStore.start),l=Q(()=>n.dateStore.end),c=qe(null);function D(h){e(r)&&new Date(h)<new Date(e(r))?n.dateStore.setRange(h,e(l)):e(l)&&new Date(h)>new Date(e(l))?n.dateStore.setRange(e(r),h):n.dateStore.setRange(h,h)}function p(h){return!e(r)||!e(l)?{start:null,end:null}:e(r)&&new Date(h)<new Date(e(r))?{start:h,end:e(l)}:e(l)&&new Date(h)>new Date(e(l))?{start:e(r),end:h}:{start:h,end:h}}function K(h){let M="";if(!e(r)||!e(l))return;const L=new Date(h)>=new Date(e(r))&&new Date(h)<=new Date(e(l)),U=new Date(h);U.setHours(U.getHours()+As);const X=U<new Date;let Y=!1;if(e(c)){const x=p(e(c));x.start&&x.end&&(Y=new Date(h)>=new Date(x.start)&&new Date(h)<=new Date(x.end))}return X&&(M+=" opacity-70 italic"),L||(M+=" btn-dash"),Y&&!L&&(M+=" btn-soft"),M}var V=Yn(),N=xe(V);We(N,20,()=>n.dateStore.dates,h=>h,(h,M)=>{var L=Jn();L.__click=()=>D(M);var U=a(L),X=a(U,!0);t(U);var Y=s(U,2);{var x=g=>{Ca(g,{size:16})},w=g=>{var B=Ne(),Z=xe(B);{var W=H=>{Da(H,{size:16})},ue=H=>{var de=Ne(),ve=xe(de);{var J=me=>{Aa(me,{size:16})};d(ve,me=>{St(M)==="cloud"&&me(J)},!0)}o(H,de)};d(Z,H=>{St(M)==="moon"?H(W):H(ue,!1)},!0)}o(g,B)};d(Y,g=>{St(M)==="sun"?g(x):g(w,!1)})}t(L),b((g,B)=>{Ce(L,1,`btn btn-sm btn-secondary ${g??""}`),f(X,B)},[()=>K(M),()=>ta(M)]),Oe("mouseenter",L,()=>$(c,M,!0)),Oe("mouseleave",L,()=>$(c,null)),o(h,L)}),t(N);var z=s(N,2);{var oe=h=>{var M=Kn();o(h,M)},I=h=>{var M=Xn(),L=a(M);L.__click=()=>n.dateStore.selectUpcoming();var U=s(L,2);U.__click=()=>n.dateStore.selectAll(),t(M),b(()=>{Ce(L,1,`join-item btn btn-sm ${n.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),Ce(U,1,`join-item btn btn-sm ${n.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),o(h,M)};d(z,h=>{n.dateStore.isEventPassed?h(oe):h(I,!1)})}o(ne,V),Qe()}at(["click"]);var eo=i(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),to=i("<!> <!>",1),ao=i('<div class="alert alert-warning text-sm"><span>🔎 Les filtres sont désactivés pendant une recherche par nom.</span></div>'),so=i("<button><!> </button>"),ro=i('<button class="btn btn-sm btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),no=i('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),oo=i('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),io=i("<button> </button>"),lo=i('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),vo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),co=i("<button> </button>"),uo=i('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),mo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),po=i('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <!> <!> <div><div><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!></div></div>',1);function fo(ne,n){Re(n,!0);const r=Q(()=>A.filters),l=Q(()=>A.uniqueStores),c=Q(()=>A.uniqueWho),D=Q(()=>A.uniqueProductTypes),p=Q(()=>A.isSearchActive);var K=po(),V=xe(K),N=a(V),z=a(N);Ha(z,{class:"h-5 w-5"}),Ie(),t(N);var oe=s(N,2);oe.__click=()=>A.clearFilters();var I=a(oe);At(I,{class:"h-4 w-4"}),Ie(),t(oe),t(V);var h=s(V,2),M=a(h),L=s(a(M),2),U=a(L);bs(U,{class:"h-4 w-4"});var X=s(U,2);dt(X),X.__input=T=>A.setSearchQuery(T.currentTarget.value);var Y=s(X,2);Y.__click=()=>A.setSearchQuery("");var x=a(Y);ua(x,{class:"h-4 w-4"}),t(Y),t(L),t(M);var w=s(M,2);{var g=T=>{ia(T,{legend:"Date incluses",bgClass:"bg-base-100",children:(fe,he)=>{var ee=to(),C=xe(ee);Zn(C,{get dateStore(){return A.dateStore}});var j=s(C,2);{var _e=S=>{var F=eo();Pt(3,F,()=>ka),o(S,F)};d(j,S=>{A.hasPastDatesInRange&&S(_e)})}o(fe,ee)},$$slots:{default:!0}})};d(w,T=>{A.hasSingleDateEvent||T(g)})}var B=s(w,2);{var Z=T=>{var fe=ao();Pt(3,fe,()=>ka),o(T,fe)};d(B,T=>{e(p)&&T(Z)})}var W=s(B,2);let ue;var H=a(W);let de;var ve=s(a(H),2),J=a(ve);J.__click=()=>A.setCompletionStatus("all");var me=s(J,2);me.__click=()=>A.setCompletionStatus("incomplete");var be=s(me,2);be.__click=()=>A.setCompletionStatus("completed"),t(ve),t(H);var le=s(H,2),pe=s(a(le),2),R=a(pe);R.__click=()=>A.setGroupBy("none");var se=s(R,2);se.__click=()=>A.setGroupBy("store");var ae=s(se,2);ae.__click=()=>A.setGroupBy("productType"),t(pe),t(le);var O=s(le,2);{var re=T=>{ia(T,{legend:"Types & Température",get iconComponent(){return gs},children:(fe,he)=>{var ee=oo(),C=xe(ee);We(C,20,()=>e(D),y=>y,(y,E)=>{const ce=Q(()=>Ea(E));var Se=so();Se.__click=()=>A.toggleProductType(E);var we=a(Se);da(we,()=>e(ce).icon,(Me,Be)=>{Be(Me,{class:"mr-1 h-5 w-5"})});var Pe=s(we);t(Se),b(Me=>{Ce(Se,1,`btn btn-sm ${Me??""}`),f(Pe,` ${e(ce).displayName??""}`)},[()=>e(r).selectedProductTypes.length===0?"btn-soft btn-secondary":e(r).selectedProductTypes.includes(E)?"btn-secondary":"btn-dash btn-secondary"]),o(y,Se)}),t(C);var j=s(C,2),_e=a(j);_e.__click=()=>A.setTemperatureFilter("all");var S=s(_e,2);S.__click=()=>A.setTemperatureFilter("frais");var F=a(S);ya(F,{class:"h-4 w-4"}),Ie(),t(S);var v=s(S,2);v.__click=()=>A.setTemperatureFilter("not-frais");var _=a(v);ya(_,{class:"h-4 w-4"}),Ie(2),t(v);var q=s(v,2);q.__click=()=>A.setTemperatureFilter("surgele");var P=a(q);wa(P,{class:"h-4 w-4"}),Ie(),t(q);var G=s(q,2);G.__click=()=>A.setTemperatureFilter("not-surgele");var ye=a(G);wa(ye,{class:"h-4 w-4"}),Ie(2),t(G),t(j);var ke=s(j,2);{var u=y=>{var E=ro();E.__click=()=>A.clearTypeAndTemperatureFilters();var ce=a(E);At(ce,{size:16}),t(E),o(y,E)},m=y=>{var E=no();o(y,E)};d(ke,y=>{e(r).selectedProductTypes.length>0||e(r).selectedTemperatures.length>0||e(r).temperatureFilter!=="all"?y(u):y(m,!1)})}b(()=>{Ce(_e,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),Ce(S,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),Ce(v,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),Ce(q,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),Ce(G,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),Oe("mouseenter",_e,()=>Ee.msg="Ne pas filter en fonction des températures"),Oe("mouseleave",_e,()=>Ee.reset()),Oe("mouseenter",S,()=>Ee.msg="Afficher les produits frais uniquement"),Oe("mouseleave",S,()=>Ee.reset()),Oe("mouseenter",v,()=>Ee.msg="Exclure les produits frais"),Oe("mouseleave",v,()=>Ee.reset()),Oe("mouseenter",q,()=>Ee.msg="Afficher les produits surgelés uniquement"),Oe("mouseleave",q,()=>Ee.reset()),Oe("mouseenter",G,()=>Ee.msg="Exclure les produits surgelé"),Oe("mouseleave",G,()=>Ee.reset()),o(fe,ee)},$$slots:{default:!0}})};d(O,T=>{e(D).length>0&&T(re)})}var ge=s(O,2);{var te=T=>{ia(T,{legend:"Magasins",get iconComponent(){return vt},children:(fe,he)=>{var ee=vo(),C=a(ee);We(C,16,()=>e(l),S=>S,(S,F)=>{var v=io();v.__click=()=>A.toggleStore(F);var _=a(v,!0);t(v),b(q=>{Ce(v,1,`btn btn-sm ${q??""}`),f(_,F)},[()=>e(r).selectedStores.length===0?"btn-soft btn-secondary":e(r).selectedStores.includes(F)?"btn-secondary":"btn-dash btn-secondary"]),o(S,v)});var j=s(C,2);{var _e=S=>{var F=lo();F.__click=()=>A.clearStoreFilters();var v=a(F);At(v,{size:16}),t(F),o(S,F)};d(j,S=>{e(r).selectedStores.length>0&&S(_e)})}t(ee),o(fe,ee)},$$slots:{default:!0}})};d(ge,T=>{e(l).length>0&&T(te)})}var ie=s(ge,2);{var k=T=>{ia(T,{legend:"Qui",get iconComponent(){return ea},children:(fe,he)=>{var ee=mo(),C=a(ee);We(C,16,()=>e(c),S=>S,(S,F)=>{var v=co();v.__click=()=>A.toggleWho(F);var _=a(v,!0);t(v),b(q=>{Ce(v,1,`btn btn-sm ${q??""}`),f(_,F)},[()=>e(r).selectedWho.length===0?" btn-soft btn-secondary":e(r).selectedWho.includes(F)?" btn-secondary":"btn-dash btn-secondary"]),o(S,v)});var j=s(C,2);{var _e=S=>{var F=uo();F.__click=()=>A.clearWhoFilters();var v=a(F);At(v,{size:16}),t(F),o(S,F)};d(j,S=>{e(r).selectedWho.length>0&&S(_e)})}t(ee),o(fe,ee)},$$slots:{default:!0}})};d(ie,T=>{e(c).length>0&&T(k)})}t(W),t(h),b(()=>{oe.disabled=!A.hasFilters,Ts(X,e(r).searchQuery),Y.disabled=!e(r).searchQuery,ue=Ce(W,1,`space-y-4 ${e(p)?"pointer-events-none opacity-50":""}`,null,ue,{"transition-opacity":!0}),de=Ce(H,1,"flex flex-col",null,de,{"disabled-look":e(p)}),Ce(J,1,`btn flex-1 ${e(r).completionStatus==="all"&&"btn-primary"}`),Ce(me,1,`btn flex-1 ${e(r).completionStatus==="incomplete"&&"btn-warning"}`),Ce(be,1,`btn flex-1 ${e(r).completionStatus==="completed"&&"btn-success"}`),Ce(R,1,`btn flex-1 ${e(r).groupBy==="none"&&"btn-secondary"}`),Ce(se,1,`btn flex-1 ${e(r).groupBy==="store"&&"btn-secondary"}`),Ce(ae,1,`btn flex-1 ${e(r).groupBy==="productType"&&"btn-secondary"}`)}),o(ne,K),Qe()}at(["click","input"]);var _o=i('<div class="tooltip text-xs font-normal"><!></div>');function bo(ne,n){let r=Ae(n,"iconSize",3,24),l=n.icon||void 0;var c=_o(),D=a(c);{var p=K=>{l(K,{get size(){return r()},class:`align-top
`})};d(D,K=>{n.icon&&K(p)})}t(c),b(()=>fa(c,"data-tip",n.tip)),o(ne,c)}var go=i('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function Qa(ne,n){Re(n,!0);let r=Ae(n,"recipes",19,()=>[]);const l=n.dateDisplayInfo.timeIcon==="sun"?Ca:n.dateDisplayInfo.timeIcon==="moon"?Da:n.dateDisplayInfo.timeIcon==="cloud"?Aa:null;var c=go(),D=a(c),p=a(D),K=a(p,!0);t(p);var V=s(p,2);{var N=z=>{l(z,{class:"h-3 w-3 stroke-3"})};d(V,z=>{l&&z(N)})}t(D),t(c),b(z=>{fa(c,"data-tip",z),f(K,n.dateDisplayInfo.formattedDate)},[()=>r().map(z=>z.r).join(", ")]),o(ne,c),Qe()}var ho=rs("<title> </title>"),xo=rs("<svg><!><use></use></svg>");function yo(ne,n){let r=Ae(n,"size",3,24),l=Ae(n,"class",3,""),c=ts(n,["$$slots","$$events","$$legacy","name","size","title","class"]);var D=xo();es(D,()=>({width:r(),height:r(),class:l(),"aria-hidden":n.title?void 0:"true",...c}));var p=a(D);{var K=N=>{var z=ho(),oe=a(z,!0);t(z),b(()=>f(oe,n.title)),o(N,z)};d(p,N=>{n.title&&N(K)})}var V=s(p);t(D),b(()=>fa(V,"href",`/icons/sprite.svg#${n.name??""}`)),o(ne,D)}var wo=i('<div class="text-base-content/60 text-sm font-normal"> </div>'),ko=i('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),So=i('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),Po=i('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),Mo=i('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),qo=i('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),Co=i('<div class="ml-1"><!></div>'),Do=i('<div class="ml-1"> </div> <!>',1),Ao=i('<div class="ml-1 text-sm font-medium">?</div>'),To=i('<span class="text-base-content/50 text-xs"> </span>'),Io=i('<div class="ml-1 flex gap-1"> <!></div>'),Eo=i('<div class="ml-1 text-sm font-medium">?</div>'),Oo=i('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),$o=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),zo=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),jo=i('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),No=i('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),Fo=i('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),Lo=i("<span> </span>"),Bo=i('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),Ro=i('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),Qo=i(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle des
                besoins: <!> <!></span></div>`),Vo=i('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Uo=i('<span class="text-xs opacity-75"><!></span>'),Go=i('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Wo=i('<div class="text-base-content/50 text-xs italic">aucun</div>'),Ho=i('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-75 flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 group hover:ring-accent/60 relative flex flex-1 cursor-pointer flex-wrap items-center justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm hover:ring-2"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>');function Jo(ne,n){Re(n,!0);const r={Package:Sa,MessageCircleQuestionMark:xt,ShoppingCart:xt,Clock:Xa,CircleCheck:ws,CircleX:ys,ClipboardCheck:xs,PackageCheck:Ka,Check:pa},l=Q(()=>n.productModel.data),c=Q(()=>n.productModel.stats),D=Q(()=>Ea(e(l).productType)),p=Q(()=>Qs(e(l).purchases||[])),K=Q(()=>e(l).totalNeededOverrideParsed),V=Q(()=>ss(e(l)));var N=Ho(),z=a(N),oe=a(z),I=a(oe);I.__click=()=>n.onOpenModal(e(l).$id,"recettes"),I.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var h=a(I),M=a(h);da(M,()=>e(D).icon,(u,m)=>{m(u,{class:"h-4 w-4"})});var L=s(M),U=s(L);{var X=u=>{var m=wo(),y=a(m);t(m),b(()=>f(y,`Ancien: ${e(l).previousNames[0]??""}`)),o(u,m)};d(U,u=>{e(l).previousNames&&e(l).previousNames.length>0&&u(X)})}var Y=s(U,2);{var x=u=>{var m=ko(),y=a(m);za(y,{class:"text-warning h-4 w-4"}),t(m),o(u,m)};d(Y,u=>{e(l).productHugoUuid||u(x)})}t(h);var w=s(h,2),g=a(w);{var B=u=>{var m=So(),y=a(m);ya(y,{class:"text-success h-4 w-4"}),t(m),o(u,m)};d(g,u=>{e(l).pF&&u(B)})}var Z=s(g,2);{var W=u=>{var m=Po(),y=a(m);wa(y,{class:"text-info h-4 w-4"}),t(m),o(u,m)};d(Z,u=>{e(l).pS&&u(W)})}t(w);var ue=s(w,2);{var H=u=>{var m=Mo(),y=a(m);Ja(y,{class:"h-4 w-4 animate-spin"}),t(m),o(u,m)};d(ue,u=>{e(l).status==="isSyncing"&&u(H)})}var de=s(ue,2);{var ve=u=>{var m=qo(),y=a(m);We(y,20,()=>e(c).concernedDates,E=>E,(E,ce)=>{const Se=Q(()=>e(c).recipesByDate.get(ce)||[]),we=Q(()=>n.productModel.data.dateDisplayInfo[ce]||Ba(ce));Qa(E,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(y),t(m),o(u,m)};d(de,u=>{!Ge.isMobile&&e(c).concernedDates.length>0&&u(ve)})}t(I);var J=s(I,2);{var me=u=>{var m=Oo(),y=a(m);y.__click=()=>n.onOpenModal(e(l).$id,"magasins"),y.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"magasins");var E=a(y);vt(E,{size:18});var ce=s(E,2);{var Se=Fe=>{var Ve=Do(),nt=xe(Ve),He=a(nt,!0);t(nt);var $e=s(nt,2);{var je=Te=>{var Ue=Co(),Je=a(Ue);bo(Je,{get tip(){return e(l).storeInfo.storeComment},get icon(){return ks},iconSize:14}),t(Ue),o(Te,Ue)};d($e,Te=>{e(l).storeInfo?.storeComment&&Te(je)})}b(()=>f(He,e(l).storeInfo.storeName)),o(Fe,Ve)},we=Fe=>{var Ve=Ao();o(Fe,Ve)};d(ce,Fe=>{e(l).storeInfo?.storeName?Fe(Se):Fe(we,!1)})}t(y);var Pe=s(y,2);Pe.__click=()=>n.onOpenModal(e(l).$id,"volontaires"),Pe.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"volontaires");var Me=a(Pe);$t(Me,{size:18});var Be=s(Me,2);{var Ze=Fe=>{var Ve=Ne(),nt=xe(Ve);{var He=je=>{var Te=Io(),Ue=a(Te),Je=s(Ue);{var it=De=>{var Le=To(),Ke=a(Le);t(Le),b(()=>f(Ke,`+${e(l).who.length-2}`)),o(De,Le)};d(Je,De=>{e(l).who.length>2&&De(it)})}t(Te),b(De=>f(Ue,`${De??""}... `),[()=>e(l).who.slice(0,2).map(De=>De.slice(0,5)).join(" | ")]),o(je,Te)},$e=je=>{var Te=Ne(),Ue=xe(Te);{var Je=it=>{var De=tt();b(()=>f(De,e(l).who)),o(it,De)};d(Ue,it=>{e(l).who.length===1&&it(Je)},!0)}o(je,Te)};d(nt,je=>{e(l).who.length>1?je(He):je($e,!1)})}o(Fe,Ve)},st=Fe=>{var Ve=Eo();o(Fe,Ve)};d(Be,Fe=>{e(l).who&&e(l).who.length?Fe(Ze):Fe(st,!1)})}t(Pe),t(m),b(()=>{Ce(y,1,`btn btn-soft btn-xs sm:btn-sm group relative ${e(l).storeInfo?.storeName?"btn-success":""}`),Ce(Pe,1,`btn btn-xs sm:btn-sm btn-soft group relative ${e(l).who&&e(l).who?.length>0?"btn-success":""}`)}),Oe("mouseenter",y,()=>Ee.msg="Définissez le magasin où acheter le produit"),Oe("mouseleave",y,()=>Ee.reset()),Oe("mouseenter",Pe,()=>Ee.msg="Déclarez qui est responsable de l'achat de ce produit"),Oe("mouseleave",Pe,()=>Ee.reset()),o(u,m)},be=u=>{var m=jo(),y=a(m);{var E=we=>{var Pe=$o(),Me=a(Pe);vt(Me,{size:16});var Be=s(Me);t(Pe),b(()=>f(Be,` ${e(l).storeInfo.storeName??""}`)),o(we,Pe)};d(y,we=>{e(l).storeInfo?.storeName&&we(E)})}var ce=s(y,2);{var Se=we=>{var Pe=zo(),Me=a(Pe);$t(Me,{size:16});var Be=s(Me);t(Pe),b(Ze=>f(Be,` ${Ze??""}`),[()=>e(l).who.join(", ")]),o(we,Pe)};d(ce,we=>{e(l).who&&e(l).who.length>0&&we(Se)})}t(m),o(u,m)};d(J,u=>{n.shouldShowActionButtons?u(me):u(be,!1)})}t(oe);var le=s(oe,2);{var pe=u=>{var m=No(),y=a(m);We(y,20,()=>e(c).concernedDates,E=>E,(E,ce)=>{const Se=Q(()=>e(c).recipesByDate.get(ce)||[]),we=Q(()=>n.productModel.data.dateDisplayInfo[ce]||Ba(ce));Qa(E,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(y),t(m),o(u,m)};d(le,u=>{Ge.isMobile&&e(c).concernedDates.length>0&&u(pe)})}var R=s(le,2),se=a(R),ae=s(a(se),2);ae.__click=()=>n.onOpenModal(e(l).$id,"recettes"),ae.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var O=a(ae),re=a(O),ge=a(re);{var te=u=>{var m=Fo(),y=a(m),E=a(y,!0);t(y);var ce=s(y,2);za(ce,{class:"h-4 w-4"});var Se=s(ce);t(m),b(()=>{f(E,e(c).formattedQuantities),f(Se,` ${e(K).totalOverride.q??""}
                  ${e(K).totalOverride.u??""}`)}),o(u,m)},ie=u=>{var m=Lo(),y=a(m,!0);t(m),b(()=>f(y,e(c).formattedQuantities)),o(u,m)};d(ge,u=>{e(K)?.totalOverride?u(te):u(ie,!1)})}t(re);var k=s(re,2);{var T=u=>{var m=Bo(),y=a(m),E=a(y),ce=s(E);ma(ce,{class:"h-3 w-3"}),t(y);var Se=s(y,2),we=a(Se),Pe=s(we);Ma(Pe,{class:"h-3 w-3"}),t(Se),t(m),b(()=>{f(E,`${e(c).nbRecipes??""} `),f(we,`${e(c).totalAssiettes??""} `)}),o(u,m)};d(k,u=>{(e(c).nbRecipes||e(c).totalAssiettes)&&u(T)})}t(O);var fe=s(O,2);{var he=u=>{var m=Ro();m.__click=we=>{we.stopPropagation(),n.onQuickValidation(e(l),e(c))};var y=a(m),E=s(a(y));t(y);var ce=s(y,2),Se=a(ce);yo(Se,{name:"add-to-cart",size:16}),t(ce),t(m),b(()=>f(E,` ${e(c).formattedMissingQuantities??""}`)),Oe("mouseenter",m,()=>Ee.msg="Ajouter aux achats effectués"),Oe("mouseleave",m,()=>Ee.reset()),o(u,m)},ee=u=>{var m=Ne(),y=xe(m);{var E=ce=>{Ya(ce,{size:24,class:"text-success ms-auto"})};d(y,ce=>{n.shouldShowActionButtons&&ce(E)},!0)}o(u,m)};d(fe,u=>{n.shouldShowActionButtons&&e(c).hasMissing?u(he):u(ee,!1)})}var C=s(fe,2);{var j=u=>{var m=Qo(),y=a(m);qa(y,{size:18});var E=s(y,2),ce=s(a(E));{var Se=Me=>{var Be=tt();b(()=>f(Be,`${e(V).details?.oldPlates??""}→${e(V).details?.newPlates??""} couverts`)),o(Me,Be)};d(ce,Me=>{e(V).platesChanged&&Me(Se)})}var we=s(ce,2);{var Pe=Me=>{var Be=tt();b(()=>f(Be,`${e(V).details?.oldRecipes??""}→${e(V).details?.newRecipes??""}
                  recettes`)),o(Me,Be)};d(we,Me=>{e(V).recipesChanged&&Me(Pe)})}t(E),t(m),o(u,m)};d(C,u=>{n.shouldShowActionButtons&&e(V)?.hasMismatch&&u(j)})}t(ae),t(se);var _e=s(se,2),S=s(a(_e),2);S.__click=()=>n.onOpenModal(e(l).$id,"achats"),S.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"achats");var F=a(S);xt(F,{class:"h-4 w-4 opacity-60"});var v=s(F,2),_=s(v,2),q=a(_);{var P=u=>{var m=Vo(),y=a(m),E=a(y);hs(E,{class:"text-secondary h-4 w-4"});var ce=s(E,2),Se=a(ce);t(ce),t(y);var we=s(y,2),Pe=a(we);t(we),t(m),b(Me=>{f(Se,`${e(l).stockParsed.quantity??""}
                    ${e(l).stockParsed.unit??""}`),f(Pe,`stock: ${Me??""}`)},[()=>ta(e(l).stockParsed.dateTime)]),o(u,m)};d(q,u=>{e(l).stockParsed&&u(P)})}var G=s(q,2);We(G,17,()=>e(p),yt,(u,m)=>{const y=Q(()=>r[e(m).icon]);var E=Go(),ce=a(E),Se=a(ce);da(Se,()=>e(y),(Ze,st)=>{st(Ze,{class:"h-4 w-4"})});var we=s(Se,2),Pe=a(we);t(we),t(ce);var Me=s(ce,2);{var Be=Ze=>{var st=Uo(),Fe=a(st);{var Ve=He=>{var $e=tt();b(()=>f($e,`livré le: ${e(m).deliveryDate??""}`)),o(He,$e)},nt=He=>{var $e=tt("livraison ?");o(He,$e)};d(Fe,He=>{e(m).deliveryDate?He(Ve):He(nt,!1)})}t(st),o(Ze,st)};d(Me,Ze=>{e(m).status==="ordered"&&Ze(Be)})}t(E),b(()=>{Ce(E,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${e(m).badgeClass??""}`),f(Pe,`${e(m).quantity??""}
                    ${e(m).unit??""}`)}),o(u,E)});var ye=s(G,2);{var ke=u=>{var m=Wo();o(u,m)};d(ye,u=>{e(p).length===0&&!e(l)?.stockParsed&&u(ke)})}t(_),t(S),t(_e),t(R),t(z),t(N),b(()=>{Ce(N,1,`card bg-base-100 ${(Ge.isMobile&&"border-base-300 border shadow")??""} ${e(l).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),f(L,`${e(l).productName??""} `),Ce(re,1,`text-base font-bold ${e(c).hasMissing&&n.shouldShowActionButtons?"text-error":"text-success"}`),Ce(v,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${n.shouldShowActionButtons?"group-hover:block":"hidden"} sm:hidden`)}),Oe("mouseenter",I,()=>Ee.msg="Afficher les informations sur ce produit"),Oe("mouseleave",I,()=>Ee.reset()),Oe("mouseenter",ae,()=>Ee.msg="Afficher les informations sur ce produit"),Oe("mouseleave",ae,()=>Ee.reset()),Oe("mouseenter",S,()=>Ee.msg="Déclarez des achats effectués"),Oe("mouseleave",S,()=>Ee.reset()),Pt(3,N,()=>ns),o(ne,N),Qe()}at(["click","keydown"]);var Ko=i('<div class="text-primary-content flex items-center gap-2"><!> </div>'),Xo=i('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),Yo=i('<div class="font-semibold">Sur toute la période</div>'),Zo=i('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),ei=i('le <span class="font-semibold"> </span>',1),ti=i('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),ai=i('<span class="font-semibold"> </span>'),si=i('le <span class="font-semibold"> </span>',1),ri=i('<div class="text-primary-content"><!></div>'),ni=i(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),oi=i('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),ii=i('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),li=i('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),di=i('<div><!> <div class="mt-4 mb-8 space-y-4 sm:space-y-2"></div></div>'),vi=i('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),ci=i('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),ui=i('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),mi=i('<span class="block text-[9pt] font-normal opacity-60"> </span>'),pi=i('<div class="font-medium"> </div>'),fi=i('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),_i=i('<div class="font-medium"> </div>'),bi=i('<div class="text-[9pt] opacity-70"> </div>'),gi=i('<div class="flex gap-6"><!> <!></div>'),hi=i('<span class="text-xs opacity-70"> </span>'),xi=i('<div class="text-nowrap"> </div>'),yi=i('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),wi=i('<div class="text-nowrap"> </div>'),ki=i('<div class="flex flex-col items-end gap-0.5"></div>'),Si=i('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),Pi=i('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),Mi=i("<span>Aucune recette pour le moment</span>"),qi=i("<span>Aucun produit trouvé avec les filtres actuels</span>"),Ci=i('<div class="py-8 text-center"><div class="alert alert-info max-md:alert-vertical"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Di=i('<div><!> <div class="hidden w-full print:block"></div></div> <!>',1);function Ai(ne,n){Re(n,!0);let r=Ae(n,"disabled",3,!1);const l=Q(()=>A.groupedFilteredProducts),c=A.filters,D=gt(A.dateStore.start),p=gt(A.dateStore.end),K=Q(()=>!A.dateStore.isEventPassed&&!A.dateStore.hasPastDatesInRange),V=Q(()=>c.completionStatus==="completed"?"bg-emerald-800":c.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");let N=Ye([]),z=qe(Ye(new Map));ft(()=>{const X=Object.keys(e(l));N.forEach((Y,x)=>{if(!Y)return;const w=X[x];w&&Is(()=>Y,g=>{const B=g[0];if(!B)return;const Z=B.intersectionRatio>=.05;$(z,new Map(e(z)).set(w,Z),!0)},{threshold:[0,.05,1]})})});var oe=Di(),I=xe(oe),h=a(I);We(h,19,()=>Object.entries(e(l)),([X,Y])=>X,(X,Y,x)=>{var w=Q(()=>va(e(Y),2));let g=()=>e(w)[0];const Z=Q(()=>e(w)[1]);var W=di(),ue=a(W);{var H=ve=>{const J=Q(()=>Ea(g())),me=Q(()=>e(z).get(g())??!0);var be=li(),le=a(be),pe=a(le);{var R=k=>{var T=Ko(),fe=a(T);vt(fe,{class:"size-4 md:size-5"});var he=s(fe);t(T),b(()=>f(he,` ${g()??""} (${e(Z).length??""})`)),o(k,T)},se=k=>{var T=Ne(),fe=xe(T);{var he=C=>{var j=Xo(),_e=a(j);da(_e,()=>e(J).icon,(q,P)=>{P(q,{class:"size-4 md:size-5"})});var S=s(_e,2),F=a(S,!0);t(S);var v=s(S,2),_=a(v);t(v),t(j),b(()=>{f(F,e(J).displayName),f(_,`(${e(Z).length??""})`)}),o(C,j)},ee=C=>{var j=tt();b(()=>f(j,`📦 ${g()??""} (${e(Z).length??""})`)),o(C,j)};d(fe,C=>{c.groupBy==="productType"?C(he):C(ee,!1)},!0)}o(k,T)};d(pe,k=>{c.groupBy==="store"?k(R):k(se,!1)})}t(le);var ae=s(le,2);{var O=k=>{var T=ti(),fe=a(T);{var he=C=>{var j=Yo();o(C,j)},ee=C=>{var j=Ne(),_e=xe(j);{var S=v=>{var _=Zo(),q=s(xe(_)),P=a(q,!0);t(q);var G=s(q,2),ye=a(G,!0);t(G),b((ke,u)=>{f(P,ke),f(ye,u)},[()=>kt(A.dateStore.start),()=>kt(A.dateStore.end)]),o(v,_)},F=v=>{var _=ei(),q=s(xe(_)),P=a(q,!0);t(q),b(G=>f(P,G),[()=>kt(A.dateStore.start)]),o(v,_)};d(_e,v=>{A.dateStore.start!==A.dateStore.end?v(S):v(F,!1)},!0)}o(C,j)};d(fe,C=>{A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?C(he):C(ee,!1)})}t(T),o(k,T)},re=k=>{var T=ri(),fe=a(T);{var he=C=>{var j=ai(),_e=a(j);t(j),b((S,F)=>f(_e,`${S??""} → ${F??""}`),[()=>kt(A.dateStore.start),()=>kt(A.dateStore.end)]),o(C,j)},ee=C=>{var j=si(),_e=s(xe(j)),S=a(_e,!0);t(_e),b(F=>f(S,F),[()=>kt(A.dateStore.start,!0)]),o(C,j)};d(fe,C=>{!A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?C(he):C(ee,!1)})}t(T),o(k,T)};d(ae,k=>{Ge.isMobile?k(re,!1):k(O)})}var ge=s(ae,2);{var te=k=>{var T=oi(),fe=a(T);fe.__click=()=>n.onOpenGroupEditModal("store",e(Z).map(v=>v.data.$id),e(Z).map(v=>v.data));var he=a(fe);vt(he,{size:16});var ee=s(he,4);ht(ee,{size:16}),t(fe);var C=s(fe,2);C.__click=()=>n.onOpenGroupEditModal("who",e(Z).map(v=>v.data.$id),e(Z).map(v=>v.data));var j=a(C);$t(j,{size:16});var _e=s(j,4);ht(_e,{size:16}),t(C);var S=s(C,2);{var F=v=>{var _=ni();_.__click=()=>n.onOpenGroupPurchaseModal(e(Z).map(G=>G.data));var q=a(_);xt(q,{size:16});var P=s(q,4);Ya(P,{size:16}),t(_),Oe("mouseenter",_,()=>Ee.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),Oe("mouseleave",_,()=>Ee.reset()),o(v,_)};d(S,v=>{e(Z).some(_=>_.data.displayMissingQuantity!=="✅ Complet")&&v(F)})}t(T),Oe("mouseenter",fe,()=>Ee.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),Oe("mouseleave",fe,()=>Ee.reset()),Oe("mouseenter",C,()=>Ee.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),Oe("mouseleave",C,()=>Ee.reset()),o(k,T)},ie=k=>{var T=Ne(),fe=xe(T);{var he=ee=>{var C=ii(),j=a(C),_e=a(j);Xa(_e,{size:16}),Ie(2),t(j),t(C),o(ee,C)};d(fe,ee=>{A.dateStore.hasPastDatesInRange&&ee(he)},!0)}o(k,T)};d(ge,k=>{e(K)?k(te):k(ie,!1)})}t(be),b(()=>Ce(be,1,`${e(V)??""} @container sticky ${Ge.isMobile?Ge.headerVisible?"top-12":"top-0":"top-13 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md transition-all duration-300 @md:flex-nowrap print:shadow-none ${e(me)?"opacity-100":"pointer-events-none opacity-0"}`)),o(ve,be)};d(ue,ve=>{g()!==""&&ve(H)})}var de=s(ue,2);We(de,21,()=>e(Z),ve=>ve.data.$id,(ve,J)=>{Jo(ve,{get productModel(){return e(J)},get shouldShowActionButtons(){return e(K)},get onOpenModal(){return n.onOpenModal},get onQuickValidation(){return n.onQuickValidation}})}),t(de),t(W),Es(W,(ve,J)=>N[J]=ve,ve=>N?.[ve],()=>[e(x)]),Pt(3,de,()=>ns),o(X,W)});var M=s(h,2);We(M,21,()=>Object.entries(e(l)),([X,Y])=>X,(X,Y)=>{var x=Q(()=>va(e(Y),2));let w=()=>e(x)[0],g=()=>e(x)[1];var B=Pi(),Z=a(B);{var W=le=>{var pe=vi(),R=a(pe),se=a(R),ae=s(se),O=a(ae);t(ae);var re=s(ae,2),ge=a(re);{var te=k=>{var T=tt("Toute la période");o(k,T)},ie=k=>{var T=Ne(),fe=xe(T);{var he=C=>{var j=tt();b(()=>f(j,`du ${D??""} au ${p??""}`)),o(C,j)},ee=C=>{var j=tt();b(()=>f(j,`le ${D??""}`)),o(C,j)};d(fe,C=>{A.dateStore.start!==A.dateStore.end?C(he):C(ee,!1)},!0)}o(k,T)};d(ge,k=>{A.dateStore.isFullRange?k(te):k(ie,!1)})}t(re),t(R),t(pe),b(()=>{f(se,`${(w()==="Non défini"?"Groupe inconnu":w())??""} `),f(O,`(${g().length??""} produits)`)}),o(le,pe)};d(Z,le=>{w()!==""&&le(W)})}var ue=s(Z,2),H=a(ue),de=a(H),ve=s(a(de),3);{var J=le=>{var pe=ci();o(le,pe)},me=le=>{var pe=ui();o(le,pe)};d(ve,le=>{c.groupBy==="store"?le(J):le(me,!1)})}Ie(),t(de),t(H);var be=s(H);We(be,21,g,le=>le.data.$id,(le,pe)=>{const R=Q(()=>e(pe).data),se=Q(()=>e(pe).stats);var ae=Si(),O=s(a(ae)),re=a(O),ge=s(re);{var te=_=>{var q=mi(),P=a(q);t(q),b(()=>f(P,`(Ancien: ${e(R).previousNames[0]??""})`)),o(_,q)};d(ge,_=>{e(R).previousNames&&e(R).previousNames.length>0&&_(te)})}t(O);var ie=s(O),k=a(ie);{var T=_=>{var q=tt();b(()=>f(q,`${e(R).totalNeededOverrideParsed.totalOverride.q??""}
                    ${e(R).totalNeededOverrideParsed.totalOverride.u??""}`)),o(_,q)},fe=_=>{var q=tt();b(()=>f(q,e(se).formattedQuantities)),o(_,q)};d(k,_=>{e(R).totalNeededOverrideParsed?.totalOverride?_(T):_(fe,!1)})}t(ie);var he=s(ie),ee=a(he);{var C=_=>{var q=fi(),P=a(q);{var G=u=>{var m=pi(),y=a(m,!0);t(m),b(E=>f(y,E),[()=>e(R).who.join(", ")]),o(u,m)};d(P,u=>{e(R).who?.length&&u(G)})}var ye=s(P,2),ke=a(ye,!0);t(ye),t(q),b(()=>f(ke,e(R).productType||"Autre")),o(_,q)},j=_=>{var q=gi(),P=a(q);{var G=u=>{var m=_i(),y=a(m,!0);t(m),b(()=>f(y,e(R).storeInfo.storeName)),o(u,m)};d(P,u=>{e(R).storeInfo?.storeName&&u(G)})}var ye=s(P,2);{var ke=u=>{var m=bi(),y=a(m,!0);t(m),b(E=>f(y,E),[()=>e(R).who.join(", ")]),o(u,m)};d(ye,u=>{e(R).who?.length&&u(ke)})}t(q),o(_,q)};d(ee,_=>{c.groupBy==="store"?_(C):_(j,!1)})}t(he);var _e=s(he),S=a(_e);{var F=_=>{var q=yi(),P=a(q),G=a(P),ye=s(G);{var ke=y=>{var E=hi(),ce=a(E);t(E),b(Se=>f(ce,`(${Se??""})`),[()=>ta(e(R).stockParsed.dateTime)]),o(y,E)};d(ye,y=>{e(R).stockParsed?.dateTime&&y(ke)})}t(P);var u=s(P,2);{var m=y=>{var E=Ne(),ce=xe(E);We(ce,17,()=>e(R).purchases,yt,(Se,we)=>{var Pe=xi(),Me=a(Pe);t(Pe),b(()=>f(Me,`${e(we).quantity??""} ${e(we).unit??""}`)),o(Se,Pe)}),o(y,E)};d(u,y=>{e(R).purchases?.length&&y(m)})}t(q),b(()=>f(G,`📦 ${e(R).stockParsed.quantity??""} `)),o(_,q)},v=_=>{var q=Ne(),P=xe(q);{var G=ye=>{var ke=ki();We(ke,21,()=>e(R).purchases,yt,(u,m)=>{var y=wi(),E=a(y);t(y),b(()=>f(E,`${e(m).quantity??""} ${e(m).unit??""}`)),o(u,y)}),t(ke),o(ye,ke)};d(P,ye=>{e(R).purchases?.length&&ye(G)},!0)}o(_,q)};d(S,_=>{e(R).stockParsed?_(F):_(v,!1)})}t(_e),t(ae),b(()=>f(re,`${e(R).productName??""} `)),o(le,ae)}),t(be),t(ue),t(B),o(X,B)}),t(M),t(I);var L=s(I,2);{var U=X=>{var Y=Ci(),x=a(Y),w=s(a(x),2);{var g=Z=>{var W=Mi();o(Z,W)},B=Z=>{var W=qi();o(Z,W)};d(w,Z=>{n.currentEvent&&n.currentEvent.meals&&n.currentEvent.meals.length>0&&n.currentEvent.meals.every(W=>!W.recipes||W.recipes.length===0)?Z(g):Z(B,!1)})}t(x),t(Y),o(X,Y)};d(L,X=>{Object.values(e(l)).flat().length===0&&X(U)})}b(()=>Ce(I,1,`space-y-4 rounded-lg print:hidden ${r()?"pointer-events-none opacity-60":""}`)),o(ne,oe),Qe()}at(["click"]);var Ti=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Ii=i('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),Ei=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Oi=i("<!> ",1),$i=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),zi=i("<!> <!> <!>",1);function ji(ne,n){Re(n,!0);let r=qe(!1),l=qe(null),c=qe(null),D=qe(Ye(n.products.length>0&&n.products[0].storeInfo?n.products[0].storeInfo.storeName:"")),p=qe(Ye(n.products.length>0&&n.products[0].storeInfo&&n.products[0].storeInfo.storeComment||"")),K=qe(Ye({})),V=qe("empty");ft(()=>{const U={};n.products.forEach(X=>{n.productIds.includes(X.$id)&&(e(V)==="empty"?U[X.$id]=!X.storeInfo||!X.storeInfo.storeName:U[X.$id]=!0)}),$(K,U,!0)});const N=Q(()=>n.products.map(U=>({id:U.$id,label:U.productName,title:U.productName,selected:e(K)[U.$id]}))),z=Q(()=>e(N).filter(U=>U.selected)),oe=Q(()=>`Attribuer un magasin (${e(z).length} produits sélectionnés)`),I=Q(()=>e(z).length===0?!1:e(D).trim().length>0);async function h(){if(!e(I)||e(r))return;$(l,null),$(c,null);const U=e(z).map(x=>x.id),X=n.products.filter(x=>U.includes(x.$id));A.setSyncStatus(U,!0),Ge.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${U.length} produits)`,progress:0},n.onClose();const Y={storeName:e(D).trim(),storeComment:e(p).trim()};try{const x=await zt.track(A.batchUpdateProducts(U,X,"store",Y).then(w=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${w.success?"succès":"échec"}, ${w.updatedCount} produits modifiés`),!w.success)throw new Error(w.error||"Erreur lors de la mise à jour");return w}),{loading:`Mise à jour du magasin pour ${U.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});n.onSuccess?.(x)}catch(x){console.error("[StoreEditModal] Erreur mise à jour:",x),A.clearSyncStatus()}finally{$(r,!1),Ge.backgroundOperation={isRunning:!1,name:"",progress:0}}}function M(){e(r)||n.onClose()}function L(U){e(K)[U]=!e(K)[U]}Mt(ne,{isOpen:!0,onClose:M,children:(U,X)=>{var Y=zi(),x=xe(Y);wt(x,{get title(){return e(oe)},onClose:M,children:(B,Z)=>{vt(B,{class:"text-secondary"})},$$slots:{default:!0}});var w=s(x,2);qt(w,{children:(B,Z)=>{var W=Ii(),ue=a(W);{var H=O=>{var re=Ti(),ge=a(re);ca(ge,{class:"h-4 w-4"});var te=s(ge,2),ie=a(te,!0);t(te),t(re),b(()=>f(ie,e(l))),o(O,re)};d(ue,O=>{e(l)&&O(H)})}var de=s(ue,2),ve=a(de),J=a(ve);Ct(J,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},id:"store-name-input",get value(){return e(D)},set value(O){$(D,O,!0)}}),t(ve);var me=s(ve,2),be=a(me);Dt(be,{get disabled(){return e(r)},id:"store-comment-textarea",get value(){return e(p)},set value(O){$(p,O,!0)}}),t(me),t(de);var le=s(de,2),pe=s(a(le),2),R=a(pe);R.__click=()=>$(V,"empty");var se=s(R,2);se.__click=()=>$(V,"all"),t(pe);var ae=s(pe,2);jt(ae,{get items(){return e(N)},onToggleItem:L,size:"sm",color:"success"}),t(le),t(W),b(()=>{Ce(R,1,`tab ${e(V)==="empty"?"tab-active":""}`),Ce(se,1,`tab ${e(V)==="all"?"tab-active":""}`)}),o(B,W)}});var g=s(w,2);_a(g,{children:(B,Z)=>{var W=$i(),ue=xe(W);ue.__click=M;var H=s(ue,2);H.__click=h;var de=a(H);{var ve=me=>{var be=Ei();Ie(),o(me,be)},J=me=>{var be=Oi(),le=xe(be);pa(le,{class:"h-4 w-4"});var pe=s(le);b(()=>f(pe,` Appliquer à ${e(z).length??""} produit(s)`)),o(me,be)};d(de,me=>{e(r)?me(ve):me(J,!1)})}t(H),b(()=>{ue.disabled=e(r),H.disabled=e(r)||!e(I)}),o(B,W)}}),o(U,Y)},$$slots:{default:!0}}),Qe()}at(["click"]);var Ni=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Fi=i(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),Li=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Bi=i("<!> ",1),Ri=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Qi=i("<!> <!> <!>",1);function Vi(ne,n){Re(n,!0);let r=qe(!1),l=qe(null),c=qe(Ye([])),D=qe(""),p=qe("empty"),K=qe(Ye({}));ft(()=>{const x={};n.products.forEach(w=>{n.productIds.includes(w.$id)&&(e(p)==="empty"?x[w.$id]=!w.who||w.who.length===0:x[w.$id]=!0)}),$(K,x,!0)});const V=Q(()=>n.products.map(x=>({id:x.$id,label:x.productName,title:x.productName,selected:e(K)[x.$id]}))),N=Q(()=>e(V).filter(x=>x.selected)),z=Q(()=>{const x=new Set([...A.uniqueWho,...e(c)]);return Array.from(x).map(w=>({id:w,label:w,selected:e(c).includes(w)}))}),oe=Q(()=>`Gérer les volontaires (${e(N).length} produit${e(N).length>1?"s":""})`),I=Q(()=>e(N).length===0?!1:e(c).length>0);async function h(){if(!e(I)||e(r))return;$(l,null);const x=e(N).map(g=>g.id),w=n.products.filter(g=>x.includes(g.$id));A.setSyncStatus(x,!0),Ge.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${x.length} produits)`,progress:0},n.onClose();try{await zt.track(A.batchUpdateProducts(x,w,"who",{names:e(c)}).then(g=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${g.success?"succès":"échec"}, ${g.updatedCount} produits modifiés`),!g.success)throw new Error(g.error||"Erreur lors de la mise à jour");return A.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),n.onSuccess?.(g),g}),{loading:`Mise à jour des mandatés pour ${x.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(g){console.error("[WhoEditModal] Erreur mise à jour:",g),A.clearSyncStatus()}finally{$(r,!1),Ge.backgroundOperation={isRunning:!1,name:"",progress:0}}}function M(x){const w=x.trim();w&&!e(c).includes(w)&&$(c,[...e(c),w],!0)}function L(x){$(c,e(c).filter(w=>w!==x),!0)}function U(x){e(c).includes(x)?L(x):M(x)}function X(){e(D).trim()&&(M(e(D)),$(D,""))}function Y(x){e(K)[x]=!e(K)[x]}Mt(ne,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(x,w)=>{var g=Qi(),B=xe(g);wt(B,{get title(){return e(oe)},showBackButton:!0,get onClose(){return n.onClose}});var Z=s(B,2);qt(Z,{children:(ue,H)=>{var de=Fi(),ve=a(de);{var J=he=>{var ee=Ni(),C=a(ee);ca(C,{class:"h-4 w-4"});var j=s(C,2),_e=a(j,!0);t(j),t(ee),b(()=>f(_e,e(l))),o(he,ee)};d(ve,he=>{e(l)&&he(J)})}var me=s(ve,2),be=s(a(me),2),le=a(be),pe=a(le);aa(pe,{get disabled(){return e(r)},onkeydown:he=>{he.key==="Enter"&&(he.preventDefault(),X())},get value(){return e(D)},set value(he){$(D,he,!0)}}),t(le);var R=s(le,2);R.__click=X;var se=a(R);Wa(se,{size:16}),t(R),t(be);var ae=s(be,2),O=a(ae),re=s(O,2);jt(re,{get items(){return e(z)},onToggleItem:U,size:"lg",color:"info"}),t(ae),t(me);var ge=s(me,2),te=a(ge),ie=s(a(te),2),k=a(ie);k.__click=()=>$(p,"empty");var T=s(k,2);T.__click=()=>$(p,"all"),t(ie),t(te);var fe=s(te,2);jt(fe,{get items(){return e(V)},onToggleItem:Y,size:"sm",color:"success"}),t(ge),t(de),b(he=>{R.disabled=he,Ce(O,1,`text-base-content/70 mb-2 hidden text-sm ${(e(z).length&&"inline")??""}`),Ce(k,1,`btn btn-sm ${e(p)==="empty"&&"btn-secondary"}`),Ce(T,1,`btn btn-sm ${e(p)==="all"&&"btn-secondary"}`)},[()=>e(r)||!e(D).trim()]),o(ue,de)}});var W=s(Z,2);_a(W,{children:(ue,H)=>{var de=Ri(),ve=xe(de);ve.__click=function(...pe){n.onClose?.apply(this,pe)};var J=s(ve,2);J.__click=h;var me=a(J);{var be=pe=>{var R=Li();Ie(),o(pe,R)},le=pe=>{var R=Bi(),se=xe(R);pa(se,{class:"h-4 w-4"});var ae=s(se);b(()=>f(ae,` Appliquer à ${e(N).length??""} produit${e(N).length>1?"s":""}`)),o(pe,R)};d(me,pe=>{e(r)?pe(be):pe(le,!1)})}t(J),b(()=>{ve.disabled=e(r),J.disabled=e(r)||!e(I)}),o(ue,de)}}),o(x,g)},$$slots:{default:!0}}),Qe()}at(["click"]);var Ui=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Gi=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Wi=i('<button class="btn btn-primary btn-sm"><!> Ajouter une dépense</button>'),Hi=i('<span class="loading loading-spinner loading-xs"></span>'),Ji=i('<div class="text-error mt-2 text-xs"> </div>'),Ki=i('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),Xi=i('<span class="text-base-content/70 italic"> </span>'),Yi=i('<span class="text-base-content/50 ml-1 text-xs"> </span>'),Zi=i('<span class="font-medium"> </span> <!>',1),el=i('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),tl=i('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),al=i('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),sl=i('<div class="text-sm italic opacity-70"> </div>'),rl=i('<div class="text-xs opacity-60"> </div>'),nl=i('<div class="text-sm font-medium"> </div> <!>',1),ol=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),il=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),ll=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),dl=i('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),vl=i('<div class="space-y-3"><!> <!></div>'),cl=i('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),ul=i("<!> <!>",1);function ml(ne,n){Re(n,!0);let r=Ae(n,"isOpen",15,!1),l=qe(!1),c=qe(null),D=qe(!1),p=qe(Ye({invoiceTotal:0,store:"",notes:"",who:""})),K=qe(null);ft(()=>{if(r()&&!e(K)){const w=localStorage.getItem("appwrite-user-name");w&&(e(p).who=w)}});let V=qe("date"),N=qe("desc"),z=Q(()=>A.financialStats),oe=Q(()=>e(z).allPurchases),I=Q(()=>{let w=[...e(oe)];return w.sort((g,B)=>{let Z,W;switch(e(V)){case"date":Z=new Date(g.orderDate||g.$createdAt).getTime(),W=new Date(B.orderDate||B.$createdAt).getTime();break;case"amount":Z=g.invoiceTotal||g.price||0,W=B.invoiceTotal||B.price||0;break;case"store":Z=(g.store||"").toLowerCase(),W=(B.store||"").toLowerCase();break;case"who":Z=(g.who||"").toLowerCase(),W=(B.who||"").toLowerCase();break}return Z<W?e(N)==="asc"?-1:1:Z>W?e(N)==="asc"?1:-1:0}),w});function h(w){e(V)===w?$(N,e(N)==="asc"?"desc":"asc",!0):($(V,w,!0),$(N,"desc"))}async function M(){if(!e(p).invoiceTotal||e(p).invoiceTotal<=0){$(c,"Le montant doit être supérieur à 0");return}$(l,!0),$(c,null);try{const w=A.currentMainId;if(!w)throw new Error("Aucun événement principal actif");e(K)?await Os(e(K),{price:e(p).invoiceTotal,invoiceTotal:e(p).invoiceTotal,store:e(p).store,notes:e(p).notes,who:e(p).who}):await $s(w,void 0,e(p).invoiceTotal,e(p).store,e(p).notes,e(p).who),L()}catch(w){console.error("Erreur sauvegarde dépense:",w),$(c,w.message,!0)}finally{$(l,!1)}}function L(){const w=localStorage.getItem("appwrite-user-name")||"";$(p,{invoiceTotal:0,store:"",notes:"",who:w},!0),$(K,null),$(D,!1)}function U(w){$(p,{invoiceTotal:w.invoiceTotal||w.price||0,store:w.store||"",notes:w.notes||"",who:w.who||""},!0),$(K,w.$id,!0),$(D,!0)}function X(){r(!1),L(),$(c,null)}function Y(w){return w?new Date(w).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function x(w){return(w||0).toFixed(2)+" €"}Mt(ne,{get isOpen(){return r()},onClose:X,maxWidth:"lg",children:(w,g)=>{var B=ul(),Z=xe(B);wt(Z,{title:"Gestion des Dépenses",onClose:X});var W=s(Z,2);qt(W,{children:(ue,H)=>{var de=cl(),ve=a(de),J=a(ve),me=a(J),be=s(a(me),2),le=a(be,!0);t(be);var pe=s(be,2),R=a(pe);t(pe),t(me),t(J);var se=s(J,2),ae=s(a(se),2);We(ae,21,()=>Object.entries(e(z).byStore).sort((C,j)=>j[1]-C[1]),yt,(C,j)=>{var _e=Q(()=>va(e(j),2));let S=()=>e(_e)[0],F=()=>e(_e)[1];var v=Ui(),_=a(v),q=a(_,!0);t(_);var P=s(_,2),G=a(P,!0);t(P),t(v),b(ye=>{f(q,S()),f(G,ye)},[()=>x(F())]),o(C,v)}),t(ae),t(se);var O=s(se,2),re=s(a(O),2);We(re,21,()=>Object.entries(e(z).byWho).sort((C,j)=>j[1]-C[1]),yt,(C,j)=>{var _e=Q(()=>va(e(j),2));let S=()=>e(_e)[0],F=()=>e(_e)[1];var v=Gi(),_=a(v),q=a(_,!0);t(_);var P=s(_,2),G=a(P,!0);t(P),t(v),b(ye=>{f(q,S()),f(G,ye)},[()=>x(F())]),o(C,v)}),t(re),t(O),t(ve);var ge=s(ve,2),te=s(a(ge),2);{var ie=C=>{var j=Wi();j.__click=()=>$(D,!0);var _e=a(j);Tt(_e,{class:"mr-1 h-4 w-4"}),Ie(),t(j),o(C,j)};d(te,C=>{e(D)||C(ie)})}t(ge);var k=s(ge,2);{var T=C=>{var j=Ki(),_e=a(j),S=a(_e),F=a(S,!0);t(S);var v=s(S,2),_=a(v);Oa(_,{get disabled(){return e(l)},get value(){return e(p).invoiceTotal},set value(we){e(p).invoiceTotal=we}});var q=s(_,2);Ct(q,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(p).store},set value(we){e(p).store=we}});var P=s(q,2);aa(P,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(p).who},set value(we){e(p).who=we}});var G=s(P,2);Dt(G,{get disabled(){return e(l)},get value(){return e(p).notes},set value(we){e(p).notes=we}}),t(v);var ye=s(v,2),ke=a(ye);ke.__click=L;var u=s(ke,2);u.__click=M;var m=a(u);{var y=we=>{var Pe=Hi();o(we,Pe)};d(m,we=>{e(l)&&we(y)})}var E=s(m);t(u),t(ye);var ce=s(ye,2);{var Se=we=>{var Pe=Ji(),Me=a(Pe,!0);t(Pe),b(()=>f(Me,e(c))),o(we,Pe)};d(ce,we=>{e(c)&&we(Se)})}t(_e),t(j),b(()=>{f(F,e(K)?"Modifier la dépense":"Nouvelle Dépense"),u.disabled=e(l),f(E,` ${e(K)?"Enregistrer":"Ajouter"}`)}),o(C,j)};d(k,C=>{e(D)&&C(T)})}var fe=s(k,2);{var he=C=>{var j=al(),_e=a(j),S=a(_e),F=a(S),v=a(F);v.__click=()=>h("date");var _=a(v);t(v);var q=s(v,2);q.__click=()=>h("store");var P=a(q);t(q);var G=s(q);G.__click=()=>h("who");var ye=a(G);t(G);var ke=s(G);ke.__click=()=>h("amount");var u=a(ke);t(ke);var m=s(ke),y=a(m);Ss(y,{size:14}),t(m),t(F),t(S);var E=s(S),ce=a(E);We(ce,17,()=>e(I),Pe=>Pe.$id,(Pe,Me)=>{var Be=el(),Ze=a(Be),st=a(Ze,!0);t(Ze);var Fe=s(Ze),Ve=a(Fe);{var nt=et=>{var Xe=Xi(),ot=a(Xe,!0);t(Xe),b(()=>f(ot,e(Me).notes||"-")),o(et,Xe)},He=et=>{var Xe=Zi(),ot=xe(Xe),mt=a(ot,!0);t(ot);var _t=s(ot,2);{var bt=pt=>{var lt=Yi(),ct=a(lt);t(lt),b(()=>f(ct,`- ${e(Me).notes??""}`)),o(pt,lt)};d(_t,pt=>{e(Me).notes&&pt(bt)})}b(()=>f(mt,e(Me)._productName||"Produit inconnu")),o(et,Xe)};d(Ve,et=>{e(Me).status==="expense"?et(nt):et(He,!1)})}t(Fe);var $e=s(Fe),je=a($e,!0);t($e);var Te=s($e),Ue=a(Te,!0);t(Te);var Je=s(Te),it=a(Je,!0);t(Je);var De=s(Je),Le=a(De);Le.__click=()=>U(e(Me));var Ke=a(Le);ht(Ke,{size:14}),t(Le),t(De),t(Be),b((et,Xe)=>{f(st,et),f(je,e(Me).store||"-"),f(Ue,e(Me).who||"-"),f(it,Xe)},[()=>Y(e(Me).orderDate||e(Me).$createdAt),()=>x(e(Me).invoiceTotal||e(Me).price)]),o(Pe,Be)});var Se=s(ce);{var we=Pe=>{var Me=tl();o(Pe,Me)};d(Se,Pe=>{e(I).length===0&&Pe(we)})}t(E),t(_e),t(j),b(()=>{f(_,`Date ${e(V)==="date"?e(N)==="asc"?"↑":"↓":""}`),f(P,`Magasin ${e(V)==="store"?e(N)==="asc"?"↑":"↓":""}`),f(ye,`Qui ${e(V)==="who"?e(N)==="asc"?"↑":"↓":""}`),f(u,`Montant ${e(V)==="amount"?e(N)==="asc"?"↑":"↓":""}`)}),o(C,j)},ee=C=>{var j=vl(),_e=a(j);We(_e,17,()=>e(I),v=>v.$id,(v,_)=>{var q=ll(),P=a(q),G=a(P),ye=a(G),ke=a(ye),u=a(ke);Ot(u,{class:"h-3.5 w-3.5"});var m=s(u,2),y=a(m,!0);t(m),t(ke);var E=s(ke,2),ce=a(E,!0);t(E),t(ye);var Se=s(ye,2);Se.__click=()=>U(e(_));var we=a(Se);ht(we,{size:16}),t(Se),t(G);var Pe=s(G,2),Me=a(Pe);{var Be=$e=>{var je=sl(),Te=a(je,!0);t(je),b(()=>f(Te,e(_).notes)),o($e,je)},Ze=$e=>{var je=nl(),Te=xe(je),Ue=a(Te,!0);t(Te);var Je=s(Te,2);{var it=De=>{var Le=rl(),Ke=a(Le,!0);t(Le),b(()=>f(Ke,e(_).notes)),o(De,Le)};d(Je,De=>{e(_).notes&&De(it)})}b(()=>f(Ue,e(_)._productName||"Produit inconnu")),o($e,je)};d(Me,$e=>{e(_).status==="expense"&&e(_).notes?$e(Be):$e(Ze,!1)})}t(Pe);var st=s(Pe,2),Fe=a(st);{var Ve=$e=>{var je=ol(),Te=a(je);vt(Te,{class:"h-3 w-3"});var Ue=s(Te,2),Je=a(Ue,!0);t(Ue),t(je),b(()=>f(Je,e(_).store)),o($e,je)};d(Fe,$e=>{e(_).store&&$e(Ve)})}var nt=s(Fe,2);{var He=$e=>{var je=il(),Te=a(je);ea(Te,{class:"h-3 w-3"});var Ue=s(Te,2),Je=a(Ue,!0);t(Ue),t(je),b(()=>f(Je,e(_).who)),o($e,je)};d(nt,$e=>{e(_).who&&$e(He)})}t(st),t(P),t(q),b(($e,je)=>{f(y,$e),f(ce,je)},[()=>ta(e(_).orderDate||e(_).$createdAt),()=>x(e(_).invoiceTotal||e(_).price)]),o(v,q)});var S=s(_e,2);{var F=v=>{var _=dl(),q=a(_);Za(q,{class:"mx-auto mb-3 h-12 w-12"}),Ie(2),t(_),o(v,_)};d(S,v=>{e(I).length===0&&v(F)})}t(j),o(C,j)};d(fe,C=>{Ge.isMobile?C(ee,!1):C(he)})}t(de),b(C=>{f(le,C),f(R,`${e(oe).length??""} transactions`)},[()=>x(e(z).totalGlobal)]),o(ue,de)}}),o(w,B)},$$slots:{default:!0}}),Qe()}at(["click"]);var pl=i('<div class="fixed right-24 bottom-6 z-50 print:hidden"><div class="alert alert-soft bg-secondary/90 text-secondary-content flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg backdrop-blur-sm"><span class="max-w-32 truncate text-xs font-medium"> </span> <button class="btn btn-xs btn-circle btn-ghost" title="Effacer tous les filtres"><!></button></div></div>');function fl(ne,n){Re(n,!0);const r=Q(()=>A.activeFiltersDescription),l=Q(()=>e(r).length>0),c=Q(()=>e(r).length>2?`${e(r).slice(0,2).join(", ")}...`:e(r).join(", "));var D=Ne(),p=xe(D);{var K=V=>{var N=pl(),z=a(N),oe=a(z),I=a(oe,!0);t(oe);var h=s(oe,2);h.__click=()=>A.clearFilters();var M=a(h);At(M,{class:"size-4"}),t(h),t(z),t(N),b(()=>f(I,e(c))),Pt(3,N,()=>Bs,()=>({duration:200,start:.8})),o(V,N)};d(p,V=>{e(l)&&V(K)})}o(ne,D),Qe()}at(["click"]);var _l=i('<div class="flex gap-2"><button class="btn btn-primary" title="Ajouter un produit manuellement"><!> Produit</button></div>'),bl=i('<div class="flex min-h-96 items-center justify-center"><div class="flex flex-col items-center gap-4"><!> <p class="text-base-content/60 text-sm">Chargement des produits...</p></div></div>'),gl=i("<!> ",1),hl=i("<!> ",1),xl=i('<div class="flex-grow py-4 print:hidden"><!></div>'),yl=i(`<div class="alert alert-warning alert-soft max-sm:alert-vertical self-center" id="info-past-event"><!> Toutes les dates de cet événement sont passées. Il n'est plus possible
            de modifier les produits.</div>`),wl=i('<div class="card card-xs sm:card-sm border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div> <div class="card-action mt-auto"><button class="btn btn-primary btn-soft w-full" title="Ajouter un produit manuellement"><!> Produit</button></div></div></div>'),kl=i("grace au bouton en bas à gauche <!>",1),Sl=i(`<p>Cette page liste l'ensemble des produits présent dans les recettes de
        l'événement. La liste est <span class="font-semibold">mise à jour dès que les menus sont modifiés</span> (recettes ajoutées, supprimées, nombre de couvert modifié, etc.) Vous pouvez
        :</p> <ul class="svelte-1mshqfh"><li class="svelte-1mshqfh">Ajouter des produits non présent dans les recettes grace au bouton <kbd class="kbd kbd-sm">+ Produit</kbd> en haut à gauche</li> <li class="svelte-1mshqfh">Filtrer les produits par type, température, date, manquant etc. <!></li> <li class="svelte-1mshqfh">Déclarer des achats soit en cliquant dans la zone d'achat d'un
          produit, soit via le bouton <kbd class="kbd kbd-sm">manque ...</kbd> dans
          la colonne des besoins (déclare acheté la quantité manquante). Les achats
          peuvent être déclarés comme des 'commandes', et vous pouvez préciser la
          date de réception</li> <li class="svelte-1mshqfh">Déclarer tout un groupe de produit acheté via le bouton <kbd class="kbd kbd-sm">Achat groupé</kbd> dans l'entête de chaque groupe</li> <li class="svelte-1mshqfh">Définir des magasins ou vous mandater pour l'achat de produit
          (individuel ou par groupe) → <!> <!></li> <li class="svelte-1mshqfh">Modifier la quantité réclamée pour un produit. Si les recettes et
          menus sont modifié entre temps, la carte des besoin du produit
          indiquera que les quantités calculé ont changé depuis la modification
          manuelle des besoins déclarés pour ce produit. <p>Cela peut aussi servir a <span class="font-semibold">remplacer un produit par un autre</span> sans modifier les recettes</p></li> <li class="svelte-1mshqfh">Déclarer des dépenses indépendamment des achats (possible y compris
          après que l'événement soit fini)</li> <li class="svelte-1mshqfh">Visualiser l'ensemble des dépenses effectué, et par qui, en cliquant
          sur <kbd class="kbd">Dépenses</kbd> dans l'entête</li></ul> <p>Tous les membres des équipes ou individus invité à participer à
        l'événement peuvent modifier les produits, ajouter des achats, dépenses,
        etc.</p>`,1),Pl=i('<!> <div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><h1> </h1> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-center gap-10 md:justify-end"><!> <!> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow"><div class="card-body"><div class="card-title text-orange-800"><!> Dépenses</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <div class="card-action mt-auto"><button class="btn btn-soft btn-primary" title="Ajouter une dépense générale"><!> Voir, ajouter</button></div></div></div></div></div> <!> <!>',1),Ml=i('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),ql=i('<div class="flex items-center justify-center"><!></div>'),Cl=i('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),Dl=i("<!> <!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function Vl(ne,n){Re(n,!0);const r=v=>{var _=_l(),q=a(_);q.__click=J;var P=a(q);Tt(P,{class:"mr-1 h-4 w-4"}),Ie(),t(q),t(_),b(()=>q.disabled=!e(le)),o(v,_)},l="100";let c=qe(null),D=qe("recettes"),p=qe(!1),K=qe(!1),V=qe(Ye([])),N=qe(Ye([])),z=qe(!1),oe=qe(Ye([])),I=qe(!1),h=qe(!0),M=Ye(n.params?.id);const L=Q(()=>M?ra.getEventById(M):null),U=Q(()=>e(L)?.status==="local"?"/demo/event":"/dashboard/eventEdit"),X=Q(()=>e(L)?.name??""),Y=Q(()=>e(L)?.dateStart??null),x=Q(()=>e(L)?.dateEnd??null),w=Q(()=>e(x)&&new Date>new Date(e(x)));zs(async()=>{try{if(!M){console.error("[EventProductsPage] eventId est requis"),$(h,!1);return}if(await Ns(),!await Fs(M)){console.error(`[EventProductsPage] Événement ${M} introuvable`),$(h,!1);return}const _=ra.getEventById(M);console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${_?.name}`),await A.initialize(M)}catch(v){console.error("[EventProductsPage] Erreur lors de l'initialisation:",v)}finally{$(h,!1)}});function g(v,_="recettes"){$(D,_,!0),$(c,v,!0)}function B(){$(c,null)}function Z(v,_,q){$(V,_,!0),$(N,q,!0),v==="who"?$(p,!0):$(K,!0)}function W(v){(!v||v==="who")&&$(p,!1),(!v||v==="store")&&$(K,!1),$(V,[],!0),$(N,[],!0)}function ue(v){console.log(`[ProductsTable] Modification groupée réussie: ${v.updatedCount} produits`)}function H(v){const _=v.filter(q=>A.getProductModelById(q.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${v.length} produits reçus → ${_.length} produits avec quantités manquantes`),$(oe,_,!0),$(z,!0)}function de(){$(z,!1),$(oe,[],!0)}function ve(){console.log("[ProductsTable] Achat groupé créé avec succès"),de()}function J(){$(I,!0)}async function me(v,_){try{const q=_.missingQuantities||[];if(q.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const P=q.filter(G=>G.q<0).map(G=>({...G,q:Math.abs(G.q)})).map(G=>{const ye=Et.normalize(G.q,G.u);return{q:ye.quantity,u:ye.unit}});await A.createPurchase(v.$id,P,{store:v.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${v.productName}`)}catch(q){console.error("[ProductsTable] Erreur validation rapide:",q),alert("Erreur lors de la validation rapide: "+q.message)}}let be=qe(!1);const le=Q(()=>ra.canUserEditEvent(M||"",Ge.userId||""));async function pe(v){if(!(!M||!Ge.userId))try{$(h,!0);const _=v?"accepted":"declined";await ra.updateContributorStatus(M,Ge.userId,_),zt.success(v?"Invitation acceptée":"Invitation déclinée")}catch(_){console.error("Erreur réponse invitation:",_),zt.error("Erreur lors de la réponse")}finally{$(h,!1)}}ft(()=>{Ra.setConfig({eventId:M||void 0,basePath:e(U),actions:r})}),js(()=>{Ra.reset()});var R=Dl(),se=xe(R);Gs(se,{width:l,children:(v,_)=>{fo(v,{})},$$slots:{default:!0}});var ae=s(se,2);fl(ae,{});var O=s(ae,2),re=a(O);{var ge=v=>{var _=bl(),q=a(_),P=a(q);Ja(P,{class:"text-primary h-12 w-12 animate-spin"}),Ie(2),t(q),t(_),o(v,_)},te=v=>{var _=Pl(),q=xe(_);Us(q,{get currentEvent(){return e(L)},get isBusy(){return e(h)},onRespond:pe});var P=s(q,2),G=a(P),ye=a(G),ke=a(ye,!0);t(ye);var u=s(ye,2),m=a(u);{var y=De=>{var Le=gl(),Ke=xe(Le);Ot(Ke,{class:"inline h-4 w-4"});var et=s(Ke);b((Xe,ot)=>f(et,` ${Xe??""} au ${ot??""}`),[()=>xa(e(Y)),()=>xa(e(x))]),o(De,Le)},E=De=>{var Le=Ne(),Ke=xe(Le);{var et=Xe=>{var ot=hl(),mt=xe(ot);Ot(mt,{class:"inline h-4 w-4"});var _t=s(mt);b(bt=>f(_t,` ${bt??""}`),[()=>xa(e(Y))]),o(Xe,ot)};d(Ke,Xe=>{e(Y)&&Xe(et)},!0)}o(De,Le)};d(m,De=>{e(Y)&&e(x)?De(y):De(E,!1)})}t(u),t(G);var ce=s(G,2);{var Se=De=>{var Le=xl(),Ke=a(Le);Vs(Ke,{get currentEvent(){return e(L)}}),t(Le),o(De,Le)};d(ce,De=>{e(L)&&De(Se)})}var we=s(ce,2),Pe=a(we);{var Me=De=>{var Le=yl(),Ke=a(Le);qa(Ke,{size:20,class:"shrink-0"}),Ie(),t(Le),o(De,Le)};d(Pe,De=>{e(w)&&De(Me)})}var Be=s(Pe,2);{var Ze=De=>{var Le=wl(),Ke=a(Le),et=a(Ke),Xe=a(et);Ka(Xe,{class:"text-orange-800 opacity-60"}),Ie(),t(et);var ot=s(et,2),mt=a(ot),_t=a(mt),bt=a(_t,!0);t(_t),Ie(2),t(mt),t(ot);var pt=s(ot,2),lt=a(pt);lt.__click=J;var ct=a(lt);Tt(ct,{class:"mr-1 h-4 w-4"}),Ie(),t(lt),t(pt),t(Ke),t(Le),b(()=>{f(bt,A.completionStats.missing),lt.disabled=!e(le)}),Oe("mouseenter",lt,()=>Ee.msg="Ajouter un produit manuellement"),Oe("mouseleave",lt,()=>Ee.reset()),o(De,Le)};d(Be,De=>{e(w)||De(Ze)})}var st=s(Be,2),Fe=a(st),Ve=a(Fe),nt=a(Ve);Za(nt,{class:"text-orange-800 opacity-60"}),Ie(),t(Ve);var He=s(Ve,2),$e=a(He);t(He);var je=s(He,2),Te=a(je);Te.__click=()=>$(be,!0);var Ue=a(Te);Tt(Ue,{class:"size-4"}),Ie(),t(Te),t(je),t(Fe),t(st),t(we),t(P);var Je=s(P,2);Ia(Je,{title:"Aide",contentVisible:"Page de gestion des produits nécéssaire pour l'événement. Cliquer pour découvrir ce que vous pouvez y faire...",class:"shadow-info shadow",children:(De,Le)=>{var Ke=Sl(),et=s(xe(Ke),2),Xe=s(a(et),2),ot=s(a(Xe));{var mt=ct=>{var sa=kl(),is=s(xe(sa));Ha(is,{size:14}),o(ct,sa)},_t=ct=>{var sa=tt("grace au menu de droite");o(ct,sa)};d(ot,ct=>{Ge.isMobile?ct(mt):ct(_t,!1)})}t(Xe);var bt=s(Xe,6),pt=s(a(bt));vt(pt,{size:14,class:"text-primary inline"});var lt=s(pt,2);$t(lt,{size:14,class:"text-primary inline"}),t(bt),Ie(6),t(et),Ie(2),o(De,Ke)},$$slots:{default:!0}});var it=s(Je,2);{let De=Q(()=>!e(le));Ai(it,{get currentEvent(){return e(L)},onOpenModal:g,onOpenGroupEditModal:Z,onOpenGroupPurchaseModal:H,onQuickValidation:me,get disabled(){return e(De)}})}b(()=>{f(ke,e(X)),f($e,`${A.financialStats.totalGlobal??""} €`),Te.disabled=!e(le)}),Oe("mouseenter",Te,()=>Ee.msg="Consulter ou modifie le détail des dépenses"),Oe("mouseleave",Te,()=>Ee.reset()),o(v,_)};d(re,v=>{e(h)?v(ge):v(te,!1)})}var ie=s(re,2);{let v=Q(()=>e(c)||"");Hn(ie,{get productId(){return e(v)},get initialTab(){return e(D)},onClose:B})}var k=s(ie,2);{var T=v=>{Vi(v,{get productIds(){return e(V)},get products(){return e(N)},onClose:()=>W("who"),onSuccess:ue})};d(k,v=>{e(p)&&v(T)})}var fe=s(k,2);{var he=v=>{ji(v,{get productIds(){return e(V)},get products(){return e(N)},onClose:()=>W("store"),onSuccess:ue})};d(fe,v=>{e(K)&&v(he)})}var ee=s(fe,2);{var C=v=>{lr(v,{get products(){return e(oe)},onClose:de,onSuccess:ve})};d(ee,v=>{e(z)&&v(C)})}var j=s(ee,2);gr(j,{get open(){return e(I)},set open(v){$(I,v,!0)}});var _e=s(j,2);ml(_e,{get isOpen(){return e(be)},set isOpen(v){$(be,v,!0)}});var S=s(_e,2);{var F=v=>{var _=Cl(),q=a(_),P=a(q);{var G=ke=>{var u=Ml(),m=a(u);ja(m,{class:"me-2 size-5"});var y=s(m),E=s(y);E.__click=()=>Ee.collapse();var ce=a(E);ua(ce,{class:"h-4 w-4"}),t(E),t(u),b(()=>f(y,` ${Ee.msg??""} `)),o(ke,u)},ye=ke=>{var u=ql();u.__click=()=>Ee.expand();var m=a(u);ja(m,{class:"size-6"}),t(u),o(ke,u)};d(P,ke=>{Ee.isExpanded?ke(G):ke(ye,!1)})}t(q),t(_),b(()=>Ce(q,1,`rounded-tr-box bg-blue-100 text-blue-800 ${Ee.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),o(v,_)};d(S,v=>{Ge.isDesktop&&v(F)})}t(O),b(()=>Ce(O,1,`space-y-6 pt-6 md:px-16 ${(Ge.isDesktop&&"ml-110 print:ml-0")??""} `)),o(ne,R),Qe()}at(["click"]);export{Vl as default};
