var os=Object.defineProperty;var Ia=le=>{throw TypeError(le)};var is=(le,n,r)=>n in le?os(le,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):le[n]=r;var ga=(le,n,r)=>is(le,typeof n!="symbol"?n+"":n,r),ls=(le,n,r)=>n.has(le)||Ia("Cannot "+r);var Ne=(le,n,r)=>(ls(le,n,"read from private field"),r?r.call(le):n.get(le)),rt=(le,n,r)=>n.has(le)?Ia("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(le):n.set(le,r);import{au as vt,i as Yt,av as Ba,Q as da,aw as ht,ax as ya,K as ds,ay as wa,P as Dt,b as vs,az as gt,aA as cs,t as It,aB as Ra,X as va,T as us,aC as Qa,a2 as Va,a as ca,D as ka,n as Sa,aj as ms,aD as ps,ar as Pa,as as Ma,s as qa,U as Et,z as ua,w as Ua,F as ta,S as fs,aE as ha,O as xa,I as _s,aF as Ea,e as Ga,aG as gs,aH as Wa,aI as bs,C as hs,h as xs,ak as Ha,aJ as Ja,aK as ys,aL as ws,aM as Ka,a1 as Oa}from"./icons.js";import{d as Re,p as De,v as i,g as a,h as s,a as Xa,r as Ya,I as d,w as _,C as Ce,R as ut,b as o,c as Qe,m as e,u as G,o as t,B as nt,U as dt,L as ma,aq as ks,al as Za,z as Xe,y as Pe,H as mt,A as E,k as ye,a7 as A,x as p,G as We,M as Ot,K as Te,e as He,i as xt,Q as je,am as za,aH as Ss,aI as Ps,aJ as At,ap as Tt,aK as oa,S as at,j as Le,aL as $a,aM as Ms,aN as es,aO as Na,O as ts,aP as St,ax as qs,aQ as Cs,an as Ds,a6 as ia,aR as Oe,f as as,aS as ja,aT as As,P as Ts,t as la,aU as Is,aV as Es,Z as Os,$ as zs,aC as $s,aD as Ns,W as aa}from"./appwrite.js";import{b as _t,g as Zt,a as js,D as kt}from"./date-helpers.js";import{B as zt}from"./BtnGroupCheck.js";import{S as Ca,I as Da}from"./InfoCollapse.js";import{M as Pt,a as yt,b as Mt,c as pa,s as ss,n as Fa}from"./index.js";import{a as Fs,b as sa,c as ra,g as Aa,d as Ls,f as ba}from"./products-display.js";import{F as na}from"./Fieldset.js";import{E as Bs}from"./EventStats.js";import{E as Rs}from"./EventInvitationAlert.js";import{L as Qs}from"./LeftPanel.js";import"./CheckboxBadge.js";import"./event-stats-helpers.js";var Vs=i('<div><label class="input w-72"><!> <input/></label> <!></div>');function qt(le,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),C=De(n,"flexCol",3,!1),m=Ya(n,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const Y=G(()=>l().map(q=>({id:q,label:q,disabled:q===r()})));var W=Vs(),U=a(W),O=a(U);vt(O,{class:"h-4 w-4 opacity-50"});var fe=s(O,2);Xa(fe,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:v(),...m}),void 0,void 0,void 0,void 0,!0),t(U);var T=s(U,2);{var x=q=>{Ca(q,{get suggestions(){return e(Y)},onSuggestionClick:N=>r(N.label),buttonSize:"btn-xs"})};d(T,q=>{l().length>0&&q(x)})}t(W),_(()=>Ce(W,1,`flex ${C()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),ut(fe,r),o(le,W),Qe()}var Us=i('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function ea(le,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),C=De(n,"flexCol",3,!1);const m=G(()=>l().map(x=>({id:x,label:x,disabled:x===r()})));var Y=Us(),W=a(Y),U=a(W);Yt(U,{class:"h-4 w-4 opacity-50"});var O=s(U,2);dt(O),O.__keydown=function(...x){n.onkeydown?.apply(this,x)},t(W);var fe=s(W,2);{var T=x=>{Ca(x,{get suggestions(){return e(m)},onSuggestionClick:q=>r(q.label),buttonSize:"btn-xs"})};d(fe,x=>{l().length>0&&x(T)})}t(Y),_(()=>{Ce(Y,1,`flex ${C()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),O.disabled=v()}),ut(O,r),o(le,Y),Qe()}nt(["keydown"]);var Gs=i('<textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea>');function Ct(le,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Gs();ks(v),_(()=>{v.disabled=l(),ma(v,"id",n.id)}),ut(v,r),o(le,v),Qe()}var Ws=i('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function Ta(le,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Ws(),C=a(v);Ba(C,{class:"h-4 w-4 opacity-50"});var m=s(C,2);dt(m),t(v),_(()=>m.disabled=l()),ut(m,r),o(le,v),Qe()}var Hs=i('<label class="input w-fit"><span class="label">Date de livraison</span> <input type="date"/></label>'),Js=i(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function rs(le,n){Re(n,!0);let r=De(n,"status",15),l=De(n,"deliveryDate",15),v=De(n,"disabled",3,!1);var C=Js(),m=a(C),Y=a(m),W=a(Y);W.value=W.__value="delivered";var U=s(W);U.value=U.__value="ordered",t(Y);var O=s(Y,2);t(m);var fe=s(m,2);{var T=x=>{var q=Hs(),N=s(a(q),2);dt(N),t(q),_(()=>N.disabled=v()),ut(N,l),o(x,q)};d(fe,x=>{r()==="ordered"&&x(T)})}t(C),_(()=>{Y.disabled=v(),Ce(O,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),Za(Y,r),o(le,C),Qe()}var Ks=i('<div class="alert alert-error"><!> <span> </span></div>'),Xs=i(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),Ys=i('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),Zs=i('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),er=i(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),tr=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),ar=i('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),sr=i('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),rr=i("<!> <!> <!>",1);function nr(le,n){Re(n,!0);let r=Pe(!1),l=Pe(null),v=Xe({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),C=Pe(Xe(new Set));mt(()=>{E(C,new Set(n.products.map(T=>T.$id)),!0)});const m=G(()=>n.products.filter(T=>e(C).has(T.$id))),Y=G(()=>e(m).length!==0),W=G(()=>{const T=A.dateRange;let x="";return T?.start&&T?.end&&(T.start===T.end?x=` - ${_t(T.start)}`:x=` - Du ${_t(T.start)} au ${_t(T.end)}`),`Achat groupé (${e(m).length} produit${e(m).length>1?"s":""})${x}`});async function U(){if(!e(Y)||e(r))return;E(r,!0),E(l,null);const T=`FACTURE_${Date.now()}`,x=e(m).map(F=>F.$id);A.setSyncStatus(x,!0),We.backgroundOperation={isRunning:!0,name:`Achat groupé (${e(m).length} produits)`,progress:0};const q=[];for(const F of e(m)){const ne=(A.getProductModelById(F.$id)?.stats.missingQuantities||[]).filter(h=>h.q<0).map(h=>({q:Math.abs(h.q),u:h.u}));q.push({productId:F.$id,isSynced:F.isSynced,missingQuantities:ne})}const N={invoiceId:T,invoiceTotal:v.expense||void 0,store:v.store.trim()||void 0,notes:v.notes||`Achat groupé pour ${e(m).length} produits`,who:v.who.trim()||void 0,purchaseStatus:v.status||"delivered",purchaseDeliveryDate:v.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${q.length} produits...`),n.onClose();try{await Ot.track(A.createGroupPurchase(q,N).then(F=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${F.success?"succès":"échec"}, ${F.totalProductsCreated} produits synchronisés, ${F.totalPurchasesCreated} achats créés, ${F.totalExpensesCreated} dépenses globales`),!F.success)throw new Error(F.error||"Erreur lors de la création de l'achat groupé");return A.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),n.onSuccess?.(),F}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(F){console.error("[GroupPurchaseModal] Erreur création achat groupé:",F),A.clearSyncStatus()}finally{E(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function O(T){const x=new Set(e(C));x.has(T)?x.delete(T):x.add(T),E(C,x,!0)}const fe=G(()=>n.products.map(T=>{const x=A.getProductModelById(T.$id);return{id:T.$id,label:T.productName,title:`${T.productName} - Manque: ${x?.stats.formattedMissingQuantities||"-"}`,badge:x?.stats.formattedMissingQuantities||"-"}}));Pt(le,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(T,x)=>{var q=rr(),N=ye(q);yt(N,{get title(){return e(W)},showBackButton:!0,get onClose(){return n.onClose}});var F=s(N,2);Mt(F,{children:(ne,h)=>{var k=er(),f=a(k);{var L=M=>{var se=Ks(),ge=a(se);da(ge,{class:"h-4 w-4"});var j=s(ge,2),ee=a(j,!0);t(j),t(se),_(()=>p(ee,e(l))),o(M,se)};d(f,M=>{e(l)&&M(L)})}var ae=s(f,2),H=a(ae);Da(H,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:(M,se)=>{var ge=Xs();Te(2),o(M,ge)},$$slots:{default:!0}}),t(ae);var ce=s(ae,2),K=s(a(ce),2),de=a(K),ve=a(de);qt(ve,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},get value(){return v.store},set value(M){v.store=M}}),t(de);var X=s(de,2),pe=a(X);ea(pe,{get suggestions(){return A.uniqueWho},get disabled(){return e(r)},get value(){return v.who},set value(M){v.who=M}}),t(X),t(K);var be=s(K,2);Ta(be,{get disabled(){return e(r)},get value(){return v.expense},set value(M){v.expense=M}});var ue=s(be,2);rs(ue,{get disabled(){return e(r)},get status(){return v.status},set status(M){v.status=M},get deliveryDate(){return v.deliveryDate},set deliveryDate(M){v.deliveryDate=M}});var me=s(ue,2);Ct(me,{get disabled(){return e(r)},get value(){return v.notes},set value(M){v.notes=M}}),t(ce);var Q=s(ce,2);{var ie=M=>{var se=Ys(),ge=s(a(se),2),j=s(a(ge)),ee=a(j,!0);t(j);var y=s(j,2),$=a(y,!0);t(y),Te(),t(ge);var re=s(ge,2);zt(re,{get items(){return e(fe)},onToggleItem:O,size:"sm",color:"success"}),t(se),_((te,R)=>{p(ee,te),p($,R)},[()=>_t(A.dateRange.start),()=>_t(A.dateRange.end)]),o(M,se)},oe=M=>{var se=Zs();o(M,se)};d(Q,M=>{e(fe).length>0?M(ie):M(oe,!1)})}t(k),o(ne,k)}});var Z=s(F,2);pa(Z,{children:(ne,h)=>{var k=sr(),f=a(k);f.__click=function(...K){n.onClose?.apply(this,K)};var L=s(f,2);L.__click=U;var ae=a(L);{var H=K=>{var de=tr();Te(),o(K,de)},ce=K=>{var de=ar(),ve=ye(de);ht(ve,{class:"h-4 w-4"});var X=s(ve,2),pe=s(a(X)),be=a(pe);t(pe),t(X),_(()=>p(be,`${e(m).length??""} produit${e(m).length>1?"s":""}`)),o(K,de)};d(ae,K=>{e(r)?K(H):K(ce,!1)})}t(L),t(k),_(()=>{f.disabled=e(r),L.disabled=e(r)||!e(Y)}),o(ne,k)}}),o(T,q)},$$slots:{default:!0}}),Qe()}nt(["click"]);const or=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var ir=i("<option> </option>"),lr=i('<fieldset class="fieldset"><div class="flex gap-2"><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité" required/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end" required><option disabled selected>-</option><!></select></label></div></fieldset>');function fa(le,n){Re(n,!0);let r=De(n,"quantity",15),l=De(n,"unit",15),v=De(n,"disabled",3,!1);var C=lr(),m=a(C),Y=a(m),W=a(Y);ya(W,{class:"h-4 w-4 opacity-50"});var U=s(W,2);dt(U),t(Y);var O=s(Y,2),fe=s(a(O),2),T=a(fe);T.value=T.__value="";var x=s(T);He(x,17,()=>or,xt,(q,N)=>{let F=()=>e(N).value,Z=()=>e(N).label;var ne=ir(),h=a(ne,!0);t(ne);var k={};_(()=>{p(h,Z()),k!==(k=F())&&(ne.value=(ne.__value=F())??"")}),o(q,ne)}),t(fe),t(O),t(m),t(C),_(()=>{U.disabled=v(),fe.disabled=v()}),ut(U,r),Za(fe,l),o(le,C),Qe()}var dr=i('<div class="alert alert-error text-sm"><!> <span> </span></div>'),vr=i('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),cr=i('<span class="loading loading-spinner"></span>'),ur=i('<span class="loading loading-spinner"></span>'),mr=i('<form class="flex h-full flex-col space-y-4"><!> <!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),pr=i("<!> <!>",1);function fr(le,n){Re(n,!0);let r=De(n,"open",15,!1),l=Pe(!1),v=Pe(null),C=Pe(!1),m=Pe(Xe({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const Y=G(()=>e(m).productName.trim().length>0&&e(m).productType.trim().length>0),W=G(()=>A.uniqueProductTypes.map(T=>({id:T,label:T})));let U=G(()=>A.isEventPassed);async function O(T=!1){if(!(!e(Y)||e(l))){E(l,!0),E(v,null),E(C,!1);try{if(!A.currentMainId)throw new Error("Aucun événement principal sélectionné");const x={productName:e(m).productName.trim(),productType:e(m).productType.trim(),store:e(m).store.trim()?{storeName:e(m).store.trim()}:void 0,who:e(m).who.trim()?[e(m).who.trim()]:void 0,pF:e(m).pF,pS:e(m).pS,quantity:e(m).quantity?{q:e(m).quantity,u:e(m).unit.trim()||"pièces"}:void 0};await Ss(x,A.currentMainId),E(C,!0),T?(e(m).productName="",e(m).quantity=null,e(m).unit="",e(m).pF=!1,e(m).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),E(m,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(x){console.error("Error creating product:",x),E(v,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{E(l,!1)}}}function fe(){r(!1),E(m,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),E(v,null)}mt(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),Pt(le,{get isOpen(){return r()},onClose:fe,children:(T,x)=>{var q=pr(),N=ye(q);yt(N,{title:"Ajouter un produit",onClose:fe});var F=s(N,2);Mt(F,{children:(Z,ne)=>{var h=mr(),k=a(h);{var f=w=>{var J=dr(),_e=a(J);da(_e,{size:18});var he=s(_e,2),c=a(he,!0);t(he),t(J),_(()=>p(c,e(v))),o(w,J)};d(k,w=>{e(v)&&w(f)})}var L=s(k,2);{var ae=w=>{var J=vr(),_e=a(J);wa(_e,{class:"h-4 w-4"}),Te(4),t(J),o(w,J)};d(L,w=>{e(U)&&w(ae)})}var H=s(L,2),ce=a(H),K=a(ce),de=a(K),ve=a(de);ds(ve,{class:"text-base-content/50 h-5 w-5"});var X=s(ve,2);dt(X),t(de),t(K);var pe=s(K,2);fa(pe,{get disabled(){return e(l)},get quantity(){return e(m).quantity},set quantity(w){e(m).quantity=w},get unit(){return e(m).unit},set unit(w){e(m).unit=w}}),t(ce);var be=s(ce,2),ue=a(be),me=a(ue),Q=a(me);dt(Q),t(me);var ie=s(me,2);Ca(ie,{get suggestions(){return e(W)},onSuggestionClick:w=>e(m).productType=w.label,get disabled(){return e(l)}}),t(ue),t(be);var oe=s(be,2);qt(oe,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(m).store},set value(w){e(m).store=w}});var M=s(oe,2);ea(M,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(m).who},set value(w){e(m).who=w}});var se=s(M,2),ge=a(se),j=a(ge),ee=a(j);dt(ee),Te(2),t(j),t(ge);var y=s(ge,2),$=a(y),re=a($);dt(re),Te(2),t($),t(y),t(se);var te=s(se,2),R=a(te);R.__click=fe;var D=s(R,2),I=a(D);I.__click=()=>O(!0);var ke=a(I);{var z=w=>{var J=cr();o(w,J)},g=w=>{Dt(w,{size:18})};d(ke,w=>{e(l)?w(z):w(g,!1)})}Te(),t(I);var S=s(I,2),b=a(S);{var V=w=>{var J=ur();o(w,J)};d(b,w=>{e(l)&&w(V)})}Te(),t(S),t(D),t(te),t(H),t(h),_(()=>{H.disabled=e(l),X.disabled=e(l),Q.disabled=e(l),ee.disabled=e(l),re.disabled=e(l),R.disabled=e(l),I.disabled=e(l)||!e(m).productName||e(U),S.disabled=e(l)||!e(m).productName||e(U)}),je("submit",h,w=>{w.preventDefault(),O(!1)}),ut(X,()=>e(m).productName,w=>e(m).productName=w),ut(Q,()=>e(m).productType,w=>e(m).productType=w),za(ee,()=>e(m).pF,w=>e(m).pF=w),za(re,()=>e(m).pS,w=>e(m).pS=w),o(Z,h)}}),o(T,q)},$$slots:{default:!0}}),Qe()}nt(["click"]);var $t,Nt,jt,Ft,Lt,Bt,Rt,Qt,Vt,Ut,Gt,Wt,Ht,Jt,Kt,Xt;class _r{constructor(n,r="recettes"){rt(this,$t,Pe(!1));rt(this,Nt,Pe(null));rt(this,jt,Pe("recettes"));rt(this,Ft,G(()=>A.getProductModelById(this.productId)));rt(this,Lt,G(()=>this.productModel?.data??null));rt(this,Bt,G(()=>this.product?.who??[]));rt(this,Rt,G(()=>this.product?.stockParsed??null));rt(this,Qt,G(()=>this.product?.purchases??[]));rt(this,Vt,G(()=>this.product?.byDate?Ps(this.product.byDate):[]));rt(this,Ut,Pe(Xe({purchase:{quantity:null,unit:"",store:"",who:We.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));rt(this,Gt,Pe(Xe({overrideManagerEditMode:!1})));rt(this,Wt,Pe(null));rt(this,Ht,G(()=>this.editingPurchaseId?this.purchasesList.find(n=>n.$id===this.editingPurchaseId)??null:null));rt(this,Jt,Pe(null));rt(this,Kt,G(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));rt(this,Xt,G(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));ga(this,"formatQuantity",(n,r)=>oa(n,r));ga(this,"formatDate",Fs);this.productId=n,this.currentTab=r,this.initForms()}get loading(){return e(Ne(this,$t))}set loading(n){E(Ne(this,$t),n,!0)}get error(){return e(Ne(this,Nt))}set error(n){E(Ne(this,Nt),n,!0)}get currentTab(){return e(Ne(this,jt))}set currentTab(n){E(Ne(this,jt),n,!0)}get productModel(){return e(Ne(this,Ft))}set productModel(n){E(Ne(this,Ft),n)}get product(){return e(Ne(this,Lt))}set product(n){E(Ne(this,Lt),n)}get whoList(){return e(Ne(this,Bt))}set whoList(n){E(Ne(this,Bt),n)}get stockParsed(){return e(Ne(this,Rt))}set stockParsed(n){E(Ne(this,Rt),n)}get purchasesList(){return e(Ne(this,Qt))}set purchasesList(n){E(Ne(this,Qt),n)}get recipes(){return e(Ne(this,Vt))}set recipes(n){E(Ne(this,Vt),n)}get forms(){return e(Ne(this,Ut))}set forms(n){E(Ne(this,Ut),n,!0)}get uiStates(){return e(Ne(this,Gt))}set uiStates(n){E(Ne(this,Gt),n,!0)}get editingPurchaseId(){return e(Ne(this,Wt))}set editingPurchaseId(n){E(Ne(this,Wt),n,!0)}get editingPurchaseData(){return e(Ne(this,Ht))}set editingPurchaseData(n){E(Ne(this,Ht),n)}get originalFormsSnapshot(){return e(Ne(this,Jt))}set originalFormsSnapshot(n){E(Ne(this,Jt),n,!0)}initForms(){const n=A.getProductModelById(this.productId);if(!n||!n.data)return;const r=n.stats.missingQuantities[0];if(r){const{value:l,unit:v}=At(Math.abs(r.q),r.u);this.forms.purchase.quantity=l,this.forms.purchase.unit=v}else this.forms.purchase.quantity=null,this.forms.purchase.unit=n.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=n.data.storeInfo?.storeName??"",this.forms.purchase.who=We.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=n.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=n.data.storeInfo?.storeName??"",this.forms.store.comment=n.data.storeInfo?.storeComment??null,this.forms.who=n.data.who?[...n.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return e(Ne(this,Kt))}set hasChanges(n){E(Ne(this,Kt),n)}get hasAnyChanges(){return e(Ne(this,Xt))}set hasAnyChanges(n){E(Ne(this,Xt),n)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(n){this.currentTab=n}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");const{value:n,unit:r}=At(this.forms.purchase.quantity,this.forms.purchase.unit),l=this.forms.purchase.status||"delivered";let v=this.forms.purchase.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString());const C=Tt.normalize(n,r),m=C.quantity,Y=C.unit;await A.createPurchase(this.product.$id,[{q:m,u:Y}],{store:this.forms.purchase.store||void 0,who:this.forms.purchase.who||void 0,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:l,orderDate:this.forms.purchase.orderDate||null,deliveryDate:v,invoiceId:void 0});const W=this.product.missingQuantityArray[0];let U=null,O=this.product.totalNeededArray[0]?.u??"";if(W){const{value:fe,unit:T}=At(Math.abs(W.q),W.u);U=fe,O=T}this.forms.purchase={quantity:U,unit:O,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(n){this.editingPurchaseId=n.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(n){n.$id&&await this.withLoading(async()=>{const r=Tt.normalize(n.quantity,n.unit),l=n.status||null;let v=n.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString()),await A.updatePurchase(n.$id,{unit:r.unit,quantity:r.quantity,store:n.store||null,who:n.who||null,notes:n.notes||"",price:n.price||null,status:l,orderDate:n.orderDate||null,deliveryDate:v}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(n){const r=this.purchasesList.find(l=>l.$id===n);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await A.deletePurchase(n)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const n=Tt.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:n.quantity.toString(),unit:n.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};await A.updateProduct(this.product.$id,{stockReel:JSON.stringify(r)}),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{stockReel:null})},"Stock supprimé")}async setWho(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{who:n})},"Volontaires mis à jour")}async updateStore(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{storeInfo:n})},"Magasin mis à jour")}async setOverride(n){this.product&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:JSON.stringify(n)})},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await A.updateProduct(this.product.$id,{totalNeededOverride:null})},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const n={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};n.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(n.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};n.storeInfo=r}Object.keys(n).length>0&&(await A.updateProductBatch(this.product.$id,n,r=>A.getEnrichedProductById(r)),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(n,r){this.loading=!0,this.error=null;try{const l=await n();return r&&this.showToast("success",r),l}catch(l){const v=l instanceof Error?l.message:"Une erreur est survenue";return this.error=v,this.showToast("error",v),console.error("[ProductModalState]",l),null}finally{this.loading=!1}}showToast(n,r){const l=new CustomEvent("toast",{detail:{type:n,message:r}});window.dispatchEvent(l)}}$t=new WeakMap,Nt=new WeakMap,jt=new WeakMap,Ft=new WeakMap,Lt=new WeakMap,Bt=new WeakMap,Rt=new WeakMap,Qt=new WeakMap,Vt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap;var gr=i('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),br=i('<div class="text-base-content/60 mt-1 text-xs"> </div>'),hr=i('<div class="font-medium"> </div> <!>',1),xr=i('<pre class="text-xs"> </pre>'),yr=i('<span class="text-base-content/50 italic">Non défini</span>'),wr=i('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),kr=i('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function _a(le,n){Re(n,!0);let r=De(n,"title",3,"Événement terminé"),l=De(n,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),v=De(n,"showData",3,!0),C=De(n,"data",3,null),m=De(n,"dataLabel",3,"");var Y=kr(),W=a(Y),U=a(W);wa(U,{class:"text-warning h-5 w-5"});var O=s(U,2);vs(O,{class:"text-warning/70 h-4 w-4"});var fe=s(O,2),T=a(fe,!0);t(fe),t(W);var x=s(W,2),q=a(x,!0);t(x);var N=s(x,2);{var F=Z=>{var ne=wr(),h=a(ne);{var k=ce=>{var K=gr(),de=a(K);t(K),_(()=>p(de,`${m()??""} :`)),o(ce,K)};d(h,ce=>{m()&&ce(k)})}var f=s(h,2),L=a(f);{var ae=ce=>{var K=at();_(()=>p(K,C())),o(ce,K)},H=ce=>{var K=Le(),de=ye(K);{var ve=pe=>{var be=at();_(ue=>p(be,ue),[()=>C().join(", ")]),o(pe,be)},X=pe=>{var be=Le(),ue=ye(be);{var me=ie=>{var oe=Le(),M=ye(oe);{var se=j=>{var ee=hr(),y=ye(ee),$=a(y,!0);t(y);var re=s(y,2);{var te=R=>{var D=br(),I=a(D,!0);t(D),_(()=>p(I,C().storeComment)),o(R,D)};d(re,R=>{C().storeComment&&R(te)})}_(()=>p($,C().storeName)),o(j,ee)},ge=j=>{var ee=xr(),y=a(ee,!0);t(ee),_($=>p(y,$),[()=>JSON.stringify(C(),null,2)]),o(j,ee)};d(M,j=>{C().storeName?j(se):j(ge,!1)})}o(ie,oe)},Q=ie=>{var oe=yr();o(ie,oe)};d(ue,ie=>{typeof C()=="object"&&C()!==null?ie(me):ie(Q,!1)},!0)}o(pe,be)};d(de,pe=>{Array.isArray(C())&&C().length>0?pe(ve):pe(X,!1)},!0)}o(ce,K)};d(L,ce=>{typeof C()=="string"||typeof C()=="number"?ce(ae):ce(H,!1)})}t(f),t(ne),o(Z,ne)};d(N,Z=>{v()&&C()&&Z(F)})}t(Y),_(()=>{p(T,r()),p(q,l())}),o(le,Y),Qe()}var Sr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Pr=i('<span class="loading loading-spinner loading-sm"></span>'),Mr=i('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-6"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),qr=i('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),Cr=i("<th>Actions</th>"),Dr=i('<span class="loading loading-spinner loading-sm"></span>'),Ar=i('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),Tr=i('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),Ir=i('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),Er=i('<span class="loading loading-spinner loading-xs"></span>'),Or=i('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),zr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),$r=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Nr=i('<div class="mt-2 text-sm opacity-70"><!> </div>'),jr=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-37.5 truncate"> </span></div>'),Fr=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-25 truncate"> </span></div>'),Lr=i('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),Br=i('<div class="card bg-base-100 border-neutral/40 card-xs border shadow-sm"><div class="card-body p-4"><div class="flex items-center justify-between gap-3"><div class="flex flex-wrap items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span class="font-medium"> </span></div> <div> <!></div> <div> </div></div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-sm"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),Rr=i('<div class="mt-4 space-y-3"></div>'),Qr=i('<div class="space-y-4"><!></div> <!>',1);function Vr(le,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);function v(f){return f.quantity!==null&&f.quantity!==0&&f.unit?.trim()!==""}function C(f){if(l())return;const{value:L,unit:ae}=At(f.quantity,f.unit);r().forms.purchase.quantity=L,r().forms.purchase.unit=ae,r().forms.purchase.price=f.price,r().forms.purchase.store=f.store||"",r().forms.purchase.who=f.who||"",r().forms.purchase.notes=f.notes||"",r().forms.purchase.status=f.status||null,r().forms.purchase.orderDate=f.orderDate||null,r().forms.purchase.deliveryDate=f.deliveryDate||null,r().startEditPurchase(f),setTimeout(()=>{const H=document.querySelector("#purchase-form-card");H?.scrollIntoView({behavior:"smooth",block:"center"}),H?.querySelector('input[type="number"]')?.focus()},100)}function m(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function Y(){if(r().isPurchaseFormValid)if(r().editingPurchaseId){const f=r().editingPurchaseData;if(!f||!v(f))return;const L=r().forms.purchase.quantity??0,ae=r().forms.purchase.unit,H=Tt.normalize(L,ae);f.quantity=H.quantity,f.unit=H.unit,f.price=r().forms.purchase.price,f.store=r().forms.purchase.store,f.who=r().forms.purchase.who,f.notes=r().forms.purchase.notes,f.status=r().forms.purchase.status,f.orderDate=r().forms.purchase.orderDate,f.deliveryDate=r().forms.purchase.deliveryDate,r().updateEditedPurchase(f),r().cancelEditPurchase()}else r().forms.purchase.status==="ordered"&&!r().forms.purchase.orderDate&&(r().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),r().addPurchase()}function W(f){r().removePurchase(f)}function U(f){C(f)}let O=G(()=>r().editingPurchaseId!==null),fe=G(()=>e(O)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),T=G(()=>e(O)?"Enregistrer les modifications":"Ajouter l'achat");var x=Qr(),q=ye(x),N=a(q);{var F=f=>{_a(f,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},Z=f=>{var L=Mr(),ae=a(L),H=a(ae),ce=a(H,!0);t(H);var K=s(H,2),de=a(K),ve=a(de);fa(ve,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(y){r().forms.purchase.quantity=y},get unit(){return r().forms.purchase.unit},set unit(y){r().forms.purchase.unit=y}});var X=s(ve,2);Ta(X,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(y){r().forms.purchase.price=y}});var pe=s(X,2);qt(pe,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(y){r().forms.purchase.store=y}});var be=s(pe,2);ea(be,{get suggestions(){return A.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(y){r().forms.purchase.who=y}}),t(de);var ue=s(de,2),me=a(ue);Ct(me,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(y){r().forms.purchase.notes=y}}),t(ue);var Q=s(ue,2);rs(Q,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(y){r().forms.purchase.status=y},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(y){r().forms.purchase.deliveryDate=y}}),t(K);var ie=s(K,2),oe=a(ie);{var M=y=>{var $=Sr();$.__click=m,o(y,$)};d(oe,y=>{e(O)&&y(M)})}var se=s(oe,2);se.__click=Y;var ge=a(se);{var j=y=>{var $=Pr();o(y,$)},ee=y=>{var $=at();_(()=>p($,e(T))),o(y,$)};d(ge,y=>{r().loading?y(j):y(ee,!1)})}t(se),t(ie),t(ae),t(L),_(()=>{Ce(L,1,`card bg-base-200 ${e(O)?"ring-accent ring-2 ring-offset-2":""}`),p(ce,e(fe)),se.disabled=r().loading||!r().isPurchaseFormValid}),o(f,L)};d(N,f=>{l()?f(F):f(Z,!1)})}t(q);var ne=s(q,2);{var h=f=>{var L=qr(),ae=a(L);ht(ae,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(L),o(f,L)},k=f=>{var L=Le(),ae=ye(L);{var H=K=>{var de=Ir(),ve=a(de),X=a(ve),pe=a(X),be=s(a(pe),8);{var ue=Q=>{var ie=Cr();o(Q,ie)};d(be,Q=>{l()||Q(ue)})}t(pe),t(X);var me=s(X);He(me,21,()=>r().purchasesList,Q=>Q.$id,(Q,ie)=>{var oe=Tr(),M=a(oe),se=a(M,!0);t(M);var ge=s(M),j=a(ge,!0);t(ge);var ee=s(ge),y=a(ee,!0);t(ee);var $=s(ee),re=a($),te=a(re,!0);t(re),t($);var R=s($),D=a(R,!0);t(R);var I=s(R),ke=a(I,!0);t(I);var z=s(I),g=a(z,!0);t(z);var S=s(z),b=a(S,!0);t(S);var V=s(S);{var w=J=>{var _e=Ar(),he=a(_e),c=a(he);c.__click=()=>U(e(ie));var u=a(c);gt(u,{class:"h-4 w-4"}),t(c);var P=s(c,2);P.__click=()=>W(e(ie).$id);var B=a(P);{var xe=we=>{var Me=Dr();o(we,Me)},Se=we=>{va(we,{class:"h-4 w-4"})};d(B,we=>{r().loading?we(xe):we(Se,!1)})}t(P),t(he),t(_e),_(()=>P.disabled=r().loading),o(J,_e)};d(V,J=>{l()||J(w)})}t(oe),_((J,_e,he,c,u)=>{p(se,J),p(j,e(ie).store||"-"),p(y,e(ie).who||"-"),Ce(re,1,`badge badge-sm ${_e??""}`),p(te,he),p(D,c),p(ke,u),p(g,e(ie).price?`${e(ie).price}€`:"-"),p(b,e(ie).notes||"-")},[()=>oa(e(ie).quantity,e(ie).unit),()=>sa(e(ie).status).class,()=>sa(e(ie).status).text,()=>ra(e(ie).orderDate),()=>ra(e(ie).deliveryDate)]),o(Q,oe)}),t(me),t(ve),t(de),o(K,de)},ce=K=>{var de=Rr();He(de,21,()=>r().purchasesList,ve=>ve.$id,(ve,X)=>{var pe=Br(),be=a(pe),ue=a(be),me=a(ue),Q=a(me),ie=a(Q);cs(ie,{class:"size-4"});var oe=s(ie,2),M=a(oe,!0);t(oe),t(Q);var se=s(Q,2),ge=a(se),j=s(ge);Ba(j,{class:"me-1 inline size-4"}),t(se);var ee=s(se,2),y=a(ee,!0);t(ee),t(me);var $=s(me,2);{var re=c=>{var u=Or();u.__click=()=>W(e(X).$id);var P=a(u);{var B=Se=>{var we=Er();o(Se,we)},xe=Se=>{us(Se,{size:16})};d(P,Se=>{r().loading?Se(B):Se(xe,!1)})}t(u),_(()=>u.disabled=r().loading),o(c,u)};d($,c=>{l()||c(re)})}t(ue);var te=s(ue,2),R=a(te);{var D=c=>{var u=zr(),P=a(u);It(P,{class:"size-3.5"});var B=s(P,2),xe=a(B);t(B),t(u),_(Se=>p(xe,`Commande: ${Se??""}`),[()=>ra(e(X).orderDate)]),o(c,u)};d(R,c=>{e(X).orderDate&&c(D)})}var I=s(R,2);{var ke=c=>{var u=$r(),P=a(u);It(P,{class:"size-3.5"});var B=s(P,2),xe=a(B);t(B),t(u),_(Se=>p(xe,`Livraison: ${Se??""}`),[()=>e(X).deliveryDate?ra(e(X).deliveryDate):"non renseigné"]),o(c,u)};d(I,c=>{e(X).status==="ordered"&&c(ke)})}t(te);var z=s(te,2);{var g=c=>{var u=Nr(),P=a(u);Ra(P,{class:"me-1 inline size-3.5"});var B=s(P);t(u),_(()=>p(B,` ${e(X).notes??""}`)),o(c,u)};d(z,c=>{e(X).notes&&c(g)})}var S=s(z,2),b=a(S);{var V=c=>{var u=jr(),P=a(u);vt(P,{class:"h-3 w-3"});var B=s(P,2),xe=a(B,!0);t(B),t(u),_(()=>p(xe,e(X).store)),o(c,u)};d(b,c=>{e(X).store&&c(V)})}var w=s(b,2);{var J=c=>{var u=Fr(),P=a(u);Yt(P,{class:"size-3.5"});var B=s(P,2),xe=a(B,!0);t(B),t(u),_(()=>p(xe,e(X).who)),o(c,u)};d(w,c=>{e(X).who&&c(J)})}t(S);var _e=s(S,2);{var he=c=>{var u=Lr(),P=a(u);P.__click=()=>U(e(X));var B=a(P);gt(B,{size:16,class:"mr-1"}),Te(),t(P),t(u),o(c,u)};d(_e,c=>{l()||c(he)})}t(be),t(pe),_((c,u,P)=>{p(M,c),p(ge,`${(e(X).price?e(X).price:"?")??""} `),Ce(ee,1,`badge ${u??""}`),p(y,P)},[()=>oa(e(X).quantity,e(X).unit),()=>sa(e(X).status).class,()=>sa(e(X).status).text]),o(ve,pe)}),t(de),o(K,de)};d(ae,K=>{We.isMobile?K(ce,!1):K(H)},!0)}o(f,L)};d(ne,f=>{r().purchasesList.length===0?f(h):f(k,!1)})}o(le,x),Qe()}nt(["click"]);var Ur=i(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),Gr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Wr=i('<span class="loading loading-spinner loading-xs"></span>'),Hr=i('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Jr=i('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),Kr=i('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),Xr=i('<span class="loading loading-spinner loading-xs"></span>'),Yr=i('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),Zr=i('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),en=i('<div class="space-y-4"><!></div> <!>',1);function tn(le,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=Pe(!1);async function C(){await r()?.setStock(),E(v,!1)}async function m(){await r()?.removeStock()}function Y(){if(!r().stockParsed)return;const{value:Z,unit:ne}=At(r().stockParsed.quantity,r().stockParsed.unit);r().forms.stock.quantity=Z,r().forms.stock.unit=ne,r().forms.stock.notes=r().stockParsed.notes??"",r().forms.stock.dateTime=r().stockParsed.dateTime,E(v,!0)}function W(){E(v,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var U=en(),O=ye(U),fe=a(O);{var T=Z=>{_a(Z,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},x=Z=>{var ne=Le(),h=ye(ne);{var k=f=>{var L=Hr(),ae=a(L),H=a(ae),ce=a(H,!0);t(H);var K=s(H,2),de=a(K);Da(de,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(j,ee)=>{Te();var y=Ur();Te(4),o(j,y)},$$slots:{default:!0}}),t(K);var ve=s(K,2),X=a(ve);fa(X,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(j){r().forms.stock.quantity=j},get unit(){return r().forms.stock.unit},set unit(j){r().forms.stock.unit=j}}),t(ve);var pe=s(ve,2),be=a(pe);Ct(be,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(j){r().forms.stock.notes=j}}),t(pe);var ue=s(pe,2),me=a(ue);{var Q=j=>{var ee=Gr();ee.__click=W,_(()=>ee.disabled=r().loading),o(j,ee)};d(me,j=>{e(v)&&j(Q)})}var ie=s(me,2);ie.__click=()=>{r().forms.stock.quantity=null,r().forms.stock.notes=""};var oe=s(ie,2);oe.__click=C;var M=a(oe);{var se=j=>{var ee=Wr();o(j,ee)},ge=j=>{var ee=at();_(()=>p(ee,e(v)?"Enregistrer les modifications":"Déclarer le stock")),o(j,ee)};d(M,j=>{r().loading?j(se):j(ge,!1)})}t(oe),t(ue),t(ae),t(L),_(j=>{Ce(L,1,`card bg-base-200 ${e(v)?"ring-accent ring-2 ring-offset-2":""}`),p(ce,j),Ce(ie,1,`btn btn-ghost btn-sm ${e(v)?"hidden":""}`),ie.disabled=r().loading,oe.disabled=r().loading||!r().forms.stock.quantity},[()=>e(v)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),o(f,L)};d(h,f=>{(!r().stockParsed||e(v))&&f(k)})}o(Z,ne)};d(fe,Z=>{l()?Z(T):Z(x,!1)})}t(O);var q=s(O,2);{var N=Z=>{var ne=Jr(),h=a(ne);Qa(h,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(ne),o(Z,ne)},F=Z=>{var ne=Le(),h=ye(ne);{var k=f=>{var L=Zr(),ae=a(L),H=a(ae),ce=s(a(H),2),K=a(ce);t(ce);var de=s(ce,2),ve=s(a(de),2),X=a(ve,!0);t(ve),t(de);var pe=s(de,2);{var be=Q=>{var ie=Kr(),oe=s(a(ie),2),M=a(oe,!0);t(oe),t(ie),_(()=>p(M,r().stockParsed.notes)),o(Q,ie)};d(pe,Q=>{r().stockParsed.notes&&Q(be)})}t(H);var ue=s(H,2);{var me=Q=>{var ie=Yr(),oe=a(ie);oe.__click=m;var M=a(oe);{var se=y=>{var $=Xr();o(y,$)},ge=y=>{var $=at("Supprimer le stock");o(y,$)};d(M,y=>{r().loading?y(se):y(ge,!1)})}t(oe);var j=s(oe,2);j.__click=Y;var ee=a(j);gt(ee,{class:"mr-1 h-4 w-4"}),Te(),t(j),t(ie),_(()=>{oe.disabled=r().loading,j.disabled=r().loading}),o(Q,ie)};d(ue,Q=>{l()||Q(me)})}t(ae),t(L),_(Q=>{p(K,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),p(X,Q)},[()=>Zt(r().stockParsed.dateTime)]),o(f,L)};d(h,f=>{e(v)||f(k)})}o(Z,ne)};d(q,Z=>{r().stockParsed?Z(F,!1):Z(N)})}o(le,U),Qe()}nt(["click"]);var an=i('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),sn=i('<div class="space-y-4"><!></div>');function rn(le,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=Pe("");const C=G(()=>{const q=A.uniqueWho,N=new Set([...q,...r().forms.who]);return Array.from(N).map(F=>({id:F,label:F,selected:r().forms.who.includes(F)}))});function m(q){const N=q.trim();N&&!r().forms.who.includes(N)&&(r().forms.who=[...r().forms.who,N])}function Y(q){r().forms.who=r().forms.who.filter(N=>N!==q)}function W(q){r().forms.who.includes(q)?Y(q):m(q)}function U(){e(v).trim()&&(m(e(v)),E(v,""))}var O=sn(),fe=a(O);{var T=q=>{_a(q,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},x=q=>{var N=an(),F=a(N),Z=s(a(F),4),ne=a(Z),h=a(ne),k=a(h);Yt(k,{class:"h-4 w-4 opacity-50"});var f=s(k,2);dt(f),f.__keydown=K=>{K.key==="Enter"&&(K.preventDefault(),U())},t(h);var L=s(h,2);L.__click=U;var ae=a(L);Va(ae,{size:16}),t(L),t(ne);var H=s(ne,2),ce=s(a(H),2);zt(ce,{get items(){return e(C)},onToggleItem:W,size:"sm",color:"info"}),t(H),t(Z),t(F),t(N),_(K=>{f.disabled=r().loading,L.disabled=K},[()=>r().loading||!e(v).trim()]),ut(f,()=>e(v),K=>E(v,K)),o(q,N)};d(fe,q=>{l()?q(T):q(x,!1)})}t(O),o(le,O),Qe()}nt(["keydown","click"]);var nn=i(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),on=i('<div class="space-y-4"><!></div>');function ln(le,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);const v=G(()=>r()?.hasChanges?.store||!1);async function C(){if(!e(v))return;const O={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(O)}var m=on(),Y=a(m);{var W=O=>{{let fe=G(()=>r().product?.storeInfo);_a(O,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return e(fe)},dataLabel:"Magasin actuel"})}},U=O=>{var fe=nn(),T=a(fe),x=s(a(T),4),q=a(x),N=a(q);qt(N,{get suggestions(){return A.uniqueStores},get disabled(){return r().loading},onkeydown:h=>{h.key==="Enter"&&C()},get value(){return r().forms.store.name},set value(h){r().forms.store.name=h}}),t(q);var F=s(q,2);Ct(F,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(h){r().forms.store.comment=h}}),t(x);var Z=s(x,2),ne=a(Z);ne.__click=()=>{r().forms.store.name="",r().forms.store.comment=""},t(Z),t(T),t(fe),_(()=>ne.disabled=r().loading),o(O,fe)};d(Y,O=>{l()?O(W):O(U,!1)})}t(m),o(le,m),Qe()}nt(["click"]);var dn=i('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function vn(le,n){Re(n,!0);let r=De(n,"value",15);De(n,"disabled",3,!1);var l=dn(),v=a(l);Ra(v,{size:20,class:"text-base-centent/70"});var C=s(v,2);dt(C),t(l),ut(C,r),o(le,l),Qe()}var cn=i(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),un=i('<span class="loading loading-spinner loading-sm"></span>'),mn=i('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),pn=i('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),fn=i('<div class="chat-bubble relative text-sm"> <!></div>'),_n=i('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),gn=i('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),bn=i('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function hn(le,n){Re(n,!0);let r=De(n,"modalState",7);const l=G(()=>r().product?.totalNeededOverrideParsed),v=G(()=>r().product?.displayTotalOverride),C=G(()=>r().product?es(r().product):null);let m=G(()=>r().uiStates.overrideManagerEditMode),Y=G(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),W=G(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function U(){if(!e(Y)||!e(W))return{quantity:0,unit:""};const{q:h,u:k}=$a(e(Y),e(W));return{quantity:Ms(h,k),unit:k}}let O=Pe(Xe(U().quantity)),fe=Pe(Xe(U().unit)),T=Pe(Xe(r().product?.totalNeededOverrideParsed?.comment||""));mt(()=>{if(e(m)){const h=U();E(O,h.quantity,!0),E(fe,h.unit,!0),E(T,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let x=G(()=>e(O)>0&&e(fe).trim()!=="");async function q(){if(!r())return;const{q:h,u:k}=$a(e(O),e(fe)),f=r().product?.totalNeededOverrideParsed?.totalOverride,L=r().product?.totalNeededOverrideParsed?.comment||"";if(h!==f?.q||k!==f?.u||e(T)!==L){const H={totalOverride:{q:h,u:k},comment:e(T),totalComputedWhenOverride:r().product.totalNeededArray,platesNbWhenOverride:r().product.totalAssiettes,recipesNbWhenOverride:r().product.nbRecipes};await r().setOverride(H)}r().uiStates.overrideManagerEditMode=!1}async function N(){r()&&(await r().removeOverride(),r().uiStates.overrideManagerEditMode=!1)}var F=Le(),Z=ye(F);{var ne=h=>{var k=bn(),f=a(k);{var L=oe=>{var M=cn(),se=a(M);Sa(se,{size:18});var ge=s(se,2),j=s(a(ge),2),ee=a(j),y=a(ee),$=s(a(y)),re=a($);t($);var te=s($,2),R=a(te,!0);t(te),t(y),t(ee);var D=s(ee,2),I=a(D),ke=s(a(I)),z=a(ke);t(ke);var g=s(ke,2),S=a(g,!0);t(g),t(I),t(D);var b=s(D,2),V=a(b),w=a(V);t(V),t(b),t(j),t(ge),t(M),_((J,_e)=>{p(re,`${e(C).details.oldPlates??""} couverts,
                  ${e(C).details.oldRecipes??""} recettes`),p(R,J),p(z,`${e(C).details.newPlates??""} couverts,
                  ${e(C).details.newRecipes??""} recettes`),p(S,_e),p(w,`Votre override : ${e(v)??""}`)},[()=>Na(e(C).details.oldComputed),()=>Na(e(C).details.newComputed)]),o(oe,M)};d(f,oe=>{e(C)?.hasMismatch&&e(C)?.details&&oe(L)})}var ae=s(f,2),H=s(a(ae),2),ce=a(H),K=a(ce),de=s(K);ca(de,{class:"h-3 w-3"}),t(ce);var ve=s(ce,2),X=a(ve),pe=s(X);ka(pe,{class:"h-3 w-3"}),t(ve);var be=s(ve,2),ue=a(be,!0);t(be),t(H),t(ae);var me=s(ae,2);{var Q=oe=>{var M=mn(),se=s(a(M),2);fa(se,{get quantity(){return e(O)},set quantity(R){E(O,R,!0)},get unit(){return e(fe)},set unit(R){E(fe,R,!0)}});var ge=s(se,2);vn(ge,{get value(){return e(T)},set value(R){E(T,R,!0)}});var j=s(ge,2),ee=a(j);ee.__click=N;var y=s(ee,2);y.__click=q;var $=a(y);{var re=R=>{var D=un();o(R,D)},te=R=>{var D=at("✓");o(R,D)};d($,R=>{r().loading?R(re):R(te,!1)})}t(y),t(j),t(M),_(()=>y.disabled=r().loading||!e(x)),ts(1,M,()=>ss),o(oe,M)},ie=oe=>{var M=Le(),se=ye(M);{var ge=ee=>{var y=_n(),$=a(y),re=s(a($),2);{var te=g=>{var S=pn();S.__click=()=>r().uiStates.overrideManagerEditMode=!0;var b=a(S);ms(b,{size:16}),t(S),o(g,S)};d(re,g=>{n.isArchiveMode||g(te)})}var R=s(re,2);{var D=g=>{var S=fn(),b=a(S),V=s(b);ps(V,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),t(S),_(()=>p(b,`${e(l).comment??""} `)),o(g,S)};d(R,g=>{e(l).comment&&g(D)})}t($);var I=s($,2),ke=a(I),z=a(ke,!0);t(ke),t(I),t(y),_(()=>p(z,e(v))),o(ee,y)},j=ee=>{var y=Le(),$=ye(y);{var re=te=>{var R=gn(),D=a(R);D.__click=()=>r().uiStates.overrideManagerEditMode=!0;var I=s(a(D));gt(I,{size:16}),t(D),t(R),o(te,R)};d($,te=>{n.isArchiveMode||te(re)},!0)}o(ee,y)};d(se,ee=>{e(v)&&e(l)?ee(ge):ee(j,!1)})}o(oe,M)};d(me,oe=>{e(m)?oe(Q):oe(ie,!1)})}t(k),_(()=>{p(K,`${r().product.nbRecipes??""} `),p(X,`${r().product.totalAssiettes??""} `),p(ue,r().product.displayTotalNeeded)}),o(h,k)};d(Z,h=>{r().product&&h(ne)})}o(le,F),Qe()}nt(["click"]);var xn=i('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),yn=i('<span class="text-base-content/70"> </span>'),wn=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),kn=i('<div class="mt-4 space-y-3"></div>'),Sn=i('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function Pn(le,n){Re(n,!0);const r=G(()=>n.modalState.recipes);function l(T,x){return!T||!x?"-":oa(T,x)}var v=Sn(),C=ye(v);hn(C,{get modalState(){return n.modalState},get isArchiveMode(){return n.isArchiveMode}});var m=s(C,2),Y=s(a(m),2),W=a(Y);ca(W,{class:"h-5 w-5"}),Te(),t(Y);var U=s(Y,2);{var O=T=>{var x=xn(),q=a(x);ya(q,{class:"mx-auto mb-2 h-12 w-12"}),Te(2),t(x),o(T,x)},fe=T=>{var x=kn();He(x,21,()=>e(r),xt,(q,N)=>{const F=G(()=>l(e(N).q,e(N).u)),Z=G(()=>l(e(N).qEq,e(N).uEq));var ne=wn(),h=a(ne),k=a(h),f=a(k),L=a(f),ae=a(L,!0);t(L);var H=s(L,2),ce=a(H),K=s(ce);{var de=M=>{Pa(M,{class:"h-4 w-4 text-amber-500"})},ve=M=>{var se=Le(),ge=ye(se);{var j=y=>{Ma(y,{class:"h-4 w-4 text-indigo-500"})},ee=y=>{var $=Le(),re=ye($);{var te=R=>{qa(R,{class:"h-4 w-4 text-sky-500"})};d(re,R=>{St(e(N).dateTimeService)==="cloud"&&R(te)},!0)}o(y,$)};d(ge,y=>{St(e(N).dateTimeService)==="moon"?y(j):y(ee,!1)},!0)}o(M,se)};d(K,M=>{St(e(N).dateTimeService)==="sun"?M(de):M(ve,!1)})}t(H),t(f);var X=s(f,2),pe=a(X),be=a(pe);ka(be,{class:" me-1 h-3 w-3 stroke-2"});var ue=s(be);t(pe);var me=s(pe,2),Q=a(me,!0);t(me);var ie=s(me,2);{var oe=M=>{var se=yn(),ge=a(se);t(se),_(j=>p(ge,`(${j??""})`),[()=>l(e(N).q,e(N).u)]),o(M,se)};d(ie,M=>{e(F)!==e(Z)&&M(oe)})}t(X),t(k),t(h),t(ne),_((M,se,ge)=>{p(ae,e(N).r),p(ce,`${M??""} - ${se??""} `),p(ue,` ${(e(N).a||0)??""} c.`),p(Q,ge)},[()=>_t(e(N).date),()=>js(e(N).date),()=>l(e(N).qEq,e(N).uEq)]),o(q,ne)}),t(x),o(T,x)};d(U,T=>{e(r).length===0?T(O):T(fe,!1)})}t(m),o(le,v),Qe()}var Mn=i('<div class="alert alert-warning border-warning/20 m-4 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),qn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Cn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Dn=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),An=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),Tn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),In=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),En=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),On=i('<span class="badge badge-sm badge-secondary ml-1">1</span>'),zn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),$n=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Nn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),jn=i('<div class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Fn=i("<!> <div><!></div>",1),Ln=i('<span class="loading loading-spinner loading-sm"></span>'),Bn=i("<!> Tout enregistrer",1),Rn=i('<button class="btn btn-primary"><!></button>'),Qn=i('<button class="btn btn-ghost"> </button> <!>',1),Vn=i('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Un(le,n){Re(n,!0);let r=De(n,"initialTab",3,"recettes"),l=Pe(null);mt(()=>{E(l,new _r(n.productId,r()),!0)});let v=G(()=>A.isEventPassed),C=G(()=>e(l)===null||e(l).product===null);function m(O){e(l)?.setCurrentTab(O)}function Y(){e(l)?.saveAllChanges().then(()=>{e(l)?.resetForms(),n.onClose()})}function W(){e(l)?.resetForms(),n.onClose()}let U=G(()=>e(l)?.hasAnyChanges??!1);{let O=G(()=>!!n.productId);Pt(le,{get isOpen(){return e(O)},onClose:W,get hasUnsavedChanges(){return e(U)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(fe,T)=>{var x=Le(),q=ye(x);{var N=Z=>{yt(Z,{title:"Chargement...",showBackButton:!0,onClose:W})},F=Z=>{var ne=Vn(),h=ye(ne);{let z=G(()=>e(l)?.product?.productName||"Produit");yt(h,{get title(){return e(z)},showBackButton:!0,onClose:W})}var k=s(h,2);{var f=z=>{var g=Mn(),S=a(g);wa(S,{class:"h-4 w-4"}),Te(4),t(g),o(z,g)};d(k,z=>{e(v)&&z(f)})}var L=s(k,2),ae=a(L),H=a(ae);H.__click=()=>m("recettes");var ce=a(H);ca(ce,{class:"mr-1 h-4 w-4"});var K=s(ce,4);{var de=z=>{var g=qn(),S=a(g,!0);t(g),_(()=>p(S,e(l).product.nbRecipes)),o(z,g)},ve=z=>{var g=Cn();o(z,g)};d(K,z=>{e(l)?.product?.nbRecipes&&e(l).product.nbRecipes>0?z(de):z(ve,!1)})}t(H);var X=s(H,2);X.__click=()=>m("magasins");var pe=a(X);vt(pe,{class:"mr-1 h-4 w-4"});var be=s(pe,4);{var ue=z=>{var g=Dn();o(z,g)};d(be,z=>{e(l)?.hasChanges?.store&&z(ue)})}t(X);var me=s(X,2);me.__click=()=>m("volontaires");var Q=a(me);Et(Q,{class:"mr-1 h-4 w-4"});var ie=s(Q,4);{var oe=z=>{var g=An();o(z,g)},M=z=>{var g=Le(),S=ye(g);{var b=w=>{var J=Tn(),_e=a(J,!0);t(J),_(()=>p(_e,e(l).product.who.length)),o(w,J)},V=w=>{var J=In();o(w,J)};d(S,w=>{e(l)?.product?.who&&e(l).product.who.length>0?w(b):w(V,!1)},!0)}o(z,g)};d(ie,z=>{e(l)?.hasChanges?.who?z(oe):z(M,!1)})}t(me);var se=s(me,2);se.__click=()=>m("stock");var ge=a(se);Qa(ge,{class:"mr-1 h-4 w-4"});var j=s(ge,4);{var ee=z=>{var g=En();o(z,g)},y=z=>{var g=Le(),S=ye(g);{var b=w=>{var J=On();o(w,J)},V=w=>{var J=zn();o(w,J)};d(S,w=>{e(l)?.stockParsed?w(b):w(V,!1)},!0)}o(z,g)};d(j,z=>{e(l)?.hasChanges?.stock?z(ee):z(y,!1)})}t(se);var $=s(se,2);$.__click=()=>m("achats");var re=a($);ht(re,{class:"mr-1 h-4 w-4"});var te=s(re,4);{var R=z=>{var g=$n(),S=a(g,!0);t(g),_(()=>p(S,e(l).purchasesList.length)),o(z,g)},D=z=>{var g=Nn();o(z,g)};d(te,z=>{e(l)?.purchasesList&&e(l).purchasesList.length>0?z(R):z(D,!1)})}t($),t(ae),t(L);var I=s(L,2);Mt(I,{children:(z,g)=>{var S=Fn(),b=ye(S);{var V=_e=>{var he=jn(),c=a(he);va(c,{class:"h-4 w-4"});var u=s(c,2),P=a(u);t(u),t(he),_(()=>p(P,`Erreur : ${e(l).error??""}`)),o(_e,he)};d(b,_e=>{e(l)?.error&&_e(V)})}var w=s(b,2),J=a(w);qs(J,()=>e(l)?.currentTab,_e=>{var he=Le(),c=ye(he);{var u=B=>{Pn(B,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},P=B=>{var xe=Le(),Se=ye(xe);{var we=qe=>{Vr(qe,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Me=qe=>{var Ve=Le(),Je=ye(Ve);{var st=Ue=>{tn(Ue,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Fe=Ue=>{var et=Le(),tt=ye(et);{var ze=Ee=>{rn(Ee,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Ie=Ee=>{var Ge=Le(),Ye=ye(Ge);{var $e=Ae=>{ln(Ae,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})};d(Ye,Ae=>{e(l)?.currentTab==="magasins"&&Ae($e)},!0)}o(Ee,Ge)};d(tt,Ee=>{e(l)?.currentTab==="volontaires"?Ee(ze):Ee(Ie,!1)},!0)}o(Ue,et)};d(Je,Ue=>{e(l)?.currentTab==="stock"?Ue(st):Ue(Fe,!1)},!0)}o(qe,Ve)};d(Se,qe=>{e(l)?.currentTab==="achats"?qe(we):qe(Me,!1)},!0)}o(B,xe)};d(c,B=>{e(l)?.currentTab==="recettes"?B(u):B(P,!1)})}o(_e,he)}),t(w),o(z,S)}});var ke=s(I,2);pa(ke,{children:(z,g)=>{var S=Qn(),b=ye(S);b.__click=W;var V=a(b,!0);t(b);var w=s(b,2);{var J=_e=>{var he=Rn();he.__click=Y;var c=a(he);{var u=B=>{var xe=Ln();o(B,xe)},P=B=>{var xe=Bn(),Se=ye(xe);ua(Se,{class:"h-4 w-4"}),Te(),o(B,xe)};d(c,B=>{e(l).loading?B(u):B(P,!1)})}t(he),_(()=>he.disabled=e(l).loading),o(_e,he)};d(w,_e=>{e(l)?.hasAnyChanges&&_e(J)})}_(()=>p(V,e(l)?.hasAnyChanges?"Annuler":"Fermer")),o(z,S)}}),_(()=>{Ce(H,1,`tab ${e(l)?.currentTab==="recettes"?"tab-active":""}`),Ce(X,1,`tab ${e(l)?.currentTab==="magasins"?"tab-active":""}`),Ce(me,1,`tab ${e(l)?.currentTab==="volontaires"?"tab-active":""}`),Ce(se,1,`tab ${e(l)?.currentTab==="stock"?"tab-active":""}`),Ce($,1,`tab ${e(l)?.currentTab==="achats"?"tab-active":""}`)}),o(Z,ne)};d(q,Z=>{e(C)?Z(N):Z(F,!1)})}o(fe,x)},$$slots:{default:!0}})}Qe()}nt(["click"]);var Gn=i("<button><span> </span> <!></button>"),Wn=i('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),Hn=i('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),Jn=i('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function Kn(le,n){Re(n,!0);let r=G(()=>n.dateStore.start),l=G(()=>n.dateStore.end),v=Pe(null);function C(x){e(r)&&new Date(x)<new Date(e(r))?n.dateStore.setRange(x,e(l)):e(l)&&new Date(x)>new Date(e(l))?n.dateStore.setRange(e(r),x):n.dateStore.setRange(x,x)}function m(x){return!e(r)||!e(l)?{start:null,end:null}:e(r)&&new Date(x)<new Date(e(r))?{start:x,end:e(l)}:e(l)&&new Date(x)>new Date(e(l))?{start:e(r),end:x}:{start:x,end:x}}function Y(x){let q="";if(!e(r)||!e(l))return;const N=new Date(x)>=new Date(e(r))&&new Date(x)<=new Date(e(l)),F=new Date(x);F.setHours(F.getHours()+Cs);const Z=F<new Date;let ne=!1;if(e(v)){const h=m(e(v));h.start&&h.end&&(ne=new Date(x)>=new Date(h.start)&&new Date(x)<=new Date(h.end))}return Z&&(q+=" opacity-70 italic"),N||(q+=" btn-dash"),ne&&!N&&(q+=" btn-soft"),q}var W=Jn(),U=ye(W);He(U,20,()=>n.dateStore.dates,x=>x,(x,q)=>{var N=Gn();N.__click=()=>C(q);var F=a(N),Z=a(F,!0);t(F);var ne=s(F,2);{var h=f=>{Pa(f,{size:16})},k=f=>{var L=Le(),ae=ye(L);{var H=K=>{Ma(K,{size:16})},ce=K=>{var de=Le(),ve=ye(de);{var X=pe=>{qa(pe,{size:16})};d(ve,pe=>{St(q)==="cloud"&&pe(X)},!0)}o(K,de)};d(ae,K=>{St(q)==="moon"?K(H):K(ce,!1)},!0)}o(f,L)};d(ne,f=>{St(q)==="sun"?f(h):f(k,!1)})}t(N),_((f,L)=>{Ce(N,1,`btn btn-sm btn-secondary ${f??""}`),p(Z,L)},[()=>Y(q),()=>Zt(q)]),je("mouseenter",N,()=>E(v,q,!0)),je("mouseleave",N,()=>E(v,null)),o(x,N)}),t(U);var O=s(U,2);{var fe=x=>{var q=Wn();o(x,q)},T=x=>{var q=Hn(),N=a(q);N.__click=()=>n.dateStore.selectUpcoming();var F=s(N,2);F.__click=()=>n.dateStore.selectAll(),t(q),_(()=>{Ce(N,1,`join-item btn btn-sm ${n.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),Ce(F,1,`join-item btn btn-sm ${n.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),o(x,q)};d(O,x=>{n.dateStore.isEventPassed?x(fe):x(T,!1)})}o(le,W),Qe()}nt(["click"]);var Xn=i(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),Yn=i("<!> <!>",1),Zn=i("<button><!> </button>"),eo=i('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),to=i('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),ao=i('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),so=i("<button> </button>"),ro=i('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),no=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),oo=i("<button> </button>"),io=i('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),lo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),vo=i('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <div class="flex flex-col"><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!> <!></div>',1);function co(le,n){Re(n,!0);const r=G(()=>A.filters),l=G(()=>A.uniqueStores),v=G(()=>A.uniqueWho),C=G(()=>A.uniqueProductTypes);var m=vo(),Y=ye(m),W=a(Y),U=a(W);Ua(U,{class:"h-5 w-5"}),Te(),t(W);var O=s(W,2);O.__click=()=>A.clearFilters();var fe=a(O);ta(fe,{class:"h-4 w-4"}),Te(),t(O),t(Y);var T=s(Y,2),x=a(T),q=s(a(x),2),N=a(q);fs(N,{class:"h-4 w-4"});var F=s(N,2);dt(F),F.__input=M=>A.setSearchQuery(M.currentTarget.value);var Z=s(F,2);Z.__click=()=>A.setSearchQuery("");var ne=a(Z);va(ne,{class:"h-4 w-4"}),t(Z),t(q),t(x);var h=s(x,2),k=s(a(h),2),f=a(k);f.__click=()=>A.setCompletionStatus("all");var L=s(f,2);L.__click=()=>A.setCompletionStatus("incomplete");var ae=s(L,2);ae.__click=()=>A.setCompletionStatus("completed"),t(k),t(h);var H=s(h,2),ce=s(a(H),2),K=a(ce);K.__click=()=>A.setGroupBy("none");var de=s(K,2);de.__click=()=>A.setGroupBy("store");var ve=s(de,2);ve.__click=()=>A.setGroupBy("productType"),t(ce),t(H);var X=s(H,2);{var pe=M=>{na(M,{legend:"Date incluses",bgClass:"bg-base-100",children:(se,ge)=>{var j=Yn(),ee=ye(j);Kn(ee,{get dateStore(){return A.dateStore}});var y=s(ee,2);{var $=re=>{var te=Xn();ts(3,te,()=>ss),o(re,te)};d(y,re=>{A.hasPastDatesInRange&&re($)})}o(se,j)},$$slots:{default:!0}})};d(X,M=>{A.hasSingleDateEvent||M(pe)})}var be=s(X,2);{var ue=M=>{na(M,{legend:"Types & Température",get iconComponent(){return _s},children:(se,ge)=>{var j=ao(),ee=ye(j);He(ee,20,()=>e(C),w=>w,(w,J)=>{const _e=G(()=>Aa(J));var he=Zn();he.__click=()=>A.toggleProductType(J);var c=a(he);ia(c,()=>e(_e).icon,(P,B)=>{B(P,{class:"mr-1 h-5 w-5"})});var u=s(c);t(he),_(P=>{Ce(he,1,`btn btn-sm ${P??""}`),p(u,` ${e(_e).displayName??""}`)},[()=>e(r).selectedProductTypes.length===0?"btn-soft btn-secondary":e(r).selectedProductTypes.includes(J)?"btn-secondary":"btn-dash btn-secondary"]),o(w,he)}),t(ee);var y=s(ee,2),$=a(y);$.__click=()=>A.setTemperatureFilter("all");var re=s($,2);re.__click=()=>A.setTemperatureFilter("frais");var te=a(re);ha(te,{class:"h-4 w-4"}),Te(),t(re);var R=s(re,2);R.__click=()=>A.setTemperatureFilter("not-frais");var D=a(R);ha(D,{class:"h-4 w-4"}),Te(2),t(R);var I=s(R,2);I.__click=()=>A.setTemperatureFilter("surgele");var ke=a(I);xa(ke,{class:"h-4 w-4"}),Te(),t(I);var z=s(I,2);z.__click=()=>A.setTemperatureFilter("not-surgele");var g=a(z);xa(g,{class:"h-4 w-4"}),Te(2),t(z),t(y);var S=s(y,2);{var b=w=>{var J=eo();J.__click=()=>A.clearTypeAndTemperatureFilters();var _e=a(J);ta(_e,{size:16}),t(J),o(w,J)},V=w=>{var J=to();o(w,J)};d(S,w=>{e(r).selectedProductTypes.length>0||e(r).selectedTemperatures.length>0||e(r).temperatureFilter!=="all"?w(b):w(V,!1)})}_(()=>{Ce($,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),Ce(re,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),Ce(R,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),Ce(I,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),Ce(z,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),je("mouseenter",$,()=>Oe.msg="Ne pas filter en fonction des températures"),je("mouseleave",$,()=>Oe.reset()),je("mouseenter",re,()=>Oe.msg="Afficher les produits frais uniquement"),je("mouseleave",re,()=>Oe.reset()),je("mouseenter",R,()=>Oe.msg="Exclure les produits frais"),je("mouseleave",R,()=>Oe.reset()),je("mouseenter",I,()=>Oe.msg="Afficher les produits surgelés uniquement"),je("mouseleave",I,()=>Oe.reset()),je("mouseenter",z,()=>Oe.msg="Exclure les produits surgelé"),je("mouseleave",z,()=>Oe.reset()),o(se,j)},$$slots:{default:!0}})};d(be,M=>{e(C).length>0&&M(ue)})}var me=s(be,2);{var Q=M=>{na(M,{legend:"Magasins",get iconComponent(){return vt},children:(se,ge)=>{var j=no(),ee=a(j);He(ee,16,()=>e(l),re=>re,(re,te)=>{var R=so();R.__click=()=>A.toggleStore(te);var D=a(R,!0);t(R),_(I=>{Ce(R,1,`btn btn-sm ${I??""}`),p(D,te)},[()=>e(r).selectedStores.length===0?"btn-soft btn-secondary":e(r).selectedStores.includes(te)?"btn-secondary":"btn-dash btn-secondary"]),o(re,R)});var y=s(ee,2);{var $=re=>{var te=ro();te.__click=()=>A.clearStoreFilters();var R=a(te);ta(R,{size:16}),t(te),o(re,te)};d(y,re=>{e(r).selectedStores.length>0&&re($)})}t(j),o(se,j)},$$slots:{default:!0}})};d(me,M=>{e(l).length>0&&M(Q)})}var ie=s(me,2);{var oe=M=>{na(M,{legend:"Qui",get iconComponent(){return Yt},children:(se,ge)=>{var j=lo(),ee=a(j);He(ee,16,()=>e(v),re=>re,(re,te)=>{var R=oo();R.__click=()=>A.toggleWho(te);var D=a(R,!0);t(R),_(I=>{Ce(R,1,`btn btn-sm ${I??""}`),p(D,te)},[()=>e(r).selectedWho.length===0?" btn-soft btn-secondary":e(r).selectedWho.includes(te)?" btn-secondary":"btn-dash btn-secondary"]),o(re,R)});var y=s(ee,2);{var $=re=>{var te=io();te.__click=()=>A.clearWhoFilters();var R=a(te);ta(R,{size:16}),t(te),o(re,te)};d(y,re=>{e(r).selectedWho.length>0&&re($)})}t(j),o(se,j)},$$slots:{default:!0}})};d(ie,M=>{e(v).length>0&&M(oe)})}t(T),_(()=>{O.disabled=!A.hasFilters,Ds(F,e(r).searchQuery),Z.disabled=!e(r).searchQuery,Ce(f,1,`btn flex-1 ${e(r).completionStatus==="all"&&"btn-primary"}`),Ce(L,1,`btn flex-1 ${e(r).completionStatus==="incomplete"&&"btn-warning"}`),Ce(ae,1,`btn flex-1 ${e(r).completionStatus==="completed"&&"btn-success"}`),Ce(K,1,`btn flex-1 ${e(r).groupBy==="none"&&"btn-secondary"}`),Ce(de,1,`btn flex-1 ${e(r).groupBy==="store"&&"btn-secondary"}`),Ce(ve,1,`btn flex-1 ${e(r).groupBy==="productType"&&"btn-secondary"}`)}),o(le,m),Qe()}nt(["click","input"]);var uo=i('<div class="tooltip text-xs font-normal"><!></div>');function mo(le,n){let r=De(n,"iconSize",3,24),l=n.icon||void 0;var v=uo(),C=a(v);{var m=Y=>{l(Y,{get size(){return r()},class:`align-top
`})};d(C,Y=>{n.icon&&Y(m)})}t(v),_(()=>ma(v,"data-tip",n.tip)),o(le,v)}var po=i('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function La(le,n){Re(n,!0);let r=De(n,"recipes",19,()=>[]);const l=n.dateDisplayInfo.timeIcon==="sun"?Pa:n.dateDisplayInfo.timeIcon==="moon"?Ma:n.dateDisplayInfo.timeIcon==="cloud"?qa:null;var v=po(),C=a(v),m=a(C),Y=a(m,!0);t(m);var W=s(m,2);{var U=O=>{l(O,{class:"h-3 w-3 stroke-3"})};d(W,O=>{l&&O(U)})}t(C),t(v),_(O=>{ma(v,"data-tip",O),p(Y,n.dateDisplayInfo.formattedDate)},[()=>r().map(O=>O.r).join(", ")]),o(le,v),Qe()}var fo=as("<title> </title>"),_o=as("<svg><!><use></use></svg>");function go(le,n){let r=De(n,"size",3,24),l=De(n,"class",3,""),v=Ya(n,["$$slots","$$events","$$legacy","name","size","title","class"]);var C=_o();Xa(C,()=>({width:r(),height:r(),class:l(),"aria-hidden":n.title?void 0:"true",...v}));var m=a(C);{var Y=U=>{var O=fo(),fe=a(O,!0);t(O),_(()=>p(fe,n.title)),o(U,O)};d(m,U=>{n.title&&U(Y)})}var W=s(m);t(C),_(()=>ma(W,"href",`/icons/sprite.svg#${n.name??""}`)),o(le,C)}var bo=i('<div class="text-base-content/60 text-sm font-normal"> </div>'),ho=i('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),xo=i('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),yo=i('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),wo=i('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),ko=i('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),So=i('<div class="ml-1"><!></div>'),Po=i('<div class="ml-1"> </div> <!>',1),Mo=i('<div class="ml-1 text-sm font-medium">?</div>'),qo=i('<span class="text-base-content/50 text-xs"> </span>'),Co=i('<div class="ml-1 flex gap-1"> <!></div>'),Do=i('<div class="ml-1 text-sm font-medium">?</div>'),Ao=i('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),To=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),Io=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),Eo=i('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),Oo=i('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),zo=i('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),$o=i("<span> </span>"),No=i('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),jo=i('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),Fo=i(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle des
                besoins: <!> <!></span></div>`),Lo=i('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Bo=i('<span class="text-xs opacity-75"><!></span>'),Ro=i('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Qo=i('<div class="text-base-content/50 text-xs italic">aucun</div>'),Vo=i('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 group hover:ring-accent/60 relative flex flex-1 cursor-pointer flex-wrap items-start justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm hover:ring-2"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>');function Uo(le,n){Re(n,!0);const r={Package:ya,MessageCircleQuestionMark:ht,ShoppingCart:ht,Clock:Ha,CircleCheck:xs,CircleX:hs,ClipboardCheck:bs,PackageCheck:Wa,Check:ua},l=G(()=>n.productModel.data),v=G(()=>n.productModel.stats),C=G(()=>Aa(e(l).productType)),m=G(()=>Ls(e(l).purchases||[])),Y=G(()=>e(l).totalNeededOverrideParsed),W=G(()=>es(e(l)));var U=Vo(),O=a(U),fe=a(O),T=a(fe);T.__click=()=>n.onOpenModal(e(l).$id,"recettes"),T.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var x=a(T),q=a(x);ia(q,()=>e(C).icon,(c,u)=>{u(c,{class:"h-4 w-4"})});var N=s(q),F=s(N);{var Z=c=>{var u=bo(),P=a(u);t(u),_(()=>p(P,`Ancien: ${e(l).previousNames[0]??""}`)),o(c,u)};d(F,c=>{e(l).previousNames&&e(l).previousNames.length>0&&c(Z)})}var ne=s(F,2);{var h=c=>{var u=ho(),P=a(u);Ea(P,{class:"text-warning h-4 w-4"}),t(u),o(c,u)};d(ne,c=>{e(l).productHugoUuid||c(h)})}t(x);var k=s(x,2),f=a(k);{var L=c=>{var u=xo(),P=a(u);ha(P,{class:"text-success h-4 w-4"}),t(u),o(c,u)};d(f,c=>{e(l).pF&&c(L)})}var ae=s(f,2);{var H=c=>{var u=yo(),P=a(u);xa(P,{class:"text-info h-4 w-4"}),t(u),o(c,u)};d(ae,c=>{e(l).pS&&c(H)})}t(k);var ce=s(k,2);{var K=c=>{var u=wo(),P=a(u);Ga(P,{class:"h-4 w-4 animate-spin"}),t(u),o(c,u)};d(ce,c=>{e(l).status==="isSyncing"&&c(K)})}var de=s(ce,2);{var ve=c=>{var u=ko(),P=a(u);He(P,20,()=>e(v).concernedDates,B=>B,(B,xe)=>{const Se=G(()=>e(v).recipesByDate.get(xe)||[]),we=G(()=>n.productModel.data.dateDisplayInfo[xe]||ja(xe));La(B,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(P),t(u),o(c,u)};d(de,c=>{!We.isMobile&&e(v).concernedDates.length>0&&c(ve)})}t(T);var X=s(T,2);{var pe=c=>{var u=Ao(),P=a(u);P.__click=()=>n.onOpenModal(e(l).$id,"magasins"),P.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"magasins");var B=a(P);vt(B,{size:18});var xe=s(B,2);{var Se=Fe=>{var Ue=Po(),et=ye(Ue),tt=a(et,!0);t(et);var ze=s(et,2);{var Ie=Ee=>{var Ge=So(),Ye=a(Ge);mo(Ye,{get tip(){return e(l).storeInfo.storeComment},get icon(){return ys},iconSize:14}),t(Ge),o(Ee,Ge)};d(ze,Ee=>{e(l).storeInfo?.storeComment&&Ee(Ie)})}_(()=>p(tt,e(l).storeInfo.storeName)),o(Fe,Ue)},we=Fe=>{var Ue=Mo();o(Fe,Ue)};d(xe,Fe=>{e(l).storeInfo?.storeName?Fe(Se):Fe(we,!1)})}t(P);var Me=s(P,2);Me.__click=()=>n.onOpenModal(e(l).$id,"volontaires"),Me.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"volontaires");var qe=a(Me);Et(qe,{size:18});var Ve=s(qe,2);{var Je=Fe=>{var Ue=Le(),et=ye(Ue);{var tt=Ie=>{var Ee=Co(),Ge=a(Ee),Ye=s(Ge);{var $e=Ae=>{var Be=qo(),ot=a(Be);t(Be),_(()=>p(ot,`+${e(l).who.length-2}`)),o(Ae,Be)};d(Ye,Ae=>{e(l).who.length>2&&Ae($e)})}t(Ee),_(Ae=>p(Ge,`${Ae??""}... `),[()=>e(l).who.slice(0,2).map(Ae=>Ae.slice(0,5)).join(" | ")]),o(Ie,Ee)},ze=Ie=>{var Ee=Le(),Ge=ye(Ee);{var Ye=$e=>{var Ae=at();_(()=>p(Ae,e(l).who)),o($e,Ae)};d(Ge,$e=>{e(l).who.length===1&&$e(Ye)},!0)}o(Ie,Ee)};d(et,Ie=>{e(l).who.length>1?Ie(tt):Ie(ze,!1)})}o(Fe,Ue)},st=Fe=>{var Ue=Do();o(Fe,Ue)};d(Ve,Fe=>{e(l).who&&e(l).who.length?Fe(Je):Fe(st,!1)})}t(Me),t(u),_(()=>{Ce(P,1,`btn btn-soft btn-xs sm:btn-sm group relative ${e(l).storeInfo?.storeName?"btn-success":""}`),Ce(Me,1,`btn btn-xs sm:btn-sm btn-soft group relative ${e(l).who&&e(l).who?.length>0?"btn-success":""}`)}),je("mouseenter",P,()=>Oe.msg="Définissez le magasin où acheter le produit"),je("mouseleave",P,()=>Oe.reset()),je("mouseenter",Me,()=>Oe.msg="Déclarez qui est responsable de l'achat de ce produit"),je("mouseleave",Me,()=>Oe.reset()),o(c,u)},be=c=>{var u=Eo(),P=a(u);{var B=we=>{var Me=To(),qe=a(Me);vt(qe,{size:16});var Ve=s(qe);t(Me),_(()=>p(Ve,` ${e(l).storeInfo.storeName??""}`)),o(we,Me)};d(P,we=>{e(l).storeInfo?.storeName&&we(B)})}var xe=s(P,2);{var Se=we=>{var Me=Io(),qe=a(Me);Et(qe,{size:16});var Ve=s(qe);t(Me),_(Je=>p(Ve,` ${Je??""}`),[()=>e(l).who.join(", ")]),o(we,Me)};d(xe,we=>{e(l).who&&e(l).who.length>0&&we(Se)})}t(u),o(c,u)};d(X,c=>{n.shouldShowActionButtons?c(pe):c(be,!1)})}t(fe);var ue=s(fe,2);{var me=c=>{var u=Oo(),P=a(u);He(P,20,()=>e(v).concernedDates,B=>B,(B,xe)=>{const Se=G(()=>e(v).recipesByDate.get(xe)||[]),we=G(()=>n.productModel.data.dateDisplayInfo[xe]||ja(xe));La(B,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(P),t(u),o(c,u)};d(ue,c=>{We.isMobile&&e(v).concernedDates.length>0&&c(me)})}var Q=s(ue,2),ie=a(Q),oe=s(a(ie),2);oe.__click=()=>n.onOpenModal(e(l).$id,"recettes"),oe.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var M=a(oe),se=a(M),ge=a(se);{var j=c=>{var u=zo(),P=a(u),B=a(P,!0);t(P);var xe=s(P,2);Ea(xe,{class:"h-4 w-4"});var Se=s(xe);t(u),_(()=>{p(B,e(v).formattedQuantities),p(Se,` ${e(Y).totalOverride.q??""}
                  ${e(Y).totalOverride.u??""}`)}),o(c,u)},ee=c=>{var u=$o(),P=a(u,!0);t(u),_(()=>p(P,e(v).formattedQuantities)),o(c,u)};d(ge,c=>{e(Y)?.totalOverride?c(j):c(ee,!1)})}t(se);var y=s(se,2);{var $=c=>{var u=No(),P=a(u),B=a(P),xe=s(B);ca(xe,{class:"h-3 w-3"}),t(P);var Se=s(P,2),we=a(Se),Me=s(we);ka(Me,{class:"h-3 w-3"}),t(Se),t(u),_(()=>{p(B,`${e(v).nbRecipes??""} `),p(we,`${e(v).totalAssiettes??""} `)}),o(c,u)};d(y,c=>{(e(v).nbRecipes||e(v).totalAssiettes)&&c($)})}t(M);var re=s(M,2);{var te=c=>{var u=jo();u.__click=we=>{we.stopPropagation(),n.onQuickValidation(e(l),e(v))};var P=a(u),B=s(a(P));t(P);var xe=s(P,2),Se=a(xe);go(Se,{name:"add-to-cart",size:16}),t(xe),t(u),_(()=>p(B,` ${e(v).formattedMissingQuantities??""}`)),je("mouseenter",u,()=>Oe.msg="Ajouter aux achats effectués"),je("mouseleave",u,()=>Oe.reset()),o(c,u)},R=c=>{var u=Le(),P=ye(u);{var B=xe=>{Ja(xe,{size:24,class:"text-success ms-auto"})};d(P,xe=>{n.shouldShowActionButtons&&xe(B)},!0)}o(c,u)};d(re,c=>{n.shouldShowActionButtons&&e(v).hasMissing?c(te):c(R,!1)})}var D=s(re,2);{var I=c=>{var u=Fo(),P=a(u);Sa(P,{size:18});var B=s(P,2),xe=s(a(B));{var Se=qe=>{var Ve=at();_(()=>p(Ve,`${e(W).details?.oldPlates??""}→${e(W).details?.newPlates??""} couverts`)),o(qe,Ve)};d(xe,qe=>{e(W).platesChanged&&qe(Se)})}var we=s(xe,2);{var Me=qe=>{var Ve=at();_(()=>p(Ve,`${e(W).details?.oldRecipes??""}→${e(W).details?.newRecipes??""}
                  recettes`)),o(qe,Ve)};d(we,qe=>{e(W).recipesChanged&&qe(Me)})}t(B),t(u),o(c,u)};d(D,c=>{n.shouldShowActionButtons&&e(W)?.hasMismatch&&c(I)})}t(oe),t(ie);var ke=s(ie,2),z=s(a(ke),2);z.__click=()=>n.onOpenModal(e(l).$id,"achats"),z.__keydown=c=>c.key==="Enter"&&n.onOpenModal(e(l).$id,"achats");var g=a(z);ht(g,{class:"h-4 w-4 opacity-60"});var S=s(g,2),b=s(S,2),V=a(b);{var w=c=>{var u=Lo(),P=a(u),B=a(P);gs(B,{class:"text-secondary h-4 w-4"});var xe=s(B,2),Se=a(xe);t(xe),t(P);var we=s(P,2),Me=a(we);t(we),t(u),_(qe=>{p(Se,`${e(l).stockParsed.quantity??""}
                    ${e(l).stockParsed.unit??""}`),p(Me,`stock: ${qe??""}`)},[()=>Zt(e(l).stockParsed.dateTime)]),o(c,u)};d(V,c=>{e(l).stockParsed&&c(w)})}var J=s(V,2);He(J,17,()=>e(m),xt,(c,u)=>{const P=G(()=>r[e(u).icon]);var B=Ro(),xe=a(B),Se=a(xe);ia(Se,()=>e(P),(Je,st)=>{st(Je,{class:"h-4 w-4"})});var we=s(Se,2),Me=a(we);t(we),t(xe);var qe=s(xe,2);{var Ve=Je=>{var st=Bo(),Fe=a(st);{var Ue=tt=>{var ze=at();_(()=>p(ze,`livré le: ${e(u).deliveryDate??""}`)),o(tt,ze)},et=tt=>{var ze=at("livraison ?");o(tt,ze)};d(Fe,tt=>{e(u).deliveryDate?tt(Ue):tt(et,!1)})}t(st),o(Je,st)};d(qe,Je=>{e(u).status==="ordered"&&Je(Ve)})}t(B),_(()=>{Ce(B,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${e(u).badgeClass??""}`),p(Me,`${e(u).quantity??""}
                    ${e(u).unit??""}`)}),o(c,B)});var _e=s(J,2);{var he=c=>{var u=Qo();o(c,u)};d(_e,c=>{e(m).length===0&&!e(l)?.stockParsed&&c(he)})}t(b),t(z),t(ke),t(Q),t(O),t(U),_(()=>{Ce(U,1,`card bg-base-100 ${(We.isMobile&&"border-base-300 border shadow")??""} ${e(l).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),p(N,`${e(l).productName??""} `),Ce(se,1,`text-base font-bold ${e(v).hasMissing&&n.shouldShowActionButtons?"text-error":"text-success"}`),Ce(S,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${n.shouldShowActionButtons?"group-hover:block":"hidden"} sm:hidden`)}),je("mouseenter",T,()=>Oe.msg="Afficher les informations sur ce produit"),je("mouseleave",T,()=>Oe.reset()),je("mouseenter",oe,()=>Oe.msg="Afficher les informations sur ce produit"),je("mouseleave",oe,()=>Oe.reset()),je("mouseenter",z,()=>Oe.msg="Déclarez des achats effectués"),je("mouseleave",z,()=>Oe.reset()),o(le,U),Qe()}nt(["click","keydown"]);var Go=i('<div class="text-primary-content flex items-center gap-2"><!> </div>'),Wo=i('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),Ho=i('<div class="font-semibold">Sur toute la période</div>'),Jo=i('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),Ko=i('le <span class="font-semibold"> </span>',1),Xo=i('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),Yo=i('<span class="font-semibold"> </span>'),Zo=i('le <span class="font-semibold"> </span>',1),ei=i('<div class="text-primary-content"><!></div>'),ti=i(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),ai=i('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),si=i('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),ri=i('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),ni=i('<div><!> <div class="mt-4 mb-8 space-y-4 sm:space-y-2"></div></div>'),oi=i('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),ii=i('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),li=i('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),di=i('<span class="block text-[9pt] font-normal opacity-60"> </span>'),vi=i('<div class="font-medium"> </div>'),ci=i('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),ui=i('<div class="font-medium"> </div>'),mi=i('<div class="text-[9pt] opacity-70"> </div>'),pi=i('<div class="flex gap-6"><!> <!></div>'),fi=i('<span class="text-xs opacity-70"> </span>'),_i=i('<div class="text-nowrap"> </div>'),gi=i('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),bi=i('<div class="text-nowrap"> </div>'),hi=i('<div class="flex flex-col items-end gap-0.5"></div>'),xi=i('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),yi=i('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),wi=i("<span>Aucune recette pour le moment</span>"),ki=i("<span>Aucun produit trouvé avec les filtres actuels</span>"),Si=i('<div class="py-8 text-center"><div class="alert alert-info max-md:alert-vertical"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Pi=i('<div><!> <div class="hidden w-full print:block"></div></div> <!>',1);function Mi(le,n){Re(n,!0);let r=De(n,"disabled",3,!1);const l=G(()=>A.groupedFilteredProducts),v=A.filters,C=_t(A.dateStore.start),m=_t(A.dateStore.end),Y=G(()=>!A.dateStore.isEventPassed&&!A.dateStore.hasPastDatesInRange),W=G(()=>v.completionStatus==="completed"?"bg-emerald-800":v.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");let U=Xe([]),O=Pe(Xe(new Map));mt(()=>{const Z=Object.keys(e(l));U.forEach((ne,h)=>{if(!ne)return;const k=Z[h];k&&As(()=>ne,f=>{const L=f[0];if(!L)return;const ae=L.intersectionRatio>=.05;E(O,new Map(e(O)).set(k,ae),!0)},{threshold:[0,.05,1]})})});var fe=Pi(),T=ye(fe),x=a(T);He(x,19,()=>Object.entries(e(l)),([Z,ne])=>Z,(Z,ne,h)=>{var k=G(()=>la(e(ne),2));let f=()=>e(k)[0];const ae=G(()=>e(k)[1]);var H=ni(),ce=a(H);{var K=ve=>{const X=G(()=>Aa(f())),pe=G(()=>e(O).get(f())??!0);var be=ri(),ue=a(be),me=a(ue);{var Q=y=>{var $=Go(),re=a($);vt(re,{class:"size-4 md:size-5"});var te=s(re);t($),_(()=>p(te,` ${f()??""} (${e(ae).length??""})`)),o(y,$)},ie=y=>{var $=Le(),re=ye($);{var te=D=>{var I=Wo(),ke=a(I);ia(ke,()=>e(X).icon,(V,w)=>{w(V,{class:"size-4 md:size-5"})});var z=s(ke,2),g=a(z,!0);t(z);var S=s(z,2),b=a(S);t(S),t(I),_(()=>{p(g,e(X).displayName),p(b,`(${e(ae).length??""})`)}),o(D,I)},R=D=>{var I=at();_(()=>p(I,`📦 ${f()??""} (${e(ae).length??""})`)),o(D,I)};d(re,D=>{v.groupBy==="productType"?D(te):D(R,!1)},!0)}o(y,$)};d(me,y=>{v.groupBy==="store"?y(Q):y(ie,!1)})}t(ue);var oe=s(ue,2);{var M=y=>{var $=Xo(),re=a($);{var te=D=>{var I=Ho();o(D,I)},R=D=>{var I=Le(),ke=ye(I);{var z=S=>{var b=Jo(),V=s(ye(b)),w=a(V,!0);t(V);var J=s(V,2),_e=a(J,!0);t(J),_((he,c)=>{p(w,he),p(_e,c)},[()=>kt(A.dateStore.start),()=>kt(A.dateStore.end)]),o(S,b)},g=S=>{var b=Ko(),V=s(ye(b)),w=a(V,!0);t(V),_(J=>p(w,J),[()=>kt(A.dateStore.start)]),o(S,b)};d(ke,S=>{A.dateStore.start!==A.dateStore.end?S(z):S(g,!1)},!0)}o(D,I)};d(re,D=>{A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?D(te):D(R,!1)})}t($),o(y,$)},se=y=>{var $=ei(),re=a($);{var te=D=>{var I=Yo(),ke=a(I);t(I),_((z,g)=>p(ke,`${z??""} → ${g??""}`),[()=>kt(A.dateStore.start),()=>kt(A.dateStore.end)]),o(D,I)},R=D=>{var I=Zo(),ke=s(ye(I)),z=a(ke,!0);t(ke),_(g=>p(z,g),[()=>kt(A.dateStore.start,!0)]),o(D,I)};d(re,D=>{!A.dateStore.isFullRange&&A.dateStore.start!==A.dateStore.end?D(te):D(R,!1)})}t($),o(y,$)};d(oe,y=>{We.isMobile?y(se,!1):y(M)})}var ge=s(oe,2);{var j=y=>{var $=ai(),re=a($);re.__click=()=>n.onOpenGroupEditModal("store",e(ae).map(S=>S.data.$id),e(ae).map(S=>S.data));var te=a(re);vt(te,{size:16});var R=s(te,4);gt(R,{size:16}),t(re);var D=s(re,2);D.__click=()=>n.onOpenGroupEditModal("who",e(ae).map(S=>S.data.$id),e(ae).map(S=>S.data));var I=a(D);Et(I,{size:16});var ke=s(I,4);gt(ke,{size:16}),t(D);var z=s(D,2);{var g=S=>{var b=ti();b.__click=()=>n.onOpenGroupPurchaseModal(e(ae).map(J=>J.data));var V=a(b);ht(V,{size:16});var w=s(V,4);Ja(w,{size:16}),t(b),je("mouseenter",b,()=>Oe.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),je("mouseleave",b,()=>Oe.reset()),o(S,b)};d(z,S=>{e(ae).some(b=>b.data.displayMissingQuantity!=="✅ Complet")&&S(g)})}t($),je("mouseenter",re,()=>Oe.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),je("mouseleave",re,()=>Oe.reset()),je("mouseenter",D,()=>Oe.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),je("mouseleave",D,()=>Oe.reset()),o(y,$)},ee=y=>{var $=Le(),re=ye($);{var te=R=>{var D=si(),I=a(D),ke=a(I);Ha(ke,{size:16}),Te(2),t(I),t(D),o(R,D)};d(re,R=>{A.dateStore.hasPastDatesInRange&&R(te)},!0)}o(y,$)};d(ge,y=>{e(Y)?y(j):y(ee,!1)})}t(be),_(()=>Ce(be,1,`${e(W)??""} @container sticky ${We.isMobile?"top-12":"top-13 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md transition-opacity duration-300 @md:flex-nowrap print:shadow-none ${e(pe)?"opacity-100":"pointer-events-none opacity-0"}`)),o(ve,be)};d(ce,ve=>{f()!==""&&ve(K)})}var de=s(ce,2);He(de,21,()=>e(ae),ve=>ve.data.$id,(ve,X)=>{Uo(ve,{get productModel(){return e(X)},get shouldShowActionButtons(){return e(Y)},get onOpenModal(){return n.onOpenModal},get onQuickValidation(){return n.onQuickValidation}})}),t(de),t(H),Ts(H,(ve,X)=>U[X]=ve,ve=>U?.[ve],()=>[e(h)]),o(Z,H)});var q=s(x,2);He(q,21,()=>Object.entries(e(l)),([Z,ne])=>Z,(Z,ne)=>{var h=G(()=>la(e(ne),2));let k=()=>e(h)[0],f=()=>e(h)[1];var L=yi(),ae=a(L);{var H=ue=>{var me=oi(),Q=a(me),ie=a(Q),oe=s(ie),M=a(oe);t(oe);var se=s(oe,2),ge=a(se);{var j=y=>{var $=at("Toute la période");o(y,$)},ee=y=>{var $=Le(),re=ye($);{var te=D=>{var I=at();_(()=>p(I,`du ${C??""} au ${m??""}`)),o(D,I)},R=D=>{var I=at();_(()=>p(I,`le ${C??""}`)),o(D,I)};d(re,D=>{A.dateStore.start!==A.dateStore.end?D(te):D(R,!1)},!0)}o(y,$)};d(ge,y=>{A.dateStore.isFullRange?y(j):y(ee,!1)})}t(se),t(Q),t(me),_(()=>{p(ie,`${(k()==="Non défini"?"Groupe inconnu":k())??""} `),p(M,`(${f().length??""} produits)`)}),o(ue,me)};d(ae,ue=>{k()!==""&&ue(H)})}var ce=s(ae,2),K=a(ce),de=a(K),ve=s(a(de),3);{var X=ue=>{var me=ii();o(ue,me)},pe=ue=>{var me=li();o(ue,me)};d(ve,ue=>{v.groupBy==="store"?ue(X):ue(pe,!1)})}Te(),t(de),t(K);var be=s(K);He(be,21,f,ue=>ue.data.$id,(ue,me)=>{const Q=G(()=>e(me).data),ie=G(()=>e(me).stats);var oe=xi(),M=s(a(oe)),se=a(M),ge=s(se);{var j=b=>{var V=di(),w=a(V);t(V),_(()=>p(w,`(Ancien: ${e(Q).previousNames[0]??""})`)),o(b,V)};d(ge,b=>{e(Q).previousNames&&e(Q).previousNames.length>0&&b(j)})}t(M);var ee=s(M),y=a(ee);{var $=b=>{var V=at();_(()=>p(V,`${e(Q).totalNeededOverrideParsed.totalOverride.q??""}
                    ${e(Q).totalNeededOverrideParsed.totalOverride.u??""}`)),o(b,V)},re=b=>{var V=at();_(()=>p(V,e(ie).formattedQuantities)),o(b,V)};d(y,b=>{e(Q).totalNeededOverrideParsed?.totalOverride?b($):b(re,!1)})}t(ee);var te=s(ee),R=a(te);{var D=b=>{var V=ci(),w=a(V);{var J=c=>{var u=vi(),P=a(u,!0);t(u),_(B=>p(P,B),[()=>e(Q).who.join(", ")]),o(c,u)};d(w,c=>{e(Q).who?.length&&c(J)})}var _e=s(w,2),he=a(_e,!0);t(_e),t(V),_(()=>p(he,e(Q).productType||"Autre")),o(b,V)},I=b=>{var V=pi(),w=a(V);{var J=c=>{var u=ui(),P=a(u,!0);t(u),_(()=>p(P,e(Q).storeInfo.storeName)),o(c,u)};d(w,c=>{e(Q).storeInfo?.storeName&&c(J)})}var _e=s(w,2);{var he=c=>{var u=mi(),P=a(u,!0);t(u),_(B=>p(P,B),[()=>e(Q).who.join(", ")]),o(c,u)};d(_e,c=>{e(Q).who?.length&&c(he)})}t(V),o(b,V)};d(R,b=>{v.groupBy==="store"?b(D):b(I,!1)})}t(te);var ke=s(te),z=a(ke);{var g=b=>{var V=gi(),w=a(V),J=a(w),_e=s(J);{var he=P=>{var B=fi(),xe=a(B);t(B),_(Se=>p(xe,`(${Se??""})`),[()=>Zt(e(Q).stockParsed.dateTime)]),o(P,B)};d(_e,P=>{e(Q).stockParsed?.dateTime&&P(he)})}t(w);var c=s(w,2);{var u=P=>{var B=Le(),xe=ye(B);He(xe,17,()=>e(Q).purchases,xt,(Se,we)=>{var Me=_i(),qe=a(Me);t(Me),_(()=>p(qe,`${e(we).quantity??""} ${e(we).unit??""}`)),o(Se,Me)}),o(P,B)};d(c,P=>{e(Q).purchases?.length&&P(u)})}t(V),_(()=>p(J,`📦 ${e(Q).stockParsed.quantity??""} `)),o(b,V)},S=b=>{var V=Le(),w=ye(V);{var J=_e=>{var he=hi();He(he,21,()=>e(Q).purchases,xt,(c,u)=>{var P=bi(),B=a(P);t(P),_(()=>p(B,`${e(u).quantity??""} ${e(u).unit??""}`)),o(c,P)}),t(he),o(_e,he)};d(w,_e=>{e(Q).purchases?.length&&_e(J)},!0)}o(b,V)};d(z,b=>{e(Q).stockParsed?b(g):b(S,!1)})}t(ke),t(oe),_(()=>p(se,`${e(Q).productName??""} `)),o(ue,oe)}),t(be),t(ce),t(L),o(Z,L)}),t(q),t(T);var N=s(T,2);{var F=Z=>{var ne=Si(),h=a(ne),k=s(a(h),2);{var f=ae=>{var H=wi();o(ae,H)},L=ae=>{var H=ki();o(ae,H)};d(k,ae=>{n.currentEvent&&n.currentEvent.meals&&n.currentEvent.meals.length>0&&n.currentEvent.meals.every(H=>!H.recipes||H.recipes.length===0)?ae(f):ae(L,!1)})}t(h),t(ne),o(Z,ne)};d(N,Z=>{Object.values(e(l)).flat().length===0&&Z(F)})}_(()=>Ce(T,1,`space-y-4 rounded-lg print:hidden ${r()?"pointer-events-none opacity-60":""}`)),o(le,fe),Qe()}nt(["click"]);var qi=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Ci=i('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),Di=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Ai=i("<!> ",1),Ti=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Ii=i("<!> <!> <!>",1);function Ei(le,n){Re(n,!0);let r=Pe(!1),l=Pe(null),v=Pe(null),C=Pe(Xe(n.products.length>0&&n.products[0].storeInfo?n.products[0].storeInfo.storeName:"")),m=Pe(Xe(n.products.length>0&&n.products[0].storeInfo&&n.products[0].storeInfo.storeComment||"")),Y=Pe(Xe({})),W=Pe("empty");mt(()=>{const F={};n.products.forEach(Z=>{n.productIds.includes(Z.$id)&&(e(W)==="empty"?F[Z.$id]=!Z.storeInfo||!Z.storeInfo.storeName:F[Z.$id]=!0)}),E(Y,F,!0)});const U=G(()=>n.products.map(F=>({id:F.$id,label:F.productName,title:F.productName,selected:e(Y)[F.$id]}))),O=G(()=>e(U).filter(F=>F.selected)),fe=G(()=>`Attribuer un magasin (${e(O).length} produits sélectionnés)`),T=G(()=>e(O).length===0?!1:e(C).trim().length>0);async function x(){if(!e(T)||e(r))return;E(l,null),E(v,null);const F=e(O).map(h=>h.id),Z=n.products.filter(h=>F.includes(h.$id));A.setSyncStatus(F,!0),We.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${F.length} produits)`,progress:0},n.onClose();const ne={storeName:e(C).trim(),storeComment:e(m).trim()};try{const h=await Ot.track(A.batchUpdateProducts(F,Z,"store",ne).then(k=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${k.success?"succès":"échec"}, ${k.updatedCount} produits modifiés`),!k.success)throw new Error(k.error||"Erreur lors de la mise à jour");return k}),{loading:`Mise à jour du magasin pour ${F.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});n.onSuccess?.(h)}catch(h){console.error("[StoreEditModal] Erreur mise à jour:",h),A.clearSyncStatus()}finally{E(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function q(){e(r)||n.onClose()}function N(F){e(Y)[F]=!e(Y)[F]}Pt(le,{isOpen:!0,onClose:q,children:(F,Z)=>{var ne=Ii(),h=ye(ne);yt(h,{get title(){return e(fe)},onClose:q,children:(L,ae)=>{vt(L,{class:"text-secondary"})},$$slots:{default:!0}});var k=s(h,2);Mt(k,{children:(L,ae)=>{var H=Ci(),ce=a(H);{var K=M=>{var se=qi(),ge=a(se);da(ge,{class:"h-4 w-4"});var j=s(ge,2),ee=a(j,!0);t(j),t(se),_(()=>p(ee,e(l))),o(M,se)};d(ce,M=>{e(l)&&M(K)})}var de=s(ce,2),ve=a(de),X=a(ve);qt(X,{get suggestions(){return A.uniqueStores},get disabled(){return e(r)},id:"store-name-input",get value(){return e(C)},set value(M){E(C,M,!0)}}),t(ve);var pe=s(ve,2),be=a(pe);Ct(be,{get disabled(){return e(r)},id:"store-comment-textarea",get value(){return e(m)},set value(M){E(m,M,!0)}}),t(pe),t(de);var ue=s(de,2),me=s(a(ue),2),Q=a(me);Q.__click=()=>E(W,"empty");var ie=s(Q,2);ie.__click=()=>E(W,"all"),t(me);var oe=s(me,2);zt(oe,{get items(){return e(U)},onToggleItem:N,size:"sm",color:"success"}),t(ue),t(H),_(()=>{Ce(Q,1,`tab ${e(W)==="empty"?"tab-active":""}`),Ce(ie,1,`tab ${e(W)==="all"?"tab-active":""}`)}),o(L,H)}});var f=s(k,2);pa(f,{children:(L,ae)=>{var H=Ti(),ce=ye(H);ce.__click=q;var K=s(ce,2);K.__click=x;var de=a(K);{var ve=pe=>{var be=Di();Te(),o(pe,be)},X=pe=>{var be=Ai(),ue=ye(be);ua(ue,{class:"h-4 w-4"});var me=s(ue);_(()=>p(me,` Appliquer à ${e(O).length??""} produit(s)`)),o(pe,be)};d(de,pe=>{e(r)?pe(ve):pe(X,!1)})}t(K),_(()=>{ce.disabled=e(r),K.disabled=e(r)||!e(T)}),o(L,H)}}),o(F,ne)},$$slots:{default:!0}}),Qe()}nt(["click"]);var Oi=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),zi=i(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),$i=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Ni=i("<!> ",1),ji=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Fi=i("<!> <!> <!>",1);function Li(le,n){Re(n,!0);let r=Pe(!1),l=Pe(null),v=Pe(Xe([])),C=Pe(""),m=Pe("empty"),Y=Pe(Xe({}));mt(()=>{const h={};n.products.forEach(k=>{n.productIds.includes(k.$id)&&(e(m)==="empty"?h[k.$id]=!k.who||k.who.length===0:h[k.$id]=!0)}),E(Y,h,!0)});const W=G(()=>n.products.map(h=>({id:h.$id,label:h.productName,title:h.productName,selected:e(Y)[h.$id]}))),U=G(()=>e(W).filter(h=>h.selected)),O=G(()=>{const h=new Set([...A.uniqueWho,...e(v)]);return Array.from(h).map(k=>({id:k,label:k,selected:e(v).includes(k)}))}),fe=G(()=>`Gérer les volontaires (${e(U).length} produit${e(U).length>1?"s":""})`),T=G(()=>e(U).length===0?!1:e(v).length>0);async function x(){if(!e(T)||e(r))return;E(l,null);const h=e(U).map(f=>f.id),k=n.products.filter(f=>h.includes(f.$id));A.setSyncStatus(h,!0),We.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${h.length} produits)`,progress:0},n.onClose();try{await Ot.track(A.batchUpdateProducts(h,k,"who",{names:e(v)}).then(f=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${f.success?"succès":"échec"}, ${f.updatedCount} produits modifiés`),!f.success)throw new Error(f.error||"Erreur lors de la mise à jour");return A.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),n.onSuccess?.(f),f}),{loading:`Mise à jour des mandatés pour ${h.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(f){console.error("[WhoEditModal] Erreur mise à jour:",f),A.clearSyncStatus()}finally{E(r,!1),We.backgroundOperation={isRunning:!1,name:"",progress:0}}}function q(h){const k=h.trim();k&&!e(v).includes(k)&&E(v,[...e(v),k],!0)}function N(h){E(v,e(v).filter(k=>k!==h),!0)}function F(h){e(v).includes(h)?N(h):q(h)}function Z(){e(C).trim()&&(q(e(C)),E(C,""))}function ne(h){e(Y)[h]=!e(Y)[h]}Pt(le,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(h,k)=>{var f=Fi(),L=ye(f);yt(L,{get title(){return e(fe)},showBackButton:!0,get onClose(){return n.onClose}});var ae=s(L,2);Mt(ae,{children:(ce,K)=>{var de=zi(),ve=a(de);{var X=te=>{var R=Oi(),D=a(R);da(D,{class:"h-4 w-4"});var I=s(D,2),ke=a(I,!0);t(I),t(R),_(()=>p(ke,e(l))),o(te,R)};d(ve,te=>{e(l)&&te(X)})}var pe=s(ve,2),be=s(a(pe),2),ue=a(be),me=a(ue);ea(me,{get disabled(){return e(r)},onkeydown:te=>{te.key==="Enter"&&(te.preventDefault(),Z())},get value(){return e(C)},set value(te){E(C,te,!0)}}),t(ue);var Q=s(ue,2);Q.__click=Z;var ie=a(Q);Va(ie,{size:16}),t(Q),t(be);var oe=s(be,2),M=a(oe),se=s(M,2);zt(se,{get items(){return e(O)},onToggleItem:F,size:"lg",color:"info"}),t(oe),t(pe);var ge=s(pe,2),j=a(ge),ee=s(a(j),2),y=a(ee);y.__click=()=>E(m,"empty");var $=s(y,2);$.__click=()=>E(m,"all"),t(ee),t(j);var re=s(j,2);zt(re,{get items(){return e(W)},onToggleItem:ne,size:"sm",color:"success"}),t(ge),t(de),_(te=>{Q.disabled=te,Ce(M,1,`text-base-content/70 mb-2 hidden text-sm ${(e(O).length&&"inline")??""}`),Ce(y,1,`btn btn-sm ${e(m)==="empty"&&"btn-secondary"}`),Ce($,1,`btn btn-sm ${e(m)==="all"&&"btn-secondary"}`)},[()=>e(r)||!e(C).trim()]),o(ce,de)}});var H=s(ae,2);pa(H,{children:(ce,K)=>{var de=ji(),ve=ye(de);ve.__click=function(...me){n.onClose?.apply(this,me)};var X=s(ve,2);X.__click=x;var pe=a(X);{var be=me=>{var Q=$i();Te(),o(me,Q)},ue=me=>{var Q=Ni(),ie=ye(Q);ua(ie,{class:"h-4 w-4"});var oe=s(ie);_(()=>p(oe,` Appliquer à ${e(U).length??""} produit${e(U).length>1?"s":""}`)),o(me,Q)};d(pe,me=>{e(r)?me(be):me(ue,!1)})}t(X),_(()=>{ve.disabled=e(r),X.disabled=e(r)||!e(T)}),o(ce,de)}}),o(h,f)},$$slots:{default:!0}}),Qe()}nt(["click"]);var Bi=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Ri=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Qi=i('<button class="btn btn-primary btn-sm"><!> Ajouter une dépense</button>'),Vi=i('<span class="loading loading-spinner loading-xs"></span>'),Ui=i('<div class="text-error mt-2 text-xs"> </div>'),Gi=i('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),Wi=i('<span class="text-base-content/70 italic"> </span>'),Hi=i('<span class="text-base-content/50 ml-1 text-xs"> </span>'),Ji=i('<span class="font-medium"> </span> <!>',1),Ki=i('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),Xi=i('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),Yi=i('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),Zi=i('<div class="text-sm italic opacity-70"> </div>'),el=i('<div class="text-xs opacity-60"> </div>'),tl=i('<div class="text-sm font-medium"> </div> <!>',1),al=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),sl=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),rl=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),nl=i('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),ol=i('<div class="space-y-3"><!> <!></div>'),il=i('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),ll=i("<!> <!>",1);function dl(le,n){Re(n,!0);let r=De(n,"isOpen",15,!1),l=Pe(!1),v=Pe(null),C=Pe(!1),m=Pe(Xe({invoiceTotal:0,store:"",notes:"",who:""})),Y=Pe(null);mt(()=>{if(r()&&!e(Y)){const k=localStorage.getItem("appwrite-user-name");k&&(e(m).who=k)}});let W=Pe("date"),U=Pe("desc"),O=G(()=>A.financialStats),fe=G(()=>e(O).allPurchases),T=G(()=>{let k=[...e(fe)];return k.sort((f,L)=>{let ae,H;switch(e(W)){case"date":ae=new Date(f.orderDate||f.$createdAt).getTime(),H=new Date(L.orderDate||L.$createdAt).getTime();break;case"amount":ae=f.invoiceTotal||f.price||0,H=L.invoiceTotal||L.price||0;break;case"store":ae=(f.store||"").toLowerCase(),H=(L.store||"").toLowerCase();break;case"who":ae=(f.who||"").toLowerCase(),H=(L.who||"").toLowerCase();break}return ae<H?e(U)==="asc"?-1:1:ae>H?e(U)==="asc"?1:-1:0}),k});function x(k){e(W)===k?E(U,e(U)==="asc"?"desc":"asc",!0):(E(W,k,!0),E(U,"desc"))}async function q(){if(!e(m).invoiceTotal||e(m).invoiceTotal<=0){E(v,"Le montant doit être supérieur à 0");return}E(l,!0),E(v,null);try{const k=A.currentMainId;if(!k)throw new Error("Aucun événement principal actif");e(Y)?await Is(e(Y),{price:e(m).invoiceTotal,invoiceTotal:e(m).invoiceTotal,store:e(m).store,notes:e(m).notes,who:e(m).who}):await Es(k,void 0,e(m).invoiceTotal,e(m).store,e(m).notes,e(m).who),N()}catch(k){console.error("Erreur sauvegarde dépense:",k),E(v,k.message,!0)}finally{E(l,!1)}}function N(){const k=localStorage.getItem("appwrite-user-name")||"";E(m,{invoiceTotal:0,store:"",notes:"",who:k},!0),E(Y,null),E(C,!1)}function F(k){E(m,{invoiceTotal:k.invoiceTotal||k.price||0,store:k.store||"",notes:k.notes||"",who:k.who||""},!0),E(Y,k.$id,!0),E(C,!0)}function Z(){r(!1),N(),E(v,null)}function ne(k){return k?new Date(k).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function h(k){return(k||0).toFixed(2)+" €"}Pt(le,{get isOpen(){return r()},onClose:Z,maxWidth:"lg",children:(k,f)=>{var L=ll(),ae=ye(L);yt(ae,{title:"Gestion des Dépenses",onClose:Z});var H=s(ae,2);Mt(H,{children:(ce,K)=>{var de=il(),ve=a(de),X=a(ve),pe=a(X),be=s(a(pe),2),ue=a(be,!0);t(be);var me=s(be,2),Q=a(me);t(me),t(pe),t(X);var ie=s(X,2),oe=s(a(ie),2);He(oe,21,()=>Object.entries(e(O).byStore).sort((D,I)=>I[1]-D[1]),xt,(D,I)=>{var ke=G(()=>la(e(I),2));let z=()=>e(ke)[0],g=()=>e(ke)[1];var S=Bi(),b=a(S),V=a(b,!0);t(b);var w=s(b,2),J=a(w,!0);t(w),t(S),_(_e=>{p(V,z()),p(J,_e)},[()=>h(g())]),o(D,S)}),t(oe),t(ie);var M=s(ie,2),se=s(a(M),2);He(se,21,()=>Object.entries(e(O).byWho).sort((D,I)=>I[1]-D[1]),xt,(D,I)=>{var ke=G(()=>la(e(I),2));let z=()=>e(ke)[0],g=()=>e(ke)[1];var S=Ri(),b=a(S),V=a(b,!0);t(b);var w=s(b,2),J=a(w,!0);t(w),t(S),_(_e=>{p(V,z()),p(J,_e)},[()=>h(g())]),o(D,S)}),t(se),t(M),t(ve);var ge=s(ve,2),j=s(a(ge),2);{var ee=D=>{var I=Qi();I.__click=()=>E(C,!0);var ke=a(I);Dt(ke,{class:"mr-1 h-4 w-4"}),Te(),t(I),o(D,I)};d(j,D=>{e(C)||D(ee)})}t(ge);var y=s(ge,2);{var $=D=>{var I=Gi(),ke=a(I),z=a(ke),g=a(z,!0);t(z);var S=s(z,2),b=a(S);Ta(b,{get disabled(){return e(l)},get value(){return e(m).invoiceTotal},set value(we){e(m).invoiceTotal=we}});var V=s(b,2);qt(V,{get suggestions(){return A.uniqueStores},get disabled(){return e(l)},get value(){return e(m).store},set value(we){e(m).store=we}});var w=s(V,2);ea(w,{get suggestions(){return A.uniqueWho},get disabled(){return e(l)},get value(){return e(m).who},set value(we){e(m).who=we}});var J=s(w,2);Ct(J,{get disabled(){return e(l)},get value(){return e(m).notes},set value(we){e(m).notes=we}}),t(S);var _e=s(S,2),he=a(_e);he.__click=N;var c=s(he,2);c.__click=q;var u=a(c);{var P=we=>{var Me=Vi();o(we,Me)};d(u,we=>{e(l)&&we(P)})}var B=s(u);t(c),t(_e);var xe=s(_e,2);{var Se=we=>{var Me=Ui(),qe=a(Me,!0);t(Me),_(()=>p(qe,e(v))),o(we,Me)};d(xe,we=>{e(v)&&we(Se)})}t(ke),t(I),_(()=>{p(g,e(Y)?"Modifier la dépense":"Nouvelle Dépense"),c.disabled=e(l),p(B,` ${e(Y)?"Enregistrer":"Ajouter"}`)}),o(D,I)};d(y,D=>{e(C)&&D($)})}var re=s(y,2);{var te=D=>{var I=Yi(),ke=a(I),z=a(ke),g=a(z),S=a(g);S.__click=()=>x("date");var b=a(S);t(S);var V=s(S,2);V.__click=()=>x("store");var w=a(V);t(V);var J=s(V);J.__click=()=>x("who");var _e=a(J);t(J);var he=s(J);he.__click=()=>x("amount");var c=a(he);t(he);var u=s(he),P=a(u);ws(P,{size:14}),t(u),t(g),t(z);var B=s(z),xe=a(B);He(xe,17,()=>e(T),Me=>Me.$id,(Me,qe)=>{var Ve=Ki(),Je=a(Ve),st=a(Je,!0);t(Je);var Fe=s(Je),Ue=a(Fe);{var et=Ke=>{var Ze=Wi(),it=a(Ze,!0);t(Ze),_(()=>p(it,e(qe).notes||"-")),o(Ke,Ze)},tt=Ke=>{var Ze=Ji(),it=ye(Ze),pt=a(it,!0);t(it);var ft=s(it,2);{var bt=ct=>{var lt=Hi(),wt=a(lt);t(lt),_(()=>p(wt,`- ${e(qe).notes??""}`)),o(ct,lt)};d(ft,ct=>{e(qe).notes&&ct(bt)})}_(()=>p(pt,e(qe)._productName||"Produit inconnu")),o(Ke,Ze)};d(Ue,Ke=>{e(qe).status==="expense"?Ke(et):Ke(tt,!1)})}t(Fe);var ze=s(Fe),Ie=a(ze,!0);t(ze);var Ee=s(ze),Ge=a(Ee,!0);t(Ee);var Ye=s(Ee),$e=a(Ye,!0);t(Ye);var Ae=s(Ye),Be=a(Ae);Be.__click=()=>F(e(qe));var ot=a(Be);gt(ot,{size:14}),t(Be),t(Ae),t(Ve),_((Ke,Ze)=>{p(st,Ke),p(Ie,e(qe).store||"-"),p(Ge,e(qe).who||"-"),p($e,Ze)},[()=>ne(e(qe).orderDate||e(qe).$createdAt),()=>h(e(qe).invoiceTotal||e(qe).price)]),o(Me,Ve)});var Se=s(xe);{var we=Me=>{var qe=Xi();o(Me,qe)};d(Se,Me=>{e(T).length===0&&Me(we)})}t(B),t(ke),t(I),_(()=>{p(b,`Date ${e(W)==="date"?e(U)==="asc"?"↑":"↓":""}`),p(w,`Magasin ${e(W)==="store"?e(U)==="asc"?"↑":"↓":""}`),p(_e,`Qui ${e(W)==="who"?e(U)==="asc"?"↑":"↓":""}`),p(c,`Montant ${e(W)==="amount"?e(U)==="asc"?"↑":"↓":""}`)}),o(D,I)},R=D=>{var I=ol(),ke=a(I);He(ke,17,()=>e(T),S=>S.$id,(S,b)=>{var V=rl(),w=a(V),J=a(w),_e=a(J),he=a(_e),c=a(he);It(c,{class:"h-3.5 w-3.5"});var u=s(c,2),P=a(u,!0);t(u),t(he);var B=s(he,2),xe=a(B,!0);t(B),t(_e);var Se=s(_e,2);Se.__click=()=>F(e(b));var we=a(Se);gt(we,{size:16}),t(Se),t(J);var Me=s(J,2),qe=a(Me);{var Ve=ze=>{var Ie=Zi(),Ee=a(Ie,!0);t(Ie),_(()=>p(Ee,e(b).notes)),o(ze,Ie)},Je=ze=>{var Ie=tl(),Ee=ye(Ie),Ge=a(Ee,!0);t(Ee);var Ye=s(Ee,2);{var $e=Ae=>{var Be=el(),ot=a(Be,!0);t(Be),_(()=>p(ot,e(b).notes)),o(Ae,Be)};d(Ye,Ae=>{e(b).notes&&Ae($e)})}_(()=>p(Ge,e(b)._productName||"Produit inconnu")),o(ze,Ie)};d(qe,ze=>{e(b).status==="expense"&&e(b).notes?ze(Ve):ze(Je,!1)})}t(Me);var st=s(Me,2),Fe=a(st);{var Ue=ze=>{var Ie=al(),Ee=a(Ie);vt(Ee,{class:"h-3 w-3"});var Ge=s(Ee,2),Ye=a(Ge,!0);t(Ge),t(Ie),_(()=>p(Ye,e(b).store)),o(ze,Ie)};d(Fe,ze=>{e(b).store&&ze(Ue)})}var et=s(Fe,2);{var tt=ze=>{var Ie=sl(),Ee=a(Ie);Yt(Ee,{class:"h-3 w-3"});var Ge=s(Ee,2),Ye=a(Ge,!0);t(Ge),t(Ie),_(()=>p(Ye,e(b).who)),o(ze,Ie)};d(et,ze=>{e(b).who&&ze(tt)})}t(st),t(w),t(V),_((ze,Ie)=>{p(P,ze),p(xe,Ie)},[()=>Zt(e(b).orderDate||e(b).$createdAt),()=>h(e(b).invoiceTotal||e(b).price)]),o(S,V)});var z=s(ke,2);{var g=S=>{var b=nl(),V=a(b);Ka(V,{class:"mx-auto mb-3 h-12 w-12"}),Te(2),t(b),o(S,b)};d(z,S=>{e(T).length===0&&S(g)})}t(I),o(D,I)};d(re,D=>{We.isMobile?D(R,!1):D(te)})}t(de),_(D=>{p(ue,D),p(Q,`${e(fe).length??""} transactions`)},[()=>h(e(O).totalGlobal)]),o(ce,de)}}),o(k,L)},$$slots:{default:!0}}),Qe()}nt(["click"]);var vl=i('<div class="flex gap-2"><button class="btn btn-primary" title="Ajouter un produit manuellement"><!> Produit</button></div>'),cl=i('<div class="flex min-h-96 items-center justify-center"><div class="flex flex-col items-center gap-4"><!> <p class="text-base-content/60 text-sm">Chargement des produits...</p></div></div>'),ul=i("<!> ",1),ml=i("<!> ",1),pl=i('<div class="flex-grow py-4 print:hidden"><!></div>'),fl=i(`<div class="alert alert-warning alert-soft max-sm:alert-vertical self-center" id="info-past-event"><!> Toutes les dates de cet événement sont passées. Il n'est plus possible
            de modifier les produits.</div>`),_l=i('<div class="card card-xs sm:card-sm min-w-48 border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div> <div class="card-action mt-auto"><button class="btn btn-primary btn-soft w-full" title="Ajouter un produit manuellement"><!> Produit</button></div></div></div>'),gl=i("grace au bouton en bas à gauche <!>",1),bl=i(`<p>Cette page liste l'ensemble des produits présent dans les recettes de
        l'événement. La liste est <span class="font-semibold">mise à jour dès que les menus sont modifiés</span> (recettes ajoutées, supprimées, nombre de couvert modifié, etc.) Vous pouvez
        :</p> <ul class="svelte-1mshqfh"><li class="svelte-1mshqfh">Ajouter des produits non présent dans les recettes grace au bouton <kbd class="kbd kbd-sm">+ Produit</kbd> en haut à gauche</li> <li class="svelte-1mshqfh">Filtrer les produits par type, température, date, manquant etc. <!></li> <li class="svelte-1mshqfh">Déclarer des achats soit en cliquant dans la zone d'achat d'un
          produit, soit via le bouton <kbd class="kbd kbd-sm">manque ...</kbd> dans
          la colonne des besoins (déclare acheté la quantité manquante). Les achats
          peuvent être déclarés comme des 'commandes', et vous pouvez préciser la
          date de réception</li> <li class="svelte-1mshqfh">Déclarer tout un groupe de produit acheté via le bouton <kbd class="kbd kbd-sm">Achat groupé</kbd> dans l'entête de chaque groupe</li> <li class="svelte-1mshqfh">Définir des magasins ou vous mandater pour l'achat de produit
          (individuel ou par groupe) → <!> <!></li> <li class="svelte-1mshqfh">Modifier la quantité réclamée pour un produit. Si les recettes et
          menus sont modifié entre temps, la carte des besoin du produit
          indiquera que les quantités calculé ont changé depuis la modification
          manuelle des besoins déclarés pour ce produit. <p>Cela peut aussi servir a <span class="font-semibold">remplacer un produit par un autre</span> sans modifier les recettes</p></li> <li class="svelte-1mshqfh">Déclarer des dépenses indépendamment des achats (possible y compris
          après que l'événement soit fini)</li> <li class="svelte-1mshqfh">Visualiser l'ensemble des dépenses effectué, et par qui, en cliquant
          sur <kbd class="kbd">Dépenses</kbd> dans l'entête</li></ul> <p>Tous les membres des équipes ou individus invité à participer à
        l'événement peuvent modifier les produits, ajouter des achats, dépenses,
        etc.</p>`,1),hl=i('<!> <div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><h1> </h1> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-end gap-10"><!> <!> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow"><div class="card-body"><div class="card-title text-orange-800"><!> Dépenses</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <div class="card-action mt-auto"><button class="btn btn-soft btn-primary" title="Ajouter une dépense générale"><!> Voir, ajouter</button></div></div></div></div></div> <!> <!>',1),xl=i('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),yl=i('<div class="flex items-center justify-center"><!></div>'),wl=i('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),kl=i("<!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function jl(le,n){Re(n,!0);const r=g=>{var S=vl(),b=a(S);b.__click=X;var V=a(b);Dt(V,{class:"mr-1 h-4 w-4"}),Te(),t(b),t(S),_(()=>b.disabled=!e(ue)),o(g,S)},l="100";let v=Pe(null),C=Pe("recettes"),m=Pe(!1),Y=Pe(!1),W=Pe(Xe([])),U=Pe(Xe([])),O=Pe(!1),fe=Pe(Xe([])),T=Pe(!1),x=Pe(!0),q=Xe(n.params?.id);const N=G(()=>q?aa.getEventById(q):null),F=G(()=>e(N)?.status==="local"?"/demo/event":"/dashboard/eventEdit"),Z=G(()=>e(N)?.name??""),ne=G(()=>e(N)?.dateStart??null),h=G(()=>e(N)?.dateEnd??null),k=G(()=>e(h)&&new Date>new Date(e(h)));Os(async()=>{try{if(!q){console.error("[EventProductsPage] eventId est requis"),E(x,!1);return}if(await $s(),!await Ns(q)){console.error(`[EventProductsPage] Événement ${q} introuvable`),E(x,!1);return}const S=aa.getEventById(q);console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${S?.name}`),await A.initialize(q)}catch(g){console.error("[EventProductsPage] Erreur lors de l'initialisation:",g)}finally{E(x,!1)}});function f(g,S="recettes"){E(C,S,!0),E(v,g,!0)}function L(){E(v,null)}function ae(g,S,b){E(W,S,!0),E(U,b,!0),g==="who"?E(m,!0):E(Y,!0)}function H(g){(!g||g==="who")&&E(m,!1),(!g||g==="store")&&E(Y,!1),E(W,[],!0),E(U,[],!0)}function ce(g){console.log(`[ProductsTable] Modification groupée réussie: ${g.updatedCount} produits`)}function K(g){const S=g.filter(b=>A.getProductModelById(b.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${g.length} produits reçus → ${S.length} produits avec quantités manquantes`),E(fe,S,!0),E(O,!0)}function de(){E(O,!1),E(fe,[],!0)}function ve(){console.log("[ProductsTable] Achat groupé créé avec succès"),de()}function X(){E(T,!0)}async function pe(g,S){try{const b=S.missingQuantities||[];if(b.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const V=b.filter(w=>w.q<0).map(w=>({...w,q:Math.abs(w.q)})).map(w=>{const J=Tt.normalize(w.q,w.u);return{q:J.quantity,u:J.unit}});await A.createPurchase(g.$id,V,{store:g.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${g.productName}`)}catch(b){console.error("[ProductsTable] Erreur validation rapide:",b),alert("Erreur lors de la validation rapide: "+b.message)}}let be=Pe(!1);const ue=G(()=>aa.canUserEditEvent(q||"",We.userId||""));async function me(g){if(!(!q||!We.userId))try{E(x,!0);const S=g?"accepted":"declined";await aa.updateContributorStatus(q,We.userId,S),Ot.success(g?"Invitation acceptée":"Invitation déclinée")}catch(S){console.error("Erreur réponse invitation:",S),Ot.error("Erreur lors de la réponse")}finally{E(x,!1)}}mt(()=>{Fa.setConfig({eventId:q||void 0,basePath:e(F),actions:r})}),zs(()=>{Fa.reset()});var Q=kl(),ie=ye(Q);Qs(ie,{width:l,children:(g,S)=>{co(g,{})},$$slots:{default:!0}});var oe=s(ie,2),M=a(oe);{var se=g=>{var S=cl(),b=a(S),V=a(b);Ga(V,{class:"text-primary h-12 w-12 animate-spin"}),Te(2),t(b),t(S),o(g,S)},ge=g=>{var S=hl(),b=ye(S);Rs(b,{get currentEvent(){return e(N)},get isBusy(){return e(x)},onRespond:me});var V=s(b,2),w=a(V),J=a(w),_e=a(J,!0);t(J);var he=s(J,2),c=a(he);{var u=$e=>{var Ae=ul(),Be=ye(Ae);It(Be,{class:"inline h-4 w-4"});var ot=s(Be);_((Ke,Ze)=>p(ot,` ${Ke??""} au ${Ze??""}`),[()=>ba(e(ne)),()=>ba(e(h))]),o($e,Ae)},P=$e=>{var Ae=Le(),Be=ye(Ae);{var ot=Ke=>{var Ze=ml(),it=ye(Ze);It(it,{class:"inline h-4 w-4"});var pt=s(it);_(ft=>p(pt,` ${ft??""}`),[()=>ba(e(ne))]),o(Ke,Ze)};d(Be,Ke=>{e(ne)&&Ke(ot)},!0)}o($e,Ae)};d(c,$e=>{e(ne)&&e(h)?$e(u):$e(P,!1)})}t(he),t(w);var B=s(w,2);{var xe=$e=>{var Ae=pl(),Be=a(Ae);Bs(Be,{get currentEvent(){return e(N)}}),t(Ae),o($e,Ae)};d(B,$e=>{e(N)&&$e(xe)})}var Se=s(B,2),we=a(Se);{var Me=$e=>{var Ae=fl(),Be=a(Ae);Sa(Be,{size:20,class:"shrink-0"}),Te(),t(Ae),o($e,Ae)};d(we,$e=>{e(k)&&$e(Me)})}var qe=s(we,2);{var Ve=$e=>{var Ae=_l(),Be=a(Ae),ot=a(Be),Ke=a(ot);Wa(Ke,{class:"text-orange-800 opacity-60"}),Te(),t(ot);var Ze=s(ot,2),it=a(Ze),pt=a(it),ft=a(pt,!0);t(pt),Te(2),t(it),t(Ze);var bt=s(Ze,2),ct=a(bt);ct.__click=X;var lt=a(ct);Dt(lt,{class:"mr-1 h-4 w-4"}),Te(),t(ct),t(bt),t(Be),t(Ae),_(()=>{p(ft,A.completionStats.missing),ct.disabled=!e(ue)}),o($e,Ae)};d(qe,$e=>{e(k)||$e(Ve)})}var Je=s(qe,2),st=a(Je),Fe=a(st),Ue=a(Fe);Ka(Ue,{class:"text-orange-800 opacity-60"}),Te(),t(Fe);var et=s(Fe,2),tt=a(et);t(et);var ze=s(et,2),Ie=a(ze);Ie.__click=()=>E(be,!0);var Ee=a(Ie);Dt(Ee,{class:"size-4"}),Te(),t(Ie),t(ze),t(st),t(Je),t(Se),t(V);var Ge=s(V,2);Da(Ge,{title:"Aide",contentVisible:"Page de gestion des produits nécéssaire pour l'événement. Cliquer pour découvrir ce que vous pouvez y faire...",class:"shadow-info shadow",children:($e,Ae)=>{var Be=bl(),ot=s(ye(Be),2),Ke=s(a(ot),2),Ze=s(a(Ke));{var it=lt=>{var wt=gl(),ns=s(ye(wt));Ua(ns,{size:14}),o(lt,wt)},pt=lt=>{var wt=at("grace au menu de droite");o(lt,wt)};d(Ze,lt=>{We.isMobile?lt(it):lt(pt,!1)})}t(Ke);var ft=s(Ke,6),bt=s(a(ft));vt(bt,{size:14,class:"text-primary inline"});var ct=s(bt,2);Et(ct,{size:14,class:"text-primary inline"}),t(ft),Te(6),t(ot),Te(2),o($e,Be)},$$slots:{default:!0}});var Ye=s(Ge,2);{let $e=G(()=>!e(ue));Mi(Ye,{get currentEvent(){return e(N)},onOpenModal:f,onOpenGroupEditModal:ae,onOpenGroupPurchaseModal:K,onQuickValidation:pe,get disabled(){return e($e)}})}_(()=>{p(_e,e(Z)),p(tt,`${A.financialStats.totalGlobal??""} €`),Ie.disabled=!e(ue)}),je("mouseenter",Ie,()=>Oe.msg="Consulter ou modifie le détail des dépenses"),je("mouseleave",Ie,()=>Oe.reset()),o(g,S)};d(M,g=>{e(x)?g(se):g(ge,!1)})}var j=s(M,2);{let g=G(()=>e(v)||"");Un(j,{get productId(){return e(g)},get initialTab(){return e(C)},onClose:L})}var ee=s(j,2);{var y=g=>{Li(g,{get productIds(){return e(W)},get products(){return e(U)},onClose:()=>H("who"),onSuccess:ce})};d(ee,g=>{e(m)&&g(y)})}var $=s(ee,2);{var re=g=>{Ei(g,{get productIds(){return e(W)},get products(){return e(U)},onClose:()=>H("store"),onSuccess:ce})};d($,g=>{e(Y)&&g(re)})}var te=s($,2);{var R=g=>{nr(g,{get products(){return e(fe)},onClose:de,onSuccess:ve})};d(te,g=>{e(O)&&g(R)})}var D=s(te,2);fr(D,{get open(){return e(T)},set open(g){E(T,g,!0)}});var I=s(D,2);dl(I,{get isOpen(){return e(be)},set isOpen(g){E(be,g,!0)}});var ke=s(I,2);{var z=g=>{var S=wl(),b=a(S),V=a(b);{var w=_e=>{var he=xl(),c=a(he);Oa(c,{class:"me-2 size-5"});var u=s(c),P=s(u);P.__click=()=>Oe.collapse();var B=a(P);va(B,{class:"h-4 w-4"}),t(P),t(he),_(()=>p(u,` ${Oe.msg??""} `)),o(_e,he)},J=_e=>{var he=yl();he.__click=()=>Oe.expand();var c=a(he);Oa(c,{class:"size-6"}),t(he),o(_e,he)};d(V,_e=>{Oe.isExpanded?_e(w):_e(J,!1)})}t(b),t(S),_(()=>Ce(b,1,`rounded-tr-box bg-blue-100 text-blue-800 ${Oe.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),o(g,S)};d(ke,g=>{We.isDesktop&&g(z)})}t(oe),_(()=>Ce(oe,1,`space-y-6 pt-6 md:px-16 ${(We.isDesktop&&"ml-110 print:ml-0")??""} `)),o(le,Q),Qe()}nt(["click"]);export{jl as default};
