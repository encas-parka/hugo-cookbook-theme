var ds=Object.defineProperty;var Na=oe=>{throw TypeError(oe)};var vs=(oe,n,r)=>n in oe?ds(oe,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):oe[n]=r;var ya=(oe,n,r)=>vs(oe,typeof n!="symbol"?n+"":n,r),cs=(oe,n,r)=>n.has(oe)||Na("Cannot "+r);var je=(oe,n,r)=>(cs(oe,n,"read from private field"),r?r.call(oe):n.get(oe)),rt=(oe,n,r)=>n.has(oe)?Na("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(oe):n.set(oe,r);import{d as Re,p as De,v as i,g as s,h as a,a as Wa,r as Ha,K as d,w as g,C as Ce,T as pt,b as o,c as Ve,m as e,u as L,o as t,B as tt,W as vt,M as Ct,ag as us,ah as Ja,z as Ze,y as qe,J as bt,A as z,k as he,a3 as T,x as f,I as Ke,O as zt,G as Ae,e as Je,i as _t,S as Ee,al as Fa,aP as ms,aQ as ps,aR as $t,aA as Ot,aS as ua,U as et,j as ze,aT as Ba,aU as fs,aV as Ka,aW as La,P as St,aX as qt,ai as _s,aY as bs,ad as gs,aZ as Te,ab as Nt,f as Xa,a_ as Ra,a$ as hs,R as xs,t as ma,b0 as ys,b1 as ws,X as ks,$ as la,Y as Ss,D as Ps,aH as Ms}from"./appwrite.js";import{c as xt,a as ra,b as qs,D as Mt}from"./date-helpers.js";import{B as Ft}from"./BtnGroupCheck.js";import{S as Ma,I as qa}from"./InfoCollapse.js";import{aP as ct,j as na,aQ as Ya,T as pa,ax as kt,ab as Ca,am as Cs,aR as Da,c as jt,b as Ds,aa as yt,aS as As,t as Bt,aT as Za,X as fa,ai as Ts,aU as es,a2 as ts,a as _a,a7 as Aa,x as Ta,aH as Is,aV as Es,aM as Ia,aN as Ea,s as $a,U as Lt,G as ba,w as as,F as Et,S as $s,aW as ka,ao as Sa,al as Os,aX as Va,f as js,aY as zs,aZ as ss,a_ as Ns,C as Fs,i as Bs,aw as rs,a$ as ns,b0 as Ls,P as Rs,b1 as os,a0 as Qa}from"./icons.js";import{M as Dt,b as Pt,c as At,d as ga,s as Pa,a as Oa,e as Vs,n as Ua}from"./index.js";import{a as Qs,b as da,c as va,g as ja,d as Us,f as wa}from"./products-display.js";import{F as ca}from"./Fieldset.js";import{E as Gs}from"./EventStats.js";import{E as Ws}from"./EventInvitationAlert.js";import{L as Hs}from"./LeftPanel.js";import{B as Js}from"./BadgeEventStatus.js";import"./CheckboxBadge.js";import"./event-stats-helpers.js";var Ks=i('<div><label class="input w-72"><!> <input/></label> <!></div>');function Tt(oe,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),q=De(n,"flexCol",3,!1),p=Ha(n,["$$slots","$$events","$$legacy","value","suggestions","disabled","flexCol"]);const K=L(()=>l().map(C=>({id:C,label:C,disabled:C===r()})));var R=Ks(),B=a(R),E=a(B);ct(E,{class:"h-4 w-4 opacity-50"});var ne=s(E,2);Wa(ne,()=>({type:"text",placeholder:"Magasin",maxlength:"50",disabled:v(),...p}),void 0,void 0,void 0,void 0,!0),t(B);var A=s(B,2);{var x=C=>{Ma(C,{get suggestions(){return e(K)},onSuggestionClick:F=>r(F.label),buttonSize:"btn-xs"})};d(A,C=>{l().length>0&&C(x)})}t(R),g(()=>Ce(R,1,`flex ${q()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`)),pt(ne,r),o(oe,R),Ve()}var Xs=i('<div><label class="input w-72"><!> <input type="text" placeholder="Qui" maxlength="25"/></label> <!></div>');function oa(oe,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"suggestions",19,()=>[]),v=De(n,"disabled",3,!1),q=De(n,"flexCol",3,!1);const p=L(()=>l().map(x=>({id:x,label:x,disabled:x===r()})));var K=Xs(),R=a(K),B=a(R);na(B,{class:"h-4 w-4 opacity-50"});var E=s(B,2);vt(E),E.__keydown=function(...x){n.onkeydown?.apply(this,x)},t(R);var ne=s(R,2);{var A=x=>{Ma(x,{get suggestions(){return e(p)},onSuggestionClick:C=>r(C.label),buttonSize:"btn-xs"})};d(ne,x=>{l().length>0&&x(A)})}t(K),g(()=>{Ce(K,1,`flex ${q()?"flex-col":"flex-wrap"} items-baseline gap-x-4 gap-y-1`),E.disabled=v()}),pt(E,r),o(oe,K),Ve()}tt(["keydown"]);var Ys=i('<div class="flex flex-col"><span class="label">Informations complémentaires (optionnel)</span> <textarea class="textarea w-full text-sm" placeholder="Commentaire (optionnel)" rows="2" maxlength="250"></textarea></div>');function It(oe,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Ys(),q=s(a(v),2);us(q),t(v),g(()=>{q.disabled=l(),Ct(q,"id",n.id)}),pt(q,r),o(oe,v),Ve()}var Zs=i('<label class="input w-28"><!> <input type="number" step="1" min="0" placeholder="0.00"/></label>');function za(oe,n){Re(n,!0);let r=De(n,"value",15),l=De(n,"disabled",3,!1);var v=Zs(),q=a(v);Ya(q,{class:"h-4 w-4 opacity-50"});var p=s(q,2);vt(p),t(v),g(()=>p.disabled=l()),pt(p,r),o(oe,v),Ve()}var er=i('<label class="input w-fit"><span class="label">Date de livraison</span> <input type="date"/></label>'),tr=i(`<div class="flex w-full flex-wrap gap-4"><div class="flex flex-col"><select class="custom-select input w-52"><option selected>Acheté</option><option>Commandé</option></select> <div>Modifiez s'il s'agit d'une commande</div></div> <!></div>`);function is(oe,n){Re(n,!0);let r=De(n,"status",15),l=De(n,"deliveryDate",15),v=De(n,"disabled",3,!1);var q=tr(),p=a(q),K=a(p),R=a(K);R.value=R.__value="delivered";var B=s(R);B.value=B.__value="ordered",t(K);var E=s(K,2);t(p);var ne=s(p,2);{var A=x=>{var C=er(),F=s(a(C),2);vt(F),t(C),g(()=>F.disabled=v()),pt(F,l),o(x,C)};d(ne,x=>{r()==="ordered"&&x(A)})}t(q),g(()=>{K.disabled=v(),Ce(E,1,`label text-xs ${r()==="delivered"?"":"hidden"}`)}),Ja(K,r),o(oe,q),Ve()}var ar=i('<div class="alert alert-error"><!> <span> </span></div>'),sr=i(`<p>Cette fonctionnalité permet de créer un achat groupé pour plusieurs
            produits en une seule fois. Les quantités déclarées dans les achats
            correspondront aux quantités manquantes <strong>pour la période sélectionnée</strong>, c'est à dire le besoin total pour chaque produit sur cette
            période moins les achats ou stocks déjà déclarés.</p> <p>Pour le suivi des dépenses, vous pouvez renseigner votre nom et le
            montant dépensé.</p>`,1),rr=i('<div><h4 class="mb-2 font-medium">Produits concernés</h4> <div class="text-base-content/70 mb-4 text-sm">Les quantités manquantes du <span class="badge badge-info badge-sm"> </span> au <span class="badge badge-info badge-sm"> </span> pour les produits suivants seront déclarées "achetées"</div> <!></div>'),nr=i('<div class="alert alert-warning alert-soft font-medium">Aucun besoin dans le groupe séléctionné</div>'),or=i(`<div class="space-y-6"><!> <div><!></div> <div class="space-y-4"><h4 class="font-medium">Détails de l'achat</h4> <div class="flex flex-col gap-4 sm:flex-row"><div class="flex-1"><!></div> <div class="flex-1"><!></div></div> <!> <!> <!></div> <!></div>`),ir=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),lr=i('<!> <span>Valider <span class="hidden sm:inline"> </span></span>',1),dr=i('<div class="flex"><button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button></div>'),vr=i("<!> <!> <!>",1);function cr(oe,n){Re(n,!0);let r=qe(!1),l=qe(null),v=Ze({store:"",who:"",expense:null,notes:"",status:"delivered",deliveryDate:null}),q=qe(Ze(new Set));bt(()=>{z(q,new Set(n.products.map(A=>A.$id)),!0)});const p=L(()=>n.products.filter(A=>e(q).has(A.$id))),K=L(()=>e(p).length!==0),R=L(()=>{const A=T.dateRange;let x="";return A?.start&&A?.end&&(A.start===A.end?x=` - ${xt(A.start)}`:x=` - Du ${xt(A.start)} au ${xt(A.end)}`),`Achat groupé (${e(p).length} produit${e(p).length>1?"s":""})${x}`});async function B(){if(!e(K)||e(r))return;z(r,!0),z(l,null);const A=`FACTURE_${Date.now()}`,x=e(p).map(U=>U.$id);T.setSyncStatus(x,!0),Ke.backgroundOperation={isRunning:!0,name:`Achat groupé (${e(p).length} produits)`,progress:0};const C=[];for(const U of e(p)){const ae=(T.getProductModelById(U.$id)?.stats.missingQuantities||[]).filter(y=>y.q<0).map(y=>({q:Math.abs(y.q),u:y.u}));C.push({productId:U.$id,isSynced:U.isSynced,missingQuantities:ae})}const F={invoiceId:A,invoiceTotal:v.expense||void 0,store:v.store.trim()||void 0,notes:v.notes||`Achat groupé pour ${e(p).length} produits`,who:v.who.trim()||void 0,purchaseStatus:v.status||"delivered",purchaseDeliveryDate:v.deliveryDate||null};console.log(`[GroupPurchaseModal] Création achat groupé avec sync pour ${C.length} produits...`),n.onClose();try{await zt.track(T.createGroupPurchase(C,F).then(U=>{if(console.log(`[GroupPurchaseModal] Achat groupé créé: ${U.success?"succès":"échec"}, ${U.totalProductsCreated} produits synchronisés, ${U.totalPurchasesCreated} achats créés, ${U.totalExpensesCreated} dépenses globales`),!U.success)throw new Error(U.error||"Erreur lors de la création de l'achat groupé");return T.clearSyncStatus(),console.log("[GroupPurchaseModal] ✅ Sync status cleared on success"),n.onSuccess?.(),U}),{loading:"Création de l'achat groupé en cours...",success:"Achat groupé créé avec succès",error:"Erreur lors de la création de l'achat groupé"})}catch(U){console.error("[GroupPurchaseModal] Erreur création achat groupé:",U),T.clearSyncStatus()}finally{z(r,!1),Ke.backgroundOperation={isRunning:!1,name:"",progress:0}}}function E(A){const x=new Set(e(q));x.has(A)?x.delete(A):x.add(A),z(q,x,!0)}const ne=L(()=>n.products.map(A=>{const x=T.getProductModelById(A.$id);return{id:A.$id,label:A.productName,title:`${A.productName} - Manque: ${x?.stats.formattedMissingQuantities||"-"}`,badge:x?.stats.formattedMissingQuantities||"-"}}));Dt(oe,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,children:(A,x)=>{var C=vr(),F=he(C);Pt(F,{get title(){return e(R)},showBackButton:!0,get onClose(){return n.onClose}});var U=s(F,2);At(U,{children:(ae,y)=>{var k=or(),b=a(k);{var V=$=>{var re=ar(),xe=a(re);pa(xe,{class:"h-4 w-4"});var ee=s(xe,2),ie=a(ee,!0);t(ee),t(re),g(()=>f(ie,e(l))),o($,re)};d(b,$=>{e(l)&&$(V)})}var Y=s(b,2),H=a(Y);qa(H,{contentVisible:"Un 'achat' sera créé avec les quantités manquantes pour chaque produit sur la période sélectionnée.",class:"bg-base-200",children:($,re)=>{var xe=sr();Ae(2),o($,xe)},$$slots:{default:!0}}),t(Y);var ue=s(Y,2),W=s(a(ue),2),ce=a(W),le=a(ce);Tt(le,{get suggestions(){return T.uniqueStores},get disabled(){return e(r)},get value(){return v.store},set value($){v.store=$}}),t(ce);var X=s(ce,2),de=a(X);oa(de,{get suggestions(){return T.uniqueWho},get disabled(){return e(r)},get value(){return v.who},set value($){v.who=$}}),t(X),t(W);var be=s(W,2);za(be,{get disabled(){return e(r)},get value(){return v.expense},set value($){v.expense=$}});var me=s(be,2);is(me,{get disabled(){return e(r)},get status(){return v.status},set status($){v.status=$},get deliveryDate(){return v.deliveryDate},set deliveryDate($){v.deliveryDate=$}});var ve=s(me,2);It(ve,{get disabled(){return e(r)},get value(){return v.notes},set value($){v.notes=$}}),t(ue);var Q=s(ue,2);{var se=$=>{var re=rr(),xe=s(a(re),2),ee=s(a(xe)),ie=a(ee,!0);t(ee);var P=s(ee,2),I=a(P,!0);t(P),Ae(),t(xe);var _e=s(xe,2);Ft(_e,{get items(){return e(ne)},onToggleItem:E,size:"sm",color:"success"}),t(re),g((ge,te)=>{f(ie,ge),f(I,te)},[()=>xt(T.dateRange.start),()=>xt(T.dateRange.end)]),o($,re)},Z=$=>{var re=nr();o($,re)};d(Q,$=>{e(ne).length>0?$(se):$(Z,!1)})}t(k),o(ae,k)}});var G=s(U,2);ga(G,{children:(ae,y)=>{var k=dr(),b=a(k);b.__click=function(...W){n.onClose?.apply(this,W)};var V=s(b,2);V.__click=B;var Y=a(V);{var H=W=>{var ce=ir();Ae(),o(W,ce)},ue=W=>{var ce=lr(),le=he(ce);kt(le,{class:"h-4 w-4"});var X=s(le,2),de=s(a(X)),be=a(de);t(de),t(X),g(()=>f(be,`${e(p).length??""} produit${e(p).length>1?"s":""}`)),o(W,ce)};d(Y,W=>{e(r)?W(H):W(ue,!1)})}t(V),t(k),g(()=>{b.disabled=e(r),V.disabled=e(r)||!e(K)}),o(ae,k)}}),o(A,C)},$$slots:{default:!0}}),Ve()}tt(["click"]);const ur=[{value:"kg",label:"kg"},{value:"gr.",label:"gr."},{value:"l.",label:"l."},{value:"ml",label:"ml"},{value:"unité",label:"unité·s"},{value:"bottes",label:"botte·s"}];var mr=i("<option> </option>"),pr=i('<fieldset class="fieldset"><div><label class="input w-32"><!> <input class="w-full text-center" type="number" step="1" min="0" placeholder="Quantité"/></label> <label class="input w-44"><span class="fieldset-label">unité</span> <select class="custom-select w-full text-end"><option disabled selected>-</option><!></select></label></div></fieldset>');function ha(oe,n){Re(n,!0);let r=De(n,"quantity",15),l=De(n,"unit",15),v=De(n,"disabled",3,!1),q=De(n,"required",3,!0);var p=pr(),K=a(p),R=a(K),B=a(R);Ca(B,{class:"h-4 w-4 opacity-50"});var E=s(B,2);vt(E),t(R);var ne=s(R,2),A=s(a(ne),2),x=a(A);x.value=x.__value="";var C=s(x);Je(C,17,()=>ur,_t,(F,U)=>{let G=()=>e(U).value,ae=()=>e(U).label;var y=mr(),k=a(y,!0);t(y);var b={};g(()=>{f(k,ae()),b!==(b=G())&&(y.value=(y.__value=G())??"")}),o(F,y)}),t(A),t(ne),t(K),t(p),g(()=>{Ce(K,1,`flex gap-2 ${q()?"required":""}`),E.disabled=v(),E.required=q(),Ct(E,"aria-required",q()?"true":void 0),A.disabled=v(),A.required=q(),Ct(A,"aria-required",q()?"true":void 0)}),pt(E,r),Ja(A,l),o(oe,p),Ve()}var fr=i('<div class="alert alert-error text-sm"><!> <span> </span></div>'),_r=i('<div class="alert alert-warning border-warning/20 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),br=i('<span class="loading loading-spinner"></span>'),gr=i('<span class="loading loading-spinner"></span>'),hr=i('<form class="flex h-full flex-col space-y-4"><!> <!> <fieldset class="space-y-4"><div class="flex flex-wrap gap-4"><fieldset class="fieldset"><label class="input w-72"><!> <input id="product-name" type="text" placeholder="Nom du produit"/></label></fieldset> <!></div> <fieldset class="fieldset"><div class="flex flex-wrap items-baseline gap-2"><label class="input w-72"><input id="product-type" type="text" placeholder="type / catégorie"/></label> <!></div></fieldset> <!> <!> <div class="flex flex-wrap gap-x-6"><fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-success"/> <span class="label-text flex items-center gap-2">Produit frais</span></label></fieldset> <fieldset class="fieldset"><label class="label cursor-pointer justify-start gap-2"><input type="checkbox" class="checkbox checkbox-info"/> <span class="label-text flex items-center gap-2">Produit surgelé</span></label></fieldset></div> <div class="border-base-300 mt-auto flex flex-wrap items-center justify-between gap-2 border-t pt-4"><button type="button" class="btn btn-ghost">Annuler</button> <div class="flex gap-2"><button type="button" class="btn btn-secondary"><!> Ajouter et créer un nouveau</button> <button type="submit" class="btn btn-primary"><!> Ajouter et fermer</button></div></div></fieldset></form>'),xr=i("<!> <!>",1);function yr(oe,n){Re(n,!0);let r=De(n,"open",15,!1),l=qe(!1),v=qe(null),q=qe(!1),p=qe(Ze({productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""}));const K=L(()=>e(p).productName.trim().length>0&&e(p).productType.trim().length>0),R=L(()=>T.uniqueProductTypes.map(A=>({id:A,label:A})));let B=L(()=>T.isEventPassed);async function E(A=!1){if(!(!e(K)||e(l))){z(l,!0),z(v,null),z(q,!1);try{if(!T.currentMainId)throw new Error("Aucun événement principal sélectionné");const x={productName:e(p).productName.trim(),productType:e(p).productType.trim(),store:e(p).store.trim()?{storeName:e(p).store.trim()}:void 0,who:e(p).who.trim()?[e(p).who.trim()]:void 0,pF:e(p).pF,pS:e(p).pS,quantity:e(p).quantity?{q:e(p).quantity,u:e(p).unit.trim()||"pièces"}:void 0};await ms(x,T.currentMainId),z(q,!0),A?(e(p).productName="",e(p).quantity=null,e(p).unit="",e(p).pF=!1,e(p).pS=!1,setTimeout(()=>{document.getElementById("product-name")?.focus()},100)):(r(!1),z(p,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0))}catch(x){console.error("Error creating product:",x),z(v,"Erreur lors de la création du produit. Veuillez réessayer.")}finally{z(l,!1)}}}function ne(){r(!1),z(p,{productName:"",productType:"",store:"",who:"",pF:!1,pS:!1,quantity:null,unit:""},!0),z(v,null)}bt(()=>{r()&&setTimeout(()=>{document.getElementById("product-name")?.focus()},50)}),Dt(oe,{get isOpen(){return r()},onClose:ne,children:(A,x)=>{var C=xr(),F=he(C);Pt(F,{title:"Ajouter un produit",onClose:ne});var U=s(F,2);At(U,{children:(G,ae)=>{var y=hr(),k=a(y);{var b=M=>{var J=fr(),pe=a(J);pa(pe,{size:18});var ke=s(pe,2),u=a(ke,!0);t(ke),t(J),g(()=>f(u,e(v))),o(M,J)};d(k,M=>{e(v)&&M(b)})}var V=s(k,2);{var Y=M=>{var J=_r(),pe=a(J);Da(pe,{class:"h-4 w-4"}),Ae(4),t(J),o(M,J)};d(V,M=>{e(B)&&M(Y)})}var H=s(V,2),ue=a(H),W=a(ue),ce=a(W),le=a(ce);Cs(le,{class:"text-base-content/50 h-5 w-5"});var X=s(le,2);vt(X),t(ce),t(W);var de=s(W,2);ha(de,{get disabled(){return e(l)},get quantity(){return e(p).quantity},set quantity(M){e(p).quantity=M},get unit(){return e(p).unit},set unit(M){e(p).unit=M}}),t(ue);var be=s(ue,2),me=a(be),ve=a(me),Q=a(ve);vt(Q),t(ve);var se=s(ve,2);Ma(se,{get suggestions(){return e(R)},onSuggestionClick:M=>e(p).productType=M.label,get disabled(){return e(l)}}),t(me),t(be);var Z=s(be,2);Tt(Z,{get suggestions(){return T.uniqueStores},get disabled(){return e(l)},get value(){return e(p).store},set value(M){e(p).store=M}});var $=s(Z,2);oa($,{get suggestions(){return T.uniqueWho},get disabled(){return e(l)},get value(){return e(p).who},set value(M){e(p).who=M}});var re=s($,2),xe=a(re),ee=a(xe),ie=a(ee);vt(ie),Ae(2),t(ee),t(xe);var P=s(xe,2),I=a(P),_e=a(I);vt(_e),Ae(2),t(I),t(P),t(re);var ge=s(re,2),te=a(ge);te.__click=ne;var D=s(te,2),N=a(D);N.__click=()=>E(!0);var ye=a(N);{var S=M=>{var J=br();o(M,J)},m=M=>{jt(M,{size:18})};d(ye,M=>{e(l)?M(S):M(m,!1)})}Ae(),t(N);var _=s(N,2),h=a(_);{var j=M=>{var J=gr();o(M,J)};d(h,M=>{e(l)&&M(j)})}Ae(),t(_),t(D),t(ge),t(H),t(y),g(()=>{H.disabled=e(l),X.disabled=e(l),Q.disabled=e(l),ie.disabled=e(l),_e.disabled=e(l),te.disabled=e(l),N.disabled=e(l)||!e(p).productName||e(B),_.disabled=e(l)||!e(p).productName||e(B)}),Ee("submit",y,M=>{M.preventDefault(),E(!1)}),pt(X,()=>e(p).productName,M=>e(p).productName=M),pt(Q,()=>e(p).productType,M=>e(p).productType=M),Fa(ie,()=>e(p).pF,M=>e(p).pF=M),Fa(_e,()=>e(p).pS,M=>e(p).pS=M),o(G,y)}}),o(A,C)},$$slots:{default:!0}}),Ve()}tt(["click"]);var Rt,Vt,Qt,Ut,Gt,Wt,Ht,Jt,Kt,Xt,Yt,Zt,ea,ta,aa,sa;class wr{constructor(n,r="recettes"){rt(this,Rt,qe(!1));rt(this,Vt,qe(null));rt(this,Qt,qe("recettes"));rt(this,Ut,L(()=>T.getProductModelById(this.productId)));rt(this,Gt,L(()=>this.productModel?.data??null));rt(this,Wt,L(()=>this.product?.who??[]));rt(this,Ht,L(()=>this.product?.stockParsed??null));rt(this,Jt,L(()=>this.product?.purchases??[]));rt(this,Kt,L(()=>this.product?.byDate?ps(this.product.byDate):[]));rt(this,Xt,qe(Ze({purchase:{quantity:null,unit:"",store:"",who:Ke.userName??"",price:null,notes:"",status:null,orderDate:null,deliveryDate:null},stock:{quantity:null,unit:"",notes:"",dateTime:new Date().toISOString()},store:{name:null,comment:null},who:[]})));rt(this,Yt,qe(Ze({overrideManagerEditMode:!1})));rt(this,Zt,qe(null));rt(this,ea,L(()=>this.editingPurchaseId?this.purchasesList.find(n=>n.$id===this.editingPurchaseId)??null:null));rt(this,ta,qe(null));rt(this,aa,L(()=>this.originalFormsSnapshot?{store:this.forms.store.name!==this.originalFormsSnapshot.store.name||this.forms.store.comment!==this.originalFormsSnapshot.store.comment,stock:this.hasStockChanges(),who:JSON.stringify(this.forms.who)!==JSON.stringify(this.originalFormsSnapshot.whoList)}:{store:!1,stock:!1,who:!1}));rt(this,sa,L(()=>!!(this.originalFormsSnapshot&&(this.hasChanges.store||this.hasChanges.stock||this.hasChanges.who))));ya(this,"formatQuantity",(n,r)=>ua(n,r));ya(this,"formatDate",Qs);this.productId=n,this.currentTab=r,this.initForms()}get loading(){return e(je(this,Rt))}set loading(n){z(je(this,Rt),n,!0)}get error(){return e(je(this,Vt))}set error(n){z(je(this,Vt),n,!0)}get currentTab(){return e(je(this,Qt))}set currentTab(n){z(je(this,Qt),n,!0)}get productModel(){return e(je(this,Ut))}set productModel(n){z(je(this,Ut),n)}get product(){return e(je(this,Gt))}set product(n){z(je(this,Gt),n)}get whoList(){return e(je(this,Wt))}set whoList(n){z(je(this,Wt),n)}get stockParsed(){return e(je(this,Ht))}set stockParsed(n){z(je(this,Ht),n)}get purchasesList(){return e(je(this,Jt))}set purchasesList(n){z(je(this,Jt),n)}get recipes(){return e(je(this,Kt))}set recipes(n){z(je(this,Kt),n)}get forms(){return e(je(this,Xt))}set forms(n){z(je(this,Xt),n,!0)}get uiStates(){return e(je(this,Yt))}set uiStates(n){z(je(this,Yt),n,!0)}get editingPurchaseId(){return e(je(this,Zt))}set editingPurchaseId(n){z(je(this,Zt),n,!0)}get editingPurchaseData(){return e(je(this,ea))}set editingPurchaseData(n){z(je(this,ea),n)}get originalFormsSnapshot(){return e(je(this,ta))}set originalFormsSnapshot(n){z(je(this,ta),n,!0)}initForms(){const n=T.getProductModelById(this.productId);if(!n||!n.data)return;const r=n.stats.missingQuantities[0];if(r){const{value:l,unit:v}=$t(Math.abs(r.q),r.u);this.forms.purchase.quantity=l,this.forms.purchase.unit=v}else this.forms.purchase.quantity=null,this.forms.purchase.unit=n.data.totalNeededArray?.[0]?.u??"";this.forms.purchase.store=n.data.storeInfo?.storeName??"",this.forms.purchase.who=Ke.userName??"",this.forms.purchase.status="delivered",this.forms.stock.unit=n.data.totalNeededArray?.[0]?.u??"",this.forms.store.name=n.data.storeInfo?.storeName??"",this.forms.store.comment=n.data.storeInfo?.storeComment??null,this.forms.who=n.data.who?[...n.data.who]:[],this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]}}get hasChanges(){return e(je(this,aa))}set hasChanges(n){z(je(this,aa),n)}get hasAnyChanges(){return e(je(this,sa))}set hasAnyChanges(n){z(je(this,sa),n)}hasStockChanges(){return this.isStockFormValid?this.stockParsed?this.forms.stock.quantity.toString()!==this.stockParsed.quantity||this.forms.stock.unit!==this.stockParsed.unit||(this.forms.stock.notes||"")!==(this.stockParsed.notes||""):!0:!1}get isPurchaseFormValid(){return this.forms.purchase.quantity!==null&&this.forms.purchase.quantity!==0&&(this.forms.purchase.unit?.trim()??"")!==""}get isStockFormValid(){return this.forms.stock.quantity!==null&&this.forms.stock.quantity>0&&(this.forms.stock.unit?.trim()??"")!==""}setCurrentTab(n){this.currentTab=n}async addPurchase(){this.product&&await this.withLoading(async()=>{if(!this.forms.purchase.quantity||!this.forms.purchase.unit.trim())throw new Error("Veuillez remplir les champs obligatoires");const{value:n,unit:r}=$t(this.forms.purchase.quantity,this.forms.purchase.unit),l=this.forms.purchase.status||"delivered";let v=this.forms.purchase.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString());const q=Ot.normalize(n,r),p=q.quantity,K=q.unit;await T.createPurchase(this.product.$id,[{q:p,u:K}],{store:this.forms.purchase.store||void 0,who:this.forms.purchase.who||void 0,notes:this.forms.purchase.notes||"",price:this.forms.purchase.price||null,status:l,orderDate:this.forms.purchase.orderDate||null,deliveryDate:v,invoiceId:void 0});const R=this.product.missingQuantityArray[0];let B=null,E=this.product.totalNeededArray[0]?.u??"";if(R){const{value:ne,unit:A}=$t(Math.abs(R.q),R.u);B=ne,E=A}this.forms.purchase={quantity:B,unit:E,store:this.forms.purchase.store,who:this.forms.purchase.who,price:null,notes:"",status:null,orderDate:null,deliveryDate:null}},"Achat ajouté avec succès")}startEditPurchase(n){this.editingPurchaseId=n.$id}cancelEditPurchase(){this.editingPurchaseId=null}async updateEditedPurchase(n){n.$id&&await this.withLoading(async()=>{const r=Ot.normalize(n.quantity,n.unit),l=n.status||null;let v=n.deliveryDate||null;l==="delivered"&&!v&&(v=new Date().toISOString()),await T.updatePurchase(n.$id,{unit:r.unit,quantity:r.quantity,store:n.store||null,who:n.who||null,notes:n.notes||"",price:n.price||null,status:l,orderDate:n.orderDate||null,deliveryDate:v}),this.editingPurchaseId=null},"Achat modifié avec succès")}async removePurchase(n){const r=this.purchasesList.find(l=>l.$id===n);r&&confirm(`Supprimer cet achat (${r.quantity} ${r.unit}) ?`)&&await this.withLoading(async()=>{await T.deletePurchase(n)},"Achat supprimé avec succès")}async setStock(){this.product&&await this.withLoading(async()=>{if(!this.forms.stock.quantity||!this.forms.stock.unit)throw new Error("Veuillez remplir les champs obligatoires");const n=Ot.normalize(this.forms.stock.quantity,this.forms.stock.unit),r={quantity:n.quantity.toString(),unit:n.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};await T.updateProduct(this.product.$id,{stockReel:JSON.stringify(r)}),this.forms.stock.quantity=null,this.forms.stock.notes="",this.forms.stock.dateTime=new Date().toISOString()},"Stock mis à jour")}async removeStock(){this.product&&confirm("Supprimer le stock actuel ?")&&await this.withLoading(async()=>{await T.updateProduct(this.product.$id,{stockReel:null})},"Stock supprimé")}async setWho(n){this.product&&await this.withLoading(async()=>{await T.updateProduct(this.product.$id,{who:n})},"Volontaires mis à jour")}async updateStore(n){this.product&&await this.withLoading(async()=>{await T.updateProduct(this.product.$id,{storeInfo:n})},"Magasin mis à jour")}async setOverride(n){this.product&&await this.withLoading(async()=>{await T.updateProduct(this.product.$id,{totalNeededOverride:JSON.stringify(n)})},"Override appliqué")}async removeOverride(){this.product&&confirm("Supprimer l'override manuel et revenir au calcul automatique ?")&&await this.withLoading(async()=>{await T.updateProduct(this.product.$id,{totalNeededOverride:null})},"Override supprimé")}async saveAllChanges(){!this.product||!this.hasAnyChanges||await this.withLoading(async()=>{const n={};if(this.hasChanges.stock&&this.forms.stock.quantity&&this.forms.stock.unit){const r={quantity:this.forms.stock.quantity.toString(),unit:this.forms.stock.unit,notes:this.forms.stock.notes,dateTime:this.forms.stock.dateTime};n.stockReel=JSON.stringify(r)}if(this.hasChanges.who&&(n.who=this.forms.who),this.hasChanges.store){const r={storeName:this.forms.store.name||"",storeComment:this.forms.store.comment||void 0};n.storeInfo=r}Object.keys(n).length>0&&(await T.updateProductBatch(this.product.$id,n,r=>T.getEnrichedProductById(r)??void 0),this.originalFormsSnapshot={purchase:{...this.forms.purchase},stock:{...this.forms.stock},store:{...this.forms.store},whoList:[...this.forms.who]})},"Modifications enregistrées")}resetForms(){this.uiStates.overrideManagerEditMode=!1,this.editingPurchaseId=null,this.initForms(),console.log("[ProductModalState] Formulaires et états UI réinitialisés")}async withLoading(n,r){this.loading=!0,this.error=null;try{const l=await n();return r&&this.showToast("success",r),l}catch(l){const v=l instanceof Error?l.message:"Une erreur est survenue";return this.error=v,this.showToast("error",v),console.error("[ProductModalState]",l),null}finally{this.loading=!1}}showToast(n,r){const l=new CustomEvent("toast",{detail:{type:n,message:r}});window.dispatchEvent(l)}}Rt=new WeakMap,Vt=new WeakMap,Qt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Ht=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Zt=new WeakMap,ea=new WeakMap,ta=new WeakMap,aa=new WeakMap,sa=new WeakMap;var kr=i('<div class="text-base-content/60 mb-1 text-xs font-medium"> </div>'),Sr=i('<div class="text-base-content/60 mt-1 text-xs"> </div>'),Pr=i('<div class="font-medium"> </div> <!>',1),Mr=i('<pre class="text-xs"> </pre>'),qr=i('<span class="text-base-content/50 italic">Non défini</span>'),Cr=i('<div class="bg-base-300/50 rounded p-2 text-left"><!> <div class="text-sm"><!></div></div>'),Dr=i('<div class="bg-base-200 border-warning/20 rounded-lg border p-4 text-center"><div class="mb-2 flex items-center justify-center gap-2"><!> <!> <span class="text-warning font-medium"> </span></div> <p class="text-base-content/70 mb-3 text-sm"> </p> <!></div>');function xa(oe,n){Re(n,!0);let r=De(n,"title",3,"Événement terminé"),l=De(n,"message",3,"Cet événement est terminé. Ces données ne sont plus modifiables mais sont conservées pour consultation."),v=De(n,"showData",3,!0),q=De(n,"data",3,null),p=De(n,"dataLabel",3,"");var K=Dr(),R=a(K),B=a(R);Da(B,{class:"text-warning h-5 w-5"});var E=s(B,2);Ds(E,{class:"text-warning/70 h-4 w-4"});var ne=s(E,2),A=a(ne,!0);t(ne),t(R);var x=s(R,2),C=a(x,!0);t(x);var F=s(x,2);{var U=G=>{var ae=Cr(),y=a(ae);{var k=ue=>{var W=kr(),ce=a(W);t(W),g(()=>f(ce,`${p()??""} :`)),o(ue,W)};d(y,ue=>{p()&&ue(k)})}var b=s(y,2),V=a(b);{var Y=ue=>{var W=et();g(()=>f(W,q())),o(ue,W)},H=ue=>{var W=ze(),ce=he(W);{var le=de=>{var be=et();g(me=>f(be,me),[()=>q().join(", ")]),o(de,be)},X=de=>{var be=ze(),me=he(be);{var ve=se=>{var Z=ze(),$=he(Z);{var re=ee=>{var ie=Pr(),P=he(ie),I=a(P,!0);t(P);var _e=s(P,2);{var ge=te=>{var D=Sr(),N=a(D,!0);t(D),g(()=>f(N,q().storeComment)),o(te,D)};d(_e,te=>{q().storeComment&&te(ge)})}g(()=>f(I,q().storeName)),o(ee,ie)},xe=ee=>{var ie=Mr(),P=a(ie,!0);t(ie),g(I=>f(P,I),[()=>JSON.stringify(q(),null,2)]),o(ee,ie)};d($,ee=>{q().storeName?ee(re):ee(xe,!1)})}o(se,Z)},Q=se=>{var Z=qr();o(se,Z)};d(me,se=>{typeof q()=="object"&&q()!==null?se(ve):se(Q,!1)},!0)}o(de,be)};d(ce,de=>{Array.isArray(q())&&q().length>0?de(le):de(X,!1)},!0)}o(ue,W)};d(V,ue=>{typeof q()=="string"||typeof q()=="number"?ue(Y):ue(H,!1)})}t(b),t(ae),o(G,ae)};d(F,G=>{v()&&q()&&G(U)})}t(K),g(()=>{f(A,r()),f(C,l())}),o(oe,K),Ve()}var Ar=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Tr=i('<span class="loading loading-spinner loading-sm"></span>'),Ir=i('<div id="purchase-form-card"><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="space-y-8"><div class="flex flex-wrap items-baseline gap-4"><!> <!> <!> <!></div> <div><!></div> <!></div> <div class="card-actions mt-4 justify-end"><!> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),Er=i('<div class="mt-4 py-8 text-center opacity-50"><!> <p>Aucun achat enregistré pour ce produit</p></div>'),$r=i("<th>Actions</th>"),Or=i('<span class="loading loading-spinner loading-sm"></span>'),jr=i('<td><div class="btn-group btn-group-sm"><button class="btn btn-ghost btn-sm"><!></button> <button class="btn btn-ghost btn-sm text-error"><!></button></div></td>'),zr=i('<tr><td class="font-medium"> </td><td> </td><td> </td><td><div> </div></td><td class="text-xs"> </td><td class="text-xs"> </td><td> </td><td> </td><!></tr>'),Nr=i('<div class="mt-4 overflow-x-auto"><table class="table-zebra table-sm table"><thead><tr><th>Quantité</th><th>Magasin</th><th>Qui</th><th>Statut</th><th>Date commande</th><th>Date livraison</th><th>Prix</th><th>Notes</th><!></tr></thead><tbody></tbody></table></div>'),Fr=i('<span class="loading loading-spinner loading-xs"></span>'),Br=i('<button class="btn btn-ghost btn-square btn-sm text-error"><!></button>'),Lr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Rr=i('<div class="flex items-center gap-1 opacity-70"><!> <span> </span></div>'),Vr=i('<div class="mt-2 text-sm opacity-70"><!> </div>'),Qr=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-37.5 truncate"> </span></div>'),Ur=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-25 truncate"> </span></div>'),Gr=i('<div class="card-actions mt-2 justify-end"><button class="btn btn-ghost btn-sm"><!> Modifier</button></div>'),Wr=i('<div class="card bg-base-100 border-neutral/40 card-xs border shadow-sm"><div class="card-body p-4"><div class="flex items-center justify-between gap-3"><div class="flex flex-wrap items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span class="font-medium"> </span></div> <div> <!></div> <div> </div></div> <!></div> <div class="mt-2 flex flex-wrap gap-3 text-sm"><!> <!></div> <!> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div> <!></div></div>'),Hr=i('<div class="mt-4 space-y-3"></div>'),Jr=i('<div class="space-y-4"><!></div> <!>',1);function Kr(oe,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);function v(b){return b.quantity!==null&&b.quantity!==0&&b.unit?.trim()!==""}function q(b){if(l())return;const{value:V,unit:Y}=$t(b.quantity,b.unit);r().forms.purchase.quantity=V,r().forms.purchase.unit=Y,r().forms.purchase.price=b.price,r().forms.purchase.store=b.store||"",r().forms.purchase.who=b.who||"",r().forms.purchase.notes=b.notes||"",r().forms.purchase.status=b.status||null,r().forms.purchase.orderDate=b.orderDate||null,r().forms.purchase.deliveryDate=b.deliveryDate||null,r().startEditPurchase(b),setTimeout(()=>{const H=document.querySelector("#purchase-form-card");H?.scrollIntoView({behavior:"smooth",block:"center"}),H?.querySelector('input[type="number"]')?.focus()},100)}function p(){r().forms.purchase.quantity=null,r().forms.purchase.unit="kg",r().forms.purchase.price=null,r().forms.purchase.store="",r().forms.purchase.who="",r().forms.purchase.notes="",r().forms.purchase.status="delivered",r().forms.purchase.orderDate=null,r().forms.purchase.deliveryDate=null,r().editingPurchaseId&&r().cancelEditPurchase()}function K(){if(r().isPurchaseFormValid)if(r().editingPurchaseId){const b=r().editingPurchaseData;if(!b||!v(b))return;const V=r().forms.purchase.quantity??0,Y=r().forms.purchase.unit,H=Ot.normalize(V,Y);b.quantity=H.quantity,b.unit=H.unit,b.price=r().forms.purchase.price,b.store=r().forms.purchase.store,b.who=r().forms.purchase.who,b.notes=r().forms.purchase.notes,b.status=r().forms.purchase.status,b.orderDate=r().forms.purchase.orderDate,b.deliveryDate=r().forms.purchase.deliveryDate,r().updateEditedPurchase(b),r().cancelEditPurchase()}else r().forms.purchase.status==="ordered"&&!r().forms.purchase.orderDate&&(r().forms.purchase.orderDate=new Date().toISOString().split("T")[0]),r().addPurchase()}function R(b){r().removePurchase(b)}function B(b){q(b)}let E=L(()=>r().editingPurchaseId!==null),ne=L(()=>e(E)?"Modifier l'achat":"Ajouter un achat / une récup / une commande"),A=L(()=>e(E)?"Enregistrer les modifications":"Ajouter l'achat");var x=Jr(),C=he(x),F=a(C);{var U=b=>{xa(b,{title:"Achats non modifiables",message:"L'événement est terminé, les achats ne peuvent plus être ajoutés ou modifiés."})},G=b=>{var V=Ir(),Y=a(V),H=a(Y),ue=a(H,!0);t(H);var W=s(H,2),ce=a(W),le=a(ce);ha(le,{get disabled(){return r().loading},get quantity(){return r().forms.purchase.quantity},set quantity(P){r().forms.purchase.quantity=P},get unit(){return r().forms.purchase.unit},set unit(P){r().forms.purchase.unit=P}});var X=s(le,2);za(X,{get disabled(){return r().loading},get value(){return r().forms.purchase.price},set value(P){r().forms.purchase.price=P}});var de=s(X,2);Tt(de,{get suggestions(){return T.uniqueStores},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.store},set value(P){r().forms.purchase.store=P}});var be=s(de,2);oa(be,{get suggestions(){return T.uniqueWho},get disabled(){return r().loading},flexCol:!0,get value(){return r().forms.purchase.who},set value(P){r().forms.purchase.who=P}}),t(ce);var me=s(ce,2),ve=a(me);It(ve,{get disabled(){return r().loading},get value(){return r().forms.purchase.notes},set value(P){r().forms.purchase.notes=P}}),t(me);var Q=s(me,2);is(Q,{get disabled(){return r().loading},get status(){return r().forms.purchase.status},set status(P){r().forms.purchase.status=P},get deliveryDate(){return r().forms.purchase.deliveryDate},set deliveryDate(P){r().forms.purchase.deliveryDate=P}}),t(W);var se=s(W,2),Z=a(se);{var $=P=>{var I=Ar();I.__click=p,o(P,I)};d(Z,P=>{e(E)&&P($)})}var re=s(Z,2);re.__click=K;var xe=a(re);{var ee=P=>{var I=Tr();o(P,I)},ie=P=>{var I=et();g(()=>f(I,e(A))),o(P,I)};d(xe,P=>{r().loading?P(ee):P(ie,!1)})}t(re),t(se),t(Y),t(V),g(()=>{Ce(V,1,`card bg-base-200 ${e(E)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,e(ne)),re.disabled=r().loading||!r().isPurchaseFormValid}),o(b,V)};d(F,b=>{l()?b(U):b(G,!1)})}t(C);var ae=s(C,2);{var y=b=>{var V=Er(),Y=a(V);kt(Y,{class:"mx-auto mb-2 h-12 w-12"}),Ae(2),t(V),o(b,V)},k=b=>{var V=ze(),Y=he(V);{var H=W=>{var ce=Nr(),le=a(ce),X=a(le),de=a(X),be=s(a(de),8);{var me=Q=>{var se=$r();o(Q,se)};d(be,Q=>{l()||Q(me)})}t(de),t(X);var ve=s(X);Je(ve,21,()=>r().purchasesList,Q=>Q.$id,(Q,se)=>{var Z=zr(),$=a(Z),re=a($,!0);t($);var xe=s($),ee=a(xe,!0);t(xe);var ie=s(xe),P=a(ie,!0);t(ie);var I=s(ie),_e=a(I),ge=a(_e,!0);t(_e),t(I);var te=s(I),D=a(te,!0);t(te);var N=s(te),ye=a(N,!0);t(N);var S=s(N),m=a(S,!0);t(S);var _=s(S),h=a(_,!0);t(_);var j=s(_);{var M=J=>{var pe=jr(),ke=a(pe),u=a(ke);u.__click=()=>B(e(se));var c=a(u);yt(c,{class:"h-4 w-4"}),t(u);var w=s(u,2);w.__click=()=>R(e(se).$id);var O=a(w);{var fe=we=>{var Me=Or();o(we,Me)},Se=we=>{fa(we,{class:"h-4 w-4"})};d(O,we=>{r().loading?we(fe):we(Se,!1)})}t(w),t(ke),t(pe),g(()=>w.disabled=r().loading),o(J,pe)};d(j,J=>{l()||J(M)})}t(Z),g((J,pe,ke,u,c)=>{f(re,J),f(ee,e(se).store||"-"),f(P,e(se).who||"-"),Ce(_e,1,`badge badge-sm ${pe??""}`),f(ge,ke),f(D,u),f(ye,c),f(m,e(se).price?`${e(se).price}€`:"-"),f(h,e(se).notes||"-")},[()=>ua(e(se).quantity,e(se).unit),()=>da(e(se).status).class,()=>da(e(se).status).text,()=>va(e(se).orderDate),()=>va(e(se).deliveryDate)]),o(Q,Z)}),t(ve),t(le),t(ce),o(W,ce)},ue=W=>{var ce=Hr();Je(ce,21,()=>r().purchasesList,le=>le.$id,(le,X)=>{var de=Wr(),be=a(de),me=a(be),ve=a(me),Q=a(ve),se=a(Q);As(se,{class:"size-4"});var Z=s(se,2),$=a(Z,!0);t(Z),t(Q);var re=s(Q,2),xe=a(re),ee=s(xe);Ya(ee,{class:"me-1 inline size-4"}),t(re);var ie=s(re,2),P=a(ie,!0);t(ie),t(ve);var I=s(ve,2);{var _e=u=>{var c=Br();c.__click=()=>R(e(X).$id);var w=a(c);{var O=Se=>{var we=Fr();o(Se,we)},fe=Se=>{Ts(Se,{size:16})};d(w,Se=>{r().loading?Se(O):Se(fe,!1)})}t(c),g(()=>c.disabled=r().loading),o(u,c)};d(I,u=>{l()||u(_e)})}t(me);var ge=s(me,2),te=a(ge);{var D=u=>{var c=Lr(),w=a(c);Bt(w,{class:"size-3.5"});var O=s(w,2),fe=a(O);t(O),t(c),g(Se=>f(fe,`Commande: ${Se??""}`),[()=>va(e(X).orderDate)]),o(u,c)};d(te,u=>{e(X).orderDate&&u(D)})}var N=s(te,2);{var ye=u=>{var c=Rr(),w=a(c);Bt(w,{class:"size-3.5"});var O=s(w,2),fe=a(O);t(O),t(c),g(Se=>f(fe,`Livraison: ${Se??""}`),[()=>e(X).deliveryDate?va(e(X).deliveryDate):"non renseigné"]),o(u,c)};d(N,u=>{e(X).status==="ordered"&&u(ye)})}t(ge);var S=s(ge,2);{var m=u=>{var c=Vr(),w=a(c);Za(w,{class:"me-1 inline size-3.5"});var O=s(w);t(c),g(()=>f(O,` ${e(X).notes??""}`)),o(u,c)};d(S,u=>{e(X).notes&&u(m)})}var _=s(S,2),h=a(_);{var j=u=>{var c=Qr(),w=a(c);ct(w,{class:"h-3 w-3"});var O=s(w,2),fe=a(O,!0);t(O),t(c),g(()=>f(fe,e(X).store)),o(u,c)};d(h,u=>{e(X).store&&u(j)})}var M=s(h,2);{var J=u=>{var c=Ur(),w=a(c);na(w,{class:"size-3.5"});var O=s(w,2),fe=a(O,!0);t(O),t(c),g(()=>f(fe,e(X).who)),o(u,c)};d(M,u=>{e(X).who&&u(J)})}t(_);var pe=s(_,2);{var ke=u=>{var c=Gr(),w=a(c);w.__click=()=>B(e(X));var O=a(w);yt(O,{size:16,class:"mr-1"}),Ae(),t(w),t(c),o(u,c)};d(pe,u=>{l()||u(ke)})}t(be),t(de),g((u,c,w)=>{f($,u),f(xe,`${(e(X).price?e(X).price:"?")??""} `),Ce(ie,1,`badge ${c??""}`),f(P,w)},[()=>ua(e(X).quantity,e(X).unit),()=>da(e(X).status).class,()=>da(e(X).status).text]),o(le,de)}),t(ce),o(W,ce)};d(Y,W=>{Ke.isMobile?W(ue,!1):W(H)},!0)}o(b,V)};d(ae,b=>{r().purchasesList.length===0?b(y):b(k,!1)})}o(oe,x),Ve()}tt(["click"]);var Xr=i(`Le stock réel est la quantité réelle du produit constaté dans le
              stock: <strong>il sera utilisé pour le calcul des quantités manquantes à se
                fournir à la place des achats / réccup déclarés antérieurement</strong> au stock. Les achats / réccup déclarés <strong>ultérieurement</strong> seront pris en compte dans le calcul
              des quantités manquantes à se fournir.`,1),Yr=i('<button class="btn btn-ghost btn-sm">Annuler</button>'),Zr=i('<span class="loading loading-spinner loading-xs"></span>'),en=i('<div><div class="card-body"><h4 class="card-title text-base"> </h4> <div class="mb-4"><!></div> <div class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"><!></div> <div><!></div> <div class="card-actions mt-4 justify-end"><!> <button>Effacer</button> <button class="btn btn-primary btn-sm"><!></button></div></div></div>'),tn=i('<div class="py-8 text-center opacity-50"><!> <p>Aucun stock enregistré pour ce produit</p></div>'),an=i('<div class="md:col-span-2"><span class="font-semibold">Notes:</span> <span class="ml-2"> </span></div>'),sn=i('<span class="loading loading-spinner loading-xs"></span>'),rn=i('<div class="card-actions mt-4 justify-end space-x-4"><button class="btn btn-error btn-sm"><!></button> <button class="btn btn-primary btn-sm"><!> Modifier</button></div>'),nn=i('<div class="card bg-base-300 my-4"><div class="card-body"><div class="flex flex-wrap items-center gap-4 text-lg font-medium"><div>Stock enregistré :</div> <div class="badge badge-primary badge-lg ml-2"> </div> <div><span class="font-semibold">le:</span> <span class="ml-2"> </span></div> <!></div> <!></div></div>'),on=i('<div class="space-y-4"><!></div> <!>',1);function ln(oe,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=qe(!1);async function q(){await r()?.setStock(),z(v,!1)}async function p(){await r()?.removeStock()}function K(){if(!r().stockParsed)return;const{value:G,unit:ae}=$t(r().stockParsed.quantity,r().stockParsed.unit);r().forms.stock.quantity=G,r().forms.stock.unit=ae,r().forms.stock.notes=r().stockParsed.notes??"",r().forms.stock.dateTime=r().stockParsed.dateTime,z(v,!0)}function R(){z(v,!1),r().forms.stock.quantity=null,r().forms.stock.notes="",r().forms.stock.dateTime=new Date().toISOString()}var B=on(),E=he(B),ne=a(E);{var A=G=>{xa(G,{title:"Stock non modifiable",message:"L'événement est terminé, le stock ne peut plus être modifié.",get data(){return r().stockParsed},dataLabel:"Stock actuel"})},x=G=>{var ae=ze(),y=he(ae);{var k=b=>{var V=en(),Y=a(V),H=a(Y),ue=a(H,!0);t(H);var W=s(H,2),ce=a(W);qa(ce,{initiallyOpen:!0,contentVisible:`Cette section permet de gérer le stock réel de l'ingrédient.
            `,children:(ee,ie)=>{Ae();var P=Xr();Ae(4),o(ee,P)},$$slots:{default:!0}}),t(W);var le=s(W,2),X=a(le);ha(X,{get disabled(){return r().loading},get quantity(){return r().forms.stock.quantity},set quantity(ee){r().forms.stock.quantity=ee},get unit(){return r().forms.stock.unit},set unit(ee){r().forms.stock.unit=ee}}),t(le);var de=s(le,2),be=a(de);It(be,{get disabled(){return r().loading},get value(){return r().forms.stock.notes},set value(ee){r().forms.stock.notes=ee}}),t(de);var me=s(de,2),ve=a(me);{var Q=ee=>{var ie=Yr();ie.__click=R,g(()=>ie.disabled=r().loading),o(ee,ie)};d(ve,ee=>{e(v)&&ee(Q)})}var se=s(ve,2);se.__click=()=>{r().forms.stock.quantity=null,r().forms.stock.notes=""};var Z=s(se,2);Z.__click=q;var $=a(Z);{var re=ee=>{var ie=Zr();o(ee,ie)},xe=ee=>{var ie=et();g(()=>f(ie,e(v)?"Enregistrer les modifications":"Déclarer le stock")),o(ee,ie)};d($,ee=>{r().loading?ee(re):ee(xe,!1)})}t(Z),t(me),t(Y),t(V),g(ee=>{Ce(V,1,`card bg-base-200 ${e(v)?"ring-accent ring-2 ring-offset-2":""}`),f(ue,ee),Ce(se,1,`btn btn-ghost btn-sm ${e(v)?"hidden":""}`),se.disabled=r().loading,Z.disabled=r().loading||!r().forms.stock.quantity},[()=>e(v)?"Modifier le stock réel":`Déclarer le stock réel du ${new Date().toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}`]),o(b,V)};d(y,b=>{(!r().stockParsed||e(v))&&b(k)})}o(G,ae)};d(ne,G=>{l()?G(A):G(x,!1)})}t(E);var C=s(E,2);{var F=G=>{var ae=tn(),y=a(ae);es(y,{class:"mx-auto mb-2 h-12 w-12"}),Ae(2),t(ae),o(G,ae)},U=G=>{var ae=ze(),y=he(ae);{var k=b=>{var V=nn(),Y=a(V),H=a(Y),ue=s(a(H),2),W=a(ue);t(ue);var ce=s(ue,2),le=s(a(ce),2),X=a(le,!0);t(le),t(ce);var de=s(ce,2);{var be=Q=>{var se=an(),Z=s(a(se),2),$=a(Z,!0);t(Z),t(se),g(()=>f($,r().stockParsed.notes)),o(Q,se)};d(de,Q=>{r().stockParsed.notes&&Q(be)})}t(H);var me=s(H,2);{var ve=Q=>{var se=rn(),Z=a(se);Z.__click=p;var $=a(Z);{var re=P=>{var I=sn();o(P,I)},xe=P=>{var I=et("Supprimer le stock");o(P,I)};d($,P=>{r().loading?P(re):P(xe,!1)})}t(Z);var ee=s(Z,2);ee.__click=K;var ie=a(ee);yt(ie,{class:"mr-1 h-4 w-4"}),Ae(),t(ee),t(se),g(()=>{Z.disabled=r().loading,ee.disabled=r().loading}),o(Q,se)};d(me,Q=>{l()||Q(ve)})}t(Y),t(V),g(Q=>{f(W,`${r().stockParsed.quantity??""}
            ${r().stockParsed.unit??""}`),f(X,Q)},[()=>ra(r().stockParsed.dateTime)]),o(b,V)};d(y,b=>{e(v)||b(k)})}o(G,ae)};d(C,G=>{r().stockParsed?G(U,!1):G(F)})}o(oe,B),Ve()}tt(["click"]);var dn=i('<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Gérer les volontaires</h4> <p class="mb-4 text-sm opacity-75">Ajoutez ou retirez des volontaires pour ce produit.</p> <div class="space-y-4"><div class="flex gap-2"><label class="input w-72"><!> <input type="text" class="w-full" placeholder="Ajouter un volontaire..."/></label> <button class="btn btn-square btn-primary"><!></button></div> <div><h5 class="mb-2 font-medium">Selection rapide</h5> <!></div></div></div></div>'),vn=i('<div class="space-y-4"><!></div>');function cn(oe,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1),v=qe("");const q=L(()=>{const C=T.uniqueWho,F=new Set([...C,...r().forms.who]);return Array.from(F).map(U=>({id:U,label:U,selected:r().forms.who.includes(U)}))});function p(C){const F=C.trim();F&&!r().forms.who.includes(F)&&(r().forms.who=[...r().forms.who,F])}function K(C){r().forms.who=r().forms.who.filter(F=>F!==C)}function R(C){r().forms.who.includes(C)?K(C):p(C)}function B(){e(v).trim()&&(p(e(v)),z(v,""))}var E=vn(),ne=a(E);{var A=C=>{xa(C,{title:"Volontaires non modifiables",message:"L'événement est terminé, les volontaires assignés ne peuvent plus être modifiés."})},x=C=>{var F=dn(),U=a(F),G=s(a(U),4),ae=a(G),y=a(ae),k=a(y);na(k,{class:"h-4 w-4 opacity-50"});var b=s(k,2);vt(b),b.__keydown=W=>{W.key==="Enter"&&(W.preventDefault(),B())},t(y);var V=s(y,2);V.__click=B;var Y=a(V);ts(Y,{size:16}),t(V),t(ae);var H=s(ae,2),ue=s(a(H),2);Ft(ue,{get items(){return e(q)},onToggleItem:R,size:"sm",color:"info"}),t(H),t(G),t(U),t(F),g(W=>{b.disabled=r().loading,V.disabled=W},[()=>r().loading||!e(v).trim()]),pt(b,()=>e(v),W=>z(v,W)),o(C,F)};d(ne,C=>{l()?C(A):C(x,!1)})}t(E),o(oe,E),Ve()}tt(["keydown","click"]);var un=i(`<div class="card bg-base-200"><div class="card-body"><h4 class="card-title text-base">Magasin</h4> <p class="mb-4 text-sm opacity-75">Définissez le magasin où vous prévoyez d'acheter ce produit.</p> <div class="grid-col-1 grid gap-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <!></div> <div class="card-actions mt-4 justify-end"><button class="btn btn-ghost btn-sm">Effacer</button></div></div></div>`),mn=i('<div class="space-y-4"><!></div>');function pn(oe,n){Re(n,!0);let r=De(n,"modalState",7),l=De(n,"isArchiveMode",3,!1);const v=L(()=>r()?.hasChanges?.store||!1);async function q(){if(!e(v))return;const E={storeName:r().forms.store.name?.trim()||"",storeComment:r().forms.store.comment?.trim()||void 0};await r().updateStore(E)}var p=mn(),K=a(p);{var R=E=>{{let ne=L(()=>r().product?.storeInfo);xa(E,{title:"Magasin non modifiable",message:"L'événement est terminé, les informations de magasin ne peuvent plus être modifiées.",get data(){return e(ne)},dataLabel:"Magasin actuel"})}},B=E=>{var ne=un(),A=a(ne),x=s(a(A),4),C=a(x),F=a(C);Tt(F,{get suggestions(){return T.uniqueStores},get disabled(){return r().loading},onkeydown:y=>{y.key==="Enter"&&q()},get value(){return r().forms.store.name},set value(y){r().forms.store.name=y}}),t(C);var U=s(C,2);It(U,{get disabled(){return r().loading},get value(){return r().forms.store.comment},set value(y){r().forms.store.comment=y}}),t(x);var G=s(x,2),ae=a(G);ae.__click=()=>{r().forms.store.name="",r().forms.store.comment=""},t(G),t(A),t(ne),g(()=>ae.disabled=r().loading),o(E,ne)};d(K,E=>{l()?E(R):E(B,!1)})}t(p),o(oe,p),Ve()}tt(["click"]);var fn=i('<label class="input w-96"><!> <input type="text" placeholder="Commentaire (optionnel)" maxlength="100"/></label>');function _n(oe,n){Re(n,!0);let r=De(n,"value",15);De(n,"disabled",3,!1);var l=fn(),v=a(l);Za(v,{size:20,class:"text-base-centent/70"});var q=s(v,2);vt(q),t(l),pt(q,r),o(oe,l),Ve()}var bn=i(`<div class="alert alert-warning alert-soft"><!> <div class="text-sm"><div class="font-bold">Les menus ont été modifié depuis la définition manuelle des besoins
            !</div> <div class="mt-1 space-y-1"><div class="flex items-center gap-2"><span class="text-base-content/70">Au moment de laa modification manuelle : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/70">Calcul actuel : <strong class="text-base-content"> </strong> → <strong> </strong></span></div> <div class="flex items-center gap-2"><span class="text-base-content/60 text-xs"> </span></div></div></div></div>`),gn=i('<span class="loading loading-spinner loading-sm"></span>'),hn=i('<div class="rounded-box bg-primary/10 flex flex-wrap items-center gap-3 px-4 py-3"><span class="text-base-content/70 font-medium">Besoin redéfinis manuellement</span> <!> <!> <div class="ms-auto flex items-center gap-4"><button class="btn-link">supprimer</button> <button class="btn btn-primary btn-sm"><!></button></div></div>'),xn=i('<button class="btn btn-ghost btn-sm btn-circle" title="Modifier"><!></button>'),yn=i('<div class="chat-bubble relative text-sm"> <!></div>'),wn=i('<div class="rounded-box bg-primary/10 flex items-center justify-between px-4 py-3"><div class="flex items-center gap-3"><span class="text-base-content/70 font-medium">Besoins redéfinis manuellement</span> <!> <!></div> <div class="flex items-center gap-2"><span class="font-bold"> </span></div></div>'),kn=i('<div class="flex justify-end"><button class="btn btn-primary btn-sm btn-soft">Redéfinir manuellement les besoins <!></button></div>'),Sn=i('<div class=" mb-4 space-y-3"><!> <div class="rounded-box bg-base-200 flex items-center justify-between px-4 py-3"><span class="text-base-content/70 font-medium">Besoin total calculés</span> <div class="flex items-center gap-3"><span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="text-base-content/80 flex items-center gap-1 text-xs"> <!></span> <span class="ms-3 font-bold"> </span></div></div> <!></div>');function Pn(oe,n){Re(n,!0);let r=De(n,"modalState",7);const l=L(()=>r().product?.totalNeededOverrideParsed),v=L(()=>r().product?.displayTotalOverride),q=L(()=>r().product?Ka(r().product):null);let p=L(()=>r().uiStates.overrideManagerEditMode),K=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.q||r().product?.totalNeededArray[0]?.q||0),R=L(()=>r().product?.totalNeededOverrideParsed?.totalOverride.u||r().product?.totalNeededArray[0]?.u||"");function B(){if(!e(K)||!e(R))return{quantity:0,unit:""};const{q:y,u:k}=Ba(e(K),e(R));return{quantity:fs(y,k),unit:k}}let E=qe(Ze(B().quantity)),ne=qe(Ze(B().unit)),A=qe(Ze(r().product?.totalNeededOverrideParsed?.comment||""));bt(()=>{if(e(p)){const y=B();z(E,y.quantity,!0),z(ne,y.unit,!0),z(A,r().product?.totalNeededOverrideParsed?.comment||"",!0)}});let x=L(()=>e(E)>0&&e(ne).trim()!=="");async function C(){if(!r())return;const{q:y,u:k}=Ba(e(E),e(ne)),b=r().product?.totalNeededOverrideParsed?.totalOverride,V=r().product?.totalNeededOverrideParsed?.comment||"";if(y!==b?.q||k!==b?.u||e(A)!==V){const H={totalOverride:{q:y,u:k},comment:e(A),totalComputedWhenOverride:r().product.totalNeededArray,platesNbWhenOverride:r().product.totalAssiettes,recipesNbWhenOverride:r().product.nbRecipes};await r().setOverride(H)}r().uiStates.overrideManagerEditMode=!1}async function F(){r()&&(await r().removeOverride(),r().uiStates.overrideManagerEditMode=!1)}var U=ze(),G=he(U);{var ae=y=>{var k=Sn(),b=a(k);{var V=Z=>{var $=bn(),re=a($);Ta(re,{size:18});var xe=s(re,2),ee=s(a(xe),2),ie=a(ee),P=a(ie),I=s(a(P)),_e=a(I);t(I);var ge=s(I,2),te=a(ge,!0);t(ge),t(P),t(ie);var D=s(ie,2),N=a(D),ye=s(a(N)),S=a(ye);t(ye);var m=s(ye,2),_=a(m,!0);t(m),t(N),t(D);var h=s(D,2),j=a(h),M=a(j);t(j),t(h),t(ee),t(xe),t($),g((J,pe)=>{f(_e,`${e(q).details.oldPlates??""} couverts,
                  ${e(q).details.oldRecipes??""} recettes`),f(te,J),f(S,`${e(q).details.newPlates??""} couverts,
                  ${e(q).details.newRecipes??""} recettes`),f(_,pe),f(M,`Votre override : ${e(v)??""}`)},[()=>La(e(q).details.oldComputed),()=>La(e(q).details.newComputed)]),o(Z,$)};d(b,Z=>{e(q)?.hasMismatch&&e(q)?.details&&Z(V)})}var Y=s(b,2),H=s(a(Y),2),ue=a(H),W=a(ue),ce=s(W);_a(ce,{class:"h-3 w-3"}),t(ue);var le=s(ue,2),X=a(le),de=s(X);Aa(de,{class:"h-3 w-3"}),t(le);var be=s(le,2),me=a(be,!0);t(be),t(H),t(Y);var ve=s(Y,2);{var Q=Z=>{var $=hn(),re=s(a($),2);ha(re,{get quantity(){return e(E)},set quantity(te){z(E,te,!0)},get unit(){return e(ne)},set unit(te){z(ne,te,!0)}});var xe=s(re,2);_n(xe,{get value(){return e(A)},set value(te){z(A,te,!0)}});var ee=s(xe,2),ie=a(ee);ie.__click=F;var P=s(ie,2);P.__click=C;var I=a(P);{var _e=te=>{var D=gn();o(te,D)},ge=te=>{var D=et("✓");o(te,D)};d(I,te=>{r().loading?te(_e):te(ge,!1)})}t(P),t(ee),t($),g(()=>P.disabled=r().loading||!e(x)),St(1,$,()=>Pa),o(Z,$)},se=Z=>{var $=ze(),re=he($);{var xe=ie=>{var P=wn(),I=a(P),_e=s(a(I),2);{var ge=m=>{var _=xn();_.__click=()=>r().uiStates.overrideManagerEditMode=!0;var h=a(_);Is(h,{size:16}),t(_),o(m,_)};d(_e,m=>{n.isArchiveMode||m(ge)})}var te=s(_e,2);{var D=m=>{var _=yn(),h=a(_),j=s(h);Es(j,{size:12,class:"text-base-content/60 absolute top-0 right-0"}),t(_),g(()=>f(h,`${e(l).comment??""} `)),o(m,_)};d(te,m=>{e(l).comment&&m(D)})}t(I);var N=s(I,2),ye=a(N),S=a(ye,!0);t(ye),t(N),t(P),g(()=>f(S,e(v))),o(ie,P)},ee=ie=>{var P=ze(),I=he(P);{var _e=ge=>{var te=kn(),D=a(te);D.__click=()=>r().uiStates.overrideManagerEditMode=!0;var N=s(a(D));yt(N,{size:16}),t(D),t(te),o(ge,te)};d(I,ge=>{n.isArchiveMode||ge(_e)},!0)}o(ie,P)};d(re,ie=>{e(v)&&e(l)?ie(xe):ie(ee,!1)})}o(Z,$)};d(ve,Z=>{e(p)?Z(Q):Z(se,!1)})}t(k),g(()=>{f(W,`${r().product.nbRecipes??""} `),f(X,`${r().product.totalAssiettes??""} `),f(me,r().product.displayTotalNeeded)}),o(y,k)};d(G,y=>{r().product&&y(ae)})}o(oe,U),Ve()}tt(["click"]);var Mn=i('<div class="py-8 text-center opacity-50"><!> <p>Aucune recette trouvée pour ce produit</p></div>'),qn=i('<span class="text-base-content/70"> </span>'),Cn=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-3"><div class="flex flex-wrap items-center justify-between gap-2 gap-y-3"><div class="flex items-start gap-4"><span class="text-primary text-base text-wrap"> </span> <div class="flex min-w-fit items-center gap-1 text-base font-medium"> <!></div></div> <div class="ms-auto flex flex-wrap items-center gap-4"><span class="badge badge-soft gap-1"><!> </span> <span class="text-base font-medium"> </span> <!></div></div></div></div>'),Dn=i('<div class="mt-4 space-y-3"></div>'),An=i('<!> <div class="space-y-6"><div></div> <h3 class="flex items-center gap-2 text-lg font-semibold"><!> Recettes utilisant ce produit</h3> <!></div>',1);function Tn(oe,n){Re(n,!0);const r=L(()=>n.modalState.recipes);function l(A,x){return!A||!x?"-":ua(A,x)}var v=An(),q=he(v);Pn(q,{get modalState(){return n.modalState},get isArchiveMode(){return n.isArchiveMode}});var p=s(q,2),K=s(a(p),2),R=a(K);_a(R,{class:"h-5 w-5"}),Ae(),t(K);var B=s(K,2);{var E=A=>{var x=Mn(),C=a(x);Ca(C,{class:"mx-auto mb-2 h-12 w-12"}),Ae(2),t(x),o(A,x)},ne=A=>{var x=Dn();Je(x,21,()=>e(r),_t,(C,F)=>{const U=L(()=>l(e(F).q,e(F).u)),G=L(()=>l(e(F).qEq,e(F).uEq));var ae=Cn(),y=a(ae),k=a(y),b=a(k),V=a(b),Y=a(V,!0);t(V);var H=s(V,2),ue=a(H),W=s(ue);{var ce=$=>{Ia($,{class:"h-4 w-4 text-amber-500"})},le=$=>{var re=ze(),xe=he(re);{var ee=P=>{Ea(P,{class:"h-4 w-4 text-indigo-500"})},ie=P=>{var I=ze(),_e=he(I);{var ge=te=>{$a(te,{class:"h-4 w-4 text-sky-500"})};d(_e,te=>{qt(e(F).dateTimeService)==="cloud"&&te(ge)},!0)}o(P,I)};d(xe,P=>{qt(e(F).dateTimeService)==="moon"?P(ee):P(ie,!1)},!0)}o($,re)};d(W,$=>{qt(e(F).dateTimeService)==="sun"?$(ce):$(le,!1)})}t(H),t(b);var X=s(b,2),de=a(X),be=a(de);Aa(be,{class:" me-1 h-3 w-3 stroke-2"});var me=s(be);t(de);var ve=s(de,2),Q=a(ve,!0);t(ve);var se=s(ve,2);{var Z=$=>{var re=qn(),xe=a(re);t(re),g(ee=>f(xe,`(${ee??""})`),[()=>l(e(F).q,e(F).u)]),o($,re)};d(se,$=>{e(U)!==e(G)&&$(Z)})}t(X),t(k),t(y),t(ae),g(($,re,xe)=>{f(Y,e(F).r),f(ue,`${$??""} - ${re??""} `),f(me,` ${(e(F).a||0)??""} c.`),f(Q,xe)},[()=>xt(e(F).date),()=>qs(e(F).date),()=>l(e(F).qEq,e(F).uEq)]),o(C,ae)}),t(x),o(A,x)};d(B,A=>{e(r).length===0?A(E):A(ne,!1)})}t(p),o(oe,v),Ve()}var In=i('<div class="alert alert-warning border-warning/20 m-4 border-b px-4 py-2 text-xs"><!> <span class="font-medium">Mode consultation</span> <span class="opacity-75">Événement terminé</span></div>'),En=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),$n=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),On=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),jn=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),zn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Nn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Fn=i('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),Bn=i('<span class="badge badge-sm badge-secondary ml-1">1</span>'),Ln=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Rn=i('<span class="badge badge-sm badge-secondary ml-1"> </span>'),Vn=i('<span class="badge badge-sm badge-ghost ml-1">0</span>'),Qn=i('<div class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Un=i("<!> <div><!></div>",1),Gn=i('<span class="loading loading-spinner loading-sm"></span>'),Wn=i("<!> Tout enregistrer",1),Hn=i('<button class="btn btn-primary"><!></button>'),Jn=i('<button class="btn btn-ghost"> </button> <!>',1),Kn=i('<!> <!> <div class="border-base-300 mb-4 flex-none border-b px-4"><div class="tabs tabs-border" role="tablist"><button role="tab"><!> <span class="hidden sm:inline">Recettes</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Magasin</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Volontaires</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Stock</span> <!></button> <button role="tab"><!> <span class="hidden sm:inline">Achats</span> <!></button></div></div> <!> <!>',1);function Xn(oe,n){Re(n,!0);let r=De(n,"initialTab",3,"recettes"),l=qe(null);bt(()=>{z(l,new wr(n.productId,r()),!0)});let v=L(()=>T.isEventPassed),q=L(()=>e(l)===null||e(l).product===null);function p(E){e(l)?.setCurrentTab(E)}function K(){e(l)?.saveAllChanges().then(()=>{e(l)?.resetForms(),n.onClose()})}function R(){e(l)?.resetForms(),n.onClose()}let B=L(()=>e(l)?.hasAnyChanges??!1);{let E=L(()=>!!n.productId);Dt(oe,{get isOpen(){return e(E)},onClose:R,get hasUnsavedChanges(){return e(B)},fullscreenOnMobile:!0,maxWidth:"lg",modalClass:"h-10/12",children:(ne,A)=>{var x=ze(),C=he(x);{var F=G=>{Pt(G,{title:"Chargement...",showBackButton:!0,onClose:R})},U=G=>{var ae=Kn(),y=he(ae);{let S=L(()=>e(l)?.product?.productName||"Produit");Pt(y,{get title(){return e(S)},showBackButton:!0,onClose:R})}var k=s(y,2);{var b=S=>{var m=In(),_=a(m);Da(_,{class:"h-4 w-4"}),Ae(4),t(m),o(S,m)};d(k,S=>{e(v)&&S(b)})}var V=s(k,2),Y=a(V),H=a(Y);H.__click=()=>p("recettes");var ue=a(H);_a(ue,{class:"mr-1 h-4 w-4"});var W=s(ue,4);{var ce=S=>{var m=En(),_=a(m,!0);t(m),g(()=>f(_,e(l).product.nbRecipes)),o(S,m)},le=S=>{var m=$n();o(S,m)};d(W,S=>{e(l)?.product?.nbRecipes&&e(l).product.nbRecipes>0?S(ce):S(le,!1)})}t(H);var X=s(H,2);X.__click=()=>p("magasins");var de=a(X);ct(de,{class:"mr-1 h-4 w-4"});var be=s(de,4);{var me=S=>{var m=On();o(S,m)};d(be,S=>{e(l)?.hasChanges?.store&&S(me)})}t(X);var ve=s(X,2);ve.__click=()=>p("volontaires");var Q=a(ve);Lt(Q,{class:"mr-1 h-4 w-4"});var se=s(Q,4);{var Z=S=>{var m=jn();o(S,m)},$=S=>{var m=ze(),_=he(m);{var h=M=>{var J=zn(),pe=a(J,!0);t(J),g(()=>f(pe,e(l).product.who.length)),o(M,J)},j=M=>{var J=Nn();o(M,J)};d(_,M=>{e(l)?.product?.who&&e(l).product.who.length>0?M(h):M(j,!1)},!0)}o(S,m)};d(se,S=>{e(l)?.hasChanges?.who?S(Z):S($,!1)})}t(ve);var re=s(ve,2);re.__click=()=>p("stock");var xe=a(re);es(xe,{class:"mr-1 h-4 w-4"});var ee=s(xe,4);{var ie=S=>{var m=Fn();o(S,m)},P=S=>{var m=ze(),_=he(m);{var h=M=>{var J=Bn();o(M,J)},j=M=>{var J=Ln();o(M,J)};d(_,M=>{e(l)?.stockParsed?M(h):M(j,!1)},!0)}o(S,m)};d(ee,S=>{e(l)?.hasChanges?.stock?S(ie):S(P,!1)})}t(re);var I=s(re,2);I.__click=()=>p("achats");var _e=a(I);kt(_e,{class:"mr-1 h-4 w-4"});var ge=s(_e,4);{var te=S=>{var m=Rn(),_=a(m,!0);t(m),g(()=>f(_,e(l).purchasesList.length)),o(S,m)},D=S=>{var m=Vn();o(S,m)};d(ge,S=>{e(l)?.purchasesList&&e(l).purchasesList.length>0?S(te):S(D,!1)})}t(I),t(Y),t(V);var N=s(V,2);At(N,{children:(S,m)=>{var _=Un(),h=he(_);{var j=pe=>{var ke=Qn(),u=a(ke);fa(u,{class:"h-4 w-4"});var c=s(u,2),w=a(c);t(c),t(ke),g(()=>f(w,`Erreur : ${e(l).error??""}`)),o(pe,ke)};d(h,pe=>{e(l)?.error&&pe(j)})}var M=s(h,2),J=a(M);_s(J,()=>e(l)?.currentTab,pe=>{var ke=ze(),u=he(ke);{var c=O=>{Tn(O,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},w=O=>{var fe=ze(),Se=he(fe);{var we=Pe=>{Kr(Pe,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Me=Pe=>{var Be=ze(),Ye=he(Be);{var at=Qe=>{ln(Qe,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Fe=Qe=>{var st=ze(),Xe=he(st);{var $e=Ie=>{cn(Ie,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})},Oe=Ie=>{var Ue=ze(),Ge=he(Ue);{var ot=We=>{pn(We,{get modalState(){return e(l)},get isArchiveMode(){return e(v)}})};d(Ge,We=>{e(l)?.currentTab==="magasins"&&We(ot)},!0)}o(Ie,Ue)};d(Xe,Ie=>{e(l)?.currentTab==="volontaires"?Ie($e):Ie(Oe,!1)},!0)}o(Qe,st)};d(Ye,Qe=>{e(l)?.currentTab==="stock"?Qe(at):Qe(Fe,!1)},!0)}o(Pe,Be)};d(Se,Pe=>{e(l)?.currentTab==="achats"?Pe(we):Pe(Me,!1)},!0)}o(O,fe)};d(u,O=>{e(l)?.currentTab==="recettes"?O(c):O(w,!1)})}o(pe,ke)}),t(M),o(S,_)}});var ye=s(N,2);ga(ye,{children:(S,m)=>{var _=Jn(),h=he(_);h.__click=R;var j=a(h,!0);t(h);var M=s(h,2);{var J=pe=>{var ke=Hn();ke.__click=K;var u=a(ke);{var c=O=>{var fe=Gn();o(O,fe)},w=O=>{var fe=Wn(),Se=he(fe);ba(Se,{class:"h-4 w-4"}),Ae(),o(O,fe)};d(u,O=>{e(l).loading?O(c):O(w,!1)})}t(ke),g(()=>ke.disabled=e(l).loading),o(pe,ke)};d(M,pe=>{e(l)?.hasAnyChanges&&pe(J)})}g(()=>f(j,e(l)?.hasAnyChanges?"Annuler":"Fermer")),o(S,_)}}),g(()=>{Ce(H,1,`tab ${e(l)?.currentTab==="recettes"?"tab-active":""}`),Ce(X,1,`tab ${e(l)?.currentTab==="magasins"?"tab-active":""}`),Ce(ve,1,`tab ${e(l)?.currentTab==="volontaires"?"tab-active":""}`),Ce(re,1,`tab ${e(l)?.currentTab==="stock"?"tab-active":""}`),Ce(I,1,`tab ${e(l)?.currentTab==="achats"?"tab-active":""}`)}),o(G,ae)};d(C,G=>{e(q)?G(F):G(U,!1)})}o(ne,x)},$$slots:{default:!0}})}Ve()}tt(["click"]);var Yn=i("<button><span> </span> <!></button>"),Zn=i('<div class="text-base-content/60 p-1 text-end text-xs italic">événement terminé</div>'),eo=i('<div class="join my-2 ms-auto"><button type="button" name="options" aria-label=" Dates à venir">Dates à venir</button> <button type="button" name="options" aria-label=" Toutes les dates">Toutes les dates</button></div>'),to=i('<div class="mb-2 flex flex-wrap gap-2"></div> <!>',1);function ao(oe,n){Re(n,!0);let r=L(()=>n.dateStore.start),l=L(()=>n.dateStore.end),v=qe(null);function q(x){e(r)&&new Date(x)<new Date(e(r))?n.dateStore.setRange(x,e(l)):e(l)&&new Date(x)>new Date(e(l))?n.dateStore.setRange(e(r),x):n.dateStore.setRange(x,x)}function p(x){return!e(r)||!e(l)?{start:null,end:null}:e(r)&&new Date(x)<new Date(e(r))?{start:x,end:e(l)}:e(l)&&new Date(x)>new Date(e(l))?{start:e(r),end:x}:{start:x,end:x}}function K(x){let C="";if(!e(r)||!e(l))return;const F=new Date(x)>=new Date(e(r))&&new Date(x)<=new Date(e(l)),U=new Date(x);U.setHours(U.getHours()+bs);const G=U<new Date;let ae=!1;if(e(v)){const y=p(e(v));y.start&&y.end&&(ae=new Date(x)>=new Date(y.start)&&new Date(x)<=new Date(y.end))}return G&&(C+=" opacity-70 italic"),F||(C+=" btn-dash"),ae&&!F&&(C+=" btn-soft"),C}var R=to(),B=he(R);Je(B,20,()=>n.dateStore.dates,x=>x,(x,C)=>{var F=Yn();F.__click=()=>q(C);var U=a(F),G=a(U,!0);t(U);var ae=s(U,2);{var y=b=>{Ia(b,{size:16})},k=b=>{var V=ze(),Y=he(V);{var H=W=>{Ea(W,{size:16})},ue=W=>{var ce=ze(),le=he(ce);{var X=de=>{$a(de,{size:16})};d(le,de=>{qt(C)==="cloud"&&de(X)},!0)}o(W,ce)};d(Y,W=>{qt(C)==="moon"?W(H):W(ue,!1)},!0)}o(b,V)};d(ae,b=>{qt(C)==="sun"?b(y):b(k,!1)})}t(F),g((b,V)=>{Ce(F,1,`btn btn-sm btn-secondary ${b??""}`),f(G,V)},[()=>K(C),()=>ra(C)]),Ee("mouseenter",F,()=>z(v,C,!0)),Ee("mouseleave",F,()=>z(v,null)),o(x,F)}),t(B);var E=s(B,2);{var ne=x=>{var C=Zn();o(x,C)},A=x=>{var C=eo(),F=a(C);F.__click=()=>n.dateStore.selectUpcoming();var U=s(F,2);U.__click=()=>n.dateStore.selectAll(),t(C),g(()=>{Ce(F,1,`join-item btn btn-sm ${n.dateStore.isUpcomingRange?"btn-soft btn-secondary":"btn-ghost"}`),Ce(U,1,`join-item btn btn-sm ${n.dateStore.isFullRange?"btn-soft btn-secondary":"btn-ghost"}`)}),o(x,C)};d(E,x=>{n.dateStore.isEventPassed?x(ne):x(A,!1)})}o(oe,R),Ve()}tt(["click"]);var so=i(`<div class="alert alert-warning">Cette période contient des dates passées. Les achats ne sont plus
          possibles pour ces dates.</div>`),ro=i("<!> <!>",1),no=i('<div class="alert alert-warning text-sm"><span>🔎 Les filtres sont désactivés pendant une recherche par nom.</span></div>'),oo=i("<button><!> </button>"),io=i('<button class="btn btn-sm btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de types et température"><!></button>'),lo=i('<div class="text-base-content/60 p-1 text-end text-xs italic">aucun filtre sélectionné</div>'),vo=i('<div class="mb-2 flex flex-wrap items-center gap-2" role="group"></div> <div class="bg-base-100 flex flex-wrap gap-1 rounded-xl p-2 font-semibold" role="group"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Frais uniquement"><!> Frais</button> <button type="button" aria-label="Sans frais"><!> <span class="line-through">Frais</span></button> <button type="button" aria-label="Surgelés uniquement"><!> Surgelés</button> <button type="button" aria-label="Sans surgelés"><!> <span class="line-through">surgelés</span></button></div> <!>',1),co=i("<button> </button>"),uo=i('<button class="btn btn-xs btn-circle btn-outline text-error ms-auto" title="Effacer les filtres de magasins"><!></button>'),mo=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),po=i("<button> </button>"),fo=i('<button class="btn btn-xs btn-circle btn-outline btn-error ms-auto" title="Effacer les filtres de qui"><!></button>'),_o=i('<div class="flex flex-wrap items-center gap-2" role="group"><!> <!></div>'),bo=i('<div class="mt-16 mb-4 flex items-center justify-between"><h3 class="flex items-center gap-2 text-lg font-semibold"><!> Filtres</h3> <button class="btn btn-sm btn-error btn-outline"><!> Tout effacer</button></div> <div class="mb-4 grid grid-cols-1 items-center justify-between gap-4"><div><label class="label" for="search-input"><span class="label-text">Recherche</span></label> <div class="input flex items-center gap-2"><!> <input id="search-input" type="text" placeholder="Nom du produit..." class="grow"/> <button class="btn btn-xs btn-circle btn-error btn-outline opacity-60"><!></button></div></div> <!> <!> <div><div><label class="label flex" for="completion-status"><span class="label-text">Statut :</span></label> <div class="bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="completion-status"><button type="button" aria-label="Tous">Tous</button> <button type="button" aria-label="Incomplets"><span class="add-to-cart"></span> Manque</button> <button type="button" aria-label="Complétés"><span class="cart-icon"></span> Complet</button></div></div> <div class="mb-4 flex flex-col"><label class="label flex" for="grouping-select"><span class="label-text">Groupement par:</span></label> <div class=" bg-base-100 flex gap-1 rounded-xl p-2 font-semibold" id="grouping-select"><button type="button" aria-label="Aucun">Aucun</button> <button type="button" aria-label="Par magasin">Magasins</button> <button type="button" aria-label="Par type">Type</button></div></div> <!> <!> <!></div></div>',1);function go(oe,n){Re(n,!0);const r=L(()=>T.filters),l=L(()=>T.uniqueStores),v=L(()=>T.uniqueWho),q=L(()=>T.uniqueProductTypes),p=L(()=>T.isSearchActive);var K=bo(),R=he(K),B=a(R),E=a(B);as(E,{class:"h-5 w-5"}),Ae(),t(B);var ne=s(B,2);ne.__click=()=>T.clearFilters();var A=a(ne);Et(A,{class:"h-4 w-4"}),Ae(),t(ne),t(R);var x=s(R,2),C=a(x),F=s(a(C),2),U=a(F);$s(U,{class:"h-4 w-4"});var G=s(U,2);vt(G),G.__input=I=>T.setSearchQuery(I.currentTarget.value);var ae=s(G,2);ae.__click=()=>T.setSearchQuery("");var y=a(ae);fa(y,{class:"h-4 w-4"}),t(ae),t(F),t(C);var k=s(C,2);{var b=I=>{ca(I,{legend:"Date incluses",bgClass:"bg-base-100",children:(_e,ge)=>{var te=ro(),D=he(te);ao(D,{get dateStore(){return T.dateStore}});var N=s(D,2);{var ye=S=>{var m=so();St(3,m,()=>Pa),o(S,m)};d(N,S=>{T.hasPastDatesInRange&&S(ye)})}o(_e,te)},$$slots:{default:!0}})};d(k,I=>{T.hasSingleDateEvent||I(b)})}var V=s(k,2);{var Y=I=>{var _e=no();St(3,_e,()=>Pa),o(I,_e)};d(V,I=>{e(p)&&I(Y)})}var H=s(V,2);let ue;var W=a(H);let ce;var le=s(a(W),2),X=a(le);X.__click=()=>T.setCompletionStatus("all");var de=s(X,2);de.__click=()=>T.setCompletionStatus("incomplete");var be=s(de,2);be.__click=()=>T.setCompletionStatus("completed"),t(le),t(W);var me=s(W,2),ve=s(a(me),2),Q=a(ve);Q.__click=()=>T.setGroupBy("none");var se=s(Q,2);se.__click=()=>T.setGroupBy("store");var Z=s(se,2);Z.__click=()=>T.setGroupBy("productType"),t(ve),t(me);var $=s(me,2);{var re=I=>{ca(I,{legend:"Types & Température",get iconComponent(){return Os},children:(_e,ge)=>{var te=vo(),D=he(te);Je(D,20,()=>e(q),w=>w,(w,O)=>{const fe=L(()=>ja(O));var Se=oo();Se.__click=()=>T.toggleProductType(O);var we=a(Se);Nt(we,()=>e(fe).icon,(Pe,Be)=>{Be(Pe,{class:"mr-1 h-5 w-5"})});var Me=s(we);t(Se),g(Pe=>{Ce(Se,1,`btn btn-sm ${Pe??""}`),f(Me,` ${e(fe).displayName??""}`)},[()=>e(r).selectedProductTypes.length===0?"btn-soft btn-secondary":e(r).selectedProductTypes.includes(O)?"btn-secondary":"btn-dash btn-secondary"]),o(w,Se)}),t(D);var N=s(D,2),ye=a(N);ye.__click=()=>T.setTemperatureFilter("all");var S=s(ye,2);S.__click=()=>T.setTemperatureFilter("frais");var m=a(S);ka(m,{class:"h-4 w-4"}),Ae(),t(S);var _=s(S,2);_.__click=()=>T.setTemperatureFilter("not-frais");var h=a(_);ka(h,{class:"h-4 w-4"}),Ae(2),t(_);var j=s(_,2);j.__click=()=>T.setTemperatureFilter("surgele");var M=a(j);Sa(M,{class:"h-4 w-4"}),Ae(),t(j);var J=s(j,2);J.__click=()=>T.setTemperatureFilter("not-surgele");var pe=a(J);Sa(pe,{class:"h-4 w-4"}),Ae(2),t(J),t(N);var ke=s(N,2);{var u=w=>{var O=io();O.__click=()=>T.clearTypeAndTemperatureFilters();var fe=a(O);Et(fe,{size:16}),t(O),o(w,O)},c=w=>{var O=lo();o(w,O)};d(ke,w=>{e(r).selectedProductTypes.length>0||e(r).selectedTemperatures.length>0||e(r).temperatureFilter!=="all"?w(u):w(c,!1)})}g(()=>{Ce(ye,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="all"?"btn-secondary":"btn-soft btn-secondary"}`),Ce(S,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="frais"?"btn-success":"btn-soft btn-success"}`),Ce(_,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-frais"?"btn-error":"btn-soft btn-error"}`),Ce(j,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="surgele"?"btn-info":"btn-soft btn-info"}`),Ce(J,1,`btn btn-sm flex-1 ${e(r).temperatureFilter==="not-surgele"?"btn-error":"btn-soft btn-error"}`)}),Ee("mouseenter",ye,()=>Te.msg="Ne pas filter en fonction des températures"),Ee("mouseleave",ye,()=>Te.reset()),Ee("mouseenter",S,()=>Te.msg="Afficher les produits frais uniquement"),Ee("mouseleave",S,()=>Te.reset()),Ee("mouseenter",_,()=>Te.msg="Exclure les produits frais"),Ee("mouseleave",_,()=>Te.reset()),Ee("mouseenter",j,()=>Te.msg="Afficher les produits surgelés uniquement"),Ee("mouseleave",j,()=>Te.reset()),Ee("mouseenter",J,()=>Te.msg="Exclure les produits surgelé"),Ee("mouseleave",J,()=>Te.reset()),o(_e,te)},$$slots:{default:!0}})};d($,I=>{e(q).length>0&&I(re)})}var xe=s($,2);{var ee=I=>{ca(I,{legend:"Magasins",get iconComponent(){return ct},children:(_e,ge)=>{var te=mo(),D=a(te);Je(D,16,()=>e(l),S=>S,(S,m)=>{var _=co();_.__click=()=>T.toggleStore(m);var h=a(_,!0);t(_),g(j=>{Ce(_,1,`btn btn-sm ${j??""}`),f(h,m)},[()=>e(r).selectedStores.length===0?"btn-soft btn-secondary":e(r).selectedStores.includes(m)?"btn-secondary":"btn-dash btn-secondary"]),o(S,_)});var N=s(D,2);{var ye=S=>{var m=uo();m.__click=()=>T.clearStoreFilters();var _=a(m);Et(_,{size:16}),t(m),o(S,m)};d(N,S=>{e(r).selectedStores.length>0&&S(ye)})}t(te),o(_e,te)},$$slots:{default:!0}})};d(xe,I=>{e(l).length>0&&I(ee)})}var ie=s(xe,2);{var P=I=>{ca(I,{legend:"Qui",get iconComponent(){return na},children:(_e,ge)=>{var te=_o(),D=a(te);Je(D,16,()=>e(v),S=>S,(S,m)=>{var _=po();_.__click=()=>T.toggleWho(m);var h=a(_,!0);t(_),g(j=>{Ce(_,1,`btn btn-sm ${j??""}`),f(h,m)},[()=>e(r).selectedWho.length===0?" btn-soft btn-secondary":e(r).selectedWho.includes(m)?" btn-secondary":"btn-dash btn-secondary"]),o(S,_)});var N=s(D,2);{var ye=S=>{var m=fo();m.__click=()=>T.clearWhoFilters();var _=a(m);Et(_,{size:16}),t(m),o(S,m)};d(N,S=>{e(r).selectedWho.length>0&&S(ye)})}t(te),o(_e,te)},$$slots:{default:!0}})};d(ie,I=>{e(v).length>0&&I(P)})}t(H),t(x),g(()=>{ne.disabled=!T.hasFilters,gs(G,e(r).searchQuery),ae.disabled=!e(r).searchQuery,ue=Ce(H,1,`space-y-4 ${e(p)?"pointer-events-none opacity-50":""}`,null,ue,{"transition-opacity":!0}),ce=Ce(W,1,"flex flex-col",null,ce,{"disabled-look":e(p)}),Ce(X,1,`btn flex-1 ${e(r).completionStatus==="all"&&"btn-primary"}`),Ce(de,1,`btn flex-1 ${e(r).completionStatus==="incomplete"&&"btn-warning"}`),Ce(be,1,`btn flex-1 ${e(r).completionStatus==="completed"&&"btn-success"}`),Ce(Q,1,`btn flex-1 ${e(r).groupBy==="none"&&"btn-secondary"}`),Ce(se,1,`btn flex-1 ${e(r).groupBy==="store"&&"btn-secondary"}`),Ce(Z,1,`btn flex-1 ${e(r).groupBy==="productType"&&"btn-secondary"}`)}),o(oe,K),Ve()}tt(["click","input"]);var ho=i('<div class="tooltip text-xs font-normal"><!></div>');function xo(oe,n){let r=De(n,"iconSize",3,24),l=n.icon||void 0;var v=ho(),q=a(v);{var p=K=>{l(K,{get size(){return r()},class:`align-top
`})};d(q,K=>{n.icon&&K(p)})}t(v),g(()=>Ct(v,"data-tip",n.tip)),o(oe,v)}var yo=i('<div class="tooltip"><div class="badge badge-soft badge-sm hover:badge-primary flex items-center gap-1"><span class="whitespace-nowrap"> </span> <!></div></div>');function Ga(oe,n){Re(n,!0);let r=De(n,"recipes",19,()=>[]);const l=L(()=>n.dateDisplayInfo.timeIcon==="sun"?Ia:n.dateDisplayInfo.timeIcon==="moon"?Ea:n.dateDisplayInfo.timeIcon==="cloud"?$a:null);var v=yo(),q=a(v),p=a(q),K=a(p,!0);t(p);var R=s(p,2);{var B=E=>{var ne=ze(),A=he(ne);Nt(A,()=>e(l),(x,C)=>{C(x,{class:"h-3 w-3 stroke-3"})}),o(E,ne)};d(R,E=>{e(l)&&E(B)})}t(q),t(v),g(E=>{Ct(v,"data-tip",E),f(K,n.dateDisplayInfo.formattedDate)},[()=>r().map(E=>E.r).join(", ")]),o(oe,v),Ve()}var wo=Xa("<title> </title>"),ko=Xa("<svg><!><use></use></svg>");function So(oe,n){let r=De(n,"size",3,24),l=De(n,"class",3,""),v=Ha(n,["$$slots","$$events","$$legacy","name","size","title","class"]);var q=ko();Wa(q,()=>({width:r(),height:r(),class:l(),"aria-hidden":n.title?void 0:"true",...v}));var p=a(q);{var K=B=>{var E=wo(),ne=a(E,!0);t(E),g(()=>f(ne,n.title)),o(B,E)};d(p,B=>{n.title&&B(K)})}var R=s(p);t(q),g(()=>Ct(R,"href",`/icons/sprite.svg#${n.name??""}`)),o(oe,q)}var Po=i('<div class="text-base-content/60 text-sm font-normal"> </div>'),Mo=i('<div class="tooltip" data-tip="Ajouté manuellement, ne fait pas partie des recette"><!></div>'),qo=i('<div class="bg-success/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit frais"><!></div>'),Co=i('<div class="bg-info/20 flex h-6 w-6 items-center justify-center rounded-full" title="Produit surgelé"><!></div>'),Do=i('<div class="text-accent flex items-center gap-1" title="Synchronisation en cours..."><!></div>'),Ao=i('<div class="text-base-content/60"><div class="flex flex-wrap items-center gap-1"></div></div>'),To=i('<div class="ml-1"><!></div>'),Io=i('<div class="ml-1"> </div> <!>',1),Eo=i('<div class="ml-1 text-sm font-medium">?</div>'),$o=i('<span class="text-base-content/50 text-xs"> </span>'),Oo=i('<div class="ml-1 flex gap-1"> <!></div>'),jo=i('<div class="ml-1 text-sm font-medium">?</div>'),zo=i('<div class="ml-4 flex gap-2 self-start"><button title="Modifier le magasin"><!> <!></button> <button title="Modifier les volontaires"><!> <!></button></div>'),No=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),Fo=i('<div class="flex items-center gap-1 text-sm"><!> </div>'),Bo=i('<div class="mx-4 flex gap-2 opacity-60"><!> <!></div>'),Lo=i('<div class="text-base-content/60"><div class="flex flex-wrap gap-1"></div></div>'),Ro=i('<div class="tooltip flex items-center gap-2" data-tip="Besoin total modifié manuellement"><span class="text-base-content/70 line-through"> </span> <!> </div>'),Vo=i("<span> </span>"),Qo=i('<div class="text-base-content/90 flex items-center gap-2"><span class="flex items-center gap-1"> <!></span> <span class="flex items-center gap-1"> <!></span></div>'),Uo=i('<button class="btn btn-sm btn-outline btn-primary ms-auto"><span class="text-xs"><span class="font-light">manque :</span> </span> <span class="text-primary"><!></span></button>'),Go=i(`<div id="override_alert" class="alert alert-warning alert-outline mt-1"><!> <span>Les menus ont été modifié depuis la définition manuelle des
                besoins: <!> <!></span></div>`),Wo=i('<div class="badge badge-outline badge-lg badge-secondary flex h-auto flex-col items-center gap-1"><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <span class="text-xs opacity-75"> </span></div>'),Ho=i('<span class="text-xs opacity-75"><!></span>'),Jo=i('<div><div class="flex items-center gap-1"><!> <span class="text-sm font-medium text-nowrap"> </span></div> <!></div>'),Ko=i('<div class="text-base-content/50 text-xs italic">aucun</div>'),Xo=i('<div><div class="card-body p-2"><div class="flex items-start justify-between"><div class="flex flex-1 cursor-pointer flex-wrap items-center gap-4" role="button" tabindex="0"><div class="text-primary flex items-center gap-2 text-base font-semibold"><!> <!> <!></div> <div class="flex gap-1"><!> <!></div> <!> <!></div> <!></div> <!> <div class="flex min-h-14 flex-wrap gap-3" id="card-needs-missing"><div class="flex min-w-75 flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Besoins total sur la période</div> <div id="needs-card" role="button" tabindex="0" class=" bg-base-300/80 group hover:ring-accent/60 relative flex flex-1 cursor-pointer flex-wrap items-center justify-between gap-x-4 gap-y-1 rounded-lg p-3 shadow-sm hover:ring-2"><div class="ms-2 flex items-end justify-center gap-4"><div><!></div> <!></div> <!> <!></div></div> <div class="flex min-w-[300px] flex-1 flex-col"><div class="text-base-content/60 ms-1 text-sm">Achat / reccup effectué</div> <div class="group hover:ring-accent/60 bg-base-300/80 relative flex flex-1 cursor-pointer items-start justify-between gap-2 rounded-lg p-3 shadow-sm transition-colors hover:ring-2" role="button" tabindex="0"><!> <div>ajouter un achat</div> <div class="ms-auto flex flex-wrap gap-1.5"><!> <!> <!></div></div></div></div></div></div>');function Yo(oe,n){Re(n,!0);const r={Package:Ca,MessageCircleQuestionMark:kt,ShoppingCart:kt,Clock:rs,CircleCheck:Bs,CircleX:Fs,ClipboardCheck:Ns,PackageCheck:ss,Check:ba},l=L(()=>n.productModel.data),v=L(()=>n.productModel.stats),q=L(()=>ja(e(l).productType)),p=L(()=>Us(e(l).purchases||[])),K=L(()=>e(l).totalNeededOverrideParsed),R=L(()=>Ka(e(l)));var B=Xo(),E=a(B),ne=a(E),A=a(ne);A.__click=()=>n.onOpenModal(e(l).$id,"recettes"),A.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var x=a(A),C=a(x);Nt(C,()=>e(q).icon,(u,c)=>{c(u,{class:"h-4 w-4"})});var F=s(C),U=s(F);{var G=u=>{var c=Po(),w=a(c);t(c),g(()=>f(w,`Ancien: ${e(l).previousNames[0]??""}`)),o(u,c)};d(U,u=>{e(l).previousNames&&e(l).previousNames.length>0&&u(G)})}var ae=s(U,2);{var y=u=>{var c=Mo(),w=a(c);Va(w,{class:"text-warning h-4 w-4"}),t(c),o(u,c)};d(ae,u=>{e(l).productHugoUuid||u(y)})}t(x);var k=s(x,2),b=a(k);{var V=u=>{var c=qo(),w=a(c);ka(w,{class:"text-success h-4 w-4"}),t(c),o(u,c)};d(b,u=>{e(l).pF&&u(V)})}var Y=s(b,2);{var H=u=>{var c=Co(),w=a(c);Sa(w,{class:"text-info h-4 w-4"}),t(c),o(u,c)};d(Y,u=>{e(l).pS&&u(H)})}t(k);var ue=s(k,2);{var W=u=>{var c=Do(),w=a(c);js(w,{class:"h-4 w-4 animate-spin"}),t(c),o(u,c)};d(ue,u=>{e(l).status==="isSyncing"&&u(W)})}var ce=s(ue,2);{var le=u=>{var c=Ao(),w=a(c);Je(w,20,()=>e(v).concernedDates,O=>O,(O,fe)=>{const Se=L(()=>e(v).recipesByDate.get(fe)||[]),we=L(()=>n.productModel.data.dateDisplayInfo[fe]||Ra(fe));Ga(O,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(w),t(c),o(u,c)};d(ce,u=>{!Ke.isMobile&&e(v).concernedDates.length>0&&u(le)})}t(A);var X=s(A,2);{var de=u=>{var c=zo(),w=a(c);w.__click=()=>n.onOpenModal(e(l).$id,"magasins"),w.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"magasins");var O=a(w);ct(O,{size:18});var fe=s(O,2);{var Se=Fe=>{var Qe=Io(),st=he(Qe),Xe=a(st,!0);t(st);var $e=s(st,2);{var Oe=Ie=>{var Ue=To(),Ge=a(Ue);xo(Ge,{get tip(){return e(l).storeInfo.storeComment},get icon(){return Ls},iconSize:14}),t(Ue),o(Ie,Ue)};d($e,Ie=>{e(l).storeInfo?.storeComment&&Ie(Oe)})}g(()=>f(Xe,e(l).storeInfo.storeName)),o(Fe,Qe)},we=Fe=>{var Qe=Eo();o(Fe,Qe)};d(fe,Fe=>{e(l).storeInfo?.storeName?Fe(Se):Fe(we,!1)})}t(w);var Me=s(w,2);Me.__click=()=>n.onOpenModal(e(l).$id,"volontaires"),Me.__keydown=Fe=>Fe.key==="Enter"&&n.onOpenModal(e(l).$id,"volontaires");var Pe=a(Me);Lt(Pe,{size:18});var Be=s(Pe,2);{var Ye=Fe=>{var Qe=ze(),st=he(Qe);{var Xe=Oe=>{var Ie=Oo(),Ue=a(Ie),Ge=s(Ue);{var ot=We=>{var it=$o(),Ne=a(it);t(it),g(()=>f(Ne,`+${e(l).who.length-2}`)),o(We,it)};d(Ge,We=>{e(l).who.length>2&&We(ot)})}t(Ie),g(We=>f(Ue,`${We??""}... `),[()=>e(l).who.slice(0,2).map(We=>We.slice(0,5)).join(" | ")]),o(Oe,Ie)},$e=Oe=>{var Ie=ze(),Ue=he(Ie);{var Ge=ot=>{var We=et();g(()=>f(We,e(l).who)),o(ot,We)};d(Ue,ot=>{e(l).who.length===1&&ot(Ge)},!0)}o(Oe,Ie)};d(st,Oe=>{e(l).who.length>1?Oe(Xe):Oe($e,!1)})}o(Fe,Qe)},at=Fe=>{var Qe=jo();o(Fe,Qe)};d(Be,Fe=>{e(l).who&&e(l).who.length?Fe(Ye):Fe(at,!1)})}t(Me),t(c),g(()=>{Ce(w,1,`btn btn-soft btn-xs sm:btn-sm group relative ${e(l).storeInfo?.storeName?"btn-success":""}`),Ce(Me,1,`btn btn-xs sm:btn-sm btn-soft group relative ${e(l).who&&e(l).who?.length>0?"btn-success":""}`)}),Ee("mouseenter",w,()=>Te.msg="Définissez le magasin où acheter le produit"),Ee("mouseleave",w,()=>Te.reset()),Ee("mouseenter",Me,()=>Te.msg="Déclarez qui est responsable de l'achat de ce produit"),Ee("mouseleave",Me,()=>Te.reset()),o(u,c)},be=u=>{var c=Bo(),w=a(c);{var O=we=>{var Me=No(),Pe=a(Me);ct(Pe,{size:16});var Be=s(Pe);t(Me),g(()=>f(Be,` ${e(l).storeInfo.storeName??""}`)),o(we,Me)};d(w,we=>{e(l).storeInfo?.storeName&&we(O)})}var fe=s(w,2);{var Se=we=>{var Me=Fo(),Pe=a(Me);Lt(Pe,{size:16});var Be=s(Pe);t(Me),g(Ye=>f(Be,` ${Ye??""}`),[()=>e(l).who.join(", ")]),o(we,Me)};d(fe,we=>{e(l).who&&e(l).who.length>0&&we(Se)})}t(c),o(u,c)};d(X,u=>{n.shouldShowActionButtons?u(de):u(be,!1)})}t(ne);var me=s(ne,2);{var ve=u=>{var c=Lo(),w=a(c);Je(w,20,()=>e(v).concernedDates,O=>O,(O,fe)=>{const Se=L(()=>e(v).recipesByDate.get(fe)||[]),we=L(()=>n.productModel.data.dateDisplayInfo[fe]||Ra(fe));Ga(O,{get dateDisplayInfo(){return e(we)},get recipes(){return e(Se)}})}),t(w),t(c),o(u,c)};d(me,u=>{Ke.isMobile&&e(v).concernedDates.length>0&&u(ve)})}var Q=s(me,2),se=a(Q),Z=s(a(se),2);Z.__click=()=>n.onOpenModal(e(l).$id,"recettes"),Z.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"recettes");var $=a(Z),re=a($),xe=a(re);{var ee=u=>{var c=Ro(),w=a(c),O=a(w,!0);t(w);var fe=s(w,2);Va(fe,{class:"h-4 w-4"});var Se=s(fe);t(c),g(()=>{f(O,e(v).formattedQuantities),f(Se,` ${e(K).totalOverride.q??""}
                  ${e(K).totalOverride.u??""}`)}),o(u,c)},ie=u=>{var c=Vo(),w=a(c,!0);t(c),g(()=>f(w,e(v).formattedQuantities)),o(u,c)};d(xe,u=>{e(K)?.totalOverride?u(ee):u(ie,!1)})}t(re);var P=s(re,2);{var I=u=>{var c=Qo(),w=a(c),O=a(w),fe=s(O);_a(fe,{class:"h-3 w-3"}),t(w);var Se=s(w,2),we=a(Se),Me=s(we);Aa(Me,{class:"h-3 w-3"}),t(Se),t(c),g(()=>{f(O,`${e(v).nbRecipes??""} `),f(we,`${e(v).totalAssiettes??""} `)}),o(u,c)};d(P,u=>{(e(v).nbRecipes||e(v).totalAssiettes)&&u(I)})}t($);var _e=s($,2);{var ge=u=>{var c=Uo();c.__click=we=>{we.stopPropagation(),n.onQuickValidation(e(l),e(v))};var w=a(c),O=s(a(w));t(w);var fe=s(w,2),Se=a(fe);So(Se,{name:"add-to-cart",size:16}),t(fe),t(c),g(()=>f(O,` ${e(v).formattedMissingQuantities??""}`)),Ee("mouseenter",c,()=>Te.msg="Ajouter aux achats effectués"),Ee("mouseleave",c,()=>Te.reset()),o(u,c)},te=u=>{var c=ze(),w=he(c);{var O=fe=>{ns(fe,{size:24,class:"text-success ms-auto"})};d(w,fe=>{n.shouldShowActionButtons&&fe(O)},!0)}o(u,c)};d(_e,u=>{n.shouldShowActionButtons&&e(v).hasMissing?u(ge):u(te,!1)})}var D=s(_e,2);{var N=u=>{var c=Go(),w=a(c);Ta(w,{size:18});var O=s(w,2),fe=s(a(O));{var Se=Pe=>{var Be=et();g(()=>f(Be,`${e(R).details?.oldPlates??""}→${e(R).details?.newPlates??""} couverts`)),o(Pe,Be)};d(fe,Pe=>{e(R).platesChanged&&Pe(Se)})}var we=s(fe,2);{var Me=Pe=>{var Be=et();g(()=>f(Be,`${e(R).details?.oldRecipes??""}→${e(R).details?.newRecipes??""}
                  recettes`)),o(Pe,Be)};d(we,Pe=>{e(R).recipesChanged&&Pe(Me)})}t(O),t(c),o(u,c)};d(D,u=>{n.shouldShowActionButtons&&e(R)?.hasMismatch&&u(N)})}t(Z),t(se);var ye=s(se,2),S=s(a(ye),2);S.__click=()=>n.onOpenModal(e(l).$id,"achats"),S.__keydown=u=>u.key==="Enter"&&n.onOpenModal(e(l).$id,"achats");var m=a(S);kt(m,{class:"h-4 w-4 opacity-60"});var _=s(m,2),h=s(_,2),j=a(h);{var M=u=>{var c=Wo(),w=a(c),O=a(w);zs(O,{class:"text-secondary h-4 w-4"});var fe=s(O,2),Se=a(fe);t(fe),t(w);var we=s(w,2),Me=a(we);t(we),t(c),g(Pe=>{f(Se,`${e(l).stockParsed.quantity??""}
                    ${e(l).stockParsed.unit??""}`),f(Me,`stock: ${Pe??""}`)},[()=>ra(e(l).stockParsed.dateTime)]),o(u,c)};d(j,u=>{e(l).stockParsed&&u(M)})}var J=s(j,2);Je(J,17,()=>e(p),_t,(u,c)=>{const w=L(()=>r[e(c).icon]);var O=Jo(),fe=a(O),Se=a(fe);Nt(Se,()=>e(w),(Ye,at)=>{at(Ye,{class:"h-4 w-4"})});var we=s(Se,2),Me=a(we);t(we),t(fe);var Pe=s(fe,2);{var Be=Ye=>{var at=Ho(),Fe=a(at);{var Qe=Xe=>{var $e=et();g(()=>f($e,`livré le: ${e(c).deliveryDate??""}`)),o(Xe,$e)},st=Xe=>{var $e=et("livraison ?");o(Xe,$e)};d(Fe,Xe=>{e(c).deliveryDate?Xe(Qe):Xe(st,!1)})}t(at),o(Ye,at)};d(Pe,Ye=>{e(c).status==="ordered"&&Ye(Be)})}t(O),g(()=>{Ce(O,1,`badge badge-outline badge-lg flex h-auto flex-col items-center gap-1 ${e(c).badgeClass??""}`),f(Me,`${e(c).quantity??""}
                    ${e(c).unit??""}`)}),o(u,O)});var pe=s(J,2);{var ke=u=>{var c=Ko();o(u,c)};d(pe,u=>{e(p).length===0&&!e(l)?.stockParsed&&u(ke)})}t(h),t(S),t(ye),t(Q),t(E),t(B),g(()=>{Ce(B,1,`card bg-base-100 ${(Ke.isMobile&&"border-base-300 border shadow")??""} ${e(l).status==="isSyncing"?"border-accent bg-accent/30 animate-pulse border-2":""}`),f(F,`${e(l).productName??""} `),Ce(re,1,`text-base font-bold ${e(v).hasMissing&&n.shouldShowActionButtons?"text-error":"text-success"}`),Ce(_,1,`text-base-content/30 blocktransition-opacity ms-2 text-xs italic ${n.shouldShowActionButtons?"group-hover:block":"hidden"} sm:hidden`)}),Ee("mouseenter",A,()=>Te.msg="Afficher les informations sur ce produit"),Ee("mouseleave",A,()=>Te.reset()),Ee("mouseenter",Z,()=>Te.msg="Afficher les informations sur ce produit"),Ee("mouseleave",Z,()=>Te.reset()),Ee("mouseenter",S,()=>Te.msg="Déclarez des achats effectués"),Ee("mouseleave",S,()=>Te.reset()),St(3,B,()=>Oa),o(oe,B),Ve()}tt(["click","keydown"]);var Zo=i('<div class="text-primary-content flex items-center gap-2"><!> </div>'),ei=i('<div class="text-primary-content flex items-center gap-2"><!> <span> </span> <span class="text-sm opacity-70"> </span></div>'),ti=i('<div class="font-semibold">Sur toute la période</div>'),ai=i('du <span class="font-semibold"> </span> au <span class="font-semibold"> </span>',1),si=i('le <span class="font-semibold"> </span>',1),ri=i('<div class="text-primary-content px-2 text-shadow-md"><!></div>'),ni=i('<span class="font-semibold"> </span>'),oi=i('le <span class="font-semibold"> </span>',1),ii=i('<div class="text-primary-content"><!></div>'),li=i(`<button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Ouvrir le modal d'achat groupé"><!> <span class="hidden @md:block">Achat groupé</span> <!></button>`),di=i('<div class="ms-auto flex flex-wrap items-center justify-end gap-2"><button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Attribuer un magasin à tous les produits de ce groupe"><!> <span class="hidden @md:block">Magasin</span> <!></button> <button class="btn btn-xs md:btn-sm btn-primary btn-soft" title="Gérer les volontaires pour tous les produits de ce groupe"><!> <span class="hidden @md:block">Volontaires</span> <!></button> <!></div>'),vi=i('<div class="flex flex-wrap items-center justify-end gap-2"><div class="alert px-4 py-1" title="Contient des dates passées - actions non disponibles"><!> <span class="hidden @md:block">Période partiellement passée</span></div></div>'),ci=i('<div><div class="flex items-center gap-2 font-bold text-shadow-md/20 md:text-lg @md:min-w-48"><!></div> <!> <!></div>'),ui=i('<div><!> <div class="mt-4 mb-8 space-y-4 sm:space-y-2"></div></div>'),mi=i('<div class="mt-6 mb-2"><div class="border-b-2 border-gray-800 pb-1 font-bold uppercase"> <span class="ml-2 text-sm font-normal normal-case opacity-70"> </span> <span class="float-right ml-auto text-xs font-normal opacity-50"><!></span></div></div>'),pi=i('<th class="w-3/12 border px-2 py-1">Qui / Type</th>'),fi=i('<th class="w-3/12 border px-2 py-1">Store / Qui</th>'),_i=i('<span class="block text-[9pt] font-normal opacity-60"> </span>'),bi=i('<div class="font-medium"> </div>'),gi=i('<div class="flex gap-6"><!> <div class="text-[9pt] opacity-70"> </div></div>'),hi=i('<div class="font-medium"> </div>'),xi=i('<div class="text-[9pt] opacity-70"> </div>'),yi=i('<div class="flex gap-6"><!> <!></div>'),wi=i('<span class="text-xs opacity-70"> </span>'),ki=i('<div class="text-nowrap"> </div>'),Si=i('<div class="flex flex-col items-end gap-0.5"><div class="font-medium text-nowrap"> <!></div> <!></div>'),Pi=i('<div class="text-nowrap"> </div>'),Mi=i('<div class="flex flex-col items-end gap-0.5"></div>'),qi=i('<tr class="break-inside-avoid border-b border-gray-300"><td class="border px-2 py-1 text-center"><div class="mx-auto h-4 w-4 border border-gray-400"></div></td><td class="border px-2 py-1 font-medium"> <!></td><td class="border px-2 py-1 text-sm font-bold"><!></td><td class="border px-2 py-1 text-sm"><!></td><td class="border px-2 py-1 text-right text-sm"><!></td></tr>'),Ci=i('<div class="break-inside-avoid"><!> <table class="table-compact table w-full border-collapse"><thead><tr class="border-b border-gray-400 bg-gray-100 text-left"><th class="w-1/12 border px-2 py-1">Check</th><th class="w-4/12 border px-2 py-1">Produit</th><th class="w-2/12 border px-2 py-1">Besoin</th><!><th class="w-2/12 border px-2 py-1 text-right">Acheté</th></tr></thead><tbody></tbody></table></div>'),Di=i("<span>Aucune recette pour le moment</span>"),Ai=i("<span>Aucun produit trouvé avec les filtres actuels</span>"),Ti=i('<div class="py-8 text-center"><div class="alert alert-info max-md:alert-vertical"><svg class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <!></div></div>'),Ii=i('<div><!> <div class="hidden w-full print:block"></div></div> <!>',1);function Ei(oe,n){Re(n,!0);let r=De(n,"disabled",3,!1);const l=L(()=>T.groupedFilteredProducts),v=T.filters,q=xt(T.dateStore.start),p=xt(T.dateStore.end),K=L(()=>!T.dateStore.isEventPassed&&!T.dateStore.hasPastDatesInRange),R=L(()=>v.completionStatus==="completed"?"bg-emerald-800":v.completionStatus==="incomplete"?"bg-amber-800":"bg-primary");let B=Ze([]),E=qe(Ze(new Map));bt(()=>{const G=Object.keys(e(l));B.forEach((ae,y)=>{if(!ae)return;const k=G[y];k&&hs(()=>ae,b=>{const V=b[0];if(!V)return;const Y=V.intersectionRatio>=.05;z(E,new Map(e(E)).set(k,Y),!0)},{threshold:[0,.05,1]})})});var ne=Ii(),A=he(ne),x=a(A);Je(x,19,()=>Object.entries(e(l)),([G,ae])=>G,(G,ae,y)=>{var k=L(()=>ma(e(ae),2));let b=()=>e(k)[0];const Y=L(()=>e(k)[1]);var H=ui(),ue=a(H);{var W=le=>{const X=L(()=>ja(b())),de=L(()=>e(E).get(b())??!0);var be=ci(),me=a(be),ve=a(me);{var Q=P=>{var I=Zo(),_e=a(I);ct(_e,{class:"size-4 md:size-5"});var ge=s(_e);t(I),g(()=>f(ge,` ${b()??""} (${e(Y).length??""})`)),o(P,I)},se=P=>{var I=ze(),_e=he(I);{var ge=D=>{var N=ei(),ye=a(N);Nt(ye,()=>e(X).icon,(j,M)=>{M(j,{class:"size-4 md:size-5"})});var S=s(ye,2),m=a(S,!0);t(S);var _=s(S,2),h=a(_);t(_),t(N),g(()=>{f(m,e(X).displayName),f(h,`(${e(Y).length??""})`)}),o(D,N)},te=D=>{var N=et();g(()=>f(N,`📦 ${b()??""} (${e(Y).length??""})`)),o(D,N)};d(_e,D=>{v.groupBy==="productType"?D(ge):D(te,!1)},!0)}o(P,I)};d(ve,P=>{v.groupBy==="store"?P(Q):P(se,!1)})}t(me);var Z=s(me,2);{var $=P=>{var I=ri(),_e=a(I);{var ge=D=>{var N=ti();o(D,N)},te=D=>{var N=ze(),ye=he(N);{var S=_=>{var h=ai(),j=s(he(h)),M=a(j,!0);t(j);var J=s(j,2),pe=a(J,!0);t(J),g((ke,u)=>{f(M,ke),f(pe,u)},[()=>Mt(T.dateStore.start),()=>Mt(T.dateStore.end)]),o(_,h)},m=_=>{var h=si(),j=s(he(h)),M=a(j,!0);t(j),g(J=>f(M,J),[()=>Mt(T.dateStore.start)]),o(_,h)};d(ye,_=>{T.dateStore.start!==T.dateStore.end?_(S):_(m,!1)},!0)}o(D,N)};d(_e,D=>{T.dateStore.isFullRange&&T.dateStore.start!==T.dateStore.end?D(ge):D(te,!1)})}t(I),o(P,I)},re=P=>{var I=ii(),_e=a(I);{var ge=D=>{var N=ni(),ye=a(N);t(N),g((S,m)=>f(ye,`${S??""} → ${m??""}`),[()=>Mt(T.dateStore.start),()=>Mt(T.dateStore.end)]),o(D,N)},te=D=>{var N=oi(),ye=s(he(N)),S=a(ye,!0);t(ye),g(m=>f(S,m),[()=>Mt(T.dateStore.start,!0)]),o(D,N)};d(_e,D=>{!T.dateStore.isFullRange&&T.dateStore.start!==T.dateStore.end?D(ge):D(te,!1)})}t(I),o(P,I)};d(Z,P=>{Ke.isMobile?P(re,!1):P($)})}var xe=s(Z,2);{var ee=P=>{var I=di(),_e=a(I);_e.__click=()=>n.onOpenGroupEditModal("store",e(Y).map(_=>_.data.$id),e(Y).map(_=>_.data));var ge=a(_e);ct(ge,{size:16});var te=s(ge,4);yt(te,{size:16}),t(_e);var D=s(_e,2);D.__click=()=>n.onOpenGroupEditModal("who",e(Y).map(_=>_.data.$id),e(Y).map(_=>_.data));var N=a(D);Lt(N,{size:16});var ye=s(N,4);yt(ye,{size:16}),t(D);var S=s(D,2);{var m=_=>{var h=li();h.__click=()=>n.onOpenGroupPurchaseModal(e(Y).map(J=>J.data));var j=a(h);kt(j,{size:16});var M=s(j,4);ns(M,{size:16}),t(h),Ee("mouseenter",h,()=>Te.msg="Déclarez tout ou partie des produits de ce groupe comme acheté"),Ee("mouseleave",h,()=>Te.reset()),o(_,h)};d(S,_=>{e(Y).some(h=>h.data.displayMissingQuantity!=="✅ Complet")&&_(m)})}t(I),Ee("mouseenter",_e,()=>Te.msg="Définissez un magasin où seront acheté tous les produits de ce groupe"),Ee("mouseleave",_e,()=>Te.reset()),Ee("mouseenter",D,()=>Te.msg="Définissez qui est responsable de l'achat de tous les produits de ce groupe"),Ee("mouseleave",D,()=>Te.reset()),o(P,I)},ie=P=>{var I=ze(),_e=he(I);{var ge=te=>{var D=vi(),N=a(D),ye=a(N);rs(ye,{size:16}),Ae(2),t(N),t(D),o(te,D)};d(_e,te=>{T.dateStore.hasPastDatesInRange&&te(ge)},!0)}o(P,I)};d(xe,P=>{e(K)?P(ee):P(ie,!1)})}t(be),g(()=>Ce(be,1,`${e(R)??""} @container sticky ${Ke.isMobile?Ke.headerVisible?"top-12":"top-0":"top-13 rounded-lg"} z-2 flex flex-wrap items-center justify-between px-4 py-2 shadow-md transition-all duration-300 @md:flex-nowrap print:shadow-none ${e(de)?"opacity-100":"pointer-events-none opacity-0"}`)),o(le,be)};d(ue,le=>{b()!==""&&le(W)})}var ce=s(ue,2);Je(ce,21,()=>e(Y),le=>le.data.$id,(le,X)=>{Yo(le,{get productModel(){return e(X)},get shouldShowActionButtons(){return e(K)},get onOpenModal(){return n.onOpenModal},get onQuickValidation(){return n.onQuickValidation}})}),t(ce),t(H),xs(H,(le,X)=>B[X]=le,le=>B?.[le],()=>[e(y)]),St(3,ce,()=>Oa),o(G,H)});var C=s(x,2);Je(C,21,()=>Object.entries(e(l)),([G,ae])=>G,(G,ae)=>{var y=L(()=>ma(e(ae),2));let k=()=>e(y)[0],b=()=>e(y)[1];var V=Ci(),Y=a(V);{var H=me=>{var ve=mi(),Q=a(ve),se=a(Q),Z=s(se),$=a(Z);t(Z);var re=s(Z,2),xe=a(re);{var ee=P=>{var I=et("Toute la période");o(P,I)},ie=P=>{var I=ze(),_e=he(I);{var ge=D=>{var N=et();g(()=>f(N,`du ${q??""} au ${p??""}`)),o(D,N)},te=D=>{var N=et();g(()=>f(N,`le ${q??""}`)),o(D,N)};d(_e,D=>{T.dateStore.start!==T.dateStore.end?D(ge):D(te,!1)},!0)}o(P,I)};d(xe,P=>{T.dateStore.isFullRange?P(ee):P(ie,!1)})}t(re),t(Q),t(ve),g(()=>{f(se,`${(k()==="Non défini"?"Groupe inconnu":k())??""} `),f($,`(${b().length??""} produits)`)}),o(me,ve)};d(Y,me=>{k()!==""&&me(H)})}var ue=s(Y,2),W=a(ue),ce=a(W),le=s(a(ce),3);{var X=me=>{var ve=pi();o(me,ve)},de=me=>{var ve=fi();o(me,ve)};d(le,me=>{v.groupBy==="store"?me(X):me(de,!1)})}Ae(),t(ce),t(W);var be=s(W);Je(be,21,b,me=>me.data.$id,(me,ve)=>{const Q=L(()=>e(ve).data),se=L(()=>e(ve).stats);var Z=qi(),$=s(a(Z)),re=a($),xe=s(re);{var ee=h=>{var j=_i(),M=a(j);t(j),g(()=>f(M,`(Ancien: ${e(Q).previousNames[0]??""})`)),o(h,j)};d(xe,h=>{e(Q).previousNames&&e(Q).previousNames.length>0&&h(ee)})}t($);var ie=s($),P=a(ie);{var I=h=>{var j=et();g(()=>f(j,`${e(Q).totalNeededOverrideParsed.totalOverride.q??""}
                    ${e(Q).totalNeededOverrideParsed.totalOverride.u??""}`)),o(h,j)},_e=h=>{var j=et();g(()=>f(j,e(se).formattedQuantities)),o(h,j)};d(P,h=>{e(Q).totalNeededOverrideParsed?.totalOverride?h(I):h(_e,!1)})}t(ie);var ge=s(ie),te=a(ge);{var D=h=>{var j=gi(),M=a(j);{var J=u=>{var c=bi(),w=a(c,!0);t(c),g(O=>f(w,O),[()=>e(Q).who.join(", ")]),o(u,c)};d(M,u=>{e(Q).who?.length&&u(J)})}var pe=s(M,2),ke=a(pe,!0);t(pe),t(j),g(()=>f(ke,e(Q).productType||"Autre")),o(h,j)},N=h=>{var j=yi(),M=a(j);{var J=u=>{var c=hi(),w=a(c,!0);t(c),g(()=>f(w,e(Q).storeInfo.storeName)),o(u,c)};d(M,u=>{e(Q).storeInfo?.storeName&&u(J)})}var pe=s(M,2);{var ke=u=>{var c=xi(),w=a(c,!0);t(c),g(O=>f(w,O),[()=>e(Q).who.join(", ")]),o(u,c)};d(pe,u=>{e(Q).who?.length&&u(ke)})}t(j),o(h,j)};d(te,h=>{v.groupBy==="store"?h(D):h(N,!1)})}t(ge);var ye=s(ge),S=a(ye);{var m=h=>{var j=Si(),M=a(j),J=a(M),pe=s(J);{var ke=w=>{var O=wi(),fe=a(O);t(O),g(Se=>f(fe,`(${Se??""})`),[()=>ra(e(Q).stockParsed.dateTime)]),o(w,O)};d(pe,w=>{e(Q).stockParsed?.dateTime&&w(ke)})}t(M);var u=s(M,2);{var c=w=>{var O=ze(),fe=he(O);Je(fe,17,()=>e(Q).purchases,_t,(Se,we)=>{var Me=ki(),Pe=a(Me);t(Me),g(()=>f(Pe,`${e(we).quantity??""} ${e(we).unit??""}`)),o(Se,Me)}),o(w,O)};d(u,w=>{e(Q).purchases?.length&&w(c)})}t(j),g(()=>f(J,`📦 ${e(Q).stockParsed.quantity??""} `)),o(h,j)},_=h=>{var j=ze(),M=he(j);{var J=pe=>{var ke=Mi();Je(ke,21,()=>e(Q).purchases,_t,(u,c)=>{var w=Pi(),O=a(w);t(w),g(()=>f(O,`${e(c).quantity??""} ${e(c).unit??""}`)),o(u,w)}),t(ke),o(pe,ke)};d(M,pe=>{e(Q).purchases?.length&&pe(J)},!0)}o(h,j)};d(S,h=>{e(Q).stockParsed?h(m):h(_,!1)})}t(ye),t(Z),g(()=>f(re,`${e(Q).productName??""} `)),o(me,Z)}),t(be),t(ue),t(V),o(G,V)}),t(C),t(A);var F=s(A,2);{var U=G=>{var ae=Ti(),y=a(ae),k=s(a(y),2);{var b=Y=>{var H=Di();o(Y,H)},V=Y=>{var H=Ai();o(Y,H)};d(k,Y=>{n.currentEvent&&n.currentEvent.meals&&n.currentEvent.meals.length>0&&n.currentEvent.meals.every(H=>!H.recipes||H.recipes.length===0)?Y(b):Y(V,!1)})}t(y),t(ae),o(G,ae)};d(F,G=>{Object.values(e(l)).flat().length===0&&G(U)})}g(()=>Ce(A,1,`space-y-4 rounded-lg print:hidden ${r()?"pointer-events-none opacity-60":""}`)),o(oe,ne),Ve()}tt(["click"]);var $i=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Oi=i('<div class="space-y-6"><!> <div class="space-y-4"><div class="flex flex-wrap items-center gap-x-5 gap-y-2"><!></div> <div><!></div></div> <div><h4 class="mb-1 font-medium">Produits concernés</h4> <div role="tablist" class="tabs mb-1 flex justify-end"><button>Produits sans magasin attribué</button> <button>Tous les produits du groupe</button></div> <!></div></div>'),ji=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),zi=i("<!> ",1),Ni=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Fi=i("<!> <!> <!>",1);function Bi(oe,n){Re(n,!0);let r=qe(!1),l=qe(null),v=qe(null),q=qe(Ze(n.products.length>0&&n.products[0].storeInfo?n.products[0].storeInfo.storeName:"")),p=qe(Ze(n.products.length>0&&n.products[0].storeInfo&&n.products[0].storeInfo.storeComment||"")),K=qe(Ze({})),R=qe("empty");bt(()=>{const U={};n.products.forEach(G=>{n.productIds.includes(G.$id)&&(e(R)==="empty"?U[G.$id]=!G.storeInfo||!G.storeInfo.storeName:U[G.$id]=!0)}),z(K,U,!0)});const B=L(()=>n.products.map(U=>({id:U.$id,label:U.productName,title:U.productName,selected:e(K)[U.$id]}))),E=L(()=>e(B).filter(U=>U.selected)),ne=L(()=>`Attribuer un magasin (${e(E).length} produits sélectionnés)`),A=L(()=>e(E).length===0?!1:e(q).trim().length>0);async function x(){if(!e(A)||e(r))return;z(l,null),z(v,null);const U=e(E).map(y=>y.id),G=n.products.filter(y=>U.includes(y.$id));T.setSyncStatus(U,!0),Ke.backgroundOperation={isRunning:!0,name:`Mise à jour magasin (${U.length} produits)`,progress:0},n.onClose();const ae={storeName:e(q).trim(),storeComment:e(p).trim()};try{const y=await zt.track(T.batchUpdateProducts(U,G,"store",ae).then(k=>{if(console.log(`[StoreEditModal] Mise à jour groupée: ${k.success?"succès":"échec"}, ${k.updatedCount} produits modifiés`),!k.success)throw new Error(k.error||"Erreur lors de la mise à jour");return k}),{loading:`Mise à jour du magasin pour ${U.length} produits...`,success:"Magasin mis à jour avec succès",error:"Erreur lors de la mise à jour du magasin"});n.onSuccess?.(y)}catch(y){console.error("[StoreEditModal] Erreur mise à jour:",y),T.clearSyncStatus()}finally{z(r,!1),Ke.backgroundOperation={isRunning:!1,name:"",progress:0}}}function C(){e(r)||n.onClose()}function F(U){e(K)[U]=!e(K)[U]}Dt(oe,{isOpen:!0,onClose:C,children:(U,G)=>{var ae=Fi(),y=he(ae);Pt(y,{get title(){return e(ne)},onClose:C,children:(V,Y)=>{ct(V,{class:"text-secondary"})},$$slots:{default:!0}});var k=s(y,2);At(k,{children:(V,Y)=>{var H=Oi(),ue=a(H);{var W=$=>{var re=$i(),xe=a(re);pa(xe,{class:"h-4 w-4"});var ee=s(xe,2),ie=a(ee,!0);t(ee),t(re),g(()=>f(ie,e(l))),o($,re)};d(ue,$=>{e(l)&&$(W)})}var ce=s(ue,2),le=a(ce),X=a(le);Tt(X,{get suggestions(){return T.uniqueStores},get disabled(){return e(r)},id:"store-name-input",get value(){return e(q)},set value($){z(q,$,!0)}}),t(le);var de=s(le,2),be=a(de);It(be,{get disabled(){return e(r)},id:"store-comment-textarea",get value(){return e(p)},set value($){z(p,$,!0)}}),t(de),t(ce);var me=s(ce,2),ve=s(a(me),2),Q=a(ve);Q.__click=()=>z(R,"empty");var se=s(Q,2);se.__click=()=>z(R,"all"),t(ve);var Z=s(ve,2);Ft(Z,{get items(){return e(B)},onToggleItem:F,size:"sm",color:"success"}),t(me),t(H),g(()=>{Ce(Q,1,`tab ${e(R)==="empty"?"tab-active":""}`),Ce(se,1,`tab ${e(R)==="all"?"tab-active":""}`)}),o(V,H)}});var b=s(k,2);ga(b,{children:(V,Y)=>{var H=Ni(),ue=he(H);ue.__click=C;var W=s(ue,2);W.__click=x;var ce=a(W);{var le=de=>{var be=ji();Ae(),o(de,be)},X=de=>{var be=zi(),me=he(be);ba(me,{class:"h-4 w-4"});var ve=s(me);g(()=>f(ve,` Appliquer à ${e(E).length??""} produit(s)`)),o(de,be)};d(ce,de=>{e(r)?de(le):de(X,!1)})}t(W),g(()=>{ue.disabled=e(r),W.disabled=e(r)||!e(A)}),o(V,H)}}),o(U,ae)},$$slots:{default:!0}}),Ve()}tt(["click"]);var Li=i('<div class="alert alert-error max-md:alert-vertical"><!> <span> </span></div>'),Ri=i(`<div class="space-y-10"><!> <div class="space-y-4"><h4 class="font-medium">Volontaires à assigner pour l'approvisionnement de ce produit</h4> <div class="flex gap-2"><div><!></div> <button class="btn btn-square btn-primary"><!></button></div> <div><h5>Sélection rapide</h5> <!></div></div> <div><div class=" my-4 flex flex-wrap items-start justify-between gap-4"><div class="font-medium">Produits concernés</div> <div class="flex flex-wrap gap-2"><button name="selectionMode"><span class="hidden sm:inline">Produits sans volontaire</span> <span class="sm:hidden">Sans volontaire</span></button> <button name="selectionMode">Tous les produits</button></div></div> <!></div></div>`),Vi=i('<span class="loading loading-spinner loading-sm"></span> En cours...',1),Qi=i("<!> ",1),Ui=i('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Gi=i("<!> <!> <!>",1);function Wi(oe,n){Re(n,!0);let r=qe(!1),l=qe(null),v=qe(Ze([])),q=qe(""),p=qe("empty"),K=qe(Ze({}));bt(()=>{const y={};n.products.forEach(k=>{n.productIds.includes(k.$id)&&(e(p)==="empty"?y[k.$id]=!k.who||k.who.length===0:y[k.$id]=!0)}),z(K,y,!0)});const R=L(()=>n.products.map(y=>({id:y.$id,label:y.productName,title:y.productName,selected:e(K)[y.$id]}))),B=L(()=>e(R).filter(y=>y.selected)),E=L(()=>{const y=new Set([...T.uniqueWho,...e(v)]);return Array.from(y).map(k=>({id:k,label:k,selected:e(v).includes(k)}))}),ne=L(()=>`Gérer les volontaires (${e(B).length} produit${e(B).length>1?"s":""})`),A=L(()=>e(B).length===0?!1:e(v).length>0);async function x(){if(!e(A)||e(r))return;z(l,null);const y=e(B).map(b=>b.id),k=n.products.filter(b=>y.includes(b.$id));T.setSyncStatus(y,!0),Ke.backgroundOperation={isRunning:!0,name:`Mise à jour volontaires (${y.length} produits)`,progress:0},n.onClose();try{await zt.track(T.batchUpdateProducts(y,k,"who",{names:e(v)}).then(b=>{if(console.log(`[WhoEditModal] Mise à jour groupée: ${b.success?"succès":"échec"}, ${b.updatedCount} produits modifiés`),!b.success)throw new Error(b.error||"Erreur lors de la mise à jour");return T.clearSyncStatus(),console.log("[WhoEditModal] ✅ Sync status cleared on success"),n.onSuccess?.(b),b}),{loading:`Mise à jour des mandatés pour ${y.length} produits...`,success:"Mise à jour effectué",error:"Erreur lors de la mise à jour des volontaires"})}catch(b){console.error("[WhoEditModal] Erreur mise à jour:",b),T.clearSyncStatus()}finally{z(r,!1),Ke.backgroundOperation={isRunning:!1,name:"",progress:0}}}function C(y){const k=y.trim();k&&!e(v).includes(k)&&z(v,[...e(v),k],!0)}function F(y){z(v,e(v).filter(k=>k!==y),!0)}function U(y){e(v).includes(y)?F(y):C(y)}function G(){e(q).trim()&&(C(e(q)),z(q,""))}function ae(y){e(K)[y]=!e(K)[y]}Dt(oe,{isOpen:!0,get onClose(){return n.onClose},hasUnsavedChanges:!1,fullscreenOnMobile:!0,maxWidth:"lg",children:(y,k)=>{var b=Gi(),V=he(b);Pt(V,{get title(){return e(ne)},showBackButton:!0,get onClose(){return n.onClose}});var Y=s(V,2);At(Y,{children:(ue,W)=>{var ce=Ri(),le=a(ce);{var X=ge=>{var te=Li(),D=a(te);pa(D,{class:"h-4 w-4"});var N=s(D,2),ye=a(N,!0);t(N),t(te),g(()=>f(ye,e(l))),o(ge,te)};d(le,ge=>{e(l)&&ge(X)})}var de=s(le,2),be=s(a(de),2),me=a(be),ve=a(me);oa(ve,{get disabled(){return e(r)},onkeydown:ge=>{ge.key==="Enter"&&(ge.preventDefault(),G())},get value(){return e(q)},set value(ge){z(q,ge,!0)}}),t(me);var Q=s(me,2);Q.__click=G;var se=a(Q);ts(se,{size:16}),t(Q),t(be);var Z=s(be,2),$=a(Z),re=s($,2);Ft(re,{get items(){return e(E)},onToggleItem:U,size:"lg",color:"info"}),t(Z),t(de);var xe=s(de,2),ee=a(xe),ie=s(a(ee),2),P=a(ie);P.__click=()=>z(p,"empty");var I=s(P,2);I.__click=()=>z(p,"all"),t(ie),t(ee);var _e=s(ee,2);Ft(_e,{get items(){return e(R)},onToggleItem:ae,size:"sm",color:"success"}),t(xe),t(ce),g(ge=>{Q.disabled=ge,Ce($,1,`text-base-content/70 mb-2 hidden text-sm ${(e(E).length&&"inline")??""}`),Ce(P,1,`btn btn-sm ${e(p)==="empty"&&"btn-secondary"}`),Ce(I,1,`btn btn-sm ${e(p)==="all"&&"btn-secondary"}`)},[()=>e(r)||!e(q).trim()]),o(ue,ce)}});var H=s(Y,2);ga(H,{children:(ue,W)=>{var ce=Ui(),le=he(ce);le.__click=function(...ve){n.onClose?.apply(this,ve)};var X=s(le,2);X.__click=x;var de=a(X);{var be=ve=>{var Q=Vi();Ae(),o(ve,Q)},me=ve=>{var Q=Qi(),se=he(Q);ba(se,{class:"h-4 w-4"});var Z=s(se);g(()=>f(Z,` Appliquer à ${e(B).length??""} produit${e(B).length>1?"s":""}`)),o(ve,Q)};d(de,ve=>{e(r)?ve(be):ve(me,!1)})}t(X),g(()=>{le.disabled=e(r),X.disabled=e(r)||!e(A)}),o(ue,ce)}}),o(y,b)},$$slots:{default:!0}}),Ve()}tt(["click"]);var Hi=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Ji=i('<div class="flex justify-between"><span> </span> <span class="font-mono"> </span></div>'),Ki=i('<button class="btn btn-primary btn-sm"><!> Ajouter une dépense</button>'),Xi=i('<span class="loading loading-spinner loading-xs"></span>'),Yi=i('<div class="text-error mt-2 text-xs"> </div>'),Zi=i('<div class="card bg-base-200 animate-in fade-in slide-in-from-top-4 shadow-md duration-300"><div class="card-body p-4"><h4 class="card-title text-sm"> </h4> <div class="grid grid-cols-1 gap-4 md:grid-cols-2"><!> <!> <!> <!></div> <div class="card-actions mt-2 justify-end"><button class="btn btn-sm btn-ghost">Annuler</button> <button class="btn btn-sm btn-primary"><!> </button></div> <!></div></div>'),el=i('<span class="text-base-content/70 italic"> </span>'),tl=i('<span class="text-base-content/50 ml-1 text-xs"> </span>'),al=i('<span class="font-medium"> </span> <!>',1),sl=i('<tr class="hover"><td class="whitespace-nowrap"> </td><td class="max-w-xs truncate"><!></td><td> </td><td> </td><td class="text-right font-mono font-bold"> </td><td><button class="btn btn-ghost btn-square"><!></button></td></tr>'),rl=i('<tr><td colspan="7" class="text-base-content/50 py-8 text-center">Aucune dépense trouvée</td></tr>'),nl=i('<div class="bg-base-100 border-base-200 rounded-lg border"><table class="table-zebra table-xs table w-full"><thead class="bg-base-200 sticky top-0"><tr><th class="hover:bg-base-300 cursor-pointer"> </th><th>Description</th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer"> </th><th class="hover:bg-base-300 cursor-pointer text-right"> </th><th><!></th></tr></thead><tbody><!><!></tbody></table></div>'),ol=i('<div class="text-sm italic opacity-70"> </div>'),il=i('<div class="text-xs opacity-60"> </div>'),ll=i('<div class="text-sm font-medium"> </div> <!>',1),dl=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[150px] truncate"> </span></div>'),vl=i('<div class="badge badge-soft gap-1"><!> <span class="max-w-[100px] truncate"> </span></div>'),cl=i('<div class="card bg-base-100 shadow-sm"><div class="card-body p-4"><div class="flex items-start justify-between gap-3"><div class="flex items-center gap-4 text-base"><div class="flex items-center gap-2"><!> <span> </span></div> <div class="font-mono font-bold"> </div></div> <button class="btn btn-ghost btn-square btn-sm"><!></button></div> <div><!></div> <div class="mt-3 flex flex-wrap gap-3"><!> <!></div></div></div>'),ul=i('<div class="py-12 text-center opacity-50"><!> <p>Aucune dépense trouvée</p></div>'),ml=i('<div class="space-y-3"><!> <!></div>'),pl=i('<div class="space-y-6"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="stats bg-primary text-primary-content shadow"><div class="stat"><div class="stat-title text-primary-content/80">Total Global</div> <div class="stat-value text-xl"> </div> <div class="stat-desc text-primary-content/80"> </div></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Magasin</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div> <div class="card bg-base-200 w-max-3xl h-full p-4 shadow-sm"><h4 class="mb-2 text-sm font-semibold tracking-wider uppercase opacity-70">Par Acheteur</h4> <div class="w-max-3xl h-full space-y-1 text-sm"></div></div></div> <div class="flex items-center justify-between"><h4 class="text-sm font-bold uppercase opacity-70">Liste des transactions</h4> <!></div> <!> <!></div>'),fl=i("<!> <!>",1);function _l(oe,n){Re(n,!0);let r=De(n,"isOpen",15,!1),l=qe(!1),v=qe(null),q=qe(!1),p=qe(Ze({invoiceTotal:0,store:"",notes:"",who:""})),K=qe(null);bt(()=>{if(r()&&!e(K)){const k=localStorage.getItem("appwrite-user-name");k&&(e(p).who=k)}});let R=qe("date"),B=qe("desc"),E=L(()=>T.financialStats),ne=L(()=>e(E).allPurchases),A=L(()=>{let k=[...e(ne)];return k.sort((b,V)=>{let Y,H;switch(e(R)){case"date":Y=new Date(b.orderDate||b.$createdAt).getTime(),H=new Date(V.orderDate||V.$createdAt).getTime();break;case"amount":Y=b.invoiceTotal||b.price||0,H=V.invoiceTotal||V.price||0;break;case"store":Y=(b.store||"").toLowerCase(),H=(V.store||"").toLowerCase();break;case"who":Y=(b.who||"").toLowerCase(),H=(V.who||"").toLowerCase();break}return Y<H?e(B)==="asc"?-1:1:Y>H?e(B)==="asc"?1:-1:0}),k});function x(k){e(R)===k?z(B,e(B)==="asc"?"desc":"asc",!0):(z(R,k,!0),z(B,"desc"))}async function C(){if(!e(p).invoiceTotal||e(p).invoiceTotal<=0){z(v,"Le montant doit être supérieur à 0");return}z(l,!0),z(v,null);try{const k=T.currentMainId;if(!k)throw new Error("Aucun événement principal actif");e(K)?await ys(e(K),{price:e(p).invoiceTotal,invoiceTotal:e(p).invoiceTotal,store:e(p).store,notes:e(p).notes,who:e(p).who}):await ws(k,void 0,e(p).invoiceTotal,e(p).store,e(p).notes,e(p).who),F()}catch(k){console.error("Erreur sauvegarde dépense:",k),z(v,k.message,!0)}finally{z(l,!1)}}function F(){const k=localStorage.getItem("appwrite-user-name")||"";z(p,{invoiceTotal:0,store:"",notes:"",who:k},!0),z(K,null),z(q,!1)}function U(k){z(p,{invoiceTotal:k.invoiceTotal||k.price||0,store:k.store||"",notes:k.notes||"",who:k.who||""},!0),z(K,k.$id,!0),z(q,!0)}function G(){r(!1),F(),z(v,null)}function ae(k){return k?new Date(k).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function y(k){return(k||0).toFixed(2)+" €"}Dt(oe,{get isOpen(){return r()},onClose:G,maxWidth:"lg",children:(k,b)=>{var V=fl(),Y=he(V);Pt(Y,{title:"Gestion des Dépenses",onClose:G});var H=s(Y,2);At(H,{children:(ue,W)=>{var ce=pl(),le=a(ce),X=a(le),de=a(X),be=s(a(de),2),me=a(be,!0);t(be);var ve=s(be,2),Q=a(ve);t(ve),t(de),t(X);var se=s(X,2),Z=s(a(se),2);Je(Z,21,()=>Object.entries(e(E).byStore).sort((D,N)=>N[1]-D[1]),_t,(D,N)=>{var ye=L(()=>ma(e(N),2));let S=()=>e(ye)[0],m=()=>e(ye)[1];var _=Hi(),h=a(_),j=a(h,!0);t(h);var M=s(h,2),J=a(M,!0);t(M),t(_),g(pe=>{f(j,S()),f(J,pe)},[()=>y(m())]),o(D,_)}),t(Z),t(se);var $=s(se,2),re=s(a($),2);Je(re,21,()=>Object.entries(e(E).byWho).sort((D,N)=>N[1]-D[1]),_t,(D,N)=>{var ye=L(()=>ma(e(N),2));let S=()=>e(ye)[0],m=()=>e(ye)[1];var _=Ji(),h=a(_),j=a(h,!0);t(h);var M=s(h,2),J=a(M,!0);t(M),t(_),g(pe=>{f(j,S()),f(J,pe)},[()=>y(m())]),o(D,_)}),t(re),t($),t(le);var xe=s(le,2),ee=s(a(xe),2);{var ie=D=>{var N=Ki();N.__click=()=>z(q,!0);var ye=a(N);jt(ye,{class:"mr-1 h-4 w-4"}),Ae(),t(N),o(D,N)};d(ee,D=>{e(q)||D(ie)})}t(xe);var P=s(xe,2);{var I=D=>{var N=Zi(),ye=a(N),S=a(ye),m=a(S,!0);t(S);var _=s(S,2),h=a(_);za(h,{get disabled(){return e(l)},get value(){return e(p).invoiceTotal},set value(we){e(p).invoiceTotal=we}});var j=s(h,2);Tt(j,{get suggestions(){return T.uniqueStores},get disabled(){return e(l)},get value(){return e(p).store},set value(we){e(p).store=we}});var M=s(j,2);oa(M,{get suggestions(){return T.uniqueWho},get disabled(){return e(l)},get value(){return e(p).who},set value(we){e(p).who=we}});var J=s(M,2);It(J,{get disabled(){return e(l)},get value(){return e(p).notes},set value(we){e(p).notes=we}}),t(_);var pe=s(_,2),ke=a(pe);ke.__click=F;var u=s(ke,2);u.__click=C;var c=a(u);{var w=we=>{var Me=Xi();o(we,Me)};d(c,we=>{e(l)&&we(w)})}var O=s(c);t(u),t(pe);var fe=s(pe,2);{var Se=we=>{var Me=Yi(),Pe=a(Me,!0);t(Me),g(()=>f(Pe,e(v))),o(we,Me)};d(fe,we=>{e(v)&&we(Se)})}t(ye),t(N),g(()=>{f(m,e(K)?"Modifier la dépense":"Nouvelle Dépense"),u.disabled=e(l),f(O,` ${e(K)?"Enregistrer":"Ajouter"}`)}),o(D,N)};d(P,D=>{e(q)&&D(I)})}var _e=s(P,2);{var ge=D=>{var N=nl(),ye=a(N),S=a(ye),m=a(S),_=a(m);_.__click=()=>x("date");var h=a(_);t(_);var j=s(_,2);j.__click=()=>x("store");var M=a(j);t(j);var J=s(j);J.__click=()=>x("who");var pe=a(J);t(J);var ke=s(J);ke.__click=()=>x("amount");var u=a(ke);t(ke);var c=s(ke),w=a(c);Rs(w,{size:14}),t(c),t(m),t(S);var O=s(S),fe=a(O);Je(fe,17,()=>e(A),Me=>Me.$id,(Me,Pe)=>{var Be=sl(),Ye=a(Be),at=a(Ye,!0);t(Ye);var Fe=s(Ye),Qe=a(Fe);{var st=Le=>{var He=el(),nt=a(He,!0);t(He),g(()=>f(nt,e(Pe).notes||"-")),o(Le,He)},Xe=Le=>{var He=al(),nt=he(He),lt=a(nt,!0);t(nt);var dt=s(nt,2);{var ft=ut=>{var mt=tl(),wt=a(mt);t(mt),g(()=>f(wt,`- ${e(Pe).notes??""}`)),o(ut,mt)};d(dt,ut=>{e(Pe).notes&&ut(ft)})}g(()=>f(lt,e(Pe)._productName||"Produit inconnu")),o(Le,He)};d(Qe,Le=>{e(Pe).status==="expense"?Le(st):Le(Xe,!1)})}t(Fe);var $e=s(Fe),Oe=a($e,!0);t($e);var Ie=s($e),Ue=a(Ie,!0);t(Ie);var Ge=s(Ie),ot=a(Ge,!0);t(Ge);var We=s(Ge),it=a(We);it.__click=()=>U(e(Pe));var Ne=a(it);yt(Ne,{size:14}),t(it),t(We),t(Be),g((Le,He)=>{f(at,Le),f(Oe,e(Pe).store||"-"),f(Ue,e(Pe).who||"-"),f(ot,He)},[()=>ae(e(Pe).orderDate||e(Pe).$createdAt),()=>y(e(Pe).invoiceTotal||e(Pe).price)]),o(Me,Be)});var Se=s(fe);{var we=Me=>{var Pe=rl();o(Me,Pe)};d(Se,Me=>{e(A).length===0&&Me(we)})}t(O),t(ye),t(N),g(()=>{f(h,`Date ${e(R)==="date"?e(B)==="asc"?"↑":"↓":""}`),f(M,`Magasin ${e(R)==="store"?e(B)==="asc"?"↑":"↓":""}`),f(pe,`Qui ${e(R)==="who"?e(B)==="asc"?"↑":"↓":""}`),f(u,`Montant ${e(R)==="amount"?e(B)==="asc"?"↑":"↓":""}`)}),o(D,N)},te=D=>{var N=ml(),ye=a(N);Je(ye,17,()=>e(A),_=>_.$id,(_,h)=>{var j=cl(),M=a(j),J=a(M),pe=a(J),ke=a(pe),u=a(ke);Bt(u,{class:"h-3.5 w-3.5"});var c=s(u,2),w=a(c,!0);t(c),t(ke);var O=s(ke,2),fe=a(O,!0);t(O),t(pe);var Se=s(pe,2);Se.__click=()=>U(e(h));var we=a(Se);yt(we,{size:16}),t(Se),t(J);var Me=s(J,2),Pe=a(Me);{var Be=$e=>{var Oe=ol(),Ie=a(Oe,!0);t(Oe),g(()=>f(Ie,e(h).notes)),o($e,Oe)},Ye=$e=>{var Oe=ll(),Ie=he(Oe),Ue=a(Ie,!0);t(Ie);var Ge=s(Ie,2);{var ot=We=>{var it=il(),Ne=a(it,!0);t(it),g(()=>f(Ne,e(h).notes)),o(We,it)};d(Ge,We=>{e(h).notes&&We(ot)})}g(()=>f(Ue,e(h)._productName||"Produit inconnu")),o($e,Oe)};d(Pe,$e=>{e(h).status==="expense"&&e(h).notes?$e(Be):$e(Ye,!1)})}t(Me);var at=s(Me,2),Fe=a(at);{var Qe=$e=>{var Oe=dl(),Ie=a(Oe);ct(Ie,{class:"h-3 w-3"});var Ue=s(Ie,2),Ge=a(Ue,!0);t(Ue),t(Oe),g(()=>f(Ge,e(h).store)),o($e,Oe)};d(Fe,$e=>{e(h).store&&$e(Qe)})}var st=s(Fe,2);{var Xe=$e=>{var Oe=vl(),Ie=a(Oe);na(Ie,{class:"h-3 w-3"});var Ue=s(Ie,2),Ge=a(Ue,!0);t(Ue),t(Oe),g(()=>f(Ge,e(h).who)),o($e,Oe)};d(st,$e=>{e(h).who&&$e(Xe)})}t(at),t(M),t(j),g(($e,Oe)=>{f(w,$e),f(fe,Oe)},[()=>ra(e(h).orderDate||e(h).$createdAt),()=>y(e(h).invoiceTotal||e(h).price)]),o(_,j)});var S=s(ye,2);{var m=_=>{var h=ul(),j=a(h);os(j,{class:"mx-auto mb-3 h-12 w-12"}),Ae(2),t(h),o(_,h)};d(S,_=>{e(A).length===0&&_(m)})}t(N),o(D,N)};d(_e,D=>{Ke.isMobile?D(te,!1):D(ge)})}t(ce),g(D=>{f(me,D),f(Q,`${e(ne).length??""} transactions`)},[()=>y(e(E).totalGlobal)]),o(ue,ce)}}),o(k,V)},$$slots:{default:!0}}),Ve()}tt(["click"]);var bl=i('<div class="fixed right-24 bottom-6 z-50 print:hidden"><div class="alert alert-soft bg-secondary/90 text-secondary-content flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg backdrop-blur-sm"><span class="max-w-32 truncate text-xs font-medium"> </span> <button class="btn btn-xs btn-circle btn-ghost" title="Effacer tous les filtres"><!></button></div></div>');function gl(oe,n){Re(n,!0);const r=L(()=>T.activeFiltersDescription),l=L(()=>e(r).length>0),v=L(()=>e(r).length>2?`${e(r).slice(0,2).join(", ")}...`:e(r).join(", "));var q=ze(),p=he(q);{var K=R=>{var B=bl(),E=a(B),ne=a(E),A=a(ne,!0);t(ne);var x=s(ne,2);x.__click=()=>T.clearFilters();var C=a(x);Et(C,{class:"size-4"}),t(x),t(E),t(B),g(()=>f(A,e(v))),St(3,B,()=>Vs,()=>({duration:200,start:.8})),o(R,B)};d(p,R=>{e(l)&&R(K)})}o(oe,q),Ve()}tt(["click"]);var hl=i('<div class="flex gap-2"><button class="btn btn-primary btn-sm" title="Ajouter un produit manuellement"><!> Produit</button></div>'),xl=i('<div class="card card-compact bg-base-200"><div class="card-body"><div class="skeleton mb-2 h-5 w-32"></div> <div class="skeleton h-4 w-full"></div> <div class="skeleton mt-1 h-4 w-3/4"></div></div></div>'),yl=i('<div class="border-base-300 bg-base-100 rounded-box border-2 p-4"><div class="mb-3 flex items-center justify-between"><div class="skeleton h-6 w-48"></div> <div class="flex gap-2"><div class="skeleton h-8 w-8 rounded-full"></div> <div class="skeleton h-8 w-8 rounded-full"></div></div></div> <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"></div></div>'),wl=i('<div class="space-y-6"><div class="rounded-box border-base-300 bg-base-100 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><div class="skeleton h-8 w-48 shrink-0"></div> <div class="skeleton h-6 w-40 shrink-0"></div></div> <div class="skeleton mt-4 h-20 w-full"></div></div> <div class="flex w-full flex-wrap justify-center gap-10 md:justify-end"><div class="card card-xs sm:card-sm border-base-300 w-40 border-2"><div class="card-body"><div class="card-title"><div class="skeleton h-6 w-6 rounded"></div> <span class="skeleton inline-block h-6 w-24"></span></div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="skeleton mx-auto h-8 w-12"></div> <div class="skeleton mx-auto mt-1 h-4 w-16"></div></div></div></div></div> <div class="card card-xs sm:card-sm border-base-300 w-40 border-2"><div class="card-body"><div class="card-title"><div class="skeleton h-6 w-6 rounded"></div> <span class="skeleton inline-block h-6 w-24"></span></div> <div class="skeleton mx-auto mt-2 h-8 w-16"></div></div></div></div> <div class="border-base-300 bg-base-100 rounded-box border-2 p-4"><div class="skeleton mb-2 h-6 w-32"></div> <div class="space-y-2"><div class="skeleton h-4 w-full"></div> <div class="skeleton h-4 w-5/6"></div> <div class="skeleton h-4 w-4/6"></div></div></div> <div class="space-y-4"></div></div>'),kl=i("<!> ",1),Sl=i("<!> ",1),Pl=i('<div class="grow py-4 print:hidden"><!></div>'),Ml=i(`<div class="alert alert-warning alert-soft max-sm:alert-vertical self-center" id="info-past-event"><!> Toutes les dates de cet événement sont passées. Il n'est plus possible
            de modifier les produits.</div>`),ql=i('<div class="card card-xs sm:card-sm border-2 border-orange-700"><div class="card-body"><div class="card-title text-orange-800"><!> Produits</div> <div class="flex items-center justify-center px-2"><div class="text-center"><div class="text-error text-lg font-bold md:text-2xl"> </div> <div class="text-base-content/60 text-xs">Manquants</div></div></div> <div class="card-action mt-auto"><button class="btn btn-primary btn-soft w-full" title="Ajouter un produit manuellement"><!> Produit</button></div></div></div>'),Cl=i("grace au bouton en bas à gauche <!>",1),Dl=i(`<p>Cette page liste l'ensemble des produits présent dans les recettes de
        l'événement. La liste est <span class="font-semibold">mise à jour dès que les menus sont modifiés</span> (recettes ajoutées, supprimées, nombre de couvert modifié, etc.) Vous pouvez
        :</p> <ul class="svelte-1mshqfh"><li class="svelte-1mshqfh">Ajouter des produits non présent dans les recettes grace au bouton <kbd class="kbd kbd-sm">+ Produit</kbd> en haut à gauche</li> <li class="svelte-1mshqfh">Filtrer les produits par type, température, date, manquant etc. <!></li> <li class="svelte-1mshqfh">Déclarer des achats soit en cliquant dans la zone d'achat d'un
          produit, soit via le bouton <kbd class="kbd kbd-sm">manque ...</kbd> dans
          la colonne des besoins (déclare acheté la quantité manquante). Les achats
          peuvent être déclarés comme des 'commandes', et vous pouvez préciser la
          date de réception</li> <li class="svelte-1mshqfh">Déclarer tout un groupe de produit acheté via le bouton <kbd class="kbd kbd-sm">Achat groupé</kbd> dans l'entête de chaque groupe</li> <li class="svelte-1mshqfh">Définir des magasins ou vous mandater pour l'achat de produit
          (individuel ou par groupe) → <!> <!></li> <li class="svelte-1mshqfh">Modifier la quantité réclamée pour un produit. Si les recettes et
          menus sont modifié entre temps, la carte des besoin du produit
          indiquera que les quantités calculé ont changé depuis la modification
          manuelle des besoins déclarés pour ce produit. <p>Cela peut aussi servir a <span class="font-semibold">remplacer un produit par un autre</span> sans modifier les recettes</p></li> <li class="svelte-1mshqfh">Déclarer des dépenses indépendamment des achats (possible y compris
          après que l'événement soit fini)</li> <li class="svelte-1mshqfh">Visualiser l'ensemble des dépenses effectué, et par qui, en cliquant
          sur <kbd class="kbd">Dépenses</kbd> dans l'entête</li></ul> <p>Tous les membres des équipes ou individus invité à participer à
        l'événement peuvent modifier les produits, ajouter des achats, dépenses,
        etc.</p>`,1),Al=i('<!> <div class="rounded-box border-base-300 bg-base-100 flex flex-wrap items-baseline justify-between gap-4 border-2 p-4"><div class="flex w-full flex-wrap justify-between gap-6"><div class="flex flex-wrap gap-4"><h1> </h1> <!></div> <div class="text-base-content/70 text-base"><!></div></div> <!> <div class="flex w-full flex-wrap justify-center gap-10 md:justify-end"><!> <!> <div class="card card-xs sm:card-sm border-2 border-orange-700 shadow"><div class="card-body"><div class="card-title text-orange-800"><!> Dépenses</div> <div class="text-base-content/70 text-center text-lg font-medium"> </div> <div class="card-action mt-auto"><button class="btn btn-soft btn-primary" title="Ajouter une dépense générale"><!> Voir, ajouter</button></div></div></div></div></div> <!> <!>',1),Tl=i('<div class="flex items-center justify-center"><!> <button class="btn btn-xs btn-circle btn-ghost ms-3"><!></button></div>'),Il=i('<div class="flex items-center justify-center" role="button" tabindex="0" aria-label="Aide"><!></div>'),El=i('<div class="fixed bottom-0 left-0 z-50 transition-all"><div><!></div></div>'),$l=i("<!> <!> <div><!> <!> <!> <!> <!> <!> <!> <!></div>",1);function Kl(oe,n){Re(n,!0);const r=m=>{var _=hl(),h=a(_);h.__click=le;var j=a(h);jt(j,{class:"mr-1 h-4 w-4"}),Ae(),t(h),t(_),g(()=>h.disabled=!e(be)),o(m,_)},l="100";let v=qe(null),q=qe("recettes"),p=qe(!1),K=qe(!1),R=qe(Ze([])),B=qe(Ze([])),E=qe(!1),ne=qe(Ze([])),A=qe(!1),x=qe(!0),C=L(()=>Ps.params.id);const F=L(()=>e(C)?la.getEventById(e(C)):null),U=L(()=>e(F)?.name??""),G=L(()=>e(F)?.dateStart??null),ae=L(()=>e(F)?.dateEnd??null),y=L(()=>e(ae)&&new Date>new Date(e(ae)));ks(async()=>{try{if(!e(C)){console.error("[EventProductsPage] eventId est requis"),z(x,!1);return}const m=la.getEventById(e(C));console.log(`[EventProductsPage] Initialisation de ProductsStore pour événement ${m?.name}`),await T.initialize(e(C))}catch(m){console.error("[EventProductsPage] Erreur lors de l'initialisation:",m)}finally{z(x,!1)}});function k(m,_="recettes"){z(q,_,!0),z(v,m,!0)}function b(){z(v,null)}function V(m,_,h){z(R,_,!0),z(B,h,!0),m==="who"?z(p,!0):z(K,!0)}function Y(m){(!m||m==="who")&&z(p,!1),(!m||m==="store")&&z(K,!1),z(R,[],!0),z(B,[],!0)}function H(m){console.log(`[ProductsTable] Modification groupée réussie: ${m.updatedCount} produits`)}function ue(m){const _=m.filter(h=>T.getProductModelById(h.$id)?.stats.hasMissing);console.log(`[ProductsTable] openGroupPurchaseModal: ${m.length} produits reçus → ${_.length} produits avec quantités manquantes`),z(ne,_,!0),z(E,!0)}function W(){z(E,!1),z(ne,[],!0)}function ce(){console.log("[ProductsTable] Achat groupé créé avec succès"),W()}function le(){z(A,!0)}async function X(m,_){try{const h=_.missingQuantities||[];if(h.length===0){console.log("Aucune quantité manquante à valider pour ce produit dans cette période");return}const j=h.filter(M=>M.q<0).map(M=>({...M,q:Math.abs(M.q)})).map(M=>{const J=Ot.normalize(M.q,M.u);return{q:J.quantity,u:J.unit}});await T.createPurchase(m.$id,j,{store:m.storeInfo?.storeName??null,notes:"",invoiceId:`VALID_${Date.now()}`}),console.log(`[ProductsTable] Validation rapide créée pour ${m.productName}`)}catch(h){console.error("[ProductsTable] Erreur validation rapide:",h),alert("Erreur lors de la validation rapide: "+h.message)}}let de=qe(!1);const be=L(()=>e(F)&&Ms(e(F).$id)||la.canUserEditEvent(e(C)||"",Ke.userId||"")&&e(F)?.status!=="canceled");async function me(m){if(!(!e(C)||!Ke.userId))try{z(x,!0);const _=m?"accepted":"declined";await la.updateContributorStatus(e(C),Ke.userId,_),zt.success(m?"Invitation acceptée":"Invitation déclinée")}catch(_){console.error("Erreur réponse invitation:",_),zt.error("Erreur lors de la réponse")}finally{z(x,!1)}}bt(()=>{Ua.setConfig({actions:r})}),Ss(()=>{Ua.reset()});var ve=$l(),Q=he(ve);Hs(Q,{width:l,children:(m,_)=>{go(m,{})},$$slots:{default:!0}});var se=s(Q,2);gl(se,{});var Z=s(se,2),$=a(Z);{var re=m=>{var _=wl(),h=s(a(_),6);Je(h,20,()=>Array(3),_t,(j,M)=>{var J=yl(),pe=s(a(J),2);Je(pe,20,()=>Array(3),_t,(ke,u)=>{var c=xl();o(ke,c)}),t(pe),t(J),o(j,J)}),t(h),t(_),o(m,_)},xe=m=>{var _=Al(),h=he(_);Ws(h,{get currentEvent(){return e(F)},get isBusy(){return e(x)},onRespond:me});var j=s(h,2),M=a(j),J=a(M),pe=a(J),ke=a(pe,!0);t(pe);var u=s(pe,2);{var c=Ne=>{Js(Ne,{get status(){return e(F).status}})};d(u,Ne=>{e(F)&&Ne(c)})}t(J);var w=s(J,2),O=a(w);{var fe=Ne=>{var Le=kl(),He=he(Le);Bt(He,{class:"inline h-4 w-4"});var nt=s(He);g((lt,dt)=>f(nt,` ${lt??""} au ${dt??""}`),[()=>wa(e(G)),()=>wa(e(ae))]),o(Ne,Le)},Se=Ne=>{var Le=ze(),He=he(Le);{var nt=lt=>{var dt=Sl(),ft=he(dt);Bt(ft,{class:"inline h-4 w-4"});var ut=s(ft);g(mt=>f(ut,` ${mt??""}`),[()=>wa(e(G))]),o(lt,dt)};d(He,lt=>{e(G)&&lt(nt)},!0)}o(Ne,Le)};d(O,Ne=>{e(G)&&e(ae)?Ne(fe):Ne(Se,!1)})}t(w),t(M);var we=s(M,2);{var Me=Ne=>{var Le=Pl(),He=a(Le);Gs(He,{get currentEvent(){return e(F)}}),t(Le),o(Ne,Le)};d(we,Ne=>{e(F)&&Ne(Me)})}var Pe=s(we,2),Be=a(Pe);{var Ye=Ne=>{var Le=Ml(),He=a(Le);Ta(He,{size:20,class:"shrink-0"}),Ae(),t(Le),o(Ne,Le)};d(Be,Ne=>{e(y)&&Ne(Ye)})}var at=s(Be,2);{var Fe=Ne=>{var Le=ql(),He=a(Le),nt=a(He),lt=a(nt);ss(lt,{class:"text-orange-800 opacity-60"}),Ae(),t(nt);var dt=s(nt,2),ft=a(dt),ut=a(ft),mt=a(ut,!0);t(ut),Ae(2),t(ft),t(dt);var wt=s(dt,2),gt=a(wt);gt.__click=le;var ht=a(gt);jt(ht,{class:"mr-1 h-4 w-4"}),Ae(),t(gt),t(wt),t(He),t(Le),g(()=>{f(mt,T.completionStats.missing),gt.disabled=!e(be)}),Ee("mouseenter",gt,()=>Te.msg="Ajouter un produit manuellement"),Ee("mouseleave",gt,()=>Te.reset()),o(Ne,Le)};d(at,Ne=>{e(y)||Ne(Fe)})}var Qe=s(at,2),st=a(Qe),Xe=a(st),$e=a(Xe);os($e,{class:"text-orange-800 opacity-60"}),Ae(),t(Xe);var Oe=s(Xe,2),Ie=a(Oe);t(Oe);var Ue=s(Oe,2),Ge=a(Ue);Ge.__click=()=>z(de,!0);var ot=a(Ge);jt(ot,{class:"size-4"}),Ae(),t(Ge),t(Ue),t(st),t(Qe),t(Pe),t(j);var We=s(j,2);qa(We,{title:"Aide",contentVisible:"Page de gestion des produits nécéssaire pour l'événement. Cliquer pour découvrir ce que vous pouvez y faire...",class:"shadow-info shadow",children:(Ne,Le)=>{var He=Dl(),nt=s(he(He),2),lt=s(a(nt),2),dt=s(a(lt));{var ft=ht=>{var ia=Cl(),ls=s(he(ia));as(ls,{size:14}),o(ht,ia)},ut=ht=>{var ia=et("grace au menu de droite");o(ht,ia)};d(dt,ht=>{Ke.isMobile?ht(ft):ht(ut,!1)})}t(lt);var mt=s(lt,6),wt=s(a(mt));ct(wt,{size:14,class:"text-primary inline"});var gt=s(wt,2);Lt(gt,{size:14,class:"text-primary inline"}),t(mt),Ae(6),t(nt),Ae(2),o(Ne,He)},$$slots:{default:!0}});var it=s(We,2);{let Ne=L(()=>!e(be));Ei(it,{get currentEvent(){return e(F)},onOpenModal:k,onOpenGroupEditModal:V,onOpenGroupPurchaseModal:ue,onQuickValidation:X,get disabled(){return e(Ne)}})}g(()=>{f(ke,e(U)),f(Ie,`${T.financialStats.totalGlobal??""} €`),Ge.disabled=!e(be)}),Ee("mouseenter",Ge,()=>Te.msg="Consulter ou modifie le détail des dépenses"),Ee("mouseleave",Ge,()=>Te.reset()),o(m,_)};d($,m=>{e(x)?m(re):m(xe,!1)})}var ee=s($,2);{let m=L(()=>e(v)||"");Xn(ee,{get productId(){return e(m)},get initialTab(){return e(q)},onClose:b})}var ie=s(ee,2);{var P=m=>{Wi(m,{get productIds(){return e(R)},get products(){return e(B)},onClose:()=>Y("who"),onSuccess:H})};d(ie,m=>{e(p)&&m(P)})}var I=s(ie,2);{var _e=m=>{Bi(m,{get productIds(){return e(R)},get products(){return e(B)},onClose:()=>Y("store"),onSuccess:H})};d(I,m=>{e(K)&&m(_e)})}var ge=s(I,2);{var te=m=>{cr(m,{get products(){return e(ne)},onClose:W,onSuccess:ce})};d(ge,m=>{e(E)&&m(te)})}var D=s(ge,2);yr(D,{get open(){return e(A)},set open(m){z(A,m,!0)}});var N=s(D,2);_l(N,{get isOpen(){return e(de)},set isOpen(m){z(de,m,!0)}});var ye=s(N,2);{var S=m=>{var _=El(),h=a(_),j=a(h);{var M=pe=>{var ke=Tl(),u=a(ke);Qa(u,{class:"me-2 size-5"});var c=s(u),w=s(c);w.__click=()=>Te.collapse();var O=a(w);fa(O,{class:"h-4 w-4"}),t(w),t(ke),g(()=>f(c,` ${Te.msg??""} `)),o(pe,ke)},J=pe=>{var ke=Il();ke.__click=()=>Te.expand(),ke.__keydown=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),Te.expand())};var u=a(ke);Qa(u,{class:"size-6"}),t(ke),o(pe,ke)};d(j,pe=>{Te.isExpanded?pe(M):pe(J,!1)})}t(h),t(_),g(()=>Ce(h,1,`rounded-tr-box bg-blue-100 text-blue-800 ${Te.isExpanded?" w-fit px-4 py-2":"  cursor-pointer px-3 py-2"}`)),o(m,_)};d(ye,m=>{Ke.isDesktop&&m(S)})}t(Z),g(()=>Ce(Z,1,`space-y-6 pt-6 md:px-16 ${(Ke.isDesktop&&"ml-110 print:ml-0")??""} `)),St(3,Z,()=>Oa),o(oe,ve),Ve()}tt(["click","keydown"]);export{Kl as default};
