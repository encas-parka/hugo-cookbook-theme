import{Q as W,x as q}from"./icons.js";import{p as w,v as f,k as p,h as c,b as g,B as E,g as x,w as M,x as K,I as O,o as L,K as k,H as R,c as H,d as Q,D as B,A as v,y as G,m as U}from"./appwrite.js";import{M as D,a as F,b as I,c as N}from"./index.js";var T=f('<div class="alert alert-warning alert-soft max-md:alert-vertical text-base"><!> <span> </span></div>'),j=f('<span class="loading loading-spinner loading-xs"></span> Enregistrement...',1),J=f("<!> Enregistrer et quitter",1),X=f('<button class="btn btn-ghost">Rester</button> <button class="btn btn-error">Quitter sans sauvegarder</button> <button class="btn btn-primary"><!></button>',1),Y=f("<!> <!> <!>",1);function Z(C,e){let o=w(e,"isSaving",3,!1),r=w(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?");D(C,{get isOpen(){return e.isOpen},get onClose(){return e.onCancel},children:(d,t)=>{var h=Y(),_=p(h);F(_,{title:"Modifications non sauvegardées",get onClose(){return e.onCancel}});var m=c(_,2);I(m,{children:(n,y)=>{var s=T(),l=x(s);W(l,{class:"h-5 w-5"});var i=c(l,2),u=x(i,!0);L(i),L(s),M(()=>K(u,r())),g(n,s)}});var S=c(m,2);N(S,{children:(n,y)=>{var s=X(),l=p(s);l.__click=function(...a){e.onCancel?.apply(this,a)};var i=c(l,2);i.__click=function(...a){e.onLeaveWithoutSave?.apply(this,a)};var u=c(i,2);u.__click=function(...a){e.onSaveAndLeave?.apply(this,a)};var A=x(u);{var P=a=>{var b=j();k(),g(a,b)},z=a=>{var b=J(),V=p(b);q(V,{class:"mr-1 h-4 w-4"}),k(),g(a,b)};O(A,a=>{o()?a(P):a(z,!1)})}L(u),M(()=>{l.disabled=o(),i.disabled=o(),u.disabled=o()}),g(n,s)}}),g(d,h)},$$slots:{default:!0}})}E(["click"]);function te(C,e){Q(e,!0);let o=w(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?"),r=G(!1),d=G(!1),t=null;async function h(n,y){return e.shouldProtect()?(console.log(`[UnsavedChangesGuard] Navigation protégée pour ${e.routeKey}`),v(r,!0),new Promise(s=>{t=s})):!0}async function _(){v(r,!1),await e.onLeaveWithoutSave(),t&&(t(!0),t=null)}async function m(){v(d,!0);try{if(await e.onSaveAndLeave()===!1){console.log("[UnsavedChangesGuard] Sauvegarde échouée, navigation annulée");return}v(r,!1),t&&(t(!0),t=null)}catch(n){console.error("[UnsavedChangesGuard] Erreur lors de la sauvegarde:",n)}finally{v(d,!1)}}function S(){v(r,!1),t&&(t(!1),t=null)}R(()=>{const n={beforeLeave:h};return B.registerRouteGuard(e.routeKey,n)}),Z(C,{get isOpen(){return U(r)},get isSaving(){return U(d)},get message(){return o()},onLeaveWithoutSave:_,onSaveAndLeave:m,onCancel:S}),H()}export{te as U};
