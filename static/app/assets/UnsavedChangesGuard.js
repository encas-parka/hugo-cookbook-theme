import{p as x,v as m,k as w,g as f,h as U,w as G,x as T,b as h,K as V,B as W,o as k,G as L,d as q,m as r,y as S,c as K,A as a,E as M,aK as O}from"./appwrite.js";import{M as Q,b as B,c as F,d as H}from"./index.js";import{T as R,a4 as j}from"./icons.js";var D=m('<div class="alert alert-warning alert-soft max-md:alert-vertical text-base"><!> <span> </span></div>'),I=m('<span class="loading loading-spinner loading-xs"></span> Enregistrement...',1),J=m("<!> Enregistrer et quitter",1),X=m('<button class="btn btn-ghost">Rester</button> <button class="btn btn-error">Quitter sans sauvegarder</button> <button class="btn btn-primary"><!></button>',1),Y=m("<!> <!> <!>",1);function Z(y,e){let i=x(e,"isSaving",3,!1),l=x(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?");Q(y,{get isOpen(){return e.isOpen},get onClose(){return e.onCancel},children:(c,n)=>{var o=Y(),_=w(o);B(_,{title:"Modifications non sauvegardées",get onClose(){return e.onCancel}});var b=f(_,2);F(b,{children:(s,A)=>{var u=D(),v=U(u);R(v,{class:"h-5 w-5"});var d=f(v,2),g=U(d,!0);k(d),k(u),G(()=>T(g,l())),h(s,u)}});var p=f(b,2);H(p,{children:(s,A)=>{var u=X(),v=w(u);v.__click=function(...t){e.onCancel?.apply(this,t)};var d=f(v,2);d.__click=function(...t){e.onLeaveWithoutSave?.apply(this,t)};var g=f(d,2);g.__click=function(...t){e.onSaveAndLeave?.apply(this,t)};var N=U(g);{var P=t=>{var C=I();L(),h(t,C)},z=t=>{var C=J(),E=w(C);j(E,{class:"mr-1 h-4 w-4"}),L(),h(t,C)};V(N,t=>{i()?t(P):t(z,!1)})}k(g),G(()=>{v.disabled=i(),d.disabled=i(),g.disabled=i()}),h(s,u)}}),h(c,o)},$$slots:{default:!0}})}W(["click"]);function te(y,e){q(e,!0);let i=x(e,"message",3,"Vous avez des modifications non sauvegardées. Voulez-vous quitter sans enregistrer ?"),l=S(!1),c=S(!1),n=S(null),o=S(!1);O(()=>{if(r(o)||!e.shouldProtect())return!0;const s=window.location.hash.slice(1)||"/";return a(n,s,!0),console.log(`[UnsavedChangesGuard] Navigation protégée pour ${e.routeKey} - vers: ${s}`),a(l,!0),!1});async function _(){a(l,!1),await e.onLeaveWithoutSave(),r(n)&&(console.log("[UnsavedChangesGuard] Quitter sans sauvegarder - Navigation vers:",r(n)),a(o,!0),M(r(n)),setTimeout(()=>{a(o,!1),a(n,null)},100))}async function b(){a(c,!0);try{if(await e.onSaveAndLeave()===!1){console.log("[UnsavedChangesGuard] Sauvegarde échouée, navigation annulée");return}a(l,!1),r(n)&&(console.log("[UnsavedChangesGuard] Sauvegarde réussie - Navigation vers:",r(n)),a(o,!0),M(r(n)),setTimeout(()=>{a(o,!1),a(n,null)},100))}catch(s){console.error("[UnsavedChangesGuard] Erreur lors de la sauvegarde:",s)}finally{a(c,!1)}}function p(){a(l,!1),a(n,null)}Z(y,{get isOpen(){return r(l)},get isSaving(){return r(c)},get message(){return i()},onLeaveWithoutSave:_,onSaveAndLeave:b,onCancel:p}),K()}export{te as U};
