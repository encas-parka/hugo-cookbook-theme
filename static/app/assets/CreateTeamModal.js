import{U as je,a1 as Qe,c as et,af as tt,ag as at,J as rt,ah as nt,M as ze,a2 as st,C as it,X as lt,aa as ot,P as dt}from"./icons.js";import{B as Re,d as Ae,y as p,z as Le,v as u,k as S,I as w,g as r,h as n,A as t,m as e,b as i,c as Pe,F as ce,u as le,e as Ge,a6 as vt,w as Y,C as Ce,G as qe,x as ne,j as be,K as _e,o as a,p as de,L as Ve,R as Me,U as De,aq as Je,al as ct,H as He,ax as ut,S as Fe,M as Xe,Q as mt}from"./appwrite.js";import{C as Ne}from"./ConfirmModal.js";import{M as We,a as Ue,b as Be,c as Ke}from"./index.js";import"./InfoCollapse.js";var ft=u('<div class="py-8 text-center opacity-50"><!> <p class="text-sm">Aucun membre</p></div>'),bt=u('<span class="text-xs opacity-50">(vous)</span>'),_t=u(`<button class="btn btn-error btn-sm" title="Quitter l'équipe"><!></button>`),gt=u('<button class="btn btn-error btn-sm" title="Retirer ce membre"><!></button>'),pt=u('<div class="card bg-base-100 border-base-200 border p-4 transition-shadow hover:shadow-md"><div class="flex items-center justify-between gap-4"><div class="flex flex-1 items-center gap-3"><div class="avatar avatar-placeholder"><div><span class="text-lg"> </span></div></div> <div class="flex-1"><div class="font-medium"> <!></div> <div class="text-sm opacity-70"> </div></div></div> <div><!> </div> <div class="flex gap-2"><!></div></div></div>'),ht=u(`<div class="alert"><!> Seul les admins peuvent modifier les parametre
      de l'équipe</div> <div class="space-y-2"></div>`,1),xt=u('<div class="space-y-4"><!></div> <!> <!>',1);function yt(ue,s){Ae(s,!0);let _=p(Le({isOpen:!1,memberId:null,memberName:null})),g=p(!1),q=p(!1);const R=le(()=>qe.userId),M=le(()=>()=>e(R)&&s.team.members.find(C=>C.id===e(R))?.roles?.[0]||null),x=le(()=>e(M)()==="owner");function z(d){return new Date(d).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}function o(d,C){t(_,{isOpen:!0,memberId:d,memberName:C},!0)}async function ae(){if(e(_).memberId){t(q,!0);try{await ce.removeMember(s.team.$id,e(_).memberId),t(_,{isOpen:!1,memberId:null,memberName:null},!0),s.onMemberRemoved?.()}catch(d){console.error("[TeamMembersList] Erreur suppression:",d),alert("Erreur lors de la suppression du membre")}finally{t(q,!1)}}}async function Q(){if(!e(R))return;const d=s.team.members.find(C=>C.id===e(R));if(d){t(q,!0);try{await ce.removeMember(s.team.$id,d.$id),t(g,!1),s.onMemberRemoved?.()}catch(C){console.error("[TeamMembersList] Erreur désinscription:",C),alert("Erreur lors de la désinscription")}finally{t(q,!1)}}}function U(d){return d==="owner"?tt:je}function V(d){return d==="owner"?"badge-primary badge-soft":"badge-ghost"}function te(d){return d==="owner"?"Admin":"Membre"}var H=xt(),O=S(H),me=r(O);{var se=d=>{var C=ft(),F=r(C);je(F,{class:"mx-auto mb-2 h-8 w-8"}),_e(2),a(C),i(d,C)},oe=d=>{var C=ht(),F=S(C),N=r(F);Qe(N,{class:"size-4 shrink-0"}),_e(),a(F);var k=n(F,2);Ge(k,21,()=>s.team.members.filter(A=>A.confirmed),A=>A.id,(A,E)=>{const ie=le(()=>e(E).roles[0]),Z=le(()=>U(e(ie))),I=le(()=>e(E).id===e(R)),re=le(()=>e(x)&&!e(I));var P=pt(),l=r(P),c=r(l),f=r(c),v=r(f),y=r(v),h=r(y,!0);a(y),a(v),a(f);var J=n(f,2),B=r(J),K=r(B),D=n(K);{var T=L=>{var j=bt();i(L,j)};w(D,L=>{e(I)&&L(T)})}a(B);var X=n(B,2),$=r(X);a(X),a(J),a(c);var W=n(c,2),b=r(W);vt(b,()=>e(Z),(L,j)=>{j(L,{class:"h-3 w-3"})});var ee=n(b);a(W);var fe=n(W,2),ge=r(fe);{var ke=L=>{var j=_t();j.__click=()=>t(g,!0);var pe=r(j);et(pe,{class:"h-4 w-4"}),a(j),Y(()=>j.disabled=e(q)),i(L,j)},ve=L=>{var j=be(),pe=S(j);{var Ee=Ie=>{var xe=gt();xe.__click=()=>o(e(E).$id,e(E).name);var he=r(xe);at(he,{class:"h-4 w-4"}),a(xe),Y(()=>xe.disabled=e(q)),i(Ie,xe)};w(pe,Ie=>{e(re)&&Ie(Ee)},!0)}i(L,j)};w(ge,L=>{e(I)&&e(E).roles?.[0]!=="owner"?L(ke):L(ve,!1)})}a(fe),a(l),a(P),Y((L,j,pe,Ee)=>{Ce(v,1,`${e(E).name===qe.userName?"bg-accent":"bg-neutral"} text-neutral-content w-12 rounded-full`),ne(h,L),ne(K,`${e(E).name??""} `),ne($,`Membre depuis ${j??""}`),Ce(W,1,`badge ${pe??""} gap-1`),ne(ee,` ${Ee??""}`)},[()=>e(E).name.split(" ").map(L=>L[0]).join("").toUpperCase().slice(0,2),()=>z(e(E).joinedAt),()=>V(e(ie)),()=>te(e(ie))]),i(A,P)}),a(k),i(d,C)};w(me,d=>{s.team.members.length===0?d(se):d(oe,!1)})}a(O);var m=n(O,2);Ne(m,{get isOpen(){return e(_).isOpen},title:"Retirer un membre",get message(){return`Êtes-vous sûr de vouloir retirer ${e(_).memberName??""} de l'équipe ? Cette action est irréversible.`},variant:"warning",confirmLabel:"Retirer",cancelLabel:"Annuler",onConfirm:ae,onCancel:()=>t(_,{isOpen:!1,memberId:null,memberName:null},!0)});var G=n(m,2);Ne(G,{get isOpen(){return e(g)},title:"Quitter l'équipe",message:"Êtes-vous sûr de vouloir quitter cette équipe ? Vous devrez être réinvité pour y revenir.",variant:"warning",confirmLabel:"Quitter",cancelLabel:"Annuler",onConfirm:Q,onCancel:()=>t(g,!1)}),i(ue,H),Pe()}Re(["click"]);var wt=u(`<div class="alert alert-soft alert-warning @max-lg:alert-vertical"><!> Seul·es les admins peuvent modifier
      les paramètres de l'équipe.</div>`),Mt=u('<div class="grid grid-cols-2 gap-4"><fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-1"><!> Département</legend> <label class="input"><input type="text" placeholder="Ex: Île-de-France" maxlength="50"/></label></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-1"><!> Ville</legend> <label class="input"><input type="text" placeholder="Ex: Paris" maxlength="50"/></label></fieldset></div>'),Ct=u(`<div class="@container space-y-4"><!> <fieldset class="fieldset"><legend class="fieldset-legend">Nom de l'équipe *</legend> <label class="input"><input type="text" placeholder="Ex: Équipe Marketing"/></label> <span class="fieldset-label text-xs"> </span></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Description</legend> <textarea class="textarea w-full" rows="3"></textarea> <span class="fieldset-label text-xs"> </span></fieldset> <!></div>`);function Ye(ue,s){Ae(s,!0);let _=de(s,"name",15),g=de(s,"description",15),q=de(s,"location",15,""),R=de(s,"city",15,""),M=de(s,"showLocation",3,!1),x=de(s,"disabled",3,!1),z=de(s,"nameMaxLength",3,50),o=de(s,"descriptionMaxLength",3,350),ae=_()!=="";var Q=Ct(),U=r(Q);{var V=N=>{var k=wt(),A=r(k);Qe(A,{class:"size-5 shrink-0 self-baseline"}),_e(),a(k),i(N,k)};w(U,N=>{ae&&N(V)})}var te=n(U,2),H=n(r(te),2),O=r(H);De(O),O.__keydown=N=>s.onNameKeydown?.(N),a(H);var me=n(H,2),se=r(me);a(me),a(te);var oe=n(te,2),m=n(r(oe),2);Je(m);var G=n(m,2),d=r(G);a(G),a(oe);var C=n(oe,2);{var F=N=>{var k=Mt(),A=r(k),E=r(A),ie=r(E);rt(ie,{class:"h-4 w-4"}),_e(),a(E);var Z=n(E,2),I=r(Z);De(I),a(Z),a(A);var re=n(A,2),P=r(re),l=r(P);nt(l,{class:"h-4 w-4"}),_e(),a(P);var c=n(P,2),f=r(c);De(f),a(c),a(re),a(k),Y(()=>{I.disabled=x(),f.disabled=x()}),Me(I,q),Me(f,R),i(N,k)};w(C,N=>{M()&&N(F)})}a(Q),Y(()=>{Ve(O,"maxlength",z()),O.disabled=x(),ne(se,`${_().length??""}/${z()??""} caractères`),Ve(m,"maxlength",o()),m.disabled=x(),ne(d,`${g().length??""}/${o()??""} caractères`)}),Me(O,_),Me(m,g),i(ue,Q),Pe()}Re(["keydown"]);function kt(ue){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ue)}var Et=u('<div class="alert alert-error"><!> <span> </span></div>'),It=u('<label for="" class="select"><span class="label">Rôle</span> <select class="select"><option class="flex" selected>Membre</option><option>Administrateur</option></select></label>'),Tt=u('<div class="badge badge-primary badge-lg gap-2"><!> <button class="btn btn-circle btn-ghost btn-xs" title="Retirer"><!></button></div>'),Lt=u('<div><div class="mb-2 text-sm font-medium opacity-70"> </div> <div class="flex flex-wrap gap-2"></div></div>'),qt=u(`<div class="@container space-y-4"><div class="alert alert-soft alert-info @max-lg:alert-vertical"><!> <div><p>Envoyez des invitations aux personnes qui font partie de votre cantine.
        Si elles possèdent déjà un compte enka-cookbook, elles pourront
        directement acceder aux événements de l'équipe, sinon, elles recevrons
        un lien pour créer leur compte.</p> <p>Il est aussi possible d'inviter des personnes individuellement à
        participer aux évenements (depuis les pages d'évenements), même si elles
        ne font pas partie de vos équipes.</p></div></div> <!> <!> <div class="rounded-box bg-base-200 flex flex-col gap-2 p-4"><div class="flex flex-wrap gap-2"><label class="input min-w-56 flex-1 gap-2"><!> <input type="email" placeholder="email@example.com"/></label> <!></div> <div>Les administrateur·ices sont seul·es autorisé·es à modifier les
      informations concernant l'équipe et à supprimer des membres.</div> <button class="btn btn-primary btn-sm ml-auto w-fit" title="Ajouter à la liste"><!> Ajouter</button></div> <!> <div><label class="label" for="invite-message"><span class="label-text">Message personnalisé (optionnel)</span></label> <textarea id="invite-message" class="textarea textarea-bordered w-full" placeholder="Ajoutez un message pour les personnes invitées..." rows="3" maxlength="200"></textarea> <span class="label label-text-alt opacity-50"> </span></div></div>`);function Ze(ue,s){Ae(s,!0);let _=de(s,"invitedEmails",31,()=>Le([])),g=de(s,"customMessage",15,""),q=de(s,"loading",3,!1),R=de(s,"role",15,"member"),M=p(""),x=p(null);const z=le(()=>qe.isTeamOwner(s.team.$id));function o(){const l=e(M).trim().toLowerCase();if(!l){t(x,"Veuillez entrer une adresse email");return}if(!kt(l)){t(x,"Adresse email invalide");return}if(_().includes(l)){t(x,"Cet email est déjà dans la liste");return}if(s.team.members.some(f=>f.name.toLowerCase()===l||f.userEmail.toLowerCase()===l)){t(x,"Cette personne est déjà membre ou invitée dans l'équipe");return}_().push(l),t(M,""),t(x,null)}function ae(l){_(_().filter(c=>c!==l))}function Q(l){l.key==="Enter"&&(l.preventDefault(),o())}var U=qt(),V=r(U),te=r(V);Qe(te,{class:"h-6 w-6 shrink-0 self-baseline"}),_e(2),a(V);var H=n(V,2);w(H,l=>{});var O=n(H,2);{var me=l=>{var c=Et(),f=r(c);it(f,{class:"h-6 w-6 shrink-0"});var v=n(f,2),y=r(v,!0);a(v),a(c),Y(()=>ne(y,e(x))),i(l,c)};w(O,l=>{e(x)&&l(me)})}var se=n(O,2),oe=r(se),m=r(oe),G=r(m);ze(G,{class:"h-4 w-4 opacity-50"});var d=n(G,2);De(d),d.__keydown=Q,a(m);var C=n(m,2);{var F=l=>{var c=It(),f=n(r(c),2),v=r(f);v.value=v.__value="member";var y=n(v);y.value=y.__value="owner",a(f),a(c),ct(f,R),i(l,c)};w(C,l=>{e(z)&&l(F)})}a(oe);var N=n(oe,2),k=n(N,2);k.__click=o;var A=r(k);st(A,{class:" h-5 w-5"}),_e(),a(k),a(se);var E=n(se,2);{var ie=l=>{var c=Lt(),f=r(c),v=r(f);a(f);var y=n(f,2);Ge(y,20,_,h=>h,(h,J)=>{var B=Tt(),K=r(B);ze(K,{class:"h-3 w-3"});var D=n(K),T=n(D);T.__click=()=>ae(J);var X=r(T);lt(X,{class:"h-3 w-3"}),a(T),a(B),Y(()=>{ne(D,` ${J??""} `),T.disabled=q()}),i(h,B)}),a(y),a(c),Y(()=>ne(v,`Personnes à inviter (${_().length??""})`)),i(l,c)};w(E,l=>{_().length>0&&l(ie)})}var Z=n(E,2),I=n(r(Z),2);Je(I);var re=n(I,2),P=r(re);a(re),a(Z),a(U),Y(l=>{d.disabled=q(),Ce(N,1,`fieldset-label text-xs ${!e(z)&&"hidden"}`),k.disabled=l,I.disabled=q(),ne(P,`${g().length??""}/200 caractères`)},[()=>q()||!e(M).trim()]),Me(d,()=>e(M),l=>t(M,l)),Me(I,g),i(ue,U),Pe()}Re(["keydown","click"]);var Rt=u('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),At=u('<div><h4 class=" text-sm font-medium opacity-70">Inviter de nouveaux membres</h4> <!></div>'),Pt=u('<div class="tabs tabs-border mb-6 flex-none" role="tablist"><button role="tab"><!> Membres <span class="badge badge-sm badge-secondary ml-1"> </span></button> <button role="tab"><!> Invitations</button> <button role="tab"><!> Paramètres <!></button></div> <!>',1),Dt=u('<span class="loading loading-spinner loading-sm"></span>'),St=u('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Ot=u('<span class="loading loading-spinner loading-sm"></span>'),jt=u('<button class="btn btn-ghost">Fermer</button> <button class="btn btn-primary"><!></button>',1),zt=u('<button class="btn btn-ghost">Fermer</button>'),Ft=u("<!> <!> <!>",1),Nt=u("<!> <!>",1);function ta(ue,s){Ae(s,!0);let _=de(s,"initialTab",3,"members"),g=p(Le(_())),q=p(!1),R=p(!1),M=p(Le([])),x=p(""),z=p(!1);const o=le(()=>s.teamId?ce.getTeamById(s.teamId):null),ae=le(()=>!e(o)||!qe.userId?null:e(o).members.find(N=>N.id===qe.userId)?.roles?.[0]||null),Q=le(()=>e(ae)==="owner");let U=p(""),V=p(""),te=p(""),H=p(""),O=p(!1);He(()=>{e(o)&&(t(U,e(o).name,!0),t(V,e(o).prefs?.description||"",!0),t(te,e(o).prefs?.location||"",!0),t(H,e(o).prefs?.city||"",!0),t(O,!1))}),He(()=>{e(o)&&t(O,e(U)!==e(o).name||e(V)!==(e(o).prefs?.description||"")||e(te)!==(e(o).prefs?.location||"")||e(H)!==(e(o).prefs?.city||""),!0)});async function me(){if(!(!e(o)||!e(O))){t(R,!0);try{await ce.updateTeam(e(o).$id,e(U).trim()||void 0,{description:e(V).trim()||void 0,location:e(te).trim()||void 0,city:e(H).trim()||void 0}),t(O,!1)}catch(F){console.error("[TeamDetailModal] Erreur sauvegarde:",F),alert("Erreur lors de la sauvegarde")}finally{t(R,!1)}}}async function se(){if(e(o)){t(R,!0);try{await ce.deleteTeam(e(o).$id),t(q,!1),s.onClose()}catch(F){console.error("[TeamDetailModal] Erreur suppression:",F),alert("Erreur lors de la suppression de l'équipe")}finally{t(R,!1)}}}async function oe(){s.teamId&&await ce.fetchTeam(s.teamId)}async function m(){if(!(!e(o)||e(M).length===0)){t(z,!0);try{await Xe.track(ce.inviteTeamMember(e(o).$id,e(M),e(x)||void 0),{loading:"Envoi des invitations en cours...",success:`${e(M).length} invitation${e(M).length>1?"s":""} envoyée${e(M).length>1?"s":""} avec succès`,error:"Erreur lors de l'envoi des invitations"}),t(M,[],!0),t(x,""),s.teamId&&await ce.fetchTeam(s.teamId)}catch(F){console.error("[TeamDetailModal] Erreur envoi invitations:",F)}finally{t(z,!1)}}}var G=Nt(),d=S(G);{let F=le(()=>s.teamId!==null);We(d,{get isOpen(){return e(F)},get onClose(){return s.onClose},children:(N,k)=>{var A=be(),E=S(A);{var ie=Z=>{var I=Ft(),re=S(I);Ue(re,{get title(){return e(o).name},get subtitle(){return e(o).description},get onClose(){return s.onClose}});var P=n(re,2);Be(P,{children:(c,f)=>{var v=Pt(),y=S(v),h=r(y);h.__click=()=>t(g,"members");var J=r(h);je(J,{class:"mr-1 h-5 w-5"});var B=n(J,2),K=r(B,!0);a(B),a(h);var D=n(h,2);D.__click=()=>t(g,"invitations");var T=r(D);ze(T,{class:"mr-1 h-5 w-5"}),_e(),a(D);var X=n(D,2);X.__click=()=>t(g,"settings");var $=r(X);ot($,{class:"mr-1 h-5 w-5"});var W=n($,2);{var b=fe=>{var ge=Rt();i(fe,ge)};w(W,fe=>{e(O)&&fe(b)})}a(X),a(y);var ee=n(y,2);ut(ee,()=>e(g),fe=>{var ge=be(),ke=S(ge);{var ve=j=>{yt(j,{get team(){return e(o)},onMemberRemoved:oe})},L=j=>{var pe=be(),Ee=S(pe);{var Ie=he=>{var we=At(),Se=n(r(we),2);Ze(Se,{get team(){return e(o)},get loading(){return e(z)},get invitedEmails(){return e(M)},set invitedEmails(Te){t(M,Te,!0)},get customMessage(){return e(x)},set customMessage(Te){t(x,Te,!0)}}),a(we),i(he,we)},xe=he=>{var we=be(),Se=S(we);{var Te=Oe=>{{let $e=le(()=>e(R)||!e(Q));Ye(Oe,{showLocation:!0,get disabled(){return e($e)},get name(){return e(U)},set name(ye){t(U,ye,!0)},get description(){return e(V)},set description(ye){t(V,ye,!0)},get location(){return e(te)},set location(ye){t(te,ye,!0)},get city(){return e(H)},set city(ye){t(H,ye,!0)}})}};w(Se,Oe=>{e(g)==="settings"&&Oe(Te)},!0)}i(he,we)};w(Ee,he=>{e(g)==="invitations"?he(Ie):he(xe,!1)},!0)}i(j,pe)};w(ke,j=>{e(g)==="members"?j(ve):j(L,!1)})}i(fe,ge)}),Y(()=>{Ce(h,1,`tab ${e(g)==="members"?"tab-active":""}`),ne(K,e(o).members.length),Ce(D,1,`tab ${e(g)==="invitations"?"tab-active":""}`),Ce(X,1,`tab ${e(g)==="settings"?"tab-active":""}`)}),i(c,v)}});var l=n(P,2);Ke(l,{children:(c,f)=>{var v=be(),y=S(v);{var h=B=>{var K=St(),D=S(K);D.__click=function(...b){s.onClose?.apply(this,b)};var T=n(D,2);T.__click=me;var X=r(T);{var $=b=>{var ee=Dt();i(b,ee)},W=b=>{var ee=Fe("Enregistrer");i(b,ee)};w(X,b=>{e(R)?b($):b(W,!1)})}a(T),Y(()=>T.disabled=e(R)||!e(O)),i(B,K)},J=B=>{var K=be(),D=S(K);{var T=$=>{var W=jt(),b=S(W);b.__click=function(...ve){s.onClose?.apply(this,ve)};var ee=n(b,2);ee.__click=m;var fe=r(ee);{var ge=ve=>{var L=Ot();i(ve,L)},ke=ve=>{var L=Fe();Y(()=>ne(L,`Envoyer ${e(M).length??""} invitation${e(M).length>1?"s":""}`)),i(ve,L)};w(fe,ve=>{e(z)?ve(ge):ve(ke,!1)})}a(ee),Y(()=>ee.disabled=e(z)||e(M).length===0),i($,W)},X=$=>{var W=zt();W.__click=function(...b){s.onClose?.apply(this,b)},i($,W)};w(D,$=>{e(g)==="invitations"?$(T):$(X,!1)},!0)}i(B,K)};w(y,B=>{e(g)==="settings"?B(h):B(J,!1)})}i(c,v)}}),i(Z,I)};w(E,Z=>{e(o)&&Z(ie)})}i(N,A)},$$slots:{default:!0}})}var C=n(d,2);Ne(C,{get isOpen(){return e(q)},title:"Supprimer l'équipe",message:"Êtes-vous sûr de vouloir supprimer définitivement cette équipe ? Tous les membres seront retirés et cette action est irréversible.",variant:"danger",confirmLabel:"Supprimer définitivement",cancelLabel:"Annuler",onConfirm:se,onCancel:()=>t(q,!1)}),i(ue,G),Pe()}Re(["click"]);var Ut=u('<div class="alert alert-error"><span class="text-sm"> </span></div>'),Bt=u('<form class="space-y-4"><!> <!></form>'),Kt=u('<span class="loading loading-spinner loading-sm"></span>'),Qt=u(`<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!> Créer l'équipe</button>`,1),Vt=u("<!> <!> <!>",1),Ht=u('<div class="mb-4"><div class="alert alert-success alert-soft flex flex-col"><p> </p> <p>Ajoutez les email des personnes que vous souhaitez inviter</p></div></div> <!>',1),Gt=u('<span class="loading loading-spinner loading-sm"></span>'),Jt=u('<button class="btn btn-ghost">Passer cette étape</button> <button class="btn btn-primary"><!></button>',1),Xt=u("<!> <!> <!>",1);function aa(ue,s){Ae(s,!0);let _=p(""),g=p(""),q=p(""),R=p(""),M=p(!1),x=p(!1),z=p(null),o=p("create"),ae=p(null),Q=p(Le([])),U=p(""),V=p(!1);function te(){t(_,""),t(g,""),t(q,""),t(R,""),t(M,!1),t(z,null),t(o,"create"),t(ae,null),t(Q,[],!0),t(U,""),t(V,!1)}async function H(){if(!e(_).trim()){t(z,"Le nom de l'équipe est requis");return}t(x,!0),t(z,null);try{const m={description:e(g).trim()||void 0,location:e(q).trim()||void 0,city:e(R).trim()||void 0,isPublic:e(M)},G=await ce.createTeam(e(_).trim(),m);t(ae,G.$id,!0),t(o,"invite")}catch(m){t(z,m.message||"Erreur lors de la création de l'équipe",!0),console.error("[CreateTeamModal] Erreur:",m)}finally{t(x,!1)}}async function O(){if(!e(ae)||e(Q).length===0)return;const m=e(ae),G=[...e(Q)],d=e(U)||void 0;me();try{await Xe.track(ce.inviteTeamMember(m,G,d),{loading:"Envoi des invitations en cours...",success:`${G.length} invitation${G.length>1?"s":""} envoyée${G.length>1?"s":""} avec succès`,error:"Erreur lors de l'envoi des invitations"}),await ce.fetchTeam(m)}catch(C){console.error("[CreateTeamModal] Erreur envoi invitations:",C)}}function me(){const m=e(ae);m&&s.onSuccess?.(m),te(),s.onClose()}function se(){te(),s.onClose()}function oe(m){m.key==="Enter"&&e(o)==="create"&&(m.preventDefault(),H())}We(ue,{get isOpen(){return s.isOpen},onClose:se,children:(m,G)=>{var d=be(),C=S(d);{var F=k=>{var A=Vt(),E=S(A);Ue(E,{title:"Créer une équipe",onClose:se});var ie=n(E,2);Be(ie,{children:(I,re)=>{var P=Bt(),l=r(P);Ye(l,{showLocation:!0,get disabled(){return e(x)},onNameKeydown:oe,get name(){return e(_)},set name(v){t(_,v,!0)},get description(){return e(g)},set description(v){t(g,v,!0)},get location(){return e(q)},set location(v){t(q,v,!0)},get city(){return e(R)},set city(v){t(R,v,!0)}});var c=n(l,2);{var f=v=>{var y=Ut(),h=r(y),J=r(h,!0);a(h),a(y),Y(()=>ne(J,e(z))),i(v,y)};w(c,v=>{e(z)&&v(f)})}a(P),mt("submit",P,v=>v.preventDefault()),i(I,P)}});var Z=n(ie,2);Ke(Z,{children:(I,re)=>{var P=Qt(),l=S(P);l.__click=se;var c=n(l,2);c.__click=H;var f=r(c);{var v=h=>{var J=Kt();i(h,J)},y=h=>{dt(h,{class:"h-5 w-5"})};w(f,h=>{e(x)?h(v):h(y,!1)})}_e(),a(c),Y(h=>{l.disabled=e(x),c.disabled=h},[()=>e(x)||!e(_).trim()]),i(I,P)}}),i(k,A)},N=k=>{var A=be(),E=S(A);{var ie=Z=>{const I=le(()=>ce.getTeamById(e(ae)));var re=be(),P=S(re);{var l=c=>{var f=Xt(),v=S(f);Ue(v,{title:"Inviter des membres",onClose:se});var y=n(v,2);Be(y,{children:(J,B)=>{var K=Ht(),D=S(K),T=r(D),X=r(T),$=r(X);a(X),_e(2),a(T),a(D);var W=n(D,2);Ze(W,{get team(){return e(I)},get loading(){return e(V)},get invitedEmails(){return e(Q)},set invitedEmails(b){t(Q,b,!0)},get customMessage(){return e(U)},set customMessage(b){t(U,b,!0)}}),Y(()=>ne($,`Équipe "${e(I).name??""}" créée avec succès !`)),i(J,K)}});var h=n(y,2);Ke(h,{children:(J,B)=>{var K=Jt(),D=S(K);D.__click=me;var T=n(D,2);T.__click=O;var X=r(T);{var $=b=>{var ee=Gt();i(b,ee)},W=b=>{var ee=Fe();Y(()=>ne(ee,`Envoyer ${e(Q).length??""} invitation${e(Q).length>1?"s":""}`)),i(b,ee)};w(X,b=>{e(V)?b($):b(W,!1)})}a(T),Y(()=>T.disabled=e(V)||e(Q).length===0),i(J,K)}}),i(c,f)};w(P,c=>{e(I)&&c(l)})}i(Z,re)};w(E,Z=>{e(o)==="invite"&&e(ae)&&Z(ie)},!0)}i(k,A)};w(C,k=>{e(o)==="create"?k(F):k(N,!1)})}i(m,d)},$$slots:{default:!0}}),Pe()}Re(["click"]);export{aa as C,ta as T};
