import{d as Te,J as Be,A as r,y as w,v as b,k as U,g as n,h as t,K as E,m as e,u as ie,af as Ve,b as i,w as Y,x as oe,c as qe,O as Re,F as fe,B as Ie,W as we,G as ve,o as a,z as Pe,e as Je,I as Ae,ab as ra,C as Ee,p as me,M as He,T as ke,ag as Xe,ah as sa,j as _e,ai as na,U as Ke,S as ia}from"./appwrite.js";import{M as Qe,b as Se,c as je,d as De}from"./index.js";import{U as ze,_ as Ye,$ as la,T as oa,D as Ze,a0 as We,d as da,W as va,a1 as ca,M as Ge,a2 as ua,C as ma,X as fa,O as ba,c as _a}from"./icons.js";import{C as $e}from"./ConfirmModal.js";import"./InfoCollapse.js";var ga=b('<div class="alert alert-warning alert-soft"><!> <span class="text-sm"> </span></div>'),pa=b(`<div class="space-y-6"><fieldset class="fieldset bg-base-100"><legend class="fieldset-legend">Rôle dans l'équipe</legend> <div class="space-y-3"><label class="label cursor-pointer justify-start gap-3"><input type="radio" class="radio radio-primary"/> <span class="label-text flex flex-1 items-center gap-2"><!> <div><strong class="block">Membre</strong> <span class="text-xs opacity-70">Peut voir les ressources de l'équipe</span></div></span></label> <label class="label cursor-pointer justify-start gap-3"><input type="radio" class="radio radio-primary"/> <span class="label-text flex flex-1 items-center gap-2"><!> <div><strong class="block">Admin (Owner)</strong> <span class="text-xs opacity-70">Peut gérer les membres et les paramètres</span></div></span></label> <label class="label cursor-pointer justify-start gap-3"><input type="radio" class="radio radio-error"/> <span class="label-text flex flex-1 items-center gap-2"><!> <div><strong class="text-error block">Retirer de l'équipe</strong> <span class="text-xs opacity-70">Ce membre ne pourra plus accéder aux ressources de l'équipe</span></div></span></label></div></fieldset> <!></div>`),ha=b('<div class="flex-1"></div> <button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!> Valider</button>',1),xa=b("<!> <!> <!>",1);function ya(ce,s){Te(s,!0);const _=[];let o=w("keep"),T=!1;Be(()=>{r(o,s.member.roles[0]==="owner"?"owner":"member",!0)});const P=ie(()=>s.team.members.filter(A=>A.roles[0]==="owner").length),k=ie(()=>s.member.roles[0]==="owner"&&e(P)===1),x=ie(()=>!(e(k)&&(e(o)==="member"||e(o)==="remove"))),S=ie(()=>e(k)&&(e(o)==="member"||e(o)==="remove")?"Vous devez désigner un autre administrateur avant de pouvoir rétrograder ou supprimer ce rôle.":null);async function c(){if(!e(x)||T)return;if(e(o)==="keep"||e(o)===s.member.roles[0]){s.onClose();return}const A=s.team.$id,j=s.member.$id,q=s.member.name,K=s.onMemberUpdated;s.onClose(),e(o)==="remove"?await Re.track(fe.removeMember(A,j),{loading:`Suppression de ${q} de l'équipe...`,success:`${q} a été retiré de l'équipe`,error:"Erreur lors de la suppression du membre"}):await Re.track(fe.updateMemberRole(A,j,e(o)),{loading:`Mise à jour du rôle de ${q}...`,success:`Rôle de ${q} mis à jour avec succès`,error:"Erreur lors de la mise à jour du rôle"}),K?.()}function ae(){s.onClose()}Qe(ce,{get isOpen(){return s.isOpen},onClose:ae,modalClass:"!z-[1100]",maxWidth:"sm",children:(A,j)=>{var q=xa(),K=U(q);Se(K,{title:"Gérer le membre",get subtitle(){return s.member.name},get onClose(){return s.onClose}});var G=n(K,2);je(G,{children:(de,le)=>{var W=pa(),m=t(W),I=n(t(m),2),F=t(I),d=t(F);we(d),d.disabled=T,d.value=d.__value="member";var g=n(d,2),y=t(g);ze(y,{class:"h-5 w-5"}),ve(2),a(g),a(F);var L=n(F,2),O=t(L);we(O),O.disabled=T,O.value=O.__value="owner";var N=n(O,2),Q=t(N);Ye(Q,{class:"text-warning h-5 w-5"}),ve(2),a(N),a(L);var V=n(L,2),M=t(V);we(M),M.disabled=T,M.value=M.__value="remove";var H=n(M,2),R=t(H);la(R,{class:"text-error h-5 w-5"}),ve(2),a(H),a(V),a(I),a(m);var l=n(m,2);{var f=u=>{var v=ga(),C=t(v);oa(C,{class:"h-5 w-5"});var h=n(C,2),J=t(h,!0);a(h),a(v),Y(()=>oe(J,e(S))),i(u,v)};E(l,u=>{e(S)&&u(f)})}a(W),Ve(_,[],d,()=>e(o),u=>r(o,u)),Ve(_,[],O,()=>e(o),u=>r(o,u)),Ve(_,[],M,()=>e(o),u=>r(o,u)),i(de,W)}});var D=n(G,2);De(D,{children:(de,le)=>{var W=ha(),m=n(U(W),2);m.__click=ae,m.disabled=T;var I=n(m,2);I.__click=c;var F=t(I);Ze(F,{class:"h-4 w-4"}),ve(),a(I),Y(()=>I.disabled=!e(x)),i(de,W)}}),i(A,q)},$$slots:{default:!0}}),qe()}Ie(["click"]);var wa=b('<div class="py-8 text-center opacity-50"><!> <p class="text-sm">Aucun membre</p></div>'),Ma=b('<span class="text-xs opacity-50">(vous)</span>'),Ca=b('<button class="btn btn-ghost btn-sm btn-circle" title="Gérer ce membre"><!></button>'),ka=b(`<button class="btn btn-error btn-sm" title="Quitter l'équipe"><!></button>`),Ea=b('<div class="card bg-base-100 border-base-200 border p-4 transition-shadow hover:shadow-md"><div class="flex items-center justify-between gap-4"><div class="flex flex-1 items-center gap-3"><div class="avatar avatar-placeholder"><div><span class="text-lg"> </span></div></div> <div class="flex-1"><div class="font-medium"> <!></div> <div class="text-sm opacity-70"> </div></div></div> <div class="flex items-center gap-2"><div><!> </div> <!></div> <div class="flex gap-2"><!></div></div></div>'),Ta=b(`<div class="alert"><!> Seul les admins peuvent modifier les parametre
      de l'équipe</div> <div class="space-y-2"></div>`,1),qa=b('<div class="space-y-4"><!></div> <!> <!>',1);function Ia(ce,s){Te(s,!0);let _=w(Pe({isOpen:!1,member:null})),o=w(!1),T=w(!1);const P=ie(()=>Ae.userId),k=ie(()=>()=>e(P)&&s.team.members.find(g=>g.id===e(P))?.roles?.[0]||null),x=ie(()=>e(k)()==="owner");function S(d){return new Date(d).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}function c(d){r(_,{isOpen:!0,member:d},!0)}function ae(){s.onMemberRemoved?.(),r(_,{isOpen:!1,member:null},!0)}async function A(){if(!e(P))return;const d=s.team.members.find(g=>g.id===e(P));if(d){if(d.roles[0]==="owner"&&s.team.members.filter(y=>y.roles[0]==="owner"&&y.id!==e(P)).length===0){alert("Vous ne pouvez pas quitter l'équipe car vous êtes le dernier administrateur. Désignez un autre administrateur avant de quitter."),r(o,!1);return}r(T,!0);try{await fe.removeMember(s.team.$id,d.$id),r(o,!1),s.onMemberRemoved?.()}catch(g){console.error("[TeamMembersList] Erreur désinscription:",g),alert("Erreur lors de la désinscription")}finally{r(T,!1)}}}function j(d){return d==="owner"?Ye:ze}function q(d){return d==="owner"?"badge-primary badge-soft":"badge-ghost"}function K(d){return d==="owner"?"Admin":"Membre"}var G=qa(),D=U(G),de=t(D);{var le=d=>{var g=wa(),y=t(g);ze(y,{class:"mx-auto mb-2 h-8 w-8"}),ve(2),a(g),i(d,g)},W=d=>{var g=Ta(),y=U(g),L=t(y);We(L,{class:"size-4 shrink-0"}),ve(),a(y);var O=n(y,2);Je(O,21,()=>s.team.members.filter(N=>N.confirmed),N=>N.id,(N,Q)=>{const V=ie(()=>e(Q).roles[0]),M=ie(()=>j(e(V))),H=ie(()=>e(Q).id===e(P));var R=Ea(),l=t(R),f=t(l),u=t(f),v=t(u),C=t(v),h=t(C,!0);a(C),a(v),a(u);var J=n(u,2),Z=t(J),$=t(Z),B=n($);{var z=X=>{var ee=Ma();i(X,ee)};E(B,X=>{e(H)&&X(z)})}a(Z);var te=n(Z,2),se=t(te);a(te),a(J),a(f);var ne=n(f,2),p=t(ne),re=t(p);ra(re,()=>e(M),(X,ee)=>{ee(X,{class:"h-3 w-3"})});var be=n(re);a(p);var ge=n(p,2);{var Le=X=>{var ee=Ca();ee.__click=()=>c(e(Q));var xe=t(ee);Ze(xe,{class:"h-4 w-4"}),a(ee),Y(()=>ee.disabled=e(T)),i(X,ee)};E(ge,X=>{e(x)&&!e(H)&&X(Le)})}a(ne);var ue=n(ne,2),pe=t(ue);{var he=X=>{var ee=ka();ee.__click=()=>r(o,!0);var xe=t(ee);da(xe,{class:"h-4 w-4"}),a(ee),Y(()=>ee.disabled=e(T)),i(X,ee)};E(pe,X=>{e(H)&&e(Q).roles?.[0]!=="owner"&&X(he)})}a(ue),a(l),a(R),Y((X,ee,xe,Ue)=>{Ee(v,1,`${e(Q).name===Ae.userName?"bg-accent":"bg-neutral"} text-neutral-content w-12 rounded-full`),oe(h,X),oe($,`${e(Q).name??""} `),oe(se,`Membre depuis ${ee??""}`),Ee(p,1,`badge ${xe??""} gap-1`),oe(be,` ${Ue??""}`)},[()=>e(Q).name.split(" ").map(X=>X[0]).join("").toUpperCase().slice(0,2),()=>S(e(Q).joinedAt),()=>q(e(V)),()=>K(e(V))]),i(N,R)}),a(O),i(d,g)};E(de,d=>{s.team.members.length===0?d(le):d(W,!1)})}a(D);var m=n(D,2);{var I=d=>{ya(d,{get isOpen(){return e(_).isOpen},get team(){return s.team},get member(){return e(_).member},onClose:()=>r(_,{isOpen:!1,member:null},!0),onMemberUpdated:ae})};E(m,d=>{e(_).isOpen&&e(_).member&&d(I)})}var F=n(m,2);$e(F,{get isOpen(){return e(o)},title:"Quitter l'équipe",message:"Êtes-vous sûr de vouloir quitter cette équipe ? Vous devrez être réinvité pour y revenir.",variant:"warning",confirmLabel:"Quitter",cancelLabel:"Annuler",onConfirm:A,onCancel:()=>r(o,!1)}),i(ce,G),qe()}Ie(["click"]);var La=b(`<div class="alert alert-soft alert-warning @max-lg:alert-vertical"><!> Seul·es les admins peuvent modifier
      les paramètres de l'équipe.</div>`),Oa=b('<div class="grid grid-cols-2 gap-4"><fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-1"><!> Département</legend> <label class="input"><input type="text" placeholder="Ex: Île-de-France" maxlength="50"/></label></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend flex items-center gap-1"><!> Ville</legend> <label class="input"><input type="text" placeholder="Ex: Paris" maxlength="50"/></label></fieldset></div>'),Pa=b(`<div class="@container space-y-4"><!> <fieldset class="fieldset"><legend class="fieldset-legend required">Nom de l'équipe</legend> <label class="input"><input type="text" placeholder="Ex: Équipe Marketing" required aria-required="true"/></label> <span class="fieldset-label text-xs"> </span></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Description</legend> <textarea class="textarea w-full" rows="3"></textarea> <span class="fieldset-label text-xs"> </span></fieldset> <!></div>`);function ea(ce,s){Te(s,!0);let _=me(s,"name",15),o=me(s,"description",15),T=me(s,"location",15,""),P=me(s,"city",15,""),k=me(s,"showLocation",3,!1),x=me(s,"disabled",3,!1),S=me(s,"nameMaxLength",3,50),c=me(s,"descriptionMaxLength",3,350),ae=_()!=="";var A=Pa(),j=t(A);{var q=y=>{var L=La(),O=t(L);We(O,{class:"size-5 shrink-0 self-baseline"}),ve(),a(L),i(y,L)};E(j,y=>{ae&&y(q)})}var K=n(j,2),G=n(t(K),2),D=t(G);we(D),D.__keydown=y=>s.onNameKeydown?.(y),a(G);var de=n(G,2),le=t(de);a(de),a(K);var W=n(K,2),m=n(t(W),2);Xe(m);var I=n(m,2),F=t(I);a(I),a(W);var d=n(W,2);{var g=y=>{var L=Oa(),O=t(L),N=t(O),Q=t(N);va(Q,{class:"h-4 w-4"}),ve(),a(N);var V=n(N,2),M=t(V);we(M),a(V),a(O);var H=n(O,2),R=t(H),l=t(R);ca(l,{class:"h-4 w-4"}),ve(),a(R);var f=n(R,2),u=t(f);we(u),a(f),a(H),a(L),Y(()=>{M.disabled=x(),u.disabled=x()}),ke(M,T),ke(u,P),i(y,L)};E(d,y=>{k()&&y(g)})}a(A),Y(()=>{He(D,"maxlength",S()),D.disabled=x(),oe(le,`${_().length??""}/${S()??""} caractères`),He(m,"maxlength",c()),m.disabled=x(),oe(F,`${o().length??""}/${c()??""} caractères`)}),ke(D,_),ke(m,o),i(ce,A),qe()}Ie(["keydown"]);function Aa(ce){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ce)}var Ra=b('<div class="alert alert-error"><!> <span> </span></div>'),Sa=b('<label for="" class="select"><span class="label">Rôle</span> <select class="select"><option class="flex" selected>Membre</option><option>Administrateur</option></select></label>'),ja=b('<div class="badge badge-primary badge-lg gap-2"><!> <button class="btn btn-circle btn-ghost btn-xs" title="Retirer"><!></button></div>'),Da=b('<div><div class="mb-2 text-sm font-medium opacity-70"> </div> <div class="flex flex-wrap gap-2"></div></div>'),za=b(`<div class="@container space-y-4"><div class="alert alert-soft alert-info @max-lg:alert-vertical"><!> <div><p>Envoyez des invitations aux personnes qui font partie de votre cantine.
        Si elles possèdent déjà un compte enka-cookbook, elles pourront
        directement acceder aux événements de l'équipe, sinon, elles recevrons
        un lien pour créer leur compte.</p> <p>Il est aussi possible d'inviter des personnes individuellement à
        participer aux évenements (depuis les pages d'évenements), même si elles
        ne font pas partie de vos équipes.</p></div></div> <!> <!> <div class="rounded-box bg-base-200 flex flex-col gap-2 p-4"><div class="flex flex-wrap gap-2"><label class="input min-w-56 flex-1 gap-2"><!> <input type="email" placeholder="email@example.com"/></label> <!></div> <div>Les administrateur·ices sont seul·es autorisé·es à modifier les
      informations concernant l'équipe et à supprimer des membres.</div> <button class="btn btn-primary btn-sm ml-auto w-fit" title="Ajouter à la liste"><!> Ajouter</button></div> <!> <div><label class="label" for="invite-message"><span class="label-text">Message personnalisé (optionnel)</span></label> <textarea id="invite-message" class="textarea textarea-bordered w-full" placeholder="Ajoutez un message pour les personnes invitées..." rows="3" maxlength="200"></textarea> <span class="label label-text-alt opacity-50"> </span></div></div>`);function aa(ce,s){Te(s,!0);let _=me(s,"invitedEmails",31,()=>Pe([])),o=me(s,"customMessage",15,""),T=me(s,"loading",3,!1),P=me(s,"role",15,"member"),k=w(""),x=w(null);const S=ie(()=>Ae.isTeamOwner(s.team.$id));function c(){const l=e(k).trim().toLowerCase();if(!l){r(x,"Veuillez entrer une adresse email");return}if(!Aa(l)){r(x,"Adresse email invalide");return}if(_().includes(l)){r(x,"Cet email est déjà dans la liste");return}if(s.team.members.some(u=>u.name.toLowerCase()===l||u.userEmail.toLowerCase()===l)){r(x,"Cette personne est déjà membre ou invitée dans l'équipe");return}_().push(l),r(k,""),r(x,null)}function ae(l){_(_().filter(f=>f!==l))}function A(l){l.key==="Enter"&&(l.preventDefault(),c())}var j=za(),q=t(j),K=t(q);We(K,{class:"h-6 w-6 shrink-0 self-baseline"}),ve(2),a(q);var G=n(q,2);E(G,l=>{});var D=n(G,2);{var de=l=>{var f=Ra(),u=t(f);ma(u,{class:"h-6 w-6 shrink-0"});var v=n(u,2),C=t(v,!0);a(v),a(f),Y(()=>oe(C,e(x))),i(l,f)};E(D,l=>{e(x)&&l(de)})}var le=n(D,2),W=t(le),m=t(W),I=t(m);Ge(I,{class:"h-4 w-4 opacity-50"});var F=n(I,2);we(F),F.__keydown=A,a(m);var d=n(m,2);{var g=l=>{var f=Sa(),u=n(t(f),2),v=t(u);v.value=v.__value="member";var C=n(v);C.value=C.__value="owner",a(u),a(f),sa(u,P),i(l,f)};E(d,l=>{e(S)&&l(g)})}a(W);var y=n(W,2),L=n(y,2);L.__click=c;var O=t(L);ua(O,{class:" h-5 w-5"}),ve(),a(L),a(le);var N=n(le,2);{var Q=l=>{var f=Da(),u=t(f),v=t(u);a(u);var C=n(u,2);Je(C,20,_,h=>h,(h,J)=>{var Z=ja(),$=t(Z);Ge($,{class:"h-3 w-3"});var B=n($),z=n(B);z.__click=()=>ae(J);var te=t(z);fa(te,{class:"h-3 w-3"}),a(z),a(Z),Y(()=>{oe(B,` ${J??""} `),z.disabled=T()}),i(h,Z)}),a(C),a(f),Y(()=>oe(v,`Personnes à inviter (${_().length??""})`)),i(l,f)};E(N,l=>{_().length>0&&l(Q)})}var V=n(N,2),M=n(t(V),2);Xe(M);var H=n(M,2),R=t(H);a(H),a(V),a(j),Y(l=>{F.disabled=T(),Ee(y,1,`fieldset-label text-xs ${!e(S)&&"hidden"}`),L.disabled=l,M.disabled=T(),oe(R,`${o().length??""}/200 caractères`)},[()=>T()||!e(k).trim()]),ke(F,()=>e(k),l=>r(k,l)),ke(M,o),i(ce,j),qe()}Ie(["keydown","click"]);var Ua=b('<div class="bg-warning ml-1 h-2 w-2 rounded-full"></div>'),Fa=b('<div><h4 class=" text-sm font-medium opacity-70">Inviter de nouveaux membres</h4> <!></div>'),Na=b('<div class="tabs tabs-border mb-6 flex-none" role="tablist"><button role="tab"><!> Membres <span class="badge badge-sm badge-secondary ml-1"> </span></button> <button role="tab"><!> Invitations</button> <button role="tab"><!> Paramètres <!></button></div> <!>',1),Va=b('<span class="loading loading-spinner loading-sm"></span>'),Ba=b('<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!></button>',1),Ka=b('<span class="loading loading-spinner loading-sm"></span>'),Ga=b('<button class="btn btn-ghost">Fermer</button> <button class="btn btn-primary"><!></button>',1),Qa=b('<button class="btn btn-ghost">Fermer</button>'),Wa=b("<!> <!> <!>",1),Ha=b("<!> <!>",1);function dt(ce,s){Te(s,!0);let _=me(s,"initialTab",3,"members"),o=w(Pe(_())),T=w(!1),P=w(!1),k=w(Pe([])),x=w(""),S=w(!1);const c=ie(()=>s.teamId?fe.getTeamById(s.teamId):null),ae=ie(()=>!e(c)||!Ae.userId?null:e(c).members.find(y=>y.id===Ae.userId)?.roles?.[0]||null),A=ie(()=>e(ae)==="owner");let j=w(""),q=w(""),K=w(""),G=w(""),D=w(!1);Be(()=>{e(c)&&(r(j,e(c).name,!0),r(q,e(c).prefs?.description||"",!0),r(K,e(c).prefs?.location||"",!0),r(G,e(c).prefs?.city||"",!0),r(D,!1))}),Be(()=>{e(c)&&r(D,e(j)!==e(c).name||e(q)!==(e(c).prefs?.description||"")||e(K)!==(e(c).prefs?.location||"")||e(G)!==(e(c).prefs?.city||""),!0)});async function de(){if(!(!e(c)||!e(D))){r(P,!0);try{await fe.updateTeam(e(c).$id,e(j).trim()||void 0,{description:e(q).trim()||void 0,location:e(K).trim()||void 0,city:e(G).trim()||void 0}),r(D,!1)}catch(g){console.error("[TeamDetailModal] Erreur sauvegarde:",g),alert("Erreur lors de la sauvegarde")}finally{r(P,!1)}}}async function le(){if(e(c)){r(P,!0);try{await fe.deleteTeam(e(c).$id),r(T,!1),s.onClose()}catch(g){console.error("[TeamDetailModal] Erreur suppression:",g),alert("Erreur lors de la suppression de l'équipe")}finally{r(P,!1)}}}async function W(){s.teamId&&await fe.fetchTeam(s.teamId)}async function m(){if(!(!e(c)||e(k).length===0)){r(S,!0);try{await Re.track(fe.inviteTeamMember(e(c).$id,e(k),e(x)||void 0),{loading:"Envoi des invitations en cours...",success:`${e(k).length} invitation${e(k).length>1?"s":""} envoyée${e(k).length>1?"s":""} avec succès`,error:"Erreur lors de l'envoi des invitations"}),r(k,[],!0),r(x,""),s.teamId&&await fe.fetchTeam(s.teamId)}catch(g){console.error("[TeamDetailModal] Erreur envoi invitations:",g)}finally{r(S,!1)}}}var I=Ha(),F=U(I);{let g=ie(()=>s.teamId!==null);Qe(F,{get isOpen(){return e(g)},get onClose(){return s.onClose},children:(y,L)=>{var O=_e(),N=U(O);{var Q=V=>{var M=Wa(),H=U(M);Se(H,{get title(){return e(c).name},get subtitle(){return e(c).description},get onClose(){return s.onClose}});var R=n(H,2);je(R,{children:(f,u)=>{var v=Na(),C=U(v),h=t(C);h.__click=()=>r(o,"members");var J=t(h);ze(J,{class:"mr-1 h-5 w-5"});var Z=n(J,2),$=t(Z,!0);a(Z),a(h);var B=n(h,2);B.__click=()=>r(o,"invitations");var z=t(B);Ge(z,{class:"mr-1 h-5 w-5"}),ve(),a(B);var te=n(B,2);te.__click=()=>r(o,"settings");var se=t(te);ba(se,{class:"mr-1 h-5 w-5"});var ne=n(se,2);{var p=be=>{var ge=Ua();i(be,ge)};E(ne,be=>{e(D)&&be(p)})}a(te),a(C);var re=n(C,2);na(re,()=>e(o),be=>{var ge=_e(),Le=U(ge);{var ue=he=>{Ia(he,{get team(){return e(c)},onMemberRemoved:W})},pe=he=>{var X=_e(),ee=U(X);{var xe=Me=>{var Ce=Fa(),Fe=n(t(Ce),2);aa(Fe,{get team(){return e(c)},get loading(){return e(S)},get invitedEmails(){return e(k)},set invitedEmails(Oe){r(k,Oe,!0)},get customMessage(){return e(x)},set customMessage(Oe){r(x,Oe,!0)}}),a(Ce),i(Me,Ce)},Ue=Me=>{var Ce=_e(),Fe=U(Ce);{var Oe=Ne=>{{let ta=ie(()=>e(P)||!e(A));ea(Ne,{showLocation:!0,get disabled(){return e(ta)},get name(){return e(j)},set name(ye){r(j,ye,!0)},get description(){return e(q)},set description(ye){r(q,ye,!0)},get location(){return e(K)},set location(ye){r(K,ye,!0)},get city(){return e(G)},set city(ye){r(G,ye,!0)}})}};E(Fe,Ne=>{e(o)==="settings"&&Ne(Oe)},!0)}i(Me,Ce)};E(ee,Me=>{e(o)==="invitations"?Me(xe):Me(Ue,!1)},!0)}i(he,X)};E(Le,he=>{e(o)==="members"?he(ue):he(pe,!1)})}i(be,ge)}),Y(()=>{Ee(h,1,`tab ${e(o)==="members"?"tab-active":""}`),oe($,e(c).members.length),Ee(B,1,`tab ${e(o)==="invitations"?"tab-active":""}`),Ee(te,1,`tab ${e(o)==="settings"?"tab-active":""}`)}),i(f,v)}});var l=n(R,2);De(l,{children:(f,u)=>{var v=_e(),C=U(v);{var h=Z=>{var $=Ba(),B=U($);B.__click=function(...p){s.onClose?.apply(this,p)};var z=n(B,2);z.__click=de;var te=t(z);{var se=p=>{var re=Va();i(p,re)},ne=p=>{var re=Ke("Enregistrer");i(p,re)};E(te,p=>{e(P)?p(se):p(ne,!1)})}a(z),Y(()=>z.disabled=e(P)||!e(D)),i(Z,$)},J=Z=>{var $=_e(),B=U($);{var z=se=>{var ne=Ga(),p=U(ne);p.__click=function(...ue){s.onClose?.apply(this,ue)};var re=n(p,2);re.__click=m;var be=t(re);{var ge=ue=>{var pe=Ka();i(ue,pe)},Le=ue=>{var pe=Ke();Y(()=>oe(pe,`Envoyer ${e(k).length??""} invitation${e(k).length>1?"s":""}`)),i(ue,pe)};E(be,ue=>{e(S)?ue(ge):ue(Le,!1)})}a(re),Y(()=>re.disabled=e(S)||e(k).length===0),i(se,ne)},te=se=>{var ne=Qa();ne.__click=function(...p){s.onClose?.apply(this,p)},i(se,ne)};E(B,se=>{e(o)==="invitations"?se(z):se(te,!1)},!0)}i(Z,$)};E(C,Z=>{e(o)==="settings"?Z(h):Z(J,!1)})}i(f,v)}}),i(V,M)};E(N,V=>{e(c)&&V(Q)})}i(y,O)},$$slots:{default:!0}})}var d=n(F,2);$e(d,{get isOpen(){return e(T)},title:"Supprimer l'équipe",message:"Êtes-vous sûr de vouloir supprimer définitivement cette équipe ? Tous les membres seront retirés et cette action est irréversible.",variant:"danger",confirmLabel:"Supprimer définitivement",cancelLabel:"Annuler",onConfirm:le,onCancel:()=>r(T,!1)}),i(ce,I),qe()}Ie(["click"]);var Ja=b('<div class="alert alert-error"><span class="text-sm"> </span></div>'),Xa=b('<form class="space-y-4"><!> <!></form>'),Ya=b('<span class="loading loading-spinner loading-sm"></span>'),Za=b(`<button class="btn btn-ghost">Annuler</button> <button class="btn btn-primary"><!> Créer l'équipe</button>`,1),$a=b("<!> <!> <!>",1),et=b('<div class="mb-4"><div class="alert alert-success alert-soft flex flex-col"><p> </p> <p>Ajoutez les email des personnes que vous souhaitez inviter</p></div></div> <!>',1),at=b('<span class="loading loading-spinner loading-sm"></span>'),tt=b('<button class="btn btn-ghost">Passer cette étape</button> <button class="btn btn-primary"><!></button>',1),rt=b("<!> <!> <!>",1);function vt(ce,s){Te(s,!0);let _=w(""),o=w(""),T=w(""),P=w(""),k=w(!1),x=w(!1),S=w(null),c=w("create"),ae=w(null),A=w(Pe([])),j=w(""),q=w(!1);function K(){r(_,""),r(o,""),r(T,""),r(P,""),r(k,!1),r(S,null),r(c,"create"),r(ae,null),r(A,[],!0),r(j,""),r(q,!1)}async function G(){if(!e(_).trim()){r(S,"Le nom de l'équipe est requis");return}r(x,!0),r(S,null);try{const m={description:e(o).trim()||void 0,location:e(T).trim()||void 0,city:e(P).trim()||void 0,isPublic:e(k)},I=await fe.createTeam(e(_).trim(),m);r(ae,I.$id,!0),r(c,"invite")}catch(m){r(S,m.message||"Erreur lors de la création de l'équipe",!0),console.error("[CreateTeamModal] Erreur:",m)}finally{r(x,!1)}}async function D(){if(!e(ae)||e(A).length===0)return;const m=e(ae),I=[...e(A)],F=e(j)||void 0;de();try{await Re.track(fe.inviteTeamMember(m,I,F),{loading:"Envoi des invitations en cours...",success:`${I.length} invitation${I.length>1?"s":""} envoyée${I.length>1?"s":""} avec succès`,error:"Erreur lors de l'envoi des invitations"}),await fe.fetchTeam(m)}catch(d){console.error("[CreateTeamModal] Erreur envoi invitations:",d)}}function de(){const m=e(ae);m&&s.onSuccess?.(m),K(),s.onClose()}function le(){K(),s.onClose()}function W(m){m.key==="Enter"&&e(c)==="create"&&(m.preventDefault(),G())}Qe(ce,{get isOpen(){return s.isOpen},onClose:le,children:(m,I)=>{var F=_e(),d=U(F);{var g=L=>{var O=$a(),N=U(O);Se(N,{title:"Créer une équipe",onClose:le});var Q=n(N,2);je(Q,{children:(M,H)=>{var R=Xa(),l=t(R);ea(l,{showLocation:!0,get disabled(){return e(x)},onNameKeydown:W,get name(){return e(_)},set name(v){r(_,v,!0)},get description(){return e(o)},set description(v){r(o,v,!0)},get location(){return e(T)},set location(v){r(T,v,!0)},get city(){return e(P)},set city(v){r(P,v,!0)}});var f=n(l,2);{var u=v=>{var C=Ja(),h=t(C),J=t(h,!0);a(h),a(C),Y(()=>oe(J,e(S))),i(v,C)};E(f,v=>{e(S)&&v(u)})}a(R),ia("submit",R,v=>v.preventDefault()),i(M,R)}});var V=n(Q,2);De(V,{children:(M,H)=>{var R=Za(),l=U(R);l.__click=le;var f=n(l,2);f.__click=G;var u=t(f);{var v=h=>{var J=Ya();i(h,J)},C=h=>{_a(h,{class:"h-5 w-5"})};E(u,h=>{e(x)?h(v):h(C,!1)})}ve(),a(f),Y(h=>{l.disabled=e(x),f.disabled=h},[()=>e(x)||!e(_).trim()]),i(M,R)}}),i(L,O)},y=L=>{var O=_e(),N=U(O);{var Q=V=>{const M=ie(()=>fe.getTeamById(e(ae)));var H=_e(),R=U(H);{var l=f=>{var u=rt(),v=U(u);Se(v,{title:"Inviter des membres",onClose:le});var C=n(v,2);je(C,{children:(J,Z)=>{var $=et(),B=U($),z=t(B),te=t(z),se=t(te);a(te),ve(2),a(z),a(B);var ne=n(B,2);aa(ne,{get team(){return e(M)},get loading(){return e(q)},get invitedEmails(){return e(A)},set invitedEmails(p){r(A,p,!0)},get customMessage(){return e(j)},set customMessage(p){r(j,p,!0)}}),Y(()=>oe(se,`Équipe "${e(M).name??""}" créée avec succès !`)),i(J,$)}});var h=n(C,2);De(h,{children:(J,Z)=>{var $=tt(),B=U($);B.__click=de;var z=n(B,2);z.__click=D;var te=t(z);{var se=p=>{var re=at();i(p,re)},ne=p=>{var re=Ke();Y(()=>oe(re,`Envoyer ${e(A).length??""} invitation${e(A).length>1?"s":""}`)),i(p,re)};E(te,p=>{e(q)?p(se):p(ne,!1)})}a(z),Y(()=>z.disabled=e(q)||e(A).length===0),i(J,$)}}),i(f,u)};E(R,f=>{e(M)&&f(l)})}i(V,H)};E(N,V=>{e(c)==="invite"&&e(ae)&&V(Q)},!0)}i(L,O)};E(d,L=>{e(c)==="create"?L(g):L(y,!1)})}i(m,F)},$$slots:{default:!0}}),qe()}Ie(["click"]);export{vt as C,dt as T};
