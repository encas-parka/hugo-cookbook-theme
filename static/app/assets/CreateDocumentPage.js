import{d as oe,y as g,z as de,J as A,I as ce,O as w,E as K,m as e,u as c,a1 as h,Y as ue,v as x,g as u,h as s,A as o,K as j,w as F,T as J,P as ve,b as T,c as me,F as fe,D as pe,B as ge,G as O,o as r,W}from"./appwrite.js";import{n as Y,a as be}from"./index.js";import{M as _e}from"./MarkdownEditorAdvanced.js";import{B as ye}from"./BtnGroupCheck.js";import{c as we,a4 as he}from"./icons.js";import"./tiptap-markdown.es.js";import"./CheckboxBadge.js";var Te=x('<span class="loading loading-spinner loading-sm"></span>'),xe=x('<div class="flex items-center gap-2"><button class="btn btn-primary btn-sm"><!> Créer</button></div>'),ke=x("<div><!></div>"),Se=x('<div class="mx-auto max-w-5xl p-4" role="region" tabindex="-1"><div class="space-y-4"><fieldset class="fieldset flex"><label class="input input-lg w-full"><span class="label">Nom</span> <input type="text" placeholder="Titre du document" maxlength="50" required/></label></fieldset> <fieldset class="fieldset"><!></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Tags</legend> <div class="flex flex-wrap items-center gap-x-6 gap-y-2"><!> <label class="input w-80"><input type="text" placeholder="Nouveau tag..." maxlength="30"/> <button class="btn btn-primary btn-sm"><!> Ajouter</button></label></div></fieldset></div></div>');function Be(H,Q){oe(Q,!0);const R=t=>{var n=xe(),i=s(n);i.__click=N;var z=s(i);{var ne=d=>{var le=Te();T(d,le)},ie=d=>{he(d,{class:"h-4 w-4"})};j(z,d=>{e(l)?d(ne):d(ie,!1)})}O(),r(i),r(n),F(()=>i.disabled=!e(X)||!e(B)||e(l)),T(t,n)};let b=c(()=>pe.params.teamId),_=g(""),k=g(""),a=g(de([])),v=g(""),U=!1,l=g(!1),m=c(()=>fe.myTeams.find(t=>t.$id===e(b))),P=c(()=>{const t=h.getTeamTags(e(b)),n=new Set([...t,...e(a)]);return Array.from(n).map(i=>({id:i,label:i,selected:e(a).includes(i)}))});const X=c(()=>!e(l)),B=c(()=>e(_).trim().length>0&&e(m)!==void 0);A(()=>{if(!ce.userId){w.error("Vous devez être connecté"),K("/");return}if(!e(m)){w.error("Équipe introuvable"),K("/");return}h.isInitialized||h.initialize()});const Z=c(()=>`Nouveau document - ${e(m)?.name} `);A(()=>{Y.setConfig({title:e(Z),actions:R})}),ue(()=>{Y.reset()});function I(){const t=e(v).trim().toLowerCase();t&&!e(a).includes(t)&&(o(a,[...e(a),t],!0),o(v,""))}function ee(t){t.key==="Enter"&&(t.preventDefault(),I())}function te(t){e(a).includes(t)?o(a,e(a).filter(n=>n!==t),!0):o(a,[...e(a),t],!0)}async function N(){if(!(!e(B)||e(l)||!e(m))){o(l,!0);try{const t=await h.createDocument({title:e(_).trim(),content:e(k),tags:e(a).length>0?e(a):null,isPublic:U,teamName:e(m).name,status:"doc"},e(b));w.success("Document créé avec succès"),K(`/editdocument/${e(b)}/${t.$id}`)}catch(t){console.error("[CreateDocumentPage] Erreur création document:",t),w.error("Erreur lors de la création du document")}finally{o(l,!1)}}}function S(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),N())}A(()=>(window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)));var f=Se();f.__keydown=S;var L=s(f),C=s(L),$=s(C),D=u(s($),2);W(D),r($),r(C);var E=u(C,2),ae=s(E);_e(ae,{placeholder:"Commencez à rédiger votre document...",get value(){return e(k)},set value(t){o(k,t,!0)}}),r(E);var q=u(E,2),G=u(s(q),2),M=s(G);{var se=t=>{var n=ke(),i=s(n);ye(i,{get items(){return e(P)},onToggleItem:z=>te(z),size:"md",showStats:!1}),r(n),T(t,n)};j(M,t=>{e(P).length>0&&t(se)})}var V=u(M,2),p=s(V);W(p),p.__keydown=ee;var y=u(p,2);y.__click=I;var re=s(y);we(re,{class:"h-4 w-4"}),O(),r(y),r(V),r(G),r(q),r(L),r(f),F(t=>{D.disabled=e(l),p.disabled=e(l),y.disabled=t},[()=>e(l)||!e(v).trim()]),J(D,()=>e(_),t=>o(_,t)),J(p,()=>e(v),t=>o(v,t)),ve(3,f,()=>be),T(H,f),me()}ge(["click","keydown"]);export{Be as default};
