import{d as ue,y as p,z as me,J as K,I as ve,O as w,E as P,m as e,u as d,a1 as T,Y as fe,v as k,k as ge,g as c,h as s,A as o,K as F,w as J,T as O,P as pe,b as x,c as _e,F as be,D as he,B as ye,G as W,o as r,W as Y}from"./appwrite.js";import{n as H,a as we}from"./index.js";import{M as Te}from"./MarkdownEditorAdvanced.js";import{B as xe}from"./BtnGroupCheck.js";import{U as ke}from"./UnsavedChangesGuard.js";import{c as Ce,a4 as Se}from"./icons.js";import"./tiptap-markdown.es.js";import"./CheckboxBadge.js";var ze=k('<span class="loading loading-spinner loading-sm"></span>'),De=k('<div class="flex items-center gap-2"><button class="btn btn-primary btn-sm"><!> Créer</button></div>'),Ee=k("<div><!></div>"),Ke=k('<!> <div class="mx-auto max-w-5xl p-4" role="region" tabindex="-1"><div class="space-y-4"><fieldset class="fieldset flex"><label class="input input-lg w-full"><span class="label">Nom</span> <input type="text" placeholder="Titre du document" maxlength="50" required/></label></fieldset> <fieldset class="fieldset"><!></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Tags</legend> <div class="flex flex-wrap items-center gap-x-6 gap-y-2"><!> <label class="input w-80"><input type="text" placeholder="Nouveau tag..." maxlength="30"/> <button class="btn btn-primary btn-sm"><!> Ajouter</button></label></div></fieldset></div></div>',1);function Le(Q,R){ue(R,!0);const X=t=>{var n=De(),i=s(n);i.__click=N;var E=s(i);{var oe=u=>{var ce=ze();x(u,ce)},de=u=>{Se(u,{class:"h-4 w-4"})};F(E,u=>{e(l)?u(oe):u(de,!1)})}W(),r(i),r(n),J(()=>i.disabled=!e(ee)||!e(B)||e(l)),x(t,n)};let _=d(()=>he.params.teamId),m=p(""),b=p(""),a=p(me([])),v=p(""),Z=!1,l=p(!1),f=d(()=>be.myTeams.find(t=>t.$id===e(_))),A=d(()=>{const t=T.getTeamTags(e(_)),n=new Set([...t,...e(a)]);return Array.from(n).map(i=>({id:i,label:i,selected:e(a).includes(i)}))});const ee=d(()=>!e(l)),B=d(()=>e(m).trim().length>0&&e(f)!==void 0),te=d(()=>e(m).trim().length>0||e(b).trim().length>0||e(a).length>0);K(()=>{if(!ve.userId){w.error("Vous devez être connecté"),P("/");return}if(!e(f)){w.error("Équipe introuvable"),P("/");return}T.isInitialized||T.initialize()});const ae=d(()=>`Nouveau document - ${e(f)?.name} `);K(()=>{H.setConfig({title:e(ae),actions:X})}),fe(()=>{H.reset()});function I(){const t=e(v).trim().toLowerCase();t&&!e(a).includes(t)&&(o(a,[...e(a),t],!0),o(v,""))}function se(t){t.key==="Enter"&&(t.preventDefault(),I())}function re(t){e(a).includes(t)?o(a,e(a).filter(n=>n!==t),!0):o(a,[...e(a),t],!0)}async function N(){if(!(!e(B)||e(l)||!e(f))){o(l,!0);try{const t=await T.createDocument({title:e(m).trim(),content:e(b),tags:e(a).length>0?e(a):null,isPublic:Z,teamName:e(f).name,status:"doc"},e(_));w.success("Document créé avec succès"),P(`/editdocument/${e(_)}/${t.$id}`)}catch(t){console.error("[CreateDocumentPage] Erreur création document:",t),w.error("Erreur lors de la création du document")}finally{o(l,!1)}}}function C(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),N())}K(()=>(window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)));var V=Ke(),q=ge(V);ke(q,{routeKey:"create-document",shouldProtect:()=>e(te),message:"Vous avez commencé à créer un document. Voulez-vous quitter sans sauvegarder ?"});var h=c(q,2);h.__keydown=C;var G=s(h),S=s(G),L=s(S),z=c(s(L),2);Y(z),r(L),r(S);var D=c(S,2),ne=s(D);Te(ne,{placeholder:"Commencez à rédiger votre document...",get value(){return e(b)},set value(t){o(b,t,!0)}}),r(D);var U=c(D,2),$=c(s(U),2),M=s($);{var ie=t=>{var n=Ee(),i=s(n);xe(i,{get items(){return e(A)},onToggleItem:E=>re(E),size:"md",showStats:!1}),r(n),x(t,n)};F(M,t=>{e(A).length>0&&t(ie)})}var j=c(M,2),g=s(j);Y(g),g.__keydown=se;var y=c(g,2);y.__click=I;var le=s(y);Ce(le,{class:"h-4 w-4"}),W(),r(y),r(j),r($),r(U),r(G),r(h),J(t=>{z.disabled=e(l),g.disabled=e(l),y.disabled=t},[()=>e(l)||!e(v).trim()]),O(z,()=>e(m),t=>o(m,t)),O(g,()=>e(v),t=>o(v,t)),pe(3,h,()=>we),x(Q,V),_e()}ye(["click","keydown"]);export{Le as default};
