import{d as he,v as m,g as l,h as a,K as h,m as e,y as b,b as d,c as ye,A as t,j as ke,k as y,w as M,x as W,B as Le,E as $,o as s,G as P,W as ee,S as Re,T as ae,V as Pe,U as je}from"./appwrite.js";import{K as Ve,f as se,x as te,G as ze,H as Ce}from"./icons.js";var Ee=m('<p class="text-base-content/70 mt-2">Entrez votre nouveau mot de passe</p>'),Ie=m('<div class="flex flex-col items-center py-8"><!> <p class="text-base-content/70 mt-4">Vérification du lien...</p></div>'),Me=m('<div role="alert" class="alert alert-error max-md:alert-vertical mt-4"><!> <span> </span></div> <div class="card-actions mt-6 justify-center"><button class="btn btn-primary">Retour à la connexion</button></div>',1),qe=m('<div role="alert" class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Ae=m('<div role="alert" class="alert alert-success max-md:alert-vertical mb-4"><!> <span> </span></div> <p class="text-base-content/70 text-center">Vous allez être redirigé...</p>',1),Ke=m("<!> Réinitialisation en cours...",1),Te=m(`<form class="space-y-4 svelte-ybl9gg"><fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Nouveau mot de passe</span></legend> <input id="new-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/> <p class="label text-base-content/50">Minimum 8 caractères</p></fieldset> <fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Confirmer le mot de passe</span></legend> <input id="confirm-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/></fieldset> <div class=" mt-6 svelte-ybl9gg"><button type="submit" class="btn btn-primary btn-block"><!></button></div></form> <div class="card-actions mt-4 justify-center"><button class="btn btn-ghost btn-sm"><!> Retour à l'acceuil</button></div>`,1),Ge=m("<!> <!>",1),Se=m('<div class="bg-base-200 flex items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body"><div class="text-center"><div class="mb-4 flex justify-center"><div class="bg-primary/10 rounded-full p-4"><!></div></div> <h2 class="card-title justify-center text-2xl">Réinitialisation du mot de passe</h2> <!></div> <!></div></div></div>');function De(re,ie){he(ie,!0);let _=b(!1),o=b(""),q=b(""),g=b(""),j=b(""),k=b(!1),A=b(!0);const F=new URLSearchParams(window.location.search),K=F.get("userId"),T=F.get("secret");async function ne(){if(!K||!T){t(o,"Lien de réinitialisation invalide ou manquant."),t(k,!1),t(A,!1);return}t(k,!0),t(A,!1)}ne();async function le(i){if(i.preventDefault(),!K||!T||!e(k)){t(o,"Lien de réinitialisation invalide.");return}if(!e(g)||!e(j)){t(o,"Veuillez remplir tous les champs");return}if(e(g)!==e(j)){t(o,"Les mots de passe ne correspondent pas.");return}if(e(g).length<8){t(o,"Le mot de passe doit contenir au moins 8 caractères.");return}t(_,!0),t(o,"");try{const{account:r}=await Pe();await r.updateRecovery({userId:K,secret:T,password:e(g)}),t(q,"Mot de passe réinitialisé avec succès !"),setTimeout(()=>{$("/dashboard")},3e3)}catch(r){console.error("Erreur réinitialisation:",r),r.response?.code===401||r.message?.includes("Invalid secret")?t(o,"Ce lien est invalide ou a expiré. Veuillez refaire une demande."):t(o,r.message||"Erreur lors de la réinitialisation",!0)}finally{t(_,!1)}}function J(){$("/")}var G=Se(),O=a(G),Q=a(O),S=a(Q),U=a(S),X=a(U),oe=a(X);Ve(oe,{class:"text-primary h-8 w-8"}),s(X),s(U);var de=l(U,4);{var ve=i=>{var r=Ee();d(i,r)};h(de,i=>{e(k)&&i(ve)})}s(S);var ce=l(S,2);{var ue=i=>{var r=Ie(),B=a(r);se(B,{class:"text-primary h-12 w-12 animate-spin"}),P(2),s(r),d(i,r)},pe=i=>{var r=ke(),B=y(r);{var me=w=>{var L=Me(),x=y(L),V=a(x);te(V,{class:"h-6 w-6 shrink-0"});var z=l(V,2),D=a(z,!0);s(z),s(x);var C=l(x,2),n=a(C);n.__click=J,s(C),M(()=>W(D,e(o))),d(w,L)},fe=w=>{var L=Ge(),x=y(L);{var V=n=>{var u=qe(),v=a(u);te(v,{class:"h-6 w-6 shrink-0"});var p=l(v,2),f=a(p,!0);s(p),s(u),M(()=>W(f,e(o))),d(n,u)};h(x,n=>{e(o)&&n(V)})}var z=l(x,2);{var D=n=>{var u=Ae(),v=y(u),p=a(v);ze(p,{class:"h-6 w-6 shrink-0"});var f=l(p,2),R=a(f,!0);s(f),s(v),P(2),M(()=>W(R,e(q))),d(n,u)},C=n=>{var u=Te(),v=y(u),p=a(v),f=l(a(p),2);ee(f),P(2),s(p);var R=l(p,2),H=l(a(R),2);ee(H),s(R);var Y=l(R,2),N=a(Y),_e=a(N);{var be=c=>{var I=Ke(),xe=y(I);se(xe,{class:"mr-2 h-4 w-4 animate-spin"}),P(),d(c,I)},ge=c=>{var I=je("Réinitialiser le mot de passe");d(c,I)};h(_e,c=>{e(_)?c(be):c(ge,!1)})}s(N),s(Y),s(v);var Z=l(v,2),E=a(Z);E.__click=J;var we=a(E);Ce(we,{class:"mr-1 h-4 w-4"}),P(),s(E),s(Z),M(()=>{f.disabled=e(_),H.disabled=e(_),N.disabled=e(_),E.disabled=e(_)}),Re("submit",v,le),ae(f,()=>e(g),c=>t(g,c)),ae(H,()=>e(j),c=>t(j,c)),d(n,u)};h(z,n=>{e(q)?n(D):n(C,!1)})}d(w,L)};h(B,w=>{e(k)?w(fe,!1):w(me)},!0)}d(i,r)};h(ce,i=>{e(A)?i(ue):i(pe,!1)})}s(Q),s(O),s(G),d(re,G),ye()}Le(["click"]);export{De as default};
