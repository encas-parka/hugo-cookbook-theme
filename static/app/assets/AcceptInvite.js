import{d as se,X as re,D as C,A as t,y as _,V as R,ae as ne,E as M,J as ie,Y as le,v as x,K as T,m as e,h as r,P as oe,b as c,c as ce,j as F,k as j,g as d,w as G,x as de,B as ve,G as J,o as n,W as K,T as O}from"./appwrite.js";import{n as U,a as pe}from"./index.js";import{T as ue}from"./icons.js";var fe=x(`<span class="loading loading-spinner loading-lg text-primary mx-auto"></span> <p class="text-base-content/70 mt-4">V√©rification de l'invitation...</p>`,1),me=x(`<!> <h2 class="text-error text-xl font-bold">Oups !</h2> <p class="py-4"> </p> <button class="btn btn-ghost">Retour √† l'accueil</button>`,1),be=x('<span class="loading loading-spinner loading-xs"></span>'),ge=x(`<div class="mb-2 text-4xl">üëã</div> <h2 class="card-title justify-center text-2xl">Bienvenue !</h2> <p class="text-base-content/70 mb-6 text-sm">Votre invitation est valid√©e. <br/> Veuillez d√©finir un mot de passe.</p> <label class="w-full text-left"><div class="label"><span class="label-text">Votre Pseudo / Nom</span> <span class="label-text-alt text-error">*</span></div> <input type="text" class="input w-full" required maxlength="25"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Nouveau mot de passe</span></div> <input type="password" placeholder="Minimum 8 caract√®res" class="input w-full"/></label> <div class="card-actions mt-6"><button class="btn btn-primary w-full"><!> Terminer l'inscription</button></div>`,1),_e=x('<div class="bg-base-200 flex min-h-screen items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body text-center"><!></div></div></div>');function ye(W,X){se(X,!0);let i=_(!0),v=_("verifying"),E=_(""),h=_(""),l=_(""),u="",w="",y="";re(async()=>{if(u=C.search.userId||"",w=C.search.eventId||"",y=C.search.teamId||"",!u||!w&&!y){t(v,"error"),t(E,"Lien d'invitation incomplet ou invalide."),t(i,!1);return}try{console.log("[AcceptInvite] Initialisation...",{userId:u,eventId:w,teamId:y});const{client:a,account:s}=await R(),{token:q}=await ne(u,w,y);console.log("[AcceptInvite] Token re√ßu, cr√©ation session..."),await s.createSession({userId:u,secret:q});const f=await s.get();if(console.log("[AcceptInvite] Connect√© en tant que :",f.name),t(l,f.name,!0),f.passwordUpdate){M("/dashboard");return}t(v,"set-password")}catch(a){console.error("[AcceptInvite] Erreur validation:",a),t(v,"error"),t(E,a.message||"Ce lien d'invitation est invalide.",!0)}finally{t(i,!1)}});async function Y(){if(!e(l)||e(l).trim().length===0){alert("Veuillez saisir votre pseudo / nom.");return}if(e(h).length<8){alert("Le mot de passe doit faire au moins 8 caract√®res.");return}t(i,!0);try{const{client:a,account:s}=await R();await s.updatePassword({password:e(h)}),e(l)&&await s.updateName({name:e(l)}),console.log("[AcceptInvite] Session cr√©√©e, redirection..."),M("/dashboard")}catch(a){console.error("[AcceptInvite] Erreur finalisation:",a),alert("Erreur : "+a.message),t(i,!1)}}ie(()=>{U.setConfig({title:"Rejoindre l'√©quipe"})}),le(()=>{U.reset()});var I=_e(),N=r(I),P=r(N),H=r(P);{var Q=a=>{var s=fe();J(2),c(a,s)},Z=a=>{var s=F(),q=j(s);{var f=p=>{var m=me(),A=j(m);ue(A,{class:"text-error mb-2 size-7"});var b=d(A,4),g=r(b,!0);n(b);var k=d(b,2);k.__click=()=>M("/"),G(()=>de(g,e(E))),c(p,m)},$=p=>{var m=F(),A=j(m);{var b=g=>{var k=ge(),z=d(j(k),6),S=d(r(z),2);K(S),n(z);var B=d(z,2),D=d(r(B),2);K(D),n(B);var L=d(B,2),V=r(L);V.__click=Y;var ee=r(V);{var ae=o=>{var te=be();c(o,te)};T(ee,o=>{e(i)&&o(ae)})}J(),n(V),n(L),G(()=>V.disabled=e(i)),O(S,()=>e(l),o=>t(l,o)),O(D,()=>e(h),o=>t(h,o)),c(g,k)};T(A,g=>{e(v)==="set-password"&&g(b)},!0)}c(p,m)};T(q,p=>{e(v)==="error"?p(f):p($,!1)},!0)}c(a,s)};T(H,a=>{e(i)&&e(v)!=="set-password"?a(Q):a(Z,!1)})}n(P),n(N),n(I),oe(3,I,()=>pe),c(W,I),ce()}ve(["click"]);export{ye as default};
