import{d as oa,y as x,z as ke,J as ce,m as e,u as q,F as B,ah as ca,A as o,v as m,g as c,h as s,k as J,K as A,ai as Me,b as v,w as K,ac as va,x as P,T as Te,c as ua,D as $e,O as ve,j as ma,e as Ie,I as je,_ as pa,E as fa,aj as ga,ak as _a,B as ba,G as g,o as t,W as F,ae as xa,C as ha,al as ya,am as Da}from"./appwrite.js";import{E as wa,f as Sa}from"./EventMealCard.js";import{F as Ce}from"./Fieldset.js";import{n as Ve}from"./index.js";import{a3 as Ea,_ as ka,c as ze,a4 as Ma,t as Ta}from"./icons.js";import"./keyboardNavigation.svelte.js";import"./ConfirmModal.js";import"./products-display.js";import"./date-helpers.js";import"./index2.js";var $a=m('<span class="loading loading-spinner loading-xs text-primary"></span>'),Ia=m('<div class="flex items-center gap-2"><button class="btn btn-accent btn-sm"><!> <span class="font-bold">Créer</span></button></div>'),ja=m('<p class="text-error mt-2 text-sm">Veuillez sélectionner un statut</p>'),Ca=m('<div class="space-y-3"><label class="flex cursor-pointer items-center gap-3"><input type="radio" class="radio radio-primary"/> <div class="flex-1"><div class="font-medium">Proposition</div> <div class="text-sm opacity-70">En attente de confirmation</div></div></label> <label class="flex cursor-pointer items-center gap-3"><input type="radio" class="radio radio-primary"/> <div class="flex-1"><div class="font-medium">Confirmé</div> <div class="text-sm opacity-70">Événement validé</div></div></label></div> <!>',1),Va=m(`<div class="flex items-center justify-center py-20"><div class="flex flex-col items-center gap-4"><span class="loading loading-spinner loading-lg text-primary"></span> <p class="text-base-content/60">Création de l'événement...</p></div></div>`),za=m('<label><input type="checkbox" class="checkbox checkbox-sm checkbox-secondary"/> <div class="flex flex-col"><span class="text-sm font-medium"> <span class="text-xs opacity-60"> </span></span> <div class="text-xs opacity-70"> </div></div></label>'),Aa=m(`<label class="cursor-pointer justify-center gap-4"><input type="checkbox" class="checkbox checkbox-sm"/> <span class="ms-1">Envoyer un email de notification aux membres des équipes</span></label> <p class="text-base-content/60 mt-1 text-xs">Si désactivé, les membres auront accès à l'événement mais ne
                recevront pas d'email.</p>`,1),Fa=m(`<fieldset class="fieldset mb-6"><legend class="fieldset-legend">Minimum de participant·es</legend> <label class="input"><input type="number" min="1" max="100" placeholder="1"/></label> <p class="fieldset-label text-base-content/60">Combien faudrait-il être pour tout gérer ?</p></fieldset> <fieldset class="fieldset mb-4"><legend class="fieldset-legend">Sélectionnez les équipes à inviter à l'événement :</legend> <div class="flex flex-wrap gap-2"></div> <div class="text-base-content/70 alert alert-vertical mt-4 text-sm"><!> Une fois l'événement crée, il vous sera possible d'inviter des personnes
                individuellement, indépendamment des équipes.</div></fieldset> <!>`,1),Ha=m(`<p class="text-sm italic opacity-60">Vous ne faites partie d'aucune équipe.</p>`),Na=m('<div class="text-base-content/60 bg-base-200 rounded-box border-base-200 flex flex-col items-center justify-center border-2 border-dashed py-12"><div class="bg-base-200 mb-4 rounded-full p-4"><!></div> <p class="font-medium">Aucun repas planifié</p> <p class="mt-1 text-sm">Commencez par ajouter un repas à votre événement</p></div>'),Oa=m("<div><!></div>"),qa=m('<div class="space-y-4"></div>'),Ba=m('<div class="grid grid-cols-1 gap-6 lg:grid-cols-3"><div class="space-y-6 lg:col-span-1"><!></div> <div class="space-y-6 md:px-4 lg:col-span-2"><div class="mb-6 flex items-center justify-between"><h3> </h3> <button class="btn btn-primary btn-sm"><!> Ajouter un repas</button></div> <!> <div class="flex"><button class="btn btn-outline btn-primary btn-block mt-4"><!> Ajouter un repas</button></div></div></div>'),Pa=m(`<div class="bg-base-200 min-h-lvh space-y-10 px-2 pt-4 pb-20 md:px-30 md:pb-20"><div class="card bg-base-100"><div class="card-body"><div class="card-title mb-4"><!> Création d'un événement</div> <p>La création d'événement permet d'organiser des menus sur plusieurs
        jours, se répartir les taches (une fois l'événement crée), gérer une
        liste de courses générées à partir des ingrédients des recettes, générer
        des affiches de menus...</p></div></div> <div class="flex flex-col justify-between gap-6"><div class="min-w-80 flex-1 gap-2"><input type="text" class="input input-lg min-w-2/3 shadow-md" placeholder="Nom de l'événement"/></div> <div class="flex flex-wrap gap-x-10 gap-y-6"><div class="span-2 flex min-w-xs flex-1 flex-col"><textarea class="textarea shamd-sm w-full" placeholder="Décrivez l'événement..." maxlength="3000" rows="9"></textarea> <p class="label ms-auto me-2 text-end text-sm"> </p></div> <div class="align-start md:min-w-96"><!></div></div></div> <!></div>`);function Za(Ae,Fe){oa(Fe,!0);const ue=[],He=a=>{var r=Ia(),i=s(r);i.__click=Le;var n=s(i);{var l=u=>{var h=$a();v(u,h)},d=u=>{Ma(u,{size:18,class:"mr-1"})};A(n,u=>{e(C)?u(l):u(d,!1)})}g(2),t(i),t(r),K(()=>i.disabled=e(C)||!e(Ne)),v(a,r)};let p=x(ke([])),H=x(""),L=x(""),j=x(""),N=x(!1),C=x(!1),R=x(null);const E=q(()=>[...e(p)].sort((a,r)=>new Date(a.date).getTime()-new Date(r.date).getTime())),Ne=q(()=>e(H).trim().length>0||e(p).length>0);let f=x(ke([])),Q=x(!0);const Oe=q(()=>$e.search.teamId?String($e.search.teamId):null);ce(()=>{const a=e(Oe),r=B.myTeams;a&&r.some(i=>i.$id===a)&&ca(()=>{e(f).includes(a)||o(f,[a],!0)})});function qe(a){e(f).includes(a)?o(f,e(f).filter(r=>r!==a),!0):o(f,[...e(f),a],!0)}let me=x(1);ce(()=>{Ve.setConfig({actions:He})});function Be(){if(!e(H).trim())return{isValid:!1,errorMessage:"Veuillez renseigner le nom de l'événement"};if(e(p).length===0)return{isValid:!1,errorMessage:"Veuillez ajouter au moins un repas"};if(!e(j))return o(N,!0),{isValid:!1,errorMessage:"Veuillez sélectionner le statut de l'événement"};const r=e(p).map(i=>i.date).filter((i,n,l)=>l.indexOf(i)!==n);return r.length>0?{isValid:!1,errorMessage:`Certaines dates sont en double: ${r.map(n=>{try{return new Date(n).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return n}}).join(", ")}`}:(o(N,!1),{isValid:!0})}async function Pe(){const a=Be();if(!a.isValid)return ve.error(a.errorMessage||"Erreur de validation"),!1;const r=[{id:je.userId||"",name:je.userName,status:"accepted",invitedAt:new Date().toISOString(),respondedAt:new Date().toISOString()}],i=Array.from(new Set(e(E).map(d=>d.date))).sort(),n=e(f).map(d=>B.getTeamById(d)?.name||"").filter(Boolean),l={name:e(H),description:e(L),status:e(j),allDates:i,dateStart:i.length>0?i[0]:"",dateEnd:i.length>0?i[i.length-1]:"",teams:n,teamsId:e(f),contributors:r,meals:e(E)};try{const d=await pa.createEventWithTeams(l,e(f),e(Q));return fa(`/dashboard/eventEdit/${d.$id}`),!0}catch(d){return console.error("Erreur sauvegarde:",d),ve.error("Erreur lors de la création"),!1}}async function Le(){o(C,!0),await Pe()&&ve.success("Événement créé"),o(C,!1)}function Re(a){o(H,a.target.value,!0)}function pe(){const a=ga(6);let r;if(e(E).length===0){const n=new Date;n.setDate(n.getDate()+7),n.setHours(20,0,0,0),r=n.toISOString()}else{const n=e(E)[e(E).length-1],l=new Date(n.date);l.getHours()<14?l.setHours(20,0,0,0):(l.setDate(l.getDate()+1),l.setHours(12,0,0,0)),r=l.toISOString()}const i={id:a,date:r,guests:100,recipes:[]};o(p,[...e(p),i],!0),o(R,a,!0)}function Ue(a){o(p,e(p).filter(r=>r.id!==a),!0)}function We(a){o(R,e(R)===a?null:a,!0)}ce(()=>()=>{Ve.reset()});var X=Pa(),Y=s(X),fe=s(Y),ge=s(fe),Ge=s(ge);Ea(Ge,{}),g(),t(ge),g(2),t(fe),t(Y);var Z=c(Y,2),ee=s(Z),U=s(ee);F(U),U.__input=Re,t(ee);var _e=c(ee,2),ae=s(_e),te=s(ae);xa(te);var be=c(te,2),Je=s(be);t(be),t(ae);var xe=c(ae,2),Ke=s(xe);Ce(Ke,{legend:"Statut de l'événement",children:(a,r)=>{var i=Ca(),n=J(i),l=s(n),d=s(l);F(d),d.__change=()=>o(N,!1),d.value=d.__value="proposition",g(2),t(l);var u=c(l,2),h=s(u);F(h),h.__change=()=>o(N,!1),h.value=h.__value="confirmed",g(2),t(u),t(n);var O=c(n,2);{var se=_=>{var re=ja();v(_,re)};A(O,_=>{e(N)&&_(se)})}Me(ue,[],d,()=>{"proposition";return e(j)},_=>o(j,_)),Me(ue,[],h,()=>{"confirmed";return e(j)},_=>o(j,_)),v(a,i)},$$slots:{default:!0}}),t(xe),t(_e),t(Z);var Qe=c(Z,2);{var Xe=a=>{var r=Va();v(a,r)},Ye=a=>{var r=Ba(),i=s(r),n=s(i);Ce(n,{legend:"Équipes participantes",children:(k,M)=>{var y=ma(),D=J(y);{var V=T=>{var z=Fa(),w=J(z),W=c(s(w),2),ye=s(W);F(ye),t(W),g(2),t(w);var le=c(w,2),de=c(s(le),2);Ie(de,21,()=>B.myTeams,S=>S.$id,(S,b)=>{var $=za(),I=s($);F(I),I.__change=()=>qe(e(b).$id);var G=c(I,2),oe=s(G),we=s(oe),Se=c(we),ra=s(Se);t(Se),t(oe);var Ee=c(oe,2),ia=s(Ee,!0);t(Ee),t(G),t($),K((na,la,da)=>{ha($,1,`bg-secondary/10 hover:bg-secondary/20 flex cursor-pointer items-center gap-3 rounded-lg px-4 py-2 ${na??""}`),ya(I,la),P(we,`${e(b).name??""} `),P(ra,`(${e(b).total??""} membre${e(b).total>1?"s":""})`),P(ia,da)},[()=>e(f).includes(e(b).$id)&&"ring-secondary ring-2",()=>e(f).includes(e(b).$id),()=>B.getTeamMemberNames(e(b).$id).join(", ")]),v(S,$)}),t(de);var De=c(de,2),aa=s(De);ka(aa,{class:"size-4 shrink-0"}),g(),t(De),t(le);var ta=c(le,2);{var sa=S=>{var b=Aa(),$=J(b),I=s($);F(I),g(2),t($),g(2),_a(I,()=>e(Q),G=>o(Q,G)),v(S,b)};A(ta,S=>{e(f).length>0&&S(sa)})}Te(ye,()=>e(me),S=>o(me,S)),v(T,z)},ne=T=>{var z=Ha();v(T,z)};A(D,T=>{B.myTeams.length>0?T(V):T(ne,!1)})}v(k,y)},$$slots:{default:!0}}),t(i);var l=c(i,2),d=s(l),u=s(d),h=s(u);t(u);var O=c(u,2);O.__click=pe;var se=s(O);ze(se,{class:"mr-1 h-4 w-4"}),g(),t(O),t(d);var _=c(d,2);{var re=k=>{var M=Na(),y=s(M),D=s(y);Ta(D,{class:"h-8 w-8 opacity-50"}),t(y),g(4),t(M),v(k,M)},Ze=k=>{var M=qa();Ie(M,29,()=>e(E),y=>y.id,(y,D)=>{var V=Oa(),ne=s(V);{let T=q(()=>e(R)===e(D).id),z=q(()=>e(p).map(w=>w.date));wa(ne,{get isEditing(){return e(T)},onEditToggle:()=>We(e(D).id||""),onDelete:()=>Ue(e(D).id||""),get allDates(){return e(z)},disabled:!1,get meal(){return e(p)[e(p).findIndex(w=>w.id===e(D).id)]},set meal(w){e(p)[e(p).findIndex(W=>W.id===e(D).id)]=w}})}t(V),Da(V,()=>Sa,()=>({delay:100,duration:400})),v(y,V)}),t(M),v(k,M)};A(_,k=>{e(E).length===0?k(re):k(Ze,!1)})}var he=c(_,2),ie=s(he);ie.__click=pe;var ea=s(ie);ze(ea,{class:"mr-1 h-4 w-4"}),g(),t(ie),t(he),t(l),t(r),K(()=>P(h,`Repas & Menus (${e(E).length??""})`)),v(a,r)};A(Qe,a=>{e(C)?a(Xe):a(Ye,!1)})}t(X),K(()=>{va(U,e(H)),U.disabled=e(C),P(Je,`${e(L).length??""}/3000 caractères`)}),Te(te,()=>e(L),a=>o(L,a)),v(Ae,X),ua()}ba(["click","input","change"]);export{Za as default};
