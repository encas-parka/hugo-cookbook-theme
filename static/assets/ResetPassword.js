import{a6 as he,e as $,n as ee,z as ye,a7 as ke}from"./icons.js";import{v as m,I as h,b as d,c as Re,d as Le,A as t,g as a,h as l,y as b,B as Pe,m as e,j as je,k as y,w as M,x as G,E as ae,o as s,K as P,U as se,Q as ze,R as te,T as Ie,S as Ve}from"./appwrite.js";var Ce=m('<p class="text-base-content/70 mt-2">Entrez votre nouveau mot de passe</p>'),Ee=m('<div class="flex flex-col items-center py-8"><!> <p class="text-base-content/70 mt-4">Vérification du lien...</p></div>'),Me=m('<div role="alert" class="alert alert-error max-md:alert-vertical mt-4"><!> <span> </span></div> <div class="card-actions mt-6 justify-center"><button class="btn btn-primary">Retour à la connexion</button></div>',1),qe=m('<div role="alert" class="alert alert-error max-md:alert-vertical mb-4"><!> <span> </span></div>'),Ae=m('<div role="alert" class="alert alert-success max-md:alert-vertical mb-4"><!> <span> </span></div> <p class="text-base-content/70 text-center">Vous allez être redirigé...</p>',1),Te=m("<!> Réinitialisation en cours...",1),Ke=m(`<form class="space-y-4 svelte-ybl9gg"><fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Nouveau mot de passe</span></legend> <input id="new-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/> <p class="label text-base-content/50">Minimum 8 caractères</p></fieldset> <fieldset class="fieldset svelte-ybl9gg"><legend class="legend"><span>Confirmer le mot de passe</span></legend> <input id="confirm-password" type="password" class="input input-bordered w-full" minlength="8" required autocomplete="new-password"/></fieldset> <div class=" mt-6 svelte-ybl9gg"><button type="submit" class="btn btn-primary btn-block"><!></button></div></form> <div class="card-actions mt-4 justify-center"><button class="btn btn-ghost btn-sm"><!> Retour à l'acceuil</button></div>`,1),Se=m("<!> <!>",1),Ue=m('<div class="bg-base-200 flex items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body"><div class="text-center"><div class="mb-4 flex justify-center"><div class="bg-primary/10 rounded-full p-4"><!></div></div> <h2 class="card-title justify-center text-2xl">Réinitialisation du mot de passe</h2> <!></div> <!></div></div></div>');function Ne(re,ie){Le(ie,!0);let _=b(!1),o=b(""),q=b(""),g=b(""),j=b(""),k=b(!1),A=b(!0);const H=new URLSearchParams(window.location.search),T=H.get("userId"),K=H.get("secret");async function ne(){if(!T||!K){t(o,"Lien de réinitialisation invalide ou manquant."),t(k,!1),t(A,!1);return}t(k,!0),t(A,!1)}ne();async function le(i){if(i.preventDefault(),!T||!K||!e(k)){t(o,"Lien de réinitialisation invalide.");return}if(!e(g)||!e(j)){t(o,"Veuillez remplir tous les champs");return}if(e(g)!==e(j)){t(o,"Les mots de passe ne correspondent pas.");return}if(e(g).length<8){t(o,"Le mot de passe doit contenir au moins 8 caractères.");return}t(_,!0),t(o,"");try{const{account:r}=await Ie();await r.updateRecovery({userId:T,secret:K,password:e(g)}),t(q,"Mot de passe réinitialisé avec succès !"),setTimeout(()=>{ae("/dashboard")},3e3)}catch(r){console.error("Erreur réinitialisation:",r),r.response?.code===401||r.message?.includes("Invalid secret")?t(o,"Ce lien est invalide ou a expiré. Veuillez refaire une demande."):t(o,r.message||"Erreur lors de la réinitialisation",!0)}finally{t(_,!1)}}function J(){ae("/")}var S=Ue(),O=a(S),W=a(O),U=a(W),B=a(U),X=a(B),oe=a(X);he(oe,{class:"text-primary h-8 w-8"}),s(X),s(B);var de=l(B,4);{var ve=i=>{var r=Ce();d(i,r)};h(de,i=>{e(k)&&i(ve)})}s(U);var ce=l(U,2);{var ue=i=>{var r=Ee(),D=a(r);$(D,{class:"text-primary h-12 w-12 animate-spin"}),P(2),s(r),d(i,r)},pe=i=>{var r=je(),D=y(r);{var me=w=>{var R=Me(),x=y(R),z=a(x);ee(z,{class:"h-6 w-6 shrink-0"});var I=l(z,2),N=a(I,!0);s(I),s(x);var V=l(x,2),n=a(V);n.__click=J,s(V),M(()=>G(N,e(o))),d(w,R)},fe=w=>{var R=Se(),x=y(R);{var z=n=>{var u=qe(),v=a(u);ee(v,{class:"h-6 w-6 shrink-0"});var p=l(v,2),f=a(p,!0);s(p),s(u),M(()=>G(f,e(o))),d(n,u)};h(x,n=>{e(o)&&n(z)})}var I=l(x,2);{var N=n=>{var u=Ae(),v=y(u),p=a(v);ye(p,{class:"h-6 w-6 shrink-0"});var f=l(p,2),L=a(f,!0);s(f),s(v),P(2),M(()=>G(L,e(q))),d(n,u)},V=n=>{var u=Ke(),v=y(u),p=a(v),f=l(a(p),2);se(f),P(2),s(p);var L=l(p,2),Q=l(a(L),2);se(Q),s(L);var Y=l(L,2),F=a(Y),_e=a(F);{var be=c=>{var E=Te(),xe=y(E);$(xe,{class:"mr-2 h-4 w-4 animate-spin"}),P(),d(c,E)},ge=c=>{var E=Ve("Réinitialiser le mot de passe");d(c,E)};h(_e,c=>{e(_)?c(be):c(ge,!1)})}s(F),s(Y),s(v);var Z=l(v,2),C=a(Z);C.__click=J;var we=a(C);ke(we,{class:"mr-1 h-4 w-4"}),P(),s(C),s(Z),M(()=>{f.disabled=e(_),Q.disabled=e(_),F.disabled=e(_),C.disabled=e(_)}),ze("submit",v,le),te(f,()=>e(g),c=>t(g,c)),te(Q,()=>e(j),c=>t(j,c)),d(n,u)};h(I,n=>{e(q)?n(N):n(V,!1)})}d(w,R)};h(D,w=>{e(k)?w(fe,!1):w(me)},!0)}d(i,r)};h(ce,i=>{e(A)?i(ue):i(pe,!1)})}s(W),s(O),s(S),d(re,S),Re()}Pe(["click"]);export{Ne as default};
