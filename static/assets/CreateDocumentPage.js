import{P as oe,x as de}from"./icons.js";import{y as p,z as ce,H as A,$ as ue,v as T,I as F,g as s,h as c,w as H,R,m as e,b as w,c as ve,d as me,G as fe,M as h,E as K,u,a3 as x,A as o,F as pe,B as ge,K as U,o as r,U as J}from"./appwrite.js";import{M as be}from"./MarkdownEditorAdvanced.js";import{B as _e}from"./BtnGroupCheck.js";import{n as O}from"./index.js";import"./tiptap-markdown.es.js";import"./CheckboxBadge.js";var ye=T('<span class="loading loading-spinner loading-sm"></span>'),we=T('<div class="flex items-center gap-2"><button class="btn btn-primary"><!> Créer</button></div>'),he=T("<div><!></div>"),xe=T('<div class="mx-auto max-w-5xl p-4" role="region" tabindex="-1"><div class="space-y-4"><fieldset class="fieldset flex"><label class="input input-lg w-full"><span class="label">Nom</span> <input type="text" placeholder="Titre du document" maxlength="50" required/></label></fieldset> <fieldset class="fieldset"><!></fieldset> <fieldset class="fieldset"><legend class="fieldset-legend">Tags</legend> <div class="flex flex-wrap items-center gap-x-6 gap-y-2"><!> <label class="input w-80"><input type="text" placeholder="Nouveau tag..." maxlength="30"/> <button class="btn btn-primary btn-sm"><!> Ajouter</button></label></div></fieldset></div></div>');function Ae(Q,P){me(P,!0);const W=t=>{var n=we(),l=s(n);l.__click=L;var z=s(l);{var ne=d=>{var ie=ye();w(d,ie)},le=d=>{de(d,{class:"h-4 w-4"})};F(z,d=>{e(i)?d(ne):d(le,!1)})}U(),r(l),r(n),H(()=>l.disabled=!e(Y)||!e(I)||e(i)),w(t,n)};let g=u(()=>P.params.teamId),b=p(""),k=p(""),a=p(ce([])),v=p(""),X=!1,i=p(!1),m=u(()=>pe.myTeams.find(t=>t.$id===e(g))),B=u(()=>{const t=x.getTeamTags(e(g)),n=new Set([...t,...e(a)]);return Array.from(n).map(l=>({id:l,label:l,selected:e(a).includes(l)}))});const Y=u(()=>!e(i)),I=u(()=>e(b).trim().length>0&&e(m)!==void 0);A(()=>{if(!fe.userId){h.error("Vous devez être connecté"),K("/");return}if(!e(m)){h.error("Équipe introuvable"),K("/");return}x.isInitialized||x.initialize()});const Z=u(()=>`Nouveau document - ${e(m)?.name} `);A(()=>{O.setConfig({title:e(Z),actions:W})}),ue(()=>{O.reset()});function N(){const t=e(v).trim().toLowerCase();t&&!e(a).includes(t)&&(o(a,[...e(a),t],!0),o(v,""))}function ee(t){t.key==="Enter"&&(t.preventDefault(),N())}function te(t){e(a).includes(t)?o(a,e(a).filter(n=>n!==t),!0):o(a,[...e(a),t],!0)}async function L(){if(!(!e(I)||e(i)||!e(m))){o(i,!0);try{const t=await x.createDocument({title:e(b).trim(),content:e(k),tags:e(a).length>0?e(a):null,isPublic:X,teamName:e(m).name,status:"doc"},e(g));h.success("Document créé avec succès"),K(`/editdocument/${e(g)}/${t.$id}`)}catch(t){console.error("[CreateDocumentPage] Erreur création document:",t),h.error("Erreur lors de la création du document")}finally{o(i,!1)}}}function S(t){(t.ctrlKey||t.metaKey)&&t.key==="s"&&(t.preventDefault(),L())}A(()=>(window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)));var _=xe();_.__keydown=S;var M=s(_),C=s(M),q=s(C),E=c(s(q),2);J(E),r(q),r(C);var D=c(C,2),ae=s(D);be(ae,{placeholder:"Commencez à rédiger votre document...",get value(){return e(k)},set value(t){o(k,t,!0)}}),r(D);var G=c(D,2),V=c(s(G),2),$=s(V);{var se=t=>{var n=he(),l=s(n);_e(l,{get items(){return e(B)},onToggleItem:z=>te(z),size:"md",showStats:!1}),r(n),w(t,n)};F($,t=>{e(B).length>0&&t(se)})}var j=c($,2),f=s(j);J(f),f.__keydown=ee;var y=c(f,2);y.__click=N;var re=s(y);oe(re,{class:"h-4 w-4"}),U(),r(y),r(j),r(V),r(G),r(M),r(_),H(t=>{E.disabled=e(i),f.disabled=e(i),y.disabled=t},[()=>e(i)||!e(v).trim()]),R(E,()=>e(b),t=>o(b,t)),R(f,()=>e(v),t=>o(v,t)),w(Q,_),ve()}ge(["click","keydown"]);export{Ae as default};
