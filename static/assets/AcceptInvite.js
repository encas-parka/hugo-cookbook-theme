import{Q as se}from"./icons.js";import{Z as re,H as ne,$ as ie,v as x,I as V,b as c,c as le,d as oe,av as C,A as a,T as Q,aw as ce,y as _,E as M,B as de,m as e,g as r,j as U,k as j,h as d,w as D,x as ve,K as F,o as n,U as H,R as K}from"./appwrite.js";import{n as O}from"./index.js";var pe=x(`<span class="loading loading-spinner loading-lg text-primary mx-auto"></span> <p class="text-base-content/70 mt-4">V√©rification de l'invitation...</p>`,1),ue=x(`<!> <h2 class="text-error text-xl font-bold">Oups !</h2> <p class="py-4"> </p> <button class="btn btn-ghost">Retour √† l'accueil</button>`,1),me=x('<span class="loading loading-spinner loading-xs"></span>'),fe=x(`<div class="mb-2 text-4xl">üëã</div> <h2 class="card-title justify-center text-2xl">Bienvenue !</h2> <p class="text-base-content/70 mb-6 text-sm">Votre invitation est valid√©e. <br/> Veuillez d√©finir un mot de passe.</p> <label class="w-full text-left"><div class="label"><span class="label-text">Votre Pseudo / Nom</span> <span class="label-text-alt text-error">*</span></div> <input type="text" class="input w-full" required maxlength="25"/></label> <label class="mt-3 w-full text-left"><div class="label"><span class="label-text">Nouveau mot de passe</span></div> <input type="password" placeholder="Minimum 8 caract√®res" class="input w-full"/></label> <div class="card-actions mt-6"><button class="btn btn-primary w-full"><!> Terminer l'inscription</button></div>`,1),be=x('<div class="bg-base-200 flex min-h-screen items-center justify-center p-4"><div class="card bg-base-100 w-full max-w-md shadow-xl"><div class="card-body text-center"><!></div></div></div>');function we(Z,G){oe(G,!0);let i=_(!0),v=_("verifying"),E=_(""),w=_(""),l=_(""),u="",h="",y="";re(async()=>{if(u=C("userId")||"",h=C("eventId")||"",y=C("teamId")||"",!u||!h&&!y){a(v,"error"),a(E,"Lien d'invitation incomplet ou invalide."),a(i,!1);return}try{console.log("[AcceptInvite] Initialisation...",{userId:u,eventId:h,teamId:y});const{client:t,account:s}=await Q(),{token:q}=await ce(u,h,y);console.log("[AcceptInvite] Token re√ßu, cr√©ation session..."),await s.createSession({userId:u,secret:q});const m=await s.get();if(console.log("[AcceptInvite] Connect√© en tant que :",m.name),a(l,m.name,!0),m.passwordUpdate){M("/dashboard");return}a(v,"set-password")}catch(t){console.error("[AcceptInvite] Erreur validation:",t),a(v,"error"),a(E,t.message||"Ce lien d'invitation est invalide.",!0)}finally{a(i,!1)}});async function J(){if(!e(l)||e(l).trim().length===0){alert("Veuillez saisir votre pseudo / nom.");return}if(e(w).length<8){alert("Le mot de passe doit faire au moins 8 caract√®res.");return}a(i,!0);try{const{client:t,account:s}=await Q();await s.updatePassword({password:e(w)}),e(l)&&await s.updateName({name:e(l)}),console.log("[AcceptInvite] Session cr√©√©e, redirection..."),M("/dashboard")}catch(t){console.error("[AcceptInvite] Erreur finalisation:",t),alert("Erreur : "+t.message),a(i,!1)}}ne(()=>{O.setConfig({title:"Rejoindre l'√©quipe"})}),ie(()=>{O.reset()});var T=be(),N=r(T),R=r(N),W=r(R);{var X=t=>{var s=pe();F(2),c(t,s)},Y=t=>{var s=U(),q=j(s);{var m=p=>{var f=ue(),I=j(f);se(I,{class:"text-error mb-2 size-7"});var b=d(I,4),g=r(b,!0);n(b);var A=d(b,2);A.__click=()=>M("/"),D(()=>ve(g,e(E))),c(p,f)},$=p=>{var f=U(),I=j(f);{var b=g=>{var A=fe(),z=d(j(A),6),S=d(r(z),2);H(S),n(z);var B=d(z,2),L=d(r(B),2);H(L),n(B);var P=d(B,2),k=r(P);k.__click=J;var ee=r(k);{var te=o=>{var ae=me();c(o,ae)};V(ee,o=>{e(i)&&o(te)})}F(),n(k),n(P),D(()=>k.disabled=e(i)),K(S,()=>e(l),o=>a(l,o)),K(L,()=>e(w),o=>a(w,o)),c(g,A)};V(I,g=>{e(v)==="set-password"&&g(b)},!0)}c(p,f)};V(q,p=>{e(v)==="error"?p(m):p($,!1)},!0)}c(t,s)};V(W,t=>{e(i)&&e(v)!=="set-password"?t(X):t(Y,!1)})}n(R),n(N),n(T),c(Z,T),le()}de(["click"]);export{we as default};
